import{jq as Z,fj as Mt,at as Y,bZ as O,t as G,r as S,c1 as W,i as Rt,aV as N,b2 as Pt,s as bt,jB as T,jC as k,jD as ot,jE as St,jF as Et,ea as Nt,jG as it}from"./index.f2e9cdcf.js";var V;function mt(t,e,o){return!Pt(t,e,o)}function z(t,e,o){const r=mt(t,e,o);if(r&&!Z())throw new bt("rasterprojectionhelper-project","projection engine is not loaded");return r}(function(t){t[t.None=0]="None",t[t.North=1]="North",t[t.South=2]="South",t[t.Both=3]="Both"})(V||(V={}));const st=(t,e,o,r=0)=>{if(o[0]===1)return[0,0];let s=1,n=-1,i=1,u=-1;for(let f=0;f<t.length;f+=2)isNaN(t[f])||(s=s>t[f]?t[f]:s,n=n>t[f]?n:t[f],i=i>t[f+1]?t[f+1]:i,u=u>t[f+1]?u:t[f+1]);const{cols:c,rows:l}=e,a=(n-s)/c/o[0],d=(u-i)/l/o[1],x=2*r;let m=0,h=!1,g=[0,0];for(let f=0;f<c-3;f++){for(let M=0;M<l-3;M++){const y=f*l*2+2*M,p=(t[y]+t[y+4]+t[y+4*l]+t[y+4*l+4])/4,w=(t[y+1]+t[y+5]+t[y+4*l+1]+t[y+4*l+5])/4,R=Math.abs((p-t[y+2*l+2])/a),P=Math.abs((w-t[y+2*l+3])/d);if(R+P>m&&(m=R+P,g=[R,P]),x&&m>x){h=!0;break}}if(h)break}return g},Gt={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},A=32,B=4,X=B,K=new Map,D=new Map,I=500;async function Wt(){Z()||await Mt()}function Lt(t,e,o){return z(t.spatialReference,e)?o?it(e,t.spatialReference,t):it(t.spatialReference,e,t):null}function At(t,e,o,r=null){const s=t.spatialReference;if(s.equals(e))return t;z(s,e,r);const n=o.center,i=new Y({xmin:n.x-t.x/2,xmax:n.x+t.x/2,ymin:n.y-t.y/2,ymax:n.y+t.y/2,spatialReference:s}),u=O(i,e,r),c=C(e);let l;if(G(u)||S(c)&&u.width>=c){const a=W(s)/W(e);l={x:t.x*a,y:t.y*a}}else l={x:u.width,y:u.height};return l}function E(t,e=.01){return W(t)?e/W(t):0}function rt(t,e,o=null,r=!0){const s=t.spatialReference;if(s.equals(e))return t;z(s,e,o);const n=O(t,e,o);return r&&n&&ht([t],[n],s,e),n}function ht(t,e,o,r){const s=F(o,!0),n=F(r,!0),i=E(o,I),u=E(r,I);if(i&&S(s)&&S(n))for(let c=0;c<t.length;c++){const l=e[c];if(!l)continue;const{x:a}=t[c],{x:d}=l;d>=n[1]-u&&Math.abs(a-s[0])<i?l.x-=n[1]-n[0]:d<=n[0]+u&&Math.abs(a-s[1])<i&&(l.x+=n[1]-n[0])}}function kt(t){const{inSR:e,outSR:o,datumTransformation:r,preferPE:s}=t;if(e.equals(o)){const{points:n}=H(t,null);return n}if(e.isWebMercator&&o.isWGS84||e.isWGS84&&o.isWebMercator)return Ct(t);if(z(e,o,r)&&s){if(e.isGeographic)return at(t);const n=j(e);if(S(n))return at(t)}return Tt(t)}function Tt(t){const{points:e}=H(t,null),{inSR:o,outSR:r,datumTransformation:s}=t,n=e.map(u=>new N(u[0],u[1],o)),i=O(n,r,s);return s&&ht(n,i,o,r),i.map(u=>u?[u.x,u.y]:[NaN,NaN])}function at(t){const{inSR:e,outSR:o,datumTransformation:r}=t,s=j(e),{points:n,mask:i}=H(t,s);if(!e.isGeographic){const c=e.wkid?T.coordsys(e.wkid):T.fromString(e.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,e.wkt);ot.projToGeog(c,n.length,n)}if(S(r)&&r.steps.length){let c;if(o.isGeographic&&(c=n.map(([a])=>a>179.9955?1:a<-179.9955?-1:0)),r.steps.forEach(a=>{const d=a.wkid?T.geogtran(a.wkid):T.fromString(k.PE_TYPE_GEOGTRAN,a.wkt);St.geogToGeog(d,n.length,n,null,a.isInverse?k.PE_TRANSFORM_2_TO_1:k.PE_TRANSFORM_1_TO_2)}),c)for(let a=0;a<n.length;a++){const d=c[a],x=n[a][0],m=x>179.9955?1:x<-179.9955?-1:0;d&&m&&d!==m&&(n[a][0]=d>0?x+360:x-360)}}if(!o.isGeographic){const c=j(o,!0),l=S(c)&&c.isEnvelope?[c.bbox[1],c.bbox[3]]:[-90,90];vt(n,l);const a=o.wkid?T.coordsys(o.wkid):T.fromString(o.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,o.wkt);ot.geogToProj(a,n.length,n)}let u=n;if(i&&n.length!==i.length){u=[];for(let c=0,l=0;c<i.length;c++)i[c]?u.push(n[l++]):u.push([NaN,NaN])}return u}function Ct(t){const{cols:e,rows:o,xres:r,yres:s,usePixelCenter:n,inSR:i,outSR:u}=t;let{xmin:c,ymax:l}=t;n&&(c+=r/2,l-=s/2);const a=[],d=[],x=Math.max(e,o);for(let h=0;h<x;h++){const g=c+r*Math.min(e,h),f=l-s*Math.min(o,h),M=O(new N({x:g,y:f,spatialReference:i}),u);h<=e&&a.push(M.x),h<=o&&d.push(M.y)}const m=[];for(let h=0;h<e;h++)for(let g=0;g<o;g++)m.push([a[h],d[g]]);return m}function j(t,e=!1){let o=t.wkid||t.wkt;if(!o||t.isGeographic)return null;if(o=String(o),K.has(o)){const i=K.get(o);return e?i==null?void 0:i.gcs:i==null?void 0:i.pcs}const r=t.wkid?T.coordsys(t.wkid):T.fromString(t.isGeographic?k.PE_TYPE_GEOGCS:k.PE_TYPE_PROJCS,t.wkt),s=lt(r,E(t,1e-4)),n=lt(r,0,!0);return K.set(o,{pcs:s,gcs:n}),e?n:s}function lt(t,e=0,o=!1){const r=Et.generate(t),s=o?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!r||!(s!=null&&s.length))return null;let n=!1,i=s.find(f=>f.getInclusive()===1&&f.getKind()===1);if(!i){if(i=s.find(f=>f.getInclusive()===1&&f.getKind()===0),!i)return null;n=!0}const u=o?0:(r.getNorthPoleLocation()===2?1:0)|(r.getSouthPoleLocation()===2?2:0),c=r.isPannableRectangle(),l=i.getCoord();if(n)return{isEnvelope:n,isPannable:c,vertices:l,coef:null,bbox:[l[0][0]-e,l[0][1]-e,l[1][0]+e,l[1][1]+e],poleLocation:u};let a=0;const d=[];let[x,m]=l[0],[h,g]=l[0];for(let f=0,M=l.length;f<M;f++){a++,a===M&&(a=0);const[y,p]=l[f],[w,R]=l[a];if(R===p)d.push([y,w,p,R,2]);else{const P=(w-y)/(R-p||1e-4),v=y-P*p;p<R?d.push([P,v,p,R,0]):d.push([P,v,R,p,1])}x=x<y?x:y,m=m<p?m:p,h=h>y?h:y,g=g>p?g:p}return{isEnvelope:!1,isPannable:c,vertices:l,coef:d,bbox:[x,m,h,g],poleLocation:u}}function H(t,e){const o=[],{cols:r,rows:s,xres:n,yres:i,usePixelCenter:u}=t;let{xmin:c,ymax:l}=t;if(u&&(c+=n/2,l-=i/2),G(e)){for(let m=0;m<r;m++)for(let h=0;h<s;h++)o.push([c+n*m,l-i*h]);return{points:o}}const a=new Uint8Array(r*s);if(e.isEnvelope){const{bbox:[m,h,g,f]}=e;for(let M=0,y=0;M<r;M++){const p=c+n*M,w=e.isPannable||p>=m&&p<=g;for(let R=0;R<s;R++,y++){const P=l-i*R;w&&P>=h&&P<=f&&(o.push([p,P]),a[y]=1)}}return{points:o,mask:a}}const d=e.coef,x=[];for(let m=0;m<s;m++){const h=l-i*m,g=[],f=[];for(let y=0;y<d.length;y++){const[p,w,R,P,v]=d[y];if(h===R&&R===P)g.push(p),g.push(w),f.push(2),f.push(2);else if(h>=R&&h<=P){const L=p*h+w;g.push(L),f.push(v)}}let M=g;if(g.length>2){let y=f[0]===2?0:f[0],p=g[0];M=[];for(let w=1;w<f.length;w++)f[w]===2&&w!==f.length-1||(f[w]!==y&&(M.push(y===0?Math.min(p,g[w-1]):Math.max(p,g[w-1])),y=f[w],p=g[w]),w===f.length-1&&M.push(f[w]===0?Math.min(p,g[w]):Math.max(p,g[w])));M.sort((w,R)=>w-R)}else g[0]>g[1]&&(M=[g[1],g[0]]);x.push(M)}for(let m=0,h=0;m<r;m++){const g=c+n*m;for(let f=0;f<s;f++,h++){const M=l-i*f,y=x[f];if(y.length===2)g>=y[0]&&g<=y[1]&&(o.push([g,M]),a[h]=1);else if(y.length>2){let p=!1;for(let w=0;w<y.length;w+=2)if(g>=y[w]&&g<=y[w+1]){p=!0;break}p&&(o.push([g,M]),a[h]=1)}}}return{points:o,mask:a}}function vt(t,e){const[o,r]=e;for(let s=0;s<t.length;s++){const n=t[s][1];(n<o||n>r)&&(t[s]=[NaN,NaN])}}function xt(t){const e=C(t[0].spatialReference);if(t.length<2||G(e))return t[0];let{xmin:o,xmax:r,ymin:s,ymax:n}=t[0];for(let i=1;i<t.length;i++){const u=t[i];r=u.xmax+e*i,s=Math.min(s,u.ymin),n=Math.max(n,u.ymax)}return new Y({xmin:o,xmax:r,ymin:s,ymax:n,spatialReference:t[0].spatialReference})}function _t(t,e,o=null,r=!0){const s=t.spatialReference;if(s.equals(e))return t;const n=Ot(t),i=C(s,!0),u=C(e);if(n===0||G(i)||G(u)){const l=ct(t,e,o,r);if(G(i)&&S(u)&&Math.abs(l.width-u)<E(e)&&Z()){const a=j(s);if(S(a)&&a.poleLocation===V.None&&t.width<(a.bbox[2]-a.bbox[0])/2)return jt(t,e)||l}return l}const c=t.clone().normalize();if(c.length===1&&t.xmax<i&&t.xmax-i/2>E(s)){const{xmin:l,xmax:a}=t;for(let d=0;d<=n;d++){const x=d===0?l:-i/2,m=d===n?a-i*d:i/2;c[d]=new Y({xmin:x,xmax:m,ymin:t.ymin,ymax:t.ymax,spatialReference:s})}}return xt(c.map(l=>ct(l,e,o,r)).filter(S))}function jt(t,e){const o=C(e);if(G(o))return null;let{xmin:r,ymin:s,xmax:n,ymax:i}=t;const u=t.spatialReference,c=new Rt({spatialReference:u,rings:[[[r,s],[n,s],[n,i],[r,i],[r,s]]]}),l=O(c,e);if(l.rings.length!==2||!l.rings[0].length||!l.rings[1].length)return null;const{rings:a}=l,d=E(u),x=new Y({spatialReference:e});for(let m=0;m<2;m++){r=n=a[m][0][0],s=i=a[m][0][1];for(let h=0;h<a[m].length;h++)r=r>a[m][h][0]?a[m][h][0]:r,n=n<a[m][h][0]?a[m][h][0]:n,s=s>a[m][h][1]?a[m][h][1]:s,i=i<a[m][h][1]?a[m][h][1]:i;if(m===0)x.ymin=s,x.ymax=i,x.xmin=r,x.xmax=n;else if(x.ymin=Math.min(x.ymin,s),x.ymax=Math.max(x.ymax,i),Math.abs(n-o/2)<d)x.xmin=r,x.xmax=x.xmax+o;else{if(!(Math.abs(r+o/2)<d))return null;x.xmax=n+o}}return x}function ct(t,e,o=null,r=!0,s=!0){const n=t.spatialReference;if(n.equals(e)||!e)return t;z(n,e,o);const i=O(t,e,o);if(s&&e.isWebMercator&&i&&(i.ymax=Math.min(20037508342787e-6,i.ymax),i.ymin=Math.max(-20037508342787e-6,i.ymin),i.ymin>=i.ymax))return null;if(!r||!i)return i;const u=F(n,!0),c=F(e,!0);if(G(u)||G(c))return i;const l=E(n,.001),a=E(n,I),d=E(e,.001);if(Math.abs(i.xmin-c[0])<d&&Math.abs(i.xmax-c[1])<d){const x=Math.abs(t.xmin-u[0]),m=Math.abs(u[1]-t.xmax);if(x<l&&m>a){i.xmin=c[0];const h=[];h.push(new N(t.xmax,t.ymin,n)),h.push(new N(t.xmax,(t.ymin+t.ymax)/2,n)),h.push(new N(t.xmax,t.ymax,n));const g=h.map(f=>rt(f,e,o)).filter(f=>!isNaN(f==null?void 0:f.x)).map(f=>f.x);i.xmax=Math.max.apply(null,g)}if(m<l&&x>a){i.xmax=c[1];const h=[];h.push(new N(t.xmin,t.ymin,n)),h.push(new N(t.xmin,(t.ymin+t.ymax)/2,n)),h.push(new N(t.xmin,t.ymax,n));const g=h.map(f=>rt(f,e,o)).filter(f=>!isNaN(f==null?void 0:f.x)).map(f=>f.x);i.xmin=Math.min.apply(null,g)}}else{const x=E(e,.001);Math.abs(i.xmin-c[0])<x&&(i.xmin=c[0]),Math.abs(i.xmax-c[1])<x&&(i.xmax=c[1])}return i}function C(t,e=!1){if(!t)return null;const o=e?20037508342787e-6:20037508342788905e-9;return t.isWebMercator?2*o:t.wkid&&t.isGeographic?360:2*Gt[t.wkid]||null}function F(t,e=!1){if(t.isGeographic)return[-180,180];const o=C(t,e);return S(o)?[-o/2,o/2]:null}function ft(t,e,o,r){let s=(t-e)/o;return s-Math.floor(s)!=0?s=Math.floor(s):r&&(s-=1),s}function Ot(t,e=!1){const o=C(t.spatialReference);if(G(o))return 0;const r=e?0:-(o/2),s=E(t.spatialReference),n=!e&&Math.abs(t.xmax-o/2)<s?o/2:t.xmax,i=!e&&Math.abs(t.xmin+o/2)<s?-o/2:t.xmin;return ft(n,r,o,!0)-ft(i,r,o,!1)}function Bt(t){const e=t.storageInfo.origin.x,o=C(t.spatialReference,!0);if(G(o))return{originX:e,halfWorldWidth:null,pyramidsInfo:null};const r=o/2,{nativePixelSize:s,storageInfo:n,extent:i}=t,{maximumPyramidLevel:u,blockWidth:c,pyramidScalingFactor:l}=n;let a=s.x;const d=[],x=S(t.transform)&&t.transform.type==="gcs-shift",m=e+(x?0:r),h=x?o-e:r-e;for(let g=0;g<=u;g++){const f=(i.xmax-e)/a/c,M=f-Math.floor(f)==0?f:Math.ceil(f),y=h/a/c,p=y-Math.floor(y)==0?y:Math.ceil(y),w=Math.floor(m/a/c),R=Math.round(m/a)%c,P=(c-Math.round(h/a)%c)%c;d.push({resolutionX:a,blockWidth:c,datsetColumnCount:M,worldColumnCountFromOrigin:p,leftMargin:R,rightPadding:P,originColumnOffset:w}),a*=l}return{originX:e,halfWorldWidth:r,pyramidsInfo:d,hasGCSSShiftTransform:x}}function zt(t){if(!t||t.isGeographic)return t;const e=String(t.wkid||t.wkt);let o;return D.has(e)?o=D.get(e):(o=(t.wkid?T.coordsys(t.wkid):T.fromString(k.PE_TYPE_PROJCS,t.wkt)).getGeogcs().getCode(),D.set(e,o)),new Nt({wkid:o})}function It(t){const e=t.isAdaptive&&t.spacing==null;let o=t.spacing||[A,A],r=U(t),s={cols:r.size[0]+1,rows:r.size[1]+1};const n=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2;let i=r.outofBoundPointCount===r.offsets.length/2||e&&n?[0,0]:st(r.offsets,s,o,X);const u=(i[0]+i[1])/2,c=t.projectedExtent.spatialReference,l=t.srcBufferExtent.spatialReference;if(e&&(n||u>X)&&(mt(c,l,t.datumTransformation)&&(c.isGeographic||S(j(c))),o=[B,B],r=U({...t,spacing:o}),s={cols:r.size[0]+1,rows:r.size[1]+1},i=st(r.offsets,s,o,X)),r.error=i,o[0]>1&&(r.coefficients=ut(r.offsets,s,n)),t.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(l.isGeographic)r.gcsGrid={offsets:r.offsets,coefficients:r.coefficients,spacing:o};else{const a=j(c);if(S(a)&&!a.isEnvelope){const d=zt(c),x=_t(t.projectedExtent,d),{offsets:m}=U({...t,srcBufferExtent:x,spacing:o}),h=ut(m,s,n);r.gcsGrid={offsets:m,coefficients:h,spacing:o}}}return r}function U(t){const{projectedExtent:e,srcBufferExtent:o,pixelSize:r,datumTransformation:s,rasterTransform:n}=t,i=e.spatialReference,u=o.spatialReference,c=z(i,u),{xmin:l,ymin:a,xmax:d,ymax:x}=e,m=C(u),h=S(m)&&(t.hasWrapAround||(n==null?void 0:n.type)==="gcs-shift"),g=t.spacing||[A,A],f=g[0]*r.x,M=g[1]*r.y,y=g[0]===1,p=Math.ceil((d-l)/f-.1/g[0])+(y?0:1),w=Math.ceil((x-a)/M-.1/g[1])+(y?0:1),R=kt({cols:p,rows:w,xmin:l,ymax:x,xres:f,yres:M,inSR:i,outSR:u,datumTransformation:s,preferPE:g[0]<=B,usePixelCenter:y}),P=[];let v,L=0;const Q=y?-1:NaN,{xmin:tt,xmax:q,ymax:pt,width:gt,height:yt}=o,dt=E(u,I),wt=S(m)&&tt>0&&q>m/2;let nt=!1;if(c){const _=j(i);nt=S(_)&&_.poleLocation>0}for(let _=0;_<p;_++){const J=[];for(let $=0;$<w;$++){let b=R[_*w+$];if(h&&b[0]>q&&b[0]>m/2-dt?b[0]-=m:h&&_===0&&b[0]<0&&wt&&!n&&(b[0]+=m),!b||isNaN(b[0])||isNaN(b[1]))P.push(Q),P.push(Q),J.push(null),L++;else{if(n){const et=n.inverseTransform(new N({x:b[0],y:b[1],spatialReference:u}));b=[et.x,et.y]}J.push(b),_>0&&h&&v[$]&&b[0]<v[$][0]&&(b[0]+=m,nt&&b[0]>q&&b[0]>m&&(b[0]-=m)),P.push((b[0]-tt)/gt),P.push((pt-b[1])/yt)}}v=J}return{offsets:P,error:null,coefficients:null,outofBoundPointCount:L,spacing:g,size:y?[p,w]:[p-1,w-1]}}function ut(t,e,o){const{cols:r,rows:s}=e,n=new Float32Array((r-1)*(s-1)*2*6),i=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),u=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let c=0;c<r-1;c++){for(let l=0;l<s-1;l++){let a=c*s*2+2*l;const d=t[a],x=t[a+1],m=t[a+2],h=t[a+3];a+=2*s;const g=t[a],f=t[a+1],M=t[a+2],y=t[a+3];let p=0,w=12*(l*(r-1)+c);for(let R=0;R<3;R++)n[w++]=i[p++]*d+i[p++]*m+i[p++]*M;p=0;for(let R=0;R<3;R++)n[w++]=i[p++]*x+i[p++]*h+i[p++]*y;p=0;for(let R=0;R<3;R++)n[w++]=u[p++]*d+u[p++]*g+u[p++]*M;p=0;for(let R=0;R<3;R++)n[w++]=u[p++]*x+u[p++]*f+u[p++]*y}if(o)for(let l=0;l<n.length;l++)isNaN(n[l])&&(n[l]=-1)}return n}function Ft(t){const e=t.clone().normalize();return e.length===1?e[0]:xt(e)}function Yt(t,e,o){const{storageInfo:r,pixelSize:s}=e;let n=0,i=!1;const{pyramidResolutions:u}=r;if(S(u)&&u.length){const x=(t.x+t.y)/2,m=u[u.length-1],h=(m.x+m.y)/2,g=(s.x+s.y)/2;if(x<=g)n=0;else if(x>=h)n=u.length,i=x/h>8;else{let M,y=g;for(let p=1;p<=u.length;p++){if(M=(u[p-1].x+u[p-1].y)/2,x<=M){x===M?n=p:o==="down"?(n=p-1,i=x/y>8):n=o==="up"||x-y>M-x||x/y>2?p:p-1;break}y=M}}const f=n===0?s:u[n-1];return i&&Math.min(f.x,f.y)*W(e.spatialReference)>19567&&(i=!1),{pyramidLevel:n,pyramidResolution:new N({x:f.x,y:f.y,spatialReference:e.spatialReference}),excessiveReading:i}}const c=Math.log(t.x/s.x)/Math.LN2,l=Math.log(t.y/s.y)/Math.LN2,a=e.storageInfo.maximumPyramidLevel||0;n=o==="down"?Math.floor(Math.min(c,l)):o==="up"?Math.ceil(Math.max(c,l)):Math.round((c+l)/2),n<0?n=0:n>a&&(i=n>a+3,n=a);const d=2**n;return{pyramidLevel:n,pyramidResolution:new N({x:d*e.nativePixelSize.x,y:d*e.nativePixelSize.y,spatialReference:e.spatialReference}),excessiveReading:i}}export{It as $,At as C,_t as J,mt as M,Ot as Q,Wt as T,C as U,Bt as V,rt as j,Ft as n,Yt as o,Lt as v};
