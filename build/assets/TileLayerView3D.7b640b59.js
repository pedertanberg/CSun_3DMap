import{e as i,f as o,k as f,s as c,aK as g,r as w,t as u,b2 as v}from"./index.bd80e406.js";import{n as x}from"./LayerView3D.a3a76aef.js";import{c as F}from"./TiledLayerView3D.cd8d9f63.js";import{u as I}from"./LayerView.3c9ee51e.js";import{i as b}from"./RefreshableLayerView.befc29a9.js";import{s as L}from"./clickToleranceUtils.974405a9.js";import{a as R}from"./drapedUtils.5a0d6f05.js";const S=t=>{let r=class extends t{async fetchPopupFeatures(s,y){const{layer:n}=this;if(!s)throw new c("tilelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:n});if(n.type!=="tile")throw new c("tilelayerview:fetchPopupFeatures","Layer type should be 'tile'",{type:n.type});const m=this.get("view.scale"),h=n.allSublayers.toArray().filter(e=>{const l=e.minScale===0||m<=e.minScale,p=e.maxScale===0||m>=e.maxScale;return e.popupTemplate&&e.popupEnabled&&e.visible&&l&&p});return g(h.map(async e=>{const l=e.createQuery(),p=w(y)?y.event:null,d=L({renderer:e.renderer,event:p});return l.geometry=this.createFetchPopupFeaturesQueryGeometry(s,d),l.outFields=await e.popupTemplate.getRequiredFields(),(await e.queryFeatures(l)).features})).then(e=>[].concat(...e.map(l=>l.value).filter(Boolean)))}};return i([o()],r.prototype,"layer",void 0),r=i([f("esri.layers.mixins.TileLayerView")],r),r};let a=class extends b(F(S(x(I)))){constructor(){super(...arguments),this.type="tile-3d"}get imageFormatIsOpaque(){return this.layer.tileInfo.format==="jpg"}get hasMixedImageFormats(){return this.layer.tileInfo.format==="mixed"}get tileInfo(){var t;return(t=this.layer)==null?void 0:t.tileInfo}get dataLevelRange(){if(this.tileInfo){const t=this.tileInfo.lods,r=t[0].scale,s=t[t.length-1].scale;return this.levelRangeFromScaleRange(r,s)}return{minLevel:0,maxLevel:0}}initialize(){if(this.layer.type==="web-tile"){const t=this.layer.get("fullExtent.spatialReference"),r=this.layer.get("tileInfo.spatialReference");if(u(t)||u(r)||!v(t,r)){const s=this.layer.originOf("fullExtent")==="defaults"||u(this.layer.fullExtent)?"SceneView requires fullExtent to be specified by the user on WebTileLayer":"SceneView requires fullExtent to be specified in the same spatial reference as tileInfo on WebTileLayer";this.addResolvingPromise(Promise.reject(new c("layerview:incompatible-fullextent",s)))}}this._addTilingSchemeMatchPromise()}createFetchPopupFeaturesQueryGeometry(t,r){return R(t,r,this.view)}async doRefresh(){this.suspended||this.emit("data-changed")}};i([o()],a.prototype,"imageFormatIsOpaque",null),i([o()],a.prototype,"hasMixedImageFormats",null),i([o()],a.prototype,"layer",void 0),i([o()],a.prototype,"tileInfo",null),i([o()],a.prototype,"dataLevelRange",null),a=i([f("esri.views.3d.layers.TileLayerView3D")],a);const Q=a;export{Q as default};
