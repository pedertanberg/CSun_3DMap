(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}})();function M6e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var I2={exports:{}},Ti={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TF=Symbol.for("react.element"),R6e=Symbol.for("react.portal"),I6e=Symbol.for("react.fragment"),P6e=Symbol.for("react.strict_mode"),$6e=Symbol.for("react.profiler"),D6e=Symbol.for("react.provider"),L6e=Symbol.for("react.context"),N6e=Symbol.for("react.forward_ref"),F6e=Symbol.for("react.suspense"),k6e=Symbol.for("react.memo"),U6e=Symbol.for("react.lazy"),kue=Symbol.iterator;function B6e(e){return e===null||typeof e!="object"?null:(e=kue&&e[kue]||e["@@iterator"],typeof e=="function"?e:null)}var Nxe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Fxe=Object.assign,kxe={};function vI(e,t,r){this.props=e,this.context=t,this.refs=kxe,this.updater=r||Nxe}vI.prototype.isReactComponent={};vI.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};vI.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Uxe(){}Uxe.prototype=vI.prototype;function Die(e,t,r){this.props=e,this.context=t,this.refs=kxe,this.updater=r||Nxe}var Lie=Die.prototype=new Uxe;Lie.constructor=Die;Fxe(Lie,vI.prototype);Lie.isPureReactComponent=!0;var Uue=Array.isArray,Bxe=Object.prototype.hasOwnProperty,Nie={current:null},zxe={key:!0,ref:!0,__self:!0,__source:!0};function Vxe(e,t,r){var i,s={},n=null,o=null;if(t!=null)for(i in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(n=""+t.key),t)Bxe.call(t,i)&&!zxe.hasOwnProperty(i)&&(s[i]=t[i]);var a=arguments.length-2;if(a===1)s.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];s.children=l}if(e&&e.defaultProps)for(i in a=e.defaultProps,a)s[i]===void 0&&(s[i]=a[i]);return{$$typeof:TF,type:e,key:n,ref:o,props:s,_owner:Nie.current}}function z6e(e,t){return{$$typeof:TF,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Fie(e){return typeof e=="object"&&e!==null&&e.$$typeof===TF}function V6e(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var Bue=/\/+/g;function sH(e,t){return typeof e=="object"&&e!==null&&e.key!=null?V6e(""+e.key):t.toString(36)}function s6(e,t,r,i,s){var n=typeof e;(n==="undefined"||n==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(n){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case TF:case R6e:o=!0}}if(o)return o=e,s=s(o),e=i===""?"."+sH(o,0):i,Uue(s)?(r="",e!=null&&(r=e.replace(Bue,"$&/")+"/"),s6(s,t,r,"",function(c){return c})):s!=null&&(Fie(s)&&(s=z6e(s,r+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(Bue,"$&/")+"/")+e)),t.push(s)),1;if(o=0,i=i===""?".":i+":",Uue(e))for(var a=0;a<e.length;a++){n=e[a];var l=i+sH(n,a);o+=s6(n,t,r,l,s)}else if(l=B6e(e),typeof l=="function")for(e=l.call(e),a=0;!(n=e.next()).done;)n=n.value,l=i+sH(n,a++),o+=s6(n,t,r,l,s);else if(n==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function N4(e,t,r){if(e==null)return e;var i=[],s=0;return s6(e,i,"","",function(n){return t.call(r,n,s++)}),i}function j6e(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Du={current:null},n6={transition:null},G6e={ReactCurrentDispatcher:Du,ReactCurrentBatchConfig:n6,ReactCurrentOwner:Nie};Ti.Children={map:N4,forEach:function(e,t,r){N4(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return N4(e,function(){t++}),t},toArray:function(e){return N4(e,function(t){return t})||[]},only:function(e){if(!Fie(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ti.Component=vI;Ti.Fragment=I6e;Ti.Profiler=$6e;Ti.PureComponent=Die;Ti.StrictMode=P6e;Ti.Suspense=F6e;Ti.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=G6e;Ti.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=Fxe({},e.props),s=e.key,n=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(n=t.ref,o=Nie.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(l in t)Bxe.call(t,l)&&!zxe.hasOwnProperty(l)&&(i[l]=t[l]===void 0&&a!==void 0?a[l]:t[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:TF,type:e.type,key:s,ref:n,props:i,_owner:o}};Ti.createContext=function(e){return e={$$typeof:L6e,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:D6e,_context:e},e.Consumer=e};Ti.createElement=Vxe;Ti.createFactory=function(e){var t=Vxe.bind(null,e);return t.type=e,t};Ti.createRef=function(){return{current:null}};Ti.forwardRef=function(e){return{$$typeof:N6e,render:e}};Ti.isValidElement=Fie;Ti.lazy=function(e){return{$$typeof:U6e,_payload:{_status:-1,_result:e},_init:j6e}};Ti.memo=function(e,t){return{$$typeof:k6e,type:e,compare:t===void 0?null:t}};Ti.startTransition=function(e){var t=n6.transition;n6.transition={};try{e()}finally{n6.transition=t}};Ti.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Ti.useCallback=function(e,t){return Du.current.useCallback(e,t)};Ti.useContext=function(e){return Du.current.useContext(e)};Ti.useDebugValue=function(){};Ti.useDeferredValue=function(e){return Du.current.useDeferredValue(e)};Ti.useEffect=function(e,t){return Du.current.useEffect(e,t)};Ti.useId=function(){return Du.current.useId()};Ti.useImperativeHandle=function(e,t,r){return Du.current.useImperativeHandle(e,t,r)};Ti.useInsertionEffect=function(e,t){return Du.current.useInsertionEffect(e,t)};Ti.useLayoutEffect=function(e,t){return Du.current.useLayoutEffect(e,t)};Ti.useMemo=function(e,t){return Du.current.useMemo(e,t)};Ti.useReducer=function(e,t,r){return Du.current.useReducer(e,t,r)};Ti.useRef=function(e){return Du.current.useRef(e)};Ti.useState=function(e){return Du.current.useState(e)};Ti.useSyncExternalStore=function(e,t,r){return Du.current.useSyncExternalStore(e,t,r)};Ti.useTransition=function(){return Du.current.useTransition()};Ti.version="18.2.0";(function(e){e.exports=Ti})(I2);const H6e=M6e(I2.exports);var QY={},jxe={exports:{}},ip={},Gxe={exports:{}},Hxe={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(N,B){var H=N.length;N.push(B);e:for(;0<H;){var W=H-1>>>1,K=N[W];if(0<s(K,B))N[W]=B,N[H]=K,H=W;else break e}}function r(N){return N.length===0?null:N[0]}function i(N){if(N.length===0)return null;var B=N[0],H=N.pop();if(H!==B){N[0]=H;e:for(var W=0,K=N.length,Y=K>>>1;W<Y;){var ce=2*(W+1)-1,we=N[ce],Oe=ce+1,Be=N[Oe];if(0>s(we,H))Oe<K&&0>s(Be,we)?(N[W]=Be,N[Oe]=H,W=Oe):(N[W]=we,N[ce]=H,W=ce);else if(Oe<K&&0>s(Be,H))N[W]=Be,N[Oe]=H,W=Oe;else break e}}return B}function s(N,B){var H=N.sortIndex-B.sortIndex;return H!==0?H:N.id-B.id}if(typeof performance=="object"&&typeof performance.now=="function"){var n=performance;e.unstable_now=function(){return n.now()}}else{var o=Date,a=o.now();e.unstable_now=function(){return o.now()-a}}var l=[],c=[],d=1,p=null,f=3,m=!1,g=!1,_=!1,x=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(N){for(var B=r(c);B!==null;){if(B.callback===null)i(c);else if(B.startTime<=N)i(c),B.sortIndex=B.expirationTime,t(l,B);else break;B=r(c)}}function E(N){if(_=!1,T(N),!g)if(r(l)!==null)g=!0,X(O);else{var B=r(c);B!==null&&F(E,B.startTime-N)}}function O(N,B){g=!1,_&&(_=!1,b(D),D=-1),m=!0;var H=f;try{for(T(B),p=r(l);p!==null&&(!(p.expirationTime>B)||N&&!q());){var W=p.callback;if(typeof W=="function"){p.callback=null,f=p.priorityLevel;var K=W(p.expirationTime<=B);B=e.unstable_now(),typeof K=="function"?p.callback=K:p===r(l)&&i(l),T(B)}else i(l);p=r(l)}if(p!==null)var Y=!0;else{var ce=r(c);ce!==null&&F(E,ce.startTime-B),Y=!1}return Y}finally{p=null,f=H,m=!1}}var A=!1,R=null,D=-1,k=5,L=-1;function q(){return!(e.unstable_now()-L<k)}function G(){if(R!==null){var N=e.unstable_now();L=N;var B=!0;try{B=R(!0,N)}finally{B?J():(A=!1,R=null)}}else A=!1}var J;if(typeof w=="function")J=function(){w(G)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,se=ee.port2;ee.port1.onmessage=G,J=function(){se.postMessage(null)}}else J=function(){x(G,0)};function X(N){R=N,A||(A=!0,J())}function F(N,B){D=x(function(){N(e.unstable_now())},B)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(N){N.callback=null},e.unstable_continueExecution=function(){g||m||(g=!0,X(O))},e.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<N?Math.floor(1e3/N):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return r(l)},e.unstable_next=function(N){switch(f){case 1:case 2:case 3:var B=3;break;default:B=f}var H=f;f=B;try{return N()}finally{f=H}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(N,B){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var H=f;f=N;try{return B()}finally{f=H}},e.unstable_scheduleCallback=function(N,B,H){var W=e.unstable_now();switch(typeof H=="object"&&H!==null?(H=H.delay,H=typeof H=="number"&&0<H?W+H:W):H=W,N){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=H+K,N={id:d++,callback:B,priorityLevel:N,startTime:H,expirationTime:K,sortIndex:-1},H>W?(N.sortIndex=H,t(c,N),r(l)===null&&N===r(c)&&(_?(b(D),D=-1):_=!0,F(E,H-W))):(N.sortIndex=K,t(l,N),g||m||(g=!0,X(O))),N},e.unstable_shouldYield=q,e.unstable_wrapCallback=function(N){var B=f;return function(){var H=f;f=B;try{return N.apply(this,arguments)}finally{f=H}}}})(Hxe);(function(e){e.exports=Hxe})(Gxe);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qxe=I2.exports,Xh=Gxe.exports;function ze(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Wxe=new Set,CL={};function XE(e,t){eR(e,t),eR(e+"Capture",t)}function eR(e,t){for(CL[e]=t,e=0;e<t.length;e++)Wxe.add(t[e])}var Nv=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),eZ=Object.prototype.hasOwnProperty,q6e=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,zue={},Vue={};function W6e(e){return eZ.call(Vue,e)?!0:eZ.call(zue,e)?!1:q6e.test(e)?Vue[e]=!0:(zue[e]=!0,!1)}function X6e(e,t,r,i){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Y6e(e,t,r,i){if(t===null||typeof t>"u"||X6e(e,t,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Lu(e,t,r,i,s,n,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=n,this.removeEmptyString=o}var zl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){zl[e]=new Lu(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];zl[t]=new Lu(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){zl[e]=new Lu(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){zl[e]=new Lu(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){zl[e]=new Lu(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){zl[e]=new Lu(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){zl[e]=new Lu(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){zl[e]=new Lu(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){zl[e]=new Lu(e,5,!1,e.toLowerCase(),null,!1,!1)});var kie=/[\-:]([a-z])/g;function Uie(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(kie,Uie);zl[t]=new Lu(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(kie,Uie);zl[t]=new Lu(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(kie,Uie);zl[t]=new Lu(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){zl[e]=new Lu(e,1,!1,e.toLowerCase(),null,!1,!1)});zl.xlinkHref=new Lu("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){zl[e]=new Lu(e,1,!1,e.toLowerCase(),null,!0,!0)});function Bie(e,t,r,i){var s=zl.hasOwnProperty(t)?zl[t]:null;(s!==null?s.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Y6e(t,r,s,i)&&(r=null),i||s===null?W6e(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):s.mustUseProperty?e[s.propertyName]=r===null?s.type===3?!1:"":r:(t=s.attributeName,i=s.attributeNamespace,r===null?e.removeAttribute(t):(s=s.type,r=s===3||s===4&&r===!0?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}var s1=qxe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,F4=Symbol.for("react.element"),MO=Symbol.for("react.portal"),RO=Symbol.for("react.fragment"),zie=Symbol.for("react.strict_mode"),tZ=Symbol.for("react.profiler"),Xxe=Symbol.for("react.provider"),Yxe=Symbol.for("react.context"),Vie=Symbol.for("react.forward_ref"),rZ=Symbol.for("react.suspense"),iZ=Symbol.for("react.suspense_list"),jie=Symbol.for("react.memo"),Qb=Symbol.for("react.lazy"),Zxe=Symbol.for("react.offscreen"),jue=Symbol.iterator;function JI(e){return e===null||typeof e!="object"?null:(e=jue&&e[jue]||e["@@iterator"],typeof e=="function"?e:null)}var so=Object.assign,nH;function S3(e){if(nH===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);nH=t&&t[1]||""}return`
`+nH+e}var oH=!1;function aH(e,t){if(!e||oH)return"";oH=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),n=i.stack.split(`
`),o=s.length-1,a=n.length-1;1<=o&&0<=a&&s[o]!==n[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==n[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==n[a]){var l=`
`+s[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=o&&0<=a);break}}}finally{oH=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?S3(e):""}function Z6e(e){switch(e.tag){case 5:return S3(e.type);case 16:return S3("Lazy");case 13:return S3("Suspense");case 19:return S3("SuspenseList");case 0:case 2:case 15:return e=aH(e.type,!1),e;case 11:return e=aH(e.type.render,!1),e;case 1:return e=aH(e.type,!0),e;default:return""}}function sZ(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case RO:return"Fragment";case MO:return"Portal";case tZ:return"Profiler";case zie:return"StrictMode";case rZ:return"Suspense";case iZ:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Yxe:return(e.displayName||"Context")+".Consumer";case Xxe:return(e._context.displayName||"Context")+".Provider";case Vie:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case jie:return t=e.displayName||null,t!==null?t:sZ(e.type)||"Memo";case Qb:t=e._payload,e=e._init;try{return sZ(e(t))}catch{}}return null}function J6e(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return sZ(t);case 8:return t===zie?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function px(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Jxe(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function K6e(e){var t=Jxe(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var s=r.get,n=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(o){i=""+o,n.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function k4(e){e._valueTracker||(e._valueTracker=K6e(e))}function Kxe(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=Jxe(e)?e.checked?"true":"false":e.value),e=i,e!==r?(t.setValue(e),!0):!1}function v8(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function nZ(e,t){var r=t.checked;return so({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r!=null?r:e._wrapperState.initialChecked})}function Gue(e,t){var r=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;r=px(t.value!=null?t.value:r),e._wrapperState={initialChecked:i,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Qxe(e,t){t=t.checked,t!=null&&Bie(e,"checked",t,!1)}function oZ(e,t){Qxe(e,t);var r=px(t.value),i=t.type;if(r!=null)i==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?aZ(e,t.type,r):t.hasOwnProperty("defaultValue")&&aZ(e,t.type,px(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Hue(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function aZ(e,t,r){(t!=="number"||v8(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var E3=Array.isArray;function mM(e,t,r,i){if(e=e.options,t){t={};for(var s=0;s<r.length;s++)t["$"+r[s]]=!0;for(r=0;r<e.length;r++)s=t.hasOwnProperty("$"+e[r].value),e[r].selected!==s&&(e[r].selected=s),s&&i&&(e[r].defaultSelected=!0)}else{for(r=""+px(r),t=null,s=0;s<e.length;s++){if(e[s].value===r){e[s].selected=!0,i&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function lZ(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ze(91));return so({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function que(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(ze(92));if(E3(r)){if(1<r.length)throw Error(ze(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:px(r)}}function eTe(e,t){var r=px(t.value),i=px(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),i!=null&&(e.defaultValue=""+i)}function Wue(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function tTe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cZ(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?tTe(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var U4,rTe=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,i,s){MSApp.execUnsafeLocalFunction(function(){return e(t,r,i,s)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(U4=U4||document.createElement("div"),U4.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=U4.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function AL(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var cD={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Q6e=["Webkit","ms","Moz","O"];Object.keys(cD).forEach(function(e){Q6e.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),cD[t]=cD[e]})});function iTe(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||cD.hasOwnProperty(e)&&cD[e]?(""+t).trim():t+"px"}function sTe(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var i=r.indexOf("--")===0,s=iTe(r,t[r],i);r==="float"&&(r="cssFloat"),i?e.setProperty(r,s):e[r]=s}}var eBe=so({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function uZ(e,t){if(t){if(eBe[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ze(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ze(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ze(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ze(62))}}function dZ(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hZ=null;function Gie(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var pZ=null,gM=null,yM=null;function Xue(e){if(e=CF(e)){if(typeof pZ!="function")throw Error(ze(280));var t=e.stateNode;t&&(t=E9(t),pZ(e.stateNode,e.type,t))}}function nTe(e){gM?yM?yM.push(e):yM=[e]:gM=e}function oTe(){if(gM){var e=gM,t=yM;if(yM=gM=null,Xue(e),t)for(e=0;e<t.length;e++)Xue(t[e])}}function aTe(e,t){return e(t)}function lTe(){}var lH=!1;function cTe(e,t,r){if(lH)return e(t,r);lH=!0;try{return aTe(e,t,r)}finally{lH=!1,(gM!==null||yM!==null)&&(lTe(),oTe())}}function OL(e,t){var r=e.stateNode;if(r===null)return null;var i=E9(r);if(i===null)return null;r=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(ze(231,t,typeof r));return r}var fZ=!1;if(Nv)try{var KI={};Object.defineProperty(KI,"passive",{get:function(){fZ=!0}}),window.addEventListener("test",KI,KI),window.removeEventListener("test",KI,KI)}catch{fZ=!1}function tBe(e,t,r,i,s,n,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(r,c)}catch(d){this.onError(d)}}var uD=!1,b8=null,w8=!1,mZ=null,rBe={onError:function(e){uD=!0,b8=e}};function iBe(e,t,r,i,s,n,o,a,l){uD=!1,b8=null,tBe.apply(rBe,arguments)}function sBe(e,t,r,i,s,n,o,a,l){if(iBe.apply(this,arguments),uD){if(uD){var c=b8;uD=!1,b8=null}else throw Error(ze(198));w8||(w8=!0,mZ=c)}}function YE(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function uTe(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Yue(e){if(YE(e)!==e)throw Error(ze(188))}function nBe(e){var t=e.alternate;if(!t){if(t=YE(e),t===null)throw Error(ze(188));return t!==e?null:e}for(var r=e,i=t;;){var s=r.return;if(s===null)break;var n=s.alternate;if(n===null){if(i=s.return,i!==null){r=i;continue}break}if(s.child===n.child){for(n=s.child;n;){if(n===r)return Yue(s),e;if(n===i)return Yue(s),t;n=n.sibling}throw Error(ze(188))}if(r.return!==i.return)r=s,i=n;else{for(var o=!1,a=s.child;a;){if(a===r){o=!0,r=s,i=n;break}if(a===i){o=!0,i=s,r=n;break}a=a.sibling}if(!o){for(a=n.child;a;){if(a===r){o=!0,r=n,i=s;break}if(a===i){o=!0,i=n,r=s;break}a=a.sibling}if(!o)throw Error(ze(189))}}if(r.alternate!==i)throw Error(ze(190))}if(r.tag!==3)throw Error(ze(188));return r.stateNode.current===r?e:t}function dTe(e){return e=nBe(e),e!==null?hTe(e):null}function hTe(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=hTe(e);if(t!==null)return t;e=e.sibling}return null}var pTe=Xh.unstable_scheduleCallback,Zue=Xh.unstable_cancelCallback,oBe=Xh.unstable_shouldYield,aBe=Xh.unstable_requestPaint,Fo=Xh.unstable_now,lBe=Xh.unstable_getCurrentPriorityLevel,Hie=Xh.unstable_ImmediatePriority,fTe=Xh.unstable_UserBlockingPriority,x8=Xh.unstable_NormalPriority,cBe=Xh.unstable_LowPriority,mTe=Xh.unstable_IdlePriority,w9=null,i0=null;function uBe(e){if(i0&&typeof i0.onCommitFiberRoot=="function")try{i0.onCommitFiberRoot(w9,e,void 0,(e.current.flags&128)===128)}catch{}}var Qm=Math.clz32?Math.clz32:pBe,dBe=Math.log,hBe=Math.LN2;function pBe(e){return e>>>=0,e===0?32:31-(dBe(e)/hBe|0)|0}var B4=64,z4=4194304;function C3(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function T8(e,t){var r=e.pendingLanes;if(r===0)return 0;var i=0,s=e.suspendedLanes,n=e.pingedLanes,o=r&268435455;if(o!==0){var a=o&~s;a!==0?i=C3(a):(n&=o,n!==0&&(i=C3(n)))}else o=r&~s,o!==0?i=C3(o):n!==0&&(i=C3(n));if(i===0)return 0;if(t!==0&&t!==i&&(t&s)===0&&(s=i&-i,n=t&-t,s>=n||s===16&&(n&4194240)!==0))return t;if((i&4)!==0&&(i|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)r=31-Qm(t),s=1<<r,i|=e[r],t&=~s;return i}function fBe(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mBe(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,s=e.expirationTimes,n=e.pendingLanes;0<n;){var o=31-Qm(n),a=1<<o,l=s[o];l===-1?((a&r)===0||(a&i)!==0)&&(s[o]=fBe(a,t)):l<=t&&(e.expiredLanes|=a),n&=~a}}function gZ(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function gTe(){var e=B4;return B4<<=1,(B4&4194240)===0&&(B4=64),e}function cH(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function SF(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Qm(t),e[t]=r}function gBe(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<r;){var s=31-Qm(r),n=1<<s;t[s]=0,i[s]=-1,e[s]=-1,r&=~n}}function qie(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-Qm(r),s=1<<i;s&t|e[i]&t&&(e[i]|=t),r&=~s}}var Is=0;function yTe(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var _Te,Wie,vTe,bTe,wTe,yZ=!1,V4=[],Zw=null,Jw=null,Kw=null,ML=new Map,RL=new Map,fw=[],yBe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Jue(e,t){switch(e){case"focusin":case"focusout":Zw=null;break;case"dragenter":case"dragleave":Jw=null;break;case"mouseover":case"mouseout":Kw=null;break;case"pointerover":case"pointerout":ML.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":RL.delete(t.pointerId)}}function QI(e,t,r,i,s,n){return e===null||e.nativeEvent!==n?(e={blockedOn:t,domEventName:r,eventSystemFlags:i,nativeEvent:n,targetContainers:[s]},t!==null&&(t=CF(t),t!==null&&Wie(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function _Be(e,t,r,i,s){switch(t){case"focusin":return Zw=QI(Zw,e,t,r,i,s),!0;case"dragenter":return Jw=QI(Jw,e,t,r,i,s),!0;case"mouseover":return Kw=QI(Kw,e,t,r,i,s),!0;case"pointerover":var n=s.pointerId;return ML.set(n,QI(ML.get(n)||null,e,t,r,i,s)),!0;case"gotpointercapture":return n=s.pointerId,RL.set(n,QI(RL.get(n)||null,e,t,r,i,s)),!0}return!1}function xTe(e){var t=u2(e.target);if(t!==null){var r=YE(t);if(r!==null){if(t=r.tag,t===13){if(t=uTe(r),t!==null){e.blockedOn=t,wTe(e.priority,function(){vTe(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function o6(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=_Z(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var i=new r.constructor(r.type,r);hZ=i,r.target.dispatchEvent(i),hZ=null}else return t=CF(r),t!==null&&Wie(t),e.blockedOn=r,!1;t.shift()}return!0}function Kue(e,t,r){o6(e)&&r.delete(t)}function vBe(){yZ=!1,Zw!==null&&o6(Zw)&&(Zw=null),Jw!==null&&o6(Jw)&&(Jw=null),Kw!==null&&o6(Kw)&&(Kw=null),ML.forEach(Kue),RL.forEach(Kue)}function eP(e,t){e.blockedOn===t&&(e.blockedOn=null,yZ||(yZ=!0,Xh.unstable_scheduleCallback(Xh.unstable_NormalPriority,vBe)))}function IL(e){function t(s){return eP(s,e)}if(0<V4.length){eP(V4[0],e);for(var r=1;r<V4.length;r++){var i=V4[r];i.blockedOn===e&&(i.blockedOn=null)}}for(Zw!==null&&eP(Zw,e),Jw!==null&&eP(Jw,e),Kw!==null&&eP(Kw,e),ML.forEach(t),RL.forEach(t),r=0;r<fw.length;r++)i=fw[r],i.blockedOn===e&&(i.blockedOn=null);for(;0<fw.length&&(r=fw[0],r.blockedOn===null);)xTe(r),r.blockedOn===null&&fw.shift()}var _M=s1.ReactCurrentBatchConfig,S8=!0;function bBe(e,t,r,i){var s=Is,n=_M.transition;_M.transition=null;try{Is=1,Xie(e,t,r,i)}finally{Is=s,_M.transition=n}}function wBe(e,t,r,i){var s=Is,n=_M.transition;_M.transition=null;try{Is=4,Xie(e,t,r,i)}finally{Is=s,_M.transition=n}}function Xie(e,t,r,i){if(S8){var s=_Z(e,t,r,i);if(s===null)vH(e,t,i,E8,r),Jue(e,i);else if(_Be(s,e,t,r,i))i.stopPropagation();else if(Jue(e,i),t&4&&-1<yBe.indexOf(e)){for(;s!==null;){var n=CF(s);if(n!==null&&_Te(n),n=_Z(e,t,r,i),n===null&&vH(e,t,i,E8,r),n===s)break;s=n}s!==null&&i.stopPropagation()}else vH(e,t,i,null,r)}}var E8=null;function _Z(e,t,r,i){if(E8=null,e=Gie(i),e=u2(e),e!==null)if(t=YE(e),t===null)e=null;else if(r=t.tag,r===13){if(e=uTe(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return E8=e,null}function TTe(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(lBe()){case Hie:return 1;case fTe:return 4;case x8:case cBe:return 16;case mTe:return 536870912;default:return 16}default:return 16}}var Ew=null,Yie=null,a6=null;function STe(){if(a6)return a6;var e,t=Yie,r=t.length,i,s="value"in Ew?Ew.value:Ew.textContent,n=s.length;for(e=0;e<r&&t[e]===s[e];e++);var o=r-e;for(i=1;i<=o&&t[r-i]===s[n-i];i++);return a6=s.slice(e,1<i?1-i:void 0)}function l6(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function j4(){return!0}function Que(){return!1}function sp(e){function t(r,i,s,n,o){this._reactName=r,this._targetInst=s,this.type=i,this.nativeEvent=n,this.target=o,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(r=e[a],this[a]=r?r(n):n[a]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?j4:Que,this.isPropagationStopped=Que,this}return so(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=j4)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=j4)},persist:function(){},isPersistent:j4}),t}var bI={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zie=sp(bI),EF=so({},bI,{view:0,detail:0}),xBe=sp(EF),uH,dH,tP,x9=so({},EF,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jie,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==tP&&(tP&&e.type==="mousemove"?(uH=e.screenX-tP.screenX,dH=e.screenY-tP.screenY):dH=uH=0,tP=e),uH)},movementY:function(e){return"movementY"in e?e.movementY:dH}}),ede=sp(x9),TBe=so({},x9,{dataTransfer:0}),SBe=sp(TBe),EBe=so({},EF,{relatedTarget:0}),hH=sp(EBe),CBe=so({},bI,{animationName:0,elapsedTime:0,pseudoElement:0}),ABe=sp(CBe),OBe=so({},bI,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),MBe=sp(OBe),RBe=so({},bI,{data:0}),tde=sp(RBe),IBe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},PBe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$Be={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DBe(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=$Be[e])?!!t[e]:!1}function Jie(){return DBe}var LBe=so({},EF,{key:function(e){if(e.key){var t=IBe[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=l6(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?PBe[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jie,charCode:function(e){return e.type==="keypress"?l6(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?l6(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),NBe=sp(LBe),FBe=so({},x9,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rde=sp(FBe),kBe=so({},EF,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jie}),UBe=sp(kBe),BBe=so({},bI,{propertyName:0,elapsedTime:0,pseudoElement:0}),zBe=sp(BBe),VBe=so({},x9,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),jBe=sp(VBe),GBe=[9,13,27,32],Kie=Nv&&"CompositionEvent"in window,dD=null;Nv&&"documentMode"in document&&(dD=document.documentMode);var HBe=Nv&&"TextEvent"in window&&!dD,ETe=Nv&&(!Kie||dD&&8<dD&&11>=dD),ide=String.fromCharCode(32),sde=!1;function CTe(e,t){switch(e){case"keyup":return GBe.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ATe(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var IO=!1;function qBe(e,t){switch(e){case"compositionend":return ATe(t);case"keypress":return t.which!==32?null:(sde=!0,ide);case"textInput":return e=t.data,e===ide&&sde?null:e;default:return null}}function WBe(e,t){if(IO)return e==="compositionend"||!Kie&&CTe(e,t)?(e=STe(),a6=Yie=Ew=null,IO=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ETe&&t.locale!=="ko"?null:t.data;default:return null}}var XBe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function nde(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!XBe[e.type]:t==="textarea"}function OTe(e,t,r,i){nTe(i),t=C8(t,"onChange"),0<t.length&&(r=new Zie("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var hD=null,PL=null;function YBe(e){UTe(e,0)}function T9(e){var t=DO(e);if(Kxe(t))return e}function ZBe(e,t){if(e==="change")return t}var MTe=!1;if(Nv){var pH;if(Nv){var fH="oninput"in document;if(!fH){var ode=document.createElement("div");ode.setAttribute("oninput","return;"),fH=typeof ode.oninput=="function"}pH=fH}else pH=!1;MTe=pH&&(!document.documentMode||9<document.documentMode)}function ade(){hD&&(hD.detachEvent("onpropertychange",RTe),PL=hD=null)}function RTe(e){if(e.propertyName==="value"&&T9(PL)){var t=[];OTe(t,PL,e,Gie(e)),cTe(YBe,t)}}function JBe(e,t,r){e==="focusin"?(ade(),hD=t,PL=r,hD.attachEvent("onpropertychange",RTe)):e==="focusout"&&ade()}function KBe(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return T9(PL)}function QBe(e,t){if(e==="click")return T9(t)}function e8e(e,t){if(e==="input"||e==="change")return T9(t)}function t8e(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var ag=typeof Object.is=="function"?Object.is:t8e;function $L(e,t){if(ag(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var s=r[i];if(!eZ.call(t,s)||!ag(e[s],t[s]))return!1}return!0}function lde(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cde(e,t){var r=lde(e);e=0;for(var i;r;){if(r.nodeType===3){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lde(r)}}function ITe(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?ITe(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function PTe(){for(var e=window,t=v8();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=v8(e.document)}return t}function Qie(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function r8e(e){var t=PTe(),r=e.focusedElem,i=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&ITe(r.ownerDocument.documentElement,r)){if(i!==null&&Qie(r)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=r.textContent.length,n=Math.min(i.start,s);i=i.end===void 0?n:Math.min(i.end,s),!e.extend&&n>i&&(s=i,i=n,n=s),s=cde(r,n);var o=cde(r,i);s&&o&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),n>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var i8e=Nv&&"documentMode"in document&&11>=document.documentMode,PO=null,vZ=null,pD=null,bZ=!1;function ude(e,t,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;bZ||PO==null||PO!==v8(i)||(i=PO,"selectionStart"in i&&Qie(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),pD&&$L(pD,i)||(pD=i,i=C8(vZ,"onSelect"),0<i.length&&(t=new Zie("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=PO)))}function G4(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var $O={animationend:G4("Animation","AnimationEnd"),animationiteration:G4("Animation","AnimationIteration"),animationstart:G4("Animation","AnimationStart"),transitionend:G4("Transition","TransitionEnd")},mH={},$Te={};Nv&&($Te=document.createElement("div").style,"AnimationEvent"in window||(delete $O.animationend.animation,delete $O.animationiteration.animation,delete $O.animationstart.animation),"TransitionEvent"in window||delete $O.transitionend.transition);function S9(e){if(mH[e])return mH[e];if(!$O[e])return e;var t=$O[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in $Te)return mH[e]=t[r];return e}var DTe=S9("animationend"),LTe=S9("animationiteration"),NTe=S9("animationstart"),FTe=S9("transitionend"),kTe=new Map,dde="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Gx(e,t){kTe.set(e,t),XE(t,[e])}for(var gH=0;gH<dde.length;gH++){var yH=dde[gH],s8e=yH.toLowerCase(),n8e=yH[0].toUpperCase()+yH.slice(1);Gx(s8e,"on"+n8e)}Gx(DTe,"onAnimationEnd");Gx(LTe,"onAnimationIteration");Gx(NTe,"onAnimationStart");Gx("dblclick","onDoubleClick");Gx("focusin","onFocus");Gx("focusout","onBlur");Gx(FTe,"onTransitionEnd");eR("onMouseEnter",["mouseout","mouseover"]);eR("onMouseLeave",["mouseout","mouseover"]);eR("onPointerEnter",["pointerout","pointerover"]);eR("onPointerLeave",["pointerout","pointerover"]);XE("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));XE("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));XE("onBeforeInput",["compositionend","keypress","textInput","paste"]);XE("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));XE("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));XE("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var A3="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),o8e=new Set("cancel close invalid load scroll toggle".split(" ").concat(A3));function hde(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,sBe(i,t,void 0,e),e.currentTarget=null}function UTe(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var i=e[r],s=i.event;i=i.listeners;e:{var n=void 0;if(t)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==n&&s.isPropagationStopped())break e;hde(s,a,c),n=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==n&&s.isPropagationStopped())break e;hde(s,a,c),n=l}}}if(w8)throw e=mZ,w8=!1,mZ=null,e}function vn(e,t){var r=t[EZ];r===void 0&&(r=t[EZ]=new Set);var i=e+"__bubble";r.has(i)||(BTe(t,e,2,!1),r.add(i))}function _H(e,t,r){var i=0;t&&(i|=4),BTe(r,e,i,t)}var H4="_reactListening"+Math.random().toString(36).slice(2);function DL(e){if(!e[H4]){e[H4]=!0,Wxe.forEach(function(r){r!=="selectionchange"&&(o8e.has(r)||_H(r,!1,e),_H(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[H4]||(t[H4]=!0,_H("selectionchange",!1,t))}}function BTe(e,t,r,i){switch(TTe(t)){case 1:var s=bBe;break;case 4:s=wBe;break;default:s=Xie}r=s.bind(null,t,r,e),s=void 0,!fZ||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),i?s!==void 0?e.addEventListener(t,r,{capture:!0,passive:s}):e.addEventListener(t,r,!0):s!==void 0?e.addEventListener(t,r,{passive:s}):e.addEventListener(t,r,!1)}function vH(e,t,r,i,s){var n=i;if((t&1)===0&&(t&2)===0&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=u2(a),o===null)return;if(l=o.tag,l===5||l===6){i=n=o;continue e}a=a.parentNode}}i=i.return}cTe(function(){var c=n,d=Gie(r),p=[];e:{var f=kTe.get(e);if(f!==void 0){var m=Zie,g=e;switch(e){case"keypress":if(l6(r)===0)break e;case"keydown":case"keyup":m=NBe;break;case"focusin":g="focus",m=hH;break;case"focusout":g="blur",m=hH;break;case"beforeblur":case"afterblur":m=hH;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=ede;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=SBe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=UBe;break;case DTe:case LTe:case NTe:m=ABe;break;case FTe:m=zBe;break;case"scroll":m=xBe;break;case"wheel":m=jBe;break;case"copy":case"cut":case"paste":m=MBe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=rde}var _=(t&4)!==0,x=!_&&e==="scroll",b=_?f!==null?f+"Capture":null:f;_=[];for(var w=c,T;w!==null;){T=w;var E=T.stateNode;if(T.tag===5&&E!==null&&(T=E,b!==null&&(E=OL(w,b),E!=null&&_.push(LL(w,E,T)))),x)break;w=w.return}0<_.length&&(f=new m(f,g,null,r,d),p.push({event:f,listeners:_}))}}if((t&7)===0){e:{if(f=e==="mouseover"||e==="pointerover",m=e==="mouseout"||e==="pointerout",f&&r!==hZ&&(g=r.relatedTarget||r.fromElement)&&(u2(g)||g[Fv]))break e;if((m||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,m?(g=r.relatedTarget||r.toElement,m=c,g=g?u2(g):null,g!==null&&(x=YE(g),g!==x||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=c),m!==g)){if(_=ede,E="onMouseLeave",b="onMouseEnter",w="mouse",(e==="pointerout"||e==="pointerover")&&(_=rde,E="onPointerLeave",b="onPointerEnter",w="pointer"),x=m==null?f:DO(m),T=g==null?f:DO(g),f=new _(E,w+"leave",m,r,d),f.target=x,f.relatedTarget=T,E=null,u2(d)===c&&(_=new _(b,w+"enter",g,r,d),_.target=T,_.relatedTarget=x,E=_),x=E,m&&g)t:{for(_=m,b=g,w=0,T=_;T;T=gC(T))w++;for(T=0,E=b;E;E=gC(E))T++;for(;0<w-T;)_=gC(_),w--;for(;0<T-w;)b=gC(b),T--;for(;w--;){if(_===b||b!==null&&_===b.alternate)break t;_=gC(_),b=gC(b)}_=null}else _=null;m!==null&&pde(p,f,m,_,!1),g!==null&&x!==null&&pde(p,x,g,_,!0)}}e:{if(f=c?DO(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var O=ZBe;else if(nde(f))if(MTe)O=e8e;else{O=KBe;var A=JBe}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(O=QBe);if(O&&(O=O(e,c))){OTe(p,O,r,d);break e}A&&A(e,f,c),e==="focusout"&&(A=f._wrapperState)&&A.controlled&&f.type==="number"&&aZ(f,"number",f.value)}switch(A=c?DO(c):window,e){case"focusin":(nde(A)||A.contentEditable==="true")&&(PO=A,vZ=c,pD=null);break;case"focusout":pD=vZ=PO=null;break;case"mousedown":bZ=!0;break;case"contextmenu":case"mouseup":case"dragend":bZ=!1,ude(p,r,d);break;case"selectionchange":if(i8e)break;case"keydown":case"keyup":ude(p,r,d)}var R;if(Kie)e:{switch(e){case"compositionstart":var D="onCompositionStart";break e;case"compositionend":D="onCompositionEnd";break e;case"compositionupdate":D="onCompositionUpdate";break e}D=void 0}else IO?CTe(e,r)&&(D="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(D="onCompositionStart");D&&(ETe&&r.locale!=="ko"&&(IO||D!=="onCompositionStart"?D==="onCompositionEnd"&&IO&&(R=STe()):(Ew=d,Yie="value"in Ew?Ew.value:Ew.textContent,IO=!0)),A=C8(c,D),0<A.length&&(D=new tde(D,e,null,r,d),p.push({event:D,listeners:A}),R?D.data=R:(R=ATe(r),R!==null&&(D.data=R)))),(R=HBe?qBe(e,r):WBe(e,r))&&(c=C8(c,"onBeforeInput"),0<c.length&&(d=new tde("onBeforeInput","beforeinput",null,r,d),p.push({event:d,listeners:c}),d.data=R))}UTe(p,t)})}function LL(e,t,r){return{instance:e,listener:t,currentTarget:r}}function C8(e,t){for(var r=t+"Capture",i=[];e!==null;){var s=e,n=s.stateNode;s.tag===5&&n!==null&&(s=n,n=OL(e,r),n!=null&&i.unshift(LL(e,n,s)),n=OL(e,t),n!=null&&i.push(LL(e,n,s))),e=e.return}return i}function gC(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function pde(e,t,r,i,s){for(var n=t._reactName,o=[];r!==null&&r!==i;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,s?(l=OL(r,n),l!=null&&o.unshift(LL(r,l,a))):s||(l=OL(r,n),l!=null&&o.push(LL(r,l,a)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var a8e=/\r\n?/g,l8e=/\u0000|\uFFFD/g;function fde(e){return(typeof e=="string"?e:""+e).replace(a8e,`
`).replace(l8e,"")}function q4(e,t,r){if(t=fde(t),fde(e)!==t&&r)throw Error(ze(425))}function A8(){}var wZ=null,xZ=null;function TZ(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var SZ=typeof setTimeout=="function"?setTimeout:void 0,c8e=typeof clearTimeout=="function"?clearTimeout:void 0,mde=typeof Promise=="function"?Promise:void 0,u8e=typeof queueMicrotask=="function"?queueMicrotask:typeof mde<"u"?function(e){return mde.resolve(null).then(e).catch(d8e)}:SZ;function d8e(e){setTimeout(function(){throw e})}function bH(e,t){var r=t,i=0;do{var s=r.nextSibling;if(e.removeChild(r),s&&s.nodeType===8)if(r=s.data,r==="/$"){if(i===0){e.removeChild(s),IL(t);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=s}while(r);IL(t)}function Qw(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function gde(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var wI=Math.random().toString(36).slice(2),zy="__reactFiber$"+wI,NL="__reactProps$"+wI,Fv="__reactContainer$"+wI,EZ="__reactEvents$"+wI,h8e="__reactListeners$"+wI,p8e="__reactHandles$"+wI;function u2(e){var t=e[zy];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Fv]||r[zy]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=gde(e);e!==null;){if(r=e[zy])return r;e=gde(e)}return t}e=r,r=e.parentNode}return null}function CF(e){return e=e[zy]||e[Fv],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function DO(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ze(33))}function E9(e){return e[NL]||null}var CZ=[],LO=-1;function Hx(e){return{current:e}}function In(e){0>LO||(e.current=CZ[LO],CZ[LO]=null,LO--)}function hn(e,t){LO++,CZ[LO]=e.current,e.current=t}var fx={},Dc=Hx(fx),Ad=Hx(!1),Y2=fx;function tR(e,t){var r=e.type.contextTypes;if(!r)return fx;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var s={},n;for(n in r)s[n]=t[n];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Od(e){return e=e.childContextTypes,e!=null}function O8(){In(Ad),In(Dc)}function yde(e,t,r){if(Dc.current!==fx)throw Error(ze(168));hn(Dc,t),hn(Ad,r)}function zTe(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var s in i)if(!(s in t))throw Error(ze(108,J6e(e)||"Unknown",s));return so({},r,i)}function M8(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||fx,Y2=Dc.current,hn(Dc,e),hn(Ad,Ad.current),!0}function _de(e,t,r){var i=e.stateNode;if(!i)throw Error(ze(169));r?(e=zTe(e,t,Y2),i.__reactInternalMemoizedMergedChildContext=e,In(Ad),In(Dc),hn(Dc,e)):In(Ad),hn(Ad,r)}var tv=null,C9=!1,wH=!1;function VTe(e){tv===null?tv=[e]:tv.push(e)}function f8e(e){C9=!0,VTe(e)}function qx(){if(!wH&&tv!==null){wH=!0;var e=0,t=Is;try{var r=tv;for(Is=1;e<r.length;e++){var i=r[e];do i=i(!0);while(i!==null)}tv=null,C9=!1}catch(s){throw tv!==null&&(tv=tv.slice(e+1)),pTe(Hie,qx),s}finally{Is=t,wH=!1}}return null}var NO=[],FO=0,R8=null,I8=0,Hp=[],qp=0,Z2=null,hv=1,pv="";function WT(e,t){NO[FO++]=I8,NO[FO++]=R8,R8=e,I8=t}function jTe(e,t,r){Hp[qp++]=hv,Hp[qp++]=pv,Hp[qp++]=Z2,Z2=e;var i=hv;e=pv;var s=32-Qm(i)-1;i&=~(1<<s),r+=1;var n=32-Qm(t)+s;if(30<n){var o=s-s%5;n=(i&(1<<o)-1).toString(32),i>>=o,s-=o,hv=1<<32-Qm(t)+s|r<<s|i,pv=n+e}else hv=1<<n|r<<s|i,pv=e}function ese(e){e.return!==null&&(WT(e,1),jTe(e,1,0))}function tse(e){for(;e===R8;)R8=NO[--FO],NO[FO]=null,I8=NO[--FO],NO[FO]=null;for(;e===Z2;)Z2=Hp[--qp],Hp[qp]=null,pv=Hp[--qp],Hp[qp]=null,hv=Hp[--qp],Hp[qp]=null}var Bh=null,Nh=null,Vn=!1,Dm=null;function GTe(e,t){var r=of(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function vde(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Bh=e,Nh=Qw(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Bh=e,Nh=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Z2!==null?{id:hv,overflow:pv}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=of(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Bh=e,Nh=null,!0):!1;default:return!1}}function AZ(e){return(e.mode&1)!==0&&(e.flags&128)===0}function OZ(e){if(Vn){var t=Nh;if(t){var r=t;if(!vde(e,t)){if(AZ(e))throw Error(ze(418));t=Qw(r.nextSibling);var i=Bh;t&&vde(e,t)?GTe(i,r):(e.flags=e.flags&-4097|2,Vn=!1,Bh=e)}}else{if(AZ(e))throw Error(ze(418));e.flags=e.flags&-4097|2,Vn=!1,Bh=e}}}function bde(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Bh=e}function W4(e){if(e!==Bh)return!1;if(!Vn)return bde(e),Vn=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!TZ(e.type,e.memoizedProps)),t&&(t=Nh)){if(AZ(e))throw HTe(),Error(ze(418));for(;t;)GTe(e,t),t=Qw(t.nextSibling)}if(bde(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ze(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Nh=Qw(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Nh=null}}else Nh=Bh?Qw(e.stateNode.nextSibling):null;return!0}function HTe(){for(var e=Nh;e;)e=Qw(e.nextSibling)}function rR(){Nh=Bh=null,Vn=!1}function rse(e){Dm===null?Dm=[e]:Dm.push(e)}var m8e=s1.ReactCurrentBatchConfig;function Tm(e,t){if(e&&e.defaultProps){t=so({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var P8=Hx(null),$8=null,kO=null,ise=null;function sse(){ise=kO=$8=null}function nse(e){var t=P8.current;In(P8),e._currentValue=t}function MZ(e,t,r){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function vM(e,t){$8=e,ise=kO=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(xd=!0),e.firstContext=null)}function yf(e){var t=e._currentValue;if(ise!==e)if(e={context:e,memoizedValue:t,next:null},kO===null){if($8===null)throw Error(ze(308));kO=e,$8.dependencies={lanes:0,firstContext:e}}else kO=kO.next=e;return t}var d2=null;function ose(e){d2===null?d2=[e]:d2.push(e)}function qTe(e,t,r,i){var s=t.interleaved;return s===null?(r.next=r,ose(t)):(r.next=s.next,s.next=r),t.interleaved=r,kv(e,i)}function kv(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var ew=!1;function ase(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function WTe(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function bv(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ex(e,t,r){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,(Wi&2)!==0){var s=i.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),i.pending=t,kv(e,r)}return s=i.interleaved,s===null?(t.next=t,ose(i)):(t.next=s.next,s.next=t),i.interleaved=t,kv(e,r)}function c6(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,qie(e,r)}}function wde(e,t){var r=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var s=null,n=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};n===null?s=n=o:n=n.next=o,r=r.next}while(r!==null);n===null?s=n=t:n=n.next=t}else s=n=t;r={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:n,shared:i.shared,effects:i.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function D8(e,t,r,i){var s=e.updateQueue;ew=!1;var n=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?n=c:o.next=c,o=l;var d=e.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=c:a.next=c,d.lastBaseUpdate=l))}if(n!==null){var p=s.baseState;o=0,d=c=l=null,a=n;do{var f=a.lane,m=a.eventTime;if((i&f)===f){d!==null&&(d=d.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=e,_=a;switch(f=t,m=r,_.tag){case 1:if(g=_.payload,typeof g=="function"){p=g.call(m,p,f);break e}p=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=_.payload,f=typeof g=="function"?g.call(m,p,f):g,f==null)break e;p=so({},p,f);break e;case 2:ew=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(c=d=m,l=p):d=d.next=m,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(1);if(d===null&&(l=p),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=d,t=s.shared.interleaved,t!==null){s=t;do o|=s.lane,s=s.next;while(s!==t)}else n===null&&(s.shared.lanes=0);K2|=o,e.lanes=o,e.memoizedState=p}}function xde(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],s=i.callback;if(s!==null){if(i.callback=null,i=r,typeof s!="function")throw Error(ze(191,s));s.call(i)}}}var XTe=new qxe.Component().refs;function RZ(e,t,r,i){t=e.memoizedState,r=r(i,t),r=r==null?t:so({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var A9={isMounted:function(e){return(e=e._reactInternals)?YE(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=Tu(),s=rx(e),n=bv(i,s);n.payload=t,r!=null&&(n.callback=r),t=ex(e,n,s),t!==null&&(eg(t,e,s,i),c6(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=Tu(),s=rx(e),n=bv(i,s);n.tag=1,n.payload=t,r!=null&&(n.callback=r),t=ex(e,n,s),t!==null&&(eg(t,e,s,i),c6(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Tu(),i=rx(e),s=bv(r,i);s.tag=2,t!=null&&(s.callback=t),t=ex(e,s,i),t!==null&&(eg(t,e,i,r),c6(t,e,i))}};function Tde(e,t,r,i,s,n,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,n,o):t.prototype&&t.prototype.isPureReactComponent?!$L(r,i)||!$L(s,n):!0}function YTe(e,t,r){var i=!1,s=fx,n=t.contextType;return typeof n=="object"&&n!==null?n=yf(n):(s=Od(t)?Y2:Dc.current,i=t.contextTypes,n=(i=i!=null)?tR(e,s):fx),t=new t(r,n),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=A9,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=n),t}function Sde(e,t,r,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&A9.enqueueReplaceState(t,t.state,null)}function IZ(e,t,r,i){var s=e.stateNode;s.props=r,s.state=e.memoizedState,s.refs=XTe,ase(e);var n=t.contextType;typeof n=="object"&&n!==null?s.context=yf(n):(n=Od(t)?Y2:Dc.current,s.context=tR(e,n)),s.state=e.memoizedState,n=t.getDerivedStateFromProps,typeof n=="function"&&(RZ(e,t,n,r),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&A9.enqueueReplaceState(s,s.state,null),D8(e,r,s,i),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function rP(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(ze(309));var i=r.stateNode}if(!i)throw Error(ze(147,e));var s=i,n=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===n?t.ref:(t=function(o){var a=s.refs;a===XTe&&(a=s.refs={}),o===null?delete a[n]:a[n]=o},t._stringRef=n,t)}if(typeof e!="string")throw Error(ze(284));if(!r._owner)throw Error(ze(290,e))}return e}function X4(e,t){throw e=Object.prototype.toString.call(t),Error(ze(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ede(e){var t=e._init;return t(e._payload)}function ZTe(e){function t(b,w){if(e){var T=b.deletions;T===null?(b.deletions=[w],b.flags|=16):T.push(w)}}function r(b,w){if(!e)return null;for(;w!==null;)t(b,w),w=w.sibling;return null}function i(b,w){for(b=new Map;w!==null;)w.key!==null?b.set(w.key,w):b.set(w.index,w),w=w.sibling;return b}function s(b,w){return b=ix(b,w),b.index=0,b.sibling=null,b}function n(b,w,T){return b.index=T,e?(T=b.alternate,T!==null?(T=T.index,T<w?(b.flags|=2,w):T):(b.flags|=2,w)):(b.flags|=1048576,w)}function o(b){return e&&b.alternate===null&&(b.flags|=2),b}function a(b,w,T,E){return w===null||w.tag!==6?(w=OH(T,b.mode,E),w.return=b,w):(w=s(w,T),w.return=b,w)}function l(b,w,T,E){var O=T.type;return O===RO?d(b,w,T.props.children,E,T.key):w!==null&&(w.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===Qb&&Ede(O)===w.type)?(E=s(w,T.props),E.ref=rP(b,w,T),E.return=b,E):(E=m6(T.type,T.key,T.props,null,b.mode,E),E.ref=rP(b,w,T),E.return=b,E)}function c(b,w,T,E){return w===null||w.tag!==4||w.stateNode.containerInfo!==T.containerInfo||w.stateNode.implementation!==T.implementation?(w=MH(T,b.mode,E),w.return=b,w):(w=s(w,T.children||[]),w.return=b,w)}function d(b,w,T,E,O){return w===null||w.tag!==7?(w=$2(T,b.mode,E,O),w.return=b,w):(w=s(w,T),w.return=b,w)}function p(b,w,T){if(typeof w=="string"&&w!==""||typeof w=="number")return w=OH(""+w,b.mode,T),w.return=b,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case F4:return T=m6(w.type,w.key,w.props,null,b.mode,T),T.ref=rP(b,null,w),T.return=b,T;case MO:return w=MH(w,b.mode,T),w.return=b,w;case Qb:var E=w._init;return p(b,E(w._payload),T)}if(E3(w)||JI(w))return w=$2(w,b.mode,T,null),w.return=b,w;X4(b,w)}return null}function f(b,w,T,E){var O=w!==null?w.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return O!==null?null:a(b,w,""+T,E);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case F4:return T.key===O?l(b,w,T,E):null;case MO:return T.key===O?c(b,w,T,E):null;case Qb:return O=T._init,f(b,w,O(T._payload),E)}if(E3(T)||JI(T))return O!==null?null:d(b,w,T,E,null);X4(b,T)}return null}function m(b,w,T,E,O){if(typeof E=="string"&&E!==""||typeof E=="number")return b=b.get(T)||null,a(w,b,""+E,O);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case F4:return b=b.get(E.key===null?T:E.key)||null,l(w,b,E,O);case MO:return b=b.get(E.key===null?T:E.key)||null,c(w,b,E,O);case Qb:var A=E._init;return m(b,w,T,A(E._payload),O)}if(E3(E)||JI(E))return b=b.get(T)||null,d(w,b,E,O,null);X4(w,E)}return null}function g(b,w,T,E){for(var O=null,A=null,R=w,D=w=0,k=null;R!==null&&D<T.length;D++){R.index>D?(k=R,R=null):k=R.sibling;var L=f(b,R,T[D],E);if(L===null){R===null&&(R=k);break}e&&R&&L.alternate===null&&t(b,R),w=n(L,w,D),A===null?O=L:A.sibling=L,A=L,R=k}if(D===T.length)return r(b,R),Vn&&WT(b,D),O;if(R===null){for(;D<T.length;D++)R=p(b,T[D],E),R!==null&&(w=n(R,w,D),A===null?O=R:A.sibling=R,A=R);return Vn&&WT(b,D),O}for(R=i(b,R);D<T.length;D++)k=m(R,b,D,T[D],E),k!==null&&(e&&k.alternate!==null&&R.delete(k.key===null?D:k.key),w=n(k,w,D),A===null?O=k:A.sibling=k,A=k);return e&&R.forEach(function(q){return t(b,q)}),Vn&&WT(b,D),O}function _(b,w,T,E){var O=JI(T);if(typeof O!="function")throw Error(ze(150));if(T=O.call(T),T==null)throw Error(ze(151));for(var A=O=null,R=w,D=w=0,k=null,L=T.next();R!==null&&!L.done;D++,L=T.next()){R.index>D?(k=R,R=null):k=R.sibling;var q=f(b,R,L.value,E);if(q===null){R===null&&(R=k);break}e&&R&&q.alternate===null&&t(b,R),w=n(q,w,D),A===null?O=q:A.sibling=q,A=q,R=k}if(L.done)return r(b,R),Vn&&WT(b,D),O;if(R===null){for(;!L.done;D++,L=T.next())L=p(b,L.value,E),L!==null&&(w=n(L,w,D),A===null?O=L:A.sibling=L,A=L);return Vn&&WT(b,D),O}for(R=i(b,R);!L.done;D++,L=T.next())L=m(R,b,D,L.value,E),L!==null&&(e&&L.alternate!==null&&R.delete(L.key===null?D:L.key),w=n(L,w,D),A===null?O=L:A.sibling=L,A=L);return e&&R.forEach(function(G){return t(b,G)}),Vn&&WT(b,D),O}function x(b,w,T,E){if(typeof T=="object"&&T!==null&&T.type===RO&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case F4:e:{for(var O=T.key,A=w;A!==null;){if(A.key===O){if(O=T.type,O===RO){if(A.tag===7){r(b,A.sibling),w=s(A,T.props.children),w.return=b,b=w;break e}}else if(A.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===Qb&&Ede(O)===A.type){r(b,A.sibling),w=s(A,T.props),w.ref=rP(b,A,T),w.return=b,b=w;break e}r(b,A);break}else t(b,A);A=A.sibling}T.type===RO?(w=$2(T.props.children,b.mode,E,T.key),w.return=b,b=w):(E=m6(T.type,T.key,T.props,null,b.mode,E),E.ref=rP(b,w,T),E.return=b,b=E)}return o(b);case MO:e:{for(A=T.key;w!==null;){if(w.key===A)if(w.tag===4&&w.stateNode.containerInfo===T.containerInfo&&w.stateNode.implementation===T.implementation){r(b,w.sibling),w=s(w,T.children||[]),w.return=b,b=w;break e}else{r(b,w);break}else t(b,w);w=w.sibling}w=MH(T,b.mode,E),w.return=b,b=w}return o(b);case Qb:return A=T._init,x(b,w,A(T._payload),E)}if(E3(T))return g(b,w,T,E);if(JI(T))return _(b,w,T,E);X4(b,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,w!==null&&w.tag===6?(r(b,w.sibling),w=s(w,T),w.return=b,b=w):(r(b,w),w=OH(T,b.mode,E),w.return=b,b=w),o(b)):r(b,w)}return x}var iR=ZTe(!0),JTe=ZTe(!1),AF={},s0=Hx(AF),FL=Hx(AF),kL=Hx(AF);function h2(e){if(e===AF)throw Error(ze(174));return e}function lse(e,t){switch(hn(kL,t),hn(FL,e),hn(s0,AF),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:cZ(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=cZ(t,e)}In(s0),hn(s0,t)}function sR(){In(s0),In(FL),In(kL)}function KTe(e){h2(kL.current);var t=h2(s0.current),r=cZ(t,e.type);t!==r&&(hn(FL,e),hn(s0,r))}function cse(e){FL.current===e&&(In(s0),In(FL))}var Qn=Hx(0);function L8(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var xH=[];function use(){for(var e=0;e<xH.length;e++)xH[e]._workInProgressVersionPrimary=null;xH.length=0}var u6=s1.ReactCurrentDispatcher,TH=s1.ReactCurrentBatchConfig,J2=0,io=null,La=null,ll=null,N8=!1,fD=!1,UL=0,g8e=0;function Kl(){throw Error(ze(321))}function dse(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!ag(e[r],t[r]))return!1;return!0}function hse(e,t,r,i,s,n){if(J2=n,io=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,u6.current=e===null||e.memoizedState===null?b8e:w8e,e=r(i,s),fD){n=0;do{if(fD=!1,UL=0,25<=n)throw Error(ze(301));n+=1,ll=La=null,t.updateQueue=null,u6.current=x8e,e=r(i,s)}while(fD)}if(u6.current=F8,t=La!==null&&La.next!==null,J2=0,ll=La=io=null,N8=!1,t)throw Error(ze(300));return e}function pse(){var e=UL!==0;return UL=0,e}function My(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ll===null?io.memoizedState=ll=e:ll=ll.next=e,ll}function _f(){if(La===null){var e=io.alternate;e=e!==null?e.memoizedState:null}else e=La.next;var t=ll===null?io.memoizedState:ll.next;if(t!==null)ll=t,La=e;else{if(e===null)throw Error(ze(310));La=e,e={memoizedState:La.memoizedState,baseState:La.baseState,baseQueue:La.baseQueue,queue:La.queue,next:null},ll===null?io.memoizedState=ll=e:ll=ll.next=e}return ll}function BL(e,t){return typeof t=="function"?t(e):t}function SH(e){var t=_f(),r=t.queue;if(r===null)throw Error(ze(311));r.lastRenderedReducer=e;var i=La,s=i.baseQueue,n=r.pending;if(n!==null){if(s!==null){var o=s.next;s.next=n.next,n.next=o}i.baseQueue=s=n,r.pending=null}if(s!==null){n=s.next,i=i.baseState;var a=o=null,l=null,c=n;do{var d=c.lane;if((J2&d)===d)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:e(i,c.action);else{var p={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=p,o=i):l=l.next=p,io.lanes|=d,K2|=d}c=c.next}while(c!==null&&c!==n);l===null?o=i:l.next=a,ag(i,t.memoizedState)||(xd=!0),t.memoizedState=i,t.baseState=o,t.baseQueue=l,r.lastRenderedState=i}if(e=r.interleaved,e!==null){s=e;do n=s.lane,io.lanes|=n,K2|=n,s=s.next;while(s!==e)}else s===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function EH(e){var t=_f(),r=t.queue;if(r===null)throw Error(ze(311));r.lastRenderedReducer=e;var i=r.dispatch,s=r.pending,n=t.memoizedState;if(s!==null){r.pending=null;var o=s=s.next;do n=e(n,o.action),o=o.next;while(o!==s);ag(n,t.memoizedState)||(xd=!0),t.memoizedState=n,t.baseQueue===null&&(t.baseState=n),r.lastRenderedState=n}return[n,i]}function QTe(){}function eSe(e,t){var r=io,i=_f(),s=t(),n=!ag(i.memoizedState,s);if(n&&(i.memoizedState=s,xd=!0),i=i.queue,fse(iSe.bind(null,r,i,e),[e]),i.getSnapshot!==t||n||ll!==null&&ll.memoizedState.tag&1){if(r.flags|=2048,zL(9,rSe.bind(null,r,i,s,t),void 0,null),pl===null)throw Error(ze(349));(J2&30)!==0||tSe(r,t,s)}return s}function tSe(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=io.updateQueue,t===null?(t={lastEffect:null,stores:null},io.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function rSe(e,t,r,i){t.value=r,t.getSnapshot=i,sSe(t)&&nSe(e)}function iSe(e,t,r){return r(function(){sSe(t)&&nSe(e)})}function sSe(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!ag(e,r)}catch{return!0}}function nSe(e){var t=kv(e,1);t!==null&&eg(t,e,1,-1)}function Cde(e){var t=My();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:BL,lastRenderedState:e},t.queue=e,e=e.dispatch=v8e.bind(null,io,e),[t.memoizedState,e]}function zL(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},t=io.updateQueue,t===null?(t={lastEffect:null,stores:null},io.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e)),e}function oSe(){return _f().memoizedState}function d6(e,t,r,i){var s=My();io.flags|=e,s.memoizedState=zL(1|t,r,void 0,i===void 0?null:i)}function O9(e,t,r,i){var s=_f();i=i===void 0?null:i;var n=void 0;if(La!==null){var o=La.memoizedState;if(n=o.destroy,i!==null&&dse(i,o.deps)){s.memoizedState=zL(t,r,n,i);return}}io.flags|=e,s.memoizedState=zL(1|t,r,n,i)}function Ade(e,t){return d6(8390656,8,e,t)}function fse(e,t){return O9(2048,8,e,t)}function aSe(e,t){return O9(4,2,e,t)}function lSe(e,t){return O9(4,4,e,t)}function cSe(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function uSe(e,t,r){return r=r!=null?r.concat([e]):null,O9(4,4,cSe.bind(null,t,e),r)}function mse(){}function dSe(e,t){var r=_f();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&dse(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function hSe(e,t){var r=_f();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&dse(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function pSe(e,t,r){return(J2&21)===0?(e.baseState&&(e.baseState=!1,xd=!0),e.memoizedState=r):(ag(r,t)||(r=gTe(),io.lanes|=r,K2|=r,e.baseState=!0),t)}function y8e(e,t){var r=Is;Is=r!==0&&4>r?r:4,e(!0);var i=TH.transition;TH.transition={};try{e(!1),t()}finally{Is=r,TH.transition=i}}function fSe(){return _f().memoizedState}function _8e(e,t,r){var i=rx(e);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},mSe(e))gSe(t,r);else if(r=qTe(e,t,r,i),r!==null){var s=Tu();eg(r,e,i,s),ySe(r,t,i)}}function v8e(e,t,r){var i=rx(e),s={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(mSe(e))gSe(t,s);else{var n=e.alternate;if(e.lanes===0&&(n===null||n.lanes===0)&&(n=t.lastRenderedReducer,n!==null))try{var o=t.lastRenderedState,a=n(o,r);if(s.hasEagerState=!0,s.eagerState=a,ag(a,o)){var l=t.interleaved;l===null?(s.next=s,ose(t)):(s.next=l.next,l.next=s),t.interleaved=s;return}}catch{}finally{}r=qTe(e,t,s,i),r!==null&&(s=Tu(),eg(r,e,i,s),ySe(r,t,i))}}function mSe(e){var t=e.alternate;return e===io||t!==null&&t===io}function gSe(e,t){fD=N8=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function ySe(e,t,r){if((r&4194240)!==0){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,qie(e,r)}}var F8={readContext:yf,useCallback:Kl,useContext:Kl,useEffect:Kl,useImperativeHandle:Kl,useInsertionEffect:Kl,useLayoutEffect:Kl,useMemo:Kl,useReducer:Kl,useRef:Kl,useState:Kl,useDebugValue:Kl,useDeferredValue:Kl,useTransition:Kl,useMutableSource:Kl,useSyncExternalStore:Kl,useId:Kl,unstable_isNewReconciler:!1},b8e={readContext:yf,useCallback:function(e,t){return My().memoizedState=[e,t===void 0?null:t],e},useContext:yf,useEffect:Ade,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,d6(4194308,4,cSe.bind(null,t,e),r)},useLayoutEffect:function(e,t){return d6(4194308,4,e,t)},useInsertionEffect:function(e,t){return d6(4,2,e,t)},useMemo:function(e,t){var r=My();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=My();return t=r!==void 0?r(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=_8e.bind(null,io,e),[i.memoizedState,e]},useRef:function(e){var t=My();return e={current:e},t.memoizedState=e},useState:Cde,useDebugValue:mse,useDeferredValue:function(e){return My().memoizedState=e},useTransition:function(){var e=Cde(!1),t=e[0];return e=y8e.bind(null,e[1]),My().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=io,s=My();if(Vn){if(r===void 0)throw Error(ze(407));r=r()}else{if(r=t(),pl===null)throw Error(ze(349));(J2&30)!==0||tSe(i,t,r)}s.memoizedState=r;var n={value:r,getSnapshot:t};return s.queue=n,Ade(iSe.bind(null,i,n,e),[e]),i.flags|=2048,zL(9,rSe.bind(null,i,n,r,t),void 0,null),r},useId:function(){var e=My(),t=pl.identifierPrefix;if(Vn){var r=pv,i=hv;r=(i&~(1<<32-Qm(i)-1)).toString(32)+r,t=":"+t+"R"+r,r=UL++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=g8e++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},w8e={readContext:yf,useCallback:dSe,useContext:yf,useEffect:fse,useImperativeHandle:uSe,useInsertionEffect:aSe,useLayoutEffect:lSe,useMemo:hSe,useReducer:SH,useRef:oSe,useState:function(){return SH(BL)},useDebugValue:mse,useDeferredValue:function(e){var t=_f();return pSe(t,La.memoizedState,e)},useTransition:function(){var e=SH(BL)[0],t=_f().memoizedState;return[e,t]},useMutableSource:QTe,useSyncExternalStore:eSe,useId:fSe,unstable_isNewReconciler:!1},x8e={readContext:yf,useCallback:dSe,useContext:yf,useEffect:fse,useImperativeHandle:uSe,useInsertionEffect:aSe,useLayoutEffect:lSe,useMemo:hSe,useReducer:EH,useRef:oSe,useState:function(){return EH(BL)},useDebugValue:mse,useDeferredValue:function(e){var t=_f();return La===null?t.memoizedState=e:pSe(t,La.memoizedState,e)},useTransition:function(){var e=EH(BL)[0],t=_f().memoizedState;return[e,t]},useMutableSource:QTe,useSyncExternalStore:eSe,useId:fSe,unstable_isNewReconciler:!1};function nR(e,t){try{var r="",i=t;do r+=Z6e(i),i=i.return;while(i);var s=r}catch(n){s=`
Error generating stack: `+n.message+`
`+n.stack}return{value:e,source:t,stack:s,digest:null}}function CH(e,t,r){return{value:e,source:null,stack:r!=null?r:null,digest:t!=null?t:null}}function PZ(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var T8e=typeof WeakMap=="function"?WeakMap:Map;function _Se(e,t,r){r=bv(-1,r),r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){U8||(U8=!0,VZ=i),PZ(e,t)},r}function vSe(e,t,r){r=bv(-1,r),r.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var s=t.value;r.payload=function(){return i(s)},r.callback=function(){PZ(e,t)}}var n=e.stateNode;return n!==null&&typeof n.componentDidCatch=="function"&&(r.callback=function(){PZ(e,t),typeof i!="function"&&(tx===null?tx=new Set([this]):tx.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function Ode(e,t,r){var i=e.pingCache;if(i===null){i=e.pingCache=new T8e;var s=new Set;i.set(t,s)}else s=i.get(t),s===void 0&&(s=new Set,i.set(t,s));s.has(r)||(s.add(r),e=F8e.bind(null,e,t,r),t.then(e,e))}function Mde(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Rde(e,t,r,i,s){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=bv(-1,1),t.tag=2,ex(r,t,1))),r.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var S8e=s1.ReactCurrentOwner,xd=!1;function uu(e,t,r,i){t.child=e===null?JTe(t,null,r,i):iR(t,e.child,r,i)}function Ide(e,t,r,i,s){r=r.render;var n=t.ref;return vM(t,s),i=hse(e,t,r,i,n,s),r=pse(),e!==null&&!xd?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Uv(e,t,s)):(Vn&&r&&ese(t),t.flags|=1,uu(e,t,i,s),t.child)}function Pde(e,t,r,i,s){if(e===null){var n=r.type;return typeof n=="function"&&!Tse(n)&&n.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=n,bSe(e,t,n,i,s)):(e=m6(r.type,null,i,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(n=e.child,(e.lanes&s)===0){var o=n.memoizedProps;if(r=r.compare,r=r!==null?r:$L,r(o,i)&&e.ref===t.ref)return Uv(e,t,s)}return t.flags|=1,e=ix(n,i),e.ref=t.ref,e.return=t,t.child=e}function bSe(e,t,r,i,s){if(e!==null){var n=e.memoizedProps;if($L(n,i)&&e.ref===t.ref)if(xd=!1,t.pendingProps=i=n,(e.lanes&s)!==0)(e.flags&131072)!==0&&(xd=!0);else return t.lanes=e.lanes,Uv(e,t,s)}return $Z(e,t,r,i,s)}function wSe(e,t,r){var i=t.pendingProps,s=i.children,n=e!==null?e.memoizedState:null;if(i.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},hn(BO,yh),yh|=r;else{if((r&1073741824)===0)return e=n!==null?n.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,hn(BO,yh),yh|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=n!==null?n.baseLanes:r,hn(BO,yh),yh|=i}else n!==null?(i=n.baseLanes|r,t.memoizedState=null):i=r,hn(BO,yh),yh|=i;return uu(e,t,s,r),t.child}function xSe(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function $Z(e,t,r,i,s){var n=Od(r)?Y2:Dc.current;return n=tR(t,n),vM(t,s),r=hse(e,t,r,i,n,s),i=pse(),e!==null&&!xd?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Uv(e,t,s)):(Vn&&i&&ese(t),t.flags|=1,uu(e,t,r,s),t.child)}function $de(e,t,r,i,s){if(Od(r)){var n=!0;M8(t)}else n=!1;if(vM(t,s),t.stateNode===null)h6(e,t),YTe(t,r,i),IZ(t,r,i,s),i=!0;else if(e===null){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=yf(c):(c=Od(r)?Y2:Dc.current,c=tR(t,c));var d=r.getDerivedStateFromProps,p=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";p||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&Sde(t,o,i,c),ew=!1;var f=t.memoizedState;o.state=f,D8(t,i,o,s),l=t.memoizedState,a!==i||f!==l||Ad.current||ew?(typeof d=="function"&&(RZ(t,r,d,i),l=t.memoizedState),(a=ew||Tde(t,r,a,i,f,l,c))?(p||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,WTe(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:Tm(t.type,a),o.props=c,p=t.pendingProps,f=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=yf(l):(l=Od(r)?Y2:Dc.current,l=tR(t,l));var m=r.getDerivedStateFromProps;(d=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==p||f!==l)&&Sde(t,o,i,l),ew=!1,f=t.memoizedState,o.state=f,D8(t,i,o,s);var g=t.memoizedState;a!==p||f!==g||Ad.current||ew?(typeof m=="function"&&(RZ(t,r,m,i),g=t.memoizedState),(c=ew||Tde(t,r,c,i,f,g,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,g,l)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=g),o.props=i,o.state=g,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),i=!1)}return DZ(e,t,r,i,n,s)}function DZ(e,t,r,i,s,n){xSe(e,t);var o=(t.flags&128)!==0;if(!i&&!o)return s&&_de(t,r,!1),Uv(e,t,n);i=t.stateNode,S8e.current=t;var a=o&&typeof r.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&o?(t.child=iR(t,e.child,null,n),t.child=iR(t,null,a,n)):uu(e,t,a,n),t.memoizedState=i.state,s&&_de(t,r,!0),t.child}function TSe(e){var t=e.stateNode;t.pendingContext?yde(e,t.pendingContext,t.pendingContext!==t.context):t.context&&yde(e,t.context,!1),lse(e,t.containerInfo)}function Dde(e,t,r,i,s){return rR(),rse(s),t.flags|=256,uu(e,t,r,i),t.child}var LZ={dehydrated:null,treeContext:null,retryLane:0};function NZ(e){return{baseLanes:e,cachePool:null,transitions:null}}function SSe(e,t,r){var i=t.pendingProps,s=Qn.current,n=!1,o=(t.flags&128)!==0,a;if((a=o)||(a=e!==null&&e.memoizedState===null?!1:(s&2)!==0),a?(n=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),hn(Qn,s&1),e===null)return OZ(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(o=i.children,e=i.fallback,n?(i=t.mode,n=t.child,o={mode:"hidden",children:o},(i&1)===0&&n!==null?(n.childLanes=0,n.pendingProps=o):n=I9(o,i,0,null),e=$2(e,i,r,null),n.return=t,e.return=t,n.sibling=e,t.child=n,t.child.memoizedState=NZ(r),t.memoizedState=LZ,e):gse(t,o));if(s=e.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return E8e(e,t,o,i,a,s,r);if(n){n=i.fallback,o=t.mode,s=e.child,a=s.sibling;var l={mode:"hidden",children:i.children};return(o&1)===0&&t.child!==s?(i=t.child,i.childLanes=0,i.pendingProps=l,t.deletions=null):(i=ix(s,l),i.subtreeFlags=s.subtreeFlags&14680064),a!==null?n=ix(a,n):(n=$2(n,o,r,null),n.flags|=2),n.return=t,i.return=t,i.sibling=n,t.child=i,i=n,n=t.child,o=e.child.memoizedState,o=o===null?NZ(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},n.memoizedState=o,n.childLanes=e.childLanes&~r,t.memoizedState=LZ,i}return n=e.child,e=n.sibling,i=ix(n,{mode:"visible",children:i.children}),(t.mode&1)===0&&(i.lanes=r),i.return=t,i.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=i,t.memoizedState=null,i}function gse(e,t){return t=I9({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Y4(e,t,r,i){return i!==null&&rse(i),iR(t,e.child,null,r),e=gse(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function E8e(e,t,r,i,s,n,o){if(r)return t.flags&256?(t.flags&=-257,i=CH(Error(ze(422))),Y4(e,t,o,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(n=i.fallback,s=t.mode,i=I9({mode:"visible",children:i.children},s,0,null),n=$2(n,s,o,null),n.flags|=2,i.return=t,n.return=t,i.sibling=n,t.child=i,(t.mode&1)!==0&&iR(t,e.child,null,o),t.child.memoizedState=NZ(o),t.memoizedState=LZ,n);if((t.mode&1)===0)return Y4(e,t,o,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var a=i.dgst;return i=a,n=Error(ze(419)),i=CH(n,i,void 0),Y4(e,t,o,i)}if(a=(o&e.childLanes)!==0,xd||a){if(i=pl,i!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=(s&(i.suspendedLanes|o))!==0?0:s,s!==0&&s!==n.retryLane&&(n.retryLane=s,kv(e,s),eg(i,e,s,-1))}return xse(),i=CH(Error(ze(421))),Y4(e,t,o,i)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=k8e.bind(null,e),s._reactRetry=t,null):(e=n.treeContext,Nh=Qw(s.nextSibling),Bh=t,Vn=!0,Dm=null,e!==null&&(Hp[qp++]=hv,Hp[qp++]=pv,Hp[qp++]=Z2,hv=e.id,pv=e.overflow,Z2=t),t=gse(t,i.children),t.flags|=4096,t)}function Lde(e,t,r){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),MZ(e.return,t,r)}function AH(e,t,r,i,s){var n=e.memoizedState;n===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:s}:(n.isBackwards=t,n.rendering=null,n.renderingStartTime=0,n.last=i,n.tail=r,n.tailMode=s)}function ESe(e,t,r){var i=t.pendingProps,s=i.revealOrder,n=i.tail;if(uu(e,t,i.children,r),i=Qn.current,(i&2)!==0)i=i&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Lde(e,r,t);else if(e.tag===19)Lde(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(hn(Qn,i),(t.mode&1)===0)t.memoizedState=null;else switch(s){case"forwards":for(r=t.child,s=null;r!==null;)e=r.alternate,e!==null&&L8(e)===null&&(s=r),r=r.sibling;r=s,r===null?(s=t.child,t.child=null):(s=r.sibling,r.sibling=null),AH(t,!1,s,r,n);break;case"backwards":for(r=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&L8(e)===null){t.child=s;break}e=s.sibling,s.sibling=r,r=s,s=e}AH(t,!0,r,null,n);break;case"together":AH(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function h6(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Uv(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),K2|=t.lanes,(r&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(ze(153));if(t.child!==null){for(e=t.child,r=ix(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=ix(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function C8e(e,t,r){switch(t.tag){case 3:TSe(t),rR();break;case 5:KTe(t);break;case 1:Od(t.type)&&M8(t);break;case 4:lse(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,s=t.memoizedProps.value;hn(P8,i._currentValue),i._currentValue=s;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(hn(Qn,Qn.current&1),t.flags|=128,null):(r&t.child.childLanes)!==0?SSe(e,t,r):(hn(Qn,Qn.current&1),e=Uv(e,t,r),e!==null?e.sibling:null);hn(Qn,Qn.current&1);break;case 19:if(i=(r&t.childLanes)!==0,(e.flags&128)!==0){if(i)return ESe(e,t,r);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),hn(Qn,Qn.current),i)break;return null;case 22:case 23:return t.lanes=0,wSe(e,t,r)}return Uv(e,t,r)}var CSe,FZ,ASe,OSe;CSe=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};FZ=function(){};ASe=function(e,t,r,i){var s=e.memoizedProps;if(s!==i){e=t.stateNode,h2(s0.current);var n=null;switch(r){case"input":s=nZ(e,s),i=nZ(e,i),n=[];break;case"select":s=so({},s,{value:void 0}),i=so({},i,{value:void 0}),n=[];break;case"textarea":s=lZ(e,s),i=lZ(e,i),n=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=A8)}uZ(r,i);var o;r=null;for(c in s)if(!i.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(CL.hasOwnProperty(c)?n||(n=[]):(n=n||[]).push(c,null));for(c in i){var l=i[c];if(a=s!=null?s[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(n||(n=[]),n.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(n=n||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(n=n||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(CL.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&vn("scroll",e),n||a===l||(n=[])):(n=n||[]).push(c,l))}r&&(n=n||[]).push("style",r);var c=n;(t.updateQueue=c)&&(t.flags|=4)}};OSe=function(e,t,r,i){r!==i&&(t.flags|=4)};function iP(e,t){if(!Vn)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ql(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,i=0;if(t)for(var s=e.child;s!==null;)r|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)r|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}function A8e(e,t,r){var i=t.pendingProps;switch(tse(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ql(t),null;case 1:return Od(t.type)&&O8(),Ql(t),null;case 3:return i=t.stateNode,sR(),In(Ad),In(Dc),use(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(W4(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Dm!==null&&(HZ(Dm),Dm=null))),FZ(e,t),Ql(t),null;case 5:cse(t);var s=h2(kL.current);if(r=t.type,e!==null&&t.stateNode!=null)ASe(e,t,r,i,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(ze(166));return Ql(t),null}if(e=h2(s0.current),W4(t)){i=t.stateNode,r=t.type;var n=t.memoizedProps;switch(i[zy]=t,i[NL]=n,e=(t.mode&1)!==0,r){case"dialog":vn("cancel",i),vn("close",i);break;case"iframe":case"object":case"embed":vn("load",i);break;case"video":case"audio":for(s=0;s<A3.length;s++)vn(A3[s],i);break;case"source":vn("error",i);break;case"img":case"image":case"link":vn("error",i),vn("load",i);break;case"details":vn("toggle",i);break;case"input":Gue(i,n),vn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!n.multiple},vn("invalid",i);break;case"textarea":que(i,n),vn("invalid",i)}uZ(r,n),s=null;for(var o in n)if(n.hasOwnProperty(o)){var a=n[o];o==="children"?typeof a=="string"?i.textContent!==a&&(n.suppressHydrationWarning!==!0&&q4(i.textContent,a,e),s=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(n.suppressHydrationWarning!==!0&&q4(i.textContent,a,e),s=["children",""+a]):CL.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&vn("scroll",i)}switch(r){case"input":k4(i),Hue(i,n,!0);break;case"textarea":k4(i),Wue(i);break;case"select":case"option":break;default:typeof n.onClick=="function"&&(i.onclick=A8)}i=s,t.updateQueue=i,i!==null&&(t.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=tTe(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=o.createElement(r,{is:i.is}):(e=o.createElement(r),r==="select"&&(o=e,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):e=o.createElementNS(e,r),e[zy]=t,e[NL]=i,CSe(e,t,!1,!1),t.stateNode=e;e:{switch(o=dZ(r,i),r){case"dialog":vn("cancel",e),vn("close",e),s=i;break;case"iframe":case"object":case"embed":vn("load",e),s=i;break;case"video":case"audio":for(s=0;s<A3.length;s++)vn(A3[s],e);s=i;break;case"source":vn("error",e),s=i;break;case"img":case"image":case"link":vn("error",e),vn("load",e),s=i;break;case"details":vn("toggle",e),s=i;break;case"input":Gue(e,i),s=nZ(e,i),vn("invalid",e);break;case"option":s=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},s=so({},i,{value:void 0}),vn("invalid",e);break;case"textarea":que(e,i),s=lZ(e,i),vn("invalid",e);break;default:s=i}uZ(r,s),a=s;for(n in a)if(a.hasOwnProperty(n)){var l=a[n];n==="style"?sTe(e,l):n==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&rTe(e,l)):n==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&AL(e,l):typeof l=="number"&&AL(e,""+l):n!=="suppressContentEditableWarning"&&n!=="suppressHydrationWarning"&&n!=="autoFocus"&&(CL.hasOwnProperty(n)?l!=null&&n==="onScroll"&&vn("scroll",e):l!=null&&Bie(e,n,l,o))}switch(r){case"input":k4(e),Hue(e,i,!1);break;case"textarea":k4(e),Wue(e);break;case"option":i.value!=null&&e.setAttribute("value",""+px(i.value));break;case"select":e.multiple=!!i.multiple,n=i.value,n!=null?mM(e,!!i.multiple,n,!1):i.defaultValue!=null&&mM(e,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=A8)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ql(t),null;case 6:if(e&&t.stateNode!=null)OSe(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(ze(166));if(r=h2(kL.current),h2(s0.current),W4(t)){if(i=t.stateNode,r=t.memoizedProps,i[zy]=t,(n=i.nodeValue!==r)&&(e=Bh,e!==null))switch(e.tag){case 3:q4(i.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&q4(i.nodeValue,r,(e.mode&1)!==0)}n&&(t.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[zy]=t,t.stateNode=i}return Ql(t),null;case 13:if(In(Qn),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Vn&&Nh!==null&&(t.mode&1)!==0&&(t.flags&128)===0)HTe(),rR(),t.flags|=98560,n=!1;else if(n=W4(t),i!==null&&i.dehydrated!==null){if(e===null){if(!n)throw Error(ze(318));if(n=t.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ze(317));n[zy]=t}else rR(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Ql(t),n=!1}else Dm!==null&&(HZ(Dm),Dm=null),n=!0;if(!n)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=r,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(Qn.current&1)!==0?Va===0&&(Va=3):xse())),t.updateQueue!==null&&(t.flags|=4),Ql(t),null);case 4:return sR(),FZ(e,t),e===null&&DL(t.stateNode.containerInfo),Ql(t),null;case 10:return nse(t.type._context),Ql(t),null;case 17:return Od(t.type)&&O8(),Ql(t),null;case 19:if(In(Qn),n=t.memoizedState,n===null)return Ql(t),null;if(i=(t.flags&128)!==0,o=n.rendering,o===null)if(i)iP(n,!1);else{if(Va!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(o=L8(e),o!==null){for(t.flags|=128,iP(n,!1),i=o.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=r,r=t.child;r!==null;)n=r,e=i,n.flags&=14680066,o=n.alternate,o===null?(n.childLanes=0,n.lanes=e,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=o.childLanes,n.lanes=o.lanes,n.child=o.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=o.memoizedProps,n.memoizedState=o.memoizedState,n.updateQueue=o.updateQueue,n.type=o.type,e=o.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return hn(Qn,Qn.current&1|2),t.child}e=e.sibling}n.tail!==null&&Fo()>oR&&(t.flags|=128,i=!0,iP(n,!1),t.lanes=4194304)}else{if(!i)if(e=L8(o),e!==null){if(t.flags|=128,i=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),iP(n,!0),n.tail===null&&n.tailMode==="hidden"&&!o.alternate&&!Vn)return Ql(t),null}else 2*Fo()-n.renderingStartTime>oR&&r!==1073741824&&(t.flags|=128,i=!0,iP(n,!1),t.lanes=4194304);n.isBackwards?(o.sibling=t.child,t.child=o):(r=n.last,r!==null?r.sibling=o:t.child=o,n.last=o)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=Fo(),t.sibling=null,r=Qn.current,hn(Qn,i?r&1|2:r&1),t):(Ql(t),null);case 22:case 23:return wse(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&(t.mode&1)!==0?(yh&1073741824)!==0&&(Ql(t),t.subtreeFlags&6&&(t.flags|=8192)):Ql(t),null;case 24:return null;case 25:return null}throw Error(ze(156,t.tag))}function O8e(e,t){switch(tse(t),t.tag){case 1:return Od(t.type)&&O8(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return sR(),In(Ad),In(Dc),use(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return cse(t),null;case 13:if(In(Qn),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ze(340));rR()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return In(Qn),null;case 4:return sR(),null;case 10:return nse(t.type._context),null;case 22:case 23:return wse(),null;case 24:return null;default:return null}}var Z4=!1,Oc=!1,M8e=typeof WeakSet=="function"?WeakSet:Set,vt=null;function UO(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){vo(e,t,i)}else r.current=null}function kZ(e,t,r){try{r()}catch(i){vo(e,t,i)}}var Nde=!1;function R8e(e,t){if(wZ=S8,e=PTe(),Qie(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var s=i.anchorOffset,n=i.focusNode;i=i.focusOffset;try{r.nodeType,n.nodeType}catch{r=null;break e}var o=0,a=-1,l=-1,c=0,d=0,p=e,f=null;t:for(;;){for(var m;p!==r||s!==0&&p.nodeType!==3||(a=o+s),p!==n||i!==0&&p.nodeType!==3||(l=o+i),p.nodeType===3&&(o+=p.nodeValue.length),(m=p.firstChild)!==null;)f=p,p=m;for(;;){if(p===e)break t;if(f===r&&++c===s&&(a=o),f===n&&++d===i&&(l=o),(m=p.nextSibling)!==null)break;p=f,f=p.parentNode}p=m}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(xZ={focusedElem:e,selectionRange:r},S8=!1,vt=t;vt!==null;)if(t=vt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,vt=e;else for(;vt!==null;){t=vt;try{var g=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var _=g.memoizedProps,x=g.memoizedState,b=t.stateNode,w=b.getSnapshotBeforeUpdate(t.elementType===t.type?_:Tm(t.type,_),x);b.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var T=t.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ze(163))}}catch(E){vo(t,t.return,E)}if(e=t.sibling,e!==null){e.return=t.return,vt=e;break}vt=t.return}return g=Nde,Nde=!1,g}function mD(e,t,r){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&e)===e){var n=s.destroy;s.destroy=void 0,n!==void 0&&kZ(t,r,n)}s=s.next}while(s!==i)}}function M9(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var i=r.create;r.destroy=i()}r=r.next}while(r!==t)}}function UZ(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function MSe(e){var t=e.alternate;t!==null&&(e.alternate=null,MSe(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[zy],delete t[NL],delete t[EZ],delete t[h8e],delete t[p8e])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function RSe(e){return e.tag===5||e.tag===3||e.tag===4}function Fde(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||RSe(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function BZ(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=A8));else if(i!==4&&(e=e.child,e!==null))for(BZ(e,t,r),e=e.sibling;e!==null;)BZ(e,t,r),e=e.sibling}function zZ(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for(zZ(e,t,r),e=e.sibling;e!==null;)zZ(e,t,r),e=e.sibling}var Cl=null,Am=!1;function A1(e,t,r){for(r=r.child;r!==null;)ISe(e,t,r),r=r.sibling}function ISe(e,t,r){if(i0&&typeof i0.onCommitFiberUnmount=="function")try{i0.onCommitFiberUnmount(w9,r)}catch{}switch(r.tag){case 5:Oc||UO(r,t);case 6:var i=Cl,s=Am;Cl=null,A1(e,t,r),Cl=i,Am=s,Cl!==null&&(Am?(e=Cl,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Cl.removeChild(r.stateNode));break;case 18:Cl!==null&&(Am?(e=Cl,r=r.stateNode,e.nodeType===8?bH(e.parentNode,r):e.nodeType===1&&bH(e,r),IL(e)):bH(Cl,r.stateNode));break;case 4:i=Cl,s=Am,Cl=r.stateNode.containerInfo,Am=!0,A1(e,t,r),Cl=i,Am=s;break;case 0:case 11:case 14:case 15:if(!Oc&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var n=s,o=n.destroy;n=n.tag,o!==void 0&&((n&2)!==0||(n&4)!==0)&&kZ(r,t,o),s=s.next}while(s!==i)}A1(e,t,r);break;case 1:if(!Oc&&(UO(r,t),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(a){vo(r,t,a)}A1(e,t,r);break;case 21:A1(e,t,r);break;case 22:r.mode&1?(Oc=(i=Oc)||r.memoizedState!==null,A1(e,t,r),Oc=i):A1(e,t,r);break;default:A1(e,t,r)}}function kde(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new M8e),t.forEach(function(i){var s=U8e.bind(null,e,i);r.has(i)||(r.add(i),i.then(s,s))})}}function Ff(e,t){var r=t.deletions;if(r!==null)for(var i=0;i<r.length;i++){var s=r[i];try{var n=e,o=t,a=o;e:for(;a!==null;){switch(a.tag){case 5:Cl=a.stateNode,Am=!1;break e;case 3:Cl=a.stateNode.containerInfo,Am=!0;break e;case 4:Cl=a.stateNode.containerInfo,Am=!0;break e}a=a.return}if(Cl===null)throw Error(ze(160));ISe(n,o,s),Cl=null,Am=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){vo(s,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)PSe(t,e),t=t.sibling}function PSe(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Ff(t,e),Ag(e),i&4){try{mD(3,e,e.return),M9(3,e)}catch(_){vo(e,e.return,_)}try{mD(5,e,e.return)}catch(_){vo(e,e.return,_)}}break;case 1:Ff(t,e),Ag(e),i&512&&r!==null&&UO(r,r.return);break;case 5:if(Ff(t,e),Ag(e),i&512&&r!==null&&UO(r,r.return),e.flags&32){var s=e.stateNode;try{AL(s,"")}catch(_){vo(e,e.return,_)}}if(i&4&&(s=e.stateNode,s!=null)){var n=e.memoizedProps,o=r!==null?r.memoizedProps:n,a=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{a==="input"&&n.type==="radio"&&n.name!=null&&Qxe(s,n),dZ(a,o);var c=dZ(a,n);for(o=0;o<l.length;o+=2){var d=l[o],p=l[o+1];d==="style"?sTe(s,p):d==="dangerouslySetInnerHTML"?rTe(s,p):d==="children"?AL(s,p):Bie(s,d,p,c)}switch(a){case"input":oZ(s,n);break;case"textarea":eTe(s,n);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!n.multiple;var m=n.value;m!=null?mM(s,!!n.multiple,m,!1):f!==!!n.multiple&&(n.defaultValue!=null?mM(s,!!n.multiple,n.defaultValue,!0):mM(s,!!n.multiple,n.multiple?[]:"",!1))}s[NL]=n}catch(_){vo(e,e.return,_)}}break;case 6:if(Ff(t,e),Ag(e),i&4){if(e.stateNode===null)throw Error(ze(162));s=e.stateNode,n=e.memoizedProps;try{s.nodeValue=n}catch(_){vo(e,e.return,_)}}break;case 3:if(Ff(t,e),Ag(e),i&4&&r!==null&&r.memoizedState.isDehydrated)try{IL(t.containerInfo)}catch(_){vo(e,e.return,_)}break;case 4:Ff(t,e),Ag(e);break;case 13:Ff(t,e),Ag(e),s=e.child,s.flags&8192&&(n=s.memoizedState!==null,s.stateNode.isHidden=n,!n||s.alternate!==null&&s.alternate.memoizedState!==null||(vse=Fo())),i&4&&kde(e);break;case 22:if(d=r!==null&&r.memoizedState!==null,e.mode&1?(Oc=(c=Oc)||d,Ff(t,e),Oc=c):Ff(t,e),Ag(e),i&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!d&&(e.mode&1)!==0)for(vt=e,d=e.child;d!==null;){for(p=vt=d;vt!==null;){switch(f=vt,m=f.child,f.tag){case 0:case 11:case 14:case 15:mD(4,f,f.return);break;case 1:UO(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){i=f,r=f.return;try{t=i,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(_){vo(i,r,_)}}break;case 5:UO(f,f.return);break;case 22:if(f.memoizedState!==null){Bde(p);continue}}m!==null?(m.return=f,vt=m):Bde(p)}d=d.sibling}e:for(d=null,p=e;;){if(p.tag===5){if(d===null){d=p;try{s=p.stateNode,c?(n=s.style,typeof n.setProperty=="function"?n.setProperty("display","none","important"):n.display="none"):(a=p.stateNode,l=p.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=iTe("display",o))}catch(_){vo(e,e.return,_)}}}else if(p.tag===6){if(d===null)try{p.stateNode.nodeValue=c?"":p.memoizedProps}catch(_){vo(e,e.return,_)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===e)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===e)break e;for(;p.sibling===null;){if(p.return===null||p.return===e)break e;d===p&&(d=null),p=p.return}d===p&&(d=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:Ff(t,e),Ag(e),i&4&&kde(e);break;case 21:break;default:Ff(t,e),Ag(e)}}function Ag(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(RSe(r)){var i=r;break e}r=r.return}throw Error(ze(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(AL(s,""),i.flags&=-33);var n=Fde(e);zZ(e,n,s);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Fde(e);BZ(e,a,o);break;default:throw Error(ze(161))}}catch(l){vo(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function I8e(e,t,r){vt=e,$Se(e)}function $Se(e,t,r){for(var i=(e.mode&1)!==0;vt!==null;){var s=vt,n=s.child;if(s.tag===22&&i){var o=s.memoizedState!==null||Z4;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Oc;a=Z4;var c=Oc;if(Z4=o,(Oc=l)&&!c)for(vt=s;vt!==null;)o=vt,l=o.child,o.tag===22&&o.memoizedState!==null?zde(s):l!==null?(l.return=o,vt=l):zde(s);for(;n!==null;)vt=n,$Se(n),n=n.sibling;vt=s,Z4=a,Oc=c}Ude(e)}else(s.subtreeFlags&8772)!==0&&n!==null?(n.return=s,vt=n):Ude(e)}}function Ude(e){for(;vt!==null;){var t=vt;if((t.flags&8772)!==0){var r=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:Oc||M9(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!Oc)if(r===null)i.componentDidMount();else{var s=t.elementType===t.type?r.memoizedProps:Tm(t.type,r.memoizedProps);i.componentDidUpdate(s,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var n=t.updateQueue;n!==null&&xde(t,n,i);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}xde(t,o,r)}break;case 5:var a=t.stateNode;if(r===null&&t.flags&4){r=a;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var d=c.memoizedState;if(d!==null){var p=d.dehydrated;p!==null&&IL(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ze(163))}Oc||t.flags&512&&UZ(t)}catch(f){vo(t,t.return,f)}}if(t===e){vt=null;break}if(r=t.sibling,r!==null){r.return=t.return,vt=r;break}vt=t.return}}function Bde(e){for(;vt!==null;){var t=vt;if(t===e){vt=null;break}var r=t.sibling;if(r!==null){r.return=t.return,vt=r;break}vt=t.return}}function zde(e){for(;vt!==null;){var t=vt;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{M9(4,t)}catch(l){vo(t,r,l)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var s=t.return;try{i.componentDidMount()}catch(l){vo(t,s,l)}}var n=t.return;try{UZ(t)}catch(l){vo(t,n,l)}break;case 5:var o=t.return;try{UZ(t)}catch(l){vo(t,o,l)}}}catch(l){vo(t,t.return,l)}if(t===e){vt=null;break}var a=t.sibling;if(a!==null){a.return=t.return,vt=a;break}vt=t.return}}var P8e=Math.ceil,k8=s1.ReactCurrentDispatcher,yse=s1.ReactCurrentOwner,uf=s1.ReactCurrentBatchConfig,Wi=0,pl=null,la=null,Nl=0,yh=0,BO=Hx(0),Va=0,VL=null,K2=0,R9=0,_se=0,gD=null,md=null,vse=0,oR=1/0,X_=null,U8=!1,VZ=null,tx=null,J4=!1,Cw=null,B8=0,yD=0,jZ=null,p6=-1,f6=0;function Tu(){return(Wi&6)!==0?Fo():p6!==-1?p6:p6=Fo()}function rx(e){return(e.mode&1)===0?1:(Wi&2)!==0&&Nl!==0?Nl&-Nl:m8e.transition!==null?(f6===0&&(f6=gTe()),f6):(e=Is,e!==0||(e=window.event,e=e===void 0?16:TTe(e.type)),e)}function eg(e,t,r,i){if(50<yD)throw yD=0,jZ=null,Error(ze(185));SF(e,r,i),((Wi&2)===0||e!==pl)&&(e===pl&&((Wi&2)===0&&(R9|=r),Va===4&&mw(e,Nl)),Md(e,i),r===1&&Wi===0&&(t.mode&1)===0&&(oR=Fo()+500,C9&&qx()))}function Md(e,t){var r=e.callbackNode;mBe(e,t);var i=T8(e,e===pl?Nl:0);if(i===0)r!==null&&Zue(r),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(r!=null&&Zue(r),t===1)e.tag===0?f8e(Vde.bind(null,e)):VTe(Vde.bind(null,e)),u8e(function(){(Wi&6)===0&&qx()}),r=null;else{switch(yTe(i)){case 1:r=Hie;break;case 4:r=fTe;break;case 16:r=x8;break;case 536870912:r=mTe;break;default:r=x8}r=zSe(r,DSe.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function DSe(e,t){if(p6=-1,f6=0,(Wi&6)!==0)throw Error(ze(327));var r=e.callbackNode;if(bM()&&e.callbackNode!==r)return null;var i=T8(e,e===pl?Nl:0);if(i===0)return null;if((i&30)!==0||(i&e.expiredLanes)!==0||t)t=z8(e,i);else{t=i;var s=Wi;Wi|=2;var n=NSe();(pl!==e||Nl!==t)&&(X_=null,oR=Fo()+500,P2(e,t));do try{L8e();break}catch(a){LSe(e,a)}while(1);sse(),k8.current=n,Wi=s,la!==null?t=0:(pl=null,Nl=0,t=Va)}if(t!==0){if(t===2&&(s=gZ(e),s!==0&&(i=s,t=GZ(e,s))),t===1)throw r=VL,P2(e,0),mw(e,i),Md(e,Fo()),r;if(t===6)mw(e,i);else{if(s=e.current.alternate,(i&30)===0&&!$8e(s)&&(t=z8(e,i),t===2&&(n=gZ(e),n!==0&&(i=n,t=GZ(e,n))),t===1))throw r=VL,P2(e,0),mw(e,i),Md(e,Fo()),r;switch(e.finishedWork=s,e.finishedLanes=i,t){case 0:case 1:throw Error(ze(345));case 2:XT(e,md,X_);break;case 3:if(mw(e,i),(i&130023424)===i&&(t=vse+500-Fo(),10<t)){if(T8(e,0)!==0)break;if(s=e.suspendedLanes,(s&i)!==i){Tu(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=SZ(XT.bind(null,e,md,X_),t);break}XT(e,md,X_);break;case 4:if(mw(e,i),(i&4194240)===i)break;for(t=e.eventTimes,s=-1;0<i;){var o=31-Qm(i);n=1<<o,o=t[o],o>s&&(s=o),i&=~n}if(i=s,i=Fo()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*P8e(i/1960))-i,10<i){e.timeoutHandle=SZ(XT.bind(null,e,md,X_),i);break}XT(e,md,X_);break;case 5:XT(e,md,X_);break;default:throw Error(ze(329))}}}return Md(e,Fo()),e.callbackNode===r?DSe.bind(null,e):null}function GZ(e,t){var r=gD;return e.current.memoizedState.isDehydrated&&(P2(e,t).flags|=256),e=z8(e,t),e!==2&&(t=md,md=r,t!==null&&HZ(t)),e}function HZ(e){md===null?md=e:md.push.apply(md,e)}function $8e(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var s=r[i],n=s.getSnapshot;s=s.value;try{if(!ag(n(),s))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function mw(e,t){for(t&=~_se,t&=~R9,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Qm(t),i=1<<r;e[r]=-1,t&=~i}}function Vde(e){if((Wi&6)!==0)throw Error(ze(327));bM();var t=T8(e,0);if((t&1)===0)return Md(e,Fo()),null;var r=z8(e,t);if(e.tag!==0&&r===2){var i=gZ(e);i!==0&&(t=i,r=GZ(e,i))}if(r===1)throw r=VL,P2(e,0),mw(e,t),Md(e,Fo()),r;if(r===6)throw Error(ze(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,XT(e,md,X_),Md(e,Fo()),null}function bse(e,t){var r=Wi;Wi|=1;try{return e(t)}finally{Wi=r,Wi===0&&(oR=Fo()+500,C9&&qx())}}function Q2(e){Cw!==null&&Cw.tag===0&&(Wi&6)===0&&bM();var t=Wi;Wi|=1;var r=uf.transition,i=Is;try{if(uf.transition=null,Is=1,e)return e()}finally{Is=i,uf.transition=r,Wi=t,(Wi&6)===0&&qx()}}function wse(){yh=BO.current,In(BO)}function P2(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,c8e(r)),la!==null)for(r=la.return;r!==null;){var i=r;switch(tse(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&O8();break;case 3:sR(),In(Ad),In(Dc),use();break;case 5:cse(i);break;case 4:sR();break;case 13:In(Qn);break;case 19:In(Qn);break;case 10:nse(i.type._context);break;case 22:case 23:wse()}r=r.return}if(pl=e,la=e=ix(e.current,null),Nl=yh=t,Va=0,VL=null,_se=R9=K2=0,md=gD=null,d2!==null){for(t=0;t<d2.length;t++)if(r=d2[t],i=r.interleaved,i!==null){r.interleaved=null;var s=i.next,n=r.pending;if(n!==null){var o=n.next;n.next=s,i.next=o}r.pending=i}d2=null}return e}function LSe(e,t){do{var r=la;try{if(sse(),u6.current=F8,N8){for(var i=io.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}N8=!1}if(J2=0,ll=La=io=null,fD=!1,UL=0,yse.current=null,r===null||r.return===null){Va=1,VL=t,la=null;break}e:{var n=e,o=r.return,a=r,l=t;if(t=Nl,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,d=a,p=d.tag;if((d.mode&1)===0&&(p===0||p===11||p===15)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var m=Mde(o);if(m!==null){m.flags&=-257,Rde(m,o,a,n,t),m.mode&1&&Ode(n,c,t),t=m,l=c;var g=t.updateQueue;if(g===null){var _=new Set;_.add(l),t.updateQueue=_}else g.add(l);break e}else{if((t&1)===0){Ode(n,c,t),xse();break e}l=Error(ze(426))}}else if(Vn&&a.mode&1){var x=Mde(o);if(x!==null){(x.flags&65536)===0&&(x.flags|=256),Rde(x,o,a,n,t),rse(nR(l,a));break e}}n=l=nR(l,a),Va!==4&&(Va=2),gD===null?gD=[n]:gD.push(n),n=o;do{switch(n.tag){case 3:n.flags|=65536,t&=-t,n.lanes|=t;var b=_Se(n,l,t);wde(n,b);break e;case 1:a=l;var w=n.type,T=n.stateNode;if((n.flags&128)===0&&(typeof w.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(tx===null||!tx.has(T)))){n.flags|=65536,t&=-t,n.lanes|=t;var E=vSe(n,a,t);wde(n,E);break e}}n=n.return}while(n!==null)}kSe(r)}catch(O){t=O,la===r&&r!==null&&(la=r=r.return);continue}break}while(1)}function NSe(){var e=k8.current;return k8.current=F8,e===null?F8:e}function xse(){(Va===0||Va===3||Va===2)&&(Va=4),pl===null||(K2&268435455)===0&&(R9&268435455)===0||mw(pl,Nl)}function z8(e,t){var r=Wi;Wi|=2;var i=NSe();(pl!==e||Nl!==t)&&(X_=null,P2(e,t));do try{D8e();break}catch(s){LSe(e,s)}while(1);if(sse(),Wi=r,k8.current=i,la!==null)throw Error(ze(261));return pl=null,Nl=0,Va}function D8e(){for(;la!==null;)FSe(la)}function L8e(){for(;la!==null&&!oBe();)FSe(la)}function FSe(e){var t=BSe(e.alternate,e,yh);e.memoizedProps=e.pendingProps,t===null?kSe(e):la=t,yse.current=null}function kSe(e){var t=e;do{var r=t.alternate;if(e=t.return,(t.flags&32768)===0){if(r=A8e(r,t,yh),r!==null){la=r;return}}else{if(r=O8e(r,t),r!==null){r.flags&=32767,la=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Va=6,la=null;return}}if(t=t.sibling,t!==null){la=t;return}la=t=e}while(t!==null);Va===0&&(Va=5)}function XT(e,t,r){var i=Is,s=uf.transition;try{uf.transition=null,Is=1,N8e(e,t,r,i)}finally{uf.transition=s,Is=i}return null}function N8e(e,t,r,i){do bM();while(Cw!==null);if((Wi&6)!==0)throw Error(ze(327));r=e.finishedWork;var s=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(ze(177));e.callbackNode=null,e.callbackPriority=0;var n=r.lanes|r.childLanes;if(gBe(e,n),e===pl&&(la=pl=null,Nl=0),(r.subtreeFlags&2064)===0&&(r.flags&2064)===0||J4||(J4=!0,zSe(x8,function(){return bM(),null})),n=(r.flags&15990)!==0,(r.subtreeFlags&15990)!==0||n){n=uf.transition,uf.transition=null;var o=Is;Is=1;var a=Wi;Wi|=4,yse.current=null,R8e(e,r),PSe(r,e),r8e(xZ),S8=!!wZ,xZ=wZ=null,e.current=r,I8e(r),aBe(),Wi=a,Is=o,uf.transition=n}else e.current=r;if(J4&&(J4=!1,Cw=e,B8=s),n=e.pendingLanes,n===0&&(tx=null),uBe(r.stateNode),Md(e,Fo()),t!==null)for(i=e.onRecoverableError,r=0;r<t.length;r++)s=t[r],i(s.value,{componentStack:s.stack,digest:s.digest});if(U8)throw U8=!1,e=VZ,VZ=null,e;return(B8&1)!==0&&e.tag!==0&&bM(),n=e.pendingLanes,(n&1)!==0?e===jZ?yD++:(yD=0,jZ=e):yD=0,qx(),null}function bM(){if(Cw!==null){var e=yTe(B8),t=uf.transition,r=Is;try{if(uf.transition=null,Is=16>e?16:e,Cw===null)var i=!1;else{if(e=Cw,Cw=null,B8=0,(Wi&6)!==0)throw Error(ze(331));var s=Wi;for(Wi|=4,vt=e.current;vt!==null;){var n=vt,o=n.child;if((vt.flags&16)!==0){var a=n.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(vt=c;vt!==null;){var d=vt;switch(d.tag){case 0:case 11:case 15:mD(8,d,n)}var p=d.child;if(p!==null)p.return=d,vt=p;else for(;vt!==null;){d=vt;var f=d.sibling,m=d.return;if(MSe(d),d===c){vt=null;break}if(f!==null){f.return=m,vt=f;break}vt=m}}}var g=n.alternate;if(g!==null){var _=g.child;if(_!==null){g.child=null;do{var x=_.sibling;_.sibling=null,_=x}while(_!==null)}}vt=n}}if((n.subtreeFlags&2064)!==0&&o!==null)o.return=n,vt=o;else e:for(;vt!==null;){if(n=vt,(n.flags&2048)!==0)switch(n.tag){case 0:case 11:case 15:mD(9,n,n.return)}var b=n.sibling;if(b!==null){b.return=n.return,vt=b;break e}vt=n.return}}var w=e.current;for(vt=w;vt!==null;){o=vt;var T=o.child;if((o.subtreeFlags&2064)!==0&&T!==null)T.return=o,vt=T;else e:for(o=w;vt!==null;){if(a=vt,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:M9(9,a)}}catch(O){vo(a,a.return,O)}if(a===o){vt=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,vt=E;break e}vt=a.return}}if(Wi=s,qx(),i0&&typeof i0.onPostCommitFiberRoot=="function")try{i0.onPostCommitFiberRoot(w9,e)}catch{}i=!0}return i}finally{Is=r,uf.transition=t}}return!1}function jde(e,t,r){t=nR(r,t),t=_Se(e,t,1),e=ex(e,t,1),t=Tu(),e!==null&&(SF(e,1,t),Md(e,t))}function vo(e,t,r){if(e.tag===3)jde(e,e,r);else for(;t!==null;){if(t.tag===3){jde(t,e,r);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(tx===null||!tx.has(i))){e=nR(r,e),e=vSe(t,e,1),t=ex(t,e,1),e=Tu(),t!==null&&(SF(t,1,e),Md(t,e));break}}t=t.return}}function F8e(e,t,r){var i=e.pingCache;i!==null&&i.delete(t),t=Tu(),e.pingedLanes|=e.suspendedLanes&r,pl===e&&(Nl&r)===r&&(Va===4||Va===3&&(Nl&130023424)===Nl&&500>Fo()-vse?P2(e,0):_se|=r),Md(e,t)}function USe(e,t){t===0&&((e.mode&1)===0?t=1:(t=z4,z4<<=1,(z4&130023424)===0&&(z4=4194304)));var r=Tu();e=kv(e,t),e!==null&&(SF(e,t,r),Md(e,r))}function k8e(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),USe(e,r)}function U8e(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,s=e.memoizedState;s!==null&&(r=s.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(ze(314))}i!==null&&i.delete(t),USe(e,r)}var BSe;BSe=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ad.current)xd=!0;else{if((e.lanes&r)===0&&(t.flags&128)===0)return xd=!1,C8e(e,t,r);xd=(e.flags&131072)!==0}else xd=!1,Vn&&(t.flags&1048576)!==0&&jTe(t,I8,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;h6(e,t),e=t.pendingProps;var s=tR(t,Dc.current);vM(t,r),s=hse(null,t,i,e,s,r);var n=pse();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Od(i)?(n=!0,M8(t)):n=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,ase(t),s.updater=A9,t.stateNode=s,s._reactInternals=t,IZ(t,i,e,r),t=DZ(null,t,i,!0,n,r)):(t.tag=0,Vn&&n&&ese(t),uu(null,t,s,r),t=t.child),t;case 16:i=t.elementType;e:{switch(h6(e,t),e=t.pendingProps,s=i._init,i=s(i._payload),t.type=i,s=t.tag=z8e(i),e=Tm(i,e),s){case 0:t=$Z(null,t,i,e,r);break e;case 1:t=$de(null,t,i,e,r);break e;case 11:t=Ide(null,t,i,e,r);break e;case 14:t=Pde(null,t,i,Tm(i.type,e),r);break e}throw Error(ze(306,i,""))}return t;case 0:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:Tm(i,s),$Z(e,t,i,s,r);case 1:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:Tm(i,s),$de(e,t,i,s,r);case 3:e:{if(TSe(t),e===null)throw Error(ze(387));i=t.pendingProps,n=t.memoizedState,s=n.element,WTe(e,t),D8(t,i,null,r);var o=t.memoizedState;if(i=o.element,n.isDehydrated)if(n={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=n,t.memoizedState=n,t.flags&256){s=nR(Error(ze(423)),t),t=Dde(e,t,i,r,s);break e}else if(i!==s){s=nR(Error(ze(424)),t),t=Dde(e,t,i,r,s);break e}else for(Nh=Qw(t.stateNode.containerInfo.firstChild),Bh=t,Vn=!0,Dm=null,r=JTe(t,null,i,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(rR(),i===s){t=Uv(e,t,r);break e}uu(e,t,i,r)}t=t.child}return t;case 5:return KTe(t),e===null&&OZ(t),i=t.type,s=t.pendingProps,n=e!==null?e.memoizedProps:null,o=s.children,TZ(i,s)?o=null:n!==null&&TZ(i,n)&&(t.flags|=32),xSe(e,t),uu(e,t,o,r),t.child;case 6:return e===null&&OZ(t),null;case 13:return SSe(e,t,r);case 4:return lse(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=iR(t,null,i,r):uu(e,t,i,r),t.child;case 11:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:Tm(i,s),Ide(e,t,i,s,r);case 7:return uu(e,t,t.pendingProps,r),t.child;case 8:return uu(e,t,t.pendingProps.children,r),t.child;case 12:return uu(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(i=t.type._context,s=t.pendingProps,n=t.memoizedProps,o=s.value,hn(P8,i._currentValue),i._currentValue=o,n!==null)if(ag(n.value,o)){if(n.children===s.children&&!Ad.current){t=Uv(e,t,r);break e}}else for(n=t.child,n!==null&&(n.return=t);n!==null;){var a=n.dependencies;if(a!==null){o=n.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(n.tag===1){l=bv(-1,r&-r),l.tag=2;var c=n.updateQueue;if(c!==null){c=c.shared;var d=c.pending;d===null?l.next=l:(l.next=d.next,d.next=l),c.pending=l}}n.lanes|=r,l=n.alternate,l!==null&&(l.lanes|=r),MZ(n.return,r,t),a.lanes|=r;break}l=l.next}}else if(n.tag===10)o=n.type===t.type?null:n.child;else if(n.tag===18){if(o=n.return,o===null)throw Error(ze(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),MZ(o,r,t),o=n.sibling}else o=n.child;if(o!==null)o.return=n;else for(o=n;o!==null;){if(o===t){o=null;break}if(n=o.sibling,n!==null){n.return=o.return,o=n;break}o=o.return}n=o}uu(e,t,s.children,r),t=t.child}return t;case 9:return s=t.type,i=t.pendingProps.children,vM(t,r),s=yf(s),i=i(s),t.flags|=1,uu(e,t,i,r),t.child;case 14:return i=t.type,s=Tm(i,t.pendingProps),s=Tm(i.type,s),Pde(e,t,i,s,r);case 15:return bSe(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:Tm(i,s),h6(e,t),t.tag=1,Od(i)?(e=!0,M8(t)):e=!1,vM(t,r),YTe(t,i,s),IZ(t,i,s,r),DZ(null,t,i,!0,e,r);case 19:return ESe(e,t,r);case 22:return wSe(e,t,r)}throw Error(ze(156,t.tag))};function zSe(e,t){return pTe(e,t)}function B8e(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function of(e,t,r,i){return new B8e(e,t,r,i)}function Tse(e){return e=e.prototype,!(!e||!e.isReactComponent)}function z8e(e){if(typeof e=="function")return Tse(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Vie)return 11;if(e===jie)return 14}return 2}function ix(e,t){var r=e.alternate;return r===null?(r=of(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function m6(e,t,r,i,s,n){var o=2;if(i=e,typeof e=="function")Tse(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case RO:return $2(r.children,s,n,t);case zie:o=8,s|=8;break;case tZ:return e=of(12,r,t,s|2),e.elementType=tZ,e.lanes=n,e;case rZ:return e=of(13,r,t,s),e.elementType=rZ,e.lanes=n,e;case iZ:return e=of(19,r,t,s),e.elementType=iZ,e.lanes=n,e;case Zxe:return I9(r,s,n,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Xxe:o=10;break e;case Yxe:o=9;break e;case Vie:o=11;break e;case jie:o=14;break e;case Qb:o=16,i=null;break e}throw Error(ze(130,e==null?e:typeof e,""))}return t=of(o,r,t,s),t.elementType=e,t.type=i,t.lanes=n,t}function $2(e,t,r,i){return e=of(7,e,i,t),e.lanes=r,e}function I9(e,t,r,i){return e=of(22,e,i,t),e.elementType=Zxe,e.lanes=r,e.stateNode={isHidden:!1},e}function OH(e,t,r){return e=of(6,e,null,t),e.lanes=r,e}function MH(e,t,r){return t=of(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function V8e(e,t,r,i,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cH(0),this.expirationTimes=cH(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cH(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Sse(e,t,r,i,s,n,o,a,l){return e=new V8e(e,t,r,a,l),t===1?(t=1,n===!0&&(t|=8)):t=0,n=of(3,null,null,t),e.current=n,n.stateNode=e,n.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},ase(n),e}function j8e(e,t,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:MO,key:i==null?null:""+i,children:e,containerInfo:t,implementation:r}}function VSe(e){if(!e)return fx;e=e._reactInternals;e:{if(YE(e)!==e||e.tag!==1)throw Error(ze(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Od(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ze(171))}if(e.tag===1){var r=e.type;if(Od(r))return zTe(e,r,t)}return t}function jSe(e,t,r,i,s,n,o,a,l){return e=Sse(r,i,!0,e,s,n,o,a,l),e.context=VSe(null),r=e.current,i=Tu(),s=rx(r),n=bv(i,s),n.callback=t!=null?t:null,ex(r,n,s),e.current.lanes=s,SF(e,s,i),Md(e,i),e}function P9(e,t,r,i){var s=t.current,n=Tu(),o=rx(s);return r=VSe(r),t.context===null?t.context=r:t.pendingContext=r,t=bv(n,o),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=ex(s,t,o),e!==null&&(eg(e,s,o,n),c6(e,s,o)),o}function V8(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Gde(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Ese(e,t){Gde(e,t),(e=e.alternate)&&Gde(e,t)}function G8e(){return null}var GSe=typeof reportError=="function"?reportError:function(e){console.error(e)};function Cse(e){this._internalRoot=e}$9.prototype.render=Cse.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ze(409));P9(e,t,null,null)};$9.prototype.unmount=Cse.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Q2(function(){P9(null,e,null,null)}),t[Fv]=null}};function $9(e){this._internalRoot=e}$9.prototype.unstable_scheduleHydration=function(e){if(e){var t=bTe();e={blockedOn:null,target:e,priority:t};for(var r=0;r<fw.length&&t!==0&&t<fw[r].priority;r++);fw.splice(r,0,e),r===0&&xTe(e)}};function Ase(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function D9(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Hde(){}function H8e(e,t,r,i,s){if(s){if(typeof i=="function"){var n=i;i=function(){var c=V8(o);n.call(c)}}var o=jSe(t,i,e,0,null,!1,!1,"",Hde);return e._reactRootContainer=o,e[Fv]=o.current,DL(e.nodeType===8?e.parentNode:e),Q2(),o}for(;s=e.lastChild;)e.removeChild(s);if(typeof i=="function"){var a=i;i=function(){var c=V8(l);a.call(c)}}var l=Sse(e,0,!1,null,null,!1,!1,"",Hde);return e._reactRootContainer=l,e[Fv]=l.current,DL(e.nodeType===8?e.parentNode:e),Q2(function(){P9(t,l,r,i)}),l}function L9(e,t,r,i,s){var n=r._reactRootContainer;if(n){var o=n;if(typeof s=="function"){var a=s;s=function(){var l=V8(o);a.call(l)}}P9(t,o,e,s)}else o=H8e(r,t,e,s,i);return V8(o)}_Te=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=C3(t.pendingLanes);r!==0&&(qie(t,r|1),Md(t,Fo()),(Wi&6)===0&&(oR=Fo()+500,qx()))}break;case 13:Q2(function(){var i=kv(e,1);if(i!==null){var s=Tu();eg(i,e,1,s)}}),Ese(e,1)}};Wie=function(e){if(e.tag===13){var t=kv(e,134217728);if(t!==null){var r=Tu();eg(t,e,134217728,r)}Ese(e,134217728)}};vTe=function(e){if(e.tag===13){var t=rx(e),r=kv(e,t);if(r!==null){var i=Tu();eg(r,e,t,i)}Ese(e,t)}};bTe=function(){return Is};wTe=function(e,t){var r=Is;try{return Is=e,t()}finally{Is=r}};pZ=function(e,t,r){switch(t){case"input":if(oZ(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var s=E9(i);if(!s)throw Error(ze(90));Kxe(i),oZ(i,s)}}}break;case"textarea":eTe(e,r);break;case"select":t=r.value,t!=null&&mM(e,!!r.multiple,t,!1)}};aTe=bse;lTe=Q2;var q8e={usingClientEntryPoint:!1,Events:[CF,DO,E9,nTe,oTe,bse]},sP={findFiberByHostInstance:u2,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},W8e={bundleType:sP.bundleType,version:sP.version,rendererPackageName:sP.rendererPackageName,rendererConfig:sP.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:s1.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=dTe(e),e===null?null:e.stateNode},findFiberByHostInstance:sP.findFiberByHostInstance||G8e,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var K4=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!K4.isDisabled&&K4.supportsFiber)try{w9=K4.inject(W8e),i0=K4}catch{}}ip.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=q8e;ip.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ase(t))throw Error(ze(200));return j8e(e,t,null,r)};ip.createRoot=function(e,t){if(!Ase(e))throw Error(ze(299));var r=!1,i="",s=GSe;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=Sse(e,1,!1,null,null,r,!1,i,s),e[Fv]=t.current,DL(e.nodeType===8?e.parentNode:e),new Cse(t)};ip.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ze(188)):(e=Object.keys(e).join(","),Error(ze(268,e)));return e=dTe(t),e=e===null?null:e.stateNode,e};ip.flushSync=function(e){return Q2(e)};ip.hydrate=function(e,t,r){if(!D9(t))throw Error(ze(200));return L9(null,e,t,!0,r)};ip.hydrateRoot=function(e,t,r){if(!Ase(e))throw Error(ze(405));var i=r!=null&&r.hydratedSources||null,s=!1,n="",o=GSe;if(r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(n=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=jSe(t,null,e,1,r!=null?r:null,s,!1,n,o),e[Fv]=t.current,DL(e),i)for(e=0;e<i.length;e++)r=i[e],s=r._getVersion,s=s(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,s]:t.mutableSourceEagerHydrationData.push(r,s);return new $9(t)};ip.render=function(e,t,r){if(!D9(t))throw Error(ze(200));return L9(null,e,t,!1,r)};ip.unmountComponentAtNode=function(e){if(!D9(e))throw Error(ze(40));return e._reactRootContainer?(Q2(function(){L9(null,null,e,!1,function(){e._reactRootContainer=null,e[Fv]=null})}),!0):!1};ip.unstable_batchedUpdates=bse;ip.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!D9(r))throw Error(ze(200));if(e==null||e._reactInternals===void 0)throw Error(ze(38));return L9(e,t,r,!1,i)};ip.version="18.2.0-next-9e3b772b8-20220608";(function(e){function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(r){console.error(r)}}t(),e.exports=ip})(jxe);var qde=jxe.exports;QY.createRoot=qde.createRoot,QY.hydrateRoot=qde.hydrateRoot;const X8e="modulepreload",Y8e=function(e){return"/"+e},Wde={},re=function(t,r,i){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=Y8e(n),n in Wde)return;Wde[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let d=s.length-1;d>=0;d--){const p=s[d];if(p.href===n&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":X8e,o||(c.as="script",c.crossOrigin=""),c.href=n,document.head.appendChild(c),o)return new Promise((d,p)=>{c.addEventListener("load",d),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())};function u(e,t,r,i){var s,n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,r,o):s(t,r))||o);return n>3&&o&&Object.defineProperty(t,r,o),o}function N9(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function mx(e,t,r){if(!N9(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,r);if(Array.isArray(t)){const i=t.slice();for(const s of i)e.addEventListener(s,r);return{remove(){for(const s of i)e.removeEventListener(s,r)}}}return e.addEventListener(t,r),{remove(){e.removeEventListener(t,r)}}}function HSe(e,t,r){if(!N9(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,r);const i=mx(e,t,s=>{i.remove(),r.call(e,s)});return{remove(){i.remove()}}}function O3(e,t,r){let i=!1;const s=mx(e,t,n=>{i||r.call(e,n)});return{resume(){i=!1},pause(){i=!0},remove(){s.remove()}}}const Z8e={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function Uo({key:e}){return Z8e[e]||e}function Okt(e){const t=[];return function*(){yield*t;for(const r of e)t.push(r),yield r}}function J8e(e,t){for(const r of e)if(r!=null&&t(r))return r}function qZ(e){return e!=null&&typeof e[Symbol.iterator]=="function"}const YT=null;function v(e){return e!=null}function C(e){return e==null}function qi(e,t){return v(e)?t(e):YT}function Mkt(e){return e}function gd(e,t){return Ose(e,t),e}function Ose(e,t){if(C(e))throw new Error(t!=null?t:"value is None")}function yt(e,t){return v(e)?e:typeof t=="function"?t():t}function WS(e,t){return v(e)?e:t}function Qe(e){return v(e)&&e.destroy(),null}function tt(e){return v(e)&&e.dispose(),null}function Gs(e){return v(e)&&e.remove(),null}function lg(e){return v(e)&&e.abort(),null}function Di(e){return v(e)&&e.release(),null}function K8e(e,t,r){return v(e)&&v(t)?v(r)?r(e,t):e.equals(t):e===t}function eE(e){return null}function Rkt(e,t){const r=new Array;return e.forEach(i=>{const s=t(i);v(s)&&r.push(s)}),r}function Ikt(e,t){const r=new Array;for(const i of e)r.push(Ch(i,null,t));return r}function Pkt(e,t){for(const r of e)qi(r,t)}function Ch(e,t,r){return v(e)?r(e):t}function $kt(e){return e.filter(t=>v(t))}function Ks(e,...t){let r=e;for(let i=0;i<t.length&&r;++i)r=r[t[i]];return r}function Dkt(e){return e}class hr{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let t=0;return this._groups.forEach(r=>{t+=r.length}),t}add(t,r){if(qZ(t)){const i=this._getOrCreateGroup(r);for(const s of t)this._isHandle(s)&&i.push(s)}else this._isHandle(t)&&this._getOrCreateGroup(r).push(t);return this}forEach(t,r){if(typeof t=="function")this._groups.forEach(i=>i.forEach(t));else{const i=this._getGroup(t);i&&r&&i.forEach(r)}}has(t){return this._groups.has(this._ensureGroupKey(t))}remove(t){if(typeof t!="string"&&qZ(t)){for(const r of t)this.remove(r);return this}return this.has(t)?(this._removeAllFromGroup(this._getGroup(t)),this._groups.delete(this._ensureGroupKey(t)),this):this}removeAll(){return this._groups.forEach(t=>this._removeAllFromGroup(t)),this._groups.clear(),this}_isHandle(t){return t&&!!t.remove}_getOrCreateGroup(t){if(this.has(t))return this._getGroup(t);const r=[];return this._groups.set(this._ensureGroupKey(t),r),r}_getGroup(t){return this._groups.get(this._ensureGroupKey(t))}_ensureGroupKey(t){return t||"_default_"}_removeAllFromGroup(t){t.forEach(r=>r.remove())}}function aR(e){return cg(()=>e.forEach(t=>v(t)&&t.remove()))}function cg(e){return{remove:()=>{e&&(e(),e=void 0)}}}function Lkt(e){return cg(v(e)?()=>e.destroy():void 0)}function Q8e(e){return{setTimeout:(t,r)=>{const i=e.setTimeout(t,r);return{remove:()=>e.clearTimeout(i)}}}}const F9=Q8e(globalThis);let Aw;function pe(e){return typeof Aw[e]=="function"?Aw[e]=Aw[e](globalThis):Aw[e]}var Axe,Oxe,Mxe,Rxe;Aw=((Axe=globalThis.dojoConfig)==null?void 0:Axe.has)||((Oxe=globalThis.esriConfig)==null?void 0:Oxe.has)?{...(Mxe=globalThis.dojoConfig)==null?void 0:Mxe.has,...(Rxe=globalThis.esriConfig)==null?void 0:Rxe.has}:{},pe.add=(e,t,r,i)=>((i||Aw[e]===void 0)&&(Aw[e]=t),r&&pe(e)),pe.cache=Aw,pe.add("esri-deprecation-warnings",!0),(()=>{var t;pe.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(pe.add("host-browser",e),pe.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),pe.add("dom",e),pe("host-browser")){const r=navigator,i=r.userAgent,s=r.appVersion,n=parseFloat(s);if(pe.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),pe.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),pe.add("khtml",s.includes("Konqueror")?n:void 0),pe.add("edge",parseFloat(i.split("Edge/")[1])||void 0),pe.add("opr",parseFloat(i.split("OPR/")[1])||void 0),pe.add("webkit",!pe("wp")&&!pe("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),pe.add("chrome",!pe("edge")&&!pe("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),pe.add("android",!pe("wp")&&parseFloat(i.split("Android ")[1])||void 0),pe.add("safari",!s.includes("Safari")||pe("wp")||pe("chrome")||pe("android")||pe("edge")||pe("opr")?void 0:parseFloat(s.split("Version/")[1])),pe.add("mac",s.includes("Macintosh")),!pe("wp")&&i.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=i.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));pe.add(o,l),pe.add("ios",l)}pe.add("trident",parseFloat(s.split("Trident/")[1])||void 0),pe("webkit")||(!i.includes("Gecko")||pe("wp")||pe("khtml")||pe("trident")||pe("edge")||pe.add("mozilla",n),pe("mozilla")&&pe.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),r=/iPhone/i.test(e);t&&pe.add("esri-mobile",t),r&&pe.add("esri-iPhone",r),pe.add("esri-geolocation",!!navigator.geolocation)}pe.add("esri-canvas-svg-support",!pe("trident")),pe.add("esri-wasm","WebAssembly"in globalThis),pe.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),pe.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),pe.add("esri-atomics","Atomics"in globalThis),pe.add("esri-workers","Worker"in globalThis),pe.add("web-feat:cache","caches"in globalThis),pe.add("esri-workers-arraybuffer-transfer",!pe("safari")||Number(pe("safari"))>=12),pe.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),pe.add("featurelayer-simplify-payload-size-factors",[1,1,4]),pe.add("featurelayer-snapshot-enabled",!0),pe.add("featurelayer-snapshot-point-min-threshold",8e4),pe.add("featurelayer-snapshot-point-max-threshold",4e5),pe.add("featurelayer-snapshot-point-coverage",.1),pe.add("featurelayer-advanced-symbols",!1),pe.add("featurelayer-pbf",!0),pe.add("featurelayer-pbf-statistics",!1),pe.add("feature-layers-workers",!0),pe.add("feature-polyline-generalization-factor",1),pe.add("mapview-transitions-duration",200),pe.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),pe.add("mapserver-pbf-enabled",!1),pe.add("mapimagelayer-popup-identify-max-tolerance",20),pe.add("heatmap-allow-raster-fallback",!0),pe.add("heatmap-force-raster",!1),pe("host-webworker")||pe("host-browser")&&(pe.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),pe.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{pe.add("esri-image-decode",!0,!0,!0)}).catch(()=>{pe.add("esri-image-decode",!1,!0,!0)})}return!1}),pe.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();const Xde=new Set;function eze(e,t,r=!1){r&&Xde.has(t)||(r&&Xde.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function du(e,t,r={}){if(pe("esri-deprecation-warnings")){const{moduleName:i}=r;j8(e,`Property: ${(i?i+"::":"")+t}`,r)}}function j8(e,t,r={}){if(pe("esri-deprecation-warnings")){const{replacement:i,version:s,see:n,warnOnce:o}=r;let a=t;i&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${i}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),eze(e,a,o)}}class Wp{constructor(t=1){this._seed=t}set seed(t){this._seed=t!=null?t:Math.random()*Wp._m}getInt(){return this._seed=(Wp._a*this._seed+Wp._c)%Wp._m,this._seed}getFloat(){return this.getInt()/(Wp._m-1)}getIntRange(t,r){return Math.round(this.getFloatRange(t,r))}getFloatRange(t,r){const i=r-t;return t+this.getInt()/Wp._m*i}}Wp._m=2147483647,Wp._a=48271,Wp._c=0;function OF(e,t){return t?e.filter((r,i,s)=>s.findIndex(t.bind(null,r))===i):e.filter((r,i,s)=>s.indexOf(r)===i)}function Bv(e,t,r){if(C(e)&&C(t))return!0;if(C(e)||C(t)||e.length!==t.length)return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function Mse(e,t){let r=e.length!==t.length;r&&(e.length=t.length);for(let i=0;i<t.length;++i)e[i]!==t[i]&&(e[i]=t[i],r=!0);return r}function tze(e,t,r){let i,s;return r?(i=t.filter(n=>!e.some(o=>r(o,n))),s=e.filter(n=>!t.some(o=>r(o,n)))):(i=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:i,removed:s}}function rze(e){return e&&typeof e.length=="number"}function ize(e,t){const r=e.length;if(r===0)return[];const i=[];for(let s=0;s<r;s+=t)i.push(e.slice(s,s+t));return i}const sze=!!Array.prototype.fill;function Nkt(e,t){if(sze)return new Array(e).fill(t);const r=new Array(e);for(let i=0;i<e;i++)r[i]=t;return r}function nze(e,t){t===void 0&&(t=e,e=0);const r=new Array(t-e);for(let i=e;i<t;i++)r[i-e]=i;return r}function qSe(e,t,r){const i=e.length;let s=0,n=i-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return r?t>=e[i-1]?-1:o===t?s:s-1:o===t?s:-1}class WSe{constructor(){this.last=0}}const XSe=new WSe;function WZ(e,t,r,i){i=i||XSe;const s=Math.max(0,i.last-10);for(let o=s;o<r;++o)if(e[o]===t)return i.last=o,o;const n=Math.min(s,r);for(let o=0;o<n;++o)if(e[o]===t)return i.last=o,o;return-1}function Rse(e,t,r,i){const s=r!=null?r:e.length,n=WZ(e,t,s,i);if(n!==-1)return e[n]=e[s-1],r==null&&e.pop(),t}const kf=new Set;function oze(e,t,r=e.length,i=t.length,s,n){if(i===0||r===0)return r;kf.clear();for(let a=0;a<i;++a)kf.add(t[a]);s=s||XSe;const o=Math.max(0,s.last-10);for(let a=o;a<r;++a)if(kf.has(e[a])&&(n&&n.push(e[a]),kf.delete(e[a]),e[a]=e[r-1],--r,--a,kf.size===0||r===0))return kf.clear(),r;for(let a=0;a<o;++a)if(kf.has(e[a])&&(n&&n.push(e[a]),kf.delete(e[a]),e[a]=e[r-1],--r,--a,kf.size===0||r===0))return kf.clear(),r;return kf.clear(),r}function aze(e){return e?(Yde.seed=e,()=>Yde.getFloat()):Math.random}function Fkt(e,t){const r=aze(t);for(let i=e.length-1;i>0;i--){const s=Math.floor(r()*(i+1)),n=e[i];e[i]=e[s],e[s]=n}return e}const Yde=new Wp;function Ise(e,t){const r=e.indexOf(t);return r!==-1?(e.splice(r,1),t):null}function kkt(e,t){const r=new Map,i=e.length;for(let s=0;s<i;s++){const n=e[s],o=t(n,s,e),a=r.get(o);a?a.push(n):r.set(o,[n])}return r}function lze(e,t){if(e.forEach)e.forEach(t);else for(let r=0;r<e.length;r++)t(e[r],r,e)}function Pse(e,t,r){if(e.slice)return e.slice(t,r);t===void 0?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),r===void 0?r=e.length:(r<0&&(r+=e.length),r=Math.min(e.length,Math.max(0,r)));const i=Math.max(0,r-t),s=new e.constructor(i);for(let n=0;n<i;n++)s[n]=e[t+n];return s}function nP(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}function cze(e){return e instanceof Int8Array||e&&e.constructor&&e.constructor.name==="Int8Array"}function XS(e){return e instanceof Uint8Array||e&&e.constructor&&e.constructor.name==="Uint8Array"}function uze(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function YSe(e){return e instanceof Int16Array||e&&e.constructor&&e.constructor.name==="Int16Array"}function $se(e){return e instanceof Uint16Array||e&&e.constructor&&e.constructor.name==="Uint16Array"}function ZSe(e){return e instanceof Int32Array||e&&e.constructor&&e.constructor.name==="Int32Array"}function Dse(e){return e instanceof Uint32Array||e&&e.constructor&&e.constructor.name==="Uint32Array"}function Lse(e){return e instanceof Float32Array||e&&e.constructor&&e.constructor.name==="Float32Array"}function Nse(e){return e instanceof Float64Array||e&&e.constructor&&e.constructor.name==="Float64Array"}function dze(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}function Q4(e){return C(e)?0:128+e.buffer.byteLength+64}function JSe(e,t){let r;if(t)for(r in e)e.hasOwnProperty(r)&&(e[r]===void 0?delete e[r]:e[r]instanceof Object&&JSe(e[r],!0));else for(r in e)e.hasOwnProperty(r)&&e[r]===void 0&&delete e[r];return e}function ne(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=t2e(e);if(v(t))return t;if(KSe(e))return e.clone();if(QSe(e))return e.map(ne);if(e2e(e))return e.clone();const r={};for(const i of Object.getOwnPropertyNames(e))r[i]=ne(e[i]);return r}function XZ(e){if(!e||typeof e!="object"||typeof e=="function"||"HTMLElement"in globalThis&&e instanceof HTMLElement)return e;const t=t2e(e);if(v(t))return t;if(QSe(e)){let r=!0;const i=e.map(s=>{const n=XZ(s);return s!=null&&n==null&&(r=!1),n});return r?i:null}if(KSe(e))return e.clone();if(!e2e(e)){const r=new(Object.getPrototypeOf(e)).constructor;for(const i of Object.getOwnPropertyNames(e)){const s=e[i],n=XZ(s);if(s!=null&&n==null)return null;r[i]=n}return r}return null}function KSe(e){return typeof e.clone=="function"}function QSe(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function e2e(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function Zde(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function t2e(e){if(cze(e)||XS(e)||uze(e)||YSe(e)||$se(e)||ZSe(e)||Dse(e)||Lse(e)||Nse(e))return Pse(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;for(const[r,i]of e)t.set(r,ne(i));return t}if(e instanceof Set){const t=new Set;for(const r of e)t.add(ne(r));return t}return null}function Fse(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function hze(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&Bv(e,t):e instanceof Set?t instanceof Set&&fze(e,t):e instanceof Map?t instanceof Map&&mze(e,t):!!Zde(e)&&Zde(t)&&pze(e,t))}function pze(e,t){if(e===null||t===null)return!1;const r=Object.keys(e);if(t===null||Object.keys(t).length!==r.length)return!1;for(const i of r)if(e[i]!==t[i]||!Object.prototype.hasOwnProperty.call(t,i))return!1;return!0}function fze(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}function mze(e,t){if(e.size!==t.size)return!1;for(const[r,i]of e){const s=t.get(r);if(s!==i||s===void 0&&!t.has(r))return!1}return!0}function r2e(e,t,r=!1){return s2e(e,t,r)}function ZE(e,t){if(t!=null)return t[e]||i2e(e.split("."),!1,t)}function Vl(e,t,r){const i=e.split("."),s=i.pop(),n=i2e(i,!0,r);n&&s&&(n[s]=t)}function i2e(e,t,r){let i=r;for(const s of e){if(i==null)return;if(!(s in i)){if(!t)return;i[s]={}}i=i[s]}return i}function s2e(e,t,r){return t?Object.keys(t).reduce((i,s)=>{let n=i[s],o=t[s];return n===o?i:n===void 0?(i[s]=ne(o),i):(Array.isArray(o)||Array.isArray(i)?(n=n?Array.isArray(n)?i[s]=n.concat():i[s]=[n]:i[s]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{n.includes(a)||n.push(a)}):i[s]=o.concat())):o&&typeof o=="object"?i[s]=s2e(n,o,r):i.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(i[s]=o),i)},e||{}):e}var Ixe;const Gr={analysisTheme:{accentColor:[255,128,0],textColor:"white"},apiKey:void 0,applicationUrl:(Ixe=globalThis.location)==null?void 0:Ixe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(r2e(Gr,globalThis.esriConfig,!0),delete Gr.has),!Gr.assetsPath){{const e="4.25.5";Gr.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}Gr.defaultAssetsPath=Gr.assetsPath}const gze=/\{([^\}]+)\}/g;function Jde(e){return e!=null?e:""}function g0(e,t){return e.replace(gze,typeof t=="object"?(r,i)=>Jde(ZE(i,t)):(r,i)=>Jde(t(i)))}function yze(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>t&&t.includes(r)?r:`\\${r}`)}function kse(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}function Ukt(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const Kde={info:0,warn:1,error:2,none:3};class te{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,te._loggers[this.module]=this;const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=te.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const r=te._loggers;return te._loggers=t,r},set throttlingDisabled(t){te._throttlingDisabled=t}}}static getLogger(t){let r=te._loggers[t];return r||(r=new te({module:t})),r}_log(t,r,...i){if(!!this._matchLevel(t)){if(r!=="always"&&!te._throttlingDisabled){const s=this._argsToKey(i),n=this._loggedMessages[t].get(s);if(r==="once"&&n!=null||r==="oncePerTick"&&n&&n>=te._tickCounter)return;this._loggedMessages[t].set(s,te._tickCounter),te._scheduleTickCounterIncrement()}for(const s of Gr.log.interceptors)if(s(t,this.module,...i))return;this._inheritedWriter()(t,this.module,...i)}}_parentWithMember(t,r){let i=this;for(;v(i);){const s=i[t];if(v(s))return s;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,r,...i){console[t](`[${r}]`,...i)}_matchLevel(t){const r=Gr.log.level?Gr.log.level:"warn";return Kde[this._parentWithMember("level",r)]<=Kde[t]}_argsToKey(...t){const r=(i,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return kse(JSON.stringify(t,r))}static _scheduleTickCounterIncrement(){te._tickCounterScheduled||(te._tickCounterScheduled=!0,Promise.resolve().then(()=>{te._tickCounter++,te._tickCounterScheduled=!1}))}}te._loggers={},te._tickCounter=0,te._tickCounterScheduled=!1,te._throttlingDisabled=!1;function _ze(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>{if(i==="")return"$";const s=ZE(i,t),n=s!=null?s:"";if(n===void 0)throw new Error(`could not find key "${i}" in template`);return n.toString()})}class k9{constructor(t,r,i){var s;this.name=t,this.details=i,this instanceof k9&&(this.message=(s=r&&_ze(r,i))!=null?s:"")}toString(){return"["+this.name+"]: "+this.message}}class z extends k9{constructor(t,r,i){if(super(t,r,i),!(this instanceof z))return new z(t,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return ne(r)}catch{return"[object]"}}))}}catch(t){throw te.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new z(t.name,t.message,t.details)}}z.prototype.type="error";function oi(e="Aborted"){return new z("AbortError",e)}function Ir(e,t="Aborted"){if(Bo(e))throw oi(t)}function U9(e){return v(e)?"aborted"in e?e:e.signal:e}function Bo(e){const t=U9(e);return v(t)&&t.aborted}function zh(e){if(Ps(e))throw e}function YZ(e){if(!Ps(e))throw e}function jl(e,t){const r=U9(e);if(!C(r)){if(!r.aborted)return HSe(r,"abort",()=>t());t()}}function Use(e,t){const r=U9(e);if(!C(r))return Ir(r),HSe(r,"abort",()=>t(oi()))}function vze(e,t){const r=U9(t);return C(r)?e:new Promise((i,s)=>{let n=jl(t,()=>s(oi()));const o=()=>n=Gs(n);e.then(o,o),e.then(i,s)})}function Ps(e){return(e==null?void 0:e.name)==="AbortError"}async function wM(e){try{return await e}catch(t){if(!Ps(t))throw t;return}}async function Bkt(e,t=te.getLogger("esri")){try{return await e}catch(r){Ps(r)||t.error(r)}}function gx(){let e=null;const t=new Promise((r,i)=>{e={promise:void 0,resolve:r,reject:i}});return e.promise=t,e}async function zo(e){if(!e)return;if(typeof e.forEach!="function"){const r=Object.keys(e),i=r.map(o=>e[o]),s=await zo(i),n={};return r.map((o,a)=>n[o]=s[a]),n}const t=e;return new Promise(r=>{const i=[];let s=t.length;s===0&&r(i),t.forEach(n=>{const o={promise:n||Promise.resolve(n)};i.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&r(i)})})})}async function ZZ(e){return(await zo(e)).filter(t=>!!t.value).map(t=>t.value)}function yx(e,t,r){const i=new AbortController;return jl(r,()=>i.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);jl(i,()=>{o&&(clearTimeout(o),n(oi()))})})}function np(e){return e&&typeof e.then=="function"}function JZ(e){return np(e)?e:Promise.resolve(e)}function Bse(e,t=-1){let r,i,s,n,o=null;const a=(...l)=>{if(r){i=l,n&&n.reject(oi()),n=gx();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||gx(),n=null,t>0){const f=new AbortController;r=JZ(e(...l,f.signal));const m=r;yx(t).then(()=>{r===m&&(n?f.abort():o=f)})}else r=1,r=JZ(e(...l));const c=()=>{const f=i;i=s=r=o=null,f!=null&&a(...f)},d=r,p=s;return d.then(c,c),d.then(p.resolve,p.reject),p.promise};return a}function _x(){let e,t;const r=new Promise((s,n)=>{e=s,t=n}),i=s=>{e(s)};return i.resolve=s=>e(s),i.reject=s=>t(s),i.timeout=(s,n)=>F9.setTimeout(()=>i.reject(n),s),i.promise=r,i}function zkt(e,t){return e.then(t,t)}async function Qde(e){await Promise.resolve(),Ir(e)}function bze(e){return e&&e.release&&typeof e.release=="function"}function wze(e){return e&&e.acquire&&typeof e.acquire=="function"}class ro{constructor(t,r,i,s=1,n=0){if(this._ctor=t,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this._ctor)for(let o=0;o<n;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let r;if(ro.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let s=0;s<i;s++)this._pool[s]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...t):wze(r)&&r.acquire(...t),r}release(t){t&&!ro.test.disabled&&(this._releaseFunction?this._releaseFunction(t):bze(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let r=t;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}ro.test={disabled:!1};function xze(e){e.length=0}class yd{constructor(t=50,r=50){this._pool=new ro(Array,void 0,xze,r,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return RH.acquire()}static release(t){return RH.release(t)}static prune(){RH.prune()}}const RH=new yd(100);class n2e extends ro{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=eE(this._set)}acquire(...t){const r=super.acquire(...t);return this._set.delete(r),r}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const e5=[];function lR(e){e5.push(e),e5.length===1&&queueMicrotask(()=>{const t=e5.slice();e5.length=0;for(const r of t)r()})}class fv{constructor(t,r=30){this.name=t,this._counter=0,this._samples=new Array(r)}record(t){v(t)&&(this._samples[++this._counter%this._samples.length]=t)}get median(){return this._samples.slice().sort((t,r)=>t-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((t,r)=>t+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}}var KZ;(function(e){const t=(n,o,a,l)=>{let c=o,d=o;const p=a>>>1,f=n[c-1];for(;d<=p;){d=c<<1,d<a&&l(n[d-1],n[d])<0&&++d;const m=n[d-1];if(l(m,f)<=0)break;n[c-1]=m,c=d}n[c-1]=f},r=(n,o)=>n<o?-1:n>o?1:0;function i(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let d=a>>>1;d>o;d--)t(n,d,a,l);const c=o+1;for(let d=a-1;d>o;d--){const p=n[o];n[o]=n[d],n[d]=p,t(n,c,d,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=r);for(let d=a>>>1;d>o;d--)t(n,d,a,l),yield;const c=o+1;for(let d=a-1;d>o;d--){const p=n[o];n[o]=n[d],n[d]=p,t(n,c,d,l),yield}}e.sort=i,e.iterableSort=s})(KZ||(KZ={}));const ehe=KZ,Tze=1.5,Sze=1.1;class Qt{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new WSe,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>the(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const r=new Array;for(let i=0;i<this._length;i++){const s=this.data[i];t(s)&&r.push(s)}return r}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,r){const i=this.data.indexOf(t,r);return i!==-1&&i<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let r=t;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,r=t.length){for(let i=0;i<r;i++)this.data[this._length++]=t[i]}fill(t,r){for(let i=0;i<r;i++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,the(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const r=WZ(this.data,t,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,t}removeUnordered(t){return this.removeUnorderedIndex(WZ(this.data,t,this.length,this._hint))}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,r=t.length,i){this.length=oze(this.data,t,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,r){if(t>=this.length||r>=this.length||t===r)return;const i=this.data[t];this.data[t]=this.data[r],this.data[r]=i}sort(t){ehe.sort(this.data,0,this.length,t)}iterableSort(t){return ehe.iterableSort(this.data,0,this.length,t)}some(t,r){for(let i=0;i<this.length;++i)if(t.call(r,this.data[i],i,this.data))return!0;return!1}filterInPlace(t,r){let i=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(r,n,s,this.data)&&(this.data[s]=this.data[i],this.data[i]=n,i++)}if(this._deallocator)for(let s=i;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=i,this._shrink(),this}forAll(t,r){const i=this.length,s=this.data;for(let n=0;n<i;++n)t.call(r,s[n],n,s)}forEach(t,r){for(let i=0;i<this.length;++i)t.call(r,this.data[i],i,this.data)}map(t,r){const i=new Array(this.length);for(let s=0;s<this.length;++s)i[s]=t.call(r,this.data[s],s,this.data);return i}reduce(t,r){let i=r;for(let s=0;s<this.length;++s)i=t(i,this.data[s],s,this.data);return i}has(t){const r=this.length,i=this.data;for(let s=0;s<r;++s)if(i[s]===t)return!0;return!1}}function the(e){e.data.length>Tze*e.length&&(e.data.length=Math.floor(e.length*Sze))}function Vkt(e){return e}function o2e(e){return 1e3*e}function zse(e){return .001*e}class Eze{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class Cze{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let QZ=0,eJ=0;const oP={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},tJ=["prepare","preRender","render","postRender","update","finish"],rJ=[],tE=new Qt;class Aze{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const G8={frameTasks:tE,willDispatch:!1,clearFrameTasks:Oze,dispatch:c2e,executeFrameTasks:Rze};function JE(e){const t=new Cze(e);return rJ.push(t),G8.willDispatch||(G8.willDispatch=!0,lR(c2e)),t}function cR(e){const t=new Eze(e);return tE.push(t),H8==null&&(QZ=performance.now(),H8=requestAnimationFrame(a2e)),new Aze(t)}let H8=null;function Oze(e=!1){tE.forAll(t=>{t.removed=!0}),e&&l2e()}function Mze(e){eJ=Math.max(0,e)}function a2e(){const e=performance.now();H8=null,H8=tE.length>0?requestAnimationFrame(a2e):null,G8.executeFrameTasks(e)}function Rze(e){const t=e-QZ;QZ=e;const r=eJ>0?eJ:1e3/60,i=Math.max(0,t-r);for(let s=0;s<tJ.length;s++){const n=performance.now(),o=tJ[s];tE.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(oP.time=e,oP.deltaTime=a.ticks===0?0:t,oP.elapsedFrameTime=performance.now()-e,oP.frameDuration=r-i,(l=a.phases[o])==null||l.call(a,oP)))}),Ize[s].record(performance.now()-n)}l2e(),Pze.record(performance.now()-e)}const t5=new Qt;function l2e(){tE.forAll(e=>{e.removed&&t5.push(e)}),tE.removeUnorderedMany(t5.data,t5.length),t5.clear()}function c2e(){for(;rJ.length;){const e=rJ.shift();e.isActive&&e.callback()}G8.willDispatch=!1}function jkt(e=1,t){const r=_x(),i=()=>{Bo(t)?r.reject(oi()):e===0?r():(--e,lR(()=>i()))};return i(),r.promise}const Ize=tJ.map(e=>new fv(e)),Pze=new fv("total");function g6(e,t){for(const r of e.entries())if(t(r[0]))return!0;return!1}let $ze=0;const Dze=0;function Su(){return++$ze}function Gl(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function Lze(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function y6(e,t,r){return r?q8(e,t,{policy:r,path:""}):q8(e,t,null)}function q8(e,t,r){return t?Object.keys(t).reduce((i,s)=>{let n=null,o="merge";if(r&&(n=r.path?`${r.path}.${s}`:s,o=r.policy(n)),o==="replace")return i[s]=t[s],i;if(i[s]===void 0)return i[s]=ne(t[s]),i;let a=i[s],l=t[s];if(a===l)return i;if(Array.isArray(l)||Array.isArray(i))a=a?Array.isArray(a)?i[s]=a.concat():i[s]=[a]:i[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(r){const c=r.path;r.path=n,i[s]=q8(a,l,r),r.path=c}else i[s]=q8(a,l,null);else i.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(i[s]=l);return i},e||{}):e}function u2e(e){return Array.isArray(e)?e:e.split(".")}function rhe(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function Nze(e){if(Array.isArray(e)){const t=[];for(const r of e)t.push(...rhe(r));return t}return rhe(e)}function d2e(e,t,r,i){const s=Nze(t);if(s.length!==1){const n=s.map(o=>i(e,o,r));return aR(n)}return i(e,s[0],r)}function Vse(e){let t=!1;return()=>{t||(t=!0,e())}}function h2e(e,t){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const i=Gl(t);return Lze(i,r)?i.get(r):t[r]}function p2e(e,t,r){if(e==null)return e;const i=h2e(t[r],e);return!i&&r<t.length-1?void 0:r===t.length-1?i:p2e(i,t,r+1)}function MF(e,t,r=0){return typeof t!="string"||t.includes(".")?p2e(e,u2e(t),r):h2e(t,e)}function W8(e,t){return MF(e,t)}function ihe(e,t){return MF(t,e)!==void 0}var us;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(us||(us={}));const X8={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},M3=[];let _D=X8;function Rr(e){_D.onObservableAccessed(e)}let _6=!1,v6=!1;function zv(e,t,r){if(_6)return jse(e,t,r);f2e(e);const i=t.call(r);return m2e(),i}function Fze(e,t){return zv(X8,e,t)}function jse(e,t,r){const i=_6;_6=!0,f2e(e);let s=null;try{s=t.call(r)}catch(n){v6&&te.getLogger("esri.core.accessorSupport.tracking").error(n)}return m2e(),_6=i,s}function f2e(e){_D=e,M3.push(e)}function m2e(){const e=M3.length;if(e>1){const t=M3.pop();_D=M3[e-2],t.onTrackingEnd()}else if(e===1){const t=M3.pop();_D=X8,t.onTrackingEnd()}else _D=X8}function g2e(e,t){if(t.flags&us.DepTrackingInitialized)return;const r=v6;v6=!1,t.flags&us.AutoTracked?jse(t,t.metadata.get,e):y2e(e,t),v6=r}const kze=[];function y2e(e,t){t.flags&us.ExplicitlyTracking||(t.flags|=us.ExplicitlyTracking,jse(t,()=>{const r=t.metadata.dependsOn||kze;for(const i of r)if(typeof i!="string"||i.includes(".")){const s=u2e(i);for(let n=0,o=e;n<s.length&&o!=null&&typeof o=="object";++n)o=she(o,s[n],n!==s.length-1)}else she(e,i,!1)}),t.flags&=~us.ExplicitlyTracking)}function she(e,t,r){var n;const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const o=parseInt(i,10);if(!isNaN(o))return Array.isArray(e)?e[o]:e.getItemAt(o)}const s=(n=Gl(e))==null?void 0:n.properties.get(i);return s&&(Rr(s),g2e(e,s)),r?e[i]:void 0}class B9{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}onObservableAccessed(t){this._accessed.includes(t)||this._accessed.push(t)}onTrackingEnd(){const t=this._handles,r=this._accessed;for(let i=0;i<r.length;++i)t.push(r[i].observe(this));r.length=0}clear(){const t=this._handles;for(let r=0;r<t.length;++r)t[r].remove();t.length=0}}let xM=!1;const Y8=[];function _2e(e,t){let r=new B9(n),i=null,s=!1;function n(){if(!r||s)return;if(xM)return void w2e(n);const a=i;r.clear(),xM=!0,s=!0,i=zv(r,e),s=!1,xM=!1,t(i,a),x2e()}function o(){r&&(r.destroy(),r=null,i=null)}return s=!0,i=zv(r,e),s=!1,{remove:o}}function v2e(e,t){let r=new B9(s),i=null;function s(){t(i,o)}function n(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=zv(r,e),i):null}return o(),{remove:n}}function b2e(e){let t=new B9(i),r=!1;function i(){t&&!r&&(xM?w2e(i):(t.clear(),xM=!0,r=!0,zv(t,e),r=!1,xM=!1,x2e()))}function s(){t&&(t.destroy(),t=null)}return r=!0,zv(t,e),r=!1,{remove:s}}function w2e(e){Y8.includes(e)||Y8.unshift(e)}function x2e(){for(;Y8.length;)Y8.pop()()}var vD;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(vD||(vD={}));class jL{constructor(){this.uid=Su(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,r,i,s,n){return this.pool.acquire(vD.Untracked,t,r,i,s,n,Fse)}static acquireTracked(t,r,i,s){return this.pool.acquire(vD.Tracked,t,r,i,null,null,s)}notify(t,r){this.type===vD.Untracked?this.callback.call(this.target,t,r,this.path,this.target):this.callback.call(null,t,r)}acquire(t,r,i,s,n,o,a){this.uid=Su(),this.removed=!1,this.type=t,this.oldValue=r,this.callback=i,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Su(),this.removed=!0}}jL.pool=new n2e(jL);const b6=new yd,wv=new Set;let Z8;function J8(e){wv.delete(e),wv.add(e),Z8||(Z8=JE(zze))}function Uze(e){if(e.removed)return;const t=e.oldValue,r=e.getValue();e.equals(t,r)||(e.oldValue=r,e.notify(r,t))}function Bze(e){for(const t of wv.values())t.target===e&&(t.removed=!0)}function zze(){let e=10;for(;Z8&&e--;){Z8=null;const t=Vze(),r=b6.acquire();for(const i of t){const s=i.uid;Uze(i),s===i.uid&&i.removed&&r.push(i)}for(const i of wv)i.removed&&(r.push(i),wv.delete(i));for(const i of r)jL.pool.release(i);b6.release(r),b6.release(t),iJ.forEach(i=>i())}}function Vze(){const e=b6.acquire();e.length=wv.size;let t=0;for(const r of wv)e[t]=r,++t;return wv.clear(),e}const iJ=new Set;function T2e(e){return iJ.add(e),{remove(){iJ.delete(e)}}}function jze(e,t,r){let i=d2e(e,t,r,(s,n,o)=>{let a,l,c=v2e(()=>MF(s,n),(d,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=jL.acquireUntracked(d,o,p,s,n),l=a.uid),J8(a))});return{remove:Vse(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,J8(a)),a=null),i=c=null})}});return i}function Gze(e,t,r){const i=d2e(e,t,r,(s,n,o)=>{let a=!1;return _2e(()=>MF(s,n),(l,c)=>{s.__accessor__.destroyed?i.remove():a||(a=!0,Fse(c,l)||o.call(s,l,c,n,s),a=!1)})});return i}function Hze(e,t,r,i=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:i?Gze(e,t,r):jze(e,t,r)}function qze(e,t,r){let i,s,n=v2e(e,(o,a)=>{i&&i.uid!==s?n.remove():(i||(i=jL.acquireTracked(o,t,a,r),s=i.uid),J8(i))});return{remove:Vse(()=>{n.remove(),i&&(i.uid!==s||i.removed||(i.removed=!0,J8(i)),i=null),n=null})}}function Wze(e,t,r){let i=!1;return _2e(e,(s,n)=>{i||(i=!0,r(n,s)||t(s,n),i=!1)})}function Xze(e,t,r=!1,i=hze){return r?Wze(e,t,i):qze(e,t,i)}function nhe(e){return g6(wv,t=>t.oldValue===e)}function ie(e,t,r={}){return Gse(e,t,r,S2e)}function no(e,t,r={}){return Gse(e,t,r,E2e)}function Gse(e,t,r={},i){let s=null;const n=r.once?(o,a)=>{i(o)&&(Gs(s),t(o,a))}:(o,a)=>{i(o)&&t(o,a)};if(s=Xze(e,n,r.sync,r.equals),r.initial){const o=e();n(o,o)}return s}function ms(e,t,r,i={}){let s=null,n=null,o=null;function a(){var d;s&&n&&(n.remove(),(d=i.onListenerRemove)==null||d.call(i,s),s=null,n=null)}function l(d){i.once&&i.once&&Gs(o),r(d)}const c=ie(e,(d,p)=>{var f;a(),N9(d)&&(s=d,n=mx(d,t,l),(f=i.onListenerAdd)==null||f.call(i,d))},{sync:i.sync,initial:!0});return o=cg(()=>{c.remove(),a()}),o}function vx(e,t){return Yze(e,E2e,t)}function Yze(e,t,r){if(Bo(r))return Promise.reject(oi());const i=e();if(t!=null&&t(i))return Promise.resolve(i);let s=null;function n(){s=Gs(s)}return new Promise((o,a)=>{s=aR([jl(r,()=>{n(),a(oi())}),Gse(e,l=>{n(),o(l)},{sync:!1,once:!0},t!=null?t:S2e)])})}function S2e(e){return!0}function E2e(e){return!!e}function Zze(e,t,r={}){let i=!1;const s=ie(e,(n,o)=>{i||t(n,o)},r);return{remove(){s.remove()},pause(){i=!0},resume(){i=!1}}}const bi={sync:!0},pt={initial:!0},Qi={sync:!0,initial:!0};function wo(e,t){for(const[r,i]of e)if(t(i,r))return!0;return!1}function Gkt(e,t){for(const[r,i]of e)if(t(i,r))return i;return null}function Hse(e,t,r){const i=e.get(t);if(i!==void 0)return i;const s=r();return e.set(t,s),s}const TM=te.getLogger("esri.core.accessorSupport.ensureTypes");function Jze(e){return e==null?e:new Date(e)}function Kze(e){return e==null?e:!!e}function RF(e){return e==null?e:e.toString()}function Xp(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function qse(e){return e==null?e:Math.round(parseFloat(e))}function C2e(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function K8(e,t){return t!=null&&e&&!(t instanceof e)}function A2e(e){return e&&"isCollection"in e}function ohe(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function Qze(e,t){if(!t||!t.constructor||!A2e(t.constructor))return sJ(e,t)?t:new e(t);const r=ohe(e.prototype.itemType),i=ohe(t.constructor.prototype.itemType);return r?i?r===i?t:r.prototype.isPrototypeOf(i.prototype)?new e(t):(sJ(e,t),t):new e(t):t}function sJ(e,t){return!!C2e(t)&&(TM.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+z9(e)+"'"),!0)}function rE(e,t){return t==null?t:A2e(e)?Qze(e,t):K8(e,t)?sJ(e,t)?t:new e(t):t}function z9(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const eVe=new WeakMap;function tVe(e){switch(e){case Number:return Xp;case bs:return qse;case Boolean:return Kze;case String:return RF;case Date:return Jze;default:return Hse(eVe,e,()=>rE.bind(null,e))}}function ts(e,t){const r=tVe(e);return arguments.length===1?r:r(t)}function GL(e,t,r){return arguments.length===1?GL.bind(null,e):t&&(Array.isArray(t)?t.map(i=>e(i,r)):[e(t,r)])}function rVe(e,t){return arguments.length===1?GL(ts.bind(null,e)):GL(ts.bind(null,e),t)}function O2e(e,t,r){return t!==0&&Array.isArray(r)?r.map(i=>O2e(e,t-1,i)):e(r)}function Q8(e,t,r){if(arguments.length===2)return Q8.bind(null,e,t);if(!r)return r;let i=t,s=r=O2e(e,t,r);for(;i>0&&Array.isArray(s);)i--,s=s[0];if(s!==void 0)for(let n=0;n<i;n++)r=[r];return r}function iVe(e,t,r){return arguments.length===2?Q8(ts.bind(null,e),t):Q8(ts.bind(null,e),t,r)}function M2e(e){return!!Array.isArray(e)&&!e.some(t=>{const r=typeof t;return!(r==="string"||r==="number"||r==="function"&&e.length>1)})}function nJ(e,t){if(arguments.length===2)return nJ(e).call(null,t);const r=new Set,i=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||r.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,d=c==="string"||c==="number";return d&&(r.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!K8(a,p))?a:(d&&i.length?(n||(n=i.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),TM.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>z9(p)).join(", ")),TM.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):TM.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function ug(e,t){if(arguments.length===2)return ug(e).call(null,t);const r={},i=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];r[l]=ts(c),i.push(z9(c)),s.push(l)}const n=()=>`'${i.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!K8(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,d=r[c];if(!d)return TM.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!K8(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!C2e(l)){const p={};for(const f in l)f!==e.key&&(p[f]=l[f]);return d(p)}return d(l)}}class bs{}const Hkt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function sVe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function R2e(e){switch(e.type){case"native":return ts(e.value);case"array":return GL(R2e(e.value));case"one-of":return nVe(e);default:return null}}function nVe(e){let t=null;return(r,i)=>aJ(r,e)?r:(t==null&&(t=oJ(e)),TM.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),i&&(i.valid=!1),null)}function oJ(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case bs:return"integer";case Date:return"date";default:return z9(e.value)}case"array":return`array of ${oJ(e.value)}`;case"one-of":{const t=e.values.map(r=>oJ(r));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function aJ(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case bs:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(r=>!aJ(r,t.value));case"one-of":return t.values.some(r=>aJ(e,r))}}class ahe{constructor(t){this.autoDestroy=!1,this.properties=t}}function IF(e){let t=e.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!r){const i=Object.create(t.properties),s=t.autoDestroy;for(const n in i)i[n]=ne(i[n]);t=new ahe(i),t.autoDestroy=s,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new ahe({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function oVe(e){return IF(e).properties}function PF(e,t){const r=oVe(e);let i=r[t];return i||(i=r[t]={}),i}function aVe(e,t){return y6(e,t,cVe)}const lVe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function cVe(e){return lVe.test(e)?"replace":"merge"}function ez(e,t,r){if(e&&t)if(typeof t=="object")for(const i of Object.getOwnPropertyNames(t))ez(e,i,t[i]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void ez(W8(e,s),n,r)}const i=e.__accessor__;i!=null&&uVe(t,i),e[t]=r}}function uVe(e,t){if(pe("esri-unknown-property-errors")&&!dVe(e,t))throw new z("set:unknown-property",hVe(e,t))}function dVe(e,t){return t.metadatas[e]!=null}function hVe(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}function h(e={}){return(t,r)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(t,r),s=PF(t,r);i&&(i.get||i.set?(s.get=i.get||s.get,s.set=i.set||s.set):"value"in i&&("value"in e&&te.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=i.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let d;s.dependsOn=[l],s.get=function(){let p=W8(this,l);if(typeof p=="function"){d||(d=l.split(".").slice(0,-1).join("."));const f=W8(this,d);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){this._override(r,p)}:function(p){ez(this,l,p)})}const o=e.type,a=e.types;s.cast||(o?s.cast=pVe(o):a&&(Array.isArray(a)?s.cast=GL(ug(a[0])):s.cast=ug(a))),aVe(s,e),e.range&&(s.cast=fVe(s.cast,e.range))}}function Wse(e,t,r){const i=PF(e,r);i.json||(i.json={});let s=i.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function pVe(e){let t=0,r=e;if(sVe(e))return R2e(e);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],t++;const i=r;if(M2e(i))return t===0?nJ(i):Q8(nJ(i),t);if(t===1)return rVe(i);if(t>1)return iVe(i,t);const s=e;return s.from?s.from:ts(s)}function fVe(e,t){return r=>{let i=+e(r);return t.step!=null&&(i=Math.round(i/t.step)*t.step),t.min!=null&&(i=Math.max(t.min,i)),t.max!=null&&(i=Math.min(t.max,i)),i}}const mVe=Object.prototype.toString;function gVe(e){const t="__accessorMetadata__"in e?ts(e):e;return function(...r){if(r.push(t),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return yVe.apply(this,r)}}function yVe(e,t,r,i){PF(e,t).cast=i}function _Ve(e){return(t,r)=>{PF(t,e).cast=t[r]}}function Gt(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&mVe.call(e[0])==="[object Function]"?gVe(e[0]):e.length===1&&typeof e[0]=="string"?_Ve(e[0]):void 0}var lv;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(lv||(lv={}));function vVe(e){if(e.json&&e.json.origins){const t=e.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(t[i]){const s=t[i];r[i].forEach(n=>{t[n]=s}),delete t[i]}}}class Ou extends k9{constructor(t,r,i){if(super(t,r,i),!(this instanceof Ou))return new Ou(t,r,i)}}Ou.prototype.type="warning";function I2e(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const lJ=te.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function lhe(e,t,r){var i,s;e&&(!r&&!t.read||((i=t.read)==null?void 0:i.reader)||((s=t.read)==null?void 0:s.enabled)===!1||xVe(e)&&Vl("read.reader",Wx(e),t))}function Wx(e){var r,i,s;const t=(r=e.ndimArray)!=null?r:0;if(t>1)return wVe(e);if(t===1)return che(e);if("type"in e&&$2e(e.type)){const n=(s=(i=e.type.prototype)==null?void 0:i.itemType)==null?void 0:s.Type,o=che(typeof n=="function"?{type:n}:{types:n});return(a,l,c)=>{const d=o(a,l,c);return d&&new e.type(d)}}return Xse(e)}function Xse(e){return"type"in e?bVe(e.type):TVe(e.types)}function bVe(e){return e.prototype.read?(t,r,i)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void lJ.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,i),n}:e.fromJSON}function P2e(e,t,r,i){return i!==0&&Array.isArray(t)?t.map(s=>P2e(e,s,r,i-1)):e(t,void 0,r)}function wVe(e){var s;const t=Xse(e),r=P2e.bind(null,t),i=(s=e.ndimArray)!=null?s:0;return(n,o,a)=>{if(n==null)return n;n=r(n,a,i);let l=i,c=n;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let d=0;d<l;d++)n=[n];return n}}function che(e){const t=Xse(e);return(r,i,s)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(r,void 0,s);return n!==void 0?[n]:void 0}}function $2e(e){if(!I2e(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?Yse(t.Type):D2e(t.Type))}function xVe(e){return"types"in e?D2e(e.types):Yse(e.type)}function Yse(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||$2e(e))}function D2e(e){for(const t in e.typeMap)if(!Yse(e.typeMap[t]))return!1;return!0}function TVe(e){var i;let t=null;const r=(i=e.errorContext)!=null?i:"type";return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void lJ.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);t||(t=SVe(e));const l=e.key;if(typeof l!="string")return;const c=s[l],d=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!d){const f=`Type '${c||"unknown"}' is not supported`;return o&&o.messages&&s&&o.messages.push(new Ou(`${r}:unsupported`,f,{definition:s,context:o})),void lJ.error(f)}const p=new d;return p.read(s,o),p}}function SVe(e){var r,i;const t={};for(const s in e.typeMap){const n=e.typeMap[s],o=IF(n.prototype);if(typeof e.key=="function")continue;const a=o.properties[e.key];if(!a)continue;((r=a.json)==null?void 0:r.type)&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(t[a.json.type[0]]=n);const l=(i=a.json)==null?void 0:i.write;if(!l||!l.writer){t[s]=n;continue}const c=l.target,d=typeof c=="string"?c:e.key,p={};l.writer(s,p,d),p[d]&&(t[p[d]]=n)}return t}function EVe(e){if(e.json||(e.json={}),dhe(e.json),hhe(e.json),uhe(e.json),e.json.origins)for(const t in e.json.origins)dhe(e.json.origins[t]),hhe(e.json.origins[t]),uhe(e.json.origins[t]);return!0}function uhe(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function dhe(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function hhe(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}function phe(e,t){var i;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const r=(i=e==null?void 0:e.ndimArray)!=null?i:0;e&&(r===1||"type"in e&&I2e(e.type))?t.write.writer=OVe:r>1?t.write.writer=MVe(r):t.types?Array.isArray(t.types)?t.write.writer=AVe(t.types[0]):t.write.writer=CVe(t.types):t.write.writer=HL}function CVe(e){return(t,r,i,s)=>t?L2e(t,e,s)?HL(t,r,i,s):void 0:HL(t,r,i,s)}function L2e(e,t,r){var i,s;for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(r!=null&&r.messages){const n=(i=t.errorContext)!=null?i:"type",o=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;r&&r.messages&&e&&r.messages.push(new z(`${n}:unsupported`,o,{definition:e,context:r})),te.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(o)}return!1}function AVe(e){return(t,r,i,s)=>!t||!Array.isArray(t)?HL(t,r,i,s):HL(t.filter(n=>L2e(n,e,s)),r,i,s)}function HL(e,t,r,i){Vl(r,tz(e,i),t)}function tz(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?rz(e):e}function rz(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function OVe(e,t,r,i){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>tz(n,i)),typeof s.toArray=="function"&&(s=s.toArray())):s=[tz(e,i)],Vl(r,s,t)}function N2e(e,t,r){return r!==0&&Array.isArray(e)?e.map(i=>N2e(i,t,r-1)):tz(e,t)}function MVe(e){return(t,r,i,s)=>{let n;if(t===null)n=null;else{n=N2e(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Vl(i,n,r)}}function cJ(e,t){return Zse(e,"read",t)}function F2e(e,t){return Zse(e,"write",t)}function Zse(e,t,r){let i=e&&e.json;if(e&&e.json&&e.json.origins&&r){const s=r.origin&&e.json.origins[r.origin];s&&(t==="any"||t in s)&&(i=s)}return i}function RVe(e){const t=IVe(e);if(e.json.origins)for(const r in e.json.origins){const i=e.json.origins[r],s=i.types?PVe(i):t;lhe(s,i,!1),i.types&&!i.write&&e.json.write&&e.json.write.enabled&&(i.write={...e.json.write}),phe(s,i)}lhe(t,e.json,!0),phe(t,e.json)}function IVe(e){return e.json.types?uJ(e.json):e.type?k2e(e):uJ(e)}function PVe(e){return e.type?k2e(e):uJ(e)}function k2e(e){if(!e.type)return;let t=0,r=e.type;for(;Array.isArray(r)&&!M2e(r);)r=r[0],t++;return{type:r,ndimArray:t}}function uJ(e){if(!e.types)return;let t=0,r=e.types;for(;Array.isArray(r);)r=r[0],t++;return{types:r,ndimArray:t}}function $Ve(e){EVe(e)&&(vVe(e),RVe(e))}const IH=new Set,PH=new Set;function I(e){return t=>{t.prototype.declaredClass=e,LVe(t);const r=[],i=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!IH.has(s.initialize)&&(IH.add(s.initialize),r.push(s.initialize)),s.hasOwnProperty("destroy")&&!PH.has(s.destroy)&&(PH.add(s.destroy),i.push(s.destroy)),s=Object.getPrototypeOf(s);IH.clear(),PH.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0;for(let c=0;c<i.length;c++)i[c].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=IF(t.prototype),n.prototype.declaredClass=e,n}}function DVe(e,t){return t.get==null?function(){const r=this.__accessor__.properties.get(e);if(r===void 0)return;Rr(r);const i=this.__accessor__.store;return i.has(e)?i.get(e):r.metadata.value}:function(){const r=this.__accessor__.properties.get(e);if(r!==void 0)return r.getComputed()}}function LVe(e){const t=e.prototype,r=IF(t).properties,i={};for(const s of Object.getOwnPropertyNames(r)){const n=r[s];$Ve(n),i[s]={enumerable:!0,configurable:!0,get:DVe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===lv.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,i)}class gr{constructor(t,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=t,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,s,n)=>{const o=this.toJSON(i);o!==void 0&&Vl(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(this._apiToJSON.hasOwnProperty(t)){const r=this._apiToJSON[t];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:t}fromJSON(t){return this._jsonToAPI.hasOwnProperty(t)?this._jsonToAPI[t]:this._options.ignoreUnknown?void 0:t}_invertMap(t){const r={};for(const i in t)r[t[i]]=i;return r}_getKeysSorted(t){const r=[];for(const i in t)r.push(i);return r.sort(),r}}function Br(){return function(e,t){return new gr(e,{ignoreUnknown:!0,...t})}}let bD;var Pxe,$xe,Dxe;const $H=(Dxe=(Pxe=globalThis.esriConfig)==null?void 0:Pxe.locale)!=null?Dxe:($xe=globalThis.dojoConfig)==null?void 0:$xe.locale;function U2e(){var e,t;return(t=$H!=null?$H:(e=globalThis.navigator)==null?void 0:e.language)!=null?t:"en"}function fl(){return bD===void 0&&(bD=U2e()),bD}function NVe(e=fl()){var t;return(t=/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(e))==null?void 0:t[1].toLowerCase()}const wD=[];function B2e(e){return wD.push(e),{remove(){wD.splice(wD.indexOf(e),1)}}}const dJ=[];function Jse(e){return dJ.push(e),{remove(){wD.splice(dJ.indexOf(e),1)}}}function FVe(){const e=U2e();bD!==e&&(bD=e,[...dJ].forEach(t=>{t.call(null,e)}),[...wD].forEach(t=>{t.call(null,e)}))}var Lxe;(Lxe=globalThis.addEventListener)==null||Lxe.call(globalThis,"languagechange",FVe);const Og={year:"numeric",month:"numeric",day:"numeric"},aP={year:"numeric",month:"long",day:"numeric"},lP={year:"numeric",month:"short",day:"numeric"},cP={year:"numeric",month:"long",weekday:"long",day:"numeric"},wp={hour:"numeric",minute:"numeric"},Uf={...wp,second:"numeric"},Kse={"short-date":Og,"short-date-short-time":{...Og,...wp},"short-date-short-time-24":{...Og,...wp,hour12:!1},"short-date-long-time":{...Og,...Uf},"short-date-long-time-24":{...Og,...Uf,hour12:!1},"short-date-le":Og,"short-date-le-short-time":{...Og,...wp},"short-date-le-short-time-24":{...Og,...wp,hour12:!1},"short-date-le-long-time":{...Og,...Uf},"short-date-le-long-time-24":{...Og,...Uf,hour12:!1},"long-month-day-year":aP,"long-month-day-year-short-time":{...aP,...wp},"long-month-day-year-short-time-24":{...aP,...wp,hour12:!1},"long-month-day-year-long-time":{...aP,...Uf},"long-month-day-year-long-time-24":{...aP,...Uf,hour12:!1},"day-short-month-year":lP,"day-short-month-year-short-time":{...lP,...wp},"day-short-month-year-short-time-24":{...lP,...wp,hour12:!1},"day-short-month-year-long-time":{...lP,...Uf},"day-short-month-year-long-time-24":{...lP,...Uf,hour12:!1},"long-date":cP,"long-date-short-time":{...cP,...wp},"long-date-short-time-24":{...cP,...wp,hour12:!1},"long-date-long-time":{...cP,...Uf},"long-date-long-time-24":{...cP,...Uf,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":wp,"long-time":Uf},qL=Br()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});qL.apiValues;qL.toJSON.bind(qL);qL.fromJSON.bind(qL);const kVe={ar:"ar-u-nu-latn-ca-gregory"};let hJ=new WeakMap,z2e=Kse["short-date-short-time"];function V2e(e){const t=e||z2e;let r=hJ.get(t);if(!r){const i=fl(),s=kVe[fl()]||i;r=new Intl.DateTimeFormat(s,t),hJ.set(t,r)}return r}function iE(e){return e?Kse[e]:null}function _s(e,t){return V2e(t).format(e)}Jse(()=>{hJ=new WeakMap,z2e=Kse["short-date-short-time"]});var Jr;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(Jr||(Jr={}));const pJ=Jr.USER+1;function mv(e){switch(e){case"defaults":return Jr.DEFAULTS;case"service":return Jr.SERVICE;case"portal-item":return Jr.PORTAL_ITEM;case"web-scene":return Jr.WEB_SCENE;case"web-map":return Jr.WEB_MAP;case"user":return Jr.USER;default:return null}}function iz(e){switch(e){case Jr.DEFAULTS:return"defaults";case Jr.SERVICE:return"service";case Jr.PORTAL_ITEM:return"portal-item";case Jr.WEB_SCENE:return"web-scene";case Jr.WEB_MAP:return"web-map";case Jr.USER:return"user"}return void 0}function UVe(e){return iz(e)}class j2e{constructor(t,r){this._observers=t,this._observer=r}remove(){Ise(this._observers,this._observer)}}class fhe{constructor(t,r,i){this.properties=t,this.propertyName=r,this.metadata=i,this._observers=null,this._accessed=null,this._handles=null,this.flags=us.Dirty|(i.nonNullable?us.NonNullable:0)|(i.hasOwnProperty("value")?us.HasDefaultValue:0)|(i.get===void 0?us.DepTrackingInitialized:0)|(i.dependsOn===void 0?us.AutoTracked:0)}destroy(){if(this.flags&us.Dirty&&this._observers){const t=this._observers.slice();for(const r of t)r.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){Rr(this);const t=this.properties.store,r=this.propertyName,i=this.flags,s=t.get(r);if(i&us.Computing||~i&us.Dirty&&t.has(r))return s;this.flags|=us.Computing;const n=this.properties.host;let o;i&us.AutoTracked?o=zv(this,this.metadata.get,n):(y2e(n,this),o=this.metadata.get.call(n)),t.set(r,o,Jr.COMPUTED);const a=t.get(r);return a===s?this.flags&=~us.Dirty:Fze(this.commit,this),this.flags&=~us.Computing,a}onObservableAccessed(t){t!==this&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=us.DepTrackingInitialized;const t=this._accessed;if(t===null)return;let r=this._handles;r===null&&(r=this._handles=[]);for(let i=0;i<t.length;++i)r.push(t[i].observe(this));t.length=0}observe(t){return this._observers===null&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new j2e(this._observers,t)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&us.Overriden&&(this.flags|=us.Dirty);const t=this._observers;if(t!==null)for(let r=0;r<t.length;++r)t[r].onInvalidated()}commit(){this.flags&=~us.Dirty,this.onCommitted()}onCommitted(){if(this._observers===null)return;const t=this._observers.slice();for(let r=0;r<t.length;++r)t[r].onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let r=0;r<t.length;++r)t[r].remove();t.length=0}}}class Qse{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new Qse;return this._values.forEach((i,s)=>{t&&t.has(s)||r.set(s,ne(i))}),r}get(t){return this._values.get(t)}originOf(){return Jr.USER}keys(){return[...this._values.keys()]}set(t,r){this._values.set(t,r)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function r5(e,t,r){return e!==void 0}function mhe(e,t,r,i){return e!==void 0&&(!(r==null&&e.flags&us.NonNullable)||(i.lifecycle,lv.INITIALIZING,!1))}function BVe(e){return e&&typeof e.destroy=="function"}te.getLogger("esri.core.accessorSupport.Properties");class zVe{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=lv.INITIALIZING,this.store=new Qse,this._origin=Jr.USER;const r=this.host.constructor.__accessorMetadata__,i=r.properties;for(const s in i){const n=new fhe(this,s,i[s]);this.properties.set(s,n)}this.metadatas=i,this._autoDestroy=r.autoDestroy}initialize(){this.lifecycle=lv.CONSTRUCTING}constructed(){this.lifecycle=lv.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[t,r]of this.properties){const i=this.internalGet(t);i&&BVe(i)&&(i.destroy(),~r.flags&us.NonNullable&&this._internalSet(r,null)),r.destroy()}else for(const[t,r]of this.properties)r.destroy()}get initialized(){return this.lifecycle!==lv.INITIALIZING}get(t){const r=this.properties.get(t);if(r.metadata.get)return r.getComputed();Rr(r);const i=this.store;return i.has(t)?i.get(t):r.metadata.value}originOf(t){const r=this.store.originOf(t);if(r===void 0){const i=this.properties.get(t);if(i!==void 0&&i.flags&us.HasDefaultValue)return"defaults"}return iz(r)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const r=this.properties.get(t);if(r5(r))return this.store.has(t)?this.store.get(t):r.metadata.value}internalSet(t,r){const i=this.properties.get(t);r5(i)&&this._internalSet(i,r)}getDependsInfo(t,r,i){const s=this.properties.get(r);if(!r5(s))return"";const n=new Set,o=zv({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(t)});let a=`${i}${t.declaredClass.split(".").pop()}.${r}: ${o}
`;if(n.size===0)return a;i+="  ";for(const l of n){if(!(l instanceof fhe))continue;const c=l.properties.host,d=l.propertyName,p=Gl(c);a+=p?p.getDependsInfo(c,d,i):`${i}${d}: undefined
`}return a}setAtOrigin(t,r,i){const s=this.properties.get(t);if(r5(s))return this._setAtOrigin(s,r,i)}isOverridden(t){const r=this.properties.get(t);return r!==void 0&&!!(r.flags&us.Overriden)}clearOverride(t){const r=this.properties.get(t);r!==void 0&&r.flags&us.Overriden&&(r.flags&=~us.Overriden,r.notifyChange())}override(t,r){const i=this.properties.get(t);if(!mhe(i,t,r,this))return;const s=i.metadata.cast;if(s){const n=this._cast(s,r),{valid:o,value:a}=n;if(DH.release(n),!o)return;r=a}i.flags|=us.Overriden,this._internalSet(i,r)}set(t,r){const i=this.properties.get(t);if(!mhe(i,t,r,this))return;const s=i.metadata.cast;if(s){const o=this._cast(s,r),{valid:a,value:l}=o;if(DH.release(o),!a)return;r=l}const n=i.metadata.set;n?n.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(t){this._origin=mv(t)}getDefaultOrigin(){return iz(this._origin)}notifyChange(t){const r=this.properties.get(t);r!==void 0&&r.notifyChange()}invalidate(t){const r=this.properties.get(t);r!==void 0&&r.invalidate()}commit(t){const r=this.properties.get(t);r!==void 0&&r.commit()}_internalSet(t,r){const i=this.lifecycle!==lv.INITIALIZING?this._origin:Jr.DEFAULTS;this._setAtOrigin(t,r,i)}_setAtOrigin(t,r,i){const s=this.store,n=t.propertyName;s.has(n,i)&&Fse(r,s.get(n))&&~t.flags&us.Overriden&&i===s.originOf(n)||(t.invalidate(),s.set(n,r,i),t.commit(),g2e(this.host,t))}_cast(t,r){const i=DH.acquire();return i.valid=!0,i.value=r,t&&(i.value=t.call(this.host,r,i)),i}}class VVe{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const DH=new ro(VVe);var G2e,H2e;function jVe(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return((t=e.constructor)==null?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const ZT=Symbol("Accessor-Handles"),fJ=Symbol("Accessor-Initialized");class be{constructor(...t){if(this[G2e]=null,this[H2e]=!1,this.constructor===be)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new zVe(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}IF(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const d=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=d,f}return this.inherited=d,p}:t[a]}for(const a in r){const l=jVe(r[a]);h(l)(o.prototype,a)}return I(i)(o)}postscript(t){const r=this.__accessor__,i=r.ctorArgs||t;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[fJ]=!0}initialize(){}destroy(){this.destroyed||(this[ZT]=Qe(this[ZT]),Bze(this),this.__accessor__.destroy())}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[fJ]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return W8(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,r){return ez(this,t,r),this}watch(t,r,i){return Hze(this,t,r,i)}own(t){this.addHandles(t)}addHandles(t,r){let i=this[ZT];C(i)&&(i=this[ZT]=new hr),i.add(t,r)}removeHandles(t){const r=this[ZT];C(r)||r.remove(t)}hasHandles(t){const r=this[ZT];return!!v(r)&&r.has(t)}_override(t,r){r===void 0?this.__accessor__.clearOverride(t):this.__accessor__.override(t,r)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_overrideIfSome(t,r){r==null?this.__accessor__.clearOverride(t):this.__accessor__.override(t,r)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,r){return this.__accessor__.internalSet(t,r),this}}G2e=ZT,H2e=fJ;class ene{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new ene;return this._values.forEach((i,s)=>{t&&t.has(s)||r.set(s,ne(i.value),i.origin)}),r}get(t,r){r=this._normalizeOrigin(r);const i=this._values.get(t);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(t){var r,i;return(i=(r=this._values.get(t))==null?void 0:r.origin)!=null?i:Jr.USER}keys(t){t=this._normalizeOrigin(t);const r=[...this._values.keys()];return t==null?r:r.filter(i=>{var s;return((s=this._values.get(i))==null?void 0:s.origin)===t})}set(t,r,i){if((i=this._normalizeOrigin(i))===Jr.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>i)return}this._values.set(t,new GVe(r,i))}delete(t,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(t))==null?void 0:i.origin)!==r||this._values.delete(t)}has(t,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(t))==null?void 0:i.origin)===r:this._values.has(t)}forEach(t){this._values.forEach(({value:r},i)=>t(r,i))}_normalizeOrigin(t){if(t!=null)return t===Jr.DEFAULTS?t:Jr.USER}}class GVe{constructor(t,r){this.value=t,this.origin=r}}function q2e(e,t,r){t.keys().forEach(s=>{r.set(s,t.get(s),Jr.DEFAULTS)});const i=e.metadatas;Object.keys(i).forEach(s=>{e.internalGet(s)&&r.set(s,e.internalGet(s),Jr.DEFAULTS)})}function HVe(e,t,r){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const i=e.read.source;if(typeof i=="string"){if(i===t||i.includes(".")&&i.indexOf(t)===0&&ihe(i,r))return!0}else for(const s of i)if(s===t||s.includes(".")&&s.indexOf(t)===0&&ihe(s,r))return!0;return!1}function qVe(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function WVe(e,t,r,i,s){let n=cJ(t[r],s);qVe(n)&&(e[r]=!0);for(const o of Object.getOwnPropertyNames(t))n=cJ(t[o],s),HVe(n,r,i)&&(e[o]=!0)}function XVe(e,t,r,i){const s=r.metadatas,n=Zse(s[t],"any",i),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,i):o;a!==void 0&&r.set(t,a)}const W2e={origin:"service"};function X2e(e,t,r=W2e){if(!t||typeof t!="object")return;const i=Gl(e),s=i.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))WVe(n,s,o,t,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(n)){const a=cJ(s[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?MF(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||XVe(e,o,i,r)}i.setDefaultOrigin("user")}function YVe(e,t,r,i=W2e){var n;const s={...i,messages:[]};r(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||e.loaded?i&&i.messages&&i.messages.push(o):e.loadWarnings.push(o)})}function ZVe(e,t,r,i,s){var o,a;const n={};return(a=(o=t.write)==null?void 0:o.writer)==null||a.call(e,i,n,r,s),n}function Y2e(e,t,r,i,s,n){if(!i||!i.write)return!1;const o=e.get(r);if(!s&&i.write.overridePolicy){const a=i.write.overridePolicy.call(e,o,r,n);a!==void 0&&(s=a)}if(s||(s=i.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new z("web-document-write:property-required",`Missing value for required property '${r}' on '${e.declaredClass}'`,{propertyName:r,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&te.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(r)===Jr.DEFAULTS)&&JVe(e,r,n,i,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(r)<mv(n.origin))}function JVe(e,t,r,i,s){const n=i.default;if(n===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,r);return Bv(o,s)}return!1}return n===s}function KVe(e,t,r,i){const s=Gl(e),n=s.metadatas,o=F2e(n[t],i);return!!o&&Y2e(e,s,t,o,r,i)}function Z2e(e,t,r){var n,o;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return y6(t,e.toJSON(r));const i=Gl(e),s=i.metadatas;for(const a in s){const l=F2e(s[a],r);if(!Y2e(e,i,a,l,void 0,r))continue;const c=e.get(a),d=ZVe(e,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(d).length>0&&(t=y6(t,d),(o=(n=r==null?void 0:r.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&Promise.all(r.resources.pendingOperations).then(()=>y6(t,d)),r&&r.writtenProperties&&r.writtenProperties.push({target:e,propName:a,oldOrigin:UVe(i.store.originOf(a)),newOrigin:r.origin}))}return t}const xI=e=>{let t=class extends e{constructor(...r){super(...r);const i=Gl(this),s=i.store,n=new ene;i.store=n,q2e(i,s,n)}read(r,i){X2e(this,r,i)}write(r={},i){return Z2e(this,r,i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return QVe.call(this,r,i)}};return t=u([I("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function QVe(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(e,t),r}let fe=class extends xI(be){};fe=u([I("esri.core.JSONSupport")],fe);var mJ;let xv=mJ=class extends fe{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new mJ({url:this.url})}};u([h({type:String,json:{write:{isRequired:!0}}})],xv.prototype,"url",void 0),xv=mJ=u([I("esri.webdoc.support.SlideThumbnail")],xv);const e9e={ar:"ar-u-nu-latn"};let w6=new WeakMap,J2e={};function t9e(e){const t=e||J2e;if(!w6.has(t)){const r=fl(),i=e9e[fl()]||r;w6.set(t,new Intl.NumberFormat(i,e))}return w6.get(t)}function K2e(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Yh(e,t){return e===-0&&(e=0),t9e(t).format(e)}Jse(()=>{w6=new WeakMap,J2e={}});const Q2e=te.getLogger("esri.intl.substitute");function hu(e,t,r={}){const{format:i={}}=r;return g0(e,s=>r9e(s,t,i))}function r9e(e,t,r){var l;let i,s;const n=e.indexOf(":");if(n===-1?i=e.trim():(i=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!i)return"";const o=ZE(i,t);if(o==null)return"";const a=(l=s?r==null?void 0:r[s]:null)!=null?l:r==null?void 0:r[i];return a?i9e(o,a):s?s9e(o,s):tne(o)}function i9e(e,t){switch(t.type){case"date":return _s(e,t.intlOptions);case"number":return Yh(e,t.intlOptions);default:return Q2e.warn("missing format descriptor for key {key}"),tne(e)}}function s9e(e,t){switch(t.toLowerCase()){case"dateformat":return _s(e);case"numberformat":return Yh(e);default:return Q2e.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?_s(e):/^numberformat/i.test(t)?Yh(e):tne(e)}}function tne(e){switch(typeof e){case"string":return e;case"number":return Yh(e);case"boolean":return""+e;default:return e instanceof Date?_s(e):""}}const ghe=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,n9e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function yhe(e){var t;return(t=n9e[e])!=null?t:!1}const R3=[],SM=new Map;function _he(e){for(const t of SM.keys())eEe(e.pattern,t)&&SM.delete(t)}function o9e(e){return R3.includes(e)||(_he(e),R3.unshift(e)),{remove(){const t=R3.indexOf(e);t>-1&&(R3.splice(t,1),_he(e))}}}async function rne(e){const t=fl();SM.has(e)||SM.set(e,l9e(e,t));const r=SM.get(e);return r&&await c9e.add(r),r}function a9e(e){if(!ghe.test(e))return null;const t=ghe.exec(e);if(t===null)return null;const[,r,i]=t,s=r+(i?"-"+i.toUpperCase():"");return yhe(s)?s:yhe(r)?r:null}async function l9e(e,t){const r=[];for(const i of R3)if(eEe(i.pattern,e))try{return await i.fetchMessageBundle(e,t)}catch(s){r.push(s)}throw r.length?new z("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:r}):new z("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function eEe(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}Jse(()=>{SM.clear()});const c9e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=gx())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}},u9e=te.getLogger("esri.core.urlUtils"),TI=Gr.request,vhe="esri/config: esriConfig.request.proxyUrl is not set.",tEe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,rEe=/^\s*http:/i,d9e=/^\s*https:/i,h9e=/^\s*file:/i,p9e=/:\d+$/,f9e=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,m9e=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),g9e=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class EM{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(m9e);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(g9e),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}}const i5={},y9e=new EM(Gr.applicationUrl);let Mc=y9e;const _9e=v9e();let ine=_9e;const sne=()=>Mc,qkt=()=>ine;function v9e(){const e=Mc.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${Mc.scheme}://${Mc.host}${Mc.port!=null?`:${Mc.port}`:""}`}${t}`}function Wa(e){if(!e)return null;const t={path:null,query:null},r=new EM(e),i=e.indexOf("?");return r.query===null?t.path=e:(t.path=e.substring(0,i),t.query=iEe(r.query)),r.fragment&&(t.hash=r.fragment,r.query===null&&(t.path=t.path.substring(0,t.path.length-(r.fragment.length+1)))),t}function iEe(e){const t=e.split("&"),r={};for(const i of t){if(!i)continue;const s=i.indexOf("=");let n,o;s<0?(n=decodeURIComponent(i),o=""):(n=decodeURIComponent(i.slice(0,s)),o=decodeURIComponent(i.slice(s+1)));let a=r[n];typeof a=="string"&&(a=r[n]=[a]),Array.isArray(a)?a.push(o):r[n]=o}return r}function bhe(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function WL(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(t(r,e[r]))).join("&"):Object.keys(e).map(r=>{const i=e[r];if(i==null)return"";const s=encodeURIComponent(r)+"=",n=t&&t[r];return n?s+encodeURIComponent(n(i)):Array.isArray(i)?i.map(o=>bhe(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):bhe(i)?s+encodeURIComponent(JSON.stringify(i)):s+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function b9e(e=!1){let t,r=TI.proxyUrl;if(typeof e=="string"){t=C9e(e);const i=V9(e);i&&(r=i.proxyUrl)}else t=!!e;if(!r)throw u9e.warn(vhe),new z("urlutils:proxy-not-set",vhe);return t&&gJ()&&(r=cne(r)),Wa(r)}function Wkt(e){const t=V9(e);let r,i;if(t){const s=nne(t.proxyUrl);r=s.path,i=s.query?iEe(s.query):null}if(r){const s=Wa(e);e=r+"?"+s.path;const n=WL({...i,...s.query});n&&(e=`${e}?${n}`)}return e}const uP={path:"",query:""};function nne(e){const t=e.indexOf("?");return t!==-1?(uP.path=e.slice(0,t),uP.query=e.slice(t+1)):(uP.path=e,uP.query=null),uP}function sEe(e){return e=(e=sz(e=P9e(e=nne(e).path),!0)).toLowerCase()}function w9e(e){const t={proxyUrl:e.proxyUrl,urlPrefix:sEe(e.urlPrefix)},r=TI.proxyRules,i=t.urlPrefix;let s=r.length;for(let n=0;n<r.length;n++){const o=r[n].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;s=n;break}o.indexOf(i)===0&&(s=n+1)}return r.splice(s,0,t),s}function V9(e){const t=TI.proxyRules,r=sEe(e);for(let i=0;i<t.length;i++)if(r.indexOf(t[i].urlPrefix)===0)return t[i]}function nEe(e,t){return e=whe(e),t=whe(t),sz(e)===sz(t)}function whe(e){const t=(e=tg(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function oEe(e){const t=i=>i==null||i instanceof RegExp&&i.test(e)||typeof i=="string"&&e.startsWith(i),r=TI.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(t))return i}else if(t(i.urls))return i}return null}function XL(e,t,r=!1){if(!e||!t)return!1;const i=_J(e),s=_J(t);return!(!r&&i.scheme!==s.scheme)&&i.host!=null&&s.host!=null&&i.host.toLowerCase()===s.host.toLowerCase()&&i.port===s.port}function one(e){if(typeof e=="string"){if(!Rd(e))return!0;e=_J(e)}if(XL(e,Mc))return!0;const t=TI.trustedServers||[];for(let r=0;r<t.length;r++){const i=x9e(t[r]);for(let s=0;s<i.length;s++)if(XL(e,i[s]))return!0}return!1}function x9e(e){return i5[e]||(lne(e)||y0(e)?i5[e]=[new EM(Rh(e))]:i5[e]=[new EM(`http://${e}`),new EM(`https://${e}`)]),i5[e]}function Rh(e,t=ine,r){return y0(e)?r&&r.preserveProtocolRelative?e:Mc.scheme==="http"&&Mc.authority===rg(e).slice(2)?`http:${e}`:`https:${e}`:lne(e)?e:Mu(e[0]==="/"?R9e(t):t,e)}function ane(e,t=ine,r){if(e==null||!Rd(e))return e;const i=tg(e),s=i.toLowerCase(),n=tg(t).toLowerCase().replace(/\/+$/,""),o=r?tg(r).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=i.slice(c);const d=n.slice(c-1).replace(/[^/]+/g,"").length;if(d>0)for(let p=0;p<d;p++)e=`../${e}`;else e=`./${e}`;return e}function tg(e){return e=L9e(e=D9e(e=$9e(e=Rh(e=e.trim()))))}function Mu(...e){const t=e.filter(v);if(!t||!t.length)return;const r=[];if(Rd(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(r.push(s.slice(0,n+1)),O9e(t[0])&&(r[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&r.push("");const i=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<i.length;s++){const n=i[s];n===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!n&&s===i.length-1||n&&(n!=="."||r.length===0))&&r.push(n)}return r.join("/")}function rg(e,t=!1){if(e==null||bx(e)||R0(e))return null;let r=e.indexOf("://");if(r===-1&&y0(e))r=2;else{if(r===-1)return null;r+=3}const i=e.indexOf("/",r);return i!==-1&&(e=e.slice(0,i)),t&&(e=sz(e,!0)),e}function Rd(e){return y0(e)||lne(e)}function bx(e){return e!=null&&e.slice(0,5)==="blob:"}function R0(e){return e!=null&&e.slice(0,5)==="data:"}function aEe(e){const t=j9(e);if(!t||!t.isBase64)return null;const r=atob(t.data),i=new Uint8Array(r.length);for(let s=0;s<r.length;s++)i[s]=r.charCodeAt(s);return i.buffer}function Xkt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const T9e=/^data:(.*?)(;base64)?,(.*)$/;function j9(e){const t=e.match(T9e);if(!t)return null;const[,r,i,s]=t;return{mediaType:r,isBase64:!!i,data:s}}function lEe(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function Ykt(e,t){S9e(e,t)||E9e(e,t)}function S9e(e,t){if(!e)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(e);return r.download=t,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function E9e(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function y0(e){return e!=null&&e[0]==="/"&&e[1]==="/"}function lne(e){return e!=null&&tEe.test(e)}function C9e(e){return e!=null&&d9e.test(e)||Mc.scheme==="https"&&y0(e)}function A9e(e){return e!=null&&rEe.test(e)||Mc.scheme==="http"&&y0(e)}function O9e(e){return e!=null&&h9e.test(e)}function cne(e){return y0(e)?`https:${e}`:e.replace(rEe,"https:")}function M9e(){return Mc.scheme==="http"}function gJ(){return Mc.scheme==="https"}function sz(e,t=!1){return y0(e)?e.slice(2):(e=e.replace(tEe,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function R9e(e){const t=e.indexOf("//"),r=e.indexOf("/",t+2);return r===-1?e:e.slice(0,r)}function I9e(e){let t=0;if(Rd(e)){const i=e.indexOf("//");i!==-1&&(t=i+2)}const r=e.lastIndexOf("/");return r<t?e:e.slice(0,r+1)}function Zkt(e,t){if(!e)return"";const r=Wa(e).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(t!=null&&t.length))return i;const s=new RegExp(`.(${t.join("|")})$`,"ig");return i.replace(s,"")}function P9e(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function YL(e){return e.replace(/\/+$/,"")}function $9e(e){if(/^https?:\/\//i.test(e)){const t=nne(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function D9e(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function L9e(e){const t=TI.httpsDomains;if(!A9e(e))return e;const r=e.indexOf("/",7);let i;if(i=r===-1?e:e.slice(0,r),i=i.toLowerCase().slice(7),p9e.test(i)){if(!i.endsWith(":80"))return e;i=i.slice(0,-3),e=e.replace(":80","")}return M9e()&&i===Mc.authority&&!f9e.test(e)||(gJ()&&i===Mc.authority||t&&t.some(s=>i===s||i.endsWith(`.${s}`))||gJ()&&!V9(e))&&(e=cne(e)),e}function yJ(e,t,r){if(!(t&&r&&e&&Rd(e)))return e;const i=e.indexOf("//"),s=e.indexOf("/",i+2),n=e.indexOf(":",i+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(i+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,i+2)}${r}${e.slice(o)}`}function _J(e){return typeof e=="string"?new EM(Rh(e)):(e.scheme||(e.scheme=Mc.scheme),e)}function une(e){return N9e.test(e)}function cEe(e,t){const r=Wa(e),i=Object.keys(r.query||{});return i.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function uEe(e,t,r){const i=Wa(e),s=i.query||{};return s[t]=String(r),`${i.path}?${WL(s)}`}function LH(e,t){const r=Wa(e),i=r.query||{};for(const n in t)i[n]=t[n];const s=WL(i);return s?`${r.path}?${s}`:r.path}function dne(e){if(C(e))return null;const t=e.match(dEe);return t?t[2]:null}function xhe(e){if(C(e))return null;const t=e.match(dEe);return t?{path:t[1],extension:t[2]}:{path:e,extension:null}}const dEe=/([^.]*)\.([^\/]*)$/,N9e=/(^data:image\/svg|\.svg$)/i,hEe="20221121",pEe="f520630575ed53cf8b49e5f1492799065ee366e5",fEe="4.25",F9e={async request(e,t){var a,l;const{default:r}=await re(()=>Promise.resolve().then(()=>vEe),void 0),i=e.options,s=i.responseType;i.signal=t==null?void 0:t.signal,i.responseType=s==="native"||s==="native-request-init"?"native-request-init":s&&["blob","json","text"].includes(s)&&((a=oEe(e.url))==null?void 0:a.after)?s:"array-buffer";const n=await r(e.url,i),o={data:n.data,ssl:n.ssl};switch((l=n.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let pn;function Jkt(e){pn=e}function Kkt(e){const t=pn&&pn.findCredential(e);return t&&t.token?uEe(e,"token",t.token):e}pe("host-webworker");const k9e=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,U9e={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function Qkt(e){const t=e==null?void 0:e.match(k9e);if(!t)return null;const[,r,i,s]=t;if(!r)return null;let n=null,o=null,a=null;const{devext:l,qaext:c,www:d}=U9e;if(i)if(n=r,s)switch(s.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=d);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=d);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:n}}function B9e(e){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(e)}const z9e=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function mEe(e){const t=rg(e,!0);return!!t&&t.endsWith(".arcgis.com")&&!z9e.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function gEe(e,t,r=!1,i){return new Promise((s,n)=>{if(Bo(i))return void n(The());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const d=e;c(),s(d)},l=()=>{if(!e)return;const d=e;c(),d.src="",n(The())};const c=()=>{pe("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,v(i)&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(t)};v(i)&&i.addEventListener("abort",l),pe("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function The(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function V9e(e){var r,i,s;Gr.request.crossOriginNoCorsDomains||(Gr.request.crossOriginNoCorsDomains={});const t=Gr.request.crossOriginNoCorsDomains;for(let n of e)n=n.toLowerCase(),/^https?:\/\//.test(n)?t[(r=rg(n))!=null?r:""]=0:(t[(i=rg("http://"+n))!=null?i:""]=0,t[(s=rg("https://"+n))!=null?s:""]=0)}function j9e(e){const t=Gr.request.crossOriginNoCorsDomains;if(t){let r=rg(e);if(r)return r=r.toLowerCase(),!XL(r,sne())&&t[r]<Date.now()-36e5}return!1}async function G9e(e){var s;const t=Gr.request.crossOriginNoCorsDomains,r=rg(e);t&&r&&(t[r.toLowerCase()]=Date.now());const i=Wa(e);e=i.path,((s=i.query)==null?void 0:s.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function lr(e,t){var c;const r=R0(e),i=bx(e);i||r||(e=tg(e));const s={url:e,requestOptions:{...t}};let n=oEe(e);if(n){const d=await K9e(n,s);if(d!=null)return{data:d,getHeader:hne,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"){if(pe("host-webworker")||pe("host-node"))throw Vm("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(r)throw Vm("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),s);if(t.method==="head"){if(t.body)throw Vm("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(r||i)throw Vm("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await Y9e(),nz)return nz.execute(e,t);const o=new AbortController;jl(t,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Om.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await eje(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let nz;const Om=Gr.request,yEe="FormData"in globalThis,H9e=[499,498,403,401],q9e=["COM_0056","COM_0057","SB_0008"],W9e=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],hne=()=>null,oz=Symbol();function X9e(e){const t=rg(e);t&&!lr._corsServers.includes(t)&&lr._corsServers.push(t)}function She(e){const t=rg(e);return!t||t.endsWith(".arcgis.com")||lr._corsServers.includes(t)||one(t)}function Vm(e,t,r,i){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:hne,ssl:!1};if(t instanceof z)return t.details?(t.details=ne(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=n,t;if(t){const o=i&&(c=>i.headers.get(c)),a=i&&i.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=oz in t?t[oz]:t}return Ps(t)?oi():new z(e,s,n)}async function Y9e(){pe("host-webworker")?nz||(nz=await re(()=>import("./request.d03a303c.js"),[])):lr._abortableFetch||(lr._abortableFetch=globalThis.fetch.bind(globalThis))}async function vJ(){pn||await re(()=>import("./IdentityManager.4f606e73.js"),[])}async function Z9e(e){var a;const t=e.params.url,r=e.params.requestOptions,i=e.controller.signal,s=r.body;let n=null,o=null;if(yEe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),e.fetchOptions={cache:r.cacheBust&&!lr._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Om.priority,redirect:"follow",signal:i},(n||o)&&(e.fetchOptions.body=n||o),r.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||((a=r.query)==null?void 0:a.token)||(n==null?void 0:n.get("token"))),!e.hasToken&&Gr.apiKey&&mEe(t)&&(r.query||(r.query={}),r.query.token=Gr.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!_Ee(t)&&!Bo(i)){let l;r.authMode==="immediate"?(await vJ(),l=await pn.getCredential(t,{signal:i}),e.credential=l):r.authMode==="no-prompt"?(await vJ(),l=await pn.getCredential(t,{prompt:!1,signal:i}).catch(()=>{}),e.credential=l):pn&&(l=pn.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function _Ee(e){return W9e.some(t=>t.test(e))}async function J9e(e){var f,m;let t=e.params.url;const r=e.params.requestOptions,i=(f=e.fetchOptions)!=null?f:{},s=bx(t)||R0(t),n=r.responseType||"json",o=s?0:r.timeout!=null?r.timeout:Om.timeout;let a=!1;if(!s){e.useSSL&&(t=cne(t)),r.cacheBust&&i.cache==="default"&&(t=uEe(t,"request.preventCache",Date.now()));let g={...r.query};e.credentialToken&&(g.token=e.credentialToken);let _=WL(g);pe("esri-url-encodes-apostrophe")&&(_=_.replace(/'/g,"%27"));const x=t.length+1+_.length;let b;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||x>Om.maxUrlLength;const w=r.useProxy||!!V9(t);if(w){const T=b9e(t);b=T.path,!a&&b.length+1+x>Om.maxUrlLength&&(a=!0),T.query&&(g={...T.query,...g})}if(i.method==="HEAD"&&(a||w)){if(a)throw x>Om.maxUrlLength?Vm("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):Vm("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(w)throw Vm("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?t=LH(t,g):(i.body=WL(g),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):t=LH(t,g),w&&(e.useProxy=!0,t=`${b}?${t}`),g.token&&yEe&&i.body instanceof FormData&&!B9e(t)&&i.body.set("token",g.token),r.hasOwnProperty("withCredentials"))e.withCredentials=r.withCredentials;else if(!XL(t,sne())){if(one(t))e.withCredentials=!0;else if(pn){const T=pn.findServerInfo(t);T&&T.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(i.credentials="include",j9e(t)&&await G9e(a?LH(t,g):t))}let l,c,d=0,p=!1;o>0&&(d=setTimeout(()=>{p=!0,e.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=t;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||Q9e(r.headers)||!s&&!e.useProxy&&Om.proxyUrl&&!She(t)){if(l=await lr._abortableFetch(t,i),e.useProxy||X9e(t),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(d&&(clearTimeout(d),d=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Ehe(c,"application/xml");break;case"document":c=Ehe(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const g=l.headers.get("Content-Type");if(g&&/application\/json|text\/plain/i.test(g)&&c[n==="blob"?"size":"byteLength"]<=750)try{const _=await new Response(c).json();_.error&&(c=_)}catch{}}n==="image"&&c instanceof Blob&&(c=await Che(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await Che(t,e)}catch(g){if(g.name==="AbortError")throw p?new Error("Timeout exceeded"):oi("Request canceled");if(!(!l&&g instanceof TypeError&&Om.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||e.useProxy||She(t))throw g;e.redoRequest=!0,w9e({proxyUrl:Om.proxyUrl,urlPrefix:(m=rg(t))!=null?m:""})}finally{d&&clearTimeout(d)}return[l,c]}async function K9e(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let r,i;try{i=await e.before(t)}catch(s){r=Vm("request:interceptor",s,t)}if((i instanceof Error||i instanceof z)&&(r=Vm("request:interceptor",i,t)),r)throw e.error&&e.error(r),r;return i}}function Q9e(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function Ehe(e,t){let r;try{r=new DOMParser().parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function eje(e){var n;let t,r;await Z9e(e);try{do[t,r]=await J9e(e);while(!await tje(e,t,r))}catch(o){const a=Vm("request:server",o,e.params,t);throw a.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(a),a}const i=e.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!e.hasToken&&!e.credentialToken&&((n=r.user)==null?void 0:n.username)&&!one(i)){const o=rg(i,!0);o&&Om.trustedServers.push(o)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&V9e(r.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&pn){const o=pn.findServerInfo(s.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=pn.findCredential(a,s.userId);l&&pn._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:r,getHeader:t?o=>t==null?void 0:t.headers.get(o):hne,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function tje(e,t,r){if(e.redoRequest)return e.redoRequest=!1,!1;const i=e.params.requestOptions;if(!t||i.responseType==="native"||i.responseType==="native-request-init")return!0;let s,n;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[oz]=r,s;r&&(r.error?s=r.error:r.status==="error"&&Array.isArray(r.messages)&&(s={...r},s[oz]=r,s.details=r.messages));let o,a=null;s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,o=s.messageCode,o=o&&o.toUpperCase());const l=i.authMode;if(n===403&&(a===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&n!==void 0&&H9e.includes(n)&&!_Ee(e.params.url)&&(n!==403||o&&!q9e.includes(o)&&(a==null||a===2&&e.credentialToken))){await vJ();try{const c=await pn.getCredential(e.params.url,{error:Vm("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=void 0,e.credentialToken=void 0,!1;s=c}}if(s)throw s;return!0}function Che(e,t,r=!1){const i=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Om.priority,s.src=e,gEe(s,e,r,i)}lr._abortableFetch=null,lr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const vEe=Object.freeze(Object.defineProperty({__proto__:null,default:lr},Symbol.toStringTag,{value:"Module"}));async function rje(e,t,r,i){const s=t.exec(r);if(!s)throw new z("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=a9e(i),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let d;try{d=await Ahe(e(c))}catch(p){if(c===l)throw new z("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p});try{d=await Ahe(e(l))}catch(f){throw new z("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return d}async function Ahe(e){if(v(Ohe.fetchBundleAsset))return Ohe.fetchBundleAsset(e);const t=await lr(e,{responseType:"text"});return JSON.parse(t.data)}class ije{constructor({base:t="",pattern:r,location:i=new URL(window.location.href)}){let s;s=typeof i=="string"?n=>new URL(n,new URL(i,window.location.href)).href:i instanceof URL?n=>new URL(n,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,r){return rje(this.getAssetUrl,this.matcher,t,r)}}function sje(e){return new ije(e)}const Ohe={},nje=te.getLogger("esri.assets");function oje(e,t){return lr(ui(e),t)}function ui(e){if(!Gr.assetsPath)throw nje.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new z("assets:path-not-set","config.assetsPath is not set");return Mu(Gr.assetsPath,e)}o9e(sje({pattern:"esri/",location:ui}));function $F(e){return typeof e=="string"?document.getElementById(e):e!=null?e:null}function bEe(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function Mhe(e,t){const r=t.parentNode;r&&r.insertBefore(e,t)}function Rhe(e,t){for(;;){const r=e.firstChild;if(!r)break;t.appendChild(r)}}function aje(e){e.parentNode&&e.parentNode.removeChild(e)}class CM{constructor(){this._emitter=new CM.EventEmitter(this)}emit(t,r){return this._emitter.emit(t,r)}on(t,r){return this._emitter.on(t,r)}once(t,r){return this._emitter.once(t,r)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this._target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return aR(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=i=>{let s=class extends i{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([I("esri.core.Evented")],s),s};let r=class extends be{constructor(){super(...arguments),this._emitter=new CM.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,s){return this._emitter.emit(i,s)}on(i,s){return this._emitter.on(i,s)}once(i,s){return this._emitter.once(i,s)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=u([I("esri.core.Evented")],r),e.EventedAccessor=r})(CM||(CM={}));const $s=CM;var tw;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(tw||(tw={}));class lje{constructor(t){this.instance=t,this._resolver=gx(),this._status=tw.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=tw.RESOLVED,this._cleanUp()},()=>{this._status=tw.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===tw.RESOLVED}isRejected(){return this._status===tw.REJECTED}isFulfilled(){return this._status!==tw.PENDING}abort(){this._resolver.reject(oi())}when(t,r){return this._resolver.promise.then(t,r)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=gx(),r=[...this._resolvingPromises,t.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==i||Ps(s)||this._resolver.reject(s)}),t.resolve()}}const G9=e=>{let t=class extends e{constructor(...r){super(...r),this._promiseProps=new lje(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return t=u([I("esri.core.Promise")],t),t};let az=class extends G9(be){};az=u([I("esri.core.Promise")],az);const cje="randomUUID"in crypto;function pne(){if(cje)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=r=>e[r].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var uje=function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},YS={exports:{}},lo={},ZL={exports:{}},KE={};function wEe(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function dje(e,t,r){}function hje(e,t,r){}var pje=/javascript\s*\:/img;function fje(e,t){return pje.test(t)?"":t}KE.whiteList=wEe();KE.getDefaultWhiteList=wEe;KE.onAttr=dje;KE.onIgnoreAttr=hje;KE.safeAttrValue=fje;var mje={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,s;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,s=e.length;i<s;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},dP=mje;function gje(e,t){e=dP.trimRight(e),e[e.length-1]!==";"&&(e+=";");var r=e.length,i=!1,s=0,n=0,o="";function a(){if(!i){var d=dP.trim(e.slice(s,n)),p=d.indexOf(":");if(p!==-1){var f=dP.trim(d.slice(0,p)),m=dP.trim(d.slice(p+1));if(f){var g=t(s,o.length,f,m,d);g&&(o+=g+"; ")}}}s=n+1}for(;n<r;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return dP.trim(o)}var yje=gje,s5=KE,_je=yje;function Ihe(e){return e==null}function vje(e){var t={};for(var r in e)t[r]=e[r];return t}function xEe(e){e=vje(e||{}),e.whiteList=e.whiteList||s5.whiteList,e.onAttr=e.onAttr||s5.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||s5.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||s5.safeAttrValue,this.options=e}xEe.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,i=r.whiteList,s=r.onAttr,n=r.onIgnoreAttr,o=r.safeAttrValue,a=_je(e,function(l,c,d,p,f){var m=i[d],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(p):m instanceof RegExp&&(g=m.test(p)),g!==!0&&(g=!1),p=o(d,p),!!p){var _={position:c,sourcePosition:l,source:f,isWhite:g};if(g){var x=s(d,p,_);return Ihe(x)?d+":"+p:x}else{var x=n(d,p,_);if(!Ihe(x))return x}}});return a};var bje=xEe;(function(e,t){var r=KE,i=bje;function s(o,a){var l=new i(a);return l.process(o)}t=e.exports=s,t.FilterCSS=i;for(var n in r)t[n]=r[n]})(ZL,ZL.exports);var fne={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,s;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,s=e.length;i<s;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,r=t.exec(e);return r?r.index:-1}},wje=ZL.exports.FilterCSS,xje=ZL.exports.getDefaultWhiteList,lz=fne;function TEe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var SEe=new wje;function Tje(e,t,r){}function Sje(e,t,r){}function Eje(e,t,r){}function Cje(e,t,r){}function EEe(e){return e.replace(Oje,"&lt;").replace(Mje,"&gt;")}function Aje(e,t,r,i){if(r=IEe(r),t==="href"||t==="src"){if(r=lz.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(t==="background"){if(n5.lastIndex=0,n5.test(r))return""}else if(t==="style"){if(Phe.lastIndex=0,Phe.test(r)||($he.lastIndex=0,$he.test(r)&&(n5.lastIndex=0,n5.test(r))))return"";i!==!1&&(i=i||SEe,r=i.process(r))}return r=PEe(r),r}var Oje=/</g,Mje=/>/g,Rje=/"/g,Ije=/&quot;/g,Pje=/&#([a-zA-Z0-9]*);?/gim,$je=/&colon;?/gim,Dje=/&newline;?/gim,n5=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Phe=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,$he=/u\s*r\s*l\s*\(.*/gi;function CEe(e){return e.replace(Rje,"&quot;")}function AEe(e){return e.replace(Ije,'"')}function OEe(e){return e.replace(Pje,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function MEe(e){return e.replace($je,":").replace(Dje," ")}function REe(e){for(var t="",r=0,i=e.length;r<i;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return lz.trim(t)}function IEe(e){return e=AEe(e),e=OEe(e),e=MEe(e),e=REe(e),e}function PEe(e){return e=CEe(e),e=EEe(e),e}function Lje(){return""}function Nje(e,t){typeof t!="function"&&(t=function(){});var r=!Array.isArray(e);function i(o){return r?!0:lz.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",d=l.position+c.length;return s.push([n!==!1?n:l.position,d]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return lz.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function Fje(e){for(var t="",r=0;r<e.length;){var i=e.indexOf("<!--",r);if(i===-1){t+=e.slice(r);break}t+=e.slice(r,i);var s=e.indexOf("-->",i);if(s===-1)break;r=s+3}return t}function kje(e){var t=e.split("");return t=t.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),t.join("")}lo.whiteList=TEe();lo.getDefaultWhiteList=TEe;lo.onTag=Tje;lo.onIgnoreTag=Sje;lo.onTagAttr=Eje;lo.onIgnoreTagAttr=Cje;lo.safeAttrValue=Aje;lo.escapeHtml=EEe;lo.escapeQuote=CEe;lo.unescapeQuote=AEe;lo.escapeHtmlEntities=OEe;lo.escapeDangerHtml5Entities=MEe;lo.clearNonPrintableCharacter=REe;lo.friendlyAttrValue=IEe;lo.escapeAttrValue=PEe;lo.onIgnoreTagStripAll=Lje;lo.StripTagBody=Nje;lo.stripCommentTag=Fje;lo.stripBlankChar=kje;lo.cssFilter=SEe;lo.getDefaultCSSWhiteList=xje;var H9={},rw=fne;function Uje(e){var t=rw.spaceIndex(e),r;return t===-1?r=e.slice(1,-1):r=e.slice(1,t+1),r=rw.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function Bje(e){return e.slice(0,2)==="</"}function zje(e,t,r){var i="",s=0,n=!1,o=!1,a=0,l=e.length,c="",d="";e:for(a=0;a<l;a++){var p=e.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){i+=r(e.slice(s,a)),n=a,s=a;continue}if(p===">"){i+=r(e.slice(s,n)),d=e.slice(n,a+1),c=Uje(d),i+=t(n,i.length,c,d,Bje(d)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=e.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=e.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<e.length&&(i+=r(e.substr(s))),i}var Vje=/[^a-zA-Z0-9\\_:.-]/gim;function jje(e,t){var r=0,i=0,s=[],n=!1,o=e.length;function a(f,m){if(f=rw.trim(f),f=f.replace(Vje,"").toLowerCase(),!(f.length<1)){var g=t(f,m||"");g&&s.push(g)}}for(var l=0;l<o;l++){var c=e.charAt(l),d,p;if(n===!1&&c==="="){n=e.slice(r,l),r=l+1,i=e.charAt(r)==='"'||e.charAt(r)==="'"?r:Hje(e,l+1);continue}if(n!==!1&&l===i){if(p=e.indexOf(c,l+1),p===-1)break;d=rw.trim(e.slice(i+1,p)),a(n,d),n=!1,l=p,r=l+1;continue}if(/\s|\n|\t/.test(c))if(e=e.replace(/\s|\n|\t/g," "),n===!1)if(p=Gje(e,l),p===-1){d=rw.trim(e.slice(r,l)),a(d),n=!1,r=l+1;continue}else{l=p-1;continue}else if(p=qje(e,l-1),p===-1){d=rw.trim(e.slice(r,l)),d=Dhe(d),a(n,d),n=!1,r=l+1;continue}else continue}return r<e.length&&(n===!1?a(e.slice(r)):a(n,Dhe(rw.trim(e.slice(r))))),rw.trim(s.join(" "))}function Gje(e,t){for(;t<e.length;t++){var r=e[t];if(r!==" ")return r==="="?t:-1}}function Hje(e,t){for(;t<e.length;t++){var r=e[t];if(r!==" ")return r==="'"||r==='"'?t:-1}}function qje(e,t){for(;t>0;t--){var r=e[t];if(r!==" ")return r==="="?t:-1}}function Wje(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function Dhe(e){return Wje(e)?e.substr(1,e.length-2):e}H9.parseTag=zje;H9.parseAttr=jje;var Xje=ZL.exports.FilterCSS,Sm=lo,$Ee=H9,Yje=$Ee.parseTag,Zje=$Ee.parseAttr,x6=fne;function o5(e){return e==null}function Jje(e){var t=x6.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=x6.trim(e.slice(t+1,-1));var r=e[e.length-1]==="/";return r&&(e=x6.trim(e.slice(0,-1))),{html:e,closing:r}}function Kje(e){var t={};for(var r in e)t[r]=e[r];return t}function Qje(e){var t={};for(var r in e)Array.isArray(e[r])?t[r.toLowerCase()]=e[r].map(function(i){return i.toLowerCase()}):t[r.toLowerCase()]=e[r];return t}function DEe(e){e=Kje(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Sm.onIgnoreTagStripAll),e.whiteList||e.allowList?e.whiteList=Qje(e.whiteList||e.allowList):e.whiteList=Sm.whiteList,e.onTag=e.onTag||Sm.onTag,e.onTagAttr=e.onTagAttr||Sm.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Sm.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Sm.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Sm.safeAttrValue,e.escapeHtml=e.escapeHtml||Sm.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new Xje(e.css))}DEe.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,i=r.whiteList,s=r.onTag,n=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,d=t.cssFilter;r.stripBlankChar&&(e=Sm.stripBlankChar(e)),r.allowCommentTag||(e=Sm.stripCommentTag(e));var p=!1;r.stripIgnoreTagBody&&(p=Sm.StripTagBody(r.stripIgnoreTagBody,n),n=p.onIgnoreTag);var f=Yje(e,function(m,g,_,x,b){var w={sourcePosition:m,position:g,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(i,_)},T=s(_,x,w);if(!o5(T))return T;if(w.isWhite){if(w.isClosing)return"</"+_+">";var E=Jje(x),O=i[_],A=Zje(E.html,function(R,D){var k=x6.indexOf(O,R)!==-1,L=o(_,R,D,k);return o5(L)?k?(D=l(_,R,D,d),D?R+'="'+D+'"':R):(L=a(_,R,D,k),o5(L)?void 0:L):L});return x="<"+_,A&&(x+=" "+A),E.closing&&(x+=" /"),x+=">",x}else return T=n(_,x,w),o5(T)?c(x):T},c);return p&&(f=p.remove(f)),f};var e7e=DEe;(function(e,t){var r=lo,i=H9,s=e7e;function n(a,l){var c=new s(l);return c.process(a)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s,function(){for(var a in r)t[a]=r[a];for(var l in i)t[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=e.exports)})(YS,YS.exports);var t7e=function(){function e(t,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?i.sanitizeUrl(a):YS.exports.safeAttrValue(n,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var s;t&&!r?s=t:t&&r?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new YS.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,r){switch(r===void 0&&(r={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,r);default:return r.allowUndefined&&typeof t>"u"?void 0:null}},e.prototype.sanitizeUrl=function(t,r){var i=(r!=null?r:{}).isProtocolRequired,s=i===void 0?!0:i,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?YS.exports.escapeAttrValue(t):!n&&!s?YS.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,r,i,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,r,i,s):YS.exports.safeAttrValue(t,r,i,s)},e.prototype.validate=function(t,r){r===void 0&&(r={});var i=this.sanitize(t,r);return{isValid:t===i,sanitized:i}},e.prototype.encodeHTML=function(t){var r=this;return String(t).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},e.prototype.encodeAttrValue=function(t){var r=/^[a-zA-Z0-9]$/;return String(t).replace(/[\x00-\xFF]/g,function(i,s){return r.test(i)?i:"&#x".concat(Number(t.charCodeAt(s)).toString(16),";")})},e.prototype._extendObjectOfArrays=function(t){var r={};return t.forEach(function(i){Object.keys(i).forEach(function(s){Array.isArray(i[s])&&Array.isArray(r[s])?r[s]=r[s].concat(i[s]):r[s]=i[s]})}),r},e.prototype._iterateOverObject=function(t,r){var i=this;r===void 0&&(r={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(uje(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],d=i.validate(c,r);return d.isValid?a[l]=c:(s=!0,a[l]=d.sanitized),a},{})}else return r.allowUndefined&&typeof t>"u"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const q9=new Map;function LEe(){q9.clear()}function r7e(e){return q9.get(e)}function i7e(e,t){q9.set(e,t)}function NH(e){q9.delete(e)}var sE,uR,s7e=function(e){if("WebkitTransition"in e.style)sE="webkitTransitionEnd",uR="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");sE="transitionend",uR="animationend"}},NEe=function(e){sE||s7e(e)},n7e=function(e,t){return t===void 0&&(t=e+"-active"),function(r){NEe(r);var i=!1,s=function(n){i||(i=!0,r.removeEventListener(sE,s),r.removeEventListener(uR,s),r.classList.remove(e),r.classList.remove(t))};r.classList.add(e),r.addEventListener(sE,s),r.addEventListener(uR,s),requestAnimationFrame(function(){r.classList.add(t)})}},o7e=function(e,t){return t===void 0&&(t=e+"-active"),function(r,i){NEe(r);var s=!1,n=function(o){s||(s=!0,r.removeEventListener(sE,n),r.removeEventListener(uR,n),i())};r.classList.add(e),r.addEventListener(sE,n),r.addEventListener(uR,n),requestAnimationFrame(function(){r.classList.add(t)})}};const a7e=te.getLogger("esri.widgets.support.widgetUtils");function mne(e){const t=yd.acquire();for(let i=0;i<arguments.length;i++){const s=arguments[i],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const r=t.join(" ");return yd.release(t),r}const l7e=(()=>{const e=new Map,t=new ResizeObserver(r=>{var i;LEe();for(const s of r)(i=e.get(s.target))==null||i(s)});return(r,i,s)=>(e.has(r)&&a7e.error("Already observing element",r),e.set(r,i),t.observe(r,s),cg(()=>{t.unobserve(r),e.delete(r)}))})();function Fh(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function c7e(e){return Fh(e)?"rtl":"ltr"}function Lhe(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function af(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function u7e(e,t){return(e==="enter"?n7e:o7e)(t)}const d7e=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],h7e=d7e.reduce((e,t)=>(e[t]=[],e),{}),p7e=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],FEe=new t7e({whiteList:h7e,onTagAttr:(e,t,r)=>{const i=`${t}="${r}"`;if(p7e.includes(t))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function f7e(e,t){const r=e.getBoundingClientRect(),i=t.getBoundingClientRect(),s=r.top+r.height,n=i.top+i.height,o=r.top,a=i.top;(s>n||o<a)&&e.scrollIntoView({block:"end"})}function Ow(e){return e==="Enter"||e===" "}const kEe="http://www.w3.org/",W9=`${kEe}2000/svg`,UEe=`${kEe}1999/xlink`;let cz,Nhe=[],gne=(e,t)=>{let r={};return Object.keys(e).forEach(i=>{r[i]=e[i]}),t&&Object.keys(t).forEach(i=>{r[i]=t[i]}),r},yne=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),BEe=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},m7e=(e,t,r)=>{if(t.vnodeSelector!==""){for(let i=r;i<e.length;i++)if(yne(e[i],t))return i}return-1},FH=(e,t,r,i)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(yne(a,s))throw new Error(`${r.vnodeSelector} had a ${s.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},g7e=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},bJ=[],wJ=!1,zEe=e=>{(e.children||[]).forEach(zEe),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},Fhe=()=>{wJ=!1,bJ.forEach(zEe),bJ.length=0},khe=e=>{bJ.push(e),wJ||(wJ=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Fhe,{timeout:16}):setTimeout(Fhe,16))},Uhe=e=>{let t=e.domNode;if(e.properties){let r=e.properties.exitAnimation;if(r)return t.style.pointerEvents="none",void r(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),khe(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),khe(e))},y7e=(e,t,r)=>{if(!t)return;let i=r.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")xJ(e,l,!0);else if(a==="classes"){let c=Object.keys(l),d=c.length;for(let p=0;p<d;p++){let f=c[p];l[f]&&e.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),d=c.length;for(let p=0;p<d;p++){let f=c[p],m=l[f];m&&(BEe(m),r.styleApplyer(e,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,e,t)),a==="oninput"&&function(){let d=l;l=function(p){d.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),e[a]=l):r.namespace===W9?a==="href"?e.setAttributeNS(UEe,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=FEe.sanitize(l):e.setAttribute(a,l):e[a]=l}}},_7e=(e,t,r)=>{if(t)for(let i of t)zO(i,e,void 0,r)},VEe=(e,t,r)=>{_7e(e,t.children,r),t.text&&(e.textContent=t.text),y7e(e,t.properties,r),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,r,t.vnodeSelector,t.properties,t.children])},zO=(e,t,r,i)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),r!==void 0?t.insertBefore(s,r):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let d=o.charAt(n-1),p=o.slice(n,l);d==="."?s.classList.add(p):d==="#"?s.id=p:(p==="svg"&&(i=gne(i,{namespace:W9})),i.namespace!==void 0?s=e.domNode=a.createElementNS(i.namespace,p):(s=e.domNode=e.domNode||a.createElement(p),p==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),r!==void 0?t.insertBefore(s,r):s.parentNode!==t&&t.appendChild(s)),n=l+1}}VEe(s,e,i)}},xJ=(e,t,r)=>{t&&t.split(" ").forEach(i=>{i&&e.classList.toggle(i,r)})},v7e=(e,t,r,i)=>{if(!r)return;let s=!1,n=Object.keys(r),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=r[l],d=t[l];if(l==="class")d!==c&&(xJ(e,d,!1),xJ(e,c,!0));else if(l==="classes"){let p=e.classList,f=Object.keys(c),m=f.length;for(let g=0;g<m;g++){let _=f[g],x=!!c[_];x!==!!d[_]&&(s=!0,x?p.add(_):p.remove(_))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let g=p[m],_=c[g];_!==d[g]&&(s=!0,_?(BEe(_),i.styleApplyer(e,g,_)):i.styleApplyer(e,g,""))}}else if(c||typeof d!="string"||(c=""),l==="value"){let p=e[l];p!==c&&(e["oninput-value"]?p===e["oninput-value"]:c!==d)&&(e[l]=c,e["oninput-value"]=void 0),c!==d&&(s=!0)}else if(c!==d){let p=typeof c;p==="function"&&i.eventHandlerInterceptor||(i.namespace===W9?l==="href"?e.setAttributeNS(UEe,l,c):e.setAttribute(l,c):p==="string"?l==="innerHTML"?e[l]=FEe.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},b7e=(e,t,r,i,s)=>{if(r===i)return!1;i=i||Nhe;let n,o=(r=r||Nhe).length,a=i.length,l=0,c=0,d=!1;for(;c<a;){let p=l<o?r[l]:void 0,f=i[c];if(p!==void 0&&yne(p,f))d=cz(p,f,s)||d,l++;else{let m=m7e(r,f,l+1);if(m>=0){for(n=l;n<m;n++)Uhe(r[n]),FH(r,n,e,"removed");d=cz(r[m],f,s)||d,l=m+1}else zO(f,t,l<o?r[l].domNode:void 0,s),g7e(f),FH(i,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)Uhe(r[n]),FH(r,n,e,"removed");return d};cz=(e,t,r)=>{let i=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=i.ownerDocument.createTextNode(t.text);return i.parentNode.replaceChild(o,i),t.domNode=o,s=!0,s}t.domNode=i}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(r=gne(r,{namespace:W9})),e.text!==t.text&&(n=!0,t.text===void 0?i.removeChild(i.firstChild):i.textContent=t.text),t.domNode=i,n=b7e(t,i,e.children,t.children,r)||n,n=v7e(i,e.properties,t.properties,r)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[i,r,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(i,t.properties,e.properties),s};let hP=(e,t)=>({getLastRender:()=>e,update:r=>{if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=e;e=r,cz(i,r,t)},domNode:e.domNode});const w7e={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{t.charAt(0)==="-"?e.style.setProperty(t,r):e.style[t]=r}};let CA=e=>gne(w7e,e),Mw={create:(e,t)=>(t=CA(t),zO(e,document.createElement("div"),void 0,t),hP(e,t)),append:(e,t,r)=>(r=CA(r),zO(t,e,void 0,r),hP(t,r)),insertBefore:(e,t,r)=>(r=CA(r),zO(t,e.parentNode,e,r),hP(t,r)),merge:(e,t,r)=>(r=CA(r),t.domNode=e,VEe(e,t,r),hP(t,r)),replace:(e,t,r)=>(r=CA(r),zO(t,e.parentNode,e,r),e.parentNode.removeChild(e),hP(t,r))},jEe,x7e=(e,t)=>{let r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r};jEe=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let T7e=(e,t)=>{let r=e;return t.forEach(i=>{r=r&&r.children?jEe(r.children,s=>s.domNode===i):void 0}),r},S7e=(e,t,r)=>{let i=function(s){r("domEvent",s);let n=t(),o=x7e(s.currentTarget,n.domNode);o.reverse();let a,l=T7e(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",s),a};return(s,n,o,a)=>i},TJ=e=>{let t,r,i=CA(e),s=i.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let g,_=()=>g;i.eventHandlerInterceptor=S7e(t,_,s),g=p(f,m(),i),a.push(g),l.push(m)},d=()=>{if(r=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:d,scheduleRender:()=>{r||o||(r=requestAnimationFrame(d))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(p,f)=>{c(Mw.append,p,f)},insertBefore:(p,f)=>{c(Mw.insertBefore,p,f)},merge:(p,f)=>{c(Mw.merge,p,f)},replace:(p,f)=>{c(Mw.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},t};const E7e={handleInterceptedEvent:(e,t,r,i)=>(e.scheduleRender(),t.properties[`on${i.type}`].apply(t.properties.bind||r,[i]))},C7e={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{e.style[t]=r}},A7e=e=>({...C7e,...e}),O7e=(e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r},M7e=(e,t)=>e.find(t),Bhe=(e,t,r=!1)=>{let i=e;return t.forEach((s,n)=>{const o=i!=null&&i.children?M7e(i.children,a=>a.domNode===s):void 0;r&&!o&&n!==t.length-1||(i=o)}),i},R7e=e=>{let t;const r={...E7e,...e},i=A7e(r),s=i.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],d=(f,m,g)=>{var b;let _;i.eventHandlerInterceptor=(w,T,E,O)=>function(A){let R;s("domEvent",A);const D=O7e(A.currentTarget,_.domNode),k=D.some(q=>{var G;return customElements.get((G=q==null?void 0:q.tagName)==null?void 0:G.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!k)D.reverse(),R=Bhe(_.getLastRender(),D);else{const q=A.composedPath(),G=q.slice(q.indexOf(A.currentTarget),q.indexOf(_.domNode)).filter(J=>J.getRootNode()===J.ownerDocument).reverse();R=Bhe(_.getLastRender(),G,!0)}let L;return R&&(L=r.handleInterceptedEvent(t,R,this,A)),s("domEventProcessed",A),L},(b=r.postProcessProjectionOptions)==null||b.call(r,i);const x=g();_=f(m,x,i),l.push(_),c.push(g),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,x)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(p=r.modifyDoRenderImplementation(p,l,c)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(f,m)=>{d(Mw.append,f,m)},insertBefore:(f,m)=>{d(Mw.insertBefore,f,m)},merge:(f,m)=>{d(Mw.merge,f,m)},replace:(f,m)=>{d(Mw.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},t},Zr={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let AA,GEe,X9,HEe=!1,uz=!1,_ne=!1,_h=!1,zhe=null,SJ=!1;const eUt={isDev:!!Zr.isDev,isBrowser:!0,isServer:!1,isTesting:!!Zr.isTesting},tUt=e=>{const t=new URL(e,Hl.$resourcesUrl$);return t.origin!==EI.location.origin?t.href:t.pathname},I7e=e=>Hl.$resourcesUrl$=e,nE=(e,t="")=>()=>{},Vhe="http://www.w3.org/1999/xlink",jhe={},P7e="http://www.w3.org/2000/svg",$7e="http://www.w3.org/1999/xhtml",D7e=e=>e!=null,vne=e=>(e=typeof e,e==="object"||e==="function"),qEe=(e,t,...r)=>{let i=null,s=null,n=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)i=p[f],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof e!="function"&&!vne(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?dz(null,i):i),a=o)};if(c(r),t&&(Zr.isDev&&e==="input"&&k7e(t),Zr.vdomKey&&t.key&&(s=t.key),Zr.slotRelocation&&t.name&&(n=t.name),Zr.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(Zr.isDev&&l.some(WEe)&&hGe(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Zr.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,N7e);const d=dz(e,null);return d.$attrs$=t,l.length>0&&(d.$children$=l),Zr.vdomKey&&(d.$key$=s),Zr.slotRelocation&&(d.$name$=n),d},dz=(e,t)=>{const r={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Zr.vdomAttribute&&(r.$attrs$=null),Zr.vdomKey&&(r.$key$=null),Zr.slotRelocation&&(r.$name$=null),r},L7e={},WEe=e=>e&&e.$tag$===L7e,N7e={forEach:(e,t)=>e.map(Ghe).forEach(t),map:(e,t)=>e.map(Ghe).map(t).map(F7e)},Ghe=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),F7e=e=>{if(typeof e.vtag=="function"){const r=Object.assign({},e.vattrs);return e.vkey&&(r.key=e.vkey),e.vname&&(r.name=e.vname),qEe(e.vtag,r,...e.vchildren||[])}const t=dz(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},k7e=e=>{const t=Object.keys(e),r=t.indexOf("value");if(r===-1)return;const i=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(r<i||r<s||r<n||r<o)&&nCe('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},U7e=e=>pGe.map(t=>t(e)).find(t=>!!t),B7e=(e,t)=>e!=null&&!vne(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,z7e=e=>Zr.lazyLoad?SI(e).$hostElement$:e,rUt=(e,t,r)=>{const i=z7e(e);return{emit:s=>(Zr.isDev&&!i.isConnected&&nCe(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),V7e(i,t,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:s}))}},V7e=(e,t,r)=>{const i=Hl.ce(t,r);return e.dispatchEvent(i),i},Hhe=new WeakMap,j7e=(e,t,r)=>{let i=pz.get(e);gGe&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=t:i.replaceSync(t)):i=t,pz.set(e,i)},G7e=(e,t,r,i)=>{let s=XEe(t,r);const n=pz.get(s);if(e=e.nodeType===11?e:ig,n)if(typeof n=="string"){e=e.head||e;let o=Hhe.get(e),a;o||Hhe.set(e,o=new Set),o.has(s)||(a=ig.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},H7e=e=>{const t=e.$cmpMeta$,r=e.$hostElement$,i=t.$flags$,s=nE("attachStyles",t.$tagName$),n=G7e(fz&&r.shadowRoot?r.shadowRoot:r.getRootNode(),t,e.$modeName$);i&10&&(r["s-sc"]=n,r.classList.add(n+"-h"),i&2&&r.classList.add(n+"-s")),s()},XEe=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),qhe=(e,t,r,i,s,n)=>{if(r!==i){let o=Zhe(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=Whe(r),d=Whe(i);l.remove(...c.filter(p=>p&&!d.includes(p))),l.add(...d.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?e.style.setProperty(l,i[l]):e.style[l]=i[l])}else if(t!=="key")if(t==="ref")i&&i(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Zhe(EI,a)?t=a.slice(2):t=a[2]+t.slice(3),r&&Hl.rel(e,t,r,!1),i&&Hl.ael(e,t,i,!1);else{const l=vne(i);if((o||l&&i!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=i;else{const d=i==null?"":i;t==="list"?o=!1:(r==null||e[t]!=d)&&(e[t]=d)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),i==null||i===!1?(i!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(Vhe,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(i=i===!0?"":i,c?e.setAttributeNS(Vhe,t,i):e.setAttribute(t,i))}}},q7e=/\s/,Whe=e=>e?e.split(q7e):[],YEe=(e,t,r,i)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||jhe,o=t.$attrs$||jhe;for(i in n)i in o||qhe(s,i,n[i],void 0,r,t.$flags$);for(i in o)qhe(s,i,n[i],o[i],r,t.$flags$)},hz=(e,t,r,i)=>{const s=t.$children$[r];let n=0,o,a,l;if(HEe||(_ne=!0,s.$tag$==="slot"&&(AA&&i.classList.add(AA+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=ig.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=ig.createTextNode("");else{if(_h||(_h=s.$tag$==="svg"),o=s.$elm$=ig.createElementNS(_h?P7e:$7e,s.$flags$&2?"slot-fb":s.$tag$),_h&&s.$tag$==="foreignObject"&&(_h=!1),YEe(null,s,_h),D7e(AA)&&o["s-si"]!==AA&&o.classList.add(o["s-si"]=AA),s.$children$)for(n=0;n<s.$children$.length;++n)a=hz(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?_h=!1:o.tagName==="foreignObject"&&(_h=!0)}return o["s-hn"]=X9,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=GEe,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[r],l&&l.$tag$===s.$tag$&&e.$elm$&&JL(e.$elm$,!1)),o},JL=(e,t)=>{Hl.$flags$|=1;const r=e.childNodes;for(let i=r.length-1;i>=0;i--){const s=r[i];s["s-hn"]!==X9&&s["s-ol"]&&(KEe(s).insertBefore(s,bne(s)),s["s-ol"].remove(),s["s-ol"]=void 0,_ne=!0),t&&JL(s,t)}Hl.$flags$&=-2},ZEe=(e,t,r,i,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===X9&&(o=o.shadowRoot);s<=n;++s)i[s]&&(a=hz(null,r,s,e),a&&(i[s].$elm$=a,o.insertBefore(a,bne(t))))},JEe=(e,t,r,i,s)=>{for(;t<=r;++t)(i=e[t])&&(s=i.$elm$,tCe(i),uz=!0,s["s-ol"]?s["s-ol"].remove():JL(s,!0),s.remove())},W7e=(e,t,r,i)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],d=t[l],p=i.length-1,f=i[0],m=i[p],g,_;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(d==null)d=t[--l];else if(f==null)f=i[++n];else if(m==null)m=i[--p];else if(a5(c,f))OA(c,f),c=t[++s],f=i[++n];else if(a5(d,m))OA(d,m),d=t[--l],m=i[--p];else if(a5(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&JL(c.$elm$.parentNode,!1),OA(c,m),e.insertBefore(c.$elm$,d.$elm$.nextSibling),c=t[++s],m=i[--p];else if(a5(d,f))(c.$tag$==="slot"||m.$tag$==="slot")&&JL(d.$elm$.parentNode,!1),OA(d,f),e.insertBefore(d.$elm$,c.$elm$),d=t[--l],f=i[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(_=t[o],_.$tag$!==f.$tag$?g=hz(t&&t[n],r,o,e):(OA(_,f),t[o]=void 0,g=_.$elm$),f=i[++n]):(g=hz(t&&t[n],r,n,e),f=i[++n]),g&&KEe(c.$elm$).insertBefore(g,bne(c.$elm$))}s>l?ZEe(e,i[p+1]==null?null:i[p+1].$elm$,r,i,n,p):n>p&&JEe(t,s,l)},a5=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,bne=e=>e&&e["s-ol"]||e,KEe=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,OA=(e,t)=>{const r=t.$elm$=e.$elm$,i=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(_h=n==="svg"?!0:n==="foreignObject"?!1:_h,n==="slot"||YEe(e,t,_h),i!==null&&s!==null?W7e(r,i,t,s):s!==null?(e.$text$!==null&&(r.textContent=""),ZEe(r,null,t,s,0,s.length-1)):i!==null&&JEe(i,0,i.length-1),_h&&n==="svg"&&(_h=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(r.data=o)},QEe=e=>{const t=e.childNodes;let r,i,s,n,o,a;for(i=0,s=t.length;i<s;i++)if(r=t[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){r.hidden=!0;break}}QEe(r)}},Lm=[],eCe=e=>{let t,r,i,s,n,o,a=0;const l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(r=t["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,s=t["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==t["s-hn"]&&(Xhe(r,s)?(n=Lm.find(d=>d.$nodeToRelocate$===r),uz=!0,r["s-sn"]=r["s-sn"]||s,n?n.$slotRefNode$=t:Lm.push({$slotRefNode$:t,$nodeToRelocate$:r}),r["s-sr"]&&Lm.map(d=>{Xhe(d.$nodeToRelocate$,r["s-sn"])&&(n=Lm.find(p=>p.$nodeToRelocate$===r),n&&!d.$slotRefNode$&&(d.$slotRefNode$=n.$slotRefNode$))})):Lm.some(d=>d.$nodeToRelocate$===r)||Lm.push({$nodeToRelocate$:r}));t.nodeType===1&&eCe(t)}},Xhe=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",tCe=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(tCe)},X7e=(e,t)=>{const r=e.$hostElement$,i=e.$cmpMeta$,s=e.$vnode$||dz(null,null),n=WEe(t)?t:qEe(null,null,t);X9=r.tagName,i.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=r[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=r.shadowRoot||r,AA=r["s-sc"],GEe=r["s-cr"],HEe=fz&&(i.$flags$&1)!==0,uz=!1,OA(s,n);{if(Hl.$flags$|=1,_ne){eCe(n.$elm$);let o,a,l,c,d,p,f=0;for(;f<Lm.length;f++)o=Lm[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=ig.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Lm.length;f++)if(o=Lm[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,d=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){d=p;break}(!d&&c!==a.parentNode||a.nextSibling!==d)&&a!==d&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,d))}else a.nodeType===1&&(a.hidden=!0)}uz&&QEe(n.$elm$),Hl.$flags$&=-2,Lm.length=0}},Y7e=(e,t)=>{},wne=(e,t)=>(Zr.taskQueue&&Zr.updatable&&(e.$flags$|=16),Y7e(e,e.$ancestorComponent$),vGe(()=>Z7e(e,t))),Z7e=(e,t)=>{const r=e.$hostElement$,i=nE("scheduleUpdate",e.$cmpMeta$.$tagName$),s=r;let n;return t?n=AM(s,"componentWillLoad"):n=AM(s,"componentWillUpdate"),n=Yhe(n,()=>AM(s,"componentWillRender")),i(),Yhe(n,()=>J7e(e,s,t))},J7e=async(e,t,r)=>{const i=e.$hostElement$,s=nE("update",e.$cmpMeta$.$tagName$);i["s-rc"],r&&H7e(e);const n=nE("render",e.$cmpMeta$.$tagName$);K7e(e,t,i),n(),s(),Q7e(e)},K7e=(e,t,r)=>{try{zhe=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Zr.hasRenderFn||Zr.reflect)&&(Zr.vdomRender||Zr.reflect)&&(Zr.hydrateServerSide||X7e(e,t))}catch(a){DF(a,e.$hostElement$)}return zhe=null,null},Q7e=e=>{const t=e.$cmpMeta$.$tagName$,r=e.$hostElement$,i=nE("postUpdate",t),s=r;e.$ancestorComponent$,AM(s,"componentDidRender"),e.$flags$&64?(AM(s,"componentDidUpdate"),i()):(e.$flags$|=64,AM(s,"componentDidLoad"),i())},iUt=e=>{if(Zr.updatable){const t=SI(e),r=t.$hostElement$.isConnected;return r&&(t.$flags$&18)===2&&wne(t,!1),r}return!1},AM=(e,t,r)=>{if(e&&e[t])try{return e[t](r)}catch(i){DF(i)}},Yhe=(e,t)=>e&&e.then?e.then(t):t(),eGe=(e,t)=>SI(e).$instanceValues$.get(t),tGe=(e,t,r,i)=>{const s=SI(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;r=B7e(r,i.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){s.$instanceValues$.set(t,r);{if(i.$watchers$&&a&128){const p=i.$watchers$[t];p&&p.map(f=>{try{l[f](r,o,t)}catch(m){DF(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,t)===!1)return;wne(s,!1)}}}},rGe=(e,t,r)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const i=Object.entries(t.$members$),s=e.prototype;i.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return eGe(this,n)},set(a){tGe(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Hl.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},iGe=async(e,t,r,i,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=U7e(e)]);const a=XEe(r,t.$modeName$);if(!pz.has(a)){const l=nE("registerStyles",r.$tagName$);j7e(a,o,!!(r.$flags$&1)),l()}}t.$ancestorComponent$,(()=>wne(t,!0))()},sGe=e=>{},nGe=e=>{if((Hl.$flags$&1)===0){const t=SI(e),r=t.$cmpMeta$,i=nE("connectedCallback",r.$tagName$);t.$flags$&1?(rCe(e,t,r.$listeners$),sGe(t.$lazyInstance$)):(t.$flags$|=1,r.$flags$&12&&oGe(e),r.$members$&&Object.entries(r.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),iGe(e,t,r)),i()}},oGe=e=>{const t=e["s-cr"]=ig.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},aGe=e=>{if((Hl.$flags$&1)===0){const t=SI(e);t.$rmListeners$&&(t.$rmListeners$.map(r=>r()),t.$rmListeners$=void 0)}},sUt=(e,t)=>{const r={$flags$:t[0],$tagName$:t[1]};Zr.member&&(r.$members$=t[2]),Zr.hostListener&&(r.$listeners$=t[3]),Zr.watchCallback&&(r.$watchers$=e.$watchers$),Zr.reflect&&(r.$attrsToReflect$=[]),Zr.shadowDom&&!fz&&r.$flags$&1&&(r.$flags$|=8);const i=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){dGe(this,r)},connectedCallback(){nGe(this),Zr.connectedCallback&&i&&i.call(this)},disconnectedCallback(){aGe(this),Zr.disconnectedCallback&&s&&s.call(this)},__attachShadow(){fz?Zr.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=r.$tagName$,rGe(e,r)},nUt=(e,t)=>t,rCe=(e,t,r,i)=>{r&&r.map(([s,n,o])=>{const a=cGe(e,s),l=lGe(t,o),c=uGe(s);Hl.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>Hl.rel(a,n,l,c))})},lGe=(e,t)=>r=>{try{Zr.lazyLoad||e.$hostElement$[t](r)}catch(i){DF(i)}},cGe=(e,t)=>t&4?ig:t&8?EI:t&16?ig.body:e,uGe=e=>fGe?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,iCe=new WeakMap,SI=e=>iCe.get(e),dGe=(e,t)=>{const r={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Zr.isDev&&(r.$renderCount$=0),Zr.method&&Zr.lazyLoad&&(r.$onInstancePromise$=new Promise(i=>r.$onInstanceResolve$=i)),Zr.asyncLoading&&(r.$onReadyPromise$=new Promise(i=>r.$onReadyResolve$=i),e["s-p"]=[],e["s-rc"]=[]),rCe(e,r,t.$listeners$),iCe.set(e,r)},Zhe=(e,t)=>t in e,DF=(e,t)=>(0,console.error)(e,t),sCe=Zr.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],hGe=(...e)=>console.error(...sCe,...e),nCe=(...e)=>console.warn(...sCe,...e),pz=new Map,pGe=[],EI=typeof window<"u"?window:{};Zr.cssVarShim&&EI.CSS;const ig=EI.document||{head:{}},oUt=EI.HTMLElement||class{},Hl={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,r,i)=>e.addEventListener(t,r,i),rel:(e,t,r,i)=>e.removeEventListener(t,r,i),ce:(e,t)=>new CustomEvent(e,t)},fz=Zr.shadowDomShim&&Zr.shadowDom?(()=>(ig.head.attachShadow+"").indexOf("[native")>-1)():!0,fGe=(()=>{let e=!1;try{ig.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),mGe=e=>Promise.resolve(e),gGe=Zr.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})():!1,Jhe=[],oCe=[],yGe=(e,t)=>r=>{e.push(r),SJ||(SJ=!0,t&&Hl.$flags$&4?_Ge(EJ):Hl.raf(EJ))},Khe=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(r){DF(r)}e.length=0},EJ=()=>{Khe(Jhe),Khe(oCe),(SJ=Jhe.length>0)&&Hl.raf(EJ)},_Ge=e=>mGe().then(e),vGe=yGe(oCe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.97
 */const aCe="calcite-theme-auto",lCe="calcite-theme-dark",bGe="calcite-theme-light",aUt={autoTheme:aCe,darkTheme:lCe,lightTheme:bGe,rtl:"calcite--rtl"},lUt={loading:"Loading"};function cUt(e){return Array.isArray(e)?e:Array.from(e)}function uUt(e){const t="dir",r=`[${t}]`,i=wGe(e,r);return i?i.getAttribute(t):"ltr"}function dUt(e,t,r){const i=`[${t}]`,s=e.closest(i);return s?s.getAttribute(t):r}function cCe(e){return e.getRootNode()}function uCe(e){return e.host||null}function hUt(e,{selector:t,id:r}){function i(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=cCe(s),o=r?"getElementById"in n?n.getElementById(r):null:t?n.querySelector(t):null,a=uCe(n);return o||(a?i(a):null)}return i(e)}function wGe(e,t){function r(i){return i?i.closest(t)||r(uCe(cCe(i))):null}return r(e)}function xGe(e,t){return dCe(e,t)}function dCe(e,t){if(!e)return;const r=t(e);if(r!==void 0)return r;const{parentNode:i}=e;return dCe(i instanceof ShadowRoot?i.host:i,t)}function pUt(e,t){return!!xGe(t,r=>r===e?!0:void 0)}function TGe(e){return typeof(e==null?void 0:e.setFocus)=="function"}async function fUt(e){if(!!e)return TGe(e)?e.setFocus():e.focus()}const KL=":not([slot])";function mUt(e,t,r){t&&!Array.isArray(t)&&typeof t!="string"&&(r=t,t=null);const i=t?Array.isArray(t)?t.map(s=>`[slot="${s}"]`).join(","):`[slot="${t}"]`:KL;return r!=null&&r.all?SGe(e,i,r):EGe(e,i,r)}function hCe(e,t){return e?Array.from(e.children||[]).filter(r=>r==null?void 0:r.matches(t)):[]}function SGe(e,t,r){let i=t===KL?hCe(e,KL):Array.from(e.querySelectorAll(t));i=r&&r.direct===!1?i:i.filter(n=>n.parentElement===e),i=r!=null&&r.matches?i.filter(n=>n==null?void 0:n.matches(r.matches)):i;const s=r==null?void 0:r.selector;return s?i.map(n=>Array.from(n.querySelectorAll(s))).reduce((n,o)=>[...n,...o],[]).filter(n=>!!n):i}function EGe(e,t,r){let i=t===KL?hCe(e,KL)[0]||null:e.querySelector(t);i=r&&r.direct===!1||(i==null?void 0:i.parentElement)===e?i:null,i=r!=null&&r.matches?i!=null&&i.matches(r.matches)?i:null:i;const s=r==null?void 0:r.selector;return s?i==null?void 0:i.querySelector(s):i}function gUt(e,t,r){if(typeof t=="string"&&t!=="")return t;if(t==="")return e[r]}function yUt(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)}function _Ut(e){return Boolean(e).toString()}function vUt(e){return!!(e.isPrimary&&e.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.97
 */function Qhe(){const{classList:e}=document.body,t=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>e.contains(lCe)||e.contains(aCe)&&t?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteThemeChange",{bubbles:!0,detail:{theme:o}})),s=o=>{n!==o&&i(o),n=o};let n=r();i(n),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>s(o.matches?"dark":"light")),new MutationObserver(()=>s(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function CGe(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?Qhe():document.addEventListener("DOMContentLoaded",()=>Qhe(),{once:!0}))}const AGe=CGe;AGe();let pCe;function OGe(){I7e(Rh(ui(pCe)))}pCe="components/assets";const fCe=Symbol("widget"),MGe=[],RGe={},mz=new WeakMap;function mCe(e,t){let r=t.children;if(r&&r.length)for(let s=0;s<r.length;++s)r[s]=mCe(e,r[s]);else r=MGe;const i=t.vnodeSelector;if(xne(i)){const s=t.properties||RGe,n=s.key||i;return{vnodeSelector:"div",properties:{key:n,afterCreate:IGe,afterUpdate:PGe,afterRemoved:gCe,parentWidget:e,widgetConstructor:i,widgetProperties:{...s,key:n,children:r}},children:void 0,text:void 0,domNode:null}}return t}function IGe(e,t,r,{parentWidget:i,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=e,mz.set(e,o),(a=o.afterCreate)==null||a.call(o,o,e),i._internalHandles.add(cg(()=>gCe(e)))}function PGe(e,t,r,{widgetProperties:i}){var n;const s=mz.get(e);s&&(s.set(i),(n=s.afterUpdate)==null||n.call(s,s,e))}function gCe(e){const t=mz.get(e);t&&(t.destroy(),mz.delete(e))}function xne(e){return typeof e=="function"&&e[fCe]}const epe=new Set;function $Ge(e){epe.add(e),e.finally(()=>epe.delete(e))}const DGe="esri.widgets.Widget";let LGe=0;const NGe={widgetIcon:"esri-icon-checkbox-unchecked"};function yCe(e,t){for(const r in t)e[r]!=null&&(typeof e[r]=="object"&&typeof t[r]=="object"?yCe(e[r],t==null?void 0:t[r]):e[r]=t[r]);return e}const FGe=R7e({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(i,s,n,o)=>{const a=t==null?void 0:t(i,s,n,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in n)||l){const c=i[2].toLowerCase()+i.slice(3),d=m=>a==null?void 0:a.call(n,m);n.addEventListener(c,d,l);const p=()=>n.removeEventListener(c,d,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(e,t,r,i){const{eventPhase:s,type:n}=i,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(l&&a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,l&&a in l))&&(LEe(),e.scheduleRender(),l[a].call(l.bind||r,i))}});let kH=!1,Jo=class extends G9($s.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new hr,this._projector=FGe,this._readyForTrueRender=!1,this.iconClass=NGe.widgetIcon,this.key=this,this._loadLocale=Bse(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await zo(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{let l=await rne(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=yCe(ne(l),this.uiStrings)),this[a]=l}));for(const o of n)o.error&&te.getLogger(this.declaredClass).error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),OGe();const r="esri-widget-uid-"+pne(),i=this.render.bind(this);this._trackingTarget=new B9(()=>this.scheduleRender());const s=()=>{var d;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0};const n=i();let{properties:o}=n;o||(n.properties=o={});let{key:a,styles:l}=o;a||(o.key=r),l||(o.styles=l={}),l.display||(l.display="");let c=0;return(d=n.children)==null||d.forEach(p=>{if(xne(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),mCe(this,n)};this.render=()=>{var o;if(kH)return s();let n=(o=r7e(this))!=null?o:null;if(n)return n;this._trackingTarget.clear(),kH=!0;try{n=zv(this._trackingTarget,s)}catch(a){throw console.error(a),a}finally{kH=!1}return n&&i7e(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),$Ge(this._resourcesFetch)}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(YZ)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Qe(this._trackingTarget),Qe(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,NH(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return $F(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+LGe++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(NH(this),this._projector.scheduleRender())}classes(...e){return mne.apply(this,e)}renderNow(){NH(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),(t=this._delegatedEventNames)!=null&&t.length&&this._internalHandles.add(ie(()=>this.viewModel,(r,i)=>{i&&this._internalHandles.remove("delegated-events"),r&&N9(r)&&this._internalHandles.add(this._delegatedEventNames.map(s=>mx(r,s,n=>{this.emit(s,n)})),"delegated-events")},pt)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(YZ),this.scheduleRender()};this._internalHandles.add([B2e(e),ie(()=>this.uiStrings,e),no(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var t;this._attached&&(this._projector.detach(this.render),this._attached=!1),(t=e==null?void 0:e.parentNode)==null||t.removeChild(e)}};Jo[fCe]=!0,u([h()],Jo.prototype,"_readyForTrueRender",void 0),u([h({value:null})],Jo.prototype,"container",null),u([Gt("container")],Jo.prototype,"castContainer",null),u([h()],Jo.prototype,"domNode",null),u([h()],Jo.prototype,"iconClass",void 0),u([h()],Jo.prototype,"id",null),u([h()],Jo.prototype,"label",null),u([h()],Jo.prototype,"renderable",null),u([h()],Jo.prototype,"uiStrings",void 0),u([h()],Jo.prototype,"viewModel",void 0),u([h({value:!0})],Jo.prototype,"visible",null),u([h()],Jo.prototype,"key",void 0),u([h()],Jo.prototype,"children",void 0),u([h()],Jo.prototype,"afterCreate",void 0),u([h()],Jo.prototype,"afterUpdate",void 0),u([h()],Jo.prototype,"afterRemoved",void 0),Jo=u([I(DGe)],Jo);const Ss=Jo;let pb=class extends be{constructor(e){super(e)}get editedBookmark(){const{bookmark:e}=this;return e?this._get("editedBookmark")||e.clone():null}get state(){return this._get("state")}set state(e){this.validationState=void 0,this.loading=void 0,this._set("state",e)}};u([h()],pb.prototype,"bookmark",void 0),u([h({readOnly:!0})],pb.prototype,"editedBookmark",null),u([h()],pb.prototype,"state",null),u([h()],pb.prototype,"validationState",void 0),u([h()],pb.prototype,"loading",void 0),pb=u([I("esri.widgets.Bookmarks.UserState")],pb);const CJ=pb,ki=e=>{let t=class extends e{clone(){var l;const r=gd(Gl(this),"unable to clone instance of non-accessor class"),i=r.metadatas,s=r.store,n={},o=new Map;for(const c in i){const d=i[c],p=s==null?void 0:s.originOf(c),f=d.clonable;if(d.readOnly||f===!1||p!==Jr.USER&&p!==Jr.DEFAULTS&&p!==Jr.WEB_MAP&&p!==Jr.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof f=="function"?f(m):f==="reference"?m:XZ(m),m!=null&&g==null||(p===Jr.DEFAULTS?o.set(c,g):n[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=Gl(a))==null?void 0:l.store;if(c)for(const[d,p]of o)c.set(d,p,Jr.DEFAULTS)}return a}};return t=u([I("esri.core.Clonable")],t),t};let tpe=class extends ki(be){};tpe=u([I("esri.core.Clonable")],tpe);function $(){return[0,0,0]}function ws(e){return[e[0],e[1],e[2]]}function Fe(e,t,r){return[e,t,r]}function pu(e){const t=$(),r=Math.min(3,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function Tne(e,t){return new Float64Array(e,t,3)}function _Ce(){return $()}function vCe(){return Fe(1,1,1)}function bCe(){return Fe(1,0,0)}function wCe(){return Fe(0,1,0)}function Sne(){return Fe(0,0,1)}const Ic=_Ce(),Xy=vCe(),kGe=bCe(),UGe=wCe(),xCe=Sne();Object.freeze(Object.defineProperty({__proto__:null,create:$,clone:ws,fromValues:Fe,fromArray:pu,createView:Tne,zeros:_Ce,ones:vCe,unitX:bCe,unitY:wCe,unitZ:Sne,ZEROS:Ic,ONES:Xy,UNIT_X:kGe,UNIT_Y:UGe,UNIT_Z:xCe},Symbol.toStringTag,{value:"Module"}));let Ene=1e-6;function Xl(){return Ene}function BGe(e){Ene=e}const LF=Math.random,zGe=Math.PI/180,VGe=180/Math.PI;function Y9(e){return e*zGe}function jGe(e){return e*VGe}function GGe(e,t){return Math.abs(e-t)<=Ene*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,getEpsilon:Xl,setEpsilon:BGe,RANDOM:LF,toRadian:Y9,toDegree:jGe,equals:GGe},Symbol.toStringTag,{value:"Module"}));function Ie(e){const t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function le(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ue(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function ye(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function ge(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Z9(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function gz(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function HGe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function TCe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function AJ(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function SCe(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function ECe(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function qGe(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function WGe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function de(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function p2(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function Ni(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}function jo(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return r*r+i*i+s*s}function Rc(e){const t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function Fl(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function XGe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function xe(e,t){const r=t[0],i=t[1],s=t[2];let n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function Te(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function At(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2];return e[0]=s*l-n*a,e[1]=n*o-i*l,e[2]=i*a-s*o,e}function $n(e,t,r,i){const s=t[0],n=t[1],o=t[2];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e}function YGe(e,t,r,i,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),d=o*(3-2*n);return e[0]=t[0]*a+r[0]*l+i[0]*c+s[0]*d,e[1]=t[1]*a+r[1]*l+i[1]*c+s[1]*d,e[2]=t[2]*a+r[2]*l+i[2]*c+s[2]*d,e}function ZGe(e,t,r,i,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,d=3*n*a,p=3*l*o,f=l*n;return e[0]=t[0]*c+r[0]*d+i[0]*p+s[0]*f,e[1]=t[1]*c+r[1]*d+i[1]*p+s[1]*f,e[2]=t[2]*c+r[2]*d+i[2]*p+s[2]*f,e}function JGe(e,t){t=t||1;const r=LF,i=2*r()*Math.PI,s=2*r()-1,n=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(i)*n,e[1]=Math.sin(i)*n,e[2]=s*t,e}function je(e,t,r){const i=t[0],s=t[1],n=t[2];return e[0]=r[0]*i+r[4]*s+r[8]*n+r[12],e[1]=r[1]*i+r[5]*s+r[9]*n+r[13],e[2]=r[2]*i+r[6]*s+r[10]*n+r[14],e}function Td(e,t,r){const i=t[0],s=t[1],n=t[2];return e[0]=i*r[0]+s*r[3]+n*r[6],e[1]=i*r[1]+s*r[4]+n*r[7],e[2]=i*r[2]+s*r[5]+n*r[8],e}function Vh(e,t,r){const i=r[0],s=r[1],n=r[2],o=r[3],a=t[0],l=t[1],c=t[2];let d=s*c-n*l,p=n*a-i*c,f=i*l-s*a,m=s*f-n*p,g=n*d-i*f,_=i*p-s*d;const x=2*o;return d*=x,p*=x,f*=x,m*=2,g*=2,_*=2,e[0]=a+d+m,e[1]=l+p+g,e[2]=c+f+_,e}function KGe(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function QGe(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function eHe(e,t,r,i){const s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function CCe(e,t){le(l5,e),le(c5,t),xe(l5,l5),xe(c5,c5);const r=Te(l5,c5);return r>1?0:r<-1?Math.PI:Math.acos(r)}const l5=$(),c5=$();function tHe(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function _u(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function wx(e,t){if(e===t)return!0;const r=e[0],i=e[1],s=e[2],n=t[0],o=t[1],a=t[2],l=Xl();return Math.abs(r-n)<=l*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-a)<=l*Math.max(1,Math.abs(s),Math.abs(a))}function n1(e,t,r){const i=r[0]-t[0],s=r[1]-t[1],n=r[2]-t[2];let o=i*i+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=i*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const Pc=ge,rHe=Z9,iHe=gz,J9=Ni,Cne=jo,Em=Ie,OJ=Rc,rpe=Object.freeze(Object.defineProperty({__proto__:null,length:Ie,copy:le,set:ue,add:ye,subtract:ge,multiply:Z9,divide:gz,ceil:HGe,floor:TCe,abs:AJ,sign:SCe,min:ECe,max:qGe,round:WGe,scale:de,scaleAndAdd:p2,distance:Ni,squaredDistance:jo,squaredLength:Rc,negate:Fl,inverse:XGe,normalize:xe,dot:Te,cross:At,lerp:$n,hermite:YGe,bezier:ZGe,random:JGe,transformMat4:je,transformMat3:Td,transformQuat:Vh,rotateX:KGe,rotateY:QGe,rotateZ:eHe,angle:CCe,str:tHe,exactEquals:_u,equals:wx,direction:n1,sub:Pc,mul:rHe,div:iHe,dist:J9,sqrDist:Cne,len:Em,sqrLen:OJ},Symbol.toStringTag,{value:"Module"}));function jm(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Oi(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}function Ane(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function ACe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function OCe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function MCe(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function sHe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function nHe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function oHe(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function aHe(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function lHe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function NF(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function cHe(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function RCe(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(r*r+i*i+s*s+n*n)}function yz(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return r*r+i*i+s*s+n*n}function One(e){const t=e[0],r=e[1],i=e[2],s=e[3];return Math.sqrt(t*t+r*r+i*i+s*s)}function Mne(e){const t=e[0],r=e[1],i=e[2],s=e[3];return t*t+r*r+i*i+s*s}function uHe(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function dHe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ICe(e,t){const r=t[0],i=t[1],s=t[2],n=t[3];let o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=i*o,e[2]=s*o,e[3]=n*o),e}function PCe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function K9(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e[3]=a+i*(r[3]-a),e}function hHe(e,t){const r=LF;let i,s,n,o,a,l;t=t||1;do i=2*r()-1,s=2*r()-1,a=i*i+s*s;while(a>=1);do n=2*r()-1,o=2*r()-1,l=n*n+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return e[0]=t*i,e[1]=t*s,e[2]=t*n*c,e[3]=t*o*c,e}function kh(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3];return e[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,e[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,e[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,e[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,e}function pHe(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2],c=r[3],d=c*i+a*n-l*s,p=c*s+l*i-o*n,f=c*n+o*s-a*i,m=-o*i-a*s-l*n;return e[0]=d*c+m*-o+p*-l-f*-a,e[1]=p*c+m*-a+f*-o-d*-l,e[2]=f*c+m*-l+d*-a-p*-o,e[3]=t[3],e}function fHe(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function QL(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function $Ce(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3],d=Xl();return Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=d*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=d*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=d*Math.max(1,Math.abs(n),Math.abs(c))}const mHe=ACe,gHe=OCe,yHe=MCe,_He=RCe,vHe=yz,bHe=One,wHe=Mne,DCe=Object.freeze(Object.defineProperty({__proto__:null,copy:jm,set:Oi,add:Ane,subtract:ACe,multiply:OCe,divide:MCe,ceil:sHe,floor:nHe,min:oHe,max:aHe,round:lHe,scale:NF,scaleAndAdd:cHe,distance:RCe,squaredDistance:yz,length:One,squaredLength:Mne,negate:uHe,inverse:dHe,normalize:ICe,dot:PCe,lerp:K9,random:hHe,transformMat4:kh,transformQuat:pHe,str:fHe,exactEquals:QL,equals:$Ce,sub:mHe,mul:gHe,div:yHe,dist:_He,sqrDist:vHe,len:bHe,sqrLen:wHe},Symbol.toStringTag,{value:"Module"})),ipe=new Float32Array(1);function dR(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function _e(e,t,r){return Math.min(Math.max(e,t),r)}function dg(e){return(e&e-1)==0}function bUt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function wUt(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function Ft(e,t,r){return e+(t-e)*r}function Zt(e){return e*Math.PI/180}function Lc(e){return 180*e/Math.PI}function MJ(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function Eo(e){return Math.acos(_e(e,-1,1))}function vf(e){return Math.asin(_e(e,-1,1))}function OM(e,t,r=1e-6){return e===t?!0:!Number.isFinite(e)||!Number.isFinite(t)?!1:(e>t?e-t:t-e)<=r}const _z=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function xHe(e){return _z.setFloat64(0,e),_z.getBigInt64(0)}function THe(e){return _z.setBigInt64(0,e),_z.getFloat64(0)}const UH=BigInt("1000000");SHe(1);function SHe(e){const t=xHe(e=Math.abs(e)),r=THe(t<=UH?UH:t-UH);return Math.abs(e-r)}function EHe(e,t,r=1e-6){if(e===t)return!0;if(!Number.isFinite(e)||!Number.isFinite(t))return!1;const i=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(i>.01*r)return!1}else if(i/(s+n)>r)return!1;return!0}function CHe(e){return LCe(Math.max(-RJ,Math.min(e,RJ)))}function LCe(e){return ipe[0]=e,ipe[0]}function hR(e,t,r){const i=_e((r-e)/(t-e),0,1);return i*i*(3-2*i)}function spe(e,t){const r=Ie(e),i=vf(e[2]/r),s=Math.atan2(e[1]/r,e[0]/r);return ue(t,r,i,s),t}function xUt(e,t,r){return Oi(e,t[0],t[1],t[2],t[3]*r)}function TUt(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],i=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(OM(t,1)&&OM(r,1)&&OM(i,1))}const RJ=LCe(34028234663852886e22);class xx{constructor(t,r){this.min=t,this.max=r,this.range=r-t}ndiff(t,r=0){return Math.ceil((t-r)/this.range)*this.range+r}_normalize(t,r,i,s=0,n=!1){return(i-=s)<t?i+=this.ndiff(t-i):i>r&&(i-=this.ndiff(i-r)),n&&i===r&&(i=t),i+s}normalize(t,r=0,i=!1){return this._normalize(this.min,this.max,t,r,i)}clamp(t,r=0){return _e(t-r,this.min,this.max)+r}monotonic(t,r,i){return t<r?r:r+this.ndiff(t-r,i)}minimalMonotonic(t,r,i){return this._normalize(t,t+this.range,r,i)}center(t,r,i){return r=this.monotonic(t,r,i),this.normalize((t+r)/2,i)}diff(t,r,i){return this.monotonic(t,r,i)-t}shortestSignedDiff(t,r){t=this.normalize(t);const i=(r=this.normalize(r))-t,s=r<t?this.minimalMonotonic(t,r)-t:r-this.minimalMonotonic(r,t);return Math.abs(i)<Math.abs(s)?i:s}contains(t,r,i){return r=this.minimalMonotonic(t,r),(i=this.minimalMonotonic(t,i))>t&&i<r}}function Rne(e){for(const t in e){const r=e[t];r instanceof Function&&(e[t]=r.bind(e))}return e}const AHe=Rne(new xx(0,2*Math.PI)),Tx=Rne(new xx(-Math.PI,Math.PI)),Ine=Rne(new xx(0,360));function me(e,t,r){let i,s;return t===void 0||Array.isArray(t)?(s=e,r=t,i=[void 0]):(s=t,i=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;i.forEach(l=>{const c=Wse(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}function Le(e,t,r){let i,s;return t===void 0?(s=e,i=[void 0]):typeof t!="string"?(s=e,i=[void 0],r=t):(s=t,i=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of i){const c=Wse(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}var tf;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(tf||(tf={}));let y;const U={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(y=2e3;y<=2045;y++)U[y]=0;for(y=2056;y<=2065;y++)U[y]=0;for(y=2067;y<=2135;y++)U[y]=0;for(y=2137;y<=2154;y++)U[y]=0;for(y=2161;y<=2170;y++)U[y]=0;for(y=2172;y<=2193;y++)U[y]=0;for(y=2195;y<=2198;y++)U[y]=0;for(y=2200;y<=2203;y++)U[y]=0;for(y=2205;y<=2217;y++)U[y]=0;for(y=2222;y<=2224;y++)U[y]=1;for(y=2225;y<=2250;y++)U[y]=2;for(y=2251;y<=2253;y++)U[y]=1;for(y=2257;y<=2264;y++)U[y]=2;for(y=2274;y<=2279;y++)U[y]=2;for(y=2280;y<=2282;y++)U[y]=1;for(y=2283;y<=2289;y++)U[y]=2;for(y=2290;y<=2292;y++)U[y]=0;for(y=2308;y<=2313;y++)U[y]=0;for(y=2315;y<=2491;y++)U[y]=0;for(y=2494;y<=2866;y++)U[y]=0;for(y=2867;y<=2869;y++)U[y]=1;for(y=2870;y<=2888;y++)U[y]=2;for(y=2891;y<=2895;y++)U[y]=2;for(y=2896;y<=2898;y++)U[y]=1;for(y=2902;y<=2908;y++)U[y]=2;for(y=2915;y<=2920;y++)U[y]=2;for(y=2921;y<=2923;y++)U[y]=1;for(y=2924;y<=2930;y++)U[y]=2;for(y=2931;y<=2962;y++)U[y]=0;for(y=2964;y<=2968;y++)U[y]=2;for(y=2969;y<=2973;y++)U[y]=0;for(y=2975;y<=2991;y++)U[y]=0;for(y=2995;y<=3051;y++)U[y]=0;for(y=3054;y<=3079;y++)U[y]=0;for(y=3081;y<=3088;y++)U[y]=0;for(y=3092;y<=3101;y++)U[y]=0;for(y=3106;y<=3138;y++)U[y]=0;for(y=3146;y<=3151;y++)U[y]=0;for(y=3153;y<=3166;y++)U[y]=0;for(y=3168;y<=3172;y++)U[y]=0;for(y=3174;y<=3203;y++)U[y]=0;for(y=3294;y<=3358;y++)U[y]=0;for(y=3367;y<=3403;y++)U[y]=0;for(y=3408;y<=3416;y++)U[y]=0;for(y=3417;y<=3438;y++)U[y]=2;for(y=3441;y<=3446;y++)U[y]=2;for(y=3447;y<=3450;y++)U[y]=0;for(y=3451;y<=3459;y++)U[y]=2;for(y=3460;y<=3478;y++)U[y]=0;for(y=3554;y<=3559;y++)U[y]=0;for(y=3560;y<=3570;y++)U[y]=2;for(y=3571;y<=3581;y++)U[y]=0;for(y=3594;y<=3597;y++)U[y]=0;for(y=3601;y<=3604;y++)U[y]=0;for(y=3637;y<=3639;y++)U[y]=0;for(y=3665;y<=3667;y++)U[y]=0;for(y=3693;y<=3695;y++)U[y]=0;for(y=3701;y<=3727;y++)U[y]=0;for(y=3728;y<=3739;y++)U[y]=2;for(y=3740;y<=3751;y++)U[y]=0;for(y=3753;y<=3760;y++)U[y]=2;for(y=3761;y<=3773;y++)U[y]=0;for(y=3775;y<=3777;y++)U[y]=0;for(y=3779;y<=3781;y++)U[y]=0;for(y=3783;y<=3785;y++)U[y]=0;for(y=3788;y<=3791;y++)U[y]=0;for(y=3797;y<=3802;y++)U[y]=0;for(y=3814;y<=3816;y++)U[y]=0;for(y=3825;y<=3829;y++)U[y]=0;for(y=3832;y<=3841;y++)U[y]=0;for(y=3844;y<=3852;y++)U[y]=0;for(y=3873;y<=3885;y++)U[y]=0;for(y=3890;y<=3893;y++)U[y]=0;for(y=3907;y<=3912;y++)U[y]=0;for(y=3942;y<=3950;y++)U[y]=0;for(y=3968;y<=3970;y++)U[y]=0;for(y=3973;y<=3976;y++)U[y]=0;for(y=3986;y<=3989;y++)U[y]=0;for(y=3994;y<=3997;y++)U[y]=0;for(y=4048;y<=4051;y++)U[y]=0;for(y=4056;y<=4063;y++)U[y]=0;for(y=4093;y<=4096;y++)U[y]=0;for(y=4390;y<=4398;y++)U[y]=0;for(y=4399;y<=4413;y++)U[y]=2;for(y=4418;y<=4433;y++)U[y]=2;for(y=4455;y<=4457;y++)U[y]=2;for(y=4484;y<=4489;y++)U[y]=0;for(y=4491;y<=4554;y++)U[y]=0;for(y=4568;y<=4589;y++)U[y]=0;for(y=4652;y<=4656;y++)U[y]=0;for(y=4766;y<=4800;y++)U[y]=0;for(y=5014;y<=5016;y++)U[y]=0;for(y=5069;y<=5072;y++)U[y]=0;for(y=5105;y<=5130;y++)U[y]=0;for(y=5173;y<=5188;y++)U[y]=0;for(y=5253;y<=5259;y++)U[y]=0;for(y=5269;y<=5275;y++)U[y]=0;for(y=5292;y<=5311;y++)U[y]=0;for(y=5329;y<=5331;y++)U[y]=0;for(y=5343;y<=5349;y++)U[y]=0;for(y=5355;y<=5357;y++)U[y]=0;for(y=5387;y<=5389;y++)U[y]=0;for(y=5459;y<=5463;y++)U[y]=0;for(y=5479;y<=5482;y++)U[y]=0;for(y=5518;y<=5520;y++)U[y]=0;for(y=5530;y<=5539;y++)U[y]=0;for(y=5550;y<=5552;y++)U[y]=0;for(y=5562;y<=5583;y++)U[y]=0;for(y=5623;y<=5625;y++)U[y]=2;for(y=5631;y<=5639;y++)U[y]=0;for(y=5649;y<=5653;y++)U[y]=0;for(y=5663;y<=5680;y++)U[y]=0;for(y=5682;y<=5685;y++)U[y]=0;for(y=5875;y<=5877;y++)U[y]=0;for(y=5896;y<=5899;y++)U[y]=0;for(y=5921;y<=5940;y++)U[y]=0;for(y=6050;y<=6125;y++)U[y]=0;for(y=6244;y<=6275;y++)U[y]=0;for(y=6328;y<=6348;y++)U[y]=0;for(y=6350;y<=6356;y++)U[y]=0;for(y=6366;y<=6372;y++)U[y]=0;for(y=6381;y<=6387;y++)U[y]=0;for(y=6393;y<=6404;y++)U[y]=0;for(y=6480;y<=6483;y++)U[y]=0;for(y=6511;y<=6514;y++)U[y]=0;for(y=6579;y<=6581;y++)U[y]=0;for(y=6619;y<=6624;y++)U[y]=0;for(y=6625;y<=6627;y++)U[y]=2;for(y=6628;y<=6632;y++)U[y]=0;for(y=6634;y<=6637;y++)U[y]=0;for(y=6669;y<=6692;y++)U[y]=0;for(y=6707;y<=6709;y++)U[y]=0;for(y=6720;y<=6723;y++)U[y]=0;for(y=6732;y<=6738;y++)U[y]=0;for(y=6931;y<=6933;y++)U[y]=0;for(y=6956;y<=6959;y++)U[y]=0;for(y=7005;y<=7007;y++)U[y]=0;for(y=7057;y<=7070;y++)U[y]=2;for(y=7074;y<=7082;y++)U[y]=0;for(y=7109;y<=7118;y++)U[y]=0;for(y=7119;y<=7127;y++)U[y]=1;for(y=7374;y<=7376;y++)U[y]=0;for(y=7528;y<=7586;y++)U[y]=0;for(y=7587;y<=7645;y++)U[y]=2;for(y=7692;y<=7696;y++)U[y]=0;for(y=7755;y<=7787;y++)U[y]=0;for(y=7791;y<=7795;y++)U[y]=0;for(y=7799;y<=7801;y++)U[y]=0;for(y=7803;y<=7805;y++)U[y]=0;for(y=7825;y<=7831;y++)U[y]=0;for(y=7845;y<=7859;y++)U[y]=0;for(y=8013;y<=8032;y++)U[y]=0;for(y=8065;y<=8068;y++)U[y]=1;for(y=8518;y<=8529;y++)U[y]=2;for(y=8533;y<=8536;y++)U[y]=2;for(y=8538;y<=8540;y++)U[y]=2;for(y=8677;y<=8679;y++)U[y]=0;for(y=8836;y<=8840;y++)U[y]=0;for(y=8857;y<=8859;y++)U[y]=0;for(y=8908;y<=8910;y++)U[y]=0;for(y=9154;y<=9159;y++)U[y]=0;for(y=9205;y<=9218;y++)U[y]=0;for(y=9271;y<=9273;y++)U[y]=0;for(y=9295;y<=9297;y++)U[y]=0;for(y=9356;y<=9360;y++)U[y]=0;for(y=9404;y<=9407;y++)U[y]=0;for(y=9476;y<=9482;y++)U[y]=0;for(y=9487;y<=9494;y++)U[y]=0;for(y=9697;y<=9699;y++)U[y]=0;for(y=20002;y<=20032;y++)U[y]=0;for(y=20062;y<=20092;y++)U[y]=0;for(y=20135;y<=20138;y++)U[y]=0;for(y=20248;y<=20258;y++)U[y]=0;for(y=20348;y<=20358;y++)U[y]=0;for(y=20436;y<=20440;y++)U[y]=0;for(y=20822;y<=20824;y++)U[y]=0;for(y=20904;y<=20932;y++)U[y]=0;for(y=20934;y<=20936;y++)U[y]=0;for(y=21004;y<=21032;y++)U[y]=0;for(y=21035;y<=21037;y++)U[y]=0;for(y=21095;y<=21097;y++)U[y]=0;for(y=21148;y<=21150;y++)U[y]=0;for(y=21207;y<=21264;y++)U[y]=0;for(y=21307;y<=21364;y++)U[y]=0;for(y=21413;y<=21423;y++)U[y]=0;for(y=21453;y<=21463;y++)U[y]=0;for(y=21473;y<=21483;y++)U[y]=0;for(y=21780;y<=21782;y++)U[y]=0;for(y=21891;y<=21894;y++)U[y]=0;for(y=21896;y<=21899;y++)U[y]=0;for(y=22171;y<=22177;y++)U[y]=0;for(y=22181;y<=22187;y++)U[y]=0;for(y=22191;y<=22197;y++)U[y]=0;for(y=22234;y<=22236;y++)U[y]=0;for(y=22521;y<=22525;y++)U[y]=0;for(y=22991;y<=22994;y++)U[y]=0;for(y=23028;y<=23038;y++)U[y]=0;for(y=23830;y<=23853;y++)U[y]=0;for(y=23866;y<=23872;y++)U[y]=0;for(y=23877;y<=23884;y++)U[y]=0;for(y=23886;y<=23894;y++)U[y]=0;for(y=23946;y<=23948;y++)U[y]=0;for(y=24311;y<=24313;y++)U[y]=0;for(y=24342;y<=24347;y++)U[y]=0;for(y=24370;y<=24374;y++)U[y]=10;for(y=24375;y<=24381;y++)U[y]=0;for(y=24718;y<=24721;y++)U[y]=0;for(y=24817;y<=24821;y++)U[y]=0;for(y=24877;y<=24882;y++)U[y]=0;for(y=24891;y<=24893;y++)U[y]=0;for(y=25391;y<=25395;y++)U[y]=0;for(y=25828;y<=25838;y++)U[y]=0;for(y=26191;y<=26195;y++)U[y]=0;for(y=26391;y<=26393;y++)U[y]=0;for(y=26701;y<=26722;y++)U[y]=0;for(y=26729;y<=26799;y++)U[y]=2;for(y=26801;y<=26803;y++)U[y]=2;for(y=26811;y<=26813;y++)U[y]=2;for(y=26847;y<=26870;y++)U[y]=2;for(y=26891;y<=26899;y++)U[y]=0;for(y=26901;y<=26923;y++)U[y]=0;for(y=26929;y<=26946;y++)U[y]=0;for(y=26948;y<=26998;y++)U[y]=0;for(y=27037;y<=27040;y++)U[y]=0;for(y=27205;y<=27232;y++)U[y]=0;for(y=27258;y<=27260;y++)U[y]=0;for(y=27391;y<=27398;y++)U[y]=0;for(y=27561;y<=27564;y++)U[y]=0;for(y=27571;y<=27574;y++)U[y]=0;for(y=27581;y<=27584;y++)U[y]=0;for(y=27591;y<=27594;y++)U[y]=0;for(y=28191;y<=28193;y++)U[y]=0;for(y=28348;y<=28358;y++)U[y]=0;for(y=28402;y<=28432;y++)U[y]=0;for(y=28462;y<=28492;y++)U[y]=0;for(y=29118;y<=29122;y++)U[y]=0;for(y=29168;y<=29172;y++)U[y]=0;for(y=29177;y<=29185;y++)U[y]=0;for(y=29187;y<=29195;y++)U[y]=0;for(y=29900;y<=29903;y++)U[y]=0;for(y=30161;y<=30179;y++)U[y]=0;for(y=30491;y<=30494;y++)U[y]=0;for(y=30729;y<=30732;y++)U[y]=0;for(y=31251;y<=31259;y++)U[y]=0;for(y=31265;y<=31268;y++)U[y]=0;for(y=31275;y<=31279;y++)U[y]=0;for(y=31281;y<=31297;y++)U[y]=0;for(y=31461;y<=31469;y++)U[y]=0;for(y=31491;y<=31495;y++)U[y]=0;for(y=31917;y<=31922;y++)U[y]=0;for(y=31965;y<=32e3;y++)U[y]=0;for(y=32001;y<=32003;y++)U[y]=2;for(y=32005;y<=32031;y++)U[y]=2;for(y=32033;y<=32060;y++)U[y]=2;for(y=32064;y<=32067;y++)U[y]=2;for(y=32074;y<=32077;y++)U[y]=2;for(y=32081;y<=32086;y++)U[y]=0;for(y=32107;y<=32130;y++)U[y]=0;for(y=32133;y<=32158;y++)U[y]=0;for(y=32164;y<=32167;y++)U[y]=2;for(y=32180;y<=32199;y++)U[y]=0;for(y=32201;y<=32260;y++)U[y]=0;for(y=32301;y<=32360;y++)U[y]=0;for(y=32601;y<=32662;y++)U[y]=0;for(y=32664;y<=32667;y++)U[y]=2;for(y=32701;y<=32761;y++)U[y]=0;for(y=53001;y<=53004;y++)U[y]=0;for(y=53008;y<=53019;y++)U[y]=0;for(y=53021;y<=53032;y++)U[y]=0;for(y=53034;y<=53037;y++)U[y]=0;for(y=53042;y<=53046;y++)U[y]=0;for(y=53074;y<=53080;y++)U[y]=0;for(y=54001;y<=54004;y++)U[y]=0;for(y=54008;y<=54019;y++)U[y]=0;for(y=54021;y<=54032;y++)U[y]=0;for(y=54034;y<=54037;y++)U[y]=0;for(y=54042;y<=54046;y++)U[y]=0;for(y=54048;y<=54053;y++)U[y]=0;for(y=54074;y<=54080;y++)U[y]=0;for(y=54098;y<=54101;y++)U[y]=0;for(y=102001;y<=102040;y++)U[y]=0;for(y=102042;y<=102063;y++)U[y]=0;for(y=102065;y<=102067;y++)U[y]=0;for(y=102070;y<=102117;y++)U[y]=0;for(y=102122;y<=102216;y++)U[y]=0;for(y=102221;y<=102377;y++)U[y]=0;for(y=102382;y<=102388;y++)U[y]=0;for(y=102389;y<=102398;y++)U[y]=2;for(y=102399;y<=102444;y++)U[y]=0;for(y=102445;y<=102447;y++)U[y]=2;for(y=102448;y<=102458;y++)U[y]=0;for(y=102459;y<=102468;y++)U[y]=2;for(y=102469;y<=102499;y++)U[y]=0;for(y=102500;y<=102519;y++)U[y]=1;for(y=102520;y<=102524;y++)U[y]=0;for(y=102525;y<=102529;y++)U[y]=2;for(y=102530;y<=102588;y++)U[y]=0;for(y=102590;y<=102598;y++)U[y]=0;for(y=102601;y<=102603;y++)U[y]=0;for(y=102605;y<=102628;y++)U[y]=0;for(y=102629;y<=102646;y++)U[y]=2;for(y=102648;y<=102700;y++)U[y]=2;for(y=102701;y<=102703;y++)U[y]=0;for(y=102707;y<=102730;y++)U[y]=2;for(y=102733;y<=102758;y++)U[y]=2;for(y=102767;y<=102900;y++)U[y]=0;for(y=102901;y<=102933;y++)U[y]=2;for(y=102934;y<=102950;y++)U[y]=13;for(y=102951;y<=102955;y++)U[y]=0;for(y=102961;y<=102963;y++)U[y]=0;for(y=102965;y<=102969;y++)U[y]=0;for(y=102971;y<=102973;y++)U[y]=0;for(y=102975;y<=102989;y++)U[y]=0;for(y=102990;y<=102992;y++)U[y]=1;for(y=102997;y<=103002;y++)U[y]=0;for(y=103003;y<=103008;y++)U[y]=2;for(y=103009;y<=103011;y++)U[y]=0;for(y=103012;y<=103014;y++)U[y]=2;for(y=103019;y<=103021;y++)U[y]=0;for(y=103022;y<=103024;y++)U[y]=2;for(y=103029;y<=103031;y++)U[y]=0;for(y=103032;y<=103034;y++)U[y]=2;for(y=103065;y<=103068;y++)U[y]=0;for(y=103074;y<=103076;y++)U[y]=0;for(y=103077;y<=103079;y++)U[y]=1;for(y=103080;y<=103082;y++)U[y]=0;for(y=103083;y<=103085;y++)U[y]=2;for(y=103090;y<=103093;y++)U[y]=0;for(y=103097;y<=103099;y++)U[y]=0;for(y=103100;y<=103102;y++)U[y]=2;for(y=103107;y<=103109;y++)U[y]=0;for(y=103110;y<=103112;y++)U[y]=2;for(y=103113;y<=103116;y++)U[y]=0;for(y=103117;y<=103120;y++)U[y]=2;for(y=103153;y<=103157;y++)U[y]=0;for(y=103158;y<=103162;y++)U[y]=2;for(y=103163;y<=103165;y++)U[y]=0;for(y=103166;y<=103168;y++)U[y]=1;for(y=103169;y<=103171;y++)U[y]=2;for(y=103186;y<=103188;y++)U[y]=0;for(y=103189;y<=103191;y++)U[y]=2;for(y=103192;y<=103195;y++)U[y]=0;for(y=103196;y<=103199;y++)U[y]=2;for(y=103200;y<=103224;y++)U[y]=0;for(y=103225;y<=103227;y++)U[y]=1;for(y=103232;y<=103237;y++)U[y]=0;for(y=103238;y<=103243;y++)U[y]=2;for(y=103244;y<=103246;y++)U[y]=0;for(y=103247;y<=103249;y++)U[y]=2;for(y=103254;y<=103256;y++)U[y]=0;for(y=103257;y<=103259;y++)U[y]=2;for(y=103264;y<=103266;y++)U[y]=0;for(y=103267;y<=103269;y++)U[y]=2;for(y=103300;y<=103375;y++)U[y]=0;for(y=103381;y<=103383;y++)U[y]=0;for(y=103384;y<=103386;y++)U[y]=1;for(y=103387;y<=103389;y++)U[y]=0;for(y=103390;y<=103392;y++)U[y]=2;for(y=103397;y<=103399;y++)U[y]=0;for(y=103400;y<=103471;y++)U[y]=2;for(y=103476;y<=103478;y++)U[y]=0;for(y=103479;y<=103481;y++)U[y]=2;for(y=103486;y<=103488;y++)U[y]=0;for(y=103489;y<=103491;y++)U[y]=2;for(y=103492;y<=103495;y++)U[y]=0;for(y=103496;y<=103499;y++)U[y]=2;for(y=103528;y<=103543;y++)U[y]=0;for(y=103544;y<=103548;y++)U[y]=2;for(y=103549;y<=103551;y++)U[y]=0;for(y=103552;y<=103554;y++)U[y]=1;for(y=103555;y<=103557;y++)U[y]=2;for(y=103558;y<=103560;y++)U[y]=0;for(y=103571;y<=103573;y++)U[y]=0;for(y=103574;y<=103576;y++)U[y]=2;for(y=103577;y<=103580;y++)U[y]=0;for(y=103581;y<=103583;y++)U[y]=2;for(y=103595;y<=103694;y++)U[y]=0;for(y=103696;y<=103699;y++)U[y]=0;for(y=103700;y<=103793;y++)U[y]=2;for(y=103794;y<=103887;y++)U[y]=0;for(y=103900;y<=103971;y++)U[y]=2;const OHe={102113:!0,102100:!0,3857:!0,3785:!0},MHe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},npe='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',u5=[-20037508342788905e-9,20037508342788905e-9],d5=[-20037508342787e-6,20037508342787e-6],NCe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:u5,origin:d5,dx:1e-5},102100:{wkTemplate:npe,valid:u5,origin:d5,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:u5,origin:d5,dx:1e-5},3857:{wkTemplate:npe,valid:u5,origin:d5,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function ml(e,t){return e===t||!C(e)&&!C(t)&&(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||oE(e)&&oE(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase())}function sx(e){return Ll(e)&&e.wkid&&NCe[e.wkid]||null}function FCe(e){return!!Ll(e)&&(e.wkid?U[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function eN(e){return!(I0(e)||P0(e))}function tN(e){return Ll(e)&&e.wkid===4326}function kCe(e){return Ll(e)&&e.wkid===tf.CGCS2000}function oE(e){return Ll(e)&&e.wkid!=null&&OHe[e.wkid]===!0}function rN(e){return Ll(e)&&e.wkid===32662}function Pne(e){return e===tf.GCSMARS2000||e===tf.GCSMARS2000_SPHERE}function I0(e){return Ll(e)&&e.wkid!=null&&Pne(e.wkid)}function $ne(e){return e===tf.GCSMOON2000}function P0(e){return Ll(e)&&e.wkid!=null&&$ne(e.wkid)}function RHe(e){return Ll(e)&&e.wkid!=null&&MHe[e.wkid]===!0}function Ll(e){return v(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const IJ={wkid:4326,wkt:g0(NCe[4326].wkTemplate,{Central_Meridian:"0.0"})},IHe={wkid:102100,latestWkid:3857},PHe={wkid:32662};var Kg;let gs=Kg=class extends fe{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return Kg.WebMercator;if(e.wkid===4326)return Kg.WGS84}const t=new Kg;return t.read(e),t}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return tN(this)}get isWebMercator(){return oE(this)}get isGeographic(){return FCe(this)}get isWrappable(){return RHe(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===Kg.WGS84)return Kg.WGS84;if(this===Kg.WebMercator)return Kg.WebMercator;const e=new Kg;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=ne(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:r}=e.imageCoordinateSystem,{geodataXform:i}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||i?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):r?s.id===t&&s.referenceServiceName===r:s.id===t}return ml(this,e)}toJSON(e){return this.write(void 0,e)}};gs.GCS_NAD_1927=null,gs.WGS84=null,gs.WebMercator=null,gs.PlateCarree=null,u([h({readOnly:!0})],gs.prototype,"isWGS84",null),u([h({readOnly:!0})],gs.prototype,"isWebMercator",null),u([h({readOnly:!0})],gs.prototype,"isGeographic",null),u([h({readOnly:!0})],gs.prototype,"isWrappable",null),u([h({type:bs,json:{write:!0}})],gs.prototype,"latestWkid",void 0),u([h({type:bs,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],gs.prototype,"wkid",void 0),u([h({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],gs.prototype,"wkt",void 0),u([Le("wkt"),Le("web-scene","wkt")],gs.prototype,"writeWkt",null),u([h({type:bs,json:{write:!0}})],gs.prototype,"vcsWkid",void 0),u([h({type:bs,json:{write:!0}})],gs.prototype,"latestVcsWkid",void 0),u([h()],gs.prototype,"imageCoordinateSystem",void 0),gs=Kg=u([I("esri.geometry.SpatialReference")],gs),gs.prototype.toJSON.isDefaultToJSON=!0,gs.GCS_NAD_1927=new gs({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),gs.WGS84=new gs(IJ),gs.WebMercator=new gs(IHe),gs.PlateCarree=new gs(PHe),Object.freeze&&(Object.freeze(gs.GCS_NAD_1927),Object.freeze(gs.WGS84),Object.freeze(gs.WebMercator));const Ve=gs;let Qg=class extends fe{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ve.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof Ve)return e;if(e!=null){const r=new Ve;return r.read(e,t),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};u([h()],Qg.prototype,"type",void 0),u([h({readOnly:!0})],Qg.prototype,"cache",null),u([h({readOnly:!0})],Qg.prototype,"extent",null),u([h({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Qg.prototype,"hasM",void 0),u([h({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Qg.prototype,"hasZ",void 0),u([h({type:Ve,json:{write:!0}})],Qg.prototype,"spatialReference",void 0),u([me("spatialReference")],Qg.prototype,"readSpatialReference",null),Qg=u([I("esri.geometry.Geometry")],Qg);const Xx=Qg;function $He(e,t){const r=e.x-t.x,i=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(r*r+i*i+s*s)}class Dne{constructor(t,r,i,s){this.semiMajorAxis=t,this.flattening=r,this.outerAtmosphereRimWidth=i;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const Pr=new Dne(6378137,1/298.257223563,3e5,.006694379990137799),n0=new Dne(3396190,1/169.8944472236118,23e4),Vv=new Dne(1737400,0,0),DHe=57.29577951308232,LHe=.017453292519943;function ope(e){return e*DHe}function ape(e){return e*LHe}function lpe(e){return e/Pr.radius}function vz(e){return Math.PI/2-2*Math.atan(Math.exp(-e/Pr.radius))}function PJ(e){return e.wkid!=null||e.wkt!=null}const BH=[0,0];function bz(e,t,r,i,s){const n=e,o=s;if(o.spatialReference=r,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,BH,i);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,BH,i),[o.xmax,o.ymax]=t(n.xmax,n.ymax,BH,i);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let d=0;d<a.length;d++){const p=a[d];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(t(p[f][0],p[f][1],[0,0],i)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function nx(e,t){const r=e&&(PJ(e)?e:e.spatialReference),i=t&&(PJ(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!r||!i)&&(!!ml(i,r)||oE(i)&&tN(r)||oE(r)&&tN(i))}function QE(e,t){if(C(e))return null;const r=e.spatialReference,i=t&&(PJ(t)?t:t.spatialReference);return nx(r,i)?ml(r,i)?ne(e):oE(i)?bz(e,VO,Ve.WebMercator,!1,ne(e)):tN(i)?bz(e,xD,Ve.WGS84,!1,ne(e)):null:null}function VO(e,t,r=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const i=ape(t);return r[0]=ape(e)*Pr.radius,r[1]=Pr.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function xD(e,t,r=[0,0],i=!1){const s=ope(e/Pr.radius);return r[0]=i?s:s-360*Math.floor((s+180)/360),r[1]=ope(Math.PI/2-2*Math.atan(Math.exp(-t/Pr.radius))),r}function o0(e,t=!1,r=ne(e)){return bz(e,VO,Ve.WebMercator,t,r)}function jO(e,t=!1,r=ne(e)){return bz(e,xD,Ve.WGS84,t,r)}var T6;const pP=[0,0];function cpe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let Jc=T6=class extends Xx{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const r=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(r)?r:r.clone())}normalizeCtorArgs(e,t,r,i,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],r=n[2],i=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,r=n.z,i=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ve(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)te.getLogger(this.declaredClass).warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)te.getLogger(this.declaredClass).warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=VO(n.longitude,n.latitude,pP);e=a[0],t=a[1]}}}else cpe(r)?(s=r,r=null):cpe(i)&&(s=i,i=null);const o={x:e,y:t};return o.x==null&&o.y!=null?te.getLogger(this.declaredClass).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&te.getLogger(this.declaredClass).warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:r}=this;if(e){if(e.isWebMercator)return xD(t,r,pP)[1];if(e.isGeographic)return r}return null}set latitude(e){const{spatialReference:t,x:r}=this;e!=null&&t&&(t.isWebMercator?this._set("y",VO(r,e,pP)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:r}=this;if(r){if(r.isWebMercator)return xD(e,t,pP)[0];if(r.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:r}=this;e!=null&&r&&(r.isWebMercator?this._set("x",VO(e,t,pP)[0]):r.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,r){t[r]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new T6;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return T6.copy(e,this),this}equals(e){if(C(e))return!1;const{x:t,y:r,z:i,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:d}=e;if(!n.equals(d))if(n.isWebMercator&&d.isWGS84)[l,c]=VO(l,c),d=n;else{if(!n.isWGS84||!d.isWebMercator)return!1;[l,c]=xD(l,c),d=n}return t===l&&r===c&&i===o&&s===a&&n.wkid===d.wkid}offset(e,t,r){var i;return this.x+=e,this.y+=t,r!=null&&(this.z=((i=this.z)!=null?i:0)+r),this}normalize(){if(!this.spatialReference)return this;const e=sx(this.spatialReference);if(!e)return this;let t=this.x;const[r,i]=e.valid,s=2*i;let n;return t>i?(n=Math.ceil(Math.abs(t-i)/s),t-=n*s):t<r&&(n=Math.ceil(Math.abs(t-r)/s),t+=n*s),this._set("x",t),this}distance(e){return $He(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};u([h({readOnly:!0})],Jc.prototype,"cache",null),u([h({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Jc.prototype,"hasM",null),u([h({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Jc.prototype,"hasZ",null),u([h({type:Number})],Jc.prototype,"latitude",null),u([h({type:Number})],Jc.prototype,"longitude",null),u([h({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Gt(e=>isNaN(e)?e:Xp(e))],Jc.prototype,"x",void 0),u([Le("x")],Jc.prototype,"writeX",null),u([me("x")],Jc.prototype,"readX",null),u([h({type:Number,json:{write:!0}})],Jc.prototype,"y",void 0),u([h({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Jc.prototype,"z",void 0),u([h({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Jc.prototype,"m",void 0),Jc=T6=u([I("esri.geometry.Point")],Jc),Jc.prototype.toJSON.isDefaultToJSON=!0;const lt=Jc;let g_=class extends ki(fe){constructor(...e){super(...e),this.position=new lt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,r,i){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),r!=null&&(s.tilt=r),i!=null&&(s.fov=i),s}return e}writePosition(e,t,r,i){const s=e.clone();s.x=Xp(e.x||0),s.y=Xp(e.y||0),s.z=e.hasZ?Xp(e.z||0):e.z,t[r]=s.write({},i)}readPosition(e,t){const r=new lt;return r.read(e,t),r.x=Xp(r.x||0),r.y=Xp(r.y||0),r.z=r.hasZ?Xp(r.z||0):r.z,r}equals(e){return!C(e)&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([h({type:lt,json:{write:{isRequired:!0}}})],g_.prototype,"position",void 0),u([Le("position")],g_.prototype,"writePosition",null),u([me("position")],g_.prototype,"readPosition",null),u([h({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Gt(e=>Ine.normalize(Xp(e)))],g_.prototype,"heading",void 0),u([h({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Gt(e=>_e(Xp(e),-180,180))],g_.prototype,"tilt",void 0),u([h({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],g_.prototype,"fov",void 0),g_=u([I("esri.Camera")],g_);const Zh=g_,zH=[0,0];function Lne(e,t){return!!v(t)&&Cc(e,t.x,t.y,t.z)}function SUt(e,t){if(!t.points||t.points.length)return!1;for(const r of t.points)if(!pR(e,r))return!1;return!0}function NHe(e,t){const{xmin:r,ymin:i,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?Cc(e,r,i,s)&&Cc(e,r,o,s)&&Cc(e,n,o,s)&&Cc(e,n,i,s)&&Cc(e,r,i,a)&&Cc(e,r,o,a)&&Cc(e,n,o,a)&&Cc(e,n,i,a):Cc(e,r,i)&&Cc(e,r,o)&&Cc(e,n,o)&&Cc(e,n,i)}function pR(e,t){return Cc(e,t[0],t[1])}function FHe(e,t){return Cc(e,t[0],t[1],t[2])}function Cc(e,t,r,i){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax&&(i==null||!e.hasZ||i>=e.zmin&&i<=e.zmax)}function kHe(e,t){return zH[1]=t.y,zH[0]=t.x,UHe(e,zH)}function UHe(e,t){return UCe(e.rings,t)}function UCe(e,t){if(!e)return!1;if(BHe(e))return upe(!1,e,t);let r=!1;for(let i=0,s=e.length;i<s;i++)r=upe(r,e[i],t);return r}function BHe(e){return!Array.isArray(e[0][0])}function upe(e,t,r){const[i,s]=r;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,d]=t[a],[p,f]=t[o];(d<s&&f>=s||f<s&&d>=s)&&c+(s-d)/(f-d)*(p-c)<i&&(n=!n)}return n}function zHe(e,t){return Lne(e,t)}function VHe(e,t){const r=e.hasZ&&t.hasZ;let i,s,n;if(e.xmin<=t.xmin){if(i=t.xmin,e.xmax<i)return!1}else if(i=e.xmin,t.xmax<i)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(r&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function jHe(e,t){const{points:r,hasZ:i}=t,s=i?FHe:pR;for(const n of r)if(s(e,n))return!0;return!1}const aE=[0,0],lE=[0,0],cE=[0,0],uE=[0,0],GHe=[aE,lE,cE,uE],BCe=[[cE,aE],[aE,lE],[lE,uE],[uE,cE]];function HHe(e,t){return qHe(e,t.rings)}function qHe(e,t){aE[0]=e.xmin,aE[1]=e.ymax,lE[0]=e.xmax,lE[1]=e.ymax,cE[0]=e.xmin,cE[1]=e.ymin,uE[0]=e.xmax,uE[1]=e.ymin;for(const r of GHe)if(UCe(t,r))return!0;for(const r of t){if(!r.length)continue;let i=r[0];if(pR(e,i))return!0;for(let s=1;s<r.length;s++){const n=r[s];if(pR(e,n)||zCe(i,n,BCe))return!0;i=n}}return!1}function WHe(e,t){aE[0]=e.xmin,aE[1]=e.ymax,lE[0]=e.xmax,lE[1]=e.ymax,cE[0]=e.xmin,cE[1]=e.ymin,uE[0]=e.xmax,uE[1]=e.ymin;const r=t.paths;for(const i of r){if(!r.length)continue;let s=i[0];if(pR(e,s))return!0;for(let n=1;n<i.length;n++){const o=i[n];if(pR(e,o)||zCe(s,o,BCe))return!0;s=o}}return!1}const Za=[0,0];function XHe(e){for(let t=0;t<e.length;t++){const r=e[t];for(let s=0;s<r.length-1;s++){const n=r[s],o=r[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],d=e[a][l+1];if($J(n,o,c,d,Za)&&!(Za[0]===n[0]&&Za[1]===n[1]||Za[0]===c[0]&&Za[1]===c[1]||Za[0]===o[0]&&Za[1]===o[1]||Za[0]===d[0]&&Za[1]===d[1]))return!0}}const i=r.length;if(!(i<=4))for(let s=0;s<i-3;s++){let n=i-1;s===0&&(n=i-2);const o=r[s],a=r[s+1];for(let l=s+2;l<n;l++){const c=r[l],d=r[l+1];if($J(o,a,c,d,Za)&&!(Za[0]===o[0]&&Za[1]===o[1]||Za[0]===c[0]&&Za[1]===c[1]||Za[0]===a[0]&&Za[1]===a[1]||Za[0]===d[0]&&Za[1]===d[1]))return!0}}}return!1}function zCe(e,t,r){for(let i=0;i<r.length;i++)if($J(e,t,r[i][0],r[i][1]))return!0;return!1}function $J(e,t,r,i,s){const[n,o]=e,[a,l]=t,[c,d]=r,[p,f]=i,m=p-c,g=n-c,_=a-n,x=f-d,b=o-d,w=l-o,T=x*_-m*w;if(T===0)return!1;const E=(m*b-x*g)/T,O=(_*b-w*g)/T;return E>=0&&E<=1&&O>=0&&O<=1&&(s&&(s[0]=n+E*(a-n),s[1]=o+E*(l-o)),!0)}function YHe(e){switch(e){case"esriGeometryEnvelope":case"extent":return VHe;case"esriGeometryMultipoint":case"multipoint":return jHe;case"esriGeometryPoint":case"point":return zHe;case"esriGeometryPolygon":case"polygon":return HHe;case"esriGeometryPolyline":case"polyline":return WHe}}var xp;function ZHe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function O1(e,t,r){return t==null?r:r==null?t:e(t,r)}let ba=xp=class extends Xx{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,r,i,s){return ZHe(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?Ve.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:r,ymax:i,spatialReference:s!=null?s:Ve.WGS84}}static fromBounds(e,t){return new xp({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new xp({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new lt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new xp;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&nx(t,r)&&(e=t.isWebMercator?o0(e):jO(e,!0)),e.type==="point"?Lne(this,e):e.type==="extent"&&NHe(this,e)}equals(e){if(this===e)return!0;if(C(e))return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&nx(t,r)&&(e=t.isWebMercator?o0(e):jO(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),r=this.width*t,i=this.height*t;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(C(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,r=e.spatialReference;return t&&r&&!ml(t,r)&&nx(t,r)&&(e=t.isWebMercator?o0(e):jO(e,!0)),YHe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,r){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=O1(Math.min,this.zmin,e.zmin),this.zmax=O1(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=O1(Math.min,this.mmin,e.mmin),this.mmax=O1(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:C(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=O1(Math.max,this.zmin,e.zmin),this.zmax=O1(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=O1(Math.max,this.mmin,e.mmin),this.mmax=O1(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=sx(this.spatialReference)){var i;if(!e||!this.spatialReference)return this;const t=this.spatialReference,r=this._getCM(e);if(r){const s=t.isWebMercator?jO(r):r;this.xmin-=r.x,this.xmax-=r.x,t.isWebMercator||(s.x=this._normalizeX(s.x,e).x),this.spatialReference=new Ve(g0((i=t.isWGS84?e.altTemplate:null)!=null?i:e.wkTemplate,{Central_Meridian:s.x}))}return this}_getCM(e){let t=null;const[r,i]=e.valid,s=this.xmin,n=this.xmax;return s>=r&&s<=i&&n>=r&&n<=i||(t=this.center),t}_normalize(e,t,r){const i=this.spatialReference;if(!i)return this;const s=r!=null?r:sx(i);if(s==null)return this;const n=this._getParts(s).map(l=>l.extent);if(n.length<2)return n[0]||this;if(n.length>2)return e?this._shiftCM(s):this.set({xmin:s.valid[0],xmax:s.valid[1]});if(e)return this._shiftCM(s);if(t)return n;let o=!0,a=!0;return n.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:n.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const d=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(d)}if(a){const d=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(d)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let d;e=e||sx(o);const[p,f]=e.valid;d=this._normalizeX(this.xmin,e);const m=d.x,g=d.frameId;d=this._normalizeX(this.xmax,e);const _=d.x,x=d.frameId,b=m===_&&a>0;if(a>2*f){const w=new xp(l<c?m:_,s,f,n,o),T=new xp(p,s,l<c?_:m,n,o),E=new xp(0,s,f,n,o),O=new xp(p,s,0,n,o),A=[],R=[];w.contains(E)&&A.push(g),w.contains(O)&&R.push(g),T.contains(E)&&A.push(x),T.contains(O)&&R.push(x);for(let D=g+1;D<x;D++)A.push(D),R.push(D);t.push({extent:w,frameIds:[g]},{extent:T,frameIds:[x]},{extent:E,frameIds:A},{extent:O,frameIds:R})}else m>_||b?t.push({extent:new xp(m,s,f,n,o),frameIds:[g]},{extent:new xp(p,s,_,n,o),frameIds:[x]}):t.push({extent:new xp(m,s,_,n,o),frameIds:[g]});this.cache._parts=t}const r=this.hasZ,i=this.hasM;if(r||i){const s={};r&&(s.zmin=this.zmin,s.zmax=this.zmax),i&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[r,i]=t.valid,s=2*i;let n,o=0;return e>i?(n=Math.ceil(Math.abs(e-i)/s),e-=n*s,o=n):e<r&&(n=Math.ceil(Math.abs(e-r)/s),e+=n*s,o=-n),{x:e,frameId:o}}};u([h({readOnly:!0})],ba.prototype,"cache",null),u([h({readOnly:!0})],ba.prototype,"center",null),u([h({readOnly:!0})],ba.prototype,"extent",null),u([h({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],ba.prototype,"hasM",null),u([h({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],ba.prototype,"hasZ",null),u([h({readOnly:!0})],ba.prototype,"height",null),u([h({readOnly:!0})],ba.prototype,"width",null),u([h({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],ba.prototype,"xmin",void 0),u([h({type:Number,json:{write:!0}})],ba.prototype,"ymin",void 0),u([h({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],ba.prototype,"mmin",void 0),u([h({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],ba.prototype,"zmin",void 0),u([h({type:Number,json:{write:!0}})],ba.prototype,"xmax",void 0),u([h({type:Number,json:{write:!0}})],ba.prototype,"ymax",void 0),u([h({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],ba.prototype,"mmax",void 0),u([h({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],ba.prototype,"zmax",void 0),ba=xp=u([I("esri.geometry.Extent")],ba),ba.prototype.toJSON.isDefaultToJSON=!0;const Sr=ba;function fR(e,t,r=!1){let{hasM:i,hasZ:s}=e;Array.isArray(t)?t.length!==4||i||s?t.length===3&&r&&!i?(s=!0,i=!1):t.length===3&&i&&s&&(i=!1,s=!1):(i=!0,s=!0):(s=!s&&t.hasZ&&(!i||t.hasM),i=!i&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=i}var DJ;function dpe(e){return(t,r)=>t==null?r:r==null?t:e(t,r)}function JHe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let fb=DJ=class extends Xx{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return{};const r={};Array.isArray(e)?(r.points=e,r.spatialReference=t):JHe(e)?r.spatialReference=e:(e.points&&(r.points=e.points),e.spatialReference&&(r.spatialReference=e.spatialReference),e.hasZ&&(r.hasZ=e.hasZ),e.hasM&&(r.hasM=e.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new Sr,r=this.hasZ,i=this.hasM,s=r?3:2,n=e[0],o=dpe(Math.min),a=dpe(Math.max);let l,c,d,p,[f,m]=n,[g,_]=n;for(let x=0,b=e.length;x<b;x++){const w=e[x],[T,E]=w;if(f=o(f,T),m=o(m,E),g=a(g,T),_=a(_,E),r&&w.length>2){const O=w[2];l=o(l,O),d=a(d,O)}if(i&&w.length>s){const O=w[s];c=o(c,O),p=a(p,O)}}return t.xmin=f,t.ymin=m,t.xmax=g,t.ymax=_,t.spatialReference=this.spatialReference,r?(t.zmin=l,t.zmax=d):(t.zmin=void 0,t.zmax=void 0),i?(t.mmin=c,t.mmax=p):(t.mmin=void 0,t.mmax=void 0),t}writePoints(e,t){t.points=ne(this.points)}addPoint(e){return fR(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:ne(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new DJ(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],r={x:t[0],y:t[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=t[2],i=3),this.hasM&&(r.m=t[i]),new lt(r)}removePoint(e){if(!this._validateInputs(e))return null;const t=new lt(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(fR(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};u([h({readOnly:!0})],fb.prototype,"cache",null),u([h()],fb.prototype,"extent",null),u([h({type:[[Number]],json:{write:{isRequired:!0}}})],fb.prototype,"points",void 0),u([Le("points")],fb.prototype,"writePoints",null),fb=DJ=u([I("esri.geometry.Multipoint")],fb),fb.prototype.toJSON.isDefaultToJSON=!0;const CI=fb;function Nne(e,t){const r=t[0]-e[0],i=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(r*r+i*i+s*s)}return Math.sqrt(r*r+i*i)}function VCe(e,t,r){const i=e[0]+r*(t[0]-e[0]),s=e[1]+r*(t[1]-e[1]);return e.length>2&&t.length>2?[i,s,e[2]+r*(t[2]-e[2])]:[i,s]}function EUt(e,t,r,i){const[s,n]=t,[o,a]=r[i],[l,c]=r[i+1],d=l-o,p=c-a,f=d*d+p*p,m=(s-o)*d+(n-a)*p,g=Math.min(1,Math.max(0,m/f));return e[0]=o+d*g,e[1]=a+p*g,e}function CUt(e,t,r){const i=r.rings;let s,n,o=!1,a=1/0;for(let l=0;l<i.length;l++){const c=i[l];for(let d=0,p=c.length-1;d<c.length;p=d++)s=c[d],n=c[p],s[1]>t!=n[1]>t&&e<(n[0]-s[0])*(t-s[1])/(n[1]-s[1])+s[0]&&(o=!o),a=Math.min(a,KHe(e,t,s,n))}return a===0?0:(o?1:-1)*Math.sqrt(a)}function KHe(e,t,r,i){let s=r[0],n=r[1],o=i[0]-s,a=i[1]-n;if(o!==0||a!==0){const l=((e-s)*o+(t-n)*a)/(o*o+a*a);l>1?(s=i[0],n=i[1]):l>0&&(s+=o*l,n+=a*l)}return o=e-s,a=t-n,o*o+a*a}function QHe(e,t){return VCe(e,t,.5)}function jCe(e){const t=e.length;let r=0;for(let i=0;i<t-1;++i)r+=Nne(e[i],e[i+1]);return r}function GCe(e,t){if(t<=0)return e[0];const r=e.length;let i=0;for(let s=0;s<r-1;++s){const n=Nne(e[s],e[s+1]);if(t-i<n){const o=(t-i)/n;return VCe(e[s],e[s+1],o)}i+=n}return e[r-1]}function HCe(e,t,r){const i=e.length;let s=0,n=0,o=0;for(let a=0;a<i;a++){const l=e[a],c=e[(a+1)%i];let d=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(n+=l[0]*c[2]-c[0]*l[2],d=3),l.length>d&&c.length>d&&t&&(o+=l[0]*c[d]-c[0]*l[d])}return s<=0&&n<=0&&o<=0}function eqe(e){const t=e.length;return t>2&&Bv(e[0],e[t-1])}function AUt(e){if("rings"in e)for(const t of e.rings)eqe(t)||t.push(t[0].slice())}function qCe(e){if(!e||e.length<3)return 0;let t=0;const r=e.length-1;for(let i=0;i<r;i++)t+=(e[i][0]-e[i+1][0])*(e[i][1]+e[i+1][1]);return t+=(e[r][0]-e[0][0])*(e[r][1]+e[0][1]),-.5*t}function OUt(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function tqe(e){var t;return e?Fne(e.rings,(t=e.hasZ)!=null?t:!1):null}function Fne(e,t){if(!e||!e.length)return null;const r=[],i=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=rqe(e[n],t,s);a&&i.push(a)}if(i.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],t&&(r[2]=i[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||t&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){const n=e[0]&&e[0].length?iqe(e[0],t):null;if(!n)return null;r[0]=n[0],r[1]=n[1],t&&n.length>2&&(r[2]=n[2])}return r}function rqe(e,t,r){let i=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,d=e.length&&t?e[0][2]:0;for(let f=0;f<e.length;f++){const m=e[f],g=e[(f+1)%e.length],[_,x,b]=m,w=_-l,T=x-c,[E,O,A]=g,R=E-l,D=O-c,k=w*D-R*T;if(o+=k,i+=(w+R)*k,s+=(T+D)*k,t&&m.length>2&&g.length>2){const L=b-d,q=A-d,G=w*q-R*L;n+=(L+q)*G,a+=G}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),x<r[2]&&(r[2]=x),x>r[3]&&(r[3]=x),t&&(b<r[4]&&(r[4]=b),b>r[5]&&(r[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[i/(6*o)+l,s/(6*o)+c,o];return t&&(r[4]===r[5]||a===0?(p[3]=(r[4]+r[5])/2,p[4]=0):(p[3]=n/(6*a)+d,p[4]=a)),p}function iqe(e,t){const r=t?[0,0,0]:[0,0],i=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const d=e[l],p=e[l+1];if(d&&p){r[0]=d[0],r[1]=d[1],i[0]=p[0],i[1]=p[1],t&&d.length>2&&p.length>2&&(r[2]=d[2],i[2]=p[2]);const f=Nne(r,i);if(f){s+=f;const m=QHe(d,p);n+=f*m[0],o+=f*m[1],t&&m.length>2&&(a+=f*m[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}const sqe=1e-6;function MUt(e){if(!e||!e.rings)return null;const{rings:t}=e;let r=0;for(let n=0;n<t.length;n++)r+=qCe(t[n]);if(r<sqe)return Fne(t,!1);const i=[0,0],s=t[0][0];for(let n=0;n<t.length;n++)oqe(i,s,t[n]);return i[0]*=1/r,i[1]*=1/r,i[0]+=s[0],i[1]+=s[1],i}const nqe=1/3;function oqe(e,t,r){if(!e||!r||r.length<3)return null;const i=r[0],s=[0,0],n=[r[1][0]-i[0],r[1][1]-i[1]];let o;for(let c=2;c<r.length;c++)s[0]=r[c][0]-i[0],s[1]=r[c][1]-i[1],o=.5*nqe*(s[0]*n[1]-s[1]*n[0]),e[0]+=o*(n[0]+s[0]),e[1]+=o*(n[1]+s[1]),n[0]=s[0],n[1]=s[1];const a=qCe(r),l=[i[0],i[1]];return l[0]-=t[0],l[1]-=t[1],l[0]*=a,l[1]*=a,e[0]+=l[0],e[1]+=l[1],e}function WCe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function XCe(e){return e.points!==void 0}function YCe(e){return e.x!==void 0&&e.y!==void 0}function ZCe(e){return e.paths!==void 0}function JCe(e){return e.rings!==void 0}function KCe(e){function t(r,i){return r==null?i:i==null?r:e(r,i)}return t}const Rw=KCe(Math.min),Iw=KCe(Math.max);function RUt(e,t){return ZCe(t)?mR(e,t.paths,!1,!1):JCe(t)?mR(e,t.rings,!1,!1):XCe(t)?kne(e,t.points,!1,!1,!1,!1):WCe(t)?QCe(e,t):(YCe(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function IUt(e,t){return ZCe(t)?mR(e,t.paths,!0,!1):JCe(t)?mR(e,t.rings,!0,!1):XCe(t)?kne(e,t.points,!0,!1,!0,!1):WCe(t)?QCe(e,t,!0,!1,!0,!1):(YCe(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function mR(e,t,r,i){const s=r?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,d]=t[0][0],[p,f]=t[0][0];for(let m=0;m<t.length;m++){const g=t[m];for(let _=0;_<g.length;_++){const x=g[_],[b,w]=x;if(c=Rw(c,b),d=Rw(d,w),p=Iw(p,b),f=Iw(f,w),r&&x.length>2){const T=x[2];n=Rw(n,T),o=Iw(o,T)}if(i&&x.length>s){const T=x[s];a=Rw(n,T),l=Iw(o,T)}}}return r?i?(e[0]=c,e[1]=d,e[2]=n,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=d,e[2]=n,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):i?(e[0]=c,e[1]=d,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=d,e[2]=p,e[3]=f,e.length=4,e)}function QCe(e,t,r,i,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let d=t.zmin,p=t.zmax,f=t.mmin,m=t.mmax;return s?(d=d||0,p=p||0,n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=d,e[3]=f,e[4]=a,e[5]=c,e[6]=p,e[7]=m,e):(e[0]=o,e[1]=l,e[2]=d,e[3]=a,e[4]=c,e[5]=p,e)):n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=f,e[3]=a,e[4]=c,e[5]=m,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function kne(e,t,r,i,s,n){const o=r?3:2,a=i&&n,l=r&&s;if(!t.length||!t[0].length)return null;let c,d,p,f,[m,g]=t[0],[_,x]=t[0];for(let b=0;b<t.length;b++){const w=t[b],[T,E]=w;if(m=Rw(m,T),g=Rw(g,E),_=Iw(_,T),x=Iw(x,E),l&&w.length>2){const O=w[2];c=Rw(c,O),d=Iw(d,O)}if(a&&w.length>o){const O=w[o];p=Rw(c,O),f=Iw(d,O)}}return s?(c=c||0,d=d||0,n?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=c,e[3]=p,e[4]=_,e[5]=x,e[6]=d,e[7]=f,e):(e[0]=m,e[1]=g,e[2]=c,e[3]=_,e[4]=x,e[5]=d,e)):n?(p=p||0,f=f||0,e[0]=m,e[1]=g,e[2]=p,e[3]=_,e[4]=x,e[5]=f,e):(e[0]=m,e[1]=g,e[2]=_,e[3]=x,e)}function aqe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function lqe(e){return e.points!==void 0}function cqe(e){return e.x!==void 0&&e.y!==void 0}function uqe(e){return e.paths!==void 0}function dqe(e){return e.rings!==void 0}const Une=[];function eAe(e,t,r,i){return{xmin:e,ymin:t,xmax:r,ymax:i}}function tAe(e,t,r,i,s,n){return{xmin:e,ymin:t,zmin:r,xmax:i,ymax:s,zmax:n}}function rAe(e,t,r,i,s,n){return{xmin:e,ymin:t,mmin:r,xmax:i,ymax:s,mmax:n}}function iAe(e,t,r,i,s,n,o,a){return{xmin:e,ymin:t,zmin:r,mmin:i,xmax:s,ymax:n,zmax:o,mmax:a}}function Bne(e,t=!1,r=!1){return t?r?iAe(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):tAe(e[0],e[1],e[2],e[3],e[4],e[5]):r?rAe(e[0],e[1],e[2],e[3],e[4],e[5]):eAe(e[0],e[1],e[2],e[3])}function PUt(e){return e?aqe(e)?e:cqe(e)?pqe(e):dqe(e)?sAe(e):uqe(e)?nAe(e):lqe(e)?hqe(e):null:null}function hqe(e){const{hasZ:t,hasM:r,points:i}=e;return Bne(kne(Une,i,t!=null?t:!1,r!=null?r:!1),t,r)}function pqe(e){const{x:t,y:r,z:i,m:s}=e,n=s!=null;return i!=null?n?iAe(t,r,i,s,t,r,i,s):tAe(t,r,i,t,r,i):n?rAe(t,r,s,t,r,s):eAe(t,r,t,r)}function sAe(e){const{hasZ:t,hasM:r,rings:i}=e,s=mR(Une,i,t!=null?t:!1,r!=null?r:!1);return s?Bne(s,t,r):null}function nAe(e){const{hasZ:t,hasM:r,paths:i}=e,s=mR(Une,i,t!=null?t:!1,r!=null?r:!1);return s?Bne(s,t,r):null}var S6;function hpe(e){return!Array.isArray(e[0])}let ey=S6=class extends Xx{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),r=e.spatialReference;let i=!1,s=!1;for(const o of t)o.hasZ&&(i=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(n.hasZ=!0),s&&(n.hasM=!0),new S6(n)}normalizeCtorArgs(e,t){let r,i,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),r=e.hasZ,i=e.hasM):s=e,s=s||[],t=t||Ve.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=n.length>3):r===void 0?r=i?n.length>3:n.length>2:i===void 0&&(i=r?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=tqe(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new lt;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=sAe(this);if(!t)return null;const r=new Sr(t);return r.spatialReference=e,r}get isSelfIntersecting(){return XHe(this.rings)}writeRings(e,t){t.rings=ne(this.rings)}addRing(e){if(!e)return;const t=this.rings,r=t.length;if(hpe(e)){const i=[];for(let s=0,n=e.length;s<n;s++)i[s]=e[s].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new S6;return e.spatialReference=this.spatialReference,e.rings=ne(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(C(e))return!1;const t=this.spatialReference,r=e.spatialReference;if(v(t)!==v(r)||v(t)&&v(r)&&!t.equals(r)||this.rings.length!==e.rings.length)return!1;const i=([s,n,o,a],[l,c,d,p])=>s===l&&n===c&&(o==null&&d==null||o===d)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!Bv(n,o,i))return!1}return!0}contains(e){if(!e)return!1;const t=QE(e,this.spatialReference);return kHe(this,v(t)?t:e)}isClockwise(e){let t;return t=hpe(e)?e.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):e,HCe(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.rings[e][t],i=this.hasZ,s=this.hasM;return i&&!s?new lt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new lt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new lt(r[0],r[1],r[2],r[3],this.spatialReference):new lt(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(fR(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e].splice(t,0,r),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new lt(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],r=this.spatialReference,i=t.map(s=>new lt(s,r));return this.notifyChange("rings"),i}setPoint(e,t,r){return this._validateInputs(e,t)?(fR(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e][t]=r,this.notifyChange("rings"),this):this}_validateInputs(e,t,r=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const i=this.rings[e];if(r&&(t<0||t>i.length)||!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([h({readOnly:!0})],ey.prototype,"cache",null),u([h({readOnly:!0})],ey.prototype,"centroid",null),u([h({readOnly:!0})],ey.prototype,"extent",null),u([h({readOnly:!0})],ey.prototype,"isSelfIntersecting",null),u([h({type:[[[Number]]],json:{write:{isRequired:!0}}})],ey.prototype,"rings",void 0),u([Le("rings")],ey.prototype,"writeRings",null),ey=S6=u([I("esri.geometry.Polygon")],ey),ey.prototype.toJSON.isDefaultToJSON=!0;const kl=ey;var LJ;function fqe(e){return!Array.isArray(e[0])}let mb=LJ=class extends Xx{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let r,i,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),r=e.hasZ,i=e.hasM):s=e,s=s||[],t=t||Ve.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(r===void 0&&i===void 0?(r=n.length>2,i=!1):r===void 0?r=!i&&n.length>3:i===void 0&&(i=!r&&n.length>3)),{paths:s,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=nAe(this);if(!t)return null;const r=new Sr(t);return r.spatialReference=e,r}writePaths(e,t){t.paths=ne(this.paths)}addPath(e){if(!e)return;const t=this.paths,r=t.length;if(fqe(e)){const i=[];for(let s=0,n=e.length;s<n;s++)i[s]=e[s].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new LJ;return e.spatialReference=this.spatialReference,e.paths=ne(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.paths[e][t],i=this.hasZ,s=this.hasM;return i&&!s?new lt(r[0],r[1],r[2],void 0,this.spatialReference):s&&!i?new lt(r[0],r[1],void 0,r[2],this.spatialReference):i&&s?new lt(r[0],r[1],r[2],r[3],this.spatialReference):new lt(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(fR(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e].splice(t,0,r),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],r=this.spatialReference,i=t.map(s=>new lt(s,r));return this.notifyChange("paths"),i}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new lt(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(e,t,r){return this._validateInputs(e,t)?(fR(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e][t]=r,this.notifyChange("paths"),this):this}_validateInputs(e,t,r=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const i=this.paths[e];if(r&&(t<0||t>i.length)||!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([h({readOnly:!0})],mb.prototype,"cache",null),u([h({readOnly:!0})],mb.prototype,"extent",null),u([h({type:[[[Number]]],json:{write:{isRequired:!0}}})],mb.prototype,"paths",void 0),u([Le("paths")],mb.prototype,"writePaths",null),mb=LJ=u([I("esri.geometry.Polyline")],mb),mb.prototype.toJSON.isDefaultToJSON=!0;const ja=mb,oAe=Br()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),ppe=Br()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function aAe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function zne(e){return e.points!==void 0}function Vne(e){return e.x!==void 0&&e.y!==void 0}function jne(e){return e.paths!==void 0}function D2(e){return e.rings!==void 0}function ql(e){return C(e)?null:e instanceof Xx?e:Vne(e)?lt.fromJSON(e):jne(e)?ja.fromJSON(e):D2(e)?kl.fromJSON(e):zne(e)?CI.fromJSON(e):aAe(e)?Sr.fromJSON(e):null}function AI(e){return e?Vne(e)?"esriGeometryPoint":jne(e)?"esriGeometryPolyline":D2(e)?"esriGeometryPolygon":aAe(e)?"esriGeometryEnvelope":zne(e)?"esriGeometryMultipoint":null:null}const mqe={esriGeometryPoint:lt,esriGeometryPolyline:ja,esriGeometryPolygon:kl,esriGeometryEnvelope:Sr,esriGeometryMultipoint:CI};function gqe(e){return e&&mqe[e]||null}const Yx={base:Xx,key:"type",typeMap:{extent:Sr,multipoint:CI,point:lt,polyline:ja,polygon:kl}};ug(Yx);var NJ;let gb=NJ=class extends fe{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new NJ({rotation:this.rotation,scale:this.scale,targetGeometry:v(this.targetGeometry)?this.targetGeometry.clone():null,camera:v(this.camera)?this.camera.clone():null})}};function VH(){return{enabled:!this.camera}}u([h({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:VH}}}}})],gb.prototype,"rotation",void 0),u([Gt("rotation")],gb.prototype,"castRotation",null),u([h({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:VH}}}}})],gb.prototype,"scale",void 0),u([h({types:Yx,json:{read:ql,write:!0,origins:{"web-scene":{read:ql,write:{overridePolicy:VH}}}}})],gb.prototype,"targetGeometry",void 0),u([h({type:Zh,json:{write:!0}})],gb.prototype,"camera",void 0),gb=NJ=u([I("esri.Viewpoint")],gb);const Fd=gb;var Pi;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(Pi||(Pi={}));function Gne(e){return(t,r)=>{t[r]=e}}class Hne{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new j2e(this._observers,t)}notify(){const t=this._observers.slice();for(let r=0;r<t.length;++r){const i=t[r];i.onInvalidated(),i.onCommitted()}}}var rv;class yqe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const cp=new ro(yqe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),_qe=()=>{};function jH(e){return e?e instanceof ZS?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function GH(e){if(e&&e.length)return e[0]}function vqe(e,t,r,i){const s=Math.min(e.length-r,t.length-i);let n=0;for(;n<s&&e[r+n]===t[i+n];)n++;return n}function lAe(e,t,r,i){t&&t.forEach((s,n,o)=>{e.push(s),lAe(e,r.call(i,s,n,o),r,i)})}const M1=new Set,R1=new Set,I1=new Set,HH=new Map;let bqe=0,ZS=rv=class extends $s.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new Hne,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:bqe++})}static isCollection(e){return e!=null&&e instanceof rv}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof rv?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return Rr(this._observable),this._items}set items(e){this._emitBeforeChanges(Pi.ADD)||(this._splice(0,this.length,jH(e)),this._emitAfterChanges(Pi.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const r=this._chgListeners,i={removed:!1,callback:t};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=_qe,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(e,t)}once(e,t){const r=this.on(e,t);return{remove(){r.remove()}}}add(e,t){if(Rr(this._observable),this._emitBeforeChanges(Pi.ADD))return this;const r=this.getNextIndex(t!=null?t:null);return this._splice(r,0,[e]),this._emitAfterChanges(Pi.ADD),this}addMany(e,t=this._items.length){if(Rr(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(Pi.ADD))return this;const r=this.getNextIndex(t);return this._splice(r,0,jH(e)),this._emitAfterChanges(Pi.ADD),this}at(e){if(Rr(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(Rr(this._observable),!this.length||this._emitBeforeChanges(Pi.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(Pi.REMOVE),e}clone(){return Rr(this._observable),this._createNewInstance({items:this._items.map(ne)})}concat(...e){Rr(this._observable);const t=e.map(jH);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(Rr(this._observable),!this.length||this._emitBeforeChanges(Pi.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let s=0;s<i;s++)e.call(t,r[s],s,r);this._emitAfterChanges(Pi.REMOVE)}every(e,t){return Rr(this._observable),this._items.every(e,t)}filter(e,t){let r;return Rr(this._observable),r=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:r})}find(e,t){return Rr(this._observable),this._items.find(e,t)}findIndex(e,t){return Rr(this._observable),this._items.findIndex(e,t)}flatten(e,t){Rr(this._observable);const r=[];return lAe(r,this,e,t),new rv(r)}forEach(e,t){return Rr(this._observable),this._items.forEach(e,t)}getItemAt(e){return Rr(this._observable),this._items[e]}getNextIndex(e){Rr(this._observable);const t=this.length;return(e=e!=null?e:t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return Rr(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return Rr(this._observable),this._items.indexOf(e,t)}join(e=","){return Rr(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return Rr(this._observable),this._items.lastIndexOf(e,t)}map(e,t){Rr(this._observable);const r=this._items.map(e,t);return new rv({items:r})}reorder(e,t=this.length-1){Rr(this._observable);const r=this.indexOf(e);if(r!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(Pi.MOVE))return e;this._splice(r,1),this._splice(t,0,[e]),this._emitAfterChanges(Pi.MOVE)}return e}}pop(){if(Rr(this._observable),!this.length||this._emitBeforeChanges(Pi.REMOVE))return;const e=GH(this._splice(this.length-1,1));return this._emitAfterChanges(Pi.REMOVE),e}push(...e){return Rr(this._observable),this._emitBeforeChanges(Pi.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(Pi.ADD)),this.length}reduce(e,t){Rr(this._observable);const r=this._items;return arguments.length===2?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){Rr(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return Rr(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(Rr(this._observable),e<0||e>=this.length||this._emitBeforeChanges(Pi.REMOVE))return;const t=GH(this._splice(e,1));return this._emitAfterChanges(Pi.REMOVE),t}removeMany(e){if(Rr(this._observable),!e||!e.length||this._emitBeforeChanges(Pi.REMOVE))return[];const t=e instanceof rv?e.toArray():e,r=this._items,i=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=r.indexOf(o);if(a>-1){const l=1+vqe(t,r,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),n+=l-1}}return this._emitAfterChanges(Pi.REMOVE),i}reverse(){if(Rr(this._observable),this._emitBeforeChanges(Pi.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(Pi.MOVE),this}shift(){if(Rr(this._observable),!this.length||this._emitBeforeChanges(Pi.REMOVE))return;const e=GH(this._splice(0,1));return this._emitAfterChanges(Pi.REMOVE),e}slice(e=0,t=this.length){return Rr(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return Rr(this._observable),this._items.some(e,t)}sort(e){if(Rr(this._observable),!this.length||this._emitBeforeChanges(Pi.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(Pi.MOVE),this}splice(e,t,...r){Rr(this._observable);const i=(t?Pi.REMOVE:0)|(r.length?Pi.ADD:0);if(this._emitBeforeChanges(i))return[];const s=this._splice(e,t,r)||[];return this._emitAfterChanges(i),s}toArray(){return Rr(this._observable),this._items.slice()}toJSON(){return Rr(this._observable),this.toArray()}toLocaleString(){return Rr(this._observable),this._items.toLocaleString()}toString(){return Rr(this._observable),this._items.toString()}unshift(...e){return Rr(this._observable),!e.length||this._emitBeforeChanges(Pi.ADD)||(this._splice(0,0,e),this._emitAfterChanges(Pi.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,r){const i=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=JE(()=>this._dispatchChange())),t){if(o=i.splice(e,t),this.hasEventListener("before-remove")){const a=cp.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(e,0,n),e+=1,l-=1,c-=1);cp.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=cp.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);cp.release(a)}}if(r&&r.length){if(s){const d=[];for(const p of r){const f=s.ensureType(p);f==null&&p!=null||d.push(f)}r=d}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const d=cp.acquire();d.target=this,d.cancellable=!0;const p=cp.acquire();p.target=this,p.cancellable=!1;for(const f of r)a?(d.reset(f),this.emit("before-add",d),d.defaultPrevented||(c?i.push(f):i.splice(e++,0,f),this._set("length",i.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?i.push(f):i.splice(e++,0,f),this._set("length",i.length),p.reset(f),this.emit("after-add",p));cp.release(p),cp.release(d)}else{if(c)for(const d of r)i.push(d);else i.splice(e,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=cp.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,cp.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=cp.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),cp.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const r=t.changes;M1.clear(),R1.clear(),I1.clear();for(const{added:l,removed:c}of r){if(l)if(I1.size===0&&R1.size===0)for(const d of l)M1.add(d);else for(const d of l)R1.has(d)?(I1.add(d),R1.delete(d)):I1.has(d)||M1.add(d);if(c)if(I1.size===0&&M1.size===0)for(const d of c)R1.add(d);else for(const d of c)M1.has(d)?M1.delete(d):(I1.delete(d),R1.add(d))}const i=yd.acquire();M1.forEach(l=>{i.push(l)});const s=yd.acquire();R1.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=yd.acquire();if(I1.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(i.length||s.length||a.length)){const l={target:this,added:i,removed:s,moved:a},c=t.listeners.length;for(let d=0;d<c;d++){const p=t.listeners[d];p.removed||p.callback.call(this,l)}}yd.release(i),yd.release(s),yd.release(a)}M1.clear(),R1.clear(),I1.clear()}};ZS.ofType=e=>{if(!e)return rv;if(HH.has(e))return HH.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const s=e.typeMap[i].prototype.declaredClass;t?t+=` | ${s}`:t=s}let r=class extends rv{};return u([Gne({Type:e,ensureType:typeof e=="function"?ts(e):ug(e)})],r.prototype,"itemType",void 0),r=u([I(`esri.core.Collection<${t}>`)],r),HH.set(e,r),r},u([h()],ZS.prototype,"length",void 0),u([h()],ZS.prototype,"items",null),ZS=rv=u([I("esri.core.Collection")],ZS);const Ge=ZS,fpe={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},wqe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function xqe(e,t){const r=new Date(e,t+1,1);return r.setDate(0),r.getDate()}function df(e,t,r){const i=new Date(e.getTime());if(t&&r){const s=wqe[r],{getter:n,setter:o,multiplier:a}=s;if(r==="months"){const l=xqe(i.getFullYear(),i.getMonth()+t);i.getDate()>l&&i.setDate(l)}i[o](i[n]()+t*a)}return i}function mpe(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function Tqe(e,t,r="milliseconds"){const i=new Date(Pw(t,r,"milliseconds"));return i.setUTCFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),i}function Sqe(e,t="milliseconds"){const r=Pw(e.getUTCHours(),"hours","milliseconds"),i=Pw(e.getUTCMinutes(),"minutes","milliseconds"),s=Pw(e.getUTCSeconds(),"seconds","milliseconds");return Pw(r+i+s+e.getUTCMilliseconds(),"milliseconds",t)}function Eqe(e,t){const r=new Date(e.getTime());return r.setUTCFullYear(t.getFullYear(),t.getMonth(),t.getDate()),r}function Cqe(e){const t=new Date(0);return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t}function Pw(e,t,r){return e===0?0:e*fpe[t]/fpe[r]}var Jf;let fh=Jf=class extends fe{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return gpe}static get empty(){return Aqe}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(Jf.allTime)}get isEmpty(){return this.equals(Jf.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new Jf({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=v(this.start)?this.start.getTime():this.start,r=v(this.end)?this.end.getTime():this.end,i=v(e.start)?e.start.getTime():e.start,s=v(e.end)?e.end.getTime():e.end;return t===i&&r===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=qi(this.start,i=>mpe(i,e)),r=qi(this.end,i=>{const s=mpe(i,e);return i.getTime()===s.getTime()?s:df(s,1,e)});return new Jf({start:t,end:r})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return Jf.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=Ch(this.start,-1/0,a=>a.getTime()),r=Ch(this.end,1/0,a=>a.getTime()),i=Ch(e.start,-1/0,a=>a.getTime()),s=Ch(e.end,1/0,a=>a.getTime());let n,o;if(i>=t&&i<=r?n=i:t>=i&&t<=s&&(n=t),r>=i&&r<=s?o=r:s>=t&&s<=r&&(o=s),n!=null&&o!=null&&!isNaN(n)&&!isNaN(o)){const a=new Jf;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return Jf.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const r=new Jf,{start:i,end:s}=this;return v(i)&&(r.start=df(i,e,t)),v(s)&&(r.end=df(s,e,t)),r}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return gpe.clone();const t=v(this.start)&&v(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,r=v(this.end)&&v(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new Jf({start:t,end:r})}};u([h({type:Date,json:{write:{allowNull:!0}}})],fh.prototype,"end",void 0),u([me("end")],fh.prototype,"readEnd",null),u([Le("end")],fh.prototype,"writeEnd",null),u([h({readOnly:!0,json:{read:!1}})],fh.prototype,"isAllTime",null),u([h({readOnly:!0,json:{read:!1}})],fh.prototype,"isEmpty",null),u([h({type:Date,json:{write:{allowNull:!0}}})],fh.prototype,"start",void 0),u([me("start")],fh.prototype,"readStart",null),u([Le("start")],fh.prototype,"writeStart",null),fh=Jf=u([I("esri.TimeExtent")],fh);const gpe=new fh,Aqe=new fh({start:void 0,end:void 0}),bg=fh;let Oqe=0;const eC=e=>{let t=class extends e{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+Oqe++})}};return t=u([I("esri.core.Identifiable")],t),t};let ype=class extends eC(class{}){};ype=u([I("esri.core.Identifiable")],ype);var FJ;let ty=FJ=class extends eC(fe){constructor(e){super(e),this.name=null,this.thumbnail=new xv,this.timeExtent=null}castThumbnail(e){return typeof e=="string"?new xv({url:e}):ts(xv,e)}set viewpoint(e){const{targetGeometry:t,scale:r}=e;v(t)&&t.type==="point"&&C(r)&&te.getLogger(this.declaredClass).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",e),this._set("viewpoint",e)}readViewpoint(e,t){const{extent:r,viewpoint:i}=t;return Fd.fromJSON(i||{targetGeometry:r})}writeViewpoint(e,t,r,i){if(!e)return;const{targetGeometry:s}=e;if(v(s)&&s.type!=="extent"){const n="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";i!=null&&i.messages?i.messages.push(new z("property:unsupported",n)):te.getLogger(this.declaredClass).error(n)}else v(s)&&(t.extent=s.toJSON()),t[r]=e.toJSON()}clone(){return new FJ(ne({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};u([h({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],ty.prototype,"name",void 0),u([h({type:xv,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.url)})}}})],ty.prototype,"thumbnail",void 0),u([Gt("thumbnail")],ty.prototype,"castThumbnail",null),u([h({type:bg,json:{write:!0}})],ty.prototype,"timeExtent",void 0),u([h({type:Fd,nonNullable:!0,json:{write:!0}})],ty.prototype,"viewpoint",null),u([me("viewpoint",["extent","viewpoint"])],ty.prototype,"readViewpoint",null),u([Le("viewpoint")],ty.prototype,"writeViewpoint",null),ty=FJ=u([I("esri.webmap.Bookmark")],ty);const cAe=ty,FF=e=>{let t=class extends e{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return u([h()],t.prototype,"goToOverride",void 0),u([h()],t.prototype,"view",void 0),t=u([I("esri.widgets.support.GoTo")],t),t},uAe=Ge.ofType(cAe),Mqe={width:128,height:128,format:"png"},h5={takeScreenshot:!0,captureViewpoint:!0,captureRotation:!0,captureScale:!0,captureTimeExtent:!0},_pe={time:!0};let Kf=class extends FF($s.EventedAccessor){constructor(e){super(e),this.abilities={..._pe},this.activeBookmark=null,this.view=null}destroy(){this.view=null,this._set("activeBookmark",null)}castAbilities(e){return{..._pe,...e}}get bookmarks(){var e,t,r;return(r=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.bookmarks)!=null?r:new uAe}set bookmarks(e){this._overrideIfSome("bookmarks",e)}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...h5,...e})}get defaultCreateOptions(){return h5}set defaultEditOptions(e){this._set("defaultEditOptions",{...h5,...e})}get defaultEditOptions(){return h5}get state(){const e=this.get("view");return e&&!e.ready?"loading":"ready"}async createBookmark(e){const{view:t,defaultCreateOptions:r,abilities:i}=this;if(!t)throw new z("create-bookmark:invalid-view","Cannot create a bookmark without a view.");const{takeScreenshot:s,screenshotSettings:n,captureViewpoint:o,captureRotation:a,captureScale:l,captureTimeExtent:c}={...r,...e},d=s?await this._createThumbnail(n):void 0,p=i.time&&c&&v(t.timeExtent)?t.timeExtent.clone():void 0;return new cAe({...d&&{thumbnail:d},...c&&{timeExtent:p},...o&&{viewpoint:this._createViewpoint({view:t,captureScale:l,captureRotation:a})}})}async editBookmark(e,t){const{view:r,defaultEditOptions:i}=this;if(!r)throw new z("edit-bookmark:invalid-view","Cannot edit a bookmark without a view.");const{takeScreenshot:s,screenshotSettings:n,captureViewpoint:o,captureRotation:a,captureScale:l,captureTimeExtent:c}={...i,...t},d=s?await this._createThumbnail(n):void 0;return d&&(e.thumbnail=d),o&&(e.viewpoint=this._createViewpoint({view:r,captureScale:l,captureRotation:a})),c&&v(r.timeExtent)&&(e.timeExtent=r.timeExtent.clone()),this.emit("bookmark-edit",{bookmark:e}),e}goTo(e){const{abilities:t,view:r}=this;if(!r)throw new z("go-to:invalid-view","Cannot go to a bookmark without a view");const i=e==null?void 0:e.viewpoint;if(!i)throw new z("go-to:invalid-bookmark","Cannot go to a bookmark that does not contain a 'viewpoint'.",{bookmark:e});this._set("activeBookmark",e);const s={target:i},n=this.callGoTo(s),o=e==null?void 0:e.timeExtent;return t.time&&o&&(r.timeExtent=o),this.emit("bookmark-select",{bookmark:e}),n.catch(()=>{}).then(()=>this._set("activeBookmark",null)),n}async _createThumbnail(e){const t=await this.view.takeScreenshot({...Mqe,...e});return new xv({url:t.dataUrl})}_createViewpoint({view:e,captureRotation:t,captureScale:r}){var s,n;const i=(s=e.viewpoint)==null?void 0:s.clone();return new Fd({targetGeometry:(n=e.extent)==null?void 0:n.clone(),rotation:t&&(i==null?void 0:i.rotation)||0,scale:r&&(i==null?void 0:i.scale)||0})}};u([h()],Kf.prototype,"abilities",void 0),u([Gt("abilities")],Kf.prototype,"castAbilities",null),u([h({readOnly:!0})],Kf.prototype,"activeBookmark",void 0),u([h({type:uAe})],Kf.prototype,"bookmarks",null),u([h()],Kf.prototype,"defaultCreateOptions",null),u([h()],Kf.prototype,"defaultEditOptions",null),u([h({readOnly:!0})],Kf.prototype,"state",null),u([h()],Kf.prototype,"view",void 0),Kf=u([I("esri.widgets.Bookmarks.BookmarksViewModel")],Kf);const dAe=Kf;let a0=class extends be{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new hr,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,t,r={}){return this._installWatch(e,t,r,ie)}addWhen(e,t,r={}){return this._installWatch(e,t,r,no)}addOnCollectionChange(e,t,{initial:r=!1,final:i=!1}={}){const s=++this._handleId;return this._handles.add([ms(e,"after-changes",this._createSyncUpdatingCallback(),bi),ms(e,"change",t,{onListenerAdd:r?n=>t({added:n.toArray(),removed:[]}):void 0,onListenerRemove:i?n=>t({added:[],removed:n.toArray()}):void 0})],s),{remove:()=>this._handles.remove(s)}}addPromise(e){if(C(e))return e;const t=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(p5)||this._set("updating",!1))}},t),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this._handles.remove(t);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,r={},i){const s=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,s);const n=i(e,t,r);return this._handles.add(n,s),{remove:()=>this._handles.remove(s)}}_installSyncUpdatingWatch(e,t){const r=this._createSyncUpdatingCallback(),i=ie(e,r,{sync:!0,equals:()=>!1});return this._handles.add(i,t),i}_createSyncUpdatingCallback(){return()=>{this._handles.remove(p5),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(JE(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(p5))}),p5)}}};u([h({readOnly:!0})],a0.prototype,"updating",void 0),a0=u([I("esri.core.support.WatchUpdatingTracking")],a0);const p5=-42,$0=e=>{let t=class extends e{destroy(){var r,i;this.destroyed||((r=this._get("handles"))==null||r.destroy(),(i=this._get("updatingHandles"))==null||i.destroy())}get handles(){return this._get("handles")||new hr}get updatingHandles(){return this._get("updatingHandles")||new a0}};return u([h({readOnly:!0})],t.prototype,"handles",null),u([h({readOnly:!0})],t.prototype,"updatingHandles",null),t=u([I("esri.core.HandleOwner")],t),t};let gR=class extends $0(be){};gR=u([I("esri.core.HandleOwner")],gR);var E6;let Tp=E6=class extends be{constructor(e){super(e),this.autoCloseMenu=!1,this.iconClass=null,this.items=null,this.label=null,this.open=!1,this.selected=!1,this.selectionEnabled=!1,this.clickFunction=null}castItems(e){return e?e.map(t=>t instanceof E6?t:new E6(t)):null}};u([h()],Tp.prototype,"autoCloseMenu",void 0),u([h()],Tp.prototype,"iconClass",void 0),u([h()],Tp.prototype,"items",void 0),u([Gt("items")],Tp.prototype,"castItems",null),u([h()],Tp.prototype,"label",void 0),u([h()],Tp.prototype,"open",void 0),u([h()],Tp.prototype,"selected",void 0),u([h()],Tp.prototype,"selectionEnabled",void 0),u([h()],Tp.prototype,"clickFunction",void 0),Tp=E6=u([I("esri.widgets.FeatureTable.Grid.support.ButtonMenuItem")],Tp);const TD=Tp;let MA=class extends be{constructor(e){super(e),this.items=null,this.open=!1}castItems(e){return e?e.map(t=>t instanceof TD?t:new TD(t)):null}};u([h()],MA.prototype,"items",void 0),u([Gt("items")],MA.prototype,"castItems",null),u([h()],MA.prototype,"open",void 0),MA=u([I("esri.widgets.FeatureTable.Grid.support.ButtonMenuViewModel")],MA);const Rqe=MA;function If(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function dE(e){var t=If(e).Element;return e instanceof t||e instanceof Element}function hf(e){var t=If(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function qne(e){if(typeof ShadowRoot>"u")return!1;var t=If(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var L2=Math.max,wz=Math.min,yR=Math.round;function kJ(){var e=navigator.userAgentData;return e!=null&&e.brands?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function hAe(){return!/^((?!chrome|android).)*safari/i.test(kJ())}function _R(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var i=e.getBoundingClientRect(),s=1,n=1;t&&hf(e)&&(s=e.offsetWidth>0&&yR(i.width)/e.offsetWidth||1,n=e.offsetHeight>0&&yR(i.height)/e.offsetHeight||1);var o=dE(e)?If(e):window,a=o.visualViewport,l=!hAe()&&r,c=(i.left+(l&&a?a.offsetLeft:0))/s,d=(i.top+(l&&a?a.offsetTop:0))/n,p=i.width/s,f=i.height/n;return{width:p,height:f,top:d,right:c+p,bottom:d+f,left:c,x:c,y:d}}function Wne(e){var t=If(e),r=t.pageXOffset,i=t.pageYOffset;return{scrollLeft:r,scrollTop:i}}function Iqe(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function Pqe(e){return e===If(e)||!hf(e)?Wne(e):Iqe(e)}function _0(e){return e?(e.nodeName||"").toLowerCase():null}function Zx(e){return((dE(e)?e.ownerDocument:e.document)||window.document).documentElement}function Xne(e){return _R(Zx(e)).left+Wne(e).scrollLeft}function jv(e){return If(e).getComputedStyle(e)}function Yne(e){var t=jv(e),r=t.overflow,i=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+s+i)}function $qe(e){var t=e.getBoundingClientRect(),r=yR(t.width)/e.offsetWidth||1,i=yR(t.height)/e.offsetHeight||1;return r!==1||i!==1}function Dqe(e,t,r){r===void 0&&(r=!1);var i=hf(t),s=hf(t)&&$qe(t),n=Zx(t),o=_R(e,s,r),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!r)&&((_0(t)!=="body"||Yne(n))&&(a=Pqe(t)),hf(t)?(l=_R(t,!0),l.x+=t.clientLeft,l.y+=t.clientTop):n&&(l.x=Xne(n))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function Zne(e){var t=_R(e),r=e.offsetWidth,i=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:i}}function Q9(e){return _0(e)==="html"?e:e.assignedSlot||e.parentNode||(qne(e)?e.host:null)||Zx(e)}function pAe(e){return["html","body","#document"].indexOf(_0(e))>=0?e.ownerDocument.body:hf(e)&&Yne(e)?e:pAe(Q9(e))}function SD(e,t){var r;t===void 0&&(t=[]);var i=pAe(e),s=i===((r=e.ownerDocument)==null?void 0:r.body),n=If(i),o=s?[n].concat(n.visualViewport||[],Yne(i)?i:[]):i,a=t.concat(o);return s?a:a.concat(SD(Q9(o)))}function Lqe(e){return["table","td","th"].indexOf(_0(e))>=0}function vpe(e){return!hf(e)||jv(e).position==="fixed"?null:e.offsetParent}function Nqe(e){var t=/firefox/i.test(kJ()),r=/Trident/i.test(kJ());if(r&&hf(e)){var i=jv(e);if(i.position==="fixed")return null}var s=Q9(e);for(qne(s)&&(s=s.host);hf(s)&&["html","body"].indexOf(_0(s))<0;){var n=jv(s);if(n.transform!=="none"||n.perspective!=="none"||n.contain==="paint"||["transform","perspective"].indexOf(n.willChange)!==-1||t&&n.willChange==="filter"||t&&n.filter&&n.filter!=="none")return s;s=s.parentNode}return null}function kF(e){for(var t=If(e),r=vpe(e);r&&Lqe(r)&&jv(r).position==="static";)r=vpe(r);return r&&(_0(r)==="html"||_0(r)==="body"&&jv(r).position==="static")?t:r||Nqe(e)||t}var Id="top",bf="bottom",wf="right",Pd="left",Jne="auto",UF=[Id,bf,wf,Pd],vR="start",iN="end",Fqe="clippingParents",fAe="viewport",fP="popper",kqe="reference",bpe=UF.reduce(function(e,t){return e.concat([t+"-"+vR,t+"-"+iN])},[]),mAe=[].concat(UF,[Jne]).reduce(function(e,t){return e.concat([t,t+"-"+vR,t+"-"+iN])},[]),Uqe="beforeRead",Bqe="read",zqe="afterRead",Vqe="beforeMain",jqe="main",Gqe="afterMain",Hqe="beforeWrite",qqe="write",Wqe="afterWrite",Xqe=[Uqe,Bqe,zqe,Vqe,jqe,Gqe,Hqe,qqe,Wqe];function Yqe(e){var t=new Map,r=new Set,i=[];e.forEach(function(n){t.set(n.name,n)});function s(n){r.add(n.name);var o=[].concat(n.requires||[],n.requiresIfExists||[]);o.forEach(function(a){if(!r.has(a)){var l=t.get(a);l&&s(l)}}),i.push(n)}return e.forEach(function(n){r.has(n.name)||s(n)}),i}function Zqe(e){var t=Yqe(e);return Xqe.reduce(function(r,i){return r.concat(t.filter(function(s){return s.phase===i}))},[])}function Jqe(e){var t;return function(){return t||(t=new Promise(function(r){Promise.resolve().then(function(){t=void 0,r(e())})})),t}}function l0(e){return e.split("-")[0]}function Kqe(e){var t=e.reduce(function(r,i){var s=r[i.name];return r[i.name]=s?Object.assign({},s,i,{options:Object.assign({},s.options,i.options),data:Object.assign({},s.data,i.data)}):i,r},{});return Object.keys(t).map(function(r){return t[r]})}function Qqe(e,t){var r=If(e),i=Zx(e),s=r.visualViewport,n=i.clientWidth,o=i.clientHeight,a=0,l=0;if(s){n=s.width,o=s.height;var c=hAe();(c||!c&&t==="fixed")&&(a=s.offsetLeft,l=s.offsetTop)}return{width:n,height:o,x:a+Xne(e),y:l}}function eWe(e){var t,r=Zx(e),i=Wne(e),s=(t=e.ownerDocument)==null?void 0:t.body,n=L2(r.scrollWidth,r.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),o=L2(r.scrollHeight,r.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),a=-i.scrollLeft+Xne(e),l=-i.scrollTop;return jv(s||r).direction==="rtl"&&(a+=L2(r.clientWidth,s?s.clientWidth:0)-n),{width:n,height:o,x:a,y:l}}function gAe(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&qne(r)){var i=t;do{if(i&&e.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function UJ(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function tWe(e,t){var r=_R(e,!1,t==="fixed");return r.top=r.top+e.clientTop,r.left=r.left+e.clientLeft,r.bottom=r.top+e.clientHeight,r.right=r.left+e.clientWidth,r.width=e.clientWidth,r.height=e.clientHeight,r.x=r.left,r.y=r.top,r}function wpe(e,t,r){return t===fAe?UJ(Qqe(e,r)):dE(t)?tWe(t,r):UJ(eWe(Zx(e)))}function rWe(e){var t=SD(Q9(e)),r=["absolute","fixed"].indexOf(jv(e).position)>=0,i=r&&hf(e)?kF(e):e;return dE(i)?t.filter(function(s){return dE(s)&&gAe(s,i)&&_0(s)!=="body"}):[]}function iWe(e,t,r,i){var s=t==="clippingParents"?rWe(e):[].concat(t),n=[].concat(s,[r]),o=n[0],a=n.reduce(function(l,c){var d=wpe(e,c,i);return l.top=L2(d.top,l.top),l.right=wz(d.right,l.right),l.bottom=wz(d.bottom,l.bottom),l.left=L2(d.left,l.left),l},wpe(e,o,i));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function bR(e){return e.split("-")[1]}function Kne(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function yAe(e){var t=e.reference,r=e.element,i=e.placement,s=i?l0(i):null,n=i?bR(i):null,o=t.x+t.width/2-r.width/2,a=t.y+t.height/2-r.height/2,l;switch(s){case Id:l={x:o,y:t.y-r.height};break;case bf:l={x:o,y:t.y+t.height};break;case wf:l={x:t.x+t.width,y:a};break;case Pd:l={x:t.x-r.width,y:a};break;default:l={x:t.x,y:t.y}}var c=s?Kne(s):null;if(c!=null){var d=c==="y"?"height":"width";switch(n){case vR:l[c]=l[c]-(t[d]/2-r[d]/2);break;case iN:l[c]=l[c]+(t[d]/2-r[d]/2);break}}return l}function _Ae(){return{top:0,right:0,bottom:0,left:0}}function vAe(e){return Object.assign({},_Ae(),e)}function bAe(e,t){return t.reduce(function(r,i){return r[i]=e,r},{})}function sN(e,t){t===void 0&&(t={});var r=t,i=r.placement,s=i===void 0?e.placement:i,n=r.strategy,o=n===void 0?e.strategy:n,a=r.boundary,l=a===void 0?Fqe:a,c=r.rootBoundary,d=c===void 0?fAe:c,p=r.elementContext,f=p===void 0?fP:p,m=r.altBoundary,g=m===void 0?!1:m,_=r.padding,x=_===void 0?0:_,b=vAe(typeof x!="number"?x:bAe(x,UF)),w=f===fP?kqe:fP,T=e.rects.popper,E=e.elements[g?w:f],O=iWe(dE(E)?E:E.contextElement||Zx(e.elements.popper),l,d,o),A=_R(e.elements.reference),R=yAe({reference:A,element:T,strategy:"absolute",placement:s}),D=UJ(Object.assign({},T,R)),k=f===fP?D:A,L={top:O.top-k.top+b.top,bottom:k.bottom-O.bottom+b.bottom,left:O.left-k.left+b.left,right:k.right-O.right+b.right},q=e.modifiersData.offset;if(f===fP&&q){var G=q[s];Object.keys(L).forEach(function(J){var ee=[wf,bf].indexOf(J)>=0?1:-1,se=[Id,bf].indexOf(J)>=0?"y":"x";L[J]+=G[se]*ee})}return L}var xpe={placement:"bottom",modifiers:[],strategy:"absolute"};function Tpe(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function sWe(e){e===void 0&&(e={});var t=e,r=t.defaultModifiers,i=r===void 0?[]:r,s=t.defaultOptions,n=s===void 0?xpe:s;return function(a,l,c){c===void 0&&(c=n);var d={placement:"bottom",orderedModifiers:[],options:Object.assign({},xpe,n),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},p=[],f=!1,m={state:d,setOptions:function(b){var w=typeof b=="function"?b(d.options):b;_(),d.options=Object.assign({},n,d.options,w),d.scrollParents={reference:dE(a)?SD(a):a.contextElement?SD(a.contextElement):[],popper:SD(l)};var T=Zqe(Kqe([].concat(i,d.options.modifiers)));return d.orderedModifiers=T.filter(function(E){return E.enabled}),g(),m.update()},forceUpdate:function(){if(!f){var b=d.elements,w=b.reference,T=b.popper;if(!!Tpe(w,T)){d.rects={reference:Dqe(w,kF(T),d.options.strategy==="fixed"),popper:Zne(T)},d.reset=!1,d.placement=d.options.placement,d.orderedModifiers.forEach(function(L){return d.modifiersData[L.name]=Object.assign({},L.data)});for(var E=0;E<d.orderedModifiers.length;E++){if(d.reset===!0){d.reset=!1,E=-1;continue}var O=d.orderedModifiers[E],A=O.fn,R=O.options,D=R===void 0?{}:R,k=O.name;typeof A=="function"&&(d=A({state:d,options:D,name:k,instance:m})||d)}}}},update:Jqe(function(){return new Promise(function(x){m.forceUpdate(),x(d)})}),destroy:function(){_(),f=!0}};if(!Tpe(a,l))return m;m.setOptions(c).then(function(x){!f&&c.onFirstUpdate&&c.onFirstUpdate(x)});function g(){d.orderedModifiers.forEach(function(x){var b=x.name,w=x.options,T=w===void 0?{}:w,E=x.effect;if(typeof E=="function"){var O=E({state:d,name:b,instance:m,options:T}),A=function(){};p.push(O||A)}})}function _(){p.forEach(function(x){return x()}),p=[]}return m}}var f5={passive:!0};function nWe(e){var t=e.state,r=e.instance,i=e.options,s=i.scroll,n=s===void 0?!0:s,o=i.resize,a=o===void 0?!0:o,l=If(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return n&&c.forEach(function(d){d.addEventListener("scroll",r.update,f5)}),a&&l.addEventListener("resize",r.update,f5),function(){n&&c.forEach(function(d){d.removeEventListener("scroll",r.update,f5)}),a&&l.removeEventListener("resize",r.update,f5)}}const oWe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:nWe,data:{}};function aWe(e){var t=e.state,r=e.name;t.modifiersData[r]=yAe({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const lWe={name:"popperOffsets",enabled:!0,phase:"read",fn:aWe,data:{}};var cWe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function uWe(e){var t=e.x,r=e.y,i=window,s=i.devicePixelRatio||1;return{x:yR(t*s)/s||0,y:yR(r*s)/s||0}}function Spe(e){var t,r=e.popper,i=e.popperRect,s=e.placement,n=e.variation,o=e.offsets,a=e.position,l=e.gpuAcceleration,c=e.adaptive,d=e.roundOffsets,p=e.isFixed,f=o.x,m=f===void 0?0:f,g=o.y,_=g===void 0?0:g,x=typeof d=="function"?d({x:m,y:_}):{x:m,y:_};m=x.x,_=x.y;var b=o.hasOwnProperty("x"),w=o.hasOwnProperty("y"),T=Pd,E=Id,O=window;if(c){var A=kF(r),R="clientHeight",D="clientWidth";if(A===If(r)&&(A=Zx(r),jv(A).position!=="static"&&a==="absolute"&&(R="scrollHeight",D="scrollWidth")),A=A,s===Id||(s===Pd||s===wf)&&n===iN){E=bf;var k=p&&A===O&&O.visualViewport?O.visualViewport.height:A[R];_-=k-i.height,_*=l?1:-1}if(s===Pd||(s===Id||s===bf)&&n===iN){T=wf;var L=p&&A===O&&O.visualViewport?O.visualViewport.width:A[D];m-=L-i.width,m*=l?1:-1}}var q=Object.assign({position:a},c&&cWe),G=d===!0?uWe({x:m,y:_}):{x:m,y:_};if(m=G.x,_=G.y,l){var J;return Object.assign({},q,(J={},J[E]=w?"0":"",J[T]=b?"0":"",J.transform=(O.devicePixelRatio||1)<=1?"translate("+m+"px, "+_+"px)":"translate3d("+m+"px, "+_+"px, 0)",J))}return Object.assign({},q,(t={},t[E]=w?_+"px":"",t[T]=b?m+"px":"",t.transform="",t))}function dWe(e){var t=e.state,r=e.options,i=r.gpuAcceleration,s=i===void 0?!0:i,n=r.adaptive,o=n===void 0?!0:n,a=r.roundOffsets,l=a===void 0?!0:a,c={placement:l0(t.placement),variation:bR(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Spe(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:l})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Spe(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const hWe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:dWe,data:{}};function pWe(e){var t=e.state;Object.keys(t.elements).forEach(function(r){var i=t.styles[r]||{},s=t.attributes[r]||{},n=t.elements[r];!hf(n)||!_0(n)||(Object.assign(n.style,i),Object.keys(s).forEach(function(o){var a=s[o];a===!1?n.removeAttribute(o):n.setAttribute(o,a===!0?"":a)}))})}function fWe(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow),function(){Object.keys(t.elements).forEach(function(i){var s=t.elements[i],n=t.attributes[i]||{},o=Object.keys(t.styles.hasOwnProperty(i)?t.styles[i]:r[i]),a=o.reduce(function(l,c){return l[c]="",l},{});!hf(s)||!_0(s)||(Object.assign(s.style,a),Object.keys(n).forEach(function(l){s.removeAttribute(l)}))})}}const mWe={name:"applyStyles",enabled:!0,phase:"write",fn:pWe,effect:fWe,requires:["computeStyles"]};function gWe(e,t,r){var i=l0(e),s=[Pd,Id].indexOf(i)>=0?-1:1,n=typeof r=="function"?r(Object.assign({},t,{placement:e})):r,o=n[0],a=n[1];return o=o||0,a=(a||0)*s,[Pd,wf].indexOf(i)>=0?{x:a,y:o}:{x:o,y:a}}function yWe(e){var t=e.state,r=e.options,i=e.name,s=r.offset,n=s===void 0?[0,0]:s,o=mAe.reduce(function(d,p){return d[p]=gWe(p,t.rects,n),d},{}),a=o[t.placement],l=a.x,c=a.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[i]=o}const _We={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:yWe};var vWe={left:"right",right:"left",bottom:"top",top:"bottom"};function C6(e){return e.replace(/left|right|bottom|top/g,function(t){return vWe[t]})}var bWe={start:"end",end:"start"};function Epe(e){return e.replace(/start|end/g,function(t){return bWe[t]})}function wWe(e,t){t===void 0&&(t={});var r=t,i=r.placement,s=r.boundary,n=r.rootBoundary,o=r.padding,a=r.flipVariations,l=r.allowedAutoPlacements,c=l===void 0?mAe:l,d=bR(i),p=d?a?bpe:bpe.filter(function(g){return bR(g)===d}):UF,f=p.filter(function(g){return c.indexOf(g)>=0});f.length===0&&(f=p);var m=f.reduce(function(g,_){return g[_]=sN(e,{placement:_,boundary:s,rootBoundary:n,padding:o})[l0(_)],g},{});return Object.keys(m).sort(function(g,_){return m[g]-m[_]})}function xWe(e){if(l0(e)===Jne)return[];var t=C6(e);return[Epe(e),t,Epe(t)]}function TWe(e){var t=e.state,r=e.options,i=e.name;if(!t.modifiersData[i]._skip){for(var s=r.mainAxis,n=s===void 0?!0:s,o=r.altAxis,a=o===void 0?!0:o,l=r.fallbackPlacements,c=r.padding,d=r.boundary,p=r.rootBoundary,f=r.altBoundary,m=r.flipVariations,g=m===void 0?!0:m,_=r.allowedAutoPlacements,x=t.options.placement,b=l0(x),w=b===x,T=l||(w||!g?[C6(x)]:xWe(x)),E=[x].concat(T).reduce(function(ce,we){return ce.concat(l0(we)===Jne?wWe(t,{placement:we,boundary:d,rootBoundary:p,padding:c,flipVariations:g,allowedAutoPlacements:_}):we)},[]),O=t.rects.reference,A=t.rects.popper,R=new Map,D=!0,k=E[0],L=0;L<E.length;L++){var q=E[L],G=l0(q),J=bR(q)===vR,ee=[Id,bf].indexOf(G)>=0,se=ee?"width":"height",X=sN(t,{placement:q,boundary:d,rootBoundary:p,altBoundary:f,padding:c}),F=ee?J?wf:Pd:J?bf:Id;O[se]>A[se]&&(F=C6(F));var N=C6(F),B=[];if(n&&B.push(X[G]<=0),a&&B.push(X[F]<=0,X[N]<=0),B.every(function(ce){return ce})){k=q,D=!1;break}R.set(q,B)}if(D)for(var H=g?3:1,W=function(we){var Oe=E.find(function(Be){var He=R.get(Be);if(He)return He.slice(0,we).every(function(Se){return Se})});if(Oe)return k=Oe,"break"},K=H;K>0;K--){var Y=W(K);if(Y==="break")break}t.placement!==k&&(t.modifiersData[i]._skip=!0,t.placement=k,t.reset=!0)}}const SWe={name:"flip",enabled:!0,phase:"main",fn:TWe,requiresIfExists:["offset"],data:{_skip:!1}};function EWe(e){return e==="x"?"y":"x"}function ED(e,t,r){return L2(e,wz(t,r))}function CWe(e,t,r){var i=ED(e,t,r);return i>r?r:i}function AWe(e){var t=e.state,r=e.options,i=e.name,s=r.mainAxis,n=s===void 0?!0:s,o=r.altAxis,a=o===void 0?!1:o,l=r.boundary,c=r.rootBoundary,d=r.altBoundary,p=r.padding,f=r.tether,m=f===void 0?!0:f,g=r.tetherOffset,_=g===void 0?0:g,x=sN(t,{boundary:l,rootBoundary:c,padding:p,altBoundary:d}),b=l0(t.placement),w=bR(t.placement),T=!w,E=Kne(b),O=EWe(E),A=t.modifiersData.popperOffsets,R=t.rects.reference,D=t.rects.popper,k=typeof _=="function"?_(Object.assign({},t.rects,{placement:t.placement})):_,L=typeof k=="number"?{mainAxis:k,altAxis:k}:Object.assign({mainAxis:0,altAxis:0},k),q=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,G={x:0,y:0};if(!!A){if(n){var J,ee=E==="y"?Id:Pd,se=E==="y"?bf:wf,X=E==="y"?"height":"width",F=A[E],N=F+x[ee],B=F-x[se],H=m?-D[X]/2:0,W=w===vR?R[X]:D[X],K=w===vR?-D[X]:-R[X],Y=t.elements.arrow,ce=m&&Y?Zne(Y):{width:0,height:0},we=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:_Ae(),Oe=we[ee],Be=we[se],He=ED(0,R[X],ce[X]),Se=T?R[X]/2-H-He-Oe-L.mainAxis:W-He-Oe-L.mainAxis,he=T?-R[X]/2+H+He+Be+L.mainAxis:K+He+Be+L.mainAxis,Me=t.elements.arrow&&kF(t.elements.arrow),Xt=Me?E==="y"?Me.clientTop||0:Me.clientLeft||0:0,Er=(J=q==null?void 0:q[E])!=null?J:0,Cr=F+Se-Er-Xt,bt=F+he-Er,ht=ED(m?wz(N,Cr):N,F,m?L2(B,bt):B);A[E]=ht,G[E]=ht-F}if(a){var rr,yr=E==="x"?Id:Pd,Ui=E==="x"?bf:wf,it=A[O],ur=O==="y"?"height":"width",mi=it+x[yr],zr=it-x[Ui],ir=[Id,Pd].indexOf(b)!==-1,Nr=(rr=q==null?void 0:q[O])!=null?rr:0,_t=ir?mi:it-R[ur]-D[ur]-Nr+L.altAxis,ft=ir?it+R[ur]+D[ur]-Nr-L.altAxis:zr,Bt=m&&ir?CWe(_t,it,ft):ED(m?_t:mi,it,m?ft:zr);A[O]=Bt,G[O]=Bt-it}t.modifiersData[i]=G}}const OWe={name:"preventOverflow",enabled:!0,phase:"main",fn:AWe,requiresIfExists:["offset"]};var MWe=function(t,r){return t=typeof t=="function"?t(Object.assign({},r.rects,{placement:r.placement})):t,vAe(typeof t!="number"?t:bAe(t,UF))};function RWe(e){var t,r=e.state,i=e.name,s=e.options,n=r.elements.arrow,o=r.modifiersData.popperOffsets,a=l0(r.placement),l=Kne(a),c=[Pd,wf].indexOf(a)>=0,d=c?"height":"width";if(!(!n||!o)){var p=MWe(s.padding,r),f=Zne(n),m=l==="y"?Id:Pd,g=l==="y"?bf:wf,_=r.rects.reference[d]+r.rects.reference[l]-o[l]-r.rects.popper[d],x=o[l]-r.rects.reference[l],b=kF(n),w=b?l==="y"?b.clientHeight||0:b.clientWidth||0:0,T=_/2-x/2,E=p[m],O=w-f[d]-p[g],A=w/2-f[d]/2+T,R=ED(E,A,O),D=l;r.modifiersData[i]=(t={},t[D]=R,t.centerOffset=R-A,t)}}function IWe(e){var t=e.state,r=e.options,i=r.element,s=i===void 0?"[data-popper-arrow]":i;s!=null&&(typeof s=="string"&&(s=t.elements.popper.querySelector(s),!s)||!gAe(t.elements.popper,s)||(t.elements.arrow=s))}const PWe={name:"arrow",enabled:!0,phase:"main",fn:RWe,effect:IWe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Cpe(e,t,r){return r===void 0&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function Ape(e){return[Id,wf,bf,Pd].some(function(t){return e[t]>=0})}function $We(e){var t=e.state,r=e.name,i=t.rects.reference,s=t.rects.popper,n=t.modifiersData.preventOverflow,o=sN(t,{elementContext:"reference"}),a=sN(t,{altBoundary:!0}),l=Cpe(o,i),c=Cpe(a,s,n),d=Ape(l),p=Ape(c);t.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:d,hasPopperEscaped:p},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":p})}const DWe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:$We};var LWe=[oWe,lWe,hWe,mWe,_We,SWe,OWe,PWe,DWe],NWe=sWe({defaultModifiers:LWe}),FWe=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},wAe=function(e,t){for(var r=0,i=e.length;r<i;r++){var s=e[r];Array.isArray(s)?wAe(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=FWe(s)),t.push(s))}},kWe=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:r[0],domNode:null};var s=[];return wAe(r,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function P(e,t,...r){return typeof e!="function"||xne(e)?kWe(e,t,...r):e(t,...r)}function A6(...e){return e}const UWe=["bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end","top","top-start","top-end"],Ope={base:"esri-popover",open:"esri-popover--open"},BWe={position:"fixed","z-index":"1000"};let ry=class extends Ss{constructor(e,t){super(e,t),this._popper=null,this._contentNode=null,this._renderAttached=!1,this._rootNode=null,this.anchorElement=null,this.offset=[0,0],this.open=!1,this.renderContentFunction=null,this._afterRootCreate=r=>{this._rootNode=r},this._afterContentCreate=r=>{this._contentNode=r},this._updatePosition=()=>{v(this._popper)&&this._popper.update()}}initialize(){this.when(()=>{this.destroyed||(this._projector.append(document.body,this.render),this._renderAttached=!0)}),this.addHandles([ie(()=>[this.open,this.anchorElement],()=>this._buildPopper(),pt),ie(()=>[this.placement,this.offset],()=>this._setPopperOptions(),pt)])}destroy(){this.owner=null,this.anchorElement=null,this.renderContentFunction=null,this._renderAttached&&(this._projector.detach(this.render),this._renderAttached=!1),v(this._rootNode)&&(aje(this._rootNode),this._rootNode=null),this._contentNode=null,v(this._popper)&&(this._popper.destroy(),this._popper=null)}set container(e){}set owner(e){this._set("owner",e)}get placement(){return"top"}set placement(e){UWe.includes(e)?this._override("placement",e):this._clearOverride("placement")}render(){var i;const{open:e,owner:t,renderContentFunction:r}=this;return P("div",{afterCreate:this._afterRootCreate,class:this.classes(Ope.base,e?Ope.open:null),styles:BWe},P("div",{dir:c7e((i=this.owner)==null?void 0:i.container),afterCreate:this._afterContentCreate,afterUpdate:this._updatePosition},e&&(r==null?void 0:r.call(t))))}_buildPopper(){v(this._popper)&&(this._popper.destroy(),this._popper=null);const e=this._contentNode;if(C(e)||!this.open||!this.renderContentFunction)return;const t=this._getAnchor();t&&(this._popper=NWe(t,e),this._setPopperOptions())}_setPopperOptions(){const{placement:e,offset:t,_popper:r}=this;C(r)||(r.setOptions({placement:e,modifiers:[{name:"offset",options:{offset:t}}]}),r.forceUpdate())}_getAnchor(){const{anchorElement:e}=this;return $F(typeof e=="function"?e():e)}};u([h()],ry.prototype,"anchorElement",void 0),u([h()],ry.prototype,"container",null),u([h()],ry.prototype,"offset",void 0),u([h()],ry.prototype,"open",void 0),u([h()],ry.prototype,"owner",null),u([h()],ry.prototype,"placement",null),u([h()],ry.prototype,"renderContentFunction",void 0),ry=u([I("esri.widgets.support.Popover")],ry);const Qne=ry,ec={base:"esri-button-menu",content:"esri-button-menu__content",contentWrapper:"esri-button-menu__content-wrapper",itemWrapper:"esri-button-menu__item-wrapper",label:"esri-button-menu__label",icon:"esri-button-menu__icon",item:"esri-button-menu__item",itemLabel:"esri-button-menu__item-label",itemLabelContent:"esri-button-menu__item-label-content",selectableMenuItem:"esri-button-menu__item--selectable",selectedMenuItem:"esri-button-menu__item--selected",checkbox:"esri-button-menu__checkbox",embeddedContentWrapper:"esri-button-menu__embedded-content-wrapper",button:"esri-button-menu__button",buttonSelected:"esri-button-menu__button--selected",defaultIconClass:"esri-icon-menu",widget:"esri-widget"};let yb=class extends $0(Ss){constructor(e,t){super(e,t),this._menuContentNode=null,this._popover=null,this._rootNode=null,this.disabled=!1,this.iconClass="",this.viewModel=new Rqe,this._handleOutsideClick=this._handleOutsideClick.bind(this)}postInitialize(){this._popover=new Qne({owner:this,open:!!this.open,placement:Fh(this.container)?"bottom-start":"bottom-end",renderContentFunction:this.renderMenuContent,anchorElement:this._rootNode}),this.handles.add(ie(()=>this.open,e=>{var t;return(t=this._popover)==null?void 0:t.set("open",e)})),document.addEventListener("click",this._handleOutsideClick)}destroy(){var e;(e=this._popover)==null||e.destroy(),this._popover=null,document.removeEventListener("click",this._handleOutsideClick)}_handleOutsideClick(e){var r,i;if(!this.open||!this._rootNode||!this._menuContentNode)return;const t=e.target;((r=this._menuContentNode)==null?void 0:r.contains(t))||((i=this._rootNode)==null?void 0:i.contains(t))||(this.open=!1)}get items(){return this.viewModel.items}set items(e){this.viewModel.items=e}get open(){return this.viewModel.open}set open(e){this.viewModel.open=e}render(){return P("div",{afterCreate:this._afterRootNodeCreate,bind:this,"data-node-ref":"_rootNode",class:this.classes(ec.base,ec.widget),key:"menu"},this.renderMenuButton())}renderMenuButton(){const{iconClass:e,id:t,label:r,open:i}=this,s=this.classes(ec.button,e!=null?e:ec.defaultIconClass,i?ec.buttonSelected:null);return P("button",{"aria-pressed":i.toString(),"aria-controls":`${t}-menu`,"aria-expanded":i.toString(),"aria-haspopup":"true","aria-label":r,bind:this,class:s,disabled:this.disabled,id:`${t}-button`,title:r!=null?r:"",selected:i,onclick:this._toggleOpen,tabindex:this.disabled?-1:0,type:"button"})}renderMenuContent(){var r;const{id:e,open:t}=this;return P("div",{afterCreate:this._afterMenuContentNodeCreate,bind:this,class:ec.content,"data-node-ref":"_menuContentNode",key:"esri-button-menu-content",hidden:!t},P("ul",{"aria-labelledby":`${e}-button`,bind:this,class:ec.itemWrapper,id:`${e}-menu`,role:"menu"},((r=this.items)==null?void 0:r.length)&&this.renderItems()))}renderItems(){var e;return(e=this.items)==null?void 0:e.map((t,r)=>this.renderItem(t,r))}renderItem(e,t,r){var o;const i=v(r)?`${this.id}-menu-item-${t}-${r}`:`${this.id}-menu-item-${t}`,s=`${i}-label`,n=this.classes(ec.item,e.selectionEnabled?ec.selectableMenuItem:null,e.selectionEnabled&&e.selected?ec.selectedMenuItem:null);return P("li",{afterCreate:this._afterMenuItemCreate,bind:this,class:n,"data-item-index":t,"data-item-subIndex":r,for:i,key:i,onkeydown:a=>this._handleMenuItemKeydown(a,e),onclick:a=>this._handleMenuItemInteraction(a,e),role:"menuitem",tabindex:this.disabled?-1:0},P("input",{disabled:!0,checked:e.selected,class:ec.checkbox,id:i,name:i,tabindex:"-1",type:"checkbox"}),P("label",{bind:this,class:this.classes(ec.button,ec.itemLabel),for:i,id:s},P("span",{class:this.classes(ec.icon,e.iconClass),"aria-hidden":"true"}),P("span",{class:ec.itemLabelContent},e.label)),P("ul",{"aria-labelledby":s,class:ec.embeddedContentWrapper,id:`${this.id}-submenu`,role:"menu"},(o=e==null?void 0:e.items)==null?void 0:o.map((a,l)=>this.renderItem(a,t,l))))}_afterRootNodeCreate(e){var t;this._rootNode=e,(t=this._popover)==null||t.set("anchorElement",()=>e)}_handleMenuItemInteraction(e,t){t.selected=!t.selected,t.open=!(!t.selected||!t.items),t.autoCloseMenu&&this.set("open",!1),t.clickFunction&&t.clickFunction({event:e,item:t}),e.stopPropagation()}_handleMenuItemKeydown(e,t){const r=Uo(e);Ow(r)&&this._handleMenuItemInteraction(e,t),r==="Escape"&&(this.open=!1,e.preventDefault(),e.stopPropagation())}_afterMenuContentNodeCreate(e){this._menuContentNode=e,e.focus()}_toggleOpen(){this.open=!this.open}_afterMenuItemCreate(e){e["data-item-index"]===0&&e.focus()}};u([h()],yb.prototype,"disabled",void 0),u([h()],yb.prototype,"iconClass",void 0),u([h()],yb.prototype,"items",null),u([h()],yb.prototype,"open",null),u([h()],yb.prototype,"viewModel",void 0),yb=u([I("esri.widgets.FeatureTable.Grid.support.ButtonMenu")],yb);const zWe=yb,VWe={heading:"esri-widget__heading"};function Sh(e,t){const r=xAe(e.level),i=`h${r}`;return delete e.level,P(i,{...e,class:mne(VWe.heading,e.class),role:"heading","aria-level":String(r)},t)}function xAe(e){return _e(Math.ceil(e),1,6)}function jWe(e,t=1){return xAe(e+t)}function xi(e){return(t,r)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}function eoe(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const r=t._delegatedEventNames,i=Array.isArray(e)?e:GWe(e);r.push(...i)}}function GWe(e){return e.split(",").map(t=>t.trim())}/**!
 * Sortable 1.15.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Mpe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,i)}return r}function v0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Mpe(Object(r),!0).forEach(function(i){HWe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mpe(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function O6(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?O6=function(t){return typeof t}:O6=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O6(e)}function HWe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gv(){return Gv=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Gv.apply(this,arguments)}function qWe(e,t){if(e==null)return{};var r={},i=Object.keys(e),s,n;for(n=0;n<i.length;n++)s=i[n],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function WWe(e,t){if(e==null)return{};var r=qWe(e,t),i,s;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(s=0;s<n.length;s++)i=n[s],!(t.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}var XWe="1.15.0";function Tv(e){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(e)}var o1=Tv(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),BF=Tv(/Edge/i),Rpe=Tv(/firefox/i),CD=Tv(/safari/i)&&!Tv(/chrome/i)&&!Tv(/android/i),TAe=Tv(/iP(ad|od|hone)/i),SAe=Tv(/chrome/i)&&Tv(/android/i),EAe={capture:!1,passive:!1};function cs(e,t,r){e.addEventListener(t,r,!o1&&EAe)}function Vi(e,t,r){e.removeEventListener(t,r,!o1&&EAe)}function xz(e,t){if(!!t){if(t[0]===">"&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch{return!1}return!1}}function YWe(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function Dy(e,t,r,i){if(e){r=r||document;do{if(t!=null&&(t[0]===">"?e.parentNode===r&&xz(e,t):xz(e,t))||i&&e===r)return e;if(e===r)break}while(e=YWe(e))}return null}var Ipe=/\s+/g;function Qd(e,t,r){if(e&&t)if(e.classList)e.classList[r?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(Ipe," ").replace(" "+t+" "," ");e.className=(i+(r?" "+t:"")).replace(Ipe," ")}}function wr(e,t,r){var i=e&&e.style;if(i){if(r===void 0)return document.defaultView&&document.defaultView.getComputedStyle?r=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(r=e.currentStyle),t===void 0?r:r[t];!(t in i)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),i[t]=r+(typeof r=="string"?"":"px")}}function MM(e,t){var r="";if(typeof e=="string")r=e;else do{var i=wr(e,"transform");i&&i!=="none"&&(r=i+" "+r)}while(!t&&(e=e.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(r)}function CAe(e,t,r){if(e){var i=e.getElementsByTagName(t),s=0,n=i.length;if(r)for(;s<n;s++)r(i[s],s);return i}return[]}function c0(){var e=document.scrollingElement;return e||document.documentElement}function Na(e,t,r,i,s){if(!(!e.getBoundingClientRect&&e!==window)){var n,o,a,l,c,d,p;if(e!==window&&e.parentNode&&e!==c0()?(n=e.getBoundingClientRect(),o=n.top,a=n.left,l=n.bottom,c=n.right,d=n.height,p=n.width):(o=0,a=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,p=window.innerWidth),(t||r)&&e!==window&&(s=s||e.parentNode,!o1))do if(s&&s.getBoundingClientRect&&(wr(s,"transform")!=="none"||r&&wr(s,"position")!=="static")){var f=s.getBoundingClientRect();o-=f.top+parseInt(wr(s,"border-top-width")),a-=f.left+parseInt(wr(s,"border-left-width")),l=o+n.height,c=a+n.width;break}while(s=s.parentNode);if(i&&e!==window){var m=MM(s||e),g=m&&m.a,_=m&&m.d;m&&(o/=_,a/=g,p/=g,d/=_,l=o+d,c=a+p)}return{top:o,left:a,bottom:l,right:c,width:p,height:d}}}function Ppe(e,t,r){for(var i=$w(e,!0),s=Na(e)[t];i;){var n=Na(i)[r],o=void 0;if(r==="top"||r==="left"?o=s>=n:o=s<=n,!o)return i;if(i===c0())break;i=$w(i,!1)}return!1}function wR(e,t,r,i){for(var s=0,n=0,o=e.children;n<o.length;){if(o[n].style.display!=="none"&&o[n]!==pr.ghost&&(i||o[n]!==pr.dragged)&&Dy(o[n],r.draggable,e,!1)){if(s===t)return o[n];s++}n++}return null}function toe(e,t){for(var r=e.lastElementChild;r&&(r===pr.ghost||wr(r,"display")==="none"||t&&!xz(r,t));)r=r.previousElementSibling;return r||null}function kp(e,t){var r=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)e.nodeName.toUpperCase()!=="TEMPLATE"&&e!==pr.clone&&(!t||xz(e,t))&&r++;return r}function $pe(e){var t=0,r=0,i=c0();if(e)do{var s=MM(e),n=s.a,o=s.d;t+=e.scrollLeft*n,r+=e.scrollTop*o}while(e!==i&&(e=e.parentNode));return[t,r]}function ZWe(e,t){for(var r in e)if(!!e.hasOwnProperty(r)){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e[r][i])return Number(r)}return-1}function $w(e,t){if(!e||!e.getBoundingClientRect)return c0();var r=e,i=!1;do if(r.clientWidth<r.scrollWidth||r.clientHeight<r.scrollHeight){var s=wr(r);if(r.clientWidth<r.scrollWidth&&(s.overflowX=="auto"||s.overflowX=="scroll")||r.clientHeight<r.scrollHeight&&(s.overflowY=="auto"||s.overflowY=="scroll")){if(!r.getBoundingClientRect||r===document.body)return c0();if(i||t)return r;i=!0}}while(r=r.parentNode);return c0()}function JWe(e,t){if(e&&t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function qH(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}var AD;function AAe(e,t){return function(){if(!AD){var r=arguments,i=this;r.length===1?e.call(i,r[0]):e.apply(i,r),AD=setTimeout(function(){AD=void 0},t)}}}function KWe(){clearTimeout(AD),AD=void 0}function OAe(e,t,r){e.scrollLeft+=t,e.scrollTop+=r}function MAe(e){var t=window.Polymer,r=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):r?r(e).clone(!0)[0]:e.cloneNode(!0)}var Ih="Sortable"+new Date().getTime();function QWe(){var e=[],t;return{captureAnimationState:function(){if(e=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(s){if(!(wr(s,"display")==="none"||s===pr.ghost)){e.push({target:s,rect:Na(s)});var n=v0({},e[e.length-1].rect);if(s.thisAnimationDuration){var o=MM(s,!0);o&&(n.top-=o.f,n.left-=o.e)}s.fromRect=n}})}},addAnimationState:function(i){e.push(i)},removeAnimationState:function(i){e.splice(ZWe(e,{target:i}),1)},animateAll:function(i){var s=this;if(!this.options.animation){clearTimeout(t),typeof i=="function"&&i();return}var n=!1,o=0;e.forEach(function(a){var l=0,c=a.target,d=c.fromRect,p=Na(c),f=c.prevFromRect,m=c.prevToRect,g=a.rect,_=MM(c,!0);_&&(p.top-=_.f,p.left-=_.e),c.toRect=p,c.thisAnimationDuration&&qH(f,p)&&!qH(d,p)&&(g.top-p.top)/(g.left-p.left)===(d.top-p.top)/(d.left-p.left)&&(l=tXe(g,f,m,s.options)),qH(p,d)||(c.prevFromRect=d,c.prevToRect=p,l||(l=s.options.animation),s.animate(c,g,p,l)),l&&(n=!0,o=Math.max(o,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(t),n?t=setTimeout(function(){typeof i=="function"&&i()},o):typeof i=="function"&&i(),e=[]},animate:function(i,s,n,o){if(o){wr(i,"transition",""),wr(i,"transform","");var a=MM(this.el),l=a&&a.a,c=a&&a.d,d=(s.left-n.left)/(l||1),p=(s.top-n.top)/(c||1);i.animatingX=!!d,i.animatingY=!!p,wr(i,"transform","translate3d("+d+"px,"+p+"px,0)"),this.forRepaintDummy=eXe(i),wr(i,"transition","transform "+o+"ms"+(this.options.easing?" "+this.options.easing:"")),wr(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){wr(i,"transition",""),wr(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},o)}}}}function eXe(e){return e.offsetWidth}function tXe(e,t,r,i){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-r.top,2)+Math.pow(t.left-r.left,2))*i.animation}var yC=[],WH={initializeByDefault:!0},zF={mount:function(t){for(var r in WH)WH.hasOwnProperty(r)&&!(r in t)&&(t[r]=WH[r]);yC.forEach(function(i){if(i.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),yC.push(t)},pluginEvent:function(t,r,i){var s=this;this.eventCanceled=!1,i.cancel=function(){s.eventCanceled=!0};var n=t+"Global";yC.forEach(function(o){!r[o.pluginName]||(r[o.pluginName][n]&&r[o.pluginName][n](v0({sortable:r},i)),r.options[o.pluginName]&&r[o.pluginName][t]&&r[o.pluginName][t](v0({sortable:r},i)))})},initializePlugins:function(t,r,i,s){yC.forEach(function(a){var l=a.pluginName;if(!(!t.options[l]&&!a.initializeByDefault)){var c=new a(t,r,t.options);c.sortable=t,c.options=t.options,t[l]=c,Gv(i,c.defaults)}});for(var n in t.options)if(!!t.options.hasOwnProperty(n)){var o=this.modifyOption(t,n,t.options[n]);typeof o<"u"&&(t.options[n]=o)}},getEventProperties:function(t,r){var i={};return yC.forEach(function(s){typeof s.eventProperties=="function"&&Gv(i,s.eventProperties.call(r[s.pluginName],t))}),i},modifyOption:function(t,r,i){var s;return yC.forEach(function(n){!t[n.pluginName]||n.optionListeners&&typeof n.optionListeners[r]=="function"&&(s=n.optionListeners[r].call(t[n.pluginName],i))}),s}};function rXe(e){var t=e.sortable,r=e.rootEl,i=e.name,s=e.targetEl,n=e.cloneEl,o=e.toEl,a=e.fromEl,l=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,p=e.newDraggableIndex,f=e.originalEvent,m=e.putSortable,g=e.extraEventProperties;if(t=t||r&&r[Ih],!!t){var _,x=t.options,b="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!o1&&!BF?_=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(_=document.createEvent("Event"),_.initEvent(i,!0,!0)),_.to=o||r,_.from=a||r,_.item=s||r,_.clone=n,_.oldIndex=l,_.newIndex=c,_.oldDraggableIndex=d,_.newDraggableIndex=p,_.originalEvent=f,_.pullMode=m?m.lastPutMode:void 0;var w=v0(v0({},g),zF.getEventProperties(i,t));for(var T in w)_[T]=w[T];r&&r.dispatchEvent(_),x[b]&&x[b].call(t,_)}}var iXe=["evt"],ku=function(t,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=i.evt,n=WWe(i,iXe);zF.pluginEvent.bind(pr)(t,r,v0({dragEl:et,parentEl:ho,ghostEl:Xr,rootEl:Fn,nextEl:JT,lastDownEl:M6,cloneEl:Yn,cloneHidden:gw,dragStarted:I3,putSortable:Tl,activeSortable:pr.active,originalEvent:s,oldIndex:GO,oldDraggableIndex:OD,newIndex:uh,newDraggableIndex:iw,hideGhostForTarget:$Ae,unhideGhostForTarget:DAe,cloneNowHidden:function(){gw=!0},cloneNowShown:function(){gw=!1},dispatchSortableEvent:function(a){Kc({sortable:r,name:a,originalEvent:s})}},n))};function Kc(e){rXe(v0({putSortable:Tl,cloneEl:Yn,targetEl:et,rootEl:Fn,oldIndex:GO,oldDraggableIndex:OD,newIndex:uh,newDraggableIndex:iw},e))}var et,ho,Xr,Fn,JT,M6,Yn,gw,GO,uh,OD,iw,m5,Tl,RA=!1,Tz=!1,Sz=[],oT,Bf,XH,YH,Dpe,Lpe,I3,_C,MD,RD=!1,g5=!1,R6,tc,ZH=[],BJ=!1,Ez=[],ej=typeof document<"u",y5=TAe,Npe=BF||o1?"cssFloat":"float",sXe=ej&&!SAe&&!TAe&&"draggable"in document.createElement("div"),RAe=function(){if(!!ej){if(o1)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto",e.style.pointerEvents==="auto"}}(),IAe=function(t,r){var i=wr(t),s=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),n=wR(t,0,r),o=wR(t,1,r),a=n&&wr(n),l=o&&wr(o),c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+Na(n).width,d=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+Na(o).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&a.float&&a.float!=="none"){var p=a.float==="left"?"left":"right";return o&&(l.clear==="both"||l.clear===p)?"vertical":"horizontal"}return n&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||c>=s&&i[Npe]==="none"||o&&i[Npe]==="none"&&c+d>s)?"vertical":"horizontal"},nXe=function(t,r,i){var s=i?t.left:t.top,n=i?t.right:t.bottom,o=i?t.width:t.height,a=i?r.left:r.top,l=i?r.right:r.bottom,c=i?r.width:r.height;return s===a||n===l||s+o/2===a+c/2},oXe=function(t,r){var i;return Sz.some(function(s){var n=s[Ih].options.emptyInsertThreshold;if(!(!n||toe(s))){var o=Na(s),a=t>=o.left-n&&t<=o.right+n,l=r>=o.top-n&&r<=o.bottom+n;if(a&&l)return i=s}}),i},PAe=function(t){function r(n,o){return function(a,l,c,d){var p=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(n==null&&(o||p))return!0;if(n==null||n===!1)return!1;if(o&&n==="clone")return n;if(typeof n=="function")return r(n(a,l,c,d),o)(a,l,c,d);var f=(o?a:l).options.group.name;return n===!0||typeof n=="string"&&n===f||n.join&&n.indexOf(f)>-1}}var i={},s=t.group;(!s||O6(s)!="object")&&(s={name:s}),i.name=s.name,i.checkPull=r(s.pull,!0),i.checkPut=r(s.put),i.revertClone=s.revertClone,t.group=i},$Ae=function(){!RAe&&Xr&&wr(Xr,"display","none")},DAe=function(){!RAe&&Xr&&wr(Xr,"display","")};ej&&!SAe&&document.addEventListener("click",function(e){if(Tz)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),Tz=!1,!1},!0);var aT=function(t){if(et){t=t.touches?t.touches[0]:t;var r=oXe(t.clientX,t.clientY);if(r){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);i.target=i.rootEl=r,i.preventDefault=void 0,i.stopPropagation=void 0,r[Ih]._onDragOver(i)}}},aXe=function(t){et&&et.parentNode[Ih]._isOutsideThisEl(t.target)};function pr(e,t){if(!(e&&e.nodeType&&e.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=Gv({},t),e[Ih]=this;var r={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return IAe(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(o,a){o.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:pr.supportPointer!==!1&&"PointerEvent"in window&&!CD,emptyInsertThreshold:5};zF.initializePlugins(this,e,r);for(var i in r)!(i in t)&&(t[i]=r[i]);PAe(t);for(var s in this)s.charAt(0)==="_"&&typeof this[s]=="function"&&(this[s]=this[s].bind(this));this.nativeDraggable=t.forceFallback?!1:sXe,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?cs(e,"pointerdown",this._onTapStart):(cs(e,"mousedown",this._onTapStart),cs(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(cs(e,"dragover",this),cs(e,"dragenter",this)),Sz.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),Gv(this,QWe())}pr.prototype={constructor:pr,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(_C=null)},_getDirection:function(t,r){return typeof this.options.direction=="function"?this.options.direction.call(this,t,r,et):this.options.direction},_onTapStart:function(t){if(!!t.cancelable){var r=this,i=this.el,s=this.options,n=s.preventOnFilter,o=t.type,a=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,l=(a||t).target,c=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,d=s.filter;if(mXe(i),!et&&!(/mousedown|pointerdown/.test(o)&&t.button!==0||s.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&CD&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Dy(l,s.draggable,i,!1),!(l&&l.animated)&&M6!==l)){if(GO=kp(l),OD=kp(l,s.draggable),typeof d=="function"){if(d.call(this,t,l,this)){Kc({sortable:r,rootEl:c,name:"filter",targetEl:l,toEl:i,fromEl:i}),ku("filter",r,{evt:t}),n&&t.cancelable&&t.preventDefault();return}}else if(d&&(d=d.split(",").some(function(p){if(p=Dy(c,p.trim(),i,!1),p)return Kc({sortable:r,rootEl:p,name:"filter",targetEl:l,fromEl:i,toEl:i}),ku("filter",r,{evt:t}),!0}),d)){n&&t.cancelable&&t.preventDefault();return}s.handle&&!Dy(c,s.handle,i,!1)||this._prepareDragStart(t,a,l)}}},_prepareDragStart:function(t,r,i){var s=this,n=s.el,o=s.options,a=n.ownerDocument,l;if(i&&!et&&i.parentNode===n){var c=Na(i);if(Fn=n,et=i,ho=et.parentNode,JT=et.nextSibling,M6=i,m5=o.group,pr.dragged=et,oT={target:et,clientX:(r||t).clientX,clientY:(r||t).clientY},Dpe=oT.clientX-c.left,Lpe=oT.clientY-c.top,this._lastX=(r||t).clientX,this._lastY=(r||t).clientY,et.style["will-change"]="all",l=function(){if(ku("delayEnded",s,{evt:t}),pr.eventCanceled){s._onDrop();return}s._disableDelayedDragEvents(),!Rpe&&s.nativeDraggable&&(et.draggable=!0),s._triggerDragStart(t,r),Kc({sortable:s,name:"choose",originalEvent:t}),Qd(et,o.chosenClass,!0)},o.ignore.split(",").forEach(function(d){CAe(et,d.trim(),JH)}),cs(a,"dragover",aT),cs(a,"mousemove",aT),cs(a,"touchmove",aT),cs(a,"mouseup",s._onDrop),cs(a,"touchend",s._onDrop),cs(a,"touchcancel",s._onDrop),Rpe&&this.nativeDraggable&&(this.options.touchStartThreshold=4,et.draggable=!0),ku("delayStart",this,{evt:t}),o.delay&&(!o.delayOnTouchOnly||r)&&(!this.nativeDraggable||!(BF||o1))){if(pr.eventCanceled){this._onDrop();return}cs(a,"mouseup",s._disableDelayedDrag),cs(a,"touchend",s._disableDelayedDrag),cs(a,"touchcancel",s._disableDelayedDrag),cs(a,"mousemove",s._delayedDragTouchMoveHandler),cs(a,"touchmove",s._delayedDragTouchMoveHandler),o.supportPointer&&cs(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(l,o.delay)}else l()}},_delayedDragTouchMoveHandler:function(t){var r=t.touches?t.touches[0]:t;Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){et&&JH(et),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;Vi(t,"mouseup",this._disableDelayedDrag),Vi(t,"touchend",this._disableDelayedDrag),Vi(t,"touchcancel",this._disableDelayedDrag),Vi(t,"mousemove",this._delayedDragTouchMoveHandler),Vi(t,"touchmove",this._delayedDragTouchMoveHandler),Vi(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,r){r=r||t.pointerType=="touch"&&t,!this.nativeDraggable||r?this.options.supportPointer?cs(document,"pointermove",this._onTouchMove):r?cs(document,"touchmove",this._onTouchMove):cs(document,"mousemove",this._onTouchMove):(cs(et,"dragend",this),cs(Fn,"dragstart",this._onDragStart));try{document.selection?I6(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,r){if(RA=!1,Fn&&et){ku("dragStarted",this,{evt:r}),this.nativeDraggable&&cs(document,"dragover",aXe);var i=this.options;!t&&Qd(et,i.dragClass,!1),Qd(et,i.ghostClass,!0),pr.active=this,t&&this._appendGhost(),Kc({sortable:this,name:"start",originalEvent:r})}else this._nulling()},_emulateDragOver:function(){if(Bf){this._lastX=Bf.clientX,this._lastY=Bf.clientY,$Ae();for(var t=document.elementFromPoint(Bf.clientX,Bf.clientY),r=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(Bf.clientX,Bf.clientY),t!==r);)r=t;if(et.parentNode[Ih]._isOutsideThisEl(t),r)do{if(r[Ih]){var i=void 0;if(i=r[Ih]._onDragOver({clientX:Bf.clientX,clientY:Bf.clientY,target:t,rootEl:r}),i&&!this.options.dragoverBubble)break}t=r}while(r=r.parentNode);DAe()}},_onTouchMove:function(t){if(oT){var r=this.options,i=r.fallbackTolerance,s=r.fallbackOffset,n=t.touches?t.touches[0]:t,o=Xr&&MM(Xr,!0),a=Xr&&o&&o.a,l=Xr&&o&&o.d,c=y5&&tc&&$pe(tc),d=(n.clientX-oT.clientX+s.x)/(a||1)+(c?c[0]-ZH[0]:0)/(a||1),p=(n.clientY-oT.clientY+s.y)/(l||1)+(c?c[1]-ZH[1]:0)/(l||1);if(!pr.active&&!RA){if(i&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(Xr){o?(o.e+=d-(XH||0),o.f+=p-(YH||0)):o={a:1,b:0,c:0,d:1,e:d,f:p};var f="matrix(".concat(o.a,",").concat(o.b,",").concat(o.c,",").concat(o.d,",").concat(o.e,",").concat(o.f,")");wr(Xr,"webkitTransform",f),wr(Xr,"mozTransform",f),wr(Xr,"msTransform",f),wr(Xr,"transform",f),XH=d,YH=p,Bf=n}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!Xr){var t=this.options.fallbackOnBody?document.body:Fn,r=Na(et,!0,y5,!0,t),i=this.options;if(y5){for(tc=t;wr(tc,"position")==="static"&&wr(tc,"transform")==="none"&&tc!==document;)tc=tc.parentNode;tc!==document.body&&tc!==document.documentElement?(tc===document&&(tc=c0()),r.top+=tc.scrollTop,r.left+=tc.scrollLeft):tc=c0(),ZH=$pe(tc)}Xr=et.cloneNode(!0),Qd(Xr,i.ghostClass,!1),Qd(Xr,i.fallbackClass,!0),Qd(Xr,i.dragClass,!0),wr(Xr,"transition",""),wr(Xr,"transform",""),wr(Xr,"box-sizing","border-box"),wr(Xr,"margin",0),wr(Xr,"top",r.top),wr(Xr,"left",r.left),wr(Xr,"width",r.width),wr(Xr,"height",r.height),wr(Xr,"opacity","0.8"),wr(Xr,"position",y5?"absolute":"fixed"),wr(Xr,"zIndex","100000"),wr(Xr,"pointerEvents","none"),pr.ghost=Xr,t.appendChild(Xr),wr(Xr,"transform-origin",Dpe/parseInt(Xr.style.width)*100+"% "+Lpe/parseInt(Xr.style.height)*100+"%")}},_onDragStart:function(t,r){var i=this,s=t.dataTransfer,n=i.options;if(ku("dragStart",this,{evt:t}),pr.eventCanceled){this._onDrop();return}ku("setupClone",this),pr.eventCanceled||(Yn=MAe(et),Yn.removeAttribute("id"),Yn.draggable=!1,Yn.style["will-change"]="",this._hideClone(),Qd(Yn,this.options.chosenClass,!1),pr.clone=Yn),i.cloneId=I6(function(){ku("clone",i),!pr.eventCanceled&&(i.options.removeCloneOnHide||Fn.insertBefore(Yn,et),i._hideClone(),Kc({sortable:i,name:"clone"}))}),!r&&Qd(et,n.dragClass,!0),r?(Tz=!0,i._loopId=setInterval(i._emulateDragOver,50)):(Vi(document,"mouseup",i._onDrop),Vi(document,"touchend",i._onDrop),Vi(document,"touchcancel",i._onDrop),s&&(s.effectAllowed="move",n.setData&&n.setData.call(i,s,et)),cs(document,"drop",i),wr(et,"transform","translateZ(0)")),RA=!0,i._dragStartId=I6(i._dragStarted.bind(i,r,t)),cs(document,"selectstart",i),I3=!0,CD&&wr(document.body,"user-select","none")},_onDragOver:function(t){var r=this.el,i=t.target,s,n,o,a=this.options,l=a.group,c=pr.active,d=m5===l,p=a.sort,f=Tl||c,m,g=this,_=!1;if(BJ)return;function x(N,B){ku(N,g,v0({evt:t,isOwner:d,axis:m?"vertical":"horizontal",revert:o,dragRect:s,targetRect:n,canSort:p,fromSortable:f,target:i,completed:w,onMove:function(W,K){return _5(Fn,r,et,s,W,Na(W),t,K)},changed:T},B))}function b(){x("dragOverAnimationCapture"),g.captureAnimationState(),g!==f&&f.captureAnimationState()}function w(N){return x("dragOverCompleted",{insertion:N}),N&&(d?c._hideClone():c._showClone(g),g!==f&&(Qd(et,Tl?Tl.options.ghostClass:c.options.ghostClass,!1),Qd(et,a.ghostClass,!0)),Tl!==g&&g!==pr.active?Tl=g:g===pr.active&&Tl&&(Tl=null),f===g&&(g._ignoreWhileAnimating=i),g.animateAll(function(){x("dragOverAnimationComplete"),g._ignoreWhileAnimating=null}),g!==f&&(f.animateAll(),f._ignoreWhileAnimating=null)),(i===et&&!et.animated||i===r&&!i.animated)&&(_C=null),!a.dragoverBubble&&!t.rootEl&&i!==document&&(et.parentNode[Ih]._isOutsideThisEl(t.target),!N&&aT(t)),!a.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),_=!0}function T(){uh=kp(et),iw=kp(et,a.draggable),Kc({sortable:g,name:"change",toEl:r,newIndex:uh,newDraggableIndex:iw,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),i=Dy(i,a.draggable,r,!0),x("dragOver"),pr.eventCanceled)return _;if(et.contains(t.target)||i.animated&&i.animatingX&&i.animatingY||g._ignoreWhileAnimating===i)return w(!1);if(Tz=!1,c&&!a.disabled&&(d?p||(o=ho!==Fn):Tl===this||(this.lastPutMode=m5.checkPull(this,c,et,t))&&l.checkPut(this,c,et,t))){if(m=this._getDirection(t,i)==="vertical",s=Na(et),x("dragOverValid"),pr.eventCanceled)return _;if(o)return ho=Fn,b(),this._hideClone(),x("revert"),pr.eventCanceled||(JT?Fn.insertBefore(et,JT):Fn.appendChild(et)),w(!0);var E=toe(r,a.draggable);if(!E||dXe(t,m,this)&&!E.animated){if(E===et)return w(!1);if(E&&r===t.target&&(i=E),i&&(n=Na(i)),_5(Fn,r,et,s,i,n,t,!!i)!==!1)return b(),E&&E.nextSibling?r.insertBefore(et,E.nextSibling):r.appendChild(et),ho=r,T(),w(!0)}else if(E&&uXe(t,m,this)){var O=wR(r,0,a,!0);if(O===et)return w(!1);if(i=O,n=Na(i),_5(Fn,r,et,s,i,n,t,!1)!==!1)return b(),r.insertBefore(et,O),ho=r,T(),w(!0)}else if(i.parentNode===r){n=Na(i);var A=0,R,D=et.parentNode!==r,k=!nXe(et.animated&&et.toRect||s,i.animated&&i.toRect||n,m),L=m?"top":"left",q=Ppe(i,"top","top")||Ppe(et,"top","top"),G=q?q.scrollTop:void 0;_C!==i&&(R=n[L],RD=!1,g5=!k&&a.invertSwap||D),A=hXe(t,i,n,m,k?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,g5,_C===i);var J;if(A!==0){var ee=kp(et);do ee-=A,J=ho.children[ee];while(J&&(wr(J,"display")==="none"||J===Xr))}if(A===0||J===i)return w(!1);_C=i,MD=A;var se=i.nextElementSibling,X=!1;X=A===1;var F=_5(Fn,r,et,s,i,n,t,X);if(F!==!1)return(F===1||F===-1)&&(X=F===1),BJ=!0,setTimeout(cXe,30),b(),X&&!se?r.appendChild(et):i.parentNode.insertBefore(et,X?se:i),q&&OAe(q,0,G-q.scrollTop),ho=et.parentNode,R!==void 0&&!g5&&(R6=Math.abs(R-Na(i)[L])),T(),w(!0)}if(r.contains(et))return w(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){Vi(document,"mousemove",this._onTouchMove),Vi(document,"touchmove",this._onTouchMove),Vi(document,"pointermove",this._onTouchMove),Vi(document,"dragover",aT),Vi(document,"mousemove",aT),Vi(document,"touchmove",aT)},_offUpEvents:function(){var t=this.el.ownerDocument;Vi(t,"mouseup",this._onDrop),Vi(t,"touchend",this._onDrop),Vi(t,"pointerup",this._onDrop),Vi(t,"touchcancel",this._onDrop),Vi(document,"selectstart",this)},_onDrop:function(t){var r=this.el,i=this.options;if(uh=kp(et),iw=kp(et,i.draggable),ku("drop",this,{evt:t}),ho=et&&et.parentNode,uh=kp(et),iw=kp(et,i.draggable),pr.eventCanceled){this._nulling();return}RA=!1,g5=!1,RD=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),zJ(this.cloneId),zJ(this._dragStartId),this.nativeDraggable&&(Vi(document,"drop",this),Vi(r,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),CD&&wr(document.body,"user-select",""),wr(et,"transform",""),t&&(I3&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),Xr&&Xr.parentNode&&Xr.parentNode.removeChild(Xr),(Fn===ho||Tl&&Tl.lastPutMode!=="clone")&&Yn&&Yn.parentNode&&Yn.parentNode.removeChild(Yn),et&&(this.nativeDraggable&&Vi(et,"dragend",this),JH(et),et.style["will-change"]="",I3&&!RA&&Qd(et,Tl?Tl.options.ghostClass:this.options.ghostClass,!1),Qd(et,this.options.chosenClass,!1),Kc({sortable:this,name:"unchoose",toEl:ho,newIndex:null,newDraggableIndex:null,originalEvent:t}),Fn!==ho?(uh>=0&&(Kc({rootEl:ho,name:"add",toEl:ho,fromEl:Fn,originalEvent:t}),Kc({sortable:this,name:"remove",toEl:ho,originalEvent:t}),Kc({rootEl:ho,name:"sort",toEl:ho,fromEl:Fn,originalEvent:t}),Kc({sortable:this,name:"sort",toEl:ho,originalEvent:t})),Tl&&Tl.save()):uh!==GO&&uh>=0&&(Kc({sortable:this,name:"update",toEl:ho,originalEvent:t}),Kc({sortable:this,name:"sort",toEl:ho,originalEvent:t})),pr.active&&((uh==null||uh===-1)&&(uh=GO,iw=OD),Kc({sortable:this,name:"end",toEl:ho,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){ku("nulling",this),Fn=et=ho=Xr=JT=Yn=M6=gw=oT=Bf=I3=uh=iw=GO=OD=_C=MD=Tl=m5=pr.dragged=pr.ghost=pr.clone=pr.active=null,Ez.forEach(function(t){t.checked=!0}),Ez.length=XH=YH=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":et&&(this._onDragOver(t),lXe(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],r,i=this.el.children,s=0,n=i.length,o=this.options;s<n;s++)r=i[s],Dy(r,o.draggable,this.el,!1)&&t.push(r.getAttribute(o.dataIdAttr)||fXe(r));return t},sort:function(t,r){var i={},s=this.el;this.toArray().forEach(function(n,o){var a=s.children[o];Dy(a,this.options.draggable,s,!1)&&(i[n]=a)},this),r&&this.captureAnimationState(),t.forEach(function(n){i[n]&&(s.removeChild(i[n]),s.appendChild(i[n]))}),r&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,r){return Dy(t,r||this.options.draggable,this.el,!1)},option:function(t,r){var i=this.options;if(r===void 0)return i[t];var s=zF.modifyOption(this,t,r);typeof s<"u"?i[t]=s:i[t]=r,t==="group"&&PAe(i)},destroy:function(){ku("destroy",this);var t=this.el;t[Ih]=null,Vi(t,"mousedown",this._onTapStart),Vi(t,"touchstart",this._onTapStart),Vi(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(Vi(t,"dragover",this),Vi(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(r){r.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Sz.splice(Sz.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!gw){if(ku("hideClone",this),pr.eventCanceled)return;wr(Yn,"display","none"),this.options.removeCloneOnHide&&Yn.parentNode&&Yn.parentNode.removeChild(Yn),gw=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(gw){if(ku("showClone",this),pr.eventCanceled)return;et.parentNode==Fn&&!this.options.group.revertClone?Fn.insertBefore(Yn,et):JT?Fn.insertBefore(Yn,JT):Fn.appendChild(Yn),this.options.group.revertClone&&this.animate(et,Yn),wr(Yn,"display",""),gw=!1}}};function lXe(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}function _5(e,t,r,i,s,n,o,a){var l,c=e[Ih],d=c.options.onMove,p;return window.CustomEvent&&!o1&&!BF?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=e,l.dragged=r,l.draggedRect=i,l.related=s||t,l.relatedRect=n||Na(t),l.willInsertAfter=a,l.originalEvent=o,e.dispatchEvent(l),d&&(p=d.call(c,l,o)),p}function JH(e){e.draggable=!1}function cXe(){BJ=!1}function uXe(e,t,r){var i=Na(wR(r.el,0,r.options,!0)),s=10;return t?e.clientX<i.left-s||e.clientY<i.top&&e.clientX<i.right:e.clientY<i.top-s||e.clientY<i.bottom&&e.clientX<i.left}function dXe(e,t,r){var i=Na(toe(r.el,r.options.draggable)),s=10;return t?e.clientX>i.right+s||e.clientX<=i.right&&e.clientY>i.bottom&&e.clientX>=i.left:e.clientX>i.right&&e.clientY>i.top||e.clientX<=i.right&&e.clientY>i.bottom+s}function hXe(e,t,r,i,s,n,o,a){var l=i?e.clientY:e.clientX,c=i?r.height:r.width,d=i?r.top:r.left,p=i?r.bottom:r.right,f=!1;if(!o){if(a&&R6<c*s){if(!RD&&(MD===1?l>d+c*n/2:l<p-c*n/2)&&(RD=!0),RD)f=!0;else if(MD===1?l<d+R6:l>p-R6)return-MD}else if(l>d+c*(1-s)/2&&l<p-c*(1-s)/2)return pXe(t)}return f=f||o,f&&(l<d+c*n/2||l>p-c*n/2)?l>d+c/2?1:-1:0}function pXe(e){return kp(et)<kp(e)?1:-1}function fXe(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,r=t.length,i=0;r--;)i+=t.charCodeAt(r);return i.toString(36)}function mXe(e){Ez.length=0;for(var t=e.getElementsByTagName("input"),r=t.length;r--;){var i=t[r];i.checked&&Ez.push(i)}}function I6(e){return setTimeout(e,0)}function zJ(e){return clearTimeout(e)}ej&&cs(document,"touchmove",function(e){(pr.active||RA)&&e.cancelable&&e.preventDefault()});pr.utils={on:cs,off:Vi,css:wr,find:CAe,is:function(t,r){return!!Dy(t,r,t,!1)},extend:JWe,throttle:AAe,closest:Dy,toggleClass:Qd,clone:MAe,index:kp,nextTick:I6,cancelNextTick:zJ,detectDirection:IAe,getChild:wR};pr.get=function(e){return e[Ih]};pr.mount=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t[0].constructor===Array&&(t=t[0]),t.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(pr.utils=v0(v0({},pr.utils),i.utils)),zF.mount(i)})};pr.create=function(e,t){return new pr(e,t)};pr.version=XWe;var ra=[],P3,VJ,jJ=!1,KH,QH,Cz,$3;function gXe(){function e(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return e.prototype={dragStarted:function(r){var i=r.originalEvent;this.sortable.nativeDraggable?cs(document,"dragover",this._handleAutoScroll):this.options.supportPointer?cs(document,"pointermove",this._handleFallbackAutoScroll):i.touches?cs(document,"touchmove",this._handleFallbackAutoScroll):cs(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(r){var i=r.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?Vi(document,"dragover",this._handleAutoScroll):(Vi(document,"pointermove",this._handleFallbackAutoScroll),Vi(document,"touchmove",this._handleFallbackAutoScroll),Vi(document,"mousemove",this._handleFallbackAutoScroll)),Fpe(),P6(),KWe()},nulling:function(){Cz=VJ=P3=jJ=$3=KH=QH=null,ra.length=0},_handleFallbackAutoScroll:function(r){this._handleAutoScroll(r,!0)},_handleAutoScroll:function(r,i){var s=this,n=(r.touches?r.touches[0]:r).clientX,o=(r.touches?r.touches[0]:r).clientY,a=document.elementFromPoint(n,o);if(Cz=r,i||this.options.forceAutoScrollFallback||BF||o1||CD){eq(r,this.options,a,i);var l=$w(a,!0);jJ&&(!$3||n!==KH||o!==QH)&&($3&&Fpe(),$3=setInterval(function(){var c=$w(document.elementFromPoint(n,o),!0);c!==l&&(l=c,P6()),eq(r,s.options,c,i)},10),KH=n,QH=o)}else{if(!this.options.bubbleScroll||$w(a,!0)===c0()){P6();return}eq(r,this.options,$w(a,!1),!1)}}},Gv(e,{pluginName:"scroll",initializeByDefault:!0})}function P6(){ra.forEach(function(e){clearInterval(e.pid)}),ra=[]}function Fpe(){clearInterval($3)}var eq=AAe(function(e,t,r,i){if(!!t.scroll){var s=(e.touches?e.touches[0]:e).clientX,n=(e.touches?e.touches[0]:e).clientY,o=t.scrollSensitivity,a=t.scrollSpeed,l=c0(),c=!1,d;VJ!==r&&(VJ=r,P6(),P3=t.scroll,d=t.scrollFn,P3===!0&&(P3=$w(r,!0)));var p=0,f=P3;do{var m=f,g=Na(m),_=g.top,x=g.bottom,b=g.left,w=g.right,T=g.width,E=g.height,O=void 0,A=void 0,R=m.scrollWidth,D=m.scrollHeight,k=wr(m),L=m.scrollLeft,q=m.scrollTop;m===l?(O=T<R&&(k.overflowX==="auto"||k.overflowX==="scroll"||k.overflowX==="visible"),A=E<D&&(k.overflowY==="auto"||k.overflowY==="scroll"||k.overflowY==="visible")):(O=T<R&&(k.overflowX==="auto"||k.overflowX==="scroll"),A=E<D&&(k.overflowY==="auto"||k.overflowY==="scroll"));var G=O&&(Math.abs(w-s)<=o&&L+T<R)-(Math.abs(b-s)<=o&&!!L),J=A&&(Math.abs(x-n)<=o&&q+E<D)-(Math.abs(_-n)<=o&&!!q);if(!ra[p])for(var ee=0;ee<=p;ee++)ra[ee]||(ra[ee]={});(ra[p].vx!=G||ra[p].vy!=J||ra[p].el!==m)&&(ra[p].el=m,ra[p].vx=G,ra[p].vy=J,clearInterval(ra[p].pid),(G!=0||J!=0)&&(c=!0,ra[p].pid=setInterval(function(){i&&this.layer===0&&pr.active._onTouchMove(Cz);var se=ra[this.layer].vy?ra[this.layer].vy*a:0,X=ra[this.layer].vx?ra[this.layer].vx*a:0;typeof d=="function"&&d.call(pr.dragged.parentNode[Ih],X,se,e,Cz,ra[this.layer].el)!=="continue"||OAe(ra[this.layer].el,X,se)}.bind({layer:p}),24))),p++}while(t.bubbleScroll&&f!==l&&(f=$w(f,!1)));jJ=c}},30),LAe=function(t){var r=t.originalEvent,i=t.putSortable,s=t.dragEl,n=t.activeSortable,o=t.dispatchSortableEvent,a=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(!!r){var c=i||n;a();var d=r.changedTouches&&r.changedTouches.length?r.changedTouches[0]:r,p=document.elementFromPoint(d.clientX,d.clientY);l(),c&&!c.el.contains(p)&&(o("spill"),this.onSpill({dragEl:s,putSortable:i}))}};function roe(){}roe.prototype={startIndex:null,dragStart:function(t){var r=t.oldDraggableIndex;this.startIndex=r},onSpill:function(t){var r=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var s=wR(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(r,s):this.sortable.el.appendChild(r),this.sortable.animateAll(),i&&i.animateAll()},drop:LAe};Gv(roe,{pluginName:"revertOnSpill"});function ioe(){}ioe.prototype={onSpill:function(t){var r=t.dragEl,i=t.putSortable,s=i||this.sortable;s.captureAnimationState(),r.parentNode&&r.parentNode.removeChild(r),s.animateAll()},drop:LAe};Gv(ioe,{pluginName:"removeOnSpill"});pr.mount(new gXe);pr.mount(ioe,roe);function yXe(e,t,r){e.splice(r,0,e.splice(t,1)[0])}const _Xe="bookmarks",lT="data-bookmark-uid",Je={base:"esri-bookmarks esri-widget--panel",loaderContainer:"esri-bookmarks__loader-container",loader:"esri-bookmarks__loader",fadeIn:"esri-bookmarks--fade-in",bookmarkList:"esri-bookmarks__list",bookmarkListSortable:"esri-bookmarks__list--sortable",bookmark:"esri-bookmarks__bookmark",bookmarkButton:"esri-bookmarks__bookmark-button",bookmarkImageContainer:"esri-bookmarks__bookmark-image-container",bookmarkEditButtonContainer:"esri-bookmarks__bookmark-edit-button-container",bookmarkEditButton:"esri-bookmarks__bookmark-edit-button",bookmarkDragHandle:"esri-bookmarks_bookmark-drag-handle",bookmarkDragHandleIcon:"esri-bookmarks_bookmark-drag-handle-icon",bookmarkIcon:"esri-bookmarks__bookmark-icon",bookmarkImage:"esri-bookmarks__image",bookmarkLabel:"esri-bookmarks__bookmark-label",bookmarkName:"esri-bookmarks__bookmark-name",bookmarkTimeExtent:"esri-bookmarks__bookmark-time-extent",bookmarkActive:"esri-bookmarks__bookmark--active",noBookmarksContainer:"esri-widget__content--empty",noBookmarksHeader:"esri-bookmarks__no-bookmarks-heading",noBookmarksIcon:"esri-widget__no-bookmark-icon",noBookmarksDescription:"esri-bookmarks__no-bookmarks-description",addingBookmark:"esri-bookmarks__adding-bookmark",addBookmark:"esri-bookmarks__add-bookmark",addBookmarkButton:"esri-bookmarks__add-bookmark-button",addBookmarkIcon:"esri-bookmarks__add-bookmark-icon",authoringCard:"esri-bookmarks__authoring-card",authoringContainer:"esri-bookmarks__authoring-container",authoringForm:"esri-bookmarks__authoring-form",authoringLabel:"esri-bookmarks__authoring-label",authoringActions:"esri-bookmarks__authoring-actions",authoringInputInvalid:"esri-bookmarks__authoring-input--invalid",authoringDeleteButton:"esri-bookmarks__authoring-delete-button",authoringCancelButton:"esri-bookmarks__authoring-cancel-button",timeExtentContainer:"esri-bookmarks__time-extent-container",timeExtent:"esri-bookmarks__time-extent",timeExtentGroup:"esri-bookmarks__time-extent-group",timeExtentDate:"esri-bookmarks__time-extent-date",timeExtentTime:"esri-bookmarks__time-extent-time",esriWidget:"esri-widget",esriWidgetDisabled:"esri-widget--disabled",esriButton:"esri-button",esriButtonTertiary:"esri-button--tertiary",esriInput:"esri-input",iconHandle:"esri-icon-handle-vertical",iconPlus:"esri-icon-plus",iconEdit:"esri-icon-edit",iconHandleHorizontal:"esri-icon-handle-horizontal",iconRefresh:"esri-icon-refresh",iconLink:"esri-icon-link",iconRemove:"esri-icon-erase",widgetIcon:"esri-icon-bookmark",header:"esri-widget__heading",loading:"esri-icon-loading-indicator",rotating:"esri-rotating"},kpe={addBookmark:!0,thumbnail:!0,time:!0},tq=/^https:\/\/.*/i,vXe="esri.widgets.Bookmarks";let yn=class extends Ss{constructor(e,t){super(e,t),this._handles=new hr,this._addInputNode=null,this._editInputNode=null,this._urlEditInputNode=null,this._addBookmarkButtonNode=null,this._focusAddBookmarkButton=!1,this._focusEditInputBox=!1,this._focusAddInputBox=!1,this._focusUrlEditInputBox=!1,this._sortable=null,this._sortableNode=null,this._focusSortUid=null,this._selectedSortUid=null,this._sortableSavedItems=null,this._editIncludeTimeExtent=null,this._userState=null,this.disabled=!1,this.editingEnabled=!1,this.headingLevel=2,this.iconClass=Je.widgetIcon,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new dAe,this.visibleElements={...kpe}}initialize(){this.addHandles([ie(()=>{var e;return(e=this.viewModel)==null?void 0:e.bookmarks},()=>this._bookmarksInitialized(),pt),ie(()=>this.editingEnabled,()=>this._toggleSorting(),pt)])}destroy(){this._destroySortable(),this._handles.destroy(),this._handles=null,this._editMenu.destroy()}loadDependencies(){return Promise.all([re(()=>import("./calcite-label.95079e09.js"),["assets/calcite-label.95079e09.js","assets/label2.941e96ef.js"]),re(()=>import("./calcite-switch.f459b419.js"),["assets/calcite-switch.f459b419.js","assets/label2.941e96ef.js","assets/form.5aa109f5.js","assets/interactive.d71a7a54.js","assets/key.eb5605f7.js"])])}get _editMenuItems(){var i,s;const{messages:e,_userState:t}=this,r=(s=(i=t==null?void 0:t.editedBookmark)==null?void 0:i.thumbnail)==null?void 0:s.url;return[new TD({label:e==null?void 0:e.menu.refreshThumbnail,iconClass:Je.iconRefresh,clickFunction:()=>this._refreshThumbnail()}),new TD({label:tq.test(r)?e==null?void 0:e.menu.editImageUrl:e==null?void 0:e.menu.useImageUrl,iconClass:Je.iconLink,clickFunction:()=>this._startUseImageUrl()}),r?new TD({label:e==null?void 0:e.menu.removeThumbnail,iconClass:Je.iconRemove,clickFunction:()=>this._removeThumbnail()}):null].filter(Boolean)}get _editMenu(){const{_editMenuItems:e,messages:t,disabled:r}=this,i=this._get("_editMenu");i&&i.destroy();const s=new zWe({disabled:r,iconClass:Je.iconHandleHorizontal,label:t==null?void 0:t.menu.label});return s.items=e,s}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultEditOptions(){return this.viewModel.defaultEditOptions}set defaultEditOptions(e){this.viewModel.defaultEditOptions=e}get bookmarks(){return this.viewModel.bookmarks}set bookmarks(e){this.viewModel.bookmarks=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...kpe,...e}}endAddBookmark(){this._userState=null}goTo(e){return this.viewModel.goTo(e)}render(){const{state:e}=this.viewModel,t=e==="loading"?this.renderLoading():this.renderBookmarks();return P("div",{class:this.classes(Je.base,Je.esriWidget,{[Je.esriWidgetDisabled]:this.disabled})},t)}startAddBookmark(){this._userState=new CJ({state:"add"}),this._focusAddInputBox=!0,this.scheduleRender()}renderLoading(){return P("div",{class:Je.loaderContainer,key:"loader",tabIndex:this.disabled?-1:null},P("div",{class:Je.loader}))}renderNoBookmarksContainer(){const{messages:e,disabled:t}=this;return P("div",{class:Je.noBookmarksContainer,key:"no-bookmarks",tabIndex:t?-1:null},P("span",{"aria-hidden":"true",class:this.classes(Je.noBookmarksIcon,Je.widgetIcon)}),P(Sh,{level:this.headingLevel,class:this.classes(Je.header,Je.noBookmarksHeader)},e==null?void 0:e.noBookmarksHeading),P("p",{class:Je.noBookmarksDescription},e==null?void 0:e.noBookmarksDescription))}renderAddBookmarkLoading(){var e;return P("div",{key:"adding-bookmark",class:Je.addingBookmark},P("span",{"aria-hidden":"true",class:this.classes(Je.loading,Je.rotating)}),(e=this.messages)==null?void 0:e.addingBookmark)}renderBookmarkItems(e){if(!e)return null;const{_userState:t,editingEnabled:r}=this;return e.map(i=>r&&i&&t&&(t.state==="edit"||t.state==="edit-thumbnail")&&t.bookmark===i?t.state==="edit-thumbnail"?this.renderEditingBookmarkUrl(t.editedBookmark):this.renderEditingBookmark(t.editedBookmark):this.renderBookmark(i)).toArray()}renderBookmarksContainer(e){var a;const{_userState:t,editingEnabled:r,disabled:i}=this,s=(t==null?void 0:t.state)==="add",n=r&&!s?this.renderAddBookmarkButton():null,o=r?s&&t.loading?this.renderAddBookmarkLoading():(t==null?void 0:t.state)==="add"?this.renderAddingBookmark():null:null;return[P("ul",{key:"bookmark-list","aria-label":(a=this.messages)==null?void 0:a.widgetLabel,class:this.classes(Je.bookmarkList,{[Je.bookmarkListSortable]:this.editingEnabled}),afterCreate:this._sortNodeCreated,afterRemoved:this._destroySortable,"data-node-ref":"_sortableNode",bind:this,tabIndex:i?-1:null},this.renderBookmarkItems(e)),n,o]}renderAddBookmarkButton(){var e;return this.visibleElements.addBookmark?P("div",{key:"add-bookmark-item",class:Je.addBookmark},P("button",{class:this.classes(Je.esriButton,Je.esriButtonTertiary,Je.addBookmarkButton),disabled:this.disabled,onclick:this.startAddBookmark,afterCreate:this._storeAddBookmarkButton,afterUpdate:this._storeAddBookmarkButton,"data-node-ref":"_addBookmarkButtonNode",bind:this,type:"button"},P("span",{"aria-hidden":"true",class:this.classes(Je.addBookmarkIcon,Je.iconPlus)}),(e=this.messages)==null?void 0:e.addBookmark)):null}renderBookmarks(){const{bookmarks:e}=this.viewModel,t=e&&e.filter(Boolean),r=t&&t.length,i=r||this.editingEnabled?this.renderBookmarksContainer(t):null;return[r?null:this.renderNoBookmarksContainer(),i]}renderEditContainer(e){const{messagesCommon:t,disabled:r}=this,i=this._getBookmarkTitle(e);return P("div",{class:Je.bookmarkEditButtonContainer,key:"edit-container"},P("button",{disabled:r,title:`${t==null?void 0:t.edit} ${i}`,"aria-label":`${t==null?void 0:t.edit} ${i}`,"data-bookmark":e,onclick:this._showEditBookmarkForm,bind:this,class:Je.bookmarkEditButton,type:"button"},P("span",{"aria-hidden":"true",class:Je.iconEdit})))}renderDragHandle(e){const{messagesCommon:t,disabled:r}=this,i=this._getBookmarkTitle(e),s={[lT]:e.uid};return P("div",{role:"button",tabIndex:r?-1:0,key:"drag-handle",bind:this,class:Je.bookmarkDragHandle,onkeydown:this._dragHandleKeydown,afterCreate:this._focusDragHandle,afterUpdate:this._focusDragHandle,onblur:this._dragHandleBlur,"aria-pressed":this._selectedSortUid===e.uid?"true":"false","aria-label":`${t==null?void 0:t.dragHandleTitle} ${i}`,title:`${t==null?void 0:t.dragHandleTitle} ${i}`,...s},P("span",{"aria-hidden":"true",class:this.classes(Je.bookmarkDragHandleIcon,Je.iconHandle)}))}renderBookmarkImageIcon(){return P("span",{"aria-hidden":"true",class:this.classes(Je.bookmarkIcon,Je.widgetIcon)})}renderBookmarkImage(e){const{visibleElements:t}=this,{thumbnail:r}=e,i=r&&r.url||"";return t.thumbnail&&i?P("img",{src:i,alt:"",class:Je.bookmarkImage}):null}renderBookmarkTimeSwitch(e){const{messages:t,disabled:r}=this,{timeExtent:i}=e,{view:s}=this.viewModel;return s.timeExtent||i?P("calcite-label",{layout:"inline-space-between","disable-spacing":"true"},t.includeTimeExtent,P("calcite-switch",{scale:"s",disabled:r,checked:!!i,onCalciteSwitchChange:n=>this._editIncludeTimeExtent=!!n.detail.switched})):null}renderBookmarkTimeExtent(e){const{visibleElements:t}=this,{timeExtent:r}=e;return r?P("span",{class:Je.timeExtent},[v(r.start)&&P("span",{key:"start-date-group",class:Je.timeExtentGroup},P("span",{key:"start-date",class:Je.timeExtentDate},this._formatDate(r.start)),t.time&&P("span",{key:"start-time",class:Je.timeExtentTime},this._formatTime(r.start))),v(r.end)&&(C(r.start)||r.start.getTime()!==r.end.getTime())&&P("span",{key:"end-date-group",class:Je.timeExtentGroup},P("span",{key:"end-date",class:Je.timeExtentDate},this._formatDate(r.end)),t.time&&P("span",{key:"end-time",class:Je.timeExtentTime},this._formatTime(r.end)))]):null}renderBookmarkButton(e){const{disabled:t}=this,{timeExtent:r}=e,{abilities:i}=this.viewModel,s=this._getBookmarkTitle(e),n=P("div",{class:Je.bookmarkImageContainer},this.renderBookmarkImage(e)||this.renderBookmarkImageIcon()),o=i.time&&r?P("span",{key:"time-extent",class:Je.bookmarkTimeExtent},this.renderBookmarkTimeExtent(e)):null;return P("button",{disabled:t,key:"bookmark-button",class:Je.bookmarkButton,bind:this,"data-bookmark":e,onclick:this._goToBookmark,type:"button"},n,P("div",{class:Je.bookmarkLabel},P("span",{key:"bookmark-title",class:Je.bookmarkName},s),o))}renderBookmark(e){const{activeBookmark:t}=this.viewModel,r={[Je.bookmarkActive]:t===e},i=this.editingEnabled?this.renderEditContainer(e):null,s={[lT]:e.uid},n=this.editingEnabled?this.renderDragHandle(e):null;return P("li",{key:e,class:this.classes(Je.bookmark,r),...s},n,this.renderBookmarkButton(e),i)}renderEditingBookmarkName(e){const{messages:t,_userState:r,disabled:i}=this,s=r.validationState==="name-required";return P("label",{class:Je.authoringLabel},t==null?void 0:t.title,s?P("strong",null,t==null?void 0:t.invalidTitle):null,P("input",{required:!0,disabled:i,bind:this,class:this.classes(Je.esriInput,s?Je.authoringInputInvalid:null),type:"text",value:e.name,afterCreate:this._storeEditInput,afterUpdate:this._focusEditInput,"data-bookmark":e,"data-node-ref":"_editInputNode",placeholder:t==null?void 0:t.titlePlaceholder}))}renderEditingBookmarkUrlActions(){const{messagesCommon:e,disabled:t}=this;return P("div",{class:Je.authoringActions},P("input",{type:"button",disabled:t,value:e==null?void 0:e.back,class:this.classes(Je.esriButton,Je.esriButtonTertiary),onclick:this._closeUrlEditBookmarkForm,bind:this}),P("input",{class:Je.esriButton,disabled:t,type:"submit",value:e==null?void 0:e.add}))}renderEditingBookmarkActions(){const{messagesCommon:e,disabled:t}=this,{bookmark:r}=this._userState;return P("div",{class:Je.authoringActions},P("input",{type:"button",disabled:t,value:e==null?void 0:e.delete,class:this.classes(Je.esriButton,Je.esriButtonTertiary,Je.authoringDeleteButton),"data-bookmark":r,onclick:this._deleteBookmark,bind:this}),P("input",{disabled:t,type:"button",value:e==null?void 0:e.cancel,class:this.classes(Je.esriButton,Je.esriButtonTertiary),onclick:this._closeEditBookmarkForm,bind:this}),P("input",{class:Je.esriButton,disabled:t,type:"submit",value:e==null?void 0:e.save}))}renderEditingBookmarkUrlInput(e){var a;const{messages:t,_userState:r,disabled:i}=this,s=(a=e.thumbnail)==null?void 0:a.url,n=tq.test(s)?s:null,o=r.validationState==="absolute-url-required";return P("label",{class:Je.authoringLabel},o?P("strong",null,t==null?void 0:t.invalidImageUrl):null,P("input",{required:!0,disabled:i,bind:this,class:this.classes(Je.esriInput,o?Je.authoringInputInvalid:null),type:"text",value:n,afterCreate:this._storeUrlEditInput,afterUpdate:this._focusUrlEditInput,"data-bookmark":e,"data-node-ref":"_urlEditInputNode",title:t==null?void 0:t.imageUrlTooltip,placeholder:t&&`https://<${t.imageUrlPlaceholder}>`}))}renderEditingBookmarkUrl(e){const t={[lT]:e.uid};return P("li",{key:"edit-bookmark-url-form",class:Je.authoringCard,...t},P("form",{class:Je.authoringForm,disabled:this.disabled,onsubmit:this._editBookmarkUrlSubmit,bind:this},this.renderEditingBookmarkUrlInput(e),this.renderEditingBookmarkUrlActions()))}renderEditingBookmark(e){const t={[lT]:e.uid},{abilities:r}=this.viewModel,i=r.time?P("div",{key:"edit-bookmark-time-container",class:Je.timeExtentContainer},this.renderBookmarkTimeSwitch(e),this._editIncludeTimeExtent&&this.renderBookmarkTimeExtent(e)):null;return P("li",{key:"edit-bookmark-form",class:Je.authoringCard,...t},P("form",{class:Je.authoringForm,disabled:this.disabled,onsubmit:this._editBookmarkSubmit,bind:this},P("div",{class:Je.authoringContainer},P("div",{class:Je.bookmarkImageContainer},this.renderBookmarkImage(e),this._editMenu.render()),this.renderEditingBookmarkName(e)),i,this.renderEditingBookmarkActions()))}renderAddingBookmarkName(){const{_userState:e,messages:t,disabled:r}=this,i=e.validationState==="name-required";return P("label",{class:Je.authoringLabel},t==null?void 0:t.title,i?P("strong",null,t==null?void 0:t.invalidTitle):null,P("input",{required:!0,disabled:r,bind:this,class:this.classes(Je.esriInput,i?Je.authoringInputInvalid:null),type:"text",afterCreate:this._storeAddInput,afterUpdate:this._focusAddInput,"data-node-ref":"_addInputNode",value:"",placeholder:t==null?void 0:t.titlePlaceholder}))}renderAddingBookmarkActions(){const{messagesCommon:e,disabled:t}=this;return P("div",{class:this.classes(Je.authoringActions)},P("input",{type:"button",disabled:t,value:e==null?void 0:e.cancel,class:this.classes(Je.esriButton,Je.esriButtonTertiary,Je.authoringCancelButton),onclick:this._endAddBookmark.bind(this),bind:this}),P("input",{class:Je.esriButton,disabled:t,type:"submit",value:e==null?void 0:e.add}))}renderAddingBookmark(){return P("div",{key:"add-bookmark-form",class:Je.authoringCard},P("form",{class:Je.authoringForm,onsubmit:this._addBookmarkSubmit,bind:this},this.renderAddingBookmarkName(),this.renderAddingBookmarkActions()))}_getBookmarkTitle(e){var t;return e.name||((t=this.messagesCommon)==null?void 0:t.untitled)}_formatDate(e){return e?_s(e,iE("short-date")):null}_formatTime(e){return e?_s(e,iE("long-time")):null}_dragHandleBlur(){this._selectedSortUid=null,this.scheduleRender()}_dragHandleKeydown(e){const{_sortableSavedItems:t}=this,r=["ArrowDown","ArrowUp","Escape","Tab"," ","Enter"],i=Uo(e);if(!r.includes(i))return;const{_sortable:s,_selectedSortUid:n}=this,o=s.toArray(),a=e.target.getAttribute(lT),l=o.indexOf(a);if(Ow(i)){const d=n&&n===a;return this._selectedSortUid=d?null:a,this._sortableSavedItems=d?null:this._sortable.toArray(),void this.scheduleRender()}if(i==="Tab")return this._selectedSortUid=null,void this.scheduleRender();if(i==="Escape"&&t)return e.stopPropagation(),this._selectedSortUid=null,this._updateSortItems(t,s,a),void this.scheduleRender();if(l===-1||!n)return;const c=i==="ArrowUp"?l-1:l+1;c>=o.length||c<=-1||(yXe(o,l,c),this._updateSortItems(o,s,a))}_updateSortItems(e,t,r){t.sort(e),this._sortBookmarks(t),this._focusSortUid=r,this._selectedSortUid=r}_focusDragHandle(e){const{_focusSortUid:t}=this;!e||!t||e.getAttribute(lT)===t&&(e.focus(),this._focusSortUid=null)}_toggleSorting(){const{_sortable:e,_sortableNode:t,editingEnabled:r,disabled:i}=this;if(t)if(e)e.option("disabled",i||!r);else{const s=pr.create(t,{dataIdAttr:lT,handle:`.${Je.bookmarkDragHandle}`,group:_Xe,disabled:i||!r,onSort:()=>this._sortBookmarks(s)});this._sortable=s}}_sortNodeCreated(e){this._sortableNode=e,this._toggleSorting()}_sortBookmarks(e){const{bookmarks:t}=this.viewModel;if(!t)return;const r=e.toArray();t.sort((i,s)=>{const n=r.indexOf(i.uid),o=r.indexOf(s.uid);return n>o?1:n<o?-1:0})}_destroySortable(){const{_sortable:e}=this;e&&e.destroy(),this._sortable=null}_endAddBookmark(){this._focusAddBookmarkButton=!0,this.endAddBookmark()}_bookmarksInitialized(){const e="bookmarks-init",{_handles:t}=this;t.remove(e),t.add(ms(()=>{var r;return(r=this.viewModel)==null?void 0:r.bookmarks},"change",()=>this._bookmarksChanged()),e)}_bookmarksChanged(){const e="bookmarks-change",{bookmarks:t}=this.viewModel,{_handles:r}=this;r.remove(e);const i=t.map(s=>ie(()=>{var n;return[s==null?void 0:s.name,(n=s==null?void 0:s.thumbnail)==null?void 0:n.url]},()=>this.scheduleRender()));r.add(i,e),this.scheduleRender()}_showEditBookmarkForm(e){const t=e.currentTarget["data-bookmark"];this._editIncludeTimeExtent=!!t.timeExtent,this._focusEditInputBox=!0,this._userState=new CJ({bookmark:t,state:"edit"}),this.viewModel.goTo(t),this.scheduleRender()}_closeUrlEditBookmarkForm(){this._focusEditInputBox=!0,this._userState.state="edit"}_closeEditBookmarkForm(){this._userState=null}_addBookmarkSubmit(e){e.preventDefault();const{_addInputNode:t,_userState:r}=this,i=t&&t.value.trim();i?(r.loading=!0,this.viewModel.createBookmark().then(s=>{s.name=i,this.viewModel.bookmarks.add(s),this._endAddBookmark()})):r.validationState="name-required"}async _editBookmarkAndClose(e,t){const{viewModel:r}=this;await r.editBookmark(e,{...r.defaultEditOptions,...t}),this._closeEditBookmarkForm()}_editBookmarkSubmit(e){e.preventDefault();const{_editInputNode:t,_userState:r,_editIncludeTimeExtent:i}=this,s=t&&t.value.trim();s?(r.bookmark.name=s,r.bookmark.thumbnail=r.editedBookmark.thumbnail,i||(r.bookmark.timeExtent=null),this._editBookmarkAndClose(r.bookmark,{takeScreenshot:!1,captureTimeExtent:i})):r.validationState="name-required"}_storeAddBookmarkButton(e){this._addBookmarkButtonNode=e,this._focusAddBookmark()}_storeEditInput(e){this._editInputNode=e,this._focusEditInput()}_storeAddInput(e){this._addInputNode=e,this._focusAddInput()}_storeUrlEditInput(e){this._urlEditInputNode=e,this._focusUrlEditInput()}_focusUrlEditInput(){this._urlEditInputNode&&this._focusUrlEditInputBox&&(this._focusUrlEditInputBox=!1,this._urlEditInputNode.focus())}_focusAddInput(){this._addInputNode&&this._focusAddInputBox&&(this._focusAddInputBox=!1,this._addInputNode.focus())}_focusAddBookmark(){this._addBookmarkButtonNode&&this._focusAddBookmarkButton&&(this._focusAddBookmarkButton=!1,this._addBookmarkButtonNode.focus())}_focusEditInput(){this._editInputNode&&this._focusEditInputBox&&(this._focusEditInputBox=!1,this._editInputNode.focus())}_deleteBookmark(e){const t=e.currentTarget["data-bookmark"];this.viewModel.bookmarks.remove(t)}_goToBookmark(e){const t=e.currentTarget["data-bookmark"];this.endAddBookmark(),this._closeEditBookmarkForm(),this.viewModel.goTo(t)}async _refreshThumbnail(){const{_userState:e,_editMenu:t,viewModel:r}=this;e.validationState=void 0,await r.editBookmark(this._userState.editedBookmark,{takeScreenshot:!0,captureViewpoint:!1,captureRotation:!1,captureScale:!1,captureTimeExtent:!1}),t.open=!1,this._focusEditInputBox=!0,this.scheduleRender()}_removeThumbnail(){const{_userState:e,_editMenu:t}=this;e.editedBookmark.thumbnail=null,e.validationState=void 0,t.open=!1,this._focusEditInputBox=!0,this.scheduleRender()}_startUseImageUrl(){this._userState.state="edit-thumbnail",this._editMenu.open=!1,this._focusUrlEditInputBox=!0,this.scheduleRender()}_editBookmarkUrlSubmit(e){e.preventDefault();const{_urlEditInputNode:t,_userState:r}=this,i=t.value;tq.test(i)?(i&&(r.editedBookmark.thumbnail=new xv({url:i})),this._closeUrlEditBookmarkForm()):r.validationState="absolute-url-required"}};u([h()],yn.prototype,"_editIncludeTimeExtent",void 0),u([h({type:CJ})],yn.prototype,"_userState",void 0),u([h({readOnly:!0})],yn.prototype,"_editMenuItems",null),u([h({readOnly:!0})],yn.prototype,"_editMenu",null),u([h()],yn.prototype,"defaultCreateOptions",null),u([h()],yn.prototype,"defaultEditOptions",null),u([h()],yn.prototype,"bookmarks",null),u([h()],yn.prototype,"disabled",void 0),u([h()],yn.prototype,"editingEnabled",void 0),u([h()],yn.prototype,"headingLevel",void 0),u([h()],yn.prototype,"goToOverride",null),u([h()],yn.prototype,"iconClass",void 0),u([h()],yn.prototype,"label",null),u([h(),xi("esri/widgets/Bookmarks/t9n/Bookmarks")],yn.prototype,"messages",void 0),u([h(),xi("esri/t9n/common")],yn.prototype,"messagesCommon",void 0),u([h(),xi("esri/core/t9n/Units")],yn.prototype,"messagesUnits",void 0),u([h()],yn.prototype,"uiStrings",void 0),u([h()],yn.prototype,"view",null),u([h({type:dAe}),eoe(["select-bookmark","bookmark-edit","bookmark-select"])],yn.prototype,"viewModel",void 0),u([h()],yn.prototype,"visibleElements",void 0),u([Gt("visibleElements")],yn.prototype,"castVisibleElements",null),u([h()],yn.prototype,"endAddBookmark",null),u([h()],yn.prototype,"startAddBookmark",null),yn=u([I(vXe)],yn);let _b=class extends be{constructor(e){super(e),this._viewpointHandle=null,this._handles=new hr,this.group=null}initialize(){this._handles.add(ms(()=>{var e;return(e=this.view)==null?void 0:e.ui},"expand",e=>{const{target:t}=e;t&&t!==this&&t.expanded&&t.group&&t.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const t=!!e;this._set("expanded",t);const r=this.get("view.ui");r&&r.emit("expand",{target:this}),this._viewpointHandleChange(t)}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&no(()=>e.ready,()=>{this.view===e&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?no(()=>this.view.stationary,()=>this._viewpointHandle.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this._handles.remove(e),this._viewpointHandle=null;const{autoCollapse:t,view:r}=this;if(r&&t){const i=Zze(()=>r.type==="3d"?r.camera:r.viewpoint,()=>this._collapse());this._handles.add(i,e),this._viewpointHandle=i}}_collapse(){this.expanded=!1}};u([h({value:!1})],_b.prototype,"autoCollapse",null),u([h({value:!1})],_b.prototype,"expanded",null),u([h()],_b.prototype,"group",void 0),u([h({readOnly:!0})],_b.prototype,"state",null),u([h({value:null})],_b.prototype,"view",null),_b=u([I("esri.widgets.Expand.ExpandViewModel")],_b);const NAe=_b;function An(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:wXe(e[t])}}}function bXe(e){const{type:t}=e;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function wXe(e){return function(t,...r){bXe(t)?Ow(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...r)}}const FAe="calcite-theme-";function xXe(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function Az(){return xXe().startsWith("dark")}function TXe(){return`${FAe}${Az()?"dark":"light"}`}function SXe(e){EXe(e),e.classList.add(TXe())}function EXe(e){Array.from(e.classList).forEach(t=>{t.startsWith(FAe)&&e.classList.remove(t)})}function Oz(e){return e&&typeof e.render=="function"}function kAe(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}const Zo={base:"esri-expand esri-widget",modeAuto:"esri-expand--auto",modeDrawer:"esri-expand--drawer",modeFloating:"esri-expand--floating",container:"esri-expand__container",containerExpanded:"esri-expand__container--expanded",panel:"esri-expand__panel",button:"esri-widget--button",text:"esri-icon-font-fallback-text",icon:"esri-collapse__icon",iconExpanded:"esri-expand__icon--expanded",iconNumber:"esri-expand__icon-number",iconNumberExpanded:"esri-expand__icon-number--expanded",expandIcon:"esri-icon-expand",collapseIcon:"esri-icon-collapse",content:"esri-expand__content",contentExpanded:"esri-expand__content--expanded",expandMask:"esri-expand__mask",expandMaskExpanded:"esri-expand__mask--expanded"};let po=class extends Ss{constructor(e,t){super(e,t),this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expandTooltip="",this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.viewModel=new NAe,this._handleKeyDown=r=>{const{closeOnEsc:i,_toggleButtonEl:s,expanded:n}=this;!n||!i||r.target===s||r.key!=="Escape"||(typeof i=="function"?i(r):i)&&(this.expanded=!1,s==null||s.focus())}}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:t,collapseTooltip:r,expandTooltip:i}=this;return e?r||t.collapse:i||t.expand}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(e){this.viewModel.autoCollapse=e}get collapseIconClass(){return Zo.collapseIcon}set collapseIconClass(e){this._overrideIfSome("collapseIconClass",e)}get expanded(){return this.viewModel.expanded}set expanded(e){this.viewModel.expanded=e}get expandIconClass(){return Oz(this.content)?this.content.iconClass:Zo.expandIcon}set expandIconClass(e){this._overrideIfSome("expandIconClass",e)}get group(){return this.viewModel.group}set group(e){this.viewModel.group=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:e}=this,t={[Zo.modeAuto]:e==="auto",[Zo.modeDrawer]:e==="drawer",[Zo.modeFloating]:e==="floating"};return P("div",{class:this.classes(Zo.base,t),onkeydown:this._handleKeyDown},this.renderMask(),this.renderContainer())}renderContainer(){const{expanded:e}=this,t={[Zo.containerExpanded]:e};return P("div",{class:this.classes(Zo.container,t)},this.renderPanel(),this.renderContent())}renderMask(){const{expanded:e}=this,t={[Zo.expandMaskExpanded]:e};return P("div",{bind:this,onclick:this._toggle,class:this.classes(Zo.expandMask,t)})}renderBadgeNumber(){const{expanded:e,iconNumber:t}=this;return t&&!e?P("span",{key:"expand__icon-number",class:Zo.iconNumber},t):null}renderPanelNumber(){const{iconNumber:e,expanded:t}=this;return e&&t?P("span",{key:"expand__expand-icon-number",class:this.classes(Zo.iconNumber,Zo.iconNumberExpanded)},e):null}renderIcon(){const{collapseIconClass:e,expandIconClass:t,expanded:r}=this,i={[Zo.iconExpanded]:r,[e]:r,[t]:!r};return e===t&&(i[e]=!0),P("span",{"aria-hidden":"true",class:this.classes(Zo.icon,i)})}renderTitle(){return P("span",{class:Zo.text},this.expandTitle)}renderExpandButton(){const{expanded:e,expandTitle:t,contentId:r}=this;return P("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":r,"aria-expanded":e?"true":"false",bind:this,class:Zo.button,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabindex:"0",title:t},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())}renderPanel(){return P("div",{class:Zo.panel},this.renderExpandButton(),this.renderPanelNumber())}renderContent(){const{expanded:e,contentId:t,content:r}=this,i={[Zo.contentExpanded]:e},s={id:t,role:"region",class:this.classes(Zo.content,i)};return typeof r=="string"?P("div",{key:"content__string",innerHTML:r,...s}):Oz(r)?P("div",{key:"content__widget",...s},r.render()):r instanceof HTMLElement?P("div",{key:"content__html-element",bind:r,afterCreate:this._attachToNode,...s}):kAe(r)?P("div",{key:"content__node",bind:r.domNode,afterCreate:this._attachToNode,...s}):null}_toggle(){this.toggle()}_attachToNode(e){const t=this;e.appendChild(t)}_storeToggleButtonEl(e){this._toggleButtonEl=e}};u([h({readOnly:!0})],po.prototype,"contentId",null),u([h({readOnly:!0})],po.prototype,"expandTitle",null),u([h()],po.prototype,"autoCollapse",null),u([h()],po.prototype,"closeOnEsc",void 0),u([h()],po.prototype,"collapseIconClass",null),u([h()],po.prototype,"collapseTooltip",void 0),u([h()],po.prototype,"content",void 0),u([h()],po.prototype,"expanded",null),u([h()],po.prototype,"expandIconClass",null),u([h()],po.prototype,"expandTooltip",void 0),u([h()],po.prototype,"group",null),u([h()],po.prototype,"iconNumber",void 0),u([h()],po.prototype,"label",null),u([h(),xi("esri/widgets/Expand/t9n/Expand")],po.prototype,"messages",void 0),u([h(),xi("esri/t9n/common")],po.prototype,"messagesCommon",void 0),u([h()],po.prototype,"mode",void 0),u([h()],po.prototype,"view",null),u([h({type:NAe})],po.prototype,"viewModel",void 0),u([An()],po.prototype,"_toggle",null),po=u([I("esri.widgets.Expand")],po);const rq=po;function hE(e,t,r=Ge){return t||(t=new r),t===e||(t.removeAll(),CXe(e)?t.addMany(e):e&&t.add(e)),t}function UAe(e){return e}function CXe(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const AXe="not-loaded",OXe="loading",MXe="failed",Upe="loaded",BAe=e=>{let t=class extends e{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=Use(n,l);this.destroyed&&l(new z("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===AXe){this._set("loadStatus",OXe);const a=this._loadController=new AbortController;s({signal:a.signal}),jl(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",Upe),this._loadController=null},i=>{this._set("loadStatus",MXe),this._set("loadError",i),this._loadController=null})}get loaded(){return this.loadStatus===Upe}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new z("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return u([h({readOnly:!0})],t.prototype,"loaded",null),u([h({readOnly:!0})],t.prototype,"loadError",void 0),u([h({clonable:!1})],t.prototype,"loadStatus",void 0),u([h({type:[Ou],readOnly:!0})],t.prototype,"loadWarnings",null),t=u([I("esri.core.Loadable")],t),t};let D3=class extends BAe(az){};D3=u([I("esri.core.Loadable")],D3),function(e){function t(r){return!(!r||!r.load)}e.LoadableMixin=BAe,e.isLoadable=t}(D3||(D3={}));const Hv=D3;function tj(e,t,r){return zo(e.map((i,s)=>t.apply(r,[i,s])))}async function RXe(e,t,r){return(await zo(e.map((i,s)=>t.apply(r,[i,s])))).map(i=>i.value)}function soe(e){return{ok:!0,value:e}}function noe(e){return{ok:!1,error:e}}function IXe(e){return v(e)&&e.ok===!0?e.value:null}function PXe(e){return v(e)&&e.ok===!1?e.error:null}async function Jh(e){if(C(e))return{ok:!1,error:new Error("no promise provided")};try{return soe(await e)}catch(t){return noe(t)}}async function $Ut(e){try{return soe(await e)}catch(t){return zh(t),noe(t)}}function DUt(e){if(e.ok===!0)return e.value;throw e.error}function VF(e,t){return new vb(e,t)}let vb=class extends be{constructor(e,t){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=lg(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(i=>{this._result=soe(i),this._cleanup()},i=>{this._result=noe(i),this._cleanup()}),this._abortHandle=jl(t,this.abort)}get value(){return IXe(this._result)}get error(){return PXe(this._result)}get finished(){return v(this._result)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Gs(this._abortHandle),this._abortController=null}};u([h()],vb.prototype,"value",null),u([h()],vb.prototype,"error",null),u([h()],vb.prototype,"finished",null),u([h()],vb.prototype,"promise",void 0),u([h()],vb.prototype,"_result",void 0),vb=u([I("esri.core.asyncUtils.ReactiveTask")],vb);async function zAe(e,t){return await e.load(),$Xe(e,t)}async function $Xe(e,t){const r=[],i=(...n)=>{for(const o of n)C(o)||(Array.isArray(o)?i(...o):Ge.isCollection(o)?o.forEach(a=>i(a)):Hv.isLoadable(o)&&r.push(o))};t(i);let s=null;if(await RXe(r,async n=>{(await Jh(DXe(n)?n.loadAll():n.load())).ok!==!1||s||(s=n)}),s)throw s.loadError;return e}function DXe(e){return"loadAll"in e&&typeof e.loadAll=="function"}var GJ;const LXe=new gr({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Sp=GJ=class extends be{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new GJ({categories:this.categories?ne(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let r,i;if(this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o)),this.extent){const o=QE(this.extent,Ve.WGS84);v(o)&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:r,bbox:i,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>LXe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...t,...n}}}};u([h()],Sp.prototype,"categories",void 0),u([h()],Sp.prototype,"disableExtraQuery",void 0),u([h({type:Sr})],Sp.prototype,"extent",void 0),u([h()],Sp.prototype,"filter",void 0),u([h()],Sp.prototype,"num",void 0),u([h()],Sp.prototype,"query",void 0),u([h()],Sp.prototype,"sortField",void 0),u([h()],Sp.prototype,"sortOrder",null),u([h()],Sp.prototype,"start",void 0),Sp=GJ=u([I("esri.portal.PortalQueryParams")],Sp);const cv=Sp;let KT=class extends be{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([h()],KT.prototype,"nextQueryParams",void 0),u([h()],KT.prototype,"queryParams",void 0),u([h()],KT.prototype,"results",void 0),u([h()],KT.prototype,"total",void 0),KT=u([I("esri.portal.PortalQueryResult")],KT);const NXe=KT;let y_=class extends fe{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new z("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([h({type:Date})],y_.prototype,"created",void 0),u([h()],y_.prototype,"id",void 0),u([h()],y_.prototype,"portal",void 0),u([h()],y_.prototype,"title",void 0),u([h({readOnly:!0})],y_.prototype,"url",null),u([h()],y_.prototype,"username",void 0),y_=u([I("esri.portal.PortalFolder")],y_);const FXe=y_;let wa=class extends fe{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var r;const e=this.url,t=this.thumbnail;return e&&t&&this.portal?(r=this.portal)==null?void 0:r._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return gd(this.portal)._request(this.url+"/categorySchema",e).then(t=>{const r=t.categorySchema||[];return r.some(i=>i.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):r})}fetchMembers(e){return gd(this.portal)._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new z("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let r=ts(cv,e);const i=gd(this.portal);return parseFloat(i.currentVersion)>5?(r=r||new cv,i._queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",t)):(r=r?r.clone():new cv,r.query="group:"+this.id+(r.query?" "+r.query:""),i.queryItems(r,t))}_fetchCategorySchemaSet(e,t){const r=gd(this.portal);return r._fetchSelf(r.authMode,!0,t).then(i=>{const s=i.contentCategorySetsGroupQuery;if(s){const n=new cv;return n.disableExtraQuery=!0,n.num=1,n.query=s,r.queryGroups(n,t)}throw new z("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const s=i.results[0],n=new cv;return n.num=1,n.query=`typekeywords:"${e}"`,s.queryItems(n,t)}throw new z("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(s=>{const n=s&&s.categorySchema;return n&&n.length?n:[]}):[])}};u([h()],wa.prototype,"access",void 0),u([h({type:Date})],wa.prototype,"created",void 0),u([h()],wa.prototype,"description",void 0),u([h()],wa.prototype,"id",void 0),u([h()],wa.prototype,"isInvitationOnly",void 0),u([h({type:Date})],wa.prototype,"modified",void 0),u([h()],wa.prototype,"owner",void 0),u([h()],wa.prototype,"portal",void 0),u([h()],wa.prototype,"snippet",void 0),u([h()],wa.prototype,"sortField",void 0),u([h()],wa.prototype,"sortOrder",void 0),u([h()],wa.prototype,"tags",void 0),u([h()],wa.prototype,"thumbnail",void 0),u([h({readOnly:!0})],wa.prototype,"thumbnailUrl",null),u([h()],wa.prototype,"title",void 0),u([h({readOnly:!0})],wa.prototype,"url",null),wa=u([I("esri.portal.PortalGroup")],wa);const HJ=wa,kXe=Object.freeze(Object.defineProperty({__proto__:null,default:HJ},Symbol.toStringTag,{value:"Module"}));var qJ;let rn=qJ=class extends fe{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,r=e&&e.data,i=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),r!=null&&(typeof r=="string"?s.query.text=r:typeof r=="object"&&(s.query.text=JSON.stringify(r))));let n=this.userContentUrl;return i&&(n+="/"+(typeof i=="string"?i:i.id)),this.portal._request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",r=e.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal._request(t,i).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){var t;const e={query:{num:1}};return this.portal._request((t=this.userContentUrl)!=null?t:"",e).then(r=>{let i;return i=r&&r.folders?r.folders.map(s=>{const n=FXe.fromJSON(s);return n.portal=this.portal,n}):[],i})}fetchGroups(){var e;return this.portal._request((e=this.url)!=null?e:"").then(t=>{let r;return r=t&&t.groups?t.groups.map(i=>{const s=HJ.fromJSON(i);return s.portal=this.portal,s}):[],r})}fetchItems(e){var s;const t=e!=null?e:{};let r,i=(s=this.userContentUrl)!=null?s:"";return t.folder&&(i+="/"+t.folder.id),re(()=>Promise.resolve().then(()=>VAe),void 0).then(({default:n})=>{r=n;const o={folders:!1,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"};return this.portal._request(i,{query:o})}).then(n=>{let o;return n&&n.items?(o=n.items.map(a=>{const l=r.fromJSON(a);return l.portal=this.portal,l}),Promise.all(o.map(a=>a.load())).catch(a=>a).then(()=>({items:o,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new HJ({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new z("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new z("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new qJ;return t.sourceJSON=e,t.read(e),t}};u([h()],rn.prototype,"access",void 0),u([h({type:Date})],rn.prototype,"created",void 0),u([h()],rn.prototype,"culture",void 0),u([h()],rn.prototype,"description",void 0),u([h()],rn.prototype,"email",void 0),u([h()],rn.prototype,"favGroupId",void 0),u([h()],rn.prototype,"fullName",void 0),u([h({type:Date})],rn.prototype,"modified",void 0),u([h()],rn.prototype,"orgId",void 0),u([h()],rn.prototype,"portal",void 0),u([h()],rn.prototype,"preferredView",void 0),u([h()],rn.prototype,"privileges",void 0),u([h()],rn.prototype,"region",void 0),u([h()],rn.prototype,"role",void 0),u([h()],rn.prototype,"roleId",void 0),u([h()],rn.prototype,"sourceJSON",void 0),u([h()],rn.prototype,"thumbnail",void 0),u([h({readOnly:!0})],rn.prototype,"thumbnailUrl",null),u([h()],rn.prototype,"units",void 0),u([h({readOnly:!0})],rn.prototype,"userContentUrl",null),u([h({readOnly:!0})],rn.prototype,"url",null),u([h()],rn.prototype,"username",void 0),u([h()],rn.prototype,"userType",void 0),rn=qJ=u([I("esri.portal.PortalUser")],rn);const ooe=rn,UXe=Object.freeze(Object.defineProperty({__proto__:null,default:ooe},Symbol.toStringTag,{value:"Module"}));var eh;let iq;const Bpe={PortalGroup:()=>re(()=>Promise.resolve().then(()=>kXe),void 0),PortalItem:()=>re(()=>Promise.resolve().then(()=>VAe),void 0),PortalUser:()=>re(()=>Promise.resolve().then(()=>UXe),void 0)};let We=eh=class extends xI(Hv){constructor(e){super(e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Gr.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriIdCredentialCreateHandle=Gs(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)Gr.request.trustedServers.includes(t)||Gr.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=ooe.fromJSON(e),t.portal=this),t}load(e){const t=re(()=>Promise.resolve().then(()=>KXe),void 0).then(({default:r})=>{Ir(e),iq=r}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e)).then(r=>{if(pn){const i=pn;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==eh.AUTH_MODE_AUTO||(this._esriIdCredentialCreateHandle=i.on("credential-create",()=>{i.findCredential(this.restUrl)&&this._signIn().catch(()=>{})}))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await re(()=>import("./ElevationLayer.26c29f95.js"),["assets/ElevationLayer.26c29f95.js","assets/ArcGISCachedService.4421d10e.js","assets/TilemapCache.57a5f6cf.js"])).default;return e?e.map(r=>new t({id:r.id,url:r.url})):[]}fetchBasemaps(e,t){const r=new cv;return r.query=e||(Gr.apiKey&&mEe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0,this.queryGroups(r,t).then(i=>{if(r.num=100,r.query='type:"Web Map" -type:"Web Application"',i.total){const s=i.results[0];return r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc",s.queryItems(r,t)}return null}).then(i=>{let s;return s=i&&i.total?i.results.filter(n=>n.type==="Web Map").map(n=>new iq({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):Bo(e)?Promise.reject(oi()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,r=new cv;if(r.num=100,r.sortField="title",t&&t.length){const i=[];for(const s of t)i.push(`(title:"${s.title}" AND owner:${s.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,e).then(s=>s.results)}return Bo(e)?Promise.reject(oi()):Promise.resolve([])}fetchRegions(e){var r;const t=((r=this.user)==null?void 0:r.culture)||this.culture||fl();return this._request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){var r;const t=((r=this.user)==null?void 0:r.culture)||this.culture||fl();return this._request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return eh._default&&!eh._default.destroyed||(eh._default=new eh),eh._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new z("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new eh({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new z("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!(t!=null&&t.url))throw new z("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,r){const i=this.restUrl+"/portals/self",s={authMode:e,query:{culture:fl().toLowerCase()},...r};return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(i,s)}_queryPortal(e,t,r,i){const s=ts(cv,t),n=o=>this._request(this.restUrl+e,{...s.toRequestOptions(this),...i}).then(a=>{const l=s.clone();return l.start=a.nextStart,new NXe({nextQueryParams:l,queryParams:s,total:a.total,results:eh._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(zh(l),a)));return r&&Bpe[r]?Bpe[r]().then(({default:o})=>(Ir(i),n(o))):n()}_signIn(){if(this.authMode===eh.AUTH_MODE_ANONYMOUS)return Promise.reject(new z("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this._fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this._fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return pn?pn.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,r){return this._request(e,t).then(i=>{const s=eh._resultsToTypedArray(r,{portal:this},i);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():i)).then(()=>s,()=>s)})}_readBasemap(e){if(e){const t=iq.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const r={f:"json",...t.query},{authMode:i=this.authMode===eh.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:i,body:s,cacheBust:n,method:o,query:r,responseType:a,timeout:0,signal:l};return lr(this._normalizeSSL(e),c).then(d=>d.data)}static _resultsToTypedArray(e,t,r,i){let s;if(r){const n=v(i)?i.signal:null;s=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};We.AUTH_MODE_ANONYMOUS="anonymous",We.AUTH_MODE_AUTO="auto",We.AUTH_MODE_IMMEDIATE="immediate",u([h()],We.prototype,"access",void 0),u([h()],We.prototype,"allSSL",void 0),u([h()],We.prototype,"authMode",void 0),u([h()],We.prototype,"authorizedCrossOriginDomains",void 0),u([me("authorizedCrossOriginDomains")],We.prototype,"readAuthorizedCrossOriginDomains",null),u([h()],We.prototype,"basemapGalleryGroupQuery",void 0),u([h()],We.prototype,"bingKey",void 0),u([h()],We.prototype,"canListApps",void 0),u([h()],We.prototype,"canListData",void 0),u([h()],We.prototype,"canListPreProvisionedItems",void 0),u([h()],We.prototype,"canProvisionDirectPurchase",void 0),u([h()],We.prototype,"canSearchPublic",void 0),u([h()],We.prototype,"canShareBingPublic",void 0),u([h()],We.prototype,"canSharePublic",void 0),u([h()],We.prototype,"canSignInArcGIS",void 0),u([h()],We.prototype,"canSignInIDP",void 0),u([h()],We.prototype,"colorSetsGroupQuery",void 0),u([h()],We.prototype,"commentsEnabled",void 0),u([h({type:Date})],We.prototype,"created",void 0),u([h()],We.prototype,"credential",void 0),u([h()],We.prototype,"culture",void 0),u([h()],We.prototype,"currentVersion",void 0),u([h()],We.prototype,"customBaseUrl",void 0),u([h()],We.prototype,"defaultBasemap",void 0),u([me("defaultBasemap")],We.prototype,"readDefaultBasemap",null),u([h()],We.prototype,"defaultDevBasemap",void 0),u([me("defaultDevBasemap")],We.prototype,"readDefaultDevBasemap",null),u([h({type:Sr})],We.prototype,"defaultExtent",void 0),u([h()],We.prototype,"defaultVectorBasemap",void 0),u([me("defaultVectorBasemap")],We.prototype,"readDefaultVectorBasemap",null),u([h()],We.prototype,"description",void 0),u([h()],We.prototype,"devBasemapGalleryGroupQuery",void 0),u([h()],We.prototype,"eueiEnabled",void 0),u([h({readOnly:!0})],We.prototype,"extraQuery",null),u([h()],We.prototype,"featuredGroups",void 0),u([h()],We.prototype,"featuredItemsGroupQuery",void 0),u([h()],We.prototype,"galleryTemplatesGroupQuery",void 0),u([h()],We.prototype,"livingAtlasGroupQuery",void 0),u([h()],We.prototype,"hasCategorySchema",void 0),u([h()],We.prototype,"helpBase",void 0),u([h()],We.prototype,"helperServices",void 0),u([h()],We.prototype,"helpMap",void 0),u([h()],We.prototype,"homePageFeaturedContent",void 0),u([h()],We.prototype,"homePageFeaturedContentCount",void 0),u([h()],We.prototype,"httpPort",void 0),u([h()],We.prototype,"httpsPort",void 0),u([h()],We.prototype,"id",void 0),u([h()],We.prototype,"ipCntryCode",void 0),u([h({readOnly:!0})],We.prototype,"isOrganization",null),u([h()],We.prototype,"isPortal",void 0),u([h()],We.prototype,"isReadOnly",void 0),u([h({readOnly:!0})],We.prototype,"itemPageUrl",null),u([h()],We.prototype,"layerTemplatesGroupQuery",void 0),u([h()],We.prototype,"maxTokenExpirationMinutes",void 0),u([h({type:Date})],We.prototype,"modified",void 0),u([h()],We.prototype,"name",void 0),u([h()],We.prototype,"portalHostname",void 0),u([h()],We.prototype,"portalMode",void 0),u([h()],We.prototype,"portalProperties",void 0),u([h()],We.prototype,"region",void 0),u([h({readOnly:!0})],We.prototype,"restUrl",null),u([h()],We.prototype,"rotatorPanels",void 0),u([h()],We.prototype,"showHomePageDescription",void 0),u([h()],We.prototype,"sourceJSON",void 0),u([h()],We.prototype,"staticImagesUrl",void 0),u([h({json:{name:"2DStylesGroupQuery"}})],We.prototype,"stylesGroupQuery2d",void 0),u([h({json:{name:"stylesGroupQuery"}})],We.prototype,"stylesGroupQuery3d",void 0),u([h()],We.prototype,"supportsHostedServices",void 0),u([h()],We.prototype,"symbolSetsGroupQuery",void 0),u([h()],We.prototype,"templatesGroupQuery",void 0),u([h()],We.prototype,"thumbnail",void 0),u([h({readOnly:!0})],We.prototype,"thumbnailUrl",null),u([h()],We.prototype,"units",void 0),u([h()],We.prototype,"url",void 0),u([h()],We.prototype,"urlKey",void 0),u([me("urlKey")],We.prototype,"readUrlKey",null),u([h()],We.prototype,"user",void 0),u([me("user")],We.prototype,"readUser",null),u([h()],We.prototype,"useStandardizedQuery",void 0),u([h()],We.prototype,"useVectorBasemaps",void 0),u([h()],We.prototype,"vectorBasemapGalleryGroupQuery",void 0),We=eh=u([I("esri.portal.Portal")],We);const oo=We;let bb=class extends be{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){v(e)&&Rd(e)?te.getLogger(this.declaredClass).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const r=this.url;if(C(r))throw new z("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:Ks(t,"signal")})}async update(e,t){return(await re(()=>Promise.resolve().then(()=>c$),void 0)).addOrUpdateResource(this,"update",e,t)}hasPath(){return v(this.path)}_normalizePath(e,t){return C(e)?e:(e=e.replace(/^\/+/,""),v(t)&&Rd(e)&&(e=ane(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([h()],bb.prototype,"portalItem",void 0),u([h({type:String,value:null})],bb.prototype,"path",null),u([Gt("path")],bb.prototype,"_castPath",null),u([h({type:String,readOnly:!0})],bb.prototype,"url",null),u([h({type:String,readOnly:!0})],bb.prototype,"itemRelativeUrl",null),bb=u([I("esri.portal.PortalItemResource")],bb);const BXe=bb;let L3=class extends be{constructor(e){super(e),this.created=null,this.rating=null}};u([h()],L3.prototype,"created",void 0),u([h()],L3.prototype,"rating",void 0),L3=u([I("esri.portal.PortalRating")],L3);const sq=L3;var IA;const zXe=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),VXe=new Set(["KML","GeoJson","CSV"]);let kr=IA=class extends xI(Hv){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return rE(IA,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return e==="Feature Service"||e==="Feature Collection"?r=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?r=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?r="Scene Layer":e==="Video Service"?r="Video Layer":e==="Scene Package"?r="Scene Layer Package":e==="Stream Service"?r="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?r=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?r="Locator":e==="Geoenrichment Service"?r="GeoEnrichment Service":e==="Microsoft Powerpoint"?r="Microsoft PowerPoint":e==="GeoJson"?r="GeoJSON":e==="Globe Service"?r="Globe Layer":e==="Vector Tile Service"?r="Tile Layer":e==="netCDF"?r="NetCDF":e==="Map Service"?r=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?r=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?r="Big Data File Share":e==="Compact Tile Package"?r="Tile Package (tpkx)":e==="OGCFeatureServer"?r="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")&&(r="Instant App"),r}readExtent(e){return e&&e.length?new Sr(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],r="esri/images/portal/",i="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,d=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),d=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":d?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="pro report template"?"proreporttemplate":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"||e==="notebook code snippet library"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":e==="discussion"?"discussion":"maps",s?ui(r+s+i+".png"):null}get isLayer(){return this.type!=null&&zXe.has(this.type)}get itemPageUrl(){var t;const e=(t=this.portal)==null?void 0:t.itemPageUrl;return e&&this.id?`${e}?id=${this.id}`:null}get itemUrl(){var t;const e=(t=this.portal)==null?void 0:t.restUrl;return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){var r,i;const e=this.itemUrl,t=this.thumbnail;return e&&t&&(i=(r=this.portal)==null?void 0:r._normalizeUrl(`${e}/info/${t}?f=json`))!=null?i:null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){var i;const t=(i=this.portal)!=null?i:this.portal=oo.getDefault(),r=t.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?t._request(this.itemUrl,{signal:v(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(s=>{this.sourceJSON=s,this.read(s)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(e){const t={method:"post",query:{}};return e instanceof sq&&(e=e.rating),e==null||isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal?(await this.portal._request(this.itemUrl+"/addRating",t),new sq({rating:e,created:new Date})):null}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:ne(this.applicationProxies),avgRating:this.avgRating,categories:ne(this.categories),created:ne(this.created),culture:this.culture,description:this.description,extent:ne(this.extent),groupCategories:ne(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ne(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ne(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:ne(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ne(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new IA({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const r of["tags","typeKeywords","categories"])e[r]&&(e[r]=e[r].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}async deleteRating(){await gd(this.portal)._request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(e="json",t){return gd(this.portal)._request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}async fetchRating(e){const t=await gd(this.portal)._request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e});return t.rating!=null?(t.created=new Date(t.created),new sq(t)):null}fetchRelatedItems(e,t){return gd(this.portal)._requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},IA)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){var e;return gd(this.portal)._request((e=this.itemUrl)!=null?e:"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(e){return this.id?this.load().then(()=>gd(this.portal)._signIn()).then(()=>{const t=e&&e.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?r.query.text=t:typeof t=="object"&&(r.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new z("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e.thumbnail,r=e.filename,i={method:"post"};if(typeof t=="string")R0(t)?i.query={data:t}:i.query={url:Rh(t)},v(r)&&(i.query.filename=r);else{const s=new FormData;v(r)?s.append("file",t,r):s.append("file",t),i.body=s}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new z("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await re(()=>Promise.resolve().then(()=>c$),void 0)).fetchResources(this,e,t)}async addResource(e,t,r){const i=await re(()=>Promise.resolve().then(()=>c$),void 0);return e.portalItem=this,i.addOrUpdateResource(e,"add",t,r)}async removeResource(e,t){const r=await re(()=>Promise.resolve().then(()=>c$),void 0);if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new z("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r.removeResource(this,e,t)}async removeAllResources(e){return(await re(()=>Promise.resolve().then(()=>c$),void 0)).removeAllResources(this,e)}resourceFromPath(e){return new BXe({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:ne(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:ne(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ne(this.typeKeywords),url:this.url};return JSe(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new IA({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};u([h({type:["private","shared","org","public"]})],kr.prototype,"access",void 0),u([h()],kr.prototype,"accessInformation",void 0),u([h({type:String})],kr.prototype,"apiKey",void 0),u([h({json:{read:{source:"appProxies"}}})],kr.prototype,"applicationProxies",void 0),u([h()],kr.prototype,"avgRating",void 0),u([h()],kr.prototype,"categories",void 0),u([h({type:Date})],kr.prototype,"created",void 0),u([h()],kr.prototype,"culture",void 0),u([h()],kr.prototype,"description",void 0),u([h({readOnly:!0})],kr.prototype,"displayName",null),u([h({type:Sr})],kr.prototype,"extent",void 0),u([me("extent")],kr.prototype,"readExtent",null),u([h()],kr.prototype,"groupCategories",void 0),u([h({readOnly:!0})],kr.prototype,"iconUrl",null),u([h()],kr.prototype,"id",void 0),u([h({readOnly:!0})],kr.prototype,"isLayer",null),u([h()],kr.prototype,"itemControl",void 0),u([h({readOnly:!0})],kr.prototype,"itemPageUrl",null),u([h({readOnly:!0})],kr.prototype,"itemUrl",null),u([h()],kr.prototype,"licenseInfo",void 0),u([h({type:Date})],kr.prototype,"modified",void 0),u([h()],kr.prototype,"name",void 0),u([h()],kr.prototype,"numComments",void 0),u([h()],kr.prototype,"numRatings",void 0),u([h()],kr.prototype,"numViews",void 0),u([h()],kr.prototype,"owner",void 0),u([h()],kr.prototype,"ownerFolder",void 0),u([h({type:oo})],kr.prototype,"portal",void 0),u([h()],kr.prototype,"screenshots",void 0),u([h()],kr.prototype,"size",void 0),u([h()],kr.prototype,"snippet",void 0),u([h()],kr.prototype,"sourceJSON",void 0),u([h({type:String})],kr.prototype,"spatialReference",void 0),u([h()],kr.prototype,"tags",void 0),u([h()],kr.prototype,"thumbnail",void 0),u([h({readOnly:!0})],kr.prototype,"thumbnailUrl",null),u([h()],kr.prototype,"title",void 0),u([h()],kr.prototype,"type",void 0),u([h()],kr.prototype,"typeKeywords",void 0),u([h({type:String,json:{read(e,t){var r;if(VXe.has(t.type)){const i=(r=this.portal)==null?void 0:r.restUrl;e||(e=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return e}}})],kr.prototype,"url",void 0),u([h({readOnly:!0})],kr.prototype,"userItemUrl",null),kr=IA=u([I("esri.portal.PortalItem")],kr);const pE=kr,VAe=Object.freeze(Object.defineProperty({__proto__:null,default:pE},Symbol.toStringTag,{value:"Module"}));async function jXe(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,r=await rne("esri/t9n/basemaps");return r[e]||r[t]}const WJ={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return ui("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return ui("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return ui("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return ui("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return ui("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return ui("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return ui("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return ui("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return ui("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return ui("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return ui("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return ui("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return ui("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return ui("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return ui("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return ui("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};function ID(e){const t=e==null?void 0:e.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function zpe(e){return(e==null?void 0:e.type)==="voxel"}function Vpe(e){return(e==null?void 0:e.type)==="imagery-tile"}function jAe(e){var t;return((t=e.parent)==null?void 0:t.declaredClass)==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function aoe(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function LUt(e){var t;return(e==null?void 0:e.type)==="feature"&&((t=e.source)==null?void 0:t.type)==="feature-layer"}function XJ(e){return e.labelsVisible===!0&&e.labelingInfo!=null&&e.labelingInfo.length>0}function GXe(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const r=e.activeLayer.tileMatrixSets;if(r)return r}return null}const HXe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),qXe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function WXe(e){return e.layerContainerType==="basemap"?HXe:e.layerContainerType==="operational-layers"?qXe:null}function XXe(e,t){if(t.restrictedWebMapWriting){const r=WXe(t);return!v(r)||r.has(e.type)&&!aoe(e)}return!0}function YXe(e,t){if(aoe(e)){const r=ZE("featureCollection.layers",t),i=r&&r[0]&&r[0].layerDefinition;i&&nq(e,i)}else e.type==="stream"?nq(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&nq(e,t)}function nq(e,t){"maxScale"in e&&(t.maxScale=rz(e.maxScale)),"minScale"in e&&(t.minScale=rz(e.minScale))}function ZXe(e,t){if(YXe(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=rz(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts")if(aoe(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function jpe(e,t,r){if(!("write"in e)||!e.write)return r&&r.messages&&r.messages.push(new z("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(XXe(e,r)){const i={};return e.write(i,r)?i:null}return v(t)&&ZXe(e,t=ne(t)),t}var $6;let JXe=0;const GAe="esri.Basemap";let Ep=$6=class extends xI(Hv){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+JXe++,this.baseLayers=new Ge,this.referenceLayers=new Ge;const t=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&te.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.baseLayers.on("after-add",i=>t(i.item)),this.referenceLayers.on("after-add",i=>t(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(e=>{te.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const e=this.baseLayers.removeAll();for(const i of e)i.destroy();const t=this.referenceLayers.removeAll();for(const i of t)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",hE(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const i=[];e&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=jpe(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);v(n)&&i.push(n)}),this.referenceLayers.forEach(s=>{const n=jpe(s,r.webmap?r.webmap.getLayerJSONFromResourceInfo(s):null,r);v(n)&&(n.isReference=!0,i.push(n))})),t.baseMapLayers=i}set referenceLayers(e){this._set("referenceLayers",hE(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return zAe(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new $6({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=ne(r);return i.url&&y0(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&y0(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r}=this;Ir(e);const i=[];if(t){const s=t.context?t.context.url:null;if(i.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;i.push(jXe(n).then(o=>{o&&this.read({title:o},t.context)}))}}else r&&i.push(this._loadFromItem(r,e));await Promise.all(i)}async _loadLayersFromJSON(e,t,r){const i=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||i&&i.portal||null,n=i&&i.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await re(()=>import("./layersCreator.2f8580f8.js"),["assets/layersCreator.2f8580f8.js","assets/lazyLayerLoader.cca980e7.js","assets/portalLayers.c4cfe435.js","assets/layersLoader.e3596b12.js","assets/jsonContext.df83b33f.js"]),a=[];if(Ir(r),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=o(this.baseLayers,e.baseMapLayers.filter(p=>!p.isReference),l);a.push(c);const d=o(this.referenceLayers,e.baseMapLayers.filter(p=>p.isReference),l);a.push(d)}await zo(a)}async _loadFromItem(e,t){var n,o;const r=await e.load(t),i=await r.fetchData("json",t),s=Wa((n=e.itemUrl)!=null?n:"");return this._set("resourceInfo",{data:(o=i.baseMap)!=null?o:{},context:{origin:"web-map",portal:e.portal||oo.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||oo.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=WJ[e];if(t){if(t.deprecated){let r=null;e==="dark-gray"?r="dark-gray-vector":e==="gray"?r="gray-vector":e==="streets"?r="streets-vector":e==="topo"&&(r="topo-vector"),j8(te.getLogger(GAe),`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return $6.fromJSON(t)}return null}};u([h({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,i){this._writeBaseLayers(e,t,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Ge}},writer(e,t,r,i){this._writeBaseLayers(e,t,i)}}}}}})],Ep.prototype,"baseLayers",null),u([h({type:String,json:{origins:{"web-scene":{write:!0}}}})],Ep.prototype,"id",void 0),u([h({type:pE})],Ep.prototype,"portalItem",void 0),u([h()],Ep.prototype,"referenceLayers",null),u([h({readOnly:!0})],Ep.prototype,"resourceInfo",void 0),u([h({type:Ve})],Ep.prototype,"spatialReference",void 0),u([h()],Ep.prototype,"thumbnailUrl",void 0),u([h({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Ep.prototype,"title",void 0),u([Le("title")],Ep.prototype,"writeTitle",null),Ep=$6=u([I(GAe)],Ep);const Mz=Ep,KXe=Object.freeze(Object.defineProperty({__proto__:null,default:Mz},Symbol.toStringTag,{value:"Module"})),Rz={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function HAe(e){return Rz[e]||Rz[e.toLowerCase()]}function loe(e){var t;return(t=Rz[e])!=null?t:Rz[e.toLowerCase()]}function QXe(e){return[...loe(e)]}function oq(e,t,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?e+(t-e)*i:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function qAe(e,t,r,i=1){const s=(e%360+360)%360/360,n=r<=.5?r*(t+1):r+t-r*t,o=2*r-n;return[Math.round(255*oq(o,n,s+1/3)),Math.round(255*oq(o,n,s)),Math.round(255*oq(o,n,s-1/3)),i]}function eYe(e){const t=e.length>5,r=t?8:4,i=(1<<r)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&i,o>>=r,a[3]=s*l/255),l=o&i,o>>=r,a[2]=s*l,l=o&i,o>>=r,a[1]=s*l,l=o&i,o>>=r,a[0]=s*l,a}function v5(e){return _e(qse(e),0,255)}function b5(e,t,r){return e=Number(e),isNaN(e)?r:e<t?t:e>r?r:e}class Po{constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}static blendColors(t,r,i,s=new Po){return s.r=Math.round(t.r+(r.r-t.r)*i),s.g=Math.round(t.g+(r.g-t.g)*i),s.b=Math.round(t.b+(r.b-t.b)*i),s.a=t.a+(r.a-t.a)*i,s._sanitize()}static fromRgb(t,r){const i=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const s=i[2].split(/\s*,\s*/),n=i[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Po.fromArray(a,r)}return Po.fromArray(s.map(a=>parseFloat(a)),r)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Po.fromArray(qAe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),r)}return null}static fromHex(t,r=new Po){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const i=t.length===4?4:8,s=(1<<i)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(t,r=new Po){return r._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(t,r){const i=HAe(t)?loe(t):null;return i&&Po.fromArray(i,r)||Po.fromRgb(t,r)||Po.fromHex(t,r)}static fromJSON(t){return t&&new Po([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return v(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return v(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){var r,i,s,n;return typeof t=="string"?Po.fromString(t,this):Array.isArray(t)?Po.fromArray(t,this):(this._set((r=t.r)!=null?r:0,(i=t.g)!=null?i:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof Po||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${t.length<2?"0"+t:t}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(t=!1){const r=this.r+", "+this.g+", "+this.b;return t?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=Po.AlphaMode.ALWAYS){const r=v5(this.r),i=v5(this.g),s=v5(this.b);return t===Po.AlphaMode.ALWAYS||this.a!==1?[r,i,s,v5(255*this.a)]:[r,i,s]}clone(){return new Po(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return v(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(b5(this.r,0,255)),this.g=Math.round(b5(this.g,0,255)),this.b=Math.round(b5(this.b,0,255)),this.a=b5(this.a,0,1),this}_set(t,r,i,s){this.r=t,this.g=r,this.b=i,this.a=s}}Po.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(Po||(Po={}));const Ze=Po;function NUt(e){}function tYe(e){return()=>e}function Ue(e,t={}){var s;const r=e instanceof gr?e:new gr(e,t),i={type:(s=t==null?void 0:t.ignoreUnknown)==null||s?r.apiValues:String,json:{type:r.jsonValues,read:!(t!=null&&t.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(i.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(i.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(i.json.name=t.name),h(i)}var YJ;let D6=YJ=class extends fe{constructor(e){super(e),this.type="none"}clone(){return new YJ({type:this.type})}};u([Ue({none:"none",stayAbove:"stay-above"})],D6.prototype,"type",void 0),D6=YJ=u([I("esri.ground.NavigationConstraint")],D6);let sn=class extends be{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.TERRAIN_USE_LEGACY_SHADING=!1}};u([h()],sn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([h()],sn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([h()],sn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([h()],sn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([h()],sn.prototype,"LABELS_SHOW_BORDER",void 0),u([h()],sn.prototype,"TEXT_SHOW_BASELINE",void 0),u([h()],sn.prototype,"TEXT_SHOW_BORDER",void 0),u([h()],sn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([h()],sn.prototype,"OVERLAY_SHOW_CENTER",void 0),u([h()],sn.prototype,"SHOW_POI",void 0),u([h()],sn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([h()],sn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([h()],sn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([h()],sn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([h()],sn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([h()],sn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([h()],sn.prototype,"I3S_TREE_SHOW_TILES",void 0),u([h()],sn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([h()],sn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([h()],sn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([h()],sn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([h()],sn.prototype,"LINE_WIREFRAMES",void 0),u([h()],sn.prototype,"TERRAIN_USE_LEGACY_SHADING",void 0),sn=u([I("esri.views.3d.support.DebugFlags")],sn);const hi=new sn;function rj(e){const t=qse(100*(1-e));return Math.max(0,Math.min(t,100))}function xR(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}var ZJ;let iy=ZJ=class extends xI(Hv){constructor(e){super(e),this.opacity=1,this.shading=!hi.TERRAIN_USE_LEGACY_SHADING,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Ge;const t=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&te.getLogger(this.declaredClass).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.layers.on("after-add",i=>t(i.item)),this.layers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(e=>{te.getLogger(this.declaredClass).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",hE(e,this._get("layers")))}writeLayers(e,t,r,i){const s=[];e&&(i={...i,layerContainerType:"ground"},e.forEach(n=>{if("write"in n){const o={};tYe(n)().write(o,i)&&s.push(o)}else i&&i.messages&&i.messages.push(new z("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return zAe(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:r}=await re(()=>import("./ElevationQuery.dc2d5dea.js"),[]);Ir(t);const i=new r,s=this.layers.filter(Gpe).toArray();return i.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:r}=await re(()=>import("./ElevationQuery.dc2d5dea.js"),[]);Ir(t);const i=new r,s=this.layers.filter(Gpe).toArray();return i.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:ne(this.surfaceColor),navigationConstraint:ne(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new ZJ({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}_loadLayersFromJSON(e,t,r){const i=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return re(()=>import("./layersCreator.2f8580f8.js"),["assets/layersCreator.2f8580f8.js","assets/lazyLayerLoader.cca980e7.js","assets/portalLayers.c4cfe435.js","assets/layersLoader.e3596b12.js","assets/jsonContext.df83b33f.js"]).then(({populateOperationalLayers:o})=>{Ir(r);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:i,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return zo(a)}).then(()=>{})}};function rYe(e){return e&&"createElevationSampler"in e}function Gpe(e){return e.type==="elevation"||rYe(e)}u([h({json:{read:!1}})],iy.prototype,"layers",null),u([Le("layers")],iy.prototype,"writeLayers",null),u([h({readOnly:!0})],iy.prototype,"resourceInfo",void 0),u([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:bs,read:{reader:xR,source:"transparency"},write:{writer:(e,t)=>{t.transparency=rj(e)},target:"transparency"}}})],iy.prototype,"opacity",void 0),u([h({type:Boolean,nonNullable:!0,json:{read:!1}})],iy.prototype,"shading",void 0),u([h({type:Ze,json:{type:[bs],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],iy.prototype,"surfaceColor",void 0),u([h({type:D6,json:{write:!0}})],iy.prototype,"navigationConstraint",void 0),iy=ZJ=u([I("esri.Ground")],iy);const Iz=iy;let PA=class extends Ge{constructor(e){super(e),this.getCollections=null}initialize(){this.own(b2e(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=v(this.getCollections)?this.getCollections():null;if(C(e))return void this.removeAll();let t=0;for(const r of e)v(r)&&(t=this._processCollection(t,r));this.splice(t,this.length)}_createNewInstance(e){return new Ge(e)}_processCollection(e,t){if(!t)return e;const r=this.itemFilterFunction?this.itemFilterFunction:i=>!!i;for(const i of t)if(i){if(r(i)){const s=this.indexOf(i,e);s>=0?s!==e&&this.reorder(i,e):this.add(i,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(i);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};u([h()],PA.prototype,"getCollections",void 0),u([h()],PA.prototype,"getChildrenFunction",void 0),u([h()],PA.prototype,"itemFilterFunction",void 0),PA=u([I("esri.core.CollectionFlattener")],PA);const nN=PA;function iYe(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&((t=e==null?void 0:e.capabilities)==null?void 0:t.operations)&&"supportsEditing"in e.capabilities.operations&&e.capabilities.operations.supportsEditing===!0)&&!("editingEnabled"in e&&!e.editingEnabled)}const Hpe=te.getLogger("esri.support.basemapUtils");function sYe(){return{}}function nYe(e){for(const t in e){const r=e[t];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete e[t]}}function oYe(e,t){let r;if(typeof e=="string"){if(!(e in WJ)){const i=Object.entries(WJ).filter(([s,n])=>Gr.apiKey&&!n.classic||!Gr.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return Hpe.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${i}`),null}t&&(r=t[e]),r||(r=Mz.fromId(e),t&&(t[e]=r))}else r=ts(Mz,e);return r!=null&&r.destroyed&&(Hpe.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function aYe(e){return new nN({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const r=[];return"tables"in t&&r.push(t.tables),"layers"in t&&r.push(t.layers),r},itemFilterFunction:t=>{const r=t.parent;return r&&"tables"in r&&r.tables.includes(t)}})}const qpe={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function lYe(e){let t=null;if(typeof e=="string")if(e in qpe){const r=qpe[e];t=new Iz({resourceInfo:{data:{layers:[r]}}})}else te.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=ts(Iz,e);return t}async function cYe(e){const t="portalItem"in e?e:{portalItem:e},r=await re(()=>import("./portalLayers.c4cfe435.js"),["assets/portalLayers.c4cfe435.js","assets/lazyLayerLoader.cca980e7.js","assets/layersLoader.e3596b12.js","assets/jsonContext.df83b33f.js"]);try{return await r.fromItem(t)}catch(i){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Gr.portalUrl;throw te.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",i),i}}let uYe=0,xa=class extends $s.EventedMixin(eC(Hv)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Sr(-180,-90,180,90,Ve.WGS84),this.id=Date.now().toString(16)+"-layer-"+uYe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ve.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await re(()=>import("./arcgisLayers.96f58e4f.js"),["assets/arcgisLayers.96f58e4f.js","assets/fetchService.2cb73a25.js","assets/lazyLayerLoader.cca980e7.js"])).fromUrl(t)}static fromPortalItem(e){return cYe(e)}initialize(){this.when().catch(e=>{var t,r;Ps(e)||te.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(r=this.id)!=null?r:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Wa(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await lr(e,{query:{f:"json"},responseType:"json"})).data;throw new z("layer:no-attribution-data","Layer does not have attribution data")}};u([h({type:String})],xa.prototype,"attributionDataUrl",void 0),u([h({type:Sr})],xa.prototype,"fullExtent",void 0),u([h({readOnly:!0})],xa.prototype,"hasAttributionData",null),u([h({type:String,clonable:!1})],xa.prototype,"id",void 0),u([h({type:Boolean,nonNullable:!0})],xa.prototype,"legendEnabled",void 0),u([h({type:["show","hide","hide-children"]})],xa.prototype,"listMode",void 0),u([h({type:Number,range:{min:0,max:1},nonNullable:!0})],xa.prototype,"opacity",void 0),u([h({clonable:!1})],xa.prototype,"parent",void 0),u([h({readOnly:!0})],xa.prototype,"parsedUrl",null),u([h({type:Boolean})],xa.prototype,"popupEnabled",void 0),u([h({type:Boolean})],xa.prototype,"attributionVisible",void 0),u([h({type:Ve})],xa.prototype,"spatialReference",void 0),u([h({type:String})],xa.prototype,"title",void 0),u([h({readOnly:!0,json:{read:!1}})],xa.prototype,"type",void 0),u([h()],xa.prototype,"url",void 0),u([h({type:Boolean,nonNullable:!0})],xa.prototype,"visible",void 0),xa=u([I("esri.layers.Layer")],xa);const fE=xa;function JJ(e,t,r){let i,s;if(e)for(let n=0,o=e.length;n<o;n++){if(i=e.getItemAt(n),i[t]===r)return i;if((i==null?void 0:i.type)==="group"&&(s=JJ(i.layers,t,r),s))return s}}const dYe=e=>{let t=class extends e{constructor(...r){super(...r),this.layers=new Ge;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||te.getLogger(this.declaredClass).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const r=this.layers.removeAll();for(const i of r)this.layerRemoved(i),i.destroy();this.layers.destroy()}set layers(r){this._set("layers",hE(r,this._get("layers")))}add(r,i){const s=this.layers;if(i=s.getNextIndex(i),r instanceof fE){const n=r;n.parent===this?this.reorder(n,i):s.add(n,i)}else np(r)?r.then(n=>{this.destroyed||this.add(n,i)}):te.getLogger(this.declaredClass).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const s=this.layers;i=s.getNextIndex(i),r.slice().forEach(n=>{n.parent!==this?(s.add(n,i),i+=1):this.reorder(n,i)})}findLayerById(r){return JJ(this.layers,"id",r)}findLayerByUid(r){return JJ(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return u([h()],t.prototype,"layers",null),t=u([I("esri.support.LayersMixin")],t),t};function KJ(e,t,r){if(e)for(let i=0,s=e.length;i<s;i++){const n=e.getItemAt(i);if(n[t]===r)return n;if((n==null?void 0:n.type)==="group"){const o=KJ(n.tables,t,r);if(o)return o}}}const hYe=e=>{let t=class extends e{constructor(...r){super(...r),this.tables=new Ge,this.tables.on("after-add",i=>{const s=i.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&te.getLogger(this.declaredClass).error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",hE(r,this._get("tables")))}findTableById(r){return KJ(this.tables,"id",r)}findTableByUid(r){return KJ(this.tables,"uid",r)}};return u([h()],t.prototype,"tables",null),t=u([I("esri.support.TablesMixin")],t),t};let sy=class extends hYe(dYe($s.EventedMixin(be))){constructor(e){super(e),this.allLayers=new nN({getCollections:()=>{var t,r,i;return[(t=this.basemap)==null?void 0:t.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(i=this.basemap)==null?void 0:i.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=aYe(this),this.basemap=null,this.editableLayers=new nN({getCollections:()=>[this.allLayers],itemFilterFunction:iYe}),this.ground=new Iz,this._basemapCache=sYe()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),nYe(this._basemapCache),this._basemapCache=null}castBasemap(e){return oYe(e,this._basemapCache)}castGround(e){const t=lYe(e);return C(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([h({readOnly:!0,dependsOn:[]})],sy.prototype,"allLayers",void 0),u([h({readOnly:!0})],sy.prototype,"allTables",void 0),u([h({type:Mz})],sy.prototype,"basemap",void 0),u([Gt("basemap")],sy.prototype,"castBasemap",null),u([h({readOnly:!0})],sy.prototype,"editableLayers",void 0),u([h({type:Iz,nonNullable:!0})],sy.prototype,"ground",void 0),u([Gt("ground")],sy.prototype,"castGround",null),sy=u([I("esri.Map")],sy);const WAe=sy;var TR;function pYe(e,t){switch(e.type){case"range":{const r="range"in e?e.range[0]:e.minValue,i="range"in e?e.range[1]:e.maxValue;if(r!=null&&+t<r||i!=null&&+t>i)return TR.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(r=>r==null||r.code!==t))return TR.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(TR||(TR={}));const fYe=te.getLogger("esri.support.arcadeOnDemand");let aq;function b0(){return aq||(aq=(async()=>{const e=await re(()=>import("./arcadeUtils.4c0abe01.js").then(t=>t.ax),["assets/arcadeUtils.4c0abe01.js","assets/number.ad2b9bcd.js","assets/hash.e6424875.js"]);return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),aq}const mYe=(e,t,r)=>jF.create(e,t,r,null,["$feature"]),gYe=(e,t,r)=>jF.create(e,t,r,null,["$feature","$view"]),yYe=(e,t,r,i)=>jF.create(e,t,r,i,["$feature","$view"]);class jF{constructor(t,r,i,s,n,o,a,l){this.script=t,this.evaluate=n;const c=Array.isArray(a)?a:a.fields;this.fields=c,this._syntaxTree=s,this._arcade=r,this._arcadeDictionary=i,this._arcadeFeature=o,this._spatialReference=l,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,r,i,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await b0(),d=Ve.fromJSON(r);let p=null;try{p=a.parseScript(t,o)}catch(D){return fYe.error(new z("arcade-bad-expression","Failed to parse arcade script",{script:t,error:D})),null}const f=n.reduce((D,k)=>({...D,[k]:null}),{});let m=null;v(s)&&(m=new c(s),m.immutable=!0,f.$config=null);const g=a.scriptUsesGeometryEngine(p),_=g&&a.enableGeometrySupport(),x=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(p),w=b&&a.enableAsyncSupport(),T={vars:f,spatialReference:d,useAsync:!!w};await Promise.all([_,x,w]);const E=new Set;await a.loadDependentModules(E,p,null,b,g);const O=new c;O.immutable=!1,O.setField("scale",0);const A=a.compileScript(p,T),R=D=>("$view"in D&&D.$view&&(O.setField("scale",D.$view.scale),D.$view=O),m&&(D.$config=m),A({vars:D,spatialReference:d}));return new jF(t,a,c,p,R,new l,i,d)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(t){return this._arcade.referencesMember(this._syntaxTree,t)}referencesFunction(t){return this._arcade.referencesFunction(this._syntaxTree,t)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const _Ye=/^([0-9])/,vYe=/[^A-Za-z0-9_\u0080-\uffff]/g,bYe=/_{2,}/g,wYe=/^_/,xYe=/_$/;function TYe(e){return e?e.trim().replace(vYe,"_").replace(bYe,"_").replace(wYe,"").replace(xYe,"").replace(_Ye,"F$1"):null}const SYe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],EYe=["field","normalizationField"];function Pz(e,t){if(e!=null&&t!=null){for(const r of Array.isArray(e)?e:[e])if(Wpe(SYe,r,t),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)Wpe(EYe,i,t)}}function Wpe(e,t,r){if(e)for(const i of e){const s=ZE(i,t),n=s&&typeof s!="function"&&r.get(s);n&&Vl(i,n.name,t)}}function XAe(e,t){var r,i,s,n,o;if(e!=null&&((r=t==null?void 0:t.fields)==null?void 0:r.length))if("startField"in e){const a=t.get(e.startField),l=t.get(e.endField);e.startField=(i=a==null?void 0:a.name)!=null?i:null,e.endField=(s=l==null?void 0:l.name)!=null?s:null}else{const a=t.get(e.startTimeField),l=t.get(e.endTimeField);e.startTimeField=(n=a==null?void 0:a.name)!=null?n:null,e.endTimeField=(o=l==null?void 0:l.name)!=null?o:null}}const lq=new Set;function coe(e,t){return e&&t?(lq.clear(),oN(lq,e,t),Array.from(lq).sort()):[]}function oN(e,t,r){var i;if(r)if((i=t==null?void 0:t.fields)!=null&&i.length)if(r.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of r)jh(e,t,s);else{if(r.includes("*"))return e.clear(),void e.add("*");for(const s of r)s!=null&&e.add(s)}}function jh(e,t,r){if(typeof r=="string")if(t){const i=t.get(r);i&&e.add(i.name)}else e.add(r)}function CYe(e,t){var r;return C(t)||C(e)?[]:t.includes("*")?((r=e.fields)!=null?r:[]).map(i=>i.name):t}async function Ru(e,t,r){var n;if(!r)return;const{arcadeUtils:i}=await b0(),s=i.extractFieldNames(r,(n=t==null?void 0:t.fields)==null?void 0:n.map(o=>o.name));for(const o of s)jh(e,t,o)}async function YAe(e,t,r){if(r&&r!=="1=1"){const i=(await re(()=>import("./WhereClause.b191b7a3.js"),[])).WhereClause.create(r,t);if(!i.isStandardized)throw new z("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});oN(e,t,i.fieldNames)}}function AYe({displayField:e,fields:t}){return e||(t&&t.length?cq(t,"name-or-title")||cq(t,"unique-identifier")||cq(t,"type-or-category")||OYe(t):null)}function OYe(e){for(const t of e){if(!t||!t.name)continue;const r=t.name.toLowerCase();if(r.includes("name")||r.includes("title"))return t.name}return null}function cq(e,t){for(const r of e)if(r&&r.valueType&&r.valueType===t)return r.name;return null}async function FUt(e,t){if(!t)return;const r=ZE("elevationInfo.featureExpressionInfo",t);return r?r.collectRequiredFields(e,t.fieldsIndex):void 0}function MYe(e,t,r){r.onStatisticExpression?Ru(e,t,r.onStatisticExpression.expression):e.add(r.onStatisticField)}async function kUt(e,t,r){if(!t||!r||!("fields"in r))return;const i=[],s=r.popupTemplate;i.push(RYe(e,t,s)),r.fields&&i.push(...r.fields.map(async n=>MYe(e,t.fieldsIndex,n))),await Promise.all(i)}async function RYe(e,t,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(n=>Ru(e,t.fieldsIndex,n.expression)));const s=r==null?void 0:r.content;if(Array.isArray(s))for(const n of s)n.type==="expression"&&n.expressionInfo&&i.push(Ru(e,t.fieldsIndex,n.expressionInfo.expression));await Promise.all(i)}async function UUt(e,t,r){t&&(t.timeInfo&&v(r)&&r.timeExtent&&oN(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&oN(e,t.fieldsIndex,[t.floorInfo.floorField]),v(r)&&v(r.where)&&await YAe(e,t.fieldsIndex,r.where))}async function BUt(e,t,r){t&&r&&await Promise.all(r.map(i=>IYe(e,t,i)))}async function IYe(e,t,r){t&&r&&(r.valueExpression?await Ru(e,t.fieldsIndex,r.valueExpression):r.field&&jh(e,t.fieldsIndex,r.field))}function PYe(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?coe(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function zUt(e,t){const{labelingInfo:r,fieldsIndex:i}=t;r&&r.length&&await Promise.all(r.map(s=>$Ye(e,i,s)))}async function $Ye(e,t,r){if(!r)return;const i=r.getLabelExpression(),s=r.where;if(i.type==="arcade")await Ru(e,t,i.expression);else{const n=i.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{jh(e,t,o.slice(1,-1))})}await YAe(e,t,s)}function DYe(e){const t=e.defaultValue;return t!==void 0&&KAe(e,t)?t:e.nullable?null:void 0}function ZAe(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function LYe(e){return e===null||ZAe(e)}const uoe="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function NYe(e){return e===null||uoe(e)}function JAe(e){return e!=null&&typeof e=="string"}function FYe(e){return e===null||JAe(e)}function kYe(){return!0}function KAe(e,t){let r;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=e.nullable?NYe:uoe;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=e.nullable?LYe:ZAe;break;case"string":case"esriFieldTypeString":r=e.nullable?FYe:JAe;break;default:r=kYe}return arguments.length===1?r:r(t)}const UYe=["integer","small-integer","single","double"],BYe=new Set([...UYe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function ij(e){return e!=null&&BYe.has(e.type)}function VUt(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}var $z,Dz;function jUt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function GUt(e,t){return e.nullable&&t===null?null:ij(e)&&!zYe(e.type,Number(t))?$z.OUT_OF_RANGE:KAe(e,t)?e.domain?pYe(e.domain,t):null:Dz.INVALID_TYPE}function zYe(e,t){const r=typeof e=="string"?QAe(e):e;if(!r)return!1;const i=r.min,s=r.max;return r.isInteger?uoe(t)&&t>=i&&t<=s:t>=i&&t<=s}function QAe(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return VYe;case"esriFieldTypeInteger":case"integer":return jYe;case"esriFieldTypeSingle":case"single":return GYe;case"esriFieldTypeDouble":case"double":return HYe}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})($z||($z={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(Dz||(Dz={}));const VYe={min:-32768,max:32767,isInteger:!0},jYe={min:-2147483648,max:2147483647,isInteger:!0},GYe={min:-34e37,max:12e37,isInteger:!1},HYe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function HUt(e,t,r){switch(e){case TR.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case TR.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case Dz.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case $z.OUT_OF_RANGE:{const{min:i,max:s}=QAe(t.type);return`Value ${r} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${i} to ${s}`}}}function qYe(e,t){return!WYe(e,t,null)}function WYe(e,t,r){if(!t||!t.attributes||!e){if(v(r))for(const n of e!=null?e:[])r.add(n);return!0}const i=t.attributes;let s=!1;for(const n of e)if(!(n in i)){if(s=!0,!v(r))break;r.add(n)}return s}function eOe(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}let L6=class extends fe{constructor(e){super(e),this.type=null}};u([h({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],L6.prototype,"type",void 0),L6=u([I("esri.popup.content.Content")],L6);const Jx=L6;var QJ;let QT=QJ=class extends Jx{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new QJ({description:this.description,displayType:this.displayType,title:this.title})}};u([h({type:String,json:{write:!0}})],QT.prototype,"description",void 0),u([h({type:["auto","preview","list"],json:{write:!0}})],QT.prototype,"displayType",void 0),u([h({type:String,json:{write:!0}})],QT.prototype,"title",void 0),u([h({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],QT.prototype,"type",void 0),QT=QJ=u([I("esri.popup.content.AttachmentsContent")],QT);const aN=QT;var eK;let eS=eK=class extends Jx{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new eK({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ne(this.outFields):null})}};u([h()],eS.prototype,"creator",void 0),u([h()],eS.prototype,"destroyer",void 0),u([h()],eS.prototype,"outFields",void 0),u([h({type:["custom"],readOnly:!0})],eS.prototype,"type",void 0),eS=eK=u([I("esri.popup.content.CustomContent")],eS);const XYe=eS;var tK;let $A=tK=class extends fe{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new tK({title:this.title,expression:this.expression})}};u([h({type:String,json:{write:!0}})],$A.prototype,"title",void 0),u([h({type:String,json:{write:!0}})],$A.prototype,"expression",void 0),u([h({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],$A.prototype,"returnType",void 0),$A=tK=u([I("esri.popup.ElementExpressionInfo")],$A);const tOe=$A;var rK;let N3=rK=class extends Jx{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new rK({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};u([h({type:tOe,json:{write:!0}})],N3.prototype,"expressionInfo",void 0),u([h({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],N3.prototype,"type",void 0),N3=rK=u([I("esri.popup.content.ExpressionContent")],N3);const doe=N3,lN=Br()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});lN.toJSON.bind(lN);lN.fromJSON.bind(lN);var iK;let tS=iK=class extends fe{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new iK({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?_s(e,{...iE(this.dateFormat),...this.dateTimeFormatOptions}):Yh(e,K2e(this))}formatRasterPixelValue(e){if(e.includes("-"))return e;let t,r;return e.trim().includes(",")?(t=",",r=t+" ",this._formatDelimitedString(e,t,r,this)):e.trim().includes(";")?(t=";",r=t+" ",this._formatDelimitedString(e,t,r,this)):e.trim().includes(" ")?(t=r=" ",this._formatDelimitedString(e,t,r,this)):this.format(Number(e))}_formatDelimitedString(e,t,r,i){return e&&t&&r&&i?e.trim().split(t).map(s=>this.format(Number(s))).join(r):e}};u([Ue(lN)],tS.prototype,"dateFormat",void 0),u([h({type:Object,json:{read:!1}})],tS.prototype,"dateTimeFormatOptions",void 0),u([h({type:Boolean,json:{write:!0}})],tS.prototype,"digitSeparator",void 0),u([h({type:bs,json:{write:!0}})],tS.prototype,"places",void 0),tS=iK=u([I("esri.popup.support.FieldInfoFormat")],tS);const HO=tS;var sK;let Qf=sK=class extends fe{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new sK({fieldName:this.fieldName,format:this.format?ne(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([h({type:String,json:{write:!0}})],Qf.prototype,"fieldName",void 0),u([h({type:HO,json:{write:!0}})],Qf.prototype,"format",void 0),u([h({type:Boolean,json:{write:!0,default:!1}})],Qf.prototype,"isEditable",void 0),u([h({type:String,json:{write:!0}})],Qf.prototype,"label",void 0),u([Ue(new gr({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Qf.prototype,"stringFieldOption",void 0),u([h({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Qf.prototype,"statisticType",void 0),u([h({type:String,json:{write:!0}})],Qf.prototype,"tooltip",void 0),u([h({type:Boolean,json:{write:!0}})],Qf.prototype,"visible",void 0),Qf=sK=u([I("esri.popup.FieldInfo")],Qf);const GF=Qf;var nK;let __=nK=class extends Jx{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(r=>r.toJSON())}clone(){return new nK(ne({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([h({type:Object,json:{write:!0}})],__.prototype,"attributes",void 0),u([h({type:String,json:{write:!0}})],__.prototype,"description",void 0),u([h({type:[GF]})],__.prototype,"fieldInfos",void 0),u([Le("fieldInfos")],__.prototype,"writeFieldInfos",null),u([h({type:String,json:{write:!0}})],__.prototype,"title",void 0),u([h({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],__.prototype,"type",void 0),__=nK=u([I("esri.popup.content.FieldsContent")],__);const SR=__;let rS=class extends fe{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([h({type:String,json:{write:!0}})],rS.prototype,"altText",void 0),u([h({type:String,json:{write:!0}})],rS.prototype,"caption",void 0),u([h({type:String,json:{write:!0}})],rS.prototype,"title",void 0),u([h({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],rS.prototype,"type",void 0),rS=u([I("esri.popup.content.mixins.MediaInfo")],rS);const hoe=rS;var oK;let DA=oK=class extends be{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new oK({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([h()],DA.prototype,"fieldName",void 0),u([h()],DA.prototype,"tooltip",void 0),u([h()],DA.prototype,"value",void 0),DA=oK=u([I("esri.popup.content.support.ChartMediaInfoValueSeries")],DA);const rOe=DA;var aK;let iS=aK=class extends fe{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new aK({fields:ne(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([h({type:[String],json:{write:!0}})],iS.prototype,"fields",void 0),u([h({type:String,json:{write:!0}})],iS.prototype,"normalizeField",void 0),u([h({type:[rOe],json:{read:!1}})],iS.prototype,"series",void 0),u([h({type:String,json:{write:!0}})],iS.prototype,"tooltipField",void 0),iS=aK=u([I("esri.popup.content.support.ChartMediaInfoValue")],iS);const YYe=iS;let F3=class extends hoe{constructor(e){super(e),this.type=null,this.value=null}};u([h({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],F3.prototype,"type",void 0),u([h({type:YYe,json:{write:!0}})],F3.prototype,"value",void 0),F3=u([I("esri.popup.content.mixins.ChartMediaInfo")],F3);const sj=F3,nj=Br()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var lK;let N6=lK=class extends sj{constructor(e){super(e),this.type="bar-chart"}clone(){return new lK({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([h({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:nj.write}})],N6.prototype,"type",void 0),N6=lK=u([I("esri.popup.content.BarChartMediaInfo")],N6);const iOe=N6;var cK;let F6=cK=class extends sj{constructor(e){super(e),this.type="column-chart"}clone(){return new cK({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([h({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:nj.write}})],F6.prototype,"type",void 0),F6=cK=u([I("esri.popup.content.ColumnChartMediaInfo")],F6);const sOe=F6;var uK;let k3=uK=class extends fe{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new uK({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([h({type:String,json:{write:!0}})],k3.prototype,"linkURL",void 0),u([h({type:String,json:{write:!0}})],k3.prototype,"sourceURL",void 0),k3=uK=u([I("esri.popup.content.support.ImageMediaInfoValue")],k3);const ZYe=k3;var dK;let LA=dK=class extends hoe{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new dK({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([h({type:Number,json:{write:!0}})],LA.prototype,"refreshInterval",void 0),u([h({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],LA.prototype,"type",void 0),u([h({type:ZYe,json:{write:!0}})],LA.prototype,"value",void 0),LA=dK=u([I("esri.popup.content.ImageMediaInfo")],LA);const nOe=LA;var hK;let k6=hK=class extends sj{constructor(e){super(e),this.type="line-chart"}clone(){return new hK({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([h({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:nj.write}})],k6.prototype,"type",void 0),k6=hK=u([I("esri.popup.content.LineChartMediaInfo")],k6);const oOe=k6;var pK;let U6=pK=class extends sj{constructor(e){super(e),this.type="pie-chart"}clone(){return new pK({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([h({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:nj.write}})],U6.prototype,"type",void 0),U6=pK=u([I("esri.popup.content.PieChartMediaInfo")],U6);const aOe=U6,lOe={base:hoe,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":iOe,"column-chart":sOe,"line-chart":oOe,"pie-chart":aOe,image:nOe}};var fK;let em=fK=class extends Jx{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?nOe.fromJSON(t):t.type==="barchart"?iOe.fromJSON(t):t.type==="columnchart"?sOe.fromJSON(t):t.type==="linechart"?oOe.fromJSON(t):t.type==="piechart"?aOe.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(r=>r.toJSON())}clone(){return new fK(ne({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([h()],em.prototype,"activeMediaInfoIndex",void 0),u([h({type:Object,json:{write:!0}})],em.prototype,"attributes",void 0),u([h({type:String,json:{write:!0}})],em.prototype,"description",void 0),u([h({types:[lOe]})],em.prototype,"mediaInfos",void 0),u([me("mediaInfos")],em.prototype,"readMediaInfos",null),u([Le("mediaInfos")],em.prototype,"writeMediaInfos",null),u([h({type:String,json:{write:!0}})],em.prototype,"title",void 0),u([h({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],em.prototype,"type",void 0),em=fK=u([I("esri.popup.content.MediaContent")],em);const cN=em;var mK;let U3=mK=class extends fe{constructor(e){super(e),this.field=null,this.order=null}clone(){return new mK({field:this.field,order:this.order})}};u([h({type:String,json:{write:!0}})],U3.prototype,"field",void 0),u([h({type:["asc","desc"],json:{write:!0}})],U3.prototype,"order",void 0),U3=mK=u([I("esri.popup.support.RelatedRecordsInfoFieldOrder")],U3);const poe=U3;let ny=class extends ki(Jx){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};u([h({type:String,json:{write:!0}})],ny.prototype,"description",void 0),u([h({type:Number,json:{type:bs,write:!0}})],ny.prototype,"displayCount",void 0),u([h({type:["list"],json:{write:!0}})],ny.prototype,"displayType",void 0),u([h({type:[poe],json:{write:!0}})],ny.prototype,"orderByFields",void 0),u([h({type:Number,json:{type:bs,write:!0}})],ny.prototype,"relationshipId",void 0),u([h({type:String,json:{write:!0}})],ny.prototype,"title",void 0),u([h({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],ny.prototype,"type",void 0),ny=u([I("esri.popup.content.RelationshipContent")],ny);const Lz=ny;var gK;let B3=gK=class extends Jx{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new gK({text:this.text})}};u([h({type:String,json:{write:!0}})],B3.prototype,"text",void 0),u([h({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],B3.prototype,"type",void 0),B3=gK=u([I("esri.popup.content.TextContent")],B3);const ER=B3,JYe={base:null,key:"type",typeMap:{attachment:aN,media:cN,text:ER,expression:doe,field:SR,relationship:Lz}};var yK;let sS=yK=class extends fe{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new yK({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([h({type:String,json:{write:!0}})],sS.prototype,"name",void 0),u([h({type:String,json:{write:!0}})],sS.prototype,"title",void 0),u([h({type:String,json:{write:!0}})],sS.prototype,"expression",void 0),u([h({type:["string","number"],json:{write:!0}})],sS.prototype,"returnType",void 0),sS=yK=u([I("esri.popup.ExpressionInfo")],sS);const cOe=sS;var _K;let z3=_K=class extends fe{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new _K({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([h({type:Boolean,json:{write:!0}})],z3.prototype,"returnTopmostRaster",void 0),u([h({type:Boolean,json:{write:!0}})],z3.prototype,"showNoDataRecords",void 0),z3=_K=u([I("esri.popup.LayerOptions")],z3);const KYe=z3;var vK;let V3=vK=class extends fe{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new vK({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ne(this.orderByFields):null})}};u([h({type:Boolean,json:{write:!0}})],V3.prototype,"showRelatedRecords",void 0),u([h({type:[poe],json:{write:!0}})],V3.prototype,"orderByFields",void 0),V3=vK=u([I("esri.popup.RelatedRecordsInfo")],V3);const QYe=V3;var bK;let tm=bK=class extends eC(be){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new bK({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([h()],tm.prototype,"active",void 0),u([h()],tm.prototype,"className",void 0),u([h()],tm.prototype,"disabled",void 0),u([h()],tm.prototype,"id",void 0),u([h()],tm.prototype,"indicator",void 0),u([h()],tm.prototype,"title",void 0),u([h()],tm.prototype,"type",void 0),u([h()],tm.prototype,"visible",void 0),tm=bK=u([I("esri.support.actions.ActionBase")],tm);const oj=tm;var wK;let B6=wK=class extends oj{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new wK({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([h()],B6.prototype,"image",void 0),B6=wK=u([I("esri.support.Action.ActionButton")],B6);const OI=B6;var xK;let j3=xK=class extends oj{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new xK({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([h()],j3.prototype,"image",void 0),u([h()],j3.prototype,"value",void 0),j3=xK=u([I("esri.support.Action.ActionToggle")],j3);const uOe=j3,eZe="esri.PopupTemplate",tZe=te.getLogger(eZe),mP="relationships/",Xpe="expression/",rZe=Ge.ofType({key:"type",defaultKeyValue:"button",base:oj,typeMap:{button:OI,toggle:uOe}}),iZe={base:Jx,key:"type",typeMap:{media:cN,custom:XYe,text:ER,attachments:aN,fields:SR,expression:doe,relationship:Lz}},sZe=["attachments","fields","media","text","expression","relationship"];let Ta=class extends ki(fe){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(t=>ug(iZe,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||np(e)?e:(tZe.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:r}=t;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(t.description,t.mediaInfos,r):this._readPopupInfo(t)}writeContent(e,t,r,i){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>sZe.includes(s.type)).map(s=>s&&s.toJSON(i)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"?this._writeTextContent(s,t):s.type==="relationship"&&this._writeRelationshipContent(s,t)})):t.description=e}writeFieldInfos(e,t,r,i){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(i);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,r,i){t[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(i)}writeTitle(e,t){t.title=e||""}async collectRequiredFields(e,t){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...r,...this._getContentExpressionInfos(this.content,r)]),oN(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=ne(e.fieldInfos);Array.isArray(t.fieldInfos)?r.forEach(i=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===i.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(i)}):t.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,t){var s,n;const r=((s=e.orderByFields)==null?void 0:s.map(o=>this._toFieldOrderJSON(o,e.relationshipId)))||[],i=[...((n=t.relatedRecordsInfo)==null?void 0:n.orderByFields)||[],...r];t.relatedRecordsInfo={showRelatedRecords:!0,...(i==null?void 0:i.length)&&{orderByFields:i}}}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=ne(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...r]:t.mediaInfos=r}_readPopupInfoElements(e,t,r){const i={description:!1,mediaInfos:!1};return r.map(s=>s.type==="media"?(s.mediaInfos||!t||i.mediaInfos||(s.mediaInfos=t,i.mediaInfos=!0),cN.fromJSON(s)):s.type==="text"?(s.text||!e||i.description||(s.text=e,i.description=!0),ER.fromJSON(s)):s.type==="attachments"?aN.fromJSON(s):s.type==="fields"?SR.fromJSON(s):s.type==="expression"?doe.fromJSON(s):s.type==="relationship"?Lz.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:t,order:r}=e;if(!(t!=null&&t.startsWith(mP)))return null;const i=t.replace(mP,"").split("/");if(i.length!==2)return null;const s=parseInt(i[0],10),n=i[1];return typeof s=="number"&&n?Lz.fromJSON({relationshipId:s,orderByFields:[{field:n,order:r}]}):null}_toFieldOrderJSON(e,t){const{order:r,field:i}=e;return{field:`${mP}${t}/${i}`,order:r}}_readPopupInfo({description:e,mediaInfos:t,showAttachments:r,relatedRecordsInfo:i={showRelatedRecords:!1}}){const s=[];e?s.push(new ER({text:e})):s.push(new SR),Array.isArray(t)&&t.length&&s.push(cN.fromJSON({mediaInfos:t})),r&&s.push(aN.fromJSON({displayType:"auto"}));const{showRelatedRecords:n,orderByFields:o}=i;return n&&(o==null?void 0:o.length)&&o.forEach(a=>{const l=this._toRelationshipContent(a);l&&s.push(l)}),s.length?s:e}_getContentElementFields(e){var r;const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields((r=e.fieldInfos)!=null?r:this.fieldInfos)];if(t==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((s,n)=>[...s,...this._getMediaInfoFields(n)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:r,value:i}=e,s=i||{},{fields:n,normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,d=[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n!=null?n:[]];return o&&d.push(o),a&&d.push(a),d}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((r,i)=>[...r,...i.type==="expression"&&i.expressionInfo?[i.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,r)=>[...t,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,t,r){r&&await Promise.all(r.map(i=>Ru(e,t,i.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.startsWith(mP)&&!t.startsWith(Xpe)):[]}_getActionsFields(e){return e?e.toArray().reduce((t,r)=>[...t,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:t,title:r,type:i}=e,s=i==="button"||i==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,r=e.match(t);if(!r)return[];const i=/\{(\w+):.+\}/,s=r.filter(n=>!(n.indexOf(`{${mP}`)===0||n.indexOf(`{${Xpe}`)===0)).map(n=>n.replace(i,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};u([h({type:rZe})],Ta.prototype,"actions",void 0),u([h()],Ta.prototype,"content",void 0),u([Gt("content")],Ta.prototype,"castContent",null),u([me("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Ta.prototype,"readContent",null),u([Le("content",{popupElements:{type:Ge.ofType(JYe)},showAttachments:{type:Boolean},mediaInfos:{type:Ge.ofType(lOe)},description:{type:String},relatedRecordsInfo:{type:QYe}})],Ta.prototype,"writeContent",null),u([h({type:[cOe],json:{write:!0}})],Ta.prototype,"expressionInfos",void 0),u([h({type:[GF]})],Ta.prototype,"fieldInfos",void 0),u([Le("fieldInfos")],Ta.prototype,"writeFieldInfos",null),u([h({type:KYe})],Ta.prototype,"layerOptions",void 0),u([Le("layerOptions")],Ta.prototype,"writeLayerOptions",null),u([h({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Ta.prototype,"lastEditInfoEnabled",void 0),u([h()],Ta.prototype,"outFields",void 0),u([h()],Ta.prototype,"overwriteActions",void 0),u([h()],Ta.prototype,"returnGeometry",void 0),u([h({json:{type:String}})],Ta.prototype,"title",void 0),u([Le("title")],Ta.prototype,"writeTitle",null),Ta=u([I("esri.PopupTemplate")],Ta);const Nc=Ta,Ype=new gr({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let nZe=0,NA=class extends fe{constructor(e){super(e),this.id="sym"+nZe++,this.type=null,this.color=new Ze([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([h({type:Ype.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Ype.write}}})],NA.prototype,"type",void 0),u([h({type:Ze,json:{write:{allowNull:!0}}})],NA.prototype,"color",void 0),u([me("color")],NA.prototype,"readColor",null),NA=u([I("esri.symbols.Symbol")],NA);const zd=NA;var TK;let wb=TK=class extends zd{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const r in e)t[r]=e[r]}async collectRequiredFields(e,t){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const s=i.map(n=>{const o=n.valueExpressionInfo;return Ru(e,t,o.expression)});await Promise.all(s)}}}clone(){return new TK({data:ne(this.data)})}hash(){return kse(JSON.stringify(this.data)).toString()}};u([h({json:{write:!1}})],wb.prototype,"color",void 0),u([h({json:{write:!0}})],wb.prototype,"data",void 0),u([me("data",["symbol"])],wb.prototype,"readData",null),u([Le("data",{})],wb.prototype,"writeData",null),u([Ue({CIMSymbolReference:"cim"},{readOnly:!0})],wb.prototype,"type",void 0),wb=TK=u([I("esri.symbols.CIMSymbol")],wb);const MI=wb;let FA=class extends fe{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,r){e||(t[r]=e)}};u([h({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],FA.prototype,"enabled",void 0),u([Le("enabled")],FA.prototype,"writeEnabled",null),u([h({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],FA.prototype,"type",void 0),FA=u([I("esri.symbols.Symbol3DLayer")],FA);const D0=FA,oZe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,aZe="screenUtils.toPt: input not recognized!",dOe=96;function Ga(e){return e?e/72*dOe:0}function xf(e){return e?72*e/dOe:0}function Fi(e){if(typeof e=="string"){const t=e.match(oZe);if(t){const r=Number(t[1]),i=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=i==="px"?xf(r):r;return s?-n:n}return console.warn(aZe),null}return e}function hg(e=0,t=0){return{x:e,y:t}}function Vs(e=0,t=0){return[e,t]}function hOe(e=0,t=0){return[e,t]}function ul(e=0,t=0,r=0){return[e,t,r]}function qUt(e){return e}function WUt(e){return e}function XUt(e){return e}function Vy(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function lZe(e,t){const r=t.transparency!=null?xR(t.transparency):1,i=t.color;return i&&Array.isArray(i)?new Ze([i[0]||0,i[1]||0,i[2]||0,r]):null}function cZe(e,t){t.color=e.toJSON().slice(0,3);const r=rj(e.a);r!==0&&(t.transparency=r)}const a1={type:Ze,json:{type:[bs],default:null,read:{source:["color","transparency"],reader:lZe},write:{target:{color:{type:[bs]},transparency:{type:bs}},writer:cZe}}},w0={type:Number,cast:Fi,json:{write:!0}};let nS=class extends fe{constructor(e){super(e),this.color=new Ze([0,0,0,1]),this.extensionLength=0,this.size=xf(1)}clone(){}cloneProperties(){return{color:ne(this.color),size:this.size,extensionLength:this.extensionLength}}};u([h({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],nS.prototype,"type",void 0),u([h(a1)],nS.prototype,"color",void 0),u([h({...w0,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],nS.prototype,"extensionLength",void 0),u([h(w0)],nS.prototype,"size",void 0),nS=u([I("esri.symbols.edges.Edges3D")],nS);const foe=nS;var SK;let z6=SK=class extends foe{constructor(e){super(e),this.type="sketch"}clone(){return new SK(this.cloneProperties())}};u([Ue({sketch:"sketch"},{readOnly:!0})],z6.prototype,"type",void 0),z6=SK=u([I("esri.symbols.edges.SketchEdges3D")],z6);const uZe=z6;var EK;let V6=EK=class extends foe{constructor(e){super(e),this.type="solid"}clone(){return new EK(this.cloneProperties())}};u([Ue({solid:"solid"},{readOnly:!0})],V6.prototype,"type",void 0),V6=EK=u([I("esri.symbols.support.SolidEdges3D")],V6);const dZe=V6,pOe={types:{key:"type",base:foe,typeMap:{solid:dZe,sketch:uZe}},json:{write:!0}};var CK;let Gh=CK=class extends fe{constructor(e){super(e),this.color=null}clone(){const e={color:v(this.color)?this.color.clone():null};return new CK(e)}};u([h(a1)],Gh.prototype,"color",void 0),Gh=CK=u([I("esri.symbols.support.Symbol3DMaterial")],Gh);var AK;let xb=AK=class extends D0{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new AK({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([Ue({Extrude:"extrude"},{readOnly:!0})],xb.prototype,"type",void 0),u([h({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],xb.prototype,"size",void 0),u([h({type:Gh,json:{write:!0}})],xb.prototype,"material",void 0),u([h({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],xb.prototype,"castShadows",void 0),u([h(pOe)],xb.prototype,"edges",void 0),xb=AK=u([I("esri.symbols.ExtrudeSymbol3DLayer")],xb);const fOe=xb;let G3=class extends zd{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([Ue({esriSLS:"simple-line"},{readOnly:!0})],G3.prototype,"type",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],G3.prototype,"width",void 0),G3=u([I("esri.symbols.LineSymbol")],G3);const hZe=G3,pZe=["begin","end","begin-end"],mOe=["arrow","circle","square","diamond","cross","x"];var OK;let oy=OK=class extends fe{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,r,i){t[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,r,i){(i==null?void 0:i.origin)==="web-map"||(t[r]=e)}clone(){return new OK({color:ne(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};u([h({type:["begin","end","begin-end"],json:{write:!0}})],oy.prototype,"placement",void 0),u([Ue({"line-marker":"line-marker"},{readOnly:!0}),h({json:{origins:{"web-map":{write:!1}}}})],oy.prototype,"type",void 0),u([h({type:mOe})],oy.prototype,"style",void 0),u([Le("style")],oy.prototype,"writeStyle",null),u([h({type:Ze,value:null,json:{write:{allowNull:!0}}})],oy.prototype,"color",null),u([me("color")],oy.prototype,"readColor",null),u([Le("color")],oy.prototype,"writeColor",null),oy=OK=u([I("esri.symbols.LineSymbolMarker")],oy);const fZe=oy;var MK;const uq=new gr({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let v_=MK=class extends hZe{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,r,i,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),r!=null&&(o.width=Fi(r)),i!=null&&(o.cap=i),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Fi(n)),o}clone(){var e;return new MK({color:ne(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};u([Ue({esriSLS:"simple-line"},{readOnly:!0})],v_.prototype,"type",void 0),u([h({type:uq.apiValues,json:{read:uq.read,write:uq.write}})],v_.prototype,"style",void 0),u([h({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,r)=>({enabled:e!=="round"&&(r==null||r.origin==null)})}}})],v_.prototype,"cap",void 0),u([h({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,r)=>({enabled:e!=="round"&&(r==null||r.origin==null)})}}})],v_.prototype,"join",void 0),u([h({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":fZe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],v_.prototype,"marker",void 0),u([h({type:Number,json:{read:!1,write:!1}})],v_.prototype,"miterLimit",void 0),v_=MK=u([I("esri.symbols.SimpleLineSymbol")],v_);const Ul=v_;let H3=class extends zd{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([h({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Ul}},json:{default:null,write:!0}})],H3.prototype,"outline",void 0),u([h({type:["simple-fill","picture-fill"],readOnly:!0})],H3.prototype,"type",void 0),H3=u([I("esri.symbols.FillSymbol")],H3);const gOe=H3;let j6=class extends fe{constructor(e){super(e)}clone(){}};u([h({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],j6.prototype,"type",void 0),j6=u([I("esri.symbols.patterns.LinePattern3D")],j6);const yOe=j6,mZe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var RK;const gZe=Br()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let q3=RK=class extends yOe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new RK(e)}};u([h({type:["style"]})],q3.prototype,"type",void 0),u([Ue(gZe),h({type:mZe})],q3.prototype,"style",void 0),q3=RK=u([I("esri.symbols.patterns.LineStylePattern3D")],q3);const moe=q3;let G6=class extends fe{constructor(e){super(e)}clone(){}};u([h({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],G6.prototype,"type",void 0),G6=u([I("esri.symbols.patterns.Pattern3D")],G6);const _Oe=G6,yZe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var IK;let W3=IK=class extends _Oe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new IK(e)}};u([h({type:["style"]})],W3.prototype,"type",void 0),u([h({type:yZe,json:{read:!0,write:!0}})],W3.prototype,"style",void 0),W3=IK=u([I("esri.symbols.patterns.StylePattern3D")],W3);const vOe=W3,_Ze={types:{key:"type",base:_Oe,typeMap:{style:vOe}},json:{write:!0}},bOe={types:{key:"type",base:yOe,typeMap:{style:moe}},json:{write:!0}},PD=new Ze("white");new Ze("black");const vZe=new Ze([255,255,255,0]);function bZe(e){return e.r===0&&e.g===0&&e.b===0}var PK;let $D=PK=class extends Gh{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:v(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new PK(e)}};u([Ue({multiply:"multiply",replace:"replace",tint:"tint"})],$D.prototype,"colorMixMode",void 0),$D=PK=u([I("esri.symbols.support.Symbol3DFillMaterial")],$D);function tr(e=SZe){return[e[0],e[1],e[2],e[3]]}function YUt(e){return[e[0],e[1],e[2],e[3]]}function qv(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function wOe(e,t,r,i,s=tr()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function xOe(e,t=tr()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function aj(e,t){return new Sr({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function RM(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function ox(e,t,r){if(C(t))qv(r,e);else if("length"in t)LK(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[0]),r[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":r[0]=Math.min(e[0],t.xmin),r[1]=Math.min(e[1],t.ymin),r[2]=Math.max(e[2],t.xmax),r[3]=Math.max(e[3],t.ymax);break;case"point":r[0]=Math.min(e[0],t.x),r[1]=Math.min(e[1],t.y),r[2]=Math.max(e[2],t.x),r[3]=Math.max(e[3],t.y)}}function dq(e,t,r=e){const i=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<i;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=s,r[1]=n,r[2]=o,r[3]=a,r}function $K(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function Ph(e){return C(e)||e[0]>=e[2]?0:e[2]-e[0]}function pg(e){return e[1]>=e[3]?0:e[3]-e[1]}function TOe(e){return Ph(e)*pg(e)}function goe(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function SOe(e,t){return lj(e,t[0],t[1])}function Zpe(e,t){const r=t[3],i=.5*(e[0]+e[2]),s=Math.abs(t[0]-i),n=.5*(e[2]-e[0]);if(s>r+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>r+a)return!1;if(s<n||l<a)return!0;const c=s-n,d=l-a;return c*c+d*d<=r*r}function ZUt(e,t,r){const i=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:d}=r,p=(x,b)=>(d-l)*x+(a-c)*b+(c*l-a*d)<0,f=p(i,o),m=p(n,o),g=p(n,s),_=p(i,s);return!(f===m&&m===g&&g===_&&_===f||a<i&&c<i||a>n&&c>n||l>o&&d>o||l<s&&d<s)}function JUt(e,t){return lj(e,t.x,t.y)}function lj(e,t,r){return t>=e[0]&&r>=e[1]&&t<=e[2]&&r<=e[3]}function wZe(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[0]<=e[2]+r&&t[1]<=e[3]+r}function HF(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function Jpe(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function DK(e,t,r){if(C(t))return qv(r,e);const i=t[0],s=t[1],n=t[2],o=t[3];return r[0]=_e(e[0],i,n),r[1]=_e(e[1],s,o),r[2]=_e(e[2],i,n),r[3]=_e(e[3],s,o),r}function xZe(e,t){const r=(e[0]+e[2])/2,i=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-r)-Ph(e)/2,0),n=Math.max(Math.abs(t[1]-i)-pg(e)/2,0);return Math.sqrt(s*s+n*n)}function Nz(e,t,r,i=e){return i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+t,i[3]=e[3]+r,i}function kd(e){return e?qv(e,NK):tr(NK)}function LK(e){return e!=null&&e.length===4}function TZe(e){return!(Ph(e)!==0&&isFinite(e[0])||pg(e)!==0&&isFinite(e[1]))}function N2(e,t){return LK(e)&&LK(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const KUt=[-1/0,-1/0,1/0,1/0],NK=[1/0,1/0,-1/0,-1/0],SZe=[0,0,0,0];function ao(e=MOe){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function mE(e,t,r,i,s,n,o=ao()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function QUt(e,t){const r=isFinite(e[2])||isFinite(e[5]);return new Sr(r?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function CR(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function EZe(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function x0(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function Uh(e,t,r=0,i=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let d=0;d<i;d++)s=Math.min(s,t[r+3*d]),n=Math.min(n,t[r+3*d+1]),o=Math.min(o,t[r+3*d+2]),a=Math.max(a,t[r+3*d]),l=Math.max(l,t[r+3*d+1]),c=Math.max(c,t[r+3*d+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function hq(e,t,r){const i=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(r)for(let d=0;d<i;d++){const p=t[d];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let d=0;d<i;d++){const p=t[d];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function CZe(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function tC(e){return e[0]>=e[3]?0:e[3]-e[0]}function rC(e){return e[1]>=e[4]?0:e[4]-e[1]}function Kx(e){return e[2]>=e[5]?0:e[5]-e[2]}function EOe(e){const t=tC(e),r=Kx(e),i=rC(e);return Math.sqrt(t*t+r*r+i*i)}function Gm(e,t=[0,0,0]){return t[0]=e[0]+tC(e)/2,t[1]=e[1]+rC(e)/2,t[2]=e[2]+Kx(e)/2,t}function w5(e,t=[0,0,0]){return t[0]=tC(e),t[1]=rC(e),t[2]=Kx(e),t}function yoe(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function e6t(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function AZe(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function Hm(e,t){return!!C(t)||AZe(e,t)}function COe(e,t,r,i,s=e){return s[0]=e[0]+t,s[1]=e[1]+r,s[2]=e[2]+i,s[3]=e[3]+t,s[4]=e[4]+r,s[5]=e[5]+i,s}function t6t(e,t,r=e){const i=e[0]+tC(e)/2,s=e[1]+rC(e)/2,n=e[2]+Kx(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=s+(e[1]-s)*t,r[2]=n+(e[2]-n)*t,r[3]=i+(e[3]-i)*t,r[4]=s+(e[4]-s)*t,r[5]=n+(e[5]-n)*t,r}function AOe(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function OOe(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function cj(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function es(e){return e?cj(e,Qpe):ao(Qpe)}function _oe(e,t){return t||(t=tr()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function r6t(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function Kpe(e){return e.length===6}function voe(e){return tC(e)===0&&rC(e)===0&&Kx(e)===0}function i6t(e,t,r){if(C(e)||C(t))return e===t;if(!Kpe(e)||!Kpe(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function OZe(e,t,r,i,s,n){return mE(e,t,r,i,s,n,MZe)}const s6t=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Qpe=[1/0,1/0,1/0,-1/0,-1/0,-1/0],MOe=[0,0,0,0,0,0],MZe=ao();function pq(e,{isPrimitive:t,width:r,depth:i,height:s}){const n=t?10:1;if(r==null&&s==null&&i==null)return[n*e[0],n*e[1],n*e[2]];const o=Fe(r,i,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const RZe=mE(-.5,-.5,-.5,.5,.5,.5),IZe=mE(-.5,-.5,0,.5,.5,1),PZe=mE(-.5,-.5,0,.5,.5,.5);function $Ze(e){switch(e){case"sphere":case"cube":case"diamond":return RZe;case"cylinder":case"cone":case"inverted-cone":return IZe;case"tetrahedron":return PZe;default:return}}const boe=["butt","square","round"],DZe=[...boe,"none"],ROe=["miter","bevel","round"];var FK;let oS=FK=class extends fe{constructor(e){super(e),this.color=new Ze([0,0,0,1]),this.size=xf(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:v(this.color)?this.color.clone():null,size:this.size,pattern:v(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new FK(e)}};u([h(a1)],oS.prototype,"color",void 0),u([h(w0)],oS.prototype,"size",void 0),u([h(bOe)],oS.prototype,"pattern",void 0),u([h({type:boe,json:{default:"butt",write:{overridePolicy(){return{enabled:v(this.pattern)}}}}})],oS.prototype,"patternCap",void 0),oS=FK=u([I("esri.symbols.support.Symbol3DOutline")],oS);var H6;let b_=H6=class extends D0{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:v(this.edges)?this.edges.clone():null,enabled:this.enabled,material:v(this.material)?this.material.clone():null,pattern:v(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:v(this.outline)?this.outline.clone():null};return new H6(e)}static fromSimpleFillSymbol(e){var i,s,n,o,a,l;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new moe({style:e.outline.style}):null,r={size:(s=(i=e.outline)==null?void 0:i.width)!=null?s:0,color:((o=(n=e.outline)==null?void 0:n.color)!=null?o:PD).clone(),pattern:t};return t&&((a=e.outline)==null?void 0:a.cap)&&(r.patternCap=e.outline.cap),new H6({material:new $D({color:((l=e.color)!=null?l:vZe).clone()}),pattern:e.style&&e.style!=="solid"?new vOe({style:e.style}):null,outline:r})}};u([Ue({Fill:"fill"},{readOnly:!0})],b_.prototype,"type",void 0),u([h({type:$D,json:{write:!0}})],b_.prototype,"material",void 0),u([h(_Ze)],b_.prototype,"pattern",void 0),u([h({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],b_.prototype,"castShadows",void 0),u([h({type:oS,json:{write:!0}})],b_.prototype,"outline",void 0),u([h(pOe)],b_.prototype,"edges",void 0),b_=H6=u([I("esri.symbols.FillSymbol3DLayer")],b_);const qF=b_,LZe=["none","underline","line-through"],NZe=["normal","italic","oblique"],FZe=["normal","lighter","bold","bolder"],IOe={type:Number,cast:e=>{const t=Xp(e);return t===0?1:_e(t,.1,4)},nonNullable:!0},kZe=["left","right","center"],UZe=["baseline","top","middle","bottom"],POe={type:kZe,nonNullable:!0},$Oe={type:UZe,nonNullable:!0};var kK;let w_=kK=class extends fe{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return Fi(e)}clone(){return new kK({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([h({type:LZe,json:{default:"none",write:!0}})],w_.prototype,"decoration",void 0),u([h({type:String,json:{write:!0}})],w_.prototype,"family",void 0),u([h({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.textSymbol3D})}}})],w_.prototype,"size",void 0),u([Gt("size")],w_.prototype,"castSize",null),u([h({type:NZe,json:{default:"normal",write:!0}})],w_.prototype,"style",void 0),u([h({type:FZe,json:{default:"normal",write:!0}})],w_.prototype,"weight",void 0),w_=kK=u([I("esri.symbols.Font")],w_);const uj=w_;function iC(e,t){const r=t&&t.url&&t.url.path;if(e&&r&&(e=Rh(e,r,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const i=ane(e,t.portalItem.itemUrl);i!=null&&BZe.test(i)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(i).path)}return UK(e,t&&t.portal)}function Wv(e,t,r=AR.YES){if(e==null)return e;!Rd(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let i=Rh(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=UK(s,t.portal);i=ane(UK(i,t.portal),n,n),i!=null&&i!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=FOe(i,t==null?void 0:t.portal),Rd(i)&&(i=tg(i)),(t==null?void 0:t.resources)&&(t==null?void 0:t.portalItem)&&!Rd(i)&&!R0(i)&&r===AR.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(i),compress:!1}),i}function dj(e,t,r){return iC(e,r)}function Sx(e,t,r,i){const s=Wv(e,i);s!==void 0&&(t[r]=s)}const DOe=/\/items\/([^\/]+)\/resources\/(.*)/,BZe=/^\.\/resources\//;function LOe(e){var t,r,i;return(i=(r=(t=e==null?void 0:e.match(DOe))!=null?t:null)==null?void 0:r[1])!=null?i:null}function NOe(e){var o;const t=(o=e==null?void 0:e.match(DOe))!=null?o:null;if(t==null)return null;const r=t[2],i=r.lastIndexOf("/");if(i===-1){const{path:a,extension:l}=xhe(r);return{prefix:null,filename:a,extension:l}}const{path:s,extension:n}=xhe(r.slice(i+1));return{prefix:r.slice(0,i),filename:s,extension:n}}function FOe(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?yJ(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function UK(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const r=`${t.urlKey}.${t.customBaseUrl}`,i=sne();return XL(i,`${i.scheme}://${r}`)?yJ(e,t.portalHostname,r):yJ(e,r,t.portalHostname)}var AR;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(AR||(AR={}));const zZe=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:iC,toJSON:Wv,read:dj,write:Sx,itemIdFromResourceUrl:LOe,prefixAndFilenameFromResourceUrl:NOe,ensureMainOnlineDomain:FOe,get MarkKeep(){return AR}},Symbol.toStringTag,{value:"Module"}));var BK;const VZe=Br()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let aS=BK=class extends fe{constructor(e){super(e)}readHref(e,t,r){return e?iC(e,r):t.dataURI}writeHref(e,t,r,i){e&&(R0(e)?t.dataURI=e:(t.href=Wv(e,i),Rd(t.href)&&(t.href=tg(t.href))))}clone(){return new BK({href:this.href,primitive:this.primitive})}};u([h({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],aS.prototype,"href",void 0),u([me("href")],aS.prototype,"readHref",null),u([Le("href",{href:{type:String},dataURI:{type:String}})],aS.prototype,"writeHref",null),u([Ue(VZe)],aS.prototype,"primitive",void 0),aS=BK=u([I("esri.symbols.support.IconSymbol3DLayerResource")],aS);const jZe="circle";var zK;let qO=zK=class extends be{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new zK({x:this.x,y:this.y})}};u([h({type:Number})],qO.prototype,"x",void 0),u([h({type:Number})],qO.prototype,"y",void 0),qO=zK=u([I("esri.symbols.support.Symbol3DAnchorPosition2D")],qO);var VK;let X3=VK=class extends fe{constructor(e){super(e),this.color=new Ze([0,0,0,1]),this.size=xf(1)}clone(){const e={color:v(this.color)?this.color.clone():null,size:this.size};return new VK(e)}};u([h(a1)],X3.prototype,"color",void 0),u([h(w0)],X3.prototype,"size",void 0),X3=VK=u([I("esri.symbols.support.Symbol3DIconOutline")],X3);var kA;const kOe="esri.symbols.IconSymbol3DLayer";let ay=kA=class extends D0{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new kA({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:v(this.material)?this.material.clone():null,outline:v(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||PD,r=efe(e),i=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||PD).clone()}:null;return new kA({size:e.size,resource:{primitive:HZe(e.style)},material:{color:t},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(e){const t=!e.color||bZe(e.color)?PD:e.color,r=efe(e);return new kA({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(e){return new kA({resource:{href:lEe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function efe(e){const t="width"in e?e.width:e.size,r="height"in e?e.height:e.size,i=tfe(e.xoffset),s=tfe(e.yoffset);return(i||s)&&t&&r?{x:-i/t,y:s/r}:null}function tfe(e){return isFinite(e)?e:0}u([h({type:Gh,json:{write:!0}})],ay.prototype,"material",void 0),u([h({type:aS,json:{write:!0}})],ay.prototype,"resource",void 0),u([Ue({Icon:"icon"},{readOnly:!0})],ay.prototype,"type",void 0),u([h(w0)],ay.prototype,"size",void 0),u([Ue({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),h({json:{default:"center"}})],ay.prototype,"anchor",void 0),u([h({type:qO,json:{type:[Number],read:{reader:e=>new qO({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ay.prototype,"anchorPosition",void 0),u([h({type:X3,json:{write:!0}})],ay.prototype,"outline",void 0),ay=kA=u([I(kOe)],ay);const GZe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function HZe(e){return GZe[e]||(te.getLogger(kOe).warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const Dw=ay;let lS=class extends ki(fe){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return v(e)&&e.placement===this.placement&&e.style===this.style&&(C(this.color)&&C(e.color)||v(this.color)&&v(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([h({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],lS.prototype,"type",void 0),u([h({type:pZe,json:{default:"begin-end",write:!0}})],lS.prototype,"placement",void 0),u([h({type:mOe,json:{default:"arrow",write:!0}})],lS.prototype,"style",void 0),u([h({type:Ze,json:{type:[bs],default:null,write:!0}})],lS.prototype,"color",void 0),lS=u([I("esri.symbols.LineStyleMarker3D")],lS);const jK=lS;var q6;let ly=q6=class extends D0{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=xf(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:v(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:v(this.pattern)?this.pattern.clone():null,marker:v(this.marker)?this.marker.clone():null};return new q6(e)}static fromSimpleLineSymbol(e){var r,i,s;const t={enabled:!0,size:(r=e.width)!=null?r:xf(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new moe({style:e.style}):null,material:new Gh({color:(e.color||PD).clone()}),marker:e.marker?new jK({placement:e.marker.placement,style:e.marker.style,color:(s=(i=e.marker.color)==null?void 0:i.clone())!=null?s:null}):null};return new q6(t)}};u([h({type:Gh,json:{write:!0}})],ly.prototype,"material",void 0),u([Ue({Line:"line"},{readOnly:!0})],ly.prototype,"type",void 0),u([h({type:ROe,json:{write:!0,default:"miter"}})],ly.prototype,"join",void 0),u([h({type:boe,json:{write:!0,default:"butt"}})],ly.prototype,"cap",void 0),u([h(w0)],ly.prototype,"size",void 0),u([h(bOe)],ly.prototype,"pattern",void 0),u([h({types:{key:"type",base:jK,typeMap:{style:jK}},json:{write:!0}})],ly.prototype,"marker",void 0),ly=q6=u([I("esri.symbols.LineSymbol3DLayer")],ly);const WF=ly;var GK;const qZe=Br()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let Y3=GK=class extends fe{clone(){return new GK({href:this.href,primitive:this.primitive})}};u([h({type:String,json:{read:dj,write:Sx}})],Y3.prototype,"href",void 0),u([Ue(qZe)],Y3.prototype,"primitive",void 0),Y3=GK=u([I("esri.symbols.support.ObjectSymbol3DLayerResource")],Y3);const UOe="sphere";var HK;let JS=HK=class extends be{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new HK({x:this.x,y:this.y,z:this.z})}};u([h({type:Number})],JS.prototype,"x",void 0),u([h({type:Number})],JS.prototype,"y",void 0),u([h({type:Number})],JS.prototype,"z",void 0),JS=HK=u([I("esri.symbols.support.Symbol3DAnchorPosition3D")],JS);var qK;let dc=qK=class extends D0{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new qK({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([h({type:Gh,json:{write:!0}})],dc.prototype,"material",void 0),u([h({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],dc.prototype,"castShadows",void 0),u([h({type:Y3,json:{write:!0}})],dc.prototype,"resource",void 0),u([Ue({Object:"object"},{readOnly:!0})],dc.prototype,"type",void 0),u([h({type:Number,json:{write:!0}})],dc.prototype,"width",void 0),u([h({type:Number,json:{write:!0}})],dc.prototype,"height",void 0),u([h({type:Number,json:{write:!0}})],dc.prototype,"depth",void 0),u([Ue({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),h({json:{default:"origin"}})],dc.prototype,"anchor",void 0),u([h({type:JS,json:{type:[Number],read:{reader:e=>new JS({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],dc.prototype,"anchorPosition",void 0),u([h({type:Number,json:{write:!0}})],dc.prototype,"heading",void 0),u([h({type:Number,json:{write:!0}})],dc.prototype,"tilt",void 0),u([h({type:Number,json:{write:!0}})],dc.prototype,"roll",void 0),u([h({readOnly:!0})],dc.prototype,"isPrimitive",null),dc=qK=u([I("esri.symbols.ObjectSymbol3DLayer")],dc);const woe=dc;var WK;let Qc=WK=class extends D0{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new WK({enabled:this.enabled,material:v(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([h({type:Gh,json:{write:!0}})],Qc.prototype,"material",void 0),u([h({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Qc.prototype,"castShadows",void 0),u([Ue({Path:"path"},{readOnly:!0})],Qc.prototype,"type",void 0),u([h({type:["circle","quad"],json:{write:!0,default:"circle"}})],Qc.prototype,"profile",void 0),u([h({type:ROe,json:{write:!0,default:"miter"}})],Qc.prototype,"join",void 0),u([h({type:DZe,json:{write:!0,default:"butt"}})],Qc.prototype,"cap",void 0),u([h({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Qc.prototype,"width",void 0),u([me("width",["width","size","height"])],Qc.prototype,"readWidth",null),u([h({type:Number,json:{write:!0}})],Qc.prototype,"height",void 0),u([me("height",["height","size","width"])],Qc.prototype,"readHeight",null),u([h({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Qc.prototype,"anchor",void 0),u([h({type:["heading","all"],json:{write:!0,default:"all"}})],Qc.prototype,"profileRotation",void 0),Qc=WK=u([I("esri.symbols.PathSymbol3DLayer")],Qc);const xoe=Qc;var XK;let WO=XK=class extends fe{constructor(){super(...arguments),this.color=new Ze([0,0,0,1]),this.size=0}clone(){const e={color:ne(this.color),size:this.size};return new XK(e)}};u([h(a1)],WO.prototype,"color",void 0),u([h(w0)],WO.prototype,"size",void 0),WO=XK=u([I("esri.symbols.support.Symbol3DHalo")],WO);let DD=class extends ki(fe){constructor(e){super(e),this.color=null}};u([h(a1)],DD.prototype,"color",void 0),DD=u([I("esri.symbols.support.Symbol3DTextBackground")],DD);var W6;let qu=W6=class extends D0{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){v(e)&&v(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,r,i){const s={...i,textSymbol3D:!0};t.font=e.write({},s),delete t.font.size}get size(){return v(this._userSize)?this._userSize:v(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,v(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new W6({enabled:this.enabled,font:this.font&&ne(this.font),halo:this.halo&&ne(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:v(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ne(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new W6({font:v(e.font)?e.font.clone():new uj,halo:WZe(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new Gh({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new DD({color:e.backgroundColor.clone()}):null})}};function WZe(e,t){return e&&t!=null&&t>0?new WO({color:ne(e),size:t}):null}u([h({type:uj,json:{write:!0}})],qu.prototype,"font",null),u([Le("font")],qu.prototype,"writeFont",null),u([h({type:WO,json:{write:!0}})],qu.prototype,"halo",void 0),u([h({...POe,json:{default:"center",write:!0}})],qu.prototype,"horizontalAlignment",void 0),u([h({...IOe,json:{default:1,write:!0}})],qu.prototype,"lineHeight",void 0),u([h({type:Gh,json:{write:!0}})],qu.prototype,"material",void 0),u([h({type:DD,json:{write:!0}})],qu.prototype,"background",void 0),u([h(w0)],qu.prototype,"size",null),u([h({type:String,json:{write:!0}})],qu.prototype,"text",void 0),u([Ue({Text:"text"},{readOnly:!0})],qu.prototype,"type",void 0),u([h({...$Oe,json:{default:"baseline",write:!0}})],qu.prototype,"verticalAlignment",void 0),qu=W6=u([I("esri.symbols.TextSymbol3DLayer")],qu);const sC=qu;var YK;let Tb=YK=class extends D0{constructor(e){super(e),this.color=ZK.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new YK({color:ne(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([h({type:Ze,nonNullable:!0,json:{type:[bs],write:(e,t,r)=>t[r]=e.toArray(Ze.AlphaMode.UNLESS_OPAQUE),default:()=>ZK.clone(),defaultEquals:e=>e.toCss(!0)===ZK.toCss(!0)}})],Tb.prototype,"color",void 0),u([Ue({Water:"water"},{readOnly:!0})],Tb.prototype,"type",void 0),u([h({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Tb.prototype,"waterbodySize",void 0),u([h({type:Number,json:{write:!0,default:null}})],Tb.prototype,"waveDirection",void 0),u([h({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Tb.prototype,"waveStrength",void 0),Tb=YK=u([I("esri.symbols.WaterSymbol3DLayer")],Tb);const ZK=new Ze([0,119,190]),BOe=Tb;var JK;let cS=JK=class extends be{constructor(e){super(e),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new JK({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([h({type:String})],cS.prototype,"name",void 0),u([h({type:String})],cS.prototype,"styleUrl",void 0),u([h({type:String})],cS.prototype,"styleName",void 0),u([h({type:oo})],cS.prototype,"portal",void 0),cS=JK=u([I("esri.symbols.support.StyleOrigin")],cS);const KK=cS;var QK;let LD=QK=class extends be{constructor(){super(...arguments),this.url=""}clone(){return new QK({url:this.url})}};u([h({type:String})],LD.prototype,"url",void 0),LD=QK=u([I("esri.symbols.support.Thumbnail")],LD);const zOe={icon:Dw,object:woe,line:WF,path:xoe,fill:qF,extrude:fOe,text:sC,water:BOe},XZe=Ge.ofType({base:D0,key:"type",typeMap:zOe,errorContext:"symbol-layer"});let cy=class extends zd{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=t&&t.type||Ge;this._set("symbolLayers",new r)}get color(){return null}set color(e){this.constructed&&te.getLogger(this.declaredClass).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){hE(e,this._get("symbolLayers"))}readStyleOrigin(e,t,r){if(e.styleUrl&&e.name){const i=iC(e.styleUrl,r);return new KK({styleUrl:i,name:e.name})}if(e.styleName&&e.name)return new KK({portal:r&&r.portal||oo.getDefault(),styleName:e.styleName,name:e.name});r&&r.messages&&r.messages.push(new Ou("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,t,r,i){if(e.styleUrl&&e.name){let s=Wv(e.styleUrl,i);Rd(s)&&(s=tg(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&i&&i.portal&&!nEe(e.portal.restUrl,i.portal.restUrl)?i&&i.messages&&i.messages.push(new Ou("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof D0||e&&zOe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([h({json:{read:!1,write:!1}})],cy.prototype,"color",null),u([h({type:XZe,nonNullable:!0,json:{write:!0}}),Gt(UAe)],cy.prototype,"symbolLayers",null),u([h({type:KK})],cy.prototype,"styleOrigin",void 0),u([me("styleOrigin")],cy.prototype,"readStyleOrigin",null),u([Le("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],cy.prototype,"writeStyleOrigin",null),u([h({type:LD,json:{read:!1}})],cy.prototype,"thumbnail",void 0),u([h({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],cy.prototype,"type",void 0),cy=u([I("esri.symbols.Symbol3D")],cy);const RI=cy;let Z3=class extends fe{constructor(e){super(e),this.visible=!0}clone(){}};u([h({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],Z3.prototype,"type",void 0),u([h({readOnly:!0})],Z3.prototype,"visible",void 0),Z3=u([I("esri.symbols.callouts.Callout3D")],Z3);const VOe=Z3;var eQ;let X6=eQ=class extends fe{constructor(){super(...arguments),this.color=new Ze("white")}clone(){return new eQ({color:ne(this.color)})}};u([h(a1)],X6.prototype,"color",void 0),X6=eQ=u([I("esri.symbols.callouts.LineCallout3DBorder")],X6);const jOe=X6;Object.freeze(Object.defineProperty({__proto__:null,default:jOe},Symbol.toStringTag,{value:"Module"}));var tQ;let Sb=tQ=class extends VOe{constructor(e){super(e),this.type="line",this.color=new Ze([0,0,0,1]),this.size=xf(1),this.border=null}get visible(){return this.size>0&&v(this.color)&&this.color.a>0}clone(){return new tQ({color:ne(this.color),size:this.size,border:ne(this.border)})}};u([Ue({line:"line"},{readOnly:!0})],Sb.prototype,"type",void 0),u([h(a1)],Sb.prototype,"color",void 0),u([h(w0)],Sb.prototype,"size",void 0),u([h({type:jOe,json:{write:!0}})],Sb.prototype,"border",void 0),u([h({readOnly:!0})],Sb.prototype,"visible",null),Sb=tQ=u([I("esri.symbols.callouts.LineCallout3D")],Sb);const YZe=Sb;function Toe(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||v(t.maxWorldLength)&&t.maxWorldLength<=0)}function GOe(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!Toe(e)}function Soe(e){return e.type==="point-3d"||e.type==="label-3d"}function HOe(e){return e.horizontalAlignment==="center"}const qOe={types:{key:"type",base:VOe,typeMap:{line:YZe}},json:{write:!0}};var rQ;let UA=rQ=class extends fe{constructor(e){super(e),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new rQ({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([h(w0)],UA.prototype,"screenLength",void 0),u([h({type:Number,nonNullable:!0,json:{write:!0,default:0}})],UA.prototype,"minWorldLength",void 0),u([h({type:Number,json:{write:!0}})],UA.prototype,"maxWorldLength",void 0),UA=rQ=u([I("esri.symbols.support.Symbol3DVerticalOffset")],UA);const WOe=UA;var Y6;const XOe=Ge.ofType({base:null,key:"type",typeMap:{text:sC}});let Eb=Y6=class extends RI{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new XOe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return GOe(this)}hasVisibleVerticalOffset(){return Toe(this)}clone(){return new Y6({styleOrigin:ne(this.styleOrigin),symbolLayers:ne(this.symbolLayers),thumbnail:ne(this.thumbnail),callout:ne(this.callout),verticalOffset:ne(this.verticalOffset)})}static fromTextSymbol(e){return new Y6({symbolLayers:[sC.fromTextSymbol(e)]})}};u([h({type:WOe,json:{write:!0}})],Eb.prototype,"verticalOffset",void 0),u([h(qOe)],Eb.prototype,"callout",void 0),u([h({json:{read:!1,write:!1}})],Eb.prototype,"styleOrigin",void 0),u([h({type:XOe})],Eb.prototype,"symbolLayers",void 0),u([Ue({LabelSymbol3D:"label-3d"},{readOnly:!0})],Eb.prototype,"type",void 0),Eb=Y6=u([I("esri.symbols.LabelSymbol3D")],Eb);const hj=Eb;var Z6;const YOe=Ge.ofType({base:null,key:"type",typeMap:{line:WF,path:xoe}}),ZZe=Ge.ofType({base:null,key:"type",typeMap:{line:WF,path:xoe}});let J3=Z6=class extends RI{constructor(e){super(e),this.symbolLayers=new YOe,this.type="line-3d"}clone(){return new Z6({styleOrigin:ne(this.styleOrigin),symbolLayers:ne(this.symbolLayers),thumbnail:ne(this.thumbnail)})}static fromSimpleLineSymbol(e){return new Z6({symbolLayers:[WF.fromSimpleLineSymbol(e)]})}};u([h({type:YOe,json:{type:ZZe}})],J3.prototype,"symbolLayers",void 0),u([Ue({LineSymbol3D:"line-3d"},{readOnly:!0})],J3.prototype,"type",void 0),J3=Z6=u([I("esri.symbols.LineSymbol3D")],J3);const pj=J3;let Cb=class extends zd{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([h({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],Cb.prototype,"angle",void 0),u([h({type:["simple-marker","picture-marker"],readOnly:!0})],Cb.prototype,"type",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],Cb.prototype,"xoffset",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],Cb.prototype,"yoffset",void 0),u([h({type:Number,cast:e=>e==="auto"?e:Fi(e),json:{write:!0}})],Cb.prototype,"size",void 0),Cb=u([I("esri.symbols.MarkerSymbol")],Cb);const ZOe=Cb;var J6;const JOe=Ge.ofType({base:null,key:"type",typeMap:{fill:qF}});let K3=J6=class extends RI{constructor(e){super(e),this.symbolLayers=new JOe,this.type="mesh-3d"}clone(){return new J6({styleOrigin:ne(this.styleOrigin),symbolLayers:ne(this.symbolLayers),thumbnail:ne(this.thumbnail)})}static fromSimpleFillSymbol(e){return new J6({symbolLayers:[qF.fromSimpleFillSymbol(e)]})}};u([h({type:JOe})],K3.prototype,"symbolLayers",void 0),u([Ue({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],K3.prototype,"type",void 0),K3=J6=u([I("esri.symbols.MeshSymbol3D")],K3);const fj=K3;function JZe(e,t,r){return t.imageData?lEe({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):KOe(t.url,r)}function KOe(e,t){var r;return QZe(t)&&!Rd(e)&&((r=t==null?void 0:t.layer)==null?void 0:r.parsedUrl)?Mu(t.layer.parsedUrl.path,"images",e):iC(e,t)}function KZe(e,t,r,i){if(R0(e)){const s=j9(e);if(!s)return;t.contentType=s.mediaType,t.imageData=s.data,r&&r.imageData===t.imageData&&r.url&&Sx(r.url,t,"url",i)}else Sx(e,t,"url",i)}const QOe={json:{read:{source:["imageData","url"],reader:JZe},write:{writer(e,t,r,i){KZe(e,t,this.source,i)}}}},eMe={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,r){const i={};return t.imageData&&(i.imageData=t.imageData),t.contentType&&(i.contentType=t.contentType),t.url&&(i.url=KOe(t.url,r)),i}}}};function QZe(e){var t,r;return!(e==null||e.origin!=="service"&&e.origin!=="portal-item"||((t=e.layer)==null?void 0:t.type)!=="feature"&&((r=e.layer)==null?void 0:r.type)!=="stream")}var iQ;let Cp=iQ=class extends gOe{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,r,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),r!=null&&(s.width=Fi(r)),i!=null&&(s.height=Fi(i)),s}clone(){const e=new iQ({color:ne(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",ne(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([Ue({esriPFS:"picture-fill"},{readOnly:!0})],Cp.prototype,"type",void 0),u([h(QOe)],Cp.prototype,"url",void 0),u([h({type:Number,json:{write:!0}})],Cp.prototype,"xscale",void 0),u([h({type:Number,json:{write:!0}})],Cp.prototype,"yscale",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],Cp.prototype,"width",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],Cp.prototype,"height",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],Cp.prototype,"xoffset",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],Cp.prototype,"yoffset",void 0),u([h(eMe)],Cp.prototype,"source",void 0),Cp=iQ=u([I("esri.symbols.PictureFillSymbol")],Cp);const tMe=Cp;var sQ;let rm=sQ=class extends ZOe{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const i={};return e&&(i.url=e),t!=null&&(i.width=Fi(t)),r!=null&&(i.height=Fi(r)),i}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new sQ({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",ne(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([h({json:{write:!1}})],rm.prototype,"color",void 0),u([Ue({esriPMS:"picture-marker"},{readOnly:!0})],rm.prototype,"type",void 0),u([h(QOe)],rm.prototype,"url",void 0),u([h(eMe)],rm.prototype,"source",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],rm.prototype,"height",void 0),u([me("height",["height","size"])],rm.prototype,"readHeight",null),u([h({type:Number,cast:Fi,json:{write:!0}})],rm.prototype,"width",void 0),u([h({json:{write:!1}})],rm.prototype,"size",void 0),rm=sQ=u([I("esri.symbols.PictureMarkerSymbol")],rm);const gE=rm;var uS;const rMe=Ge.ofType({base:null,key:"type",typeMap:{icon:Dw,object:woe,text:sC}});let dS=uS=class extends RI{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new rMe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return GOe(this)}hasVisibleVerticalOffset(){return Toe(this)}clone(){return new uS({verticalOffset:ne(this.verticalOffset),callout:ne(this.callout),styleOrigin:ne(this.styleOrigin),symbolLayers:ne(this.symbolLayers),thumbnail:ne(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new uS({symbolLayers:[Dw.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new uS({symbolLayers:[Dw.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var i,s;if(((s=(i=e.data)==null?void 0:i.symbol)==null?void 0:s.type)!=="CIMPointSymbol")return null;const r=e.data.symbol;return new uS(r!=null&&r.callout?{symbolLayers:[Dw.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[Dw.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new uS({symbolLayers:[sC.fromTextSymbol(e)]})}};u([h({type:WOe,json:{write:!0}})],dS.prototype,"verticalOffset",void 0),u([h(qOe)],dS.prototype,"callout",void 0),u([h({type:rMe,json:{origins:{"web-scene":{write:!0}}}})],dS.prototype,"symbolLayers",void 0),u([Ue({PointSymbol3D:"point-3d"},{readOnly:!0})],dS.prototype,"type",void 0),dS=uS=u([I("esri.symbols.PointSymbol3D")],dS);const Lw=dS;var Q3;const iMe=Ge.ofType({base:null,key:"type",typeMap:{extrude:fOe,fill:qF,icon:Dw,line:WF,object:woe,text:sC,water:BOe}});let e$=Q3=class extends RI{constructor(e){super(e),this.symbolLayers=new iMe,this.type="polygon-3d"}clone(){return new Q3({styleOrigin:ne(this.styleOrigin),symbolLayers:ne(this.symbolLayers),thumbnail:ne(this.thumbnail)})}static fromJSON(e){const t=new Q3;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const r=t.symbolLayers.getItemAt(0),i=t.symbolLayers.getItemAt(1);!i.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:v(i.material)?i.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new Q3({symbolLayers:[qF.fromSimpleFillSymbol(e)]})}};u([h({type:iMe,json:{write:!0}})],e$.prototype,"symbolLayers",void 0),u([Ue({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],e$.prototype,"type",void 0),e$=Q3=u([I("esri.symbols.PolygonSymbol3D")],e$);const XF=e$;var nQ;const fq=new gr({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let hS=nQ=class extends gOe{constructor(...e){super(...e),this.color=new Ze([0,0,0,.25]),this.outline=new Ul,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string")return e;const i={};return e&&(i.style=e),t&&(i.outline=t),r&&(i.color=r),i}clone(){return new nQ({color:ne(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([h()],hS.prototype,"color",void 0),u([h()],hS.prototype,"outline",void 0),u([Ue({esriSFS:"simple-fill"},{readOnly:!0})],hS.prototype,"type",void 0),u([h({type:fq.apiValues,json:{read:fq.read,write:fq.write}})],hS.prototype,"style",void 0),hS=nQ=u([I("esri.symbols.SimpleFillSymbol")],hS);const L0=hS;var oQ;const mq=new gr({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let uy=oQ=class extends ZOe{constructor(...e){super(...e),this.color=new Ze([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Ul}normalizeCtorArgs(e,t,r,i){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=Fi(t)),r&&(s.outline=r),i&&(s.color=i),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new oQ({angle:this.angle,color:ne(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};u([h()],uy.prototype,"color",void 0),u([Le("color")],uy.prototype,"writeColor",null),u([Ue({esriSMS:"simple-marker"},{readOnly:!0})],uy.prototype,"type",void 0),u([h()],uy.prototype,"size",void 0),u([h({type:mq.apiValues,json:{read:mq.read,write:mq.write}})],uy.prototype,"style",void 0),u([h({type:String,json:{write:!0}})],uy.prototype,"path",null),u([h({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Ul}},json:{default:null,write:!0}})],uy.prototype,"outline",void 0),uy=oQ=u([I("esri.symbols.SimpleMarkerSymbol")],uy);const ko=uy;var aQ;let bn=aQ=class extends zd{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new uj,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string")return e;const i={};return e&&(i.text=e),t&&(i.font=t),r&&(i.color=r),i}writeLineWidth(e,t,r,i){i&&typeof i!="string"?i.origin:t[r]=e}castLineWidth(e){return Fi(e)}writeLineHeight(e,t,r,i){i&&typeof i!="string"?i.origin:t[r]=e}clone(){return new aQ({angle:this.angle,backgroundColor:ne(this.backgroundColor),borderLineColor:ne(this.borderLineColor),borderLineSize:this.borderLineSize,color:ne(this.color),font:this.font&&this.font.clone(),haloColor:ne(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([h({type:Ze,json:{write:!0}})],bn.prototype,"backgroundColor",void 0),u([h({type:Ze,json:{write:!0}})],bn.prototype,"borderLineColor",void 0),u([h({type:Number,json:{write:!0}})],bn.prototype,"borderLineSize",void 0),u([h({type:uj,json:{write:!0}})],bn.prototype,"font",void 0),u([h({...POe,json:{write:!0}})],bn.prototype,"horizontalAlignment",void 0),u([h({type:Boolean,json:{write:!0}})],bn.prototype,"kerning",void 0),u([h({type:Ze,json:{write:!0}})],bn.prototype,"haloColor",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],bn.prototype,"haloSize",void 0),u([h({type:Boolean,json:{write:!0}})],bn.prototype,"rightToLeft",void 0),u([h({type:Boolean,json:{write:!0}})],bn.prototype,"rotated",void 0),u([h({type:String,json:{write:!0}})],bn.prototype,"text",void 0),u([Ue({esriTS:"text"},{readOnly:!0})],bn.prototype,"type",void 0),u([h({...$Oe,json:{write:!0}})],bn.prototype,"verticalAlignment",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],bn.prototype,"xoffset",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],bn.prototype,"yoffset",void 0),u([h({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],bn.prototype,"angle",void 0),u([h({type:Number,json:{write:!0}})],bn.prototype,"width",void 0),u([h({type:Number})],bn.prototype,"lineWidth",void 0),u([Le("lineWidth")],bn.prototype,"writeLineWidth",null),u([Gt("lineWidth")],bn.prototype,"castLineWidth",null),u([h(IOe)],bn.prototype,"lineHeight",void 0),u([Le("lineHeight")],bn.prototype,"writeLineHeight",null),bn=aQ=u([I("esri.symbols.TextSymbol")],bn);const nC=bn;var lQ;let im=lQ=class extends zd{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const e=v(this.portal)?this.portal:oo.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new lQ({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const r=v(t)?t.cache:null,i=r?this._fetchCacheKey:null;if(v(r)){const a=i&&r.get(i);if(a)return a.clone()}const s=await eJe();Ir(t);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},e,t);n.catch(a=>{te.getLogger(this.declaredClass).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return e==="webRef"&&o.type==="point-3d"||e==="cimRef"&&o.type==="cim"?(v(r)&&r.set(i,o.clone()),o):null}};function eJe(){return re(()=>import("./webStyleSymbolUtils.f7cd7d15.js"),[])}u([h({json:{write:!1}})],im.prototype,"color",void 0),u([h({type:String,json:{write:!0}})],im.prototype,"styleName",void 0),u([h({type:oo,json:{write:!1}})],im.prototype,"portal",void 0),u([h({type:String,json:{read:dj,write:Sx}})],im.prototype,"styleUrl",void 0),u([h({type:LD,json:{read:!1}})],im.prototype,"thumbnail",void 0),u([h({type:String,json:{write:!0}})],im.prototype,"name",void 0),u([Ue({styleSymbolReference:"web-style"},{readOnly:!0})],im.prototype,"type",void 0),u([h()],im.prototype,"_fetchCacheKey",null),im=lQ=u([I("esri.symbols.WebStyleSymbol")],im);const oC=im;function mj(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function OR(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const un={base:zd,key:"type",typeMap:{"simple-fill":L0,"picture-fill":tMe,"picture-marker":gE,"simple-line":Ul,"simple-marker":ko,text:nC,"label-3d":hj,"line-3d":pj,"mesh-3d":fj,"point-3d":Lw,"polygon-3d":XF,"web-style":oC,cim:MI},errorContext:"symbol"},tJe={base:zd,key:"type",typeMap:{"picture-marker":gE,"simple-marker":ko,text:nC,"web-style":oC,cim:MI},errorContext:"symbol"},rJe=Wx({types:un}),gj={base:zd,key:"type",typeMap:{"simple-fill":L0,"picture-fill":tMe,"picture-marker":gE,"simple-line":Ul,"simple-marker":ko,text:nC,"line-3d":pj,"mesh-3d":fj,"point-3d":Lw,"polygon-3d":XF,"web-style":oC,cim:MI},errorContext:"symbol"},iJe={base:zd,key:"type",typeMap:{text:nC,"label-3d":hj},errorContext:"symbol"},rfe={base:zd,key:"type",typeMap:{"line-3d":pj,"mesh-3d":fj,"point-3d":Lw,"polygon-3d":XF,"web-style":oC,cim:MI},errorContext:"symbol"},sJe={base:zd,key:"type",typeMap:{"label-3d":hj},errorContext:"symbol"},sMe=ug(un);function nJe(e){if(!e)return null;const t={};for(const r in e){const i=ql(e[r]);i&&(t[r]=i)}return Object.keys(t).length!==0?t:null}function oJe(e){if(!v(e))return null;const t={};for(const r in e){const i=e[r];i&&(t[r]=i.toJSON())}return Object.keys(t).length!==0?t:null}let Wu=class extends ki(fe){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Su(),configurable:!0})}normalizeCtorArgs(e,t,r,i){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:r,popupTemplate:i}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&v(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){var t;return(t=this.attributes)==null?void 0:t[e]}setAttribute(e,t){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",r,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:oJe(this.aggregateGeometries),geometry:v(this.geometry)?this.geometry.toJSON():null,symbol:v(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){v(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:r};e==="attributes"&&(s.attributeName=i),this.layer.graphicChanged(s)}};u([h({value:null,json:{read:nJe}})],Wu.prototype,"aggregateGeometries",null),u([h({value:null})],Wu.prototype,"attributes",null),u([h({value:null,types:Yx,json:{read:ql}})],Wu.prototype,"geometry",null),u([h({type:Boolean})],Wu.prototype,"isAggregate",void 0),u([h({clonable:"reference"})],Wu.prototype,"layer",void 0),u([h({type:Nc})],Wu.prototype,"popupTemplate",void 0),u([h({clonable:"reference"})],Wu.prototype,"sourceLayer",void 0),u([h({value:null,types:un})],Wu.prototype,"symbol",null),u([h({type:Boolean,value:!0})],Wu.prototype,"visible",null),Wu=u([I("esri.Graphic")],Wu),function(e){e.generateUID=Su}(Wu||(Wu={}));const _i=Wu;var cQ;let t$=cQ=class extends fe{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new cQ({minValue:this.minValue,maxValue:this.maxValue})}};u([h({type:Number,json:{write:!0}})],t$.prototype,"minValue",void 0),u([h({type:Number,json:{write:!0}})],t$.prototype,"maxValue",void 0),t$=cQ=u([I("esri.renderer.support.AuthoringInfoClassBreakInfo")],t$);var uQ;let sw=uQ=class extends fe{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new uQ({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ne(this.classBreakInfos)})}};u([h({type:String,json:{write:!0}})],sw.prototype,"field",void 0),u([h({type:String,json:{write:!0}})],sw.prototype,"normalizationField",void 0),u([h({type:String,json:{write:!0}})],sw.prototype,"label",void 0),u([h({type:[t$],json:{write:!0}})],sw.prototype,"classBreakInfos",void 0),sw=uQ=u([I("esri.renderers.support.AuthoringInfoFieldInfo")],sw);var dQ;const x5=new gr({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),T5=new gr({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),ife={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},sfe=["high-to-low","above-and-below","centered-on","extremes"],nfe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],ofe=["seconds","minutes","hours","days","months","years"];let Xu=dQ=class extends fe{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new dQ({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([h({types:ife,json:{write:!0}})],Xu.prototype,"endTime",void 0),u([Gt("endTime")],Xu.prototype,"castEndTime",null),u([h({type:String,json:{write:!0}})],Xu.prototype,"field",void 0),u([h({type:Number,json:{write:!0}})],Xu.prototype,"maxSliderValue",void 0),u([h({type:Number,json:{write:!0}})],Xu.prototype,"minSliderValue",void 0),u([h({types:ife,json:{write:!0}})],Xu.prototype,"startTime",void 0),u([Gt("startTime")],Xu.prototype,"castStartTime",null),u([h({type:x5.apiValues,value:null,json:{type:x5.jsonValues,read:x5.read,write:x5.write}})],Xu.prototype,"style",null),u([h({type:nfe,value:null,json:{type:nfe,origins:{"web-scene":{type:sfe,write:{writer:(e,t)=>{sfe.includes(e)&&(t.theme=e)}}}},write:!0}})],Xu.prototype,"theme",null),u([h({type:T5.apiValues,json:{type:T5.jsonValues,read:T5.read,write:T5.write}})],Xu.prototype,"type",void 0),u([h({type:ofe,json:{type:ofe,write:!0}})],Xu.prototype,"units",void 0),Xu=dQ=u([I("esri.renderers.support.AuthoringInfoVisualVariable")],Xu);const aJe=Xu;let K6=class extends fe{constructor(e){super(e),this.type=null}};u([h({readOnly:!0,json:{read:!1,write:!0}})],K6.prototype,"type",void 0),K6=u([I("esri.rest.support.ColorRamp")],K6);const Eoe=K6;var hQ;let pS=hQ=class extends Eoe{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new hQ({fromColor:ne(this.fromColor),toColor:ne(this.toColor),algorithm:this.algorithm})}};u([Ue({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],pS.prototype,"algorithm",void 0),u([h({type:Ze,json:{type:[bs],write:!0}})],pS.prototype,"fromColor",void 0),u([h({type:Ze,json:{type:[bs],write:!0}})],pS.prototype,"toColor",void 0),u([h({type:["algorithmic"]})],pS.prototype,"type",void 0),pS=hQ=u([I("esri.rest.support.AlgorithmicColorRamp")],pS);const Coe=pS;var pQ;let r$=pQ=class extends Eoe{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new pQ({colorRamps:ne(this.colorRamps)})}};u([h({type:[Coe],json:{write:!0}})],r$.prototype,"colorRamps",void 0),u([h({type:["multipart"]})],r$.prototype,"type",void 0),r$=pQ=u([I("esri.rest.support.MultipartColorRamp")],r$);const nMe=r$,lJe={key:"type",base:Eoe,typeMap:{algorithmic:Coe,multipart:nMe}};function cJe(e){return e&&e.type?e.type==="algorithmic"?Coe.fromJSON(e):e.type==="multipart"?nMe.fromJSON(e):null:null}var fQ;const cT=new gr({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),S5=new gr({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),afe=new gr({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),lfe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],uJe=["high-to-low","above-and-below","above","below","90-10"],dJe=["flow-line","wave-front"],hJe=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Xn=fQ=class extends fe{constructor(e){super(e),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){return e?cJe(e):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new fQ({classificationMethod:this.classificationMethod,colorRamp:ne(this.colorRamp),fadeRatio:ne(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:ne(this.field1),field2:ne(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([h({type:cT.apiValues,value:null,json:{type:cT.jsonValues,read:cT.read,write:cT.write,origins:{"web-document":{default:"manual",type:cT.jsonValues,read:cT.read,write:cT.write}}}})],Xn.prototype,"classificationMethod",null),u([h({types:lJe,json:{write:!0}})],Xn.prototype,"colorRamp",void 0),u([me("colorRamp")],Xn.prototype,"readColorRamp",null),u([h({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Xn.prototype,"fadeRatio",void 0),u([h({type:[String],value:null,json:{write:!0}})],Xn.prototype,"fields",null),u([h({type:sw,value:null,json:{write:!0}})],Xn.prototype,"field1",null),u([h({type:sw,value:null,json:{write:!0}})],Xn.prototype,"field2",null),u([h({type:dJe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Xn.prototype,"flowTheme",null),u([h({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Xn.prototype,"focus",null),u([h({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Xn.prototype,"isAutoGenerated",void 0),u([h({type:Number,value:null,json:{type:bs,write:!0}})],Xn.prototype,"numClasses",null),u([h({type:lfe,json:{type:lfe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Xn.prototype,"lengthUnit",void 0),u([h({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Xn.prototype,"maxSliderValue",void 0),u([h({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Xn.prototype,"minSliderValue",void 0),u([h({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Xn.prototype,"statistics",null),u([h({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Xn.prototype,"standardDeviationInterval",null),u([h({type:S5.apiValues,value:null,json:{type:S5.jsonValues,read:S5.read,write:S5.write,origins:{"web-scene":{type:afe.jsonValues,write:{writer:afe.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],Xn.prototype,"type",null),u([h({type:[aJe],json:{write:!0}})],Xn.prototype,"visualVariables",void 0),u([h({type:hJe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Xn.prototype,"univariateSymbolStyle",null),u([h({type:uJe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Xn.prototype,"univariateTheme",null),Xn=fQ=u([I("esri.renderers.support.AuthoringInfo")],Xn);const Aoe=Xn,gq=new gr({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let i$=class extends fe{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([h({type:Aoe,json:{write:!0}})],i$.prototype,"authoringInfo",void 0),u([h({type:gq.apiValues,readOnly:!0,json:{type:gq.jsonValues,read:!1,write:{writer:gq.write,ignoreOrigin:!0}}})],i$.prototype,"type",void 0),i$=u([I("esri.renderers.Renderer")],i$);const l1=i$;function pJe(e){var t,r,i;return(i=(r=(t=e.match(fJe))==null?void 0:t[1])==null?void 0:r.replace(/\\'/g,"'"))!=null?i:null}const fJe=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var mQ;let IM=mQ=class extends fe{constructor(){super(...arguments),this.title=null}clone(){return new mQ({title:this.title})}};u([h({type:String,json:{write:!0}})],IM.prototype,"title",void 0),IM=mQ=u([I("esri.renderers.support.LegendOptions")],IM);var gQ;let Q6=gQ=class extends IM{constructor(){super(...arguments),this.showLegend=null}clone(){return new gQ({title:this.title,showLegend:this.showLegend})}};u([h({type:Boolean,json:{write:!0}})],Q6.prototype,"showLegend",void 0),Q6=gQ=u([I("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],Q6);const oMe=Q6,yq=new gr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let sm=class extends fe{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(te.getLogger(this.declaredClass).error(".field: field must be a string value"),null):RF(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([h()],sm.prototype,"index",void 0),u([h({type:yq.apiValues,readOnly:!0,json:{read:yq.read,write:yq.write}})],sm.prototype,"type",void 0),u([h({type:String,json:{write:!0}})],sm.prototype,"field",void 0),u([Gt("field")],sm.prototype,"castField",null),u([h({type:String,json:{write:!0}})],sm.prototype,"valueExpression",void 0),u([h({type:String,json:{write:!0}})],sm.prototype,"valueExpressionTitle",void 0),u([h({readOnly:!0})],sm.prototype,"arcadeRequired",null),u([h({type:oMe,json:{write:!0}})],sm.prototype,"legendOptions",void 0),sm=u([I("esri.renderers.visualVariables.VisualVariable")],sm);const YF=sm;var yQ;let fS=yQ=class extends fe{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,r){t[r]=e!=null?e:0}clone(){return new yQ({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([h({type:Ze,json:{type:[bs],write:!0}})],fS.prototype,"color",void 0),u([h({type:String,json:{write:!0}})],fS.prototype,"label",void 0),u([h({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],fS.prototype,"value",void 0),u([Le("value")],fS.prototype,"writeValue",null),fS=yQ=u([I("esri.renderers.visualVariables.support.ColorStop")],fS);const mJe=fS;var _Q;let mS=_Q=class extends YF{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value),this._set("stops",e)}clone(){return new _Q({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([h({readOnly:!0})],mS.prototype,"cache",null),u([h({type:["color"],json:{type:["colorInfo"]}})],mS.prototype,"type",void 0),u([h({type:String,json:{write:!0}})],mS.prototype,"normalizationField",void 0),u([h({type:[mJe],json:{write:!0}})],mS.prototype,"stops",null),mS=_Q=u([I("esri.renderers.visualVariables.ColorVariable")],mS);const aMe=mS;var vQ;let Ab=vQ=class extends fe{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return xR(t.transparency)}writeOpacity(e,t,r){t[r]=rj(e)}clone(){return new vQ({label:this.label,opacity:this.opacity,value:this.value})}};u([h({type:String,json:{write:!0}})],Ab.prototype,"label",void 0),u([h({type:Number,json:{type:bs,write:{target:"transparency"}}})],Ab.prototype,"opacity",void 0),u([me("opacity",["transparency"])],Ab.prototype,"readOpacity",null),u([Le("opacity")],Ab.prototype,"writeOpacity",null),u([h({type:Number,json:{write:!0}})],Ab.prototype,"value",void 0),Ab=vQ=u([I("esri.renderers.visualVariables.support.OpacityStop")],Ab);const gJe=Ab;var bQ;let gS=bQ=class extends YF{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value),this._set("stops",e)}clone(){return new bQ({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([h({readOnly:!0})],gS.prototype,"cache",null),u([h({type:["opacity"],json:{type:["transparencyInfo"]}})],gS.prototype,"type",void 0),u([h({type:String,json:{write:!0}})],gS.prototype,"normalizationField",void 0),u([h({type:[gJe],json:{write:!0}})],gS.prototype,"stops",null),gS=bQ=u([I("esri.renderers.visualVariables.OpacityVariable")],gS);const lMe=gS;var wQ;let x_=wQ=class extends YF{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,r,i){if(i&&i.messages){const s=`visualVariables[${this.index}]`;i.messages.push(new z("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:i}))}}clone(){return new wQ({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([h({readOnly:!0})],x_.prototype,"cache",null),u([h({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],x_.prototype,"axis",void 0),u([h({type:["rotation"],json:{type:["rotationInfo"]}})],x_.prototype,"type",void 0),u([h({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],x_.prototype,"rotationType",void 0),u([h({type:String,json:{write:!0}})],x_.prototype,"valueExpressionTitle",void 0),u([Le("web-scene","valueExpressionTitle")],x_.prototype,"writeValueExpressionTitleWebScene",null),x_=wQ=u([I("esri.renderers.visualVariables.RotationVariable")],x_);const cMe=x_;var xQ;let BA=xQ=class extends fe{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new xQ({label:this.label,size:this.size,value:this.value})}};u([h({type:String,json:{write:!0}})],BA.prototype,"label",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],BA.prototype,"size",void 0),u([h({type:Number,json:{write:!0}})],BA.prototype,"value",void 0),BA=xQ=u([I("esri.renderers.visualVariables.support.SizeStop")],BA);const zA=BA;var TQ;let eB=TQ=class extends oMe{constructor(){super(...arguments),this.customValues=null}clone(){return new TQ({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([h({type:[Number],json:{write:!0}})],eB.prototype,"customValues",void 0),eB=TQ=u([I("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],eB);const yJe=eB;var Sv,Fa;function Nw(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function uN(e){return e!=null&&!isNaN(e)&&isFinite(e)}function uMe(e){return e.valueExpression?Sv.Expression:e.field&&typeof e.field=="string"?Sv.Field:Sv.Unknown}function _Je(e,t){const r=t||uMe(e),i=e.valueUnit||"unknown";return r===Sv.Unknown?Fa.Constant:e.stops?Fa.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?Fa.ClampedLinear:i==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?Fa.Proportional:Fa.Additive:Fa.Identity:Fa.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(Sv||(Sv={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(Fa||(Fa={}));function Ooe(e){return new Ve({wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`})}const dMe=Ooe(Pr),Fz=Ooe(n0),kz=Ooe(Vv),vJe=new Ve({wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Pr.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`});function T0(e){return e&&(I0(e)||e===Fz)?Fz:e&&(P0(e)||e===kz)?kz:dMe}function Kr(e){return v(e)&&(I0(e)||e===Fz)?n0:v(e)&&(P0(e)||e===kz)?Vv:Pr}function n6t(e){return Pne(e)?n0:$ne(e)?Vv:Pr}const Moe=39.37,bJe=Pr.radius*Math.PI/200,hMe=/UNIT\[([^\]]+)\]\]$/i,F2=U,pMe=/UNIT\[([^\]]+)\]/i,wJe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),xJe=Br()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Mg=e=>e*e,P1=e=>e*e*e,dN={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Mg(.001)},"square-centimeters":{inBaseUnits:Mg(.01)},"square-decimeters":{inBaseUnits:Mg(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Mg(1e3)},"square-inches":{inBaseUnits:Mg(.0254)},"square-feet":{inBaseUnits:Mg(.3048)},"square-yards":{inBaseUnits:Mg(.9144)},"square-miles":{inBaseUnits:Mg(1609.344)},"square-us-feet":{inBaseUnits:Mg(1200/3937)},acres:{inBaseUnits:.0015625*Mg(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*P1(.001)},"cubic-centimeters":{inBaseUnits:1e3*P1(.01)},"cubic-decimeters":{inBaseUnits:1e3*P1(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*P1(1e3)},"cubic-inches":{inBaseUnits:1e3*P1(.0254)},"cubic-feet":{inBaseUnits:1e3*P1(.3048)},"cubic-yards":{inBaseUnits:1e3*P1(.9144)},"cubic-miles":{inBaseUnits:1e3*P1(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},TJe=(()=>{const e={};for(const t in dN)for(const r in dN[t].units)e[r]=t;return e})();function SJe(e,t,r){return e*dN[r].units[t].inBaseUnits}function EJe(e,t,r){return e/dN[r].units[t].inBaseUnits}const CJe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function yE(e){const t=TJe[e];if(!t)throw new Error("unknown type");return t}function cfe(e,t=null){return t=t||yE(e),dN[t].baseUnit===e}function zn(e,t,r){if(t===r)return e;const i=yE(t);if(i!==yE(r))throw new Error("incompatible units");const s=cfe(t,i)?e:SJe(e,t,i);return cfe(r,i)?s:EJe(s,r,i)}function o6t(e,t,r){switch(r){case"metric":return fMe(e,t);case"imperial":return gMe(e,t);default:return r}}function a6t(e,t,r){switch(r){case"metric":return mMe(e,t);case"imperial":return yMe(e,t);default:return r}}function fMe(e,t){const r=zn(e,t,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function mMe(e,t){const r=zn(e,t,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function gMe(e,t){const r=zn(e,t,"feet");return Math.abs(r)<1e3?"feet":"miles"}function yMe(e,t){const r=zn(e,t,"feet");return Math.abs(r)<1e5?"feet":"miles"}function l6t(e,t){const r=zn(e,t,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function c6t(e,t){const r=zn(e,t,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function AJe(e,t,r){return zn(e,t,"meters")/(r*Math.PI/180)}function _Me(e){return xJe.fromJSON(e.toLowerCase())||null}function _E(e){if(v(e)&&!eN(e))return 1;const t=Fc(e);return t>1e5?1:t}function OJe(e){return Fc(e)>=Kr(e).metersPerDegree?"meters":Roe(e)}function Fc(e,t=Pr.metersPerDegree){return yt(MJe(e,!0),t)}function MJe(e,t=!1){const r=v(e)?e.wkid:null,i=v(e)?e.wkt:null;let s=null;if(r){if(Pne(r))return n0.metersPerDegree;if($ne(r))return Vv.metersPerDegree;s=F2.values[F2[r]],!s&&t&&wJe.has(r)&&(s=bJe)}else i&&(wMe(i)?s=ufe(hMe.exec(i),s):bMe(i)&&(s=ufe(pMe.exec(i),s)));return s}function ufe(e,t){return e&&e[1]?vMe(e[1]):t}function vMe(e){return parseFloat(e.split(",")[1])}function Roe(e){const t=v(e)?e.wkid:null,r=v(e)?e.wkt:null;let i=null;if(t)i=F2.units[F2[t]];else if(r){const s=wMe(r)?hMe:bMe(r)?pMe:null;if(s){const n=s.exec(r);n&&n[1]&&(i=IJe(n[1]))}}return v(i)?_Me(i):null}function u6t(e){const t=Roe(e);return C(t)||!CJe.includes(t)?null:t}function bMe(e){return/^GEOCCS/i.test(e)}function wMe(e){return/^PROJCS/i.test(e)}const RJe=1e-7;function IJe(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let r=t&&t[1];if(!r||!F2.units.includes(r)){const i=vMe(e);r=null;const s=F2.values;for(let n=0;n<s.length;++n)if(Math.abs(i-s[n])<RJe){r=F2.units[n];break}}return r}function PJe(e){const t=Roe(e);if(C(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}function $Je(e){var s,n,o;const t="metric";if(C(e))return t;const r=e.map,i=r&&"portalItem"in r?(s=r.portalItem)==null?void 0:s.portal:null;if(i)switch((o=(n=i==null?void 0:i.user)==null?void 0:n.units)!=null?o:i.units){case t:return t;case"english":return"imperial"}return yt(PJe(e.spatialReference),t)}const xMe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},TMe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},DJe=Br()(xMe),LJe=Br()(TMe);Br()({...xMe,...TMe});const MR={inches:zn(1,"meters","inches"),feet:zn(1,"meters","feet"),"us-feet":zn(1,"meters","us-feet"),yards:zn(1,"meters","yards"),miles:zn(1,"meters","miles"),"nautical-miles":zn(1,"meters","nautical-miles"),millimeters:zn(1,"meters","millimeters"),centimeters:zn(1,"meters","centimeters"),decimeters:zn(1,"meters","decimeters"),meters:zn(1,"meters","meters"),kilometers:zn(1,"meters","kilometers"),"decimal-degrees":1/AJe(1,"meters",Pr.radius)},Ex=te.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),dfe=new _i,tB=Math.PI,SMe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function EMe(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(g=>g.type==="color"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Ex.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=i.field,{ipData:c,hasExpression:d}=i.cache;let p=i.cache.compiledFunc;if(!l&&!d){const g=i.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(d){if(C(r)||C(r.arcade))return void Ex.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,x=_.getViewInfo(g),b=_.createExecContext(n,x);if(!p){const w=_.createSyntaxTree(i.valueExpression);p=_.createFunction(w),i.cache.compiledFunc=p}a=_.executeFunction(p,b)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=Poe(a,c);if(g){const _=g[0],x=g[1],b=_===x?i.stops[_].color:Ze.blendColors(i.stops[_].color,i.stops[x].color,g[2],v(r)?r.color:void 0);return new Ze(b)}}}function CMe(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(g=>g.type==="opacity"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Ex.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=i.field,{ipData:c,hasExpression:d}=i.cache;let p=i.cache.compiledFunc;if(!l&&!d){const g=i.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(d){if(C(r)||C(r.arcade))return void Ex.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,x=_.getViewInfo(g),b=_.createExecContext(n,x);if(!p){const w=_.createSyntaxTree(i.valueExpression);p=_.createFunction(w),i.cache.compiledFunc=p}a=_.executeFunction(p,b)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const g=Poe(a,c);if(g){const _=g[0],x=g[1];if(_===x)return i.stops[_].opacity;{const b=i.stops[_].opacity;return b+(i.stops[x].opacity-b)*g[2]}}}}function AMe(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(m=>m.type==="rotation"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Ex.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=i.axis||"heading",n=s==="heading"&&i.rotationType==="arithmetic"?90:0,o=s==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=i.field,{hasExpression:d}=i.cache;let p=i.cache.compiledFunc,f=0;if(!c&&!d)return f;if(d){if(C(r)||C(r.arcade))return void Ex.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=r.arcade.arcadeUtils,_=g.getViewInfo(m),x=g.createExecContext(a,_);if(!p){const b=g.createSyntaxTree(i.valueExpression);p=g.createFunction(b),i.cache.compiledFunc=p}f=g.executeFunction(p,x)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function NJe(e,t,r){const i=typeof t=="number",s=i?null:t,n=s&&s.attributes;let o=i?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const d=v(r)?r.scale:void 0,p=v(r)?r.view:void 0;o=d==null||p==="3d"?FJe(e):d}else if(!i)switch(e.inputValueType){case Sv.Expression:{if(C(r)||C(r.arcade))return void Ex.error("Use of arcade expressions requires an arcade context");const d={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},p=r.arcade.arcadeUtils,f=p.getViewInfo(d),m=p.createExecContext(s,f);if(!l){const g=p.createSyntaxTree(e.valueExpression);l=p.createFunction(g),e.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case Sv.Field:n&&(o=n[e.field]);break;case Sv.Unknown:o=null}if(!uN(o))return null;if(i||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return uN(c)&&c!==0?o/c:null}function FJe(e){let t=null,r=null;const i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}function yj(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Ex.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=MMe(NJe(i,t,r),i,t,r,i.cache.ipData);return s==null||isNaN(s)?0:s}function $d(e,t,r){return e==null?null:Nw(e)?yj(e,t,r):uN(e)?e:null}function OMe(e,t,r){return uN(r)&&e>r?r:uN(t)&&e<t?t:e}function kJe(e,t,r,i){var s;return e+((s=$d(t.minSize,r,i)||t.minDataValue)!=null?s:0)}function UJe(e,t,r){const i=e.stops;let s=i&&i.length&&i[0].size;return s==null&&(s=e.minSize),$d(s,t,r)}function BJe(e,t,r,i){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=$d(t.minSize,r,i),o=$d(t.maxSize,r,i),a=v(i)?i.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(n==null||o==null)return null;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?tB*(n/2)**2:n*n,d=c+s*((l?tB*(o/2)**2:o*o)-c);return l?2*Math.sqrt(d/tB):Math.sqrt(d)}return n+s*(o-n)}function zJe(e,t,r,i){const s=v(i)?i.shape:void 0,n=e/t.minDataValue,o=$d(t.minSize,r,i),a=$d(t.maxSize,r,i);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,OMe(l,o,a)}function VJe(e,t,r,i,s){var l,c,d;const[n,o,a]=Poe(e,s);if(n===o)return $d((l=t.stops)==null?void 0:l[n].size,r,i);{const p=$d((c=t.stops)==null?void 0:c[n].size,r,i);return p+($d((d=t.stops)==null?void 0:d[o].size,r,i)-p)*a}}function jJe(e,t,r,i){const s=(v(i)&&i.resolution?i.resolution:1)*MR[t.valueUnit],n=$d(t.minSize,r,i),o=$d(t.maxSize,r,i),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/tB)/s:a==="radius"||a==="distance"?2*e/s:e/s,OMe(l,n,o)}function MMe(e,t,r,i,s){switch(t.transformationType){case Fa.Additive:return kJe(e,t,r,i);case Fa.Constant:return UJe(t,r,i);case Fa.ClampedLinear:return BJe(e,t,r,i);case Fa.Proportional:return zJe(e,t,r,i);case Fa.Stops:return VJe(e,t,r,i,s);case Fa.RealWorldSize:return jJe(e,t,r,i);case Fa.Identity:return e;case Fa.Unknown:return null}}function GJe(e,t,r){const{isScaleDriven:i}=e.cache;if(!(i&&r==="3d"||t))return null;const s={scale:t,view:r};let n=$d(e.minSize,dfe,s),o=$d(e.maxSize,dfe,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function Ioe(e,t,r){if(!e.visualVariables)return;const i=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=EMe(l,t,r);i.push({variable:l,value:c})}),n.forEach(l=>{const c=CMe(l,t,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=AMe(l,t,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=yj(l,t,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function Poe(e,t){if(!t)return;let r=0,i=t.length-1;return t.some((s,n)=>e<s?(i=n,!0):(r=n,!1)),[r,i,(e-t[r])/(t[i]-t[r])]}function HJe(e,t,r){const i=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":yj(s,t,r);switch(s.axis){case"width":i[0]=n;break;case"depth":i[1]=n;break;case"height":i[2]=n;break;case"width-and-depth":i[0]=n,i[1]=n;break;case"all":case void 0:case null:i[0]=n,i[1]=n,i[2]=n;break;default:s.axis}}return i}const $oe=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:HJe,getColor:EMe,getOpacity:CMe,getRotationAngle:AMe,getSize:yj,getSizeForValue:MMe,getSizeFromNumberOrVariable:$d,getSizeRangeAtScale:GJe,getVisualVariableValues:Ioe,viewScaleRE:SMe},Symbol.toStringTag,{value:"Module"}));var SQ;const E5=new gr({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),EQ=new gr({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function hfe(e){if(e!=null)return typeof e=="string"||typeof e=="number"?Fi(e):e.type==="size"?Nw(e)?e:(delete(e={...e}).type,new zi(e)):void 0}function pfe(e,t,r){if(typeof e!="object")return e;const i=new zi;return i.read(e,r),i}let zi=SQ=class extends YF{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&SMe.test(this.valueExpression)}}set expression(e){te.getLogger(this.declaredClass).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){Nw(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),Nw(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return uMe(this)}set maxDataValue(e){e&&this.stops&&(te.getLogger(this.declaredClass).warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(te.getLogger(this.declaredClass).warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return hfe(e)}readMaxSize(e,t,r){return pfe(e,t,r)}set minDataValue(e){e&&this.stops&&(te.getLogger(this.declaredClass).warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(te.getLogger(this.declaredClass).warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return hfe(e)}readMinSize(e,t,r){return pfe(e,t,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value):e&&(te.getLogger(this.declaredClass).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return _Je(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,r,i){if(e==="$view.scale"){if(i&&i.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;i.messages.push(new z("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:i}))}}else t[r]=e}readValueUnit(e){return e?EQ.read(e):null}clone(){return new SQ({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Nw(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Nw(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===Fa.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===Fa.Stops){const e=this.stops;if(!e)return this;const t=e.map(i=>i.size).reverse(),r=e.length;for(let i=0;i<r;i++)e[i].size=t[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([h({readOnly:!0})],zi.prototype,"cache",null),u([h({type:E5.apiValues,json:{type:E5.jsonValues,origins:{"web-map":{read:!1}},read:E5.read,write:E5.write}})],zi.prototype,"axis",void 0),u([h({type:String,value:null,json:{read:!1}})],zi.prototype,"expression",null),u([h()],zi.prototype,"index",null),u([h({type:String,readOnly:!0})],zi.prototype,"inputValueType",null),u([h({type:yJe,json:{write:!0}})],zi.prototype,"legendOptions",void 0),u([h({type:Number,value:null,json:{write:!0}})],zi.prototype,"maxDataValue",null),u([h({type:Number,value:null,json:{write:!0}})],zi.prototype,"maxSize",null),u([Gt("maxSize")],zi.prototype,"castMaxSize",null),u([me("maxSize")],zi.prototype,"readMaxSize",null),u([h({type:Number,value:null,json:{write:!0}})],zi.prototype,"minDataValue",null),u([h({type:Number,value:null,json:{write:!0}})],zi.prototype,"minSize",null),u([Gt("minSize")],zi.prototype,"castMinSize",null),u([me("minSize")],zi.prototype,"readMinSize",null),u([h({type:String,json:{write:!0}})],zi.prototype,"normalizationField",void 0),u([h({readOnly:!0})],zi.prototype,"arcadeRequired",null),u([h({type:String})],zi.prototype,"scaleBy",void 0),u([h({type:[zA],value:null,json:{write:!0}})],zi.prototype,"stops",null),u([h({type:["outline"],json:{write:!0}})],zi.prototype,"target",void 0),u([h({type:String,readOnly:!0})],zi.prototype,"transformationType",null),u([h({type:["size"],json:{type:["sizeInfo"]}})],zi.prototype,"type",void 0),u([h({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],zi.prototype,"useSymbolValue",void 0),u([h({type:String,json:{write:!0}})],zi.prototype,"valueExpression",void 0),u([me("valueExpression",["valueExpression","expression"])],zi.prototype,"readValueExpression",null),u([Le("web-scene","valueExpression")],zi.prototype,"writeValueExpressionWebScene",null),u([h({type:["radius","diameter","area","width","distance"],json:{write:!0}})],zi.prototype,"valueRepresentation",void 0),u([h({type:EQ.apiValues,json:{write:EQ.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],zi.prototype,"valueUnit",void 0),u([me("valueUnit")],zi.prototype,"readValueUnit",null),zi=SQ=u([I("esri.renderers.visualVariables.SizeVariable")],zi);const _j=zi,qJe={color:aMe,size:_j,opacity:lMe,rotation:cMe},WJe=new gr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),XJe=/^\[([^\]]+)\]$/i;let rB=class extends be{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,r)=>{let i=null;return i=t.target===r.target?0:t.target?1:-1,i});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,r){const{rotationExpression:i,rotationType:s}=t,n=i&&i.match(XJe),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map(a=>{const l=WJe.read(a.type),c=qJe[l];c||(te.getLogger(this.declaredClass).warn(`Unknown variable type: ${l}`),r&&r.messages&&r.messages.push(new Ou("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:a,context:r})));const d=new c;return d.read(a,r),d})}writeVariables(e,t){const r=[];for(const i of e){const s=i.toJSON(t);s&&r.push(s)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([h()],rB.prototype,"visualVariables",null),rB=u([I("esri.renderers.visualVariables.VisualVariableFactory")],rB);const YJe=rB,ZJe={base:YF,key:"type",typeMap:{opacity:lMe,color:aMe,rotation:cMe,size:_j}},II=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new YJe}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,s){return this._vvFactory.readVariables(r,i,s)}writeVisualVariables(r,i,s,n){i[s]=this._vvFactory.writeVariables(r,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const s=this.visualVariables;return s?s.filter(n=>n.type===r&&(typeof i=="string"?n.target===i:i!==!1||!n.target)):[]}async collectVVRequiredFields(r,i){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&jh(r,i,n.field),n.normalizationField&&jh(r,i,n.normalizationField),n.valueExpression&&(JJe(n.valueExpression,r,i)||await Ru(r,i,n.valueExpression)))}};return u([h({types:[ZJe],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),u([me("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),u([Le("visualVariables")],t.prototype,"writeVisualVariables",null),t=u([I("esri.renderers.mixins.VisualVariablesMixin")],t),t};function JJe(e,t,r){const i=pJe(e);return!!v(i)&&(jh(t,r,i),!0)}const gP={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function KJe(e,t=gP){var a,l;if(!e)return{symbol:null};const{retainId:r=gP.retainId,ignoreDrivers:i=gP.ignoreDrivers,hasLabelingContext:s=gP.hasLabelingContext,retainCIM:n=gP.retainCIM}=t;let o=null;if(OR(e)||e instanceof oC)o=e.clone();else if(e.type==="cim"){const c=(l=(a=e.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new z("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():Lw.fromCIMSymbol(e)}else if(e instanceof Ul)o=pj.fromSimpleLineSymbol(e);else if(e instanceof ko)o=Lw.fromSimpleMarkerSymbol(e);else if(e instanceof gE)o=Lw.fromPictureMarkerSymbol(e);else if(e instanceof L0)o=t.geometryType&&t.geometryType==="mesh"?fj.fromSimpleFillSymbol(e):XF.fromSimpleFillSymbol(e);else{if(!(e instanceof nC))return{error:new z("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?hj.fromTextSymbol(e):Lw.fromTextSymbol(e)}if(r&&o&&o.type!=="cim"&&(o.id=e.id),i&&OR(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}const QJe=["building-scene","integrated-mesh","point-cloud","scene"];function Uz(e,t,r,i){const s=RMe(e,{},{context:i,isLabelSymbol:!1});v(s)&&(t[r]=s)}function ffe(e,t,r,i){const s=RMe(e,{},{context:i,isLabelSymbol:!0});v(s)&&(t[r]=s)}function mfe(e){return e instanceof RI||e instanceof oC}function RMe(e,t,r){var l;if(C(e))return null;const{context:i,isLabelSymbol:s}=r,n=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(n==="web-scene"&&!mfe(e)){const c=KJe(e,{retainCIM:!0,hasLabelingContext:s});return v(c.symbol)?c.symbol.write(t,i):(o==null||o.push(new z("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:i,error:c.error})),null)}const a=(l=i==null?void 0:i.layer)==null?void 0:l.type;return n!=="web-map"&&(n!=="portal-item"||a&&QJe.includes(a))||!mfe(e)?e.write(t,i):(o==null||o.push(new z("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:i})),null)}function d6t(e,t){return rJe(e,null,t)}const PI={types:gj,json:{write:{writer:Uz},origins:{"web-scene":{types:rfe,write:{writer:Uz},read:{reader:Wx({types:rfe})}}}}},IMe={types:{base:zd,key:"type",typeMap:{"simple-fill":un.typeMap["simple-fill"],"picture-fill":un.typeMap["picture-fill"],"polygon-3d":un.typeMap["polygon-3d"]}},json:{write:{writer:Uz},origins:{"web-scene":{type:XF,write:{writer:Uz}}}}},iB={cast:e=>e==null||typeof e=="string"||typeof e=="number"?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}};var CQ;let Ob=CQ=class extends fe{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new CQ({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};u([h({type:String,json:{write:!0}})],Ob.prototype,"description",void 0),u([h({type:String,json:{write:!0}})],Ob.prototype,"label",void 0),u([h({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],Ob.prototype,"minValue",void 0),u([h({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],Ob.prototype,"maxValue",void 0),u([h(PI)],Ob.prototype,"symbol",void 0),Ob=CQ=u([I("esri.renderers.support.ClassBreakInfo")],Ob);const Bz=Ob;var AQ;const PMe="log",sB="percent-of-total",nB="field",C5=new gr({esriNormalizeByLog:PMe,esriNormalizeByPercentOfTotal:sB,esriNormalizeByField:nB}),eKe=ts(Bz);let Ko=AQ=class extends II(l1){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,r){if(!Array.isArray(e))return;let i=t.minValue;return e.map(s=>{const n=new Bz;return n.read(s,r),n.minValue==null&&(n.minValue=i),n.maxValue==null&&(n.maxValue=n.minValue),i=n.maxValue,n})}writeClassBreakInfos(e,t,r,i){const s=e.map(n=>n.write({},i));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[r]=s}castField(e){return e==null?e:typeof e=="function"?(te.getLogger(this.declaredClass).error(".field: field must be a string value"),null):RF(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=this.normalizationTotal!=null;return t||r?(e=t&&nB||r&&sB||null,t&&r&&te.getLogger(this.declaredClass).warn("warning: both normalizationField and normalizationTotal are set!")):e!==nB&&e!==sB||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,r){let i=null;i=typeof e=="number"?new Bz({minValue:e,maxValue:t,symbol:sMe(r)}):eKe(ne(e)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(C(t)||C(t.arcade))&&te.getLogger(this.declaredClass).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let r=t;this.valueExpression&&(C(t)||C(t.arcade))&&(r={...r,arcade:await b0()});const i=this.getBreakIndex(e,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&(C(t)||C(t.arcade)))return void te.getLogger(this.declaredClass).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&(C(t)||C(t.arcade))){const s=await b0(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this.getBreakIndex(e,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((i,s)=>i+s.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new AQ({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ne(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ne(this.visualVariables),legendOptions:ne(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(e,t)),Ru(e,t,this.valueExpression)];jh(e,t,this.field),jh(e,t,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=yt(t,{}),{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=n.arcadeUtils;if(!a){const d=l.createSyntaxTree(o);a=l.createFunction(d),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(e){const t=this.field,r=e.attributes,i=this.normalizationType;let s=parseFloat(r[t]);if(i){const n=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===PMe)s=Math.log(s)*Math.LOG10E;else if(i!==sB||n==null||isNaN(n)){if(i===nB&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return r}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let r=1;r<t;r++)if(e[r-1].maxValue!==e[r].minValue)return!1;return!0}};u([h(IMe)],Ko.prototype,"backgroundFillSymbol",void 0),u([h({type:[Bz]})],Ko.prototype,"classBreakInfos",void 0),u([me("classBreakInfos")],Ko.prototype,"readClassBreakInfos",null),u([Le("classBreakInfos")],Ko.prototype,"writeClassBreakInfos",null),u([h({type:String,json:{write:!0}})],Ko.prototype,"defaultLabel",void 0),u([h(PI)],Ko.prototype,"defaultSymbol",void 0),u([h({type:String,json:{write:!0}})],Ko.prototype,"field",void 0),u([Gt("field")],Ko.prototype,"castField",null),u([h({type:Boolean})],Ko.prototype,"isMaxInclusive",void 0),u([h({type:IM,json:{write:!0}})],Ko.prototype,"legendOptions",void 0),u([h({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Ko.prototype,"minValue",null),u([h({type:String,json:{write:!0}})],Ko.prototype,"normalizationField",void 0),u([h({type:Number,cast:e=>Xp(e),json:{write:!0}})],Ko.prototype,"normalizationTotal",void 0),u([h({type:C5.apiValues,value:null,json:{type:C5.jsonValues,read:C5.read,write:C5.write}})],Ko.prototype,"normalizationType",null),u([Ue({classBreaks:"class-breaks"})],Ko.prototype,"type",void 0),u([h({type:String,json:{write:!0}})],Ko.prototype,"valueExpression",void 0),u([h({type:String,json:{write:!0}})],Ko.prototype,"valueExpressionTitle",void 0),Ko=AQ=u([I("esri.renderers.ClassBreaksRenderer")],Ko);const $Me=Ko,oB=-3;var iv;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(iv||(iv={}));class tKe{constructor(t,r,i){this._namespace=t,this._storage=r,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,r,i,s=0){this._storage.put(this._namespace+t,r,i,s)}get(t){const r=this._storage.get(this._namespace+t);return r===void 0?++this._miss:++this._hit,r}pop(t){const r=this._storage.pop(this._namespace+t);return r===void 0?++this._miss:++this._hit,r}updateSize(t,r,i){this._storage.updateSize(this._namespace+t,r,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class Doe{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Qt,this._users=new Qt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,r){this._removeFuncs.push([t,r])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(r=>r[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,r,i,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==r&&this._notifyRemove(t,n.entry,iv.ALL)),i>this._maxSize)return void this._notifyRemove(t,r,iv.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const o=1+Math.max(s,oB)-oB;this._db.set(t,{entry:r,size:i,lifetime:o,lives:o}),this._size+=i,this._checkSizeLimit()}updateSize(t,r,i){const s=this._db.get(t);if(s&&s.entry===r){for(this._size-=s.size;i>this._maxSize;){const n=this._notifyRemove(t,r,iv.SOME);if(!(v(n)&&n>0))return void this._db.delete(t);i=n}s.size=i,this._size+=i,this._checkSizeLimit()}}pop(t){const r=this._db.get(t);if(r)return this._size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(t){const r=this._db.get(t);if(r!==void 0)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const d=c.namespace;if(a.startsWith(d)){const p=r[d]||0;r[d]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(r);n.sort((o,a)=>r[a]-r[o]),n.forEach(o=>t[o]=Math.round(r[o]/2**20)+"MB / "+s[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(t["Priority "+(o+oB-1)]=Math.round(a/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((r,i)=>{i.startsWith(t)&&(this._size-=r.size,this._db.delete(i),this._notifyRemove(i,r.entry,iv.ALL))})}clearAll(){this._db.forEach((t,r)=>this._notifyRemove(r,t.entry,iv.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,r,i){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](r,i);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,r]of this._db){if(this._db.delete(t),r.lives<=1){this._size-=r.size;const i=this._notifyRemove(t,r.entry,iv.SOME);v(i)&&i>0&&(this._size+=i,r.lives=r.lifetime,r.size=i,this._db.set(t,r))}else--r.lives,this._db.set(t,r);if(this._size<=.9*this.maxSize)return}}}class rKe{constructor(t,r){this._storage=new Doe,this._storage.maxSize=t,r&&this._storage.registerRemoveFunc("",r)}put(t,r,i){this._storage.put(t,r,i,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const gfe="esri.renderers.support.DictionaryLoader",iKe={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class Loe{constructor(t,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new rKe(100),this._dictionaryPromise=null,this.url=t,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(m){if(Ps(m))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const m of this._symbolFields){const g=this.fieldMap[m];if(g&&t.attributes[g]!=null){const _=""+t.attributes[g];s[m]=_}else s[m]=""}const n=i==null?void 0:i(s,r);if(!n||typeof n!="string")return null;const o=kse(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],d=[];for(const m of l)if(m)if(m.includes("po:")){const g=m.substr(3).split("|");if(g.length===3){const _=g[0],x=g[1];let b=g[2];if(x==="DashTemplate")b=b.split(" ").map(w=>Number(w));else if(x==="Color"){const w=new Ze(b).toRgba();b=[w[0],w[1],w[2],255*w[3]]}else b=Number(b);d.push({primitiveName:_,propertyName:x,value:b})}}else if(m.includes("|")){for(const g of m.split("|"))if(this._itemNames.has(g)){c.push(g);break}}else this._itemNames.has(m)&&c.push(m);const p=!v(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,d,p,r);return this._symbolCache.put(o,f,1),f}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void te.getLogger(gfe).error("no valid URL!");const r=lr(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:v(t)?t.signal:null}),[{data:i}]=await Promise.all([r,b0()]);if(!i)throw this._dictionaryPromise=null,new z("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=i.expression,n=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const c=this.config;for(const d in c)o[d]=c[d]}if(n.configuration)for(const c of n.configuration)o.hasOwnProperty(c.name)||(o[c.name]=c.value);const a=[];if(v(t)&&t.fields&&this.fieldMap)for(const c of this._symbolFields){const d=this.fieldMap[c],p=t.fields.filter(f=>f.name===d);p.length>0&&a.push({...p[0],name:c})}const l=yYe(s,v(t)?t.spatialReference:null,a,o).then(c=>{const d={scale:0};return(p,f)=>{if(C(c))return null;const m=c.repurposeFeature({geometry:null,attributes:p});return d.scale=v(f)?f.scale:void 0,c.evaluate({$feature:m,$view:d})}}).catch(c=>(te.getLogger(gfe).error("Creating dictinoary expression failed:",c),null));return this._dictionaryPromise=l,l}async _cimPartsToCIMSymbol(t,r,i,s){const n=new Array(t.length);for(let l=0;l<t.length;l++)n[l]=this._getSymbolPart(t[l],s);const o=await Promise.all(n),a=this.fieldMap;if(a)for(const l of o)DMe(l,a);return new MI({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(t,r){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const i=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=lr(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(t),n}}_combineSymbolParts(t,r,i){if(!t||t.length===0)return null;const s={...t[0]};if(t.length>1){s.symbolLayers=[];for(const n of t){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return i&&(s.callout=iKe),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:r}}}function DMe(e,t){if(!e)return;const r=e.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const s=r[i];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&sKe(s,t)}}function sKe(e,t){const r=e.markerGraphics;if(r)for(const i of r){if(!i)continue;const s=i.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":DMe(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}const h6t=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:Loe},Symbol.toStringTag,{value:"Module"}));var OQ;let nm=OQ=class extends II(l1){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new Loe(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,i){i!=null&&i.origin||super.writeVisualVariables(e,t,r,i)}clone(){return new OQ({config:ne(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ne(this.fieldMap),url:ne(this.url),visualVariables:ne(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Ru(e,t,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];t.has(i)&&e.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([h({type:Loe})],nm.prototype,"_loader",null),u([h({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],nm.prototype,"config",void 0),u([h({type:Object,json:{write:!0}})],nm.prototype,"fieldMap",void 0),u([h({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],nm.prototype,"scaleExpression",void 0),u([Le("scaleExpression")],nm.prototype,"writeData",null),u([h({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],nm.prototype,"scaleExpressionTitle",void 0),u([h({type:String,json:{write:!0}})],nm.prototype,"url",void 0),u([Le("visualVariables")],nm.prototype,"writeVisualVariables",null),nm=OQ=u([I("esri.renderers.DictionaryRenderer")],nm);const nKe=nm;var MQ;let T_=MQ=class extends fe{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(te.getLogger(this.declaredClass).error(".field: field must be a string value"),null):RF(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new MQ({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([h({type:Ze,json:{type:[Number],write:!0}})],T_.prototype,"color",void 0),u([h({type:String,json:{write:!0}})],T_.prototype,"field",void 0),u([Gt("field")],T_.prototype,"castField",null),u([h({type:String,json:{write:!0}})],T_.prototype,"label",void 0),u([h({type:String,json:{write:!0}})],T_.prototype,"valueExpression",void 0),u([h({type:String,json:{write:!0}})],T_.prototype,"valueExpressionTitle",void 0),T_=MQ=u([I("esri.renderers.support.AttributeColorInfo")],T_);const LMe=T_;var RQ;let aB=RQ=class extends fe{constructor(){super(...arguments),this.unit=null}clone(){return new RQ({unit:this.unit})}};u([h({type:String,json:{write:!0}})],aB.prototype,"unit",void 0),aB=RQ=u([I("esri.renderers.support.DotDensityLegendOptions")],aB);const oKe=aB;var IQ;let Yu=IQ=class extends II(l1){constructor(e){super(e),this.attributes=null,this.backgroundColor=new Ze([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Ul,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new L0({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var e,t;return(t=(e=this.attributes)==null?void 0:e.reduce((r,i)=>r+i.getAttributeHash(),""))!=null?t:""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new IQ({attributes:ne(this.attributes),backgroundColor:ne(this.backgroundColor),dotBlendingEnabled:ne(this.dotBlendingEnabled),dotShape:ne(this.dotShape),dotSize:ne(this.dotSize),dotValue:ne(this.dotValue),legendOptions:ne(this.legendOptions),outline:ne(this.outline),referenceScale:ne(this.referenceScale),visualVariables:ne(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var t;return`${(t=this.attributes)==null?void 0:t.map(r=>r.field||r.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){var r;await this.collectVVRequiredFields(e,t);for(const i of(r=this.attributes)!=null?r:[])i.valueExpression&&await Ru(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([h({type:[LMe],json:{write:!0}})],Yu.prototype,"attributes",void 0),u([h({type:Ze,json:{write:!0}})],Yu.prototype,"backgroundColor",void 0),u([h({type:Boolean,json:{write:!0}})],Yu.prototype,"dotBlendingEnabled",void 0),u([h({type:String,json:{write:!1}})],Yu.prototype,"dotShape",void 0),u([h({type:Number,json:{write:!0}})],Yu.prototype,"dotSize",void 0),u([h({type:oKe,json:{write:!0}})],Yu.prototype,"legendOptions",void 0),u([h({type:Ul,json:{default:null,write:!0}})],Yu.prototype,"outline",void 0),u([h({type:Number,json:{write:!0}})],Yu.prototype,"dotValue",void 0),u([h({type:Number,json:{write:!0}})],Yu.prototype,"referenceScale",void 0),u([h({type:Number,json:{write:!0}})],Yu.prototype,"seed",void 0),u([Ue({dotDensity:"dot-density"})],Yu.prototype,"type",void 0),Yu=IQ=u([I("esri.renderers.DotDensityRenderer")],Yu);const aKe=Yu;var PQ;let s$=PQ=class extends fe{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new PQ({color:this.color,ratio:this.ratio})}};u([h({type:Ze,json:{type:[bs],default:null,write:!0}})],s$.prototype,"color",void 0),u([h({type:Number,json:{write:!0}})],s$.prototype,"ratio",void 0),s$=PQ=u([I("esri.renderers.support.HeatmapColorStop")],s$);const ND=s$;let VA=class extends ki(fe){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([h({type:String,json:{write:!0}})],VA.prototype,"minLabel",void 0),u([h({type:String,json:{write:!0}})],VA.prototype,"maxLabel",void 0),u([h({type:String,json:{write:!0}})],VA.prototype,"title",void 0),VA=u([I("esri.renderers.support.HeatmapLegendOptions")],VA);function Lr(){return[0,0,0,0]}function vj(e){return[e[0],e[1],e[2],e[3]]}function ar(e,t,r,i){return[e,t,r,i]}function Noe(e){const t=Lr(),r=Math.min(4,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function NMe(e,t){return new Float64Array(e,t,4)}function FMe(){return Lr()}function kMe(){return ar(1,1,1,1)}function UMe(){return ar(1,0,0,0)}function BMe(){return ar(0,1,0,0)}function zMe(){return ar(0,0,1,0)}function VMe(){return ar(0,0,0,1)}const u0=FMe(),rf=kMe(),lKe=UMe(),cKe=BMe(),uKe=zMe(),dKe=VMe();Object.freeze(Object.defineProperty({__proto__:null,create:Lr,clone:vj,fromValues:ar,fromArray:Noe,createView:NMe,zeros:FMe,ones:kMe,unitX:UMe,unitY:BMe,unitZ:zMe,unitW:VMe,ZEROS:u0,ONES:rf,UNIT_X:lKe,UNIT_Y:cKe,UNIT_Z:uKe,UNIT_W:dKe},Symbol.toStringTag,{value:"Module"}));const Foe=2.4;function hKe(e){return xf(e*Foe)}function pKe(e){return Ga(e)/Foe}function fKe(e,t,r,i){let{color:s,ratio:n}=t,{color:o,ratio:a}=r;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=_e((i-n)/(a-n),0,1);K9(e,s.toArray(),o.toArray(),l)}function p6t(e){const r=new Uint8ClampedArray(2048);if(e=e.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),e.length<1)return r;let i=e[0],s=e[0],n=1;const o=Lr();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<e.length;)i=s,s=e[n++];fKe(o,i,s,l),r.set(o,4*a)}return r}function f6t(e,t,r,i){const{radius:s,fieldOffset:n,field:o}=t,a=Math.round(Ga(s)),l=new Float64Array(r*i);let c,d=Number.NEGATIVE_INFINITY;const p=gKe(o,n),f=new Set;for(const m of e){const g=m.getCursor();for(;g.next();){const _=g.getObjectId();if(f.has(_))continue;f.add(_);const x=g.readLegacyPointGeometry(),b=128;if(x.x<-b||x.x>=r+b||x.y<-b||x.y>i+b)continue;const w=+p(g),T=Math.max(0,Math.round(x.x)-a),E=Math.max(0,Math.round(x.y)-a),O=Math.min(i,Math.round(x.y)+a),A=Math.min(r,Math.round(x.x)+a);for(let R=E;R<O;R++)for(let D=T;D<A;D++){const k=R*r+D,L=mKe(x.x-D,x.y-R,a);c=l[k]+=L*w,c>d&&(d=c)}}}return{matrix:l.buffer,max:d}}function mKe(e,t,r){const i=Math.sqrt(e**2+t**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function m6t(e,t){return typeof e=="function"?e:e?typeof t=="string"?r=>-1*+r[e]:r=>+r[e]+t:()=>1}function gKe(e,t){return e!=null?typeof t=="string"?r=>-1*+r.readAttribute(e):r=>+r.readAttribute(e)+t:r=>1}var $Q;const jMe="esri.renderers.HeatmapRenderer",yKe=te.getLogger(jMe);function yfe(e){if(e!=null){const{maxDensity:t,minDensity:r,radius:i}=e;if(t!=null||r!=null||i!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=e;return a}}return e}let Sa=$Q=class extends l1{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new ND({ratio:0,color:new Ze("rgba(255, 140, 0, 0)")}),new ND({ratio:.75,color:new Ze("rgba(255, 140, 0, 1)")}),new ND({ratio:.9,color:new Ze("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return yfe(e)}get blurRadius(){return pKe(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",hKe(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(Foe**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||Gl(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,JE(()=>{du(yKe,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=yfe(e),super.read(e,t)}getSymbol(){return new ko}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await jh(e,t,r),i&&typeof i=="string"&&await Ru(e,t,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new $Q({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:ne(this.colorStops),field:this.field,legendOptions:ne(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([h({type:Aoe,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Sa.prototype,"authoringInfo",void 0),u([h({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Sa.prototype,"blurRadius",null),u([h({type:[ND],json:{write:!0}})],Sa.prototype,"colorStops",void 0),u([h({type:String,json:{write:!0}})],Sa.prototype,"field",void 0),u([h({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],Sa.prototype,"fieldOffset",void 0),u([h({type:VA,json:{write:!0}})],Sa.prototype,"legendOptions",void 0),u([h({type:Number,json:{write:!0}})],Sa.prototype,"maxDensity",void 0),u([h({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Sa.prototype,"maxPixelIntensity",null),u([h({type:Number,json:{write:!0}})],Sa.prototype,"minDensity",void 0),u([h({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Sa.prototype,"minPixelIntensity",null),u([h({type:Number,cast:Fi,json:{write:!0}})],Sa.prototype,"radius",void 0),u([h({type:Number,range:{min:0},json:{default:0,write:!0}})],Sa.prototype,"referenceScale",void 0),u([Ue({heatmap:"heatmap"})],Sa.prototype,"type",void 0),u([h({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Sa.prototype,"valueExpression",void 0),u([h({type:String})],Sa.prototype,"valueExpressionTitle",void 0),u([h({readOnly:!0})],Sa.prototype,"_pixelIntensityToDensity",null),Sa=$Q=u([I(jMe)],Sa);const GMe=Sa;let KS=class extends ki(fe){constructor(){super(...arguments),this.color=new Ze([0,0,0,0]),this.label=null,this.threshold=0}};u([h({type:Ze,json:{write:!0}})],KS.prototype,"color",void 0),u([h({type:String,json:{write:!0}})],KS.prototype,"label",void 0),u([h({type:Number,range:{min:0,max:1},json:{write:!0}})],KS.prototype,"threshold",void 0),KS=u([I("esri.renderers.support.OthersCategory")],KS);let lB=class extends ki(fe){constructor(){super(...arguments),this.title=null}};u([h({type:String,json:{write:!0}})],lB.prototype,"title",void 0),lB=u([I("esri.renderers.support.PieChartLegendOptions")],lB);let th=class extends II(ki(l1)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Ze([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new KS,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new ko({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(v)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await Ru(e,t,r.valueExpression),r.field&&e.add(r.field)}};u([h({type:[LMe],json:{write:!0}})],th.prototype,"attributes",void 0),u([h({type:L0,json:{default:null,write:!0}})],th.prototype,"backgroundFillSymbol",void 0),u([h({type:Ze,json:{write:!0}})],th.prototype,"defaultColor",void 0),u([h({type:String,json:{write:!0}})],th.prototype,"defaultLabel",void 0),u([h({type:Number,range:{min:0,max:1},json:{write:!0}})],th.prototype,"holePercentage",void 0),u([h({type:KS,json:{write:!0}})],th.prototype,"othersCategory",void 0),u([h({type:lB,json:{write:!0}})],th.prototype,"legendOptions",void 0),u([h({type:Ul,json:{default:null,write:!0}})],th.prototype,"outline",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],th.prototype,"size",void 0),u([Ue({pieChart:"pie-chart"})],th.prototype,"type",void 0),th=u([I("esri.renderers.PieChartRenderer")],th);const _Ke=th;var DQ;let yS=DQ=class extends II(l1){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new DQ({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:ne(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([h({type:String,json:{write:!0}})],yS.prototype,"description",void 0),u([h({type:String,json:{write:!0}})],yS.prototype,"label",void 0),u([h(PI)],yS.prototype,"symbol",void 0),u([Ue({simple:"simple"})],yS.prototype,"type",void 0),yS=DQ=u([I("esri.renderers.SimpleRenderer")],yS);const RR=yS,vKe=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function LQ(e){return e instanceof be}function _fe(e){return e instanceof Ge?Object.keys(e.items):LQ(e)?Gl(e).keys():e?Object.keys(e):[]}function A5(e,t){return e instanceof Ge?e.items[t]:e[t]}function bKe(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function FD(e){return e?e.declaredClass:null}function HMe(e,t){const r=e.diff;if(r&&typeof r=="function")return r(e,t);const i=_fe(e),s=_fe(t);if(i.length===0&&s.length===0)return;if(!i.length||!s.length||bKe(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(p=>!i.includes(p)),o=i.filter(p=>!s.includes(p)),a=i.filter(p=>s.includes(p)&&A5(e,p)!==A5(t,p)).concat(n,o).sort(),l=FD(e);if(l&&vKe.includes(l)&&a.length)return{type:"complete",oldValue:e,newValue:t};let c;const d=LQ(e)&&LQ(t);for(const p of a){const f=A5(e,p),m=A5(t,p);let g;if((d||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(r&&r[p]&&typeof r[p]=="function")g=r[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;g={type:"complete",oldValue:f,newValue:m}}else g=typeof f=="object"&&typeof m=="object"&&FD(f)===FD(m)?HMe(f,m):{type:"complete",oldValue:f,newValue:m};v(g)&&(v(c)?c.diff[p]=g:c={type:"partial",diff:{[p]:g}})}}return c}function wKe(e,t){if(C(e))return!1;const r=t.split(".");let i=e;for(const s of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const n=i.diff[s];if(!n)return!1;i=n}}return!0}function g6t(e,t){for(const r of t)if(wKe(e,r))return!0;return!1}function xKe(e,t){if(!(typeof e=="function"||typeof t=="function"||C(e)&&C(t)))return C(e)||C(t)||typeof e=="object"&&typeof t=="object"&&FD(e)!==FD(t)?{type:"complete",oldValue:e,newValue:t}:HMe(e,t)}function O5(e){if(C(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const r of t.added)if(!O5(r))return!1;for(const r of t.removed)if(!O5(r))return!1;for(const r of t.changed)if(!O5(r))return!1;return!0}case"partial":for(const t in e.diff)if(!O5(e.diff[t]))return!1;return!0}}let jA=class extends ki(fe){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};u([h(iB)],jA.prototype,"value",void 0),u([h(iB)],jA.prototype,"value2",void 0),u([h(iB)],jA.prototype,"value3",void 0),jA=u([I("esri.renderers.support.UniqueValue")],jA);const PM=jA;let Mb=class extends ki(fe){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const t=typeof(e=Array.isArray(e)?e:[e])[0];return t==="string"||t==="number"?e.map(r=>new PM({value:r})):t==="object"?e[0]instanceof PM?e:e.map(r=>new PM(r)):null}};u([h({type:String,json:{write:!0}})],Mb.prototype,"description",void 0),u([h({type:String,json:{write:!0}})],Mb.prototype,"label",void 0),u([h(PI)],Mb.prototype,"symbol",void 0),u([h({type:[PM],json:{type:[[String]],read:{reader:e=>e?e.map(t=>new PM({value:t[0],value2:t[1],value3:t[2]})):null},write:{writer:(e,t)=>{const r=[];for(const i of e){const s=[i.value,i.value2,i.value3].filter(v).map(n=>n.toString());r.push(s)}t.values=r}}}})],Mb.prototype,"values",void 0),u([Gt("values")],Mb.prototype,"castValues",null),Mb=u([I("esri.renderers.support.UniqueValueClass")],Mb);const qMe=Mb;let n$=class extends ki(fe){constructor(e){super(e),this.heading=null,this.classes=null}};u([h({type:String,json:{write:!0}})],n$.prototype,"heading",void 0),u([h({type:[qMe],json:{write:!0}})],n$.prototype,"classes",void 0),n$=u([I("esri.renderers.support.UniqueValueGroup")],n$);const NQ=n$;var FQ;let _S=FQ=class extends fe{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new FQ({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};u([h({type:String,json:{write:!0}})],_S.prototype,"description",void 0),u([h({type:String,json:{write:!0}})],_S.prototype,"label",void 0),u([h(PI)],_S.prototype,"symbol",void 0),u([h(iB)],_S.prototype,"value",void 0),_S=FQ=u([I("esri.renderers.support.UniqueValueInfo")],_S);const kD=_S,TKe=()=>!!pe("enable-feature:force-wosr"),y6t=()=>!!pe("enable-feature:direct-3d-object-feature-layer-display"),SKe=()=>!!pe("enable-feature:SceneLayer-editing"),_q={};async function EKe(e,t){try{return{data:(await MKe(e,t)).data,baseUrl:I9e(e),styleUrl:e}}catch(r){return zh(r),null}}function CKe(e,t,r){const i=v(t.portal)?t.portal:oo.getDefault();let s;const n=`${i.url} - ${i.user&&i.user.username} - ${e}`;return _q[n]||(_q[n]=AKe(e,i,r).then(o=>(s=o,o.fetchData())).then(o=>{var a;return{data:o,baseUrl:(a=s.itemUrl)!=null?a:"",styleName:e}})),_q[n]}function AKe(e,t,r){return t.load(r).then(()=>{const i=new cv({disableExtraQuery:!0,query:`owner:${vfe} AND type:${bfe} AND typekeywords:"${e}"`});return t.queryItems(i,r)}).then(({results:i})=>{var o;let s=null;const n=e.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===n))&&a.type===bfe&&a.owner===vfe){s=a;break}}if(!s)throw new z("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(r)})}function OKe(e,t,r){return e&&v(e.styleUrl)?EKe(e.styleUrl,r):e&&v(e.styleName)?CKe(e.styleName,t,r):Promise.reject(new z("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function _6t(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function v6t(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!TKe()){for(const r of e.formatInfos)if(r.type==="gltf")return r.href}return e.webRef}function MKe(e,t){const r={responseType:"json",query:{f:"json"},...t};return lr(tg(e),r)}const vfe="esri_en",bfe="Style",b6t="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var o$;const WMe="esri.renderers.UniqueValueRenderer",$1=te.getLogger(WMe),wfe="uvInfos-watcher",xfe="uvGroups-watcher",RKe=",",IKe=ts(kD);function PKe(e){const{field1:t,field2:r,field3:i,fieldDelimiter:s,uniqueValueInfos:n,valueExpression:o}=e,a=!(!t||!r);return[{classes:(n!=null?n:[]).map(l=>{var b;const{symbol:c,label:d,value:p,description:f}=l,[m,g,_]=a?((b=p==null?void 0:p.toString())==null?void 0:b.split(s||""))||[]:[p],x=[];return(t||o)&&x.push(m),r&&x.push(g),i&&x.push(_),{symbol:c,label:d,values:[x],description:f}})}]}let Ln=o$=class extends II(l1){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,r){if(!t&&!r)return;if(!t||!r)return{type:"complete",oldValue:t,newValue:r};let i=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<r.length;n++){const o=t.find(a=>a.value===r[n].value);o?xKe(o,r[n])?(s.changed.push({type:"complete",oldValue:o,newValue:r[n]}),i=!0):s.unchanged.push({oldValue:o,newValue:r[n]}):(s.added.push(r[n]),i=!0)}for(let n=0;n<t.length;n++)r.find(o=>o.value===t[n].value)||(s.removed.push(t[n]),i=!0);return i?s:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return e==null||typeof e=="function"?e:RF(e)}writeField(e,t,r,i){typeof e=="string"?t[r]=e:i&&i.messages?i.messages.push(new z("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):$1.error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,r){return r.portal||oo.getDefault()}readStyleOrigin(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const i=iC(t.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(e,t,r,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=Wv(e.styleUrl,i))}set uniqueValueGroups(e){this.styleOrigin?$1.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?$1.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){var i;if(this.styleOrigin)return void $1.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof e=="object"?IKe(e):new kD({value:e,symbol:sMe(t)}),(i=this.uniqueValueInfos)==null||i.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void $1.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const t=this.uniqueValueInfos;if(t){for(let r=0;r<t.length;r++)if(t[r].value===e+""){delete this._valueInfoMap[e],t.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let r=t;return this.valueExpression&&(C(t)||C(t.arcade))&&(r={...r,arcade:await b0()}),this._getUniqueValueInfo(e,r)}getSymbol(e,t){if(this.valueExpression&&(C(t)||C(t.arcade)))return void $1.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(e,t);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&(C(r)||C(r.arcade))){const s=await b0(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),r={...r,arcade:s}}const i=this._getUniqueValueInfo(e,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){var t;const e=[];for(const r of(t=this.uniqueValueInfos)!=null?t:[])r.symbol&&e.push(r.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){var i;const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=(i=this.uniqueValueInfos)==null?void 0:i.reduce((s,n)=>s+n.getMeshHash(),"");return`${e}.${t}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new o$({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ne(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ne(this.visualVariables),legendOptions:ne(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:ne(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=ne(this.uniqueValueInfos),r=ne(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(ne(this.styleOrigin))),Object.freeze(t),Object.freeze(r)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",r),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(e,t)),Ru(e,t,this.valueExpression)];jh(e,t,this.field),jh(e,t,this.field2),jh(e,t,this.field3),await Promise.all(r)}populateFromStyle(){return OKe(this.styleOrigin,{portal:this.portal}).then(e=>{var r;const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(i=>{const s=new oC({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=s,this._isDefaultSymbolDerived=!0);const n=new kD({value:i.name,symbol:s});t.push(n),this._valueInfoMap[i.name]=n}),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((r=this.uniqueValueInfos)==null?void 0:r.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",RKe)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const t of e)this._valueInfoMap[t.value+""]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(wfe);const{uniqueValueInfos:e}=this;if(e){const t=[];for(const r of e)t.push(ie(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,s)=>{i!==s&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(t,wfe)}}_watchUniqueValueGroups(){this.removeHandles(xfe);const{uniqueValueGroups:e}=this;if(e){const t=[];for(const r of e){t.push(ie(()=>({classes:r.classes}),(i,s)=>{i!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const i of r.classes)t.push(ie(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(s,n)=>{s!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(t,xfe)}}_updateInfosFromGroups(){var l;if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:t,field2:r,field3:i,fieldDelimiter:s,uniqueValueGroups:n,valueExpression:o}=this;if(!t&&!o)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!t||!r);for(const c of n)for(const d of(l=c.classes)!=null?l:[]){const{symbol:p,label:f,values:m,description:g}=d;for(const _ of m!=null?m:[]){const{value:x,value2:b,value3:w}=_,T=[x];r&&T.push(b),i&&T.push(w);const E=a?T.join(s||""):T[0];e.push(new kD({symbol:p,label:f,value:E,description:g}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:t,field2:r,valueExpression:i,fieldDelimiter:s,uniqueValueInfos:n}=this;if(!t&&!i||!n.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!t||!r),a=n.map(c=>{var b;const{symbol:d,label:p,value:f,description:m}=c,[g,_,x]=o?((b=f==null?void 0:f.toString())==null?void 0:b.split(s||""))||[]:[f];return new qMe({symbol:d,label:p,description:m,values:[new PM({value:g,value2:_,value3:x})]})}),l=[new NQ({classes:a})];e&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:s,arcade:n}=yt(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:r,scale:i,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,r=e.attributes;let i;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];t&&o.push(r[t]),s&&o.push(r[s]),n&&o.push(r[n]),i=o.join(this.fieldDelimiter||"")}else typeof t=="function"?i=t(e):t&&(i=r[t]);return this._valueInfoMap[i+""]}static fromPortalStyle(e,t){const r=new o$(t&&t.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t&&t.portal||oo.getDefault());const i=r.populateFromStyle();return i.catch(s=>{$1.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),i}static fromStyleUrl(e,t){const r=new o$(t&&t.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));const i=r.populateFromStyle();return i.catch(s=>{$1.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),i}};u([h({readOnly:!0})],Ln.prototype,"_cache",null),u([Ue({uniqueValue:"unique-value"})],Ln.prototype,"type",void 0),u([h(IMe)],Ln.prototype,"backgroundFillSymbol",void 0),u([h({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Ln.prototype,"field",null),u([Gt("field")],Ln.prototype,"castField",null),u([Le("field")],Ln.prototype,"writeField",null),u([h({type:String,value:null,json:{write:!0}})],Ln.prototype,"field2",null),u([h({type:String,value:null,json:{write:!0}})],Ln.prototype,"field3",null),u([h({type:String,value:null,json:{write:!0}})],Ln.prototype,"valueExpression",null),u([h({type:String,json:{write:!0}})],Ln.prototype,"valueExpressionTitle",void 0),u([h({type:IM,json:{write:!0}})],Ln.prototype,"legendOptions",void 0),u([h({type:String,json:{write:!0}})],Ln.prototype,"defaultLabel",void 0),u([h(r2e({...PI},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Ln.prototype,"defaultSymbol",null),u([h({type:String,value:null,json:{write:!0}})],Ln.prototype,"fieldDelimiter",null),u([h({type:oo,readOnly:!0})],Ln.prototype,"portal",void 0),u([me("portal",["styleName"])],Ln.prototype,"readPortal",null),u([h({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Ln.prototype,"styleOrigin",void 0),u([me("styleOrigin",["styleName","styleUrl"])],Ln.prototype,"readStyleOrigin",null),u([Le("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Ln.prototype,"writeStyleOrigin",null),u([h({type:[NQ],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,r)=>(t.uniqueValueGroups||PKe(t)).map(i=>NQ.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Ln.prototype,"uniqueValueGroups",null),u([h({type:[kD],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Ln.prototype,"uniqueValueInfos",null),Ln=o$=u([I(WMe)],Ln);const ZF=Ln,bj={key:"type",base:l1,typeMap:{heatmap:GMe,simple:RR,"unique-value":ZF,"class-breaks":$Me,"dot-density":aKe,dictionary:nKe,"pie-chart":_Ke},errorContext:"renderer"},XMe={key:"type",base:l1,typeMap:{simple:RR,"unique-value":ZF,"class-breaks":$Me,heatmap:GMe},errorContext:"renderer"},$Ke=Wx({types:bj});function hN(e,t,r){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new Ou("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null):$Ke(e,t,r):null}class koe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(pJ),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const r=new koe,i=this._originStores[Jr.DEFAULTS];i&&i.forEach((s,n)=>{r.set(n,ne(s),Jr.DEFAULTS)});for(let s=Jr.SERVICE;s<pJ;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||r.set(a,ne(o),s)})}return r}get(t,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(t):void 0}keys(t){const r=t==null?this._values:this._originStores[t];return r?[...r.keys()]:[]}set(t,r,i=Jr.USER){let s=this._originStores[i];if(s||(s=new Map,this._originStores[i]=s),s.set(t,r),!this._values.has(t)||this._propertyOriginMap.get(t)<=i){const n=this._values.get(t);return this._values.set(t,r),this._propertyOriginMap.set(t,i),n!==r}return!1}delete(t,r=Jr.USER){const i=this._originStores[r];if(!i)return;const s=i.get(t);if(i.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===r){this._values.delete(t);for(let n=r-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(t)}revert(t,r){for(;r>0&&!this.has(t,r);)--r;const i=this._originStores[r],s=i&&i.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,r),n!==s}originOf(t){return this._propertyOriginMap.get(t)||Jr.DEFAULTS}forEach(t){this._values.forEach(t)}}const YMe=e=>{let t=class extends e{constructor(...r){super(...r);const i=Gl(this),s=i.store,n=new koe;i.store=n,q2e(i,s,n)}read(r,i){X2e(this,r,i)}getAtOrigin(r,i){const s=vq(this),n=mv(i);if(typeof r=="string")return s.get(r,n);const o={};return r.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(r){return iz(this.originIdOf(r))}originIdOf(r){return vq(this).originOf(r)}revert(r,i){const s=vq(this),n=mv(i),o=Gl(this);let a;a=typeof r=="string"?r==="*"?s.keys(n):[r]:r,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=u([I("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function vq(e){return Gl(e).store}let Tfe=class extends YMe(be){};Tfe=u([I("esri.core.ReadOnlyMultiOriginJSONSupport")],Tfe);const DKe=e=>{let t=class extends e{constructor(...r){super(...r)}clear(r,i="user"){return bq(this).delete(r,mv(i))}write(r={},i){return Z2e(this,r=r||{},i),r}setAtOrigin(r,i,s){Gl(this).setAtOrigin(r,i,mv(s))}removeOrigin(r){const i=bq(this),s=mv(r),n=i.keys(s);for(const o of n)i.originOf(o)===s&&i.set(o,i.get(o,s),Jr.USER)}updateOrigin(r,i){const s=bq(this),n=mv(i),o=this.get(r);for(let a=n+1;a<pJ;++a)s.delete(r,a);s.set(r,o,n)}toJSON(r){return this.write({},r)}};return t=u([I("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function bq(e){return Gl(e).store}const wj=e=>{let t=class extends DKe(YMe(e)){constructor(...r){super(...r)}};return t=u([I("esri.core.MultiOriginJSONSupport")],t),t};let Sfe=class extends wj(be){};Sfe=u([I("esri.core.MultiOriginJSONSupport")],Sfe);function LKe(e){return"portalItem"in e}const ZMe=e=>{let t=class extends e{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):LKe(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([h({type:String})],t.prototype,"apiKey",null),t=u([I("esri.layers.mixins.APIKeyMixin")],t),t},JMe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},KMe=Object.values(JMe),QMe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${KMe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),NKe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${KMe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),FKe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function w6t(e){return!!QMe.test(e)}function aC(e){if(C(e))return null;const t=Wa(e),r=t.path.match(QMe)||t.path.match(NKe);if(!r)return null;const[,i,s,n,o]=r,a=s.indexOf("/");return{title:xj(a!==-1?s.slice(a+1):s),serverType:JMe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function kKe(e){const t=Wa(e).path.match(FKe);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function xj(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function eRe(e,t){const r=[];if(e){const i=aC(e);v(i)&&i.title&&r.push(i.title)}if(t){const i=xj(t);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function tRe(e){if(!e)return!1;const t=".arcgis.com/",r="//services",i="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(r)||e.includes(i)||e.includes(s);return n&&o}function rRe(e,t){return e&&YL(cEe(e,t))}function iRe(e){let{url:t}=e;if(!t)return{url:t};t=cEe(t,e.logger);const r=Wa(t),i=aC(r.path);let s;if(v(i))i.sublayer!=null&&e.layer.layerId==null&&(s=i.sublayer),t=i.url.path;else if(e.nonStandardUrlAllowed){const n=kKe(r.path);v(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:YL(t),layerId:s}}function sRe(e,t,r,i,s){Sx(t,i,"url",s),i.url&&e.layerId!=null&&(i.url=Mu(i.url,r,e.layerId.toString()))}function x6t(e){if(!e)return!1;const t=e.toLowerCase(),r=t.includes("/services/"),i=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return r&&(i||s||n)}const nRe=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=aC(this.url);if(v(r)&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",rRe(r,te.getLogger(this.declaredClass)))}};return u([h()],t.prototype,"title",null),u([h({type:String})],t.prototype,"url",null),t=u([I("esri.layers.mixins.ArcGISService")],t),t},UKe=new $s.EventEmitter,oRe="esri.layers.mixins.EditBusLayer",aRe=Symbol(oRe);function T6t(e){return e!=null&&typeof e=="object"&&aRe in e}const lRe=e=>{var t;let r=class extends e{constructor(...i){super(...i),this[t]=!0,this.when().then(()=>{this.own([UKe.on("edits",s=>{var d,p,f;const n="layer"in s?s.layer:null,o="layer"in s?(d=s.layer)==null?void 0:d.url:s.serviceUrl,a="layer"in s?(p=s.layer)==null?void 0:p.layerId:s.layerId,l=s.event;if(n===this||o!==this.url)return;if(a!=null&&this.layerId!=null&&a===this.layerId)return void this.emit("edits",ne(l));const c=(f=l.editedFeatures)==null?void 0:f.find(({layerId:m})=>m===this.layerId);if(c){const{adds:m,updates:g,deletes:_}=c.editedFeatures,x={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:m?m.map(({attributes:b})=>({objectId:this.objectIdField&&b[this.objectIdField],globalId:this.globalIdField&&b[this.globalIdField]})):[],deletedFeatures:_?_.map(({attributes:b})=>({objectId:this.objectIdField&&b[this.objectIdField],globalId:this.globalIdField&&b[this.globalIdField]})):[],updatedFeatures:g?g.map(({current:{attributes:b}})=>({objectId:this.objectIdField&&b[this.objectIdField],globalId:this.globalIdField&&b[this.globalIdField]})):[],editedFeatures:ne(l.editedFeatures)};this.emit("edits",x)}})])},()=>{})}};return t=aRe,r=u([I(oRe)],r),r},BKe={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}};function zKe(e){if(!e)return e;const{start:t,end:r}=e;return new bg({start:v(t)?df(t,-t.getTimezoneOffset(),"minutes"):t,end:v(r)?df(r,-r.getTimezoneOffset(),"minutes"):r})}function VKe(e){if(!e)return e;const{start:t,end:r}=e;return new bg({start:v(t)?df(t,t.getTimezoneOffset(),"minutes"):t,end:v(r)?df(r,r.getTimezoneOffset(),"minutes"):r})}var kQ;let a$=kQ=class extends fe{constructor(e){super(e)}async collectRequiredFields(e,t){return Ru(e,t,this.expression)}clone(){return new kQ({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};u([h({type:String,json:{write:!0}})],a$.prototype,"expression",void 0),u([h({type:String,json:{write:!0}})],a$.prototype,"title",void 0),a$=kQ=u([I("esri.layers.support.FeatureExpressionInfo")],a$);const Efe=a$;function jKe(e){return MR[e]!=null}function GKe(e){return 1/(MR[e]||1)}function HKe(){const e=Object.keys(MR);return e.sort(),e}const qKe=HKe();var UQ;const M5=Br()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Cfe=new gr({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let S_=UQ=class extends fe{constructor(e){super(e),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,r,i){t[r]=e.write({},i),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):v(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new UQ({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&K8e(this.featureExpressionInfo,e.featureExpressionInfo)}};u([h({type:Efe,json:{write:!0}})],S_.prototype,"featureExpressionInfo",void 0),u([me("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],S_.prototype,"readFeatureExpressionInfo",null),u([Le("featureExpressionInfo",{featureExpressionInfo:{type:Efe},"featureExpression.value":{type:[0]}})],S_.prototype,"writeFeatureExpressionInfo",null),u([h({type:M5.apiValues,nonNullable:!0,json:{type:M5.jsonValues,read:M5.read,write:{writer:M5.write,isRequired:!0}}})],S_.prototype,"mode",null),u([h({type:Number,json:{write:!0}})],S_.prototype,"offset",void 0),u([h({type:qKe,json:{type:String,read:Cfe.read,write:Cfe.write}})],S_.prototype,"unit",null),S_=UQ=u([I("esri.layers.support.ElevationInfo")],S_);const cRe=S_,uRe={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},Tj={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,r){t[r]=!e}}}},Sj={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},dRe={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Sx}}},hRe={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},pRe={value:null,type:cRe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function S6t(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const cB={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},WKe={...cB,json:{...cB.json,origins:{"web-document":{...cB.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,r)=>r&&r.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?xR(t.layerDefinition.drawingInfo.transparency):void 0:xR(t.drawingInfo.transparency)}}},E6t={type:bg,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:r}=this.layer,i=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;e&&(s=VKe(s));let n=r?i&&s?i.intersection(s):i||s:s;if(!n||n.isEmpty||n.isAllTime)return n;t&&(n=n.offset(-t.value,t.unit)),e&&(n=zKe(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},C6t={type:Sr,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const r=Sr.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(r.spatialReference=Ve.fromJSON(t.spatialReference)),r}}}},read:!1}},fRe={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},XKe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},YKe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},mRe={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},Uoe=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(r,i,s,n){(n&&n.layerContainerType==="ground"||r&&KVe(this,s,{},n))&&(i[s]=r)}writeOperationalLayerType(r,i,s,n){!r||n&&n.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r!=null?r:"Layer"}read(r,i){i&&(i.layer=this),YVe(this,r,s=>super.read(r,s),i)}write(r,i){var o,a;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=BKe[l];let d=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(d=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(d=!1),!d)return(o=i.messages)==null||o.push(new z("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(r,{...i,layer:this}),n=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof z&&l.name==="web-document-write:property-required").length;return bx(s==null?void 0:s.url)?((a=i==null?void 0:i.messages)==null||a.push(new z("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([h({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),u([h(mRe)],t.prototype,"listMode",void 0),u([Le("listMode")],t.prototype,"writeListMode",null),u([h({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),u([Le("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),u([h(cB)],t.prototype,"opacity",void 0),u([h({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),u([Le("title"),Le(["web-scene"],"title")],t.prototype,"writeTitle",null),u([h({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=u([I("esri.layers.mixins.OperationalLayer")],t),t},Boe=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){this.portalItem=Qe(this.portalItem)}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,s){if(i.itemId)return new pE({id:i.itemId,portal:s&&s.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const s=await re(()=>import("./layersLoader.e3596b12.js").then(n=>n.l),["assets/layersLoader.e3596b12.js","assets/jsonContext.df83b33f.js"]);return Ir(i),await s.load({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(s){throw Ps(s)||te.getLogger(this.declaredClass).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(zh(i),!0)))}async _fetchUserHasEditingPrivileges(r){const i=this.url?pn==null?void 0:pn.findCredential(this.url):null;if(!i)return!0;const s=R5.credential===i?R5.user:await this._fetchEditingUser(r);return R5.credential=i,R5.user=s,C(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var d,p,f;const i=(p=(d=this.portalItem)==null?void 0:d.portal)==null?void 0:p.user;if(i)return i;const s=pn.findServerInfo((f=this.url)!=null?f:"");if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=oo.getDefault();if(o&&o.loaded&&tg(o.restUrl)===tg(n))return o.user;const a=`${n}/community/self`,l=v(r)?r.signal:null,c=await Jh(lr(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?ooe.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const s=i&&i.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||oo.getDefault());return s&&n&&!nEe(n.restUrl,s.restUrl)?(i.messages&&i.messages.push(new z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return u([h({type:pE})],t.prototype,"portalItem",null),u([me("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),u([Le("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),u([h({clonable:!1})],t.prototype,"resourceReferences",void 0),u([h({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=u([I("esri.layers.mixins.PortalLayer")],t),t},R5={credential:null,user:null},Ej=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&ZKe(r,i.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===r.minScale&&s.maxScale===r.maxScale?s:r}};return u([h({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),u([h({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),u([h({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=u([I("esri.layers.mixins.ScaleRangeLayer")],t),t};function ZKe(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}function gRe(e){return e&&"getAtOrigin"in e&&"originOf"in e}function BQ(e){e&&e.writtenProperties&&e.writtenProperties.forEach(({target:t,propName:r,newOrigin:i})=>{gRe(t)&&i&&t.originOf(r)!==i&&t.updateOrigin(r,i)})}var l$;const zz=Br()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),yRe=zz.jsonValues.slice();Rse(yRe,"orthometric");const UD=Br()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let om=l$=class extends fe{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return zz.write(e,t,r)}readHeightModel(e,t,r){return zz.read(e)||(r&&r.messages&&r.messages.push(JKe(e,{context:r})),null)}readHeightUnit(e,t,r){return UD.read(e)||(r&&r.messages&&r.messages.push(Afe(e,{context:r})),null)}readHeightUnitService(e,t,r){return _Me(e)||UD.read(e)||(r&&r.messages&&r.messages.push(Afe(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new l$({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=OJe(t);return new l$({heightModel:e.heightModel,heightUnit:r,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new l$;return t.read(e,{origin:"web-scene"}),t}};function Afe(e,t){return new Ou("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function JKe(e,t){return new Ou("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}u([h({type:zz.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:yRe,default:"ellipsoidal"}}}})],om.prototype,"heightModel",void 0),u([Le("web-scene","heightModel")],om.prototype,"writeHeightModel",null),u([me(["web-scene","service"],"heightModel")],om.prototype,"readHeightModel",null),u([h({type:UD.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:UD.jsonValues,write:UD.write}}}})],om.prototype,"heightUnit",void 0),u([me("web-scene","heightUnit")],om.prototype,"readHeightUnit",null),u([me("service","heightUnit")],om.prototype,"readHeightUnitService",null),u([h({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],om.prototype,"vertCRS",void 0),u([me("service","vertCRS",["vertCRS","ellipsoid","geoid"])],om.prototype,"readVertCRS",null),om=l$=u([I("esri.geometry.HeightModelInfo")],om);const lC=om;async function KKe(e,t,r,i,s,n){let o=null;if(v(r)){const c=`${e}/nodepages/`,d=c+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await lr(d,{query:{f:"json",token:i},responseType:"json",signal:n})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:c}}catch(p){v(s)&&s.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",d,p),o=p}}if(!t)return null;const a=`${e}/nodes/`,l=a+(t&&t.split("/").pop());try{return{type:"node",rootNode:(await lr(l,{query:{f:"json",token:i},responseType:"json",signal:n})).data,urlPrefix:a}}catch(c){throw new z("sceneservice:root-node-missing","Root node missing.",{pageError:o,nodeError:c,url:l})}}async function QKe(e,t={},r){await e.load(r);const i=Mu(e.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=t,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:e.apiKey},signal:Ks(r,"signal")},c=await e.portal._request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:d,size:p,resource:f})=>({created:new Date(d),size:p,resource:e.resourceFromPath(f)}))}}async function eQe(e,t,r,i){if(!e.hasPath())throw new z(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const s=e.portalItem;await s.load(i);const n=Mu(s.userItemUrl,t==="add"?"addResources":"updateResources"),[o,a]=_Re(e.path),l=await vRe(r),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),v(i)&&i.compress&&c.append("compress","true"),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),v(i)&&i.access&&c.append("access",i.access),await s.portal._request(n,{method:"post",body:c,signal:Ks(i,"signal")}),e}async function tQe(e,t,r){if(!t.hasPath())throw new z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(r);const i=Mu(e.userItemUrl,"removeResources");await e.portal._request(i,{method:"post",query:{resource:t.path},signal:Ks(r,"signal")}),t.portalItem=null}async function rQe(e,t){await e.load(t);const r=Mu(e.userItemUrl,"removeResources");return e.portal._request(r,{method:"post",query:{deleteAll:!0},signal:Ks(t,"signal")})}function _Re(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function zoe(e){const[t,r]=iQe(e),[i,s]=_Re(t);return[i,s,r]}function iQe(e){const t=dne(e);return C(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function vRe(e){return e instanceof Blob?e:(await lr(e.url,{responseType:"blob"})).data}function sQe(e,t){if(!e.hasPath())return null;const[r,,i]=zoe(e.path);return e.portalItem.resourceFromPath(Mu(r,t+i))}function bRe(e,t){if(!e.hasPath())return null;const[r,,i]=zoe(e.path);return e.portalItem.resourceFromPath(Mu(r,t+i))}const c$=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:eQe,contentToBlob:vRe,fetchResources:QKe,getSiblingOfSameType:sQe,getSiblingOfSameTypeI:bRe,removeAllResources:rQe,removeResource:tQe,splitPrefixFileNameAndExtension:zoe},Symbol.toStringTag,{value:"Module"}));async function Ofe(e,t,r){if(!t||!t.resources)return;const i=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{i.delete(c),e.paths.push(c)});for(const c of t.resources.toUpdate)if(i.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:d,content:p,finish:f,error:m}=c,g=bRe(d,pne());e.paths.push(g.path),o.push(Mfe({resource:g,content:p,compress:c.compress,finish:f,error:m},r))}else e.paths.push(c.resource.path),o.push(nQe(c,r)),n.add(c.resource.path);for(const c of t.resources.toAdd)o.push(Mfe(c,r)),e.paths.push(c.resource.path);if(i.forEach(c=>{const d=t.portalItem.resourceFromPath(c);o.push(d.portalItem.removeResource(d).catch(()=>{}))}),o.length===0)return;const a=await zo(o);Ir(r);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new z("save:resources","Failed to save one or more resources",{errors:l})}async function Mfe(e,t){const r={...v(t)?t:{},compress:e.compress},i=await Jh(e.resource.portalItem.addResource(e.resource,e.content,r));if(i.ok!==!0)throw e.error&&e.error(i.error),i.error;e.finish&&e.finish(e.resource)}async function nQe(e,t){const r=await Jh(e.resource.update(e.content,t));if(r.ok!==!0)throw e.error(r.error),r.error;e.finish(e.resource)}const wRe="esri.layers.mixins.SceneService",vC=te.getLogger(wRe),oQe=e=>{let t=class extends e{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=Bse(async(r,i,s)=>{switch(r){case IR.SAVE:return this._save(i);case IR.SAVE_AS:return this._saveAs(s,i)}})}readSpatialReference(r,i){return this._readSpatialReference(i)}_readSpatialReference(r){if(r.spatialReference!=null)return Ve.fromJSON(r.spatialReference);{const i=r.store,s=i.indexCRS||i.geographicCRS,n=s&&parseInt(s.substring(s.lastIndexOf("/")+1,s.length),10);return n!=null?new Ve(n):null}}readFullExtent(r,i,s){if(r!=null&&typeof r=="object"){const a=r.spatialReference==null?{...r,spatialReference:this._readSpatialReference(i)}:r;return Sr.fromJSON(a,s)}const n=i.store,o=this._readSpatialReference(i);return o==null||n==null||n.extent==null||!Array.isArray(n.extent)||n.extent.some(a=>a<wq)?null:new Sr({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(r){const i={major:Number.NaN,minor:Number.NaN,versionString:r},s=r.split(".");return s.length>=2&&(i.major=parseInt(s[0],10),i.minor=parseInt(s[1],10)),i}readVersion(r,i){const s=i.store,n=s.version!=null?s.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(r){return this.sublayerTitleMode!=="item-title"?void 0:r}readTitleService(r,i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return eRe(this.url,i.name);let n=i.name;if(!n&&this.url){const o=aC(this.url);v(o)&&(n=o.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&s&&(n=s+" - "+n),xj(n)}set url(r){const i=iRe({layer:this,url:r,nonStandardUrlAllowed:!1,logger:vC});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){sRe(this,r,"layers",i,n)}get parsedUrl(){const r=this._get("url"),i=Wa(r);return this.layerId!=null&&(i.path=`${i.path}/layers/${this.layerId}`),i}async _fetchIndexAndUpdateExtent(r,i){this.indexInfo=KKe(this.parsedUrl.path,this.rootNode,r,this.apiKey,vC,i),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(r){var i,s,n;if((r==null?void 0:r.type)==="page"){const o=r.rootIndex%r.pageSize,a=(s=(i=r.rootPage)==null?void 0:i.nodes)==null?void 0:s[o];if(a==null||a.obb==null||a.obb.center==null||a.obb.halfSize==null)throw new z("sceneservice:invalid-node-page","Invalid node page.");if(a.obb.center[0]<wq||this.fullExtent==null||this.fullExtent.hasZ)return;const l=a.obb.halfSize,c=a.obb.center[2],d=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);this.fullExtent.zmin=c-d,this.fullExtent.zmax=c+d}else if((r==null?void 0:r.type)==="node"){const o=(n=r.rootNode)==null?void 0:n.mbs;if(!Array.isArray(o)||o.length!==4||o[0]<wq)return;const a=o[2],l=o[3],{fullExtent:c}=this;c&&(c.zmin=a-l,c.zmax=a+l)}}async _fetchService(r){if(this.url==null)throw new z("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(r);i!=null&&(this.layerId=i)}return this._fetchServiceLayer(r)}async _fetchFirstLayerId(r){const i=await lr(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});if(i.data&&Array.isArray(i.data.layers)&&i.data.layers.length>0)return i.data.layers[0].id}async _fetchServiceLayer(r){var o,a;const i=await lr((a=(o=this.parsedUrl)==null?void 0:o.path)!=null?a:"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});i.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let s=!1;if(i.data.layerType&&i.data.layerType==="Voxel"&&(s=!0),s)return this._fetchVoxelServiceLayer();const n=i.data;this.read(n,{origin:"service",url:this.parsedUrl}),this.validateLayer(n)}async _fetchVoxelServiceLayer(r){var s;const i=(await lr(((s=this.parsedUrl)==null?void 0:s.path)+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r})).data;this.read(i,{origin:"service",url:this.parsedUrl}),this.validateLayer(i)}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(r){}_updateTypeKeywords(r,i,s){r.typeKeywords||(r.typeKeywords=[]);const n=i.getTypeKeywords();for(const o of n)r.typeKeywords.push(o);r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),s===BD.newItem&&(r.typeKeywords=r.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(r,i){var c,d,p;const s={...Rfe,...i};let n=pE.from(r);n||(vC.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new z("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const o=n.portal||oo.getDefault();await this._ensureLoadBeforeSave(),n.type=I5,n.portal=o;const a={origin:"portal-item",url:null,messages:[],portal:o,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},a)]};return await Promise.all((d=(c=a.resources)==null?void 0:c.pendingOperations)!=null?d:[]),await this._validateAgainstJSONSchema(l,a,s),n.url=this.url,n.title||(n.title=this.title),this._updateTypeKeywords(n,s,BD.newItem),await o._signIn(),await((p=o.user)==null?void 0:p.addItem({item:n,folder:s&&s.folder,data:l})),await Ofe(this.resourceReferences,a,null),this.portalItem=n,BQ(a),a.portalItem=n,n}async _save(r){var o,a;const i={...Rfe,...r};if(!this.portalItem)throw vC.error("_save(): requires the .portalItem property to be set"),new z("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(this.portalItem.type!==I5)throw vC.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+I5),new z("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${I5}"`);await this._ensureLoadBeforeSave();const s={origin:"portal-item",url:this.portalItem.itemUrl&&Wa(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||oo.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write({},s)]};return await Promise.all((a=(o=s.resources)==null?void 0:o.pendingOperations)!=null?a:[]),await this._validateAgainstJSONSchema(n,s,i),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,i,BD.existingItem),await this.portalItem.update({data:n}),await Ofe(this.resourceReferences,s,null),BQ(s),this.portalItem}async _validateAgainstJSONSchema(r,i,s){var o,a,l,c,d;let n=(a=(o=i.messages)==null?void 0:o.filter(p=>p.type==="error").map(p=>new z(p.name,p.message,p.details)))!=null?a:[];if(s&&((l=s.validationOptions)==null?void 0:l.ignoreUnsupported)&&(n=n.filter(p=>p.name!=="layer:unsupported"&&p.name!=="symbol:unsupported"&&p.name!=="symbol-layer:unsupported"&&p.name!=="property:unsupported"&&p.name!=="url:unsupported"&&p.name!=="scenemodification:unsupported")),((c=s.validationOptions)==null?void 0:c.enabled)||aQe){const p=(await re(()=>import("./schemaValidator.51418262.js"),["assets/schemaValidator.51418262.js","assets/_commonjsHelpers.773c2c82.js"])).validate(r,s.portalItemLayerType);if(p.length>0){const f=`Layer item did not validate:
${p.join(`
`)}`;if(vC.error(`_validateAgainstJSONSchema(): ${f}`),((d=s.validationOptions)==null?void 0:d.failPolicy)==="throw"){const m=p.map(g=>new z("sceneservice:schema-validation",g)).concat(n);throw new z("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:m})}}}if(n.length>0)throw new z("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}};return u([h(fRe)],t.prototype,"id",void 0),u([h({type:Ve})],t.prototype,"spatialReference",void 0),u([me("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readSpatialReference",null),u([h({type:Sr})],t.prototype,"fullExtent",void 0),u([me("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readFullExtent",null),u([h({readOnly:!0,type:lC})],t.prototype,"heightModelInfo",void 0),u([h({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],t.prototype,"minScale",void 0),u([h({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],t.prototype,"maxScale",void 0),u([h({readOnly:!0})],t.prototype,"version",void 0),u([me("version",["store.version"])],t.prototype,"readVersion",null),u([h({type:String,json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),u([h({type:String,json:{read:!1}})],t.prototype,"sublayerTitleMode",void 0),u([h({type:String})],t.prototype,"title",void 0),u([me("portal-item","title")],t.prototype,"readTitlePortalItem",null),u([me("service","title",["name"])],t.prototype,"readTitleService",null),u([h({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],t.prototype,"layerId",void 0),u([h(dRe)],t.prototype,"url",null),u([Le("url")],t.prototype,"writeUrl",null),u([h()],t.prototype,"parsedUrl",null),u([h({readOnly:!0})],t.prototype,"store",void 0),u([h({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],t.prototype,"rootNode",void 0),t=u([I(wRe)],t),t},wq=-1e38,aQe=!1;var BD;(function(e){e[e.existingItem=0]="existingItem",e[e.newItem=1]="newItem"})(BD||(BD={}));const I5="Scene Service",Rfe={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var IR;(function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"})(IR||(IR={}));const lQe={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};let Ev=class extends fe{constructor(){super(...arguments),this.type=null}};u([h({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Ev.prototype,"type",void 0),Ev=u([I("esri.layers.support.FeatureReduction")],Ev);var zQ;let uB=zQ=class extends Ev{constructor(e){super(e),this.type="selection"}clone(){return new zQ}};u([h({type:["selection"]})],uB.prototype,"type",void 0),uB=zQ=u([I("esri.layers.support.FeatureReductionSelection")],uB);const VQ=uB;async function cQe(e,t){const{WhereClause:r}=await re(()=>import("./WhereClause.b191b7a3.js"),[]);return r.create(e,t)}function uQe(e,t){return v(e)?v(t)?`(${e}) AND (${t})`:e:t}var jQ;let vS=jQ=class extends fe{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new jQ({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([h({type:String,json:{write:!0}})],vS.prototype,"expression",void 0),u([h({type:String,json:{write:!0}})],vS.prototype,"name",void 0),u([h({type:["boolean","date","number","string"],json:{write:!0}})],vS.prototype,"returnType",void 0),u([h({type:String,json:{write:!0}})],vS.prototype,"title",void 0),vS=jQ=u([I("esri.form.ExpressionInfo")],vS);const dQe=vS;let bS=class extends fe{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([h({type:String,json:{write:!0}})],bS.prototype,"description",void 0),u([h({type:String,json:{write:!0}})],bS.prototype,"label",void 0),u([h()],bS.prototype,"type",void 0),u([h({type:String,json:{write:!0}})],bS.prototype,"visibilityExpression",void 0),bS=u([I("esri.form.elements.Element")],bS);const PR=bS;var GQ;let dB=GQ=class extends fe{constructor(e){super(e),this.type=null}clone(){return new GQ({type:this.type})}};u([h({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],dB.prototype,"type",void 0),dB=GQ=u([I("esri.form.elements.inputs.AttachmentInput")],dB);const hQe=dB;var HQ;let wS=HQ=class extends PR{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new HQ({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([h({type:String,json:{write:!0}})],wS.prototype,"attachmentKeyword",void 0),u([h({type:Boolean,json:{write:!0}})],wS.prototype,"editable",void 0),u([h({type:hQe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],wS.prototype,"input",void 0),u([h({type:["attachment"],json:{read:!1,write:!0}})],wS.prototype,"type",void 0),wS=HQ=u([I("esri.form.elements.AttachmentElement")],wS);const Ife=wS;let hB=class extends fe{constructor(e){super(e),this.type=null}};u([h()],hB.prototype,"type",void 0),hB=u([I("esri.form.elements.inputs.Input")],hB);const $I=hB;let u$=class extends $I{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([h({type:Number,json:{write:!0}})],u$.prototype,"maxLength",void 0),u([h({type:Number,json:{write:!0}})],u$.prototype,"minLength",void 0),u$=u([I("esri.form.elements.inputs.TextInput")],u$);const Voe=u$;var qQ;let pB=qQ=class extends Voe{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new qQ({maxLength:this.maxLength,minLength:this.minLength})}};u([h({type:["barcode-scanner"],json:{read:!1,write:!0}})],pB.prototype,"type",void 0),pB=qQ=u([I("esri.form.elements.inputs.BarcodeScannerInput")],pB);const pQe=pB;var WQ;let GA=WQ=class extends $I{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new WQ({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([h({type:String,json:{write:!0}})],GA.prototype,"noValueOptionLabel",void 0),u([h({type:Boolean,json:{write:!0}})],GA.prototype,"showNoValueOption",void 0),u([h({type:["combo-box"],json:{read:!1,write:!0}})],GA.prototype,"type",void 0),GA=WQ=u([I("esri.form.elements.inputs.ComboBoxInput")],GA);const fQe=GA;var XQ;function Pfe(e){return e!=null?new Date(e):null}function $fe(e){return e?e.getTime():null}let am=XQ=class extends $I{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return Pfe(t.max)}writeMax(e,t){t.max=$fe(e)}readMin(e,t){return Pfe(t.min)}writeMin(e,t){t.min=$fe(e)}clone(){return new XQ({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};u([h({type:Boolean,json:{write:!0}})],am.prototype,"includeTime",void 0),u([h({type:Date,json:{type:Number,write:!0}})],am.prototype,"max",void 0),u([me("max")],am.prototype,"readMax",null),u([Le("max")],am.prototype,"writeMax",null),u([h({type:Date,json:{type:Number,write:!0}})],am.prototype,"min",void 0),u([me("min")],am.prototype,"readMin",null),u([Le("min")],am.prototype,"writeMin",null),u([h({type:["datetime-picker"],json:{read:!1,write:!0}})],am.prototype,"type",void 0),am=XQ=u([I("esri.form.elements.inputs.DateTimePickerInput")],am);const mQe=am;var YQ;let HA=YQ=class extends $I{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new YQ({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([h({type:String,json:{write:!0}})],HA.prototype,"noValueOptionLabel",void 0),u([h({type:Boolean,json:{write:!0}})],HA.prototype,"showNoValueOption",void 0),u([h({type:["radio-buttons"],json:{read:!1,write:!0}})],HA.prototype,"type",void 0),HA=YQ=u([I("esri.form.elements.inputs.RadioButtonsInput")],HA);const gQe=HA;var ZQ;let qA=ZQ=class extends $I{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new ZQ({offValue:this.offValue,onValue:this.onValue})}};u([h({type:[String,Number],json:{write:!0}})],qA.prototype,"offValue",void 0),u([h({type:[String,Number],json:{write:!0}})],qA.prototype,"onValue",void 0),u([h({type:["switch"],json:{read:!1,write:!0}})],qA.prototype,"type",void 0),qA=ZQ=u([I("esri.form.elements.inputs.SwitchInput")],qA);const yQe=qA;var JQ;let fB=JQ=class extends Voe{constructor(e){super(e),this.type="text-area"}clone(){return new JQ({maxLength:this.maxLength,minLength:this.minLength})}};u([h({type:["text-area"],json:{read:!1,write:!0}})],fB.prototype,"type",void 0),fB=JQ=u([I("esri.form.elements.inputs.TextAreaInput")],fB);const _Qe=fB;var KQ;let mB=KQ=class extends Voe{constructor(e){super(e),this.type="text-box"}clone(){return new KQ({maxLength:this.maxLength,minLength:this.minLength})}};u([h({type:["text-box"],json:{read:!1,write:!0}})],mB.prototype,"type",void 0),mB=KQ=u([I("esri.form.elements.inputs.TextBoxInput")],mB);const vQe=mB,bQe={base:$I,key:"type",typeMap:{"barcode-scanner":pQe,"combo-box":fQe,"datetime-picker":mQe,"radio-buttons":gQe,switch:yQe,"text-area":_Qe,"text-box":vQe}};var QQ;let d$=QQ=class extends fe{constructor(e){super(e),this.name=null,this.code=null}clone(){return new QQ({name:this.name,code:this.code})}};u([h({type:String,json:{write:!0}})],d$.prototype,"name",void 0),u([h({type:[String,Number],json:{write:!0}})],d$.prototype,"code",void 0),d$=QQ=u([I("esri.layers.support.CodedValue")],d$);const wQe=new gr({inherited:"inherited",codedValue:"coded-value",range:"range"});let h$=class extends fe{constructor(e){super(e),this.name=null,this.type=null}};u([h({type:String,json:{write:!0}})],h$.prototype,"name",void 0),u([Ue(wQe)],h$.prototype,"type",void 0),h$=u([I("esri.layers.support.Domain")],h$);const Cj=h$;var eee;let p$=eee=class extends Cj{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const r=String(e);this.codedValues.some(i=>(String(i.code)===r&&(t=i.name),!!t))}return t}clone(){return new eee({codedValues:ne(this.codedValues),name:this.name})}};u([h({type:[d$],json:{write:!0}})],p$.prototype,"codedValues",void 0),u([Ue({codedValue:"coded-value"})],p$.prototype,"type",void 0),p$=eee=u([I("esri.layers.support.CodedValueDomain")],p$);const xRe=p$;var tee;let gB=tee=class extends Cj{constructor(e){super(e),this.type="inherited"}clone(){return new tee}};u([Ue({inherited:"inherited"})],gB.prototype,"type",void 0),gB=tee=u([I("esri.layers.support.InheritedDomain")],gB);const TRe=gB;var ree;let WA=ree=class extends Cj{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new ree({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([h({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,r){t[r]=[this.minValue||0,e]}}}})],WA.prototype,"maxValue",void 0),u([h({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,r){t[r]=[e,this.maxValue||0]}}}})],WA.prototype,"minValue",void 0),u([Ue({range:"range"})],WA.prototype,"type",void 0),WA=ree=u([I("esri.layers.support.RangeDomain")],WA);const SRe=WA,ERe={key:"type",base:Cj,typeMap:{range:SRe,"coded-value":xRe,inherited:TRe}};function joe(e){if(!e||!e.type)return null;switch(e.type){case"range":return SRe.fromJSON(e);case"codedValue":return xRe.fromJSON(e);case"inherited":return TRe.fromJSON(e)}return null}var iee;let Ap=iee=class extends PR{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new iee({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([h({types:ERe,json:{read:{reader:joe},write:!0}})],Ap.prototype,"domain",void 0),u([h({type:Boolean,json:{write:!0}})],Ap.prototype,"editable",void 0),u([h({type:String,json:{write:!0}})],Ap.prototype,"editableExpression",void 0),u([h({type:String,json:{write:!0}})],Ap.prototype,"fieldName",void 0),u([h({type:String,json:{write:!0}})],Ap.prototype,"hint",void 0),u([h({types:bQe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Ap.prototype,"input",void 0),u([h({type:String,json:{write:!0}})],Ap.prototype,"requiredExpression",void 0),u([h({type:String,json:{read:!1,write:!0}})],Ap.prototype,"type",void 0),u([h({type:String,json:{write:!0}})],Ap.prototype,"valueExpression",void 0),Ap=iee=u([I("esri.form.elements.FieldElement")],Ap);const Dfe=Ap;var see;let E_=see=class extends PR{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new see({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:ne(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([h({type:Number,json:{write:!0}})],E_.prototype,"displayCount",void 0),u([h({type:["list"],json:{write:!0}})],E_.prototype,"displayType",void 0),u([h({type:Boolean,json:{write:!0}})],E_.prototype,"editable",void 0),u([h({type:[poe],json:{write:!0}})],E_.prototype,"orderByFields",void 0),u([h({type:Number,json:{write:!0}})],E_.prototype,"relationshipId",void 0),u([h({type:["relationship"],json:{read:!1,write:!0}})],E_.prototype,"type",void 0),E_=see=u([I("esri.form.elements.RelationshipElement")],E_);const Lfe=E_;function CRe(e){return{typesWithGroup:{base:PR,key:"type",typeMap:{attachment:Ife,field:Dfe,group:e,relationship:Lfe}},typesWithoutGroup:{base:PR,key:"type",typeMap:{attachment:Ife,field:Dfe,relationship:Lfe}}}}function ARe(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>i[s.type]).map(s=>i[s.type].fromJSON(s))}function ORe(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>i[s.type]).map(s=>s.toJSON())}function MRe(e,t,r=!0){return e?e.map(i=>ug(r?t.typesWithGroup:t.typesWithoutGroup,i)):null}var nee;let Ry=nee=class extends PR{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return MRe(e,xq,!1)}readElements(e,t){return ARe(t.formElements,xq,!1)}writeElements(e,t){t.formElements=ORe(e,xq,!1)}clone(){return new nee({description:this.description,elements:ne(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([h({json:{write:!0}})],Ry.prototype,"elements",void 0),u([Gt("elements")],Ry.prototype,"castElements",null),u([me("elements",["formElements"])],Ry.prototype,"readElements",null),u([Le("elements")],Ry.prototype,"writeElements",null),u([h({type:["collapsed","expanded"],json:{write:!0}})],Ry.prototype,"initialState",void 0),u([h({type:String,json:{read:!1,write:!0}})],Ry.prototype,"type",void 0),Ry=nee=u([I("esri.form.elements.GroupElement")],Ry);const xq=CRe(Ry),xQe=Ry;var oee;const Tq=CRe(xQe);let lm=oee=class extends fe{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(e){return MRe(e,Tq)}readElements(e,t){return ARe(t.formElements,Tq)}writeElements(e,t){t.formElements=ORe(e,Tq)}clone(){return new oee({description:this.description,expressionInfos:ne(this.expressionInfos),elements:ne(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};u([h({type:String,json:{write:!0}})],lm.prototype,"description",void 0),u([h({json:{write:!0}})],lm.prototype,"elements",void 0),u([Gt("elements")],lm.prototype,"castElements",null),u([me("elements",["formElements"])],lm.prototype,"readElements",null),u([Le("elements")],lm.prototype,"writeElements",null),u([h({type:[dQe],json:{write:!0}})],lm.prototype,"expressionInfos",void 0),u([h({type:Boolean,json:{default:!1,write:!0}})],lm.prototype,"preserveFieldValuesWhenHidden",void 0),u([h({type:String,json:{write:!0}})],lm.prototype,"title",void 0),lm=oee=u([I("esri.form.FormTemplate")],lm);const TQe=lm;class aee{constructor(t=r=>r.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(r=>{t(r)||this._items.delete(r)}),this}}var cl;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(cl||(cl={}));let SQe=0;function RRe(){return SQe++}function EQe(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function pN(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function Goe(e,t,r,i){if(t.type===cl.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==cl.INVOKE&&t.type!==cl.RESPONSE)return void e.postMessage(t);let s;if(EQe(r)?(s=Nfe(r.transferList),t.data=r.result):(s=Nfe(i),t.data=r),s){if(pe("ff")){for(const n of s)if("byteLength"in n&&n.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(t.type){case cl.INVOKE:throw o;case cl.RESPONSE:return void Goe(e,{type:cl.RESPONSE,jobId:t.jobId,error:pN(o)})}}}e.postMessage(t,s)}else e.postMessage(t)}function fN(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function Nfe(e){if(!e||!e.length)return null;if(pe("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(r=>!CQe(r));return t.length?t:null}function CQe(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const AQe={statsWorker:()=>re(()=>import("./statsWorker.adae05db.js"),["assets/statsWorker.adae05db.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js"]),geometryEngineWorker:()=>re(()=>import("./geometryEngineWorker.c4184d57.js"),["assets/geometryEngineWorker.c4184d57.js","assets/geometryEngineJSON.f9e9a36f.js","assets/geometryEngineBase.82b25ca5.js","assets/json.879c9adc.js"]),CSVSourceWorker:()=>re(()=>import("./CSVSourceWorker.39bc6c28.js"),["assets/CSVSourceWorker.39bc6c28.js","assets/json.879c9adc.js","assets/FeatureStore.d33bd861.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineCapabilities.78217f95.js","assets/number.ad2b9bcd.js","assets/clientSideDefaults.459207f2.js"]),EdgeProcessingWorker:()=>re(()=>import("./EdgeProcessingWorker.f087876c.js"),[]),ElevationSamplerWorker:()=>re(()=>import("./ElevationSamplerWorker.e709313c.js"),["assets/ElevationSamplerWorker.e709313c.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/georeference.c1c5f482.js"]),FeatureServiceSnappingSourceWorker:()=>re(()=>import("./FeatureServiceSnappingSourceWorker.98818690.js"),["assets/FeatureServiceSnappingSourceWorker.98818690.js","assets/FeatureStore.d33bd861.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/symbologySnappingCandidates.7b2f5b3f.js"]),GeoJSONSourceWorker:()=>re(()=>import("./GeoJSONSourceWorker.151c5270.js"),["assets/GeoJSONSourceWorker.151c5270.js","assets/FeatureStore.d33bd861.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineCapabilities.78217f95.js","assets/geojson.42b96238.js","assets/clientSideDefaults.459207f2.js","assets/sourceUtils.972c596e.js"]),LercWorker:()=>re(()=>import("./LercWorker.acc88a5b.js"),[]),MemorySourceWorker:()=>re(()=>import("./MemorySourceWorker.8f326c75.js"),["assets/MemorySourceWorker.8f326c75.js","assets/objectIdUtils.83ac3f67.js","assets/FeatureStore.d33bd861.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineCapabilities.78217f95.js","assets/clientSideDefaults.459207f2.js","assets/sourceUtils.972c596e.js"]),PBFDecoderWorker:()=>re(()=>import("./PBFDecoderWorker.644c7075.js"),[]),Pipeline:()=>re(()=>import("./Pipeline.e5b86b67.js").then(e=>e.P),["assets/Pipeline.e5b86b67.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/StreamFeatureManager.a70d79e9.js","assets/quickselect.3948ea39.js","assets/centroid.28bc38cc.js","assets/ogcFeatureUtils.91843bda.js","assets/geojson.42b96238.js","assets/clientSideDefaults.459207f2.js","assets/createConnection.2c16c68b.js","assets/enums.6b5e3ac2.js","assets/number.30628ef2.js","assets/TileInfoView.2ed0d6a8.js"]),PointCloudWorker:()=>re(()=>import("./PointCloudWorker.0660aa9a.js"),["assets/PointCloudWorker.0660aa9a.js","assets/PointCloudWorkerUtil.bcceab02.js","assets/PointCloudUniqueValueRenderer.a85b1572.js"]),RasterWorker:()=>re(()=>import("./RasterWorker.a0020c74.js"),["assets/RasterWorker.a0020c74.js","assets/dataUtils.885b8011.js","assets/colorUtils.bb6424b7.js","assets/utils.932b691a.js","assets/rasterProjectionHelper.756a5400.js"]),SceneLayerSnappingSourceWorker:()=>re(()=>import("./SceneLayerSnappingSourceWorker.0261fae2.js"),["assets/SceneLayerSnappingSourceWorker.0261fae2.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js"]),SceneLayerWorker:()=>re(()=>import("./SceneLayerWorker.bca20aca.js").then(e=>e.S),["assets/SceneLayerWorker.bca20aca.js","assets/I3SNode.c9dda13d.js"]),WFSSourceWorker:()=>re(()=>import("./WFSSourceWorker.ac6c3e60.js"),["assets/WFSSourceWorker.ac6c3e60.js","assets/FeatureStore.d33bd861.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineCapabilities.78217f95.js","assets/geojson.42b96238.js","assets/sourceUtils.972c596e.js","assets/wfsUtils.9bf9e39c.js","assets/xmlUtils.56e603f6.js"]),WorkerTileHandler:()=>re(()=>import("./WorkerTileHandler.898226e0.js"),["assets/WorkerTileHandler.898226e0.js","assets/StyleRepository.fa6f6392.js","assets/enums.6b5e3ac2.js","assets/colorUtils.bb6424b7.js","assets/Geometry.d049a63c.js","assets/GeometryUtils.12948ca8.js","assets/TileClipper.b43beef6.js","assets/BidiEngine.d8bba3fc.js"])},{CLOSE:Ffe,ABORT:kfe,INVOKE:Ufe,RESPONSE:yP,OPEN_PORT:Bfe,ON:OQe}=cl,MQe=2;class RQe{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===cl.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class vd{constructor(t,r,i){this._port=t,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new RQe(s=>this._onInvokeMessage(s)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(t){const r=new MessageChannel;let i;i=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new vd(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=s),vd.clients.set(s,i),r.port2}static loadWorker(t){const r=AQe[t];return r?r():Promise.resolve(null)}close(){this._post({type:Ffe}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,r,i){const s=i&&i.signal,n=i&&i.transferList;if(!this._port)return Promise.reject(new z("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:r}));const o=RRe();return new Promise((a,l)=>{if(Bo(s))return this._processWork(),void l(oi());const c=jl(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),Gs(p.abortHandle),this._post({type:kfe,jobId:o}),l(oi()))}),d={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,d),this._post({type:Ufe,jobId:o,methodName:t,abortable:s!=null},r,n)})}on(t,r){const i=new MessageChannel;function s(n){r(n.data)}return this._port.postMessage({type:cl.ON,eventType:t,port:i.port2},[i.port2]),i.port1.addEventListener("message",s),i.port1.start(),{remove(){i.port1.postMessage({type:cl.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:Bfe,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=MQe)return;const t=this._getNextJob();if(!t)return;const{methodName:r,data:i,invokeOptions:s,deferred:n}=t;this.invoke(r,i,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{Gs(t.abortHandle),t.reject(oi(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){v(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const r=fN(t);if(r)switch(r.type){case yP:this._onResponseMessage(r);break;case Ufe:this._invokeQueue.push(r);break;case kfe:this._onAbortMessage(r);break;case Ffe:this._onCloseMessage();break;case Bfe:this._onOpenPortMessage(r);break;case OQe:this._onOnMessage(r)}}_onAbortMessage(t){const r=this._inJobs,i=t.jobId,s=r.get(i);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),r.delete(i))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&vd.clients.get(this)===t&&t.destroy(),vd.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:r,jobId:i,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,d=c[r];try{if(!d&&r&&r.includes(".")){const p=r.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],d=c[p[f+1]]}if(typeof d!="function")throw new TypeError(`${r} is not a function`);l=d.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:yP,jobId:i,error:pN(p)})}np(l)?(a.set(i,{controller:o,promise:l}),l.then(p=>{a.has(i)&&(a.delete(i),this._post({type:yP,jobId:i},p))},p=>{a.has(i)&&(a.delete(i),Ps(p)||this._post({type:yP,jobId:i,error:pN(p||{message:`Error encountered at method ${r}`})}))})):this._post({type:yP,jobId:i},l)}_onOpenPortMessage(t){new vd(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:r}=t,i=this._client.on(t.eventType,n=>{r.postMessage(n)}),s=mx(t.port,"message",n=>{var o;((o=fN(n))==null?void 0:o.type)===cl.CLOSE&&(s.remove(),i.remove(),r.close())})}_onResponseMessage(t){const{jobId:r,error:i,data:s}=t,n=this._outJobs;if(!n.has(r))return;const o=n.get(r);n.delete(r),this._processWork(),Gs(o.abortHandle),i?o.reject(z.fromJSON(JSON.parse(i))):o.resolve(s)}_post(t,r,i){return Goe(this._port,t,r,i)}}vd.kernelInfo={revision:pEe,version:fEe,buildDate:hEe},vd.clients=new Map;class IQe{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new aee}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,r){return new Promise((i,s)=>{let n=!0;const o=a=>{Ir(r.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];np(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new vd(c,r,()=>{var d;return(d=this._ongoingJobsQueue.pop())!=null?d:null}),o(i),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new vd(l,r,()=>{var c;return(c=this._ongoingJobsQueue.pop())!=null?c:null}),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(t,r,i){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a==null?void 0:a.invoke(t,r,i))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject(oi(`Worker closing, aborting job calling '${t.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,r,i){let s;Array.isArray(i)?(te.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:i}):s=i;const n=gx();this._ongoingJobsQueue.push({methodName:t,data:r,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return n.promise}on(t,r){return Promise.all(this._clientPromises).then(()=>aR(this._clients.map(i=>i.on(t,r))))}openPorts(){return new Promise(t=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{n&&(r[s]=n.openPort()),--i==0&&t(r)})})}get test(){return{numClients:this._clients.length}}}const zfe={};function PQe(e,t){for(const r of e)if(r.name===t.name)return;e.push(t)}function $Qe(e){var r;const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=zfe.baseUrl),(r=zfe.packages)==null||r.forEach(i=>{var s;PQe((s=t.packages)!=null?s:[],i)}),t}class DQe{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>t[r](...i)})}}class yB{constructor(){this._dispatcher=new DQe,this._workerPostMessage({type:cl.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){lR(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,r,i){this._dispatcher.addEventListener(t,r,i)}removeEventListener(t,r,i){this._dispatcher.removeEventListener(t,r,i)}_workerPostMessage(t){lR(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const r=fN(t);if(r&&r.type===cl.OPEN){const{modulePath:i,jobId:s}=r;let n=await vd.loadWorker(i);n||(n=await re(()=>import(i),[]));const o=vd.connect(n);this._workerPostMessage({type:cl.OPENED,jobId:s,data:o})}}}const lee=te.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:LQe}=cl,NQe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,version:r}=configuration.kernelInfo,{revision:t,version:n}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS API for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const i=outgoing.get(r);outgoing.delete(r),o.error?i.reject(JSON.parse(o.error)):i.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let P5,$5;const Vfe="Failed to create Worker. Fallback to execute module in main thread";async function FQe(){if(!pe("esri-workers")||(pe("mozilla"),0))return jfe(new yB);if(!P5&&!$5)try{const t=NQe.split('"{CONFIGURATION}"').join(`'${kQe()}'`);P5=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){$5=t||{}}let e;if(P5)try{e=new Worker(P5,{name:"esri-worker-"+UQe++})}catch{lee.warn(Vfe,$5),e=new yB}else lee.warn(Vfe,$5),e=new yB;return jfe(e)}async function jfe(e){return new Promise(t=>{function r(s){const n=fN(s);n&&n.type===LQe&&(e.removeEventListener("message",r),e.removeEventListener("error",i),t(e))}function i(s){s.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",i),lee.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new yB).addEventListener("message",r),e.addEventListener("error",i)}e.addEventListener("message",r),e.addEventListener("error",i)})}function kQe(){let e;if(Gr.default!=null){const s={...Gr};delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(Gr));e.assetsPath=Rh(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?Rh(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=fl(),e.has={"esri-csp-restrictions":pe("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":pe("esri-2d-update-debug"),"featurelayer-pbf":pe("featurelayer-pbf"),"featurelayer-simplify-thresholds":pe("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":pe("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":pe("featurelayer-simplify-mobile-factor"),"esri-atomics":pe("esri-atomics"),"esri-shared-array-buffer":pe("esri-shared-array-buffer"),"esri-tiles-debug":pe("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":pe("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":pe("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":pe("polylabel-placement-enabled")},e.workers.loaderUrl&&(e.workers.loaderUrl=Rh(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=Rh(e.workers.workerPath):e.workers.workerPath=Rh(ui("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=Gr.workers.loaderConfig,r=$Qe({baseUrl:t==null?void 0:t.baseUrl,locale:fl(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t==null?void 0:t.has},map:{...t==null?void 0:t.map},paths:{...t==null?void 0:t.paths},packages:(t==null?void 0:t.packages)||[]}),i={version:fEe,buildDate:hEe,revision:pEe};return JSON.stringify({esriConfig:e,loaderConfig:r,kernelInfo:i})}let UQe=0;const{ABORT:Gfe,INVOKE:BQe,OPEN:zQe,OPENED:VQe,RESPONSE:_P}=cl;class Hoe{constructor(t,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=r,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",i=>{i.preventDefault(),te.getLogger("esri.core.workers.WorkerOwner").error(i)})}static async create(t){const r=await FQe();return new Hoe(r,t)}terminate(){this.worker.terminate()}async open(t,r={}){const{signal:i}=r,s=RRe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:Use(i,()=>{this._outJobs.delete(s),this._post({type:Gfe,jobId:s})})};this._outJobs.set(s,a),this._post({type:zQe,jobId:s,modulePath:t})})}_onMessage(t){const r=fN(t);if(r)switch(r.type){case VQe:this._onOpenedMessage(r);break;case _P:this._onResponseMessage(r);break;case Gfe:this._onAbortMessage(r);break;case BQe:this._onInvokeMessage(r)}}_onAbortMessage(t){const r=this._inJobs,i=t.jobId,s=r.get(i);s&&(s.controller&&s.controller.abort(),r.delete(i))}_onInvokeMessage(t){const{methodName:r,jobId:i,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=F9e[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(d){return void this._post({type:_P,jobId:i,error:pN(d)})}np(c)?(a.set(i,{controller:o,promise:c}),c.then(d=>{a.has(i)&&(a.delete(i),this._post({type:_P,jobId:i},d))},d=>{a.has(i)&&(a.delete(i),d||(d={message:"Error encountered at method"+r}),Ps(d)||this._post({type:_P,jobId:i,error:pN(d||{message:`Error encountered at method ${r}`})}))})):this._post({type:_P,jobId:i},c)}_onOpenedMessage(t){const{jobId:r,data:i}=t,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),Gs(s.abortHandle),s.resolve(i))}_onResponseMessage(t){const{jobId:r,error:i,data:s}=t,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),Gs(n.abortHandle),i?n.reject(z.fromJSON(JSON.parse(i))):n.resolve(s))}_post(t,r,i){return Goe(this.worker,t,r,i)}}let f2=pe("esri-workers-debug")?1:pe("esri-mobile")?Math.min(navigator.hardwareConcurrency-1,3):pe("host-browser")?navigator.hardwareConcurrency-1:0;f2||(f2=pe("safari")&&pe("mac")||pe("trident")?7:2);let Hfe=0;const _B=[];function jQe(){PRe()}async function D5(e,t){const r=new IQe;return await r.open(e,t),r}async function IRe(e,t={}){if(typeof e!="string")throw new z("workers:undefined-module","modulePath is missing");let r=t.strategy||"distributed";if(pe("host-webworker")&&!pe("esri-workers")&&(r="local"),r==="local"){let i=await vd.loadWorker(e);i||(i=await re(()=>import(e),[])),Ir(t.signal);const s=t.client||i;return D5([vd.connect(i)],{...t,client:s})}if(await PRe(),Ir(t.signal),r==="dedicated"){const i=Hfe++%f2;return D5([await _B[i].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const i=Math.min(t.maxNumWorkers,f2);if(i<f2){const s=new Array(i);for(let n=0;n<i;++n){const o=Hfe++%f2;s[n]=_B[o].open(e,t)}return D5(s,t)}}return D5(_B.map(i=>i.open(e,t)),t)}let L5=null;async function PRe(){if(L5)return L5;new AbortController;const e=[];for(let t=0;t<f2;t++){const r=Hoe.create(t).then(i=>(_B[t]=i,i));e.push(r)}return L5=Promise.all(e),L5}function qfe(e,t,r){if(e.hasM==null||e.hasZ)for(const i of t)for(const s of i)s.length>2&&(s[2]*=r)}function GQe(e,t,r){if(!e&&!t||!r)return;const i=_E(r);Wfe(e,r,i),Wfe(t,r,i)}function Wfe(e,t,r){if(e)for(const i of e)HQe(i.geometry,t,r)}function HQe(e,t,r){if(C(e)||!e.spatialReference||ml(e.spatialReference,t))return;const i=_E(e.spatialReference)/r;if(i!==1){if("x"in e)e.z!=null&&(e.z*=i);else if("rings"in e)qfe(e,e.rings,i);else if("paths"in e)qfe(e,e.paths,i);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=i)}}function $Re(e,t,r){if(C(t)||C(r)||r.vcsWkid||ml(t,r))return null;const i=_E(t)/_E(r);if(i===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>qQe(s,i);case"polyline":case"esriGeometryPolyline":return s=>XQe(s,i);case"polygon":case"esriGeometryPolygon":return s=>WQe(s,i);case"multipoint":case"esriGeometryMultipoint":return s=>YQe(s,i);case"extent":case"esriGeometryExtent":return s=>ZQe(s,i);default:return null}}function qQe(e,t){e&&e.z!=null&&(e.z*=t)}function WQe(e,t){if(e)for(const r of e.rings)for(const i of r)i.length>2&&(i[2]*=t)}function XQe(e,t){if(e)for(const r of e.paths)for(const i of r)i.length>2&&(i[2]*=t)}function YQe(e,t){if(e)for(const r of e.points)r.length>2&&(r[2]*=t)}function ZQe(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}function cee(e,t,r){if(!r||!r.features||!r.hasZ)return;const i=$Re(r.geometryType,t,e.outSpatialReference);if(!C(i))for(const s of r.features)i(s.geometry)}const JQe=new gr({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var uee;const KQe=new gr({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let hc=uee=class extends fe{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,{description:t}){var i;let r=null;try{r=t?JSON.parse(t):null}catch{}return(i=r==null?void 0:r.value)!=null?i:null}readValueType(e,{description:t}){let r=null;try{r=t?JSON.parse(t):null}catch{}return r?KQe.fromJSON(r.fieldValueType):null}clone(){return new uee({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};u([h({type:String,json:{write:!0}})],hc.prototype,"alias",void 0),u([h({type:[String,Number],json:{write:{allowNull:!0}}})],hc.prototype,"defaultValue",void 0),u([h()],hc.prototype,"description",void 0),u([me("description")],hc.prototype,"readDescription",null),u([h({types:ERe,json:{read:{reader:joe},write:!0}})],hc.prototype,"domain",void 0),u([h({type:Boolean,json:{write:!0}})],hc.prototype,"editable",void 0),u([h({type:bs,json:{write:!0}})],hc.prototype,"length",void 0),u([h({type:String,json:{write:!0}})],hc.prototype,"name",void 0),u([h({type:Boolean,json:{write:!0}})],hc.prototype,"nullable",void 0),u([Ue(JQe)],hc.prototype,"type",void 0),u([h()],hc.prototype,"valueType",void 0),u([me("valueType",["description"])],hc.prototype,"readValueType",null),u([h({type:Boolean,json:{read:!1}})],hc.prototype,"visible",void 0),hc=uee=u([I("esri.layers.support.Field")],hc);const Aj=hc;var dee;const hee=new gr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Qa=dee=class extends fe{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){var s;const r=Ve.fromJSON(t.spatialReference),i=[];for(let n=0;n<e.length;n++){const o=e[n],a=_i.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;v(a.geometry)&&!l&&(a.geometry.spatialReference=r);const c=o.aggregateGeometries,d=a.aggregateGeometries;if(c&&v(d))for(const p in d){const f=d[p],m=(s=c[p])==null?void 0:s.spatialReference;v(f)&&!m&&(f.spatialReference=r)}i.push(a)}return i}writeGeometryType(e,t,r,i){if(e)return void hee.write(e,t,r,i);const{features:s}=this;if(s){for(const n of s)if(n&&v(n.geometry))return void hee.write(n.geometry.type,t,r,i)}}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,i=ql(e);return i&&!r&&t.spatialReference&&(i.spatialReference=Ve.fromJSON(t.spatialReference)),i}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&v(i.geometry)&&i.geometry.spatialReference)return void(t.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new dee(this.cloneProperties())}cloneProperties(){return ne({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const i=t.features[r];if(i.geometry){const s=e&&e[r];i.geometry=s&&s.toJSON()||i.geometry}}return t}quantize(e){const{scale:[t,r],translate:[i,s]}=e,n=c=>Math.round((c-i)/t),o=c=>Math.round((s-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,d=a.length;c<d;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,d--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[i,s],scale:[n,o]}=r,a=d=>d*n+i,l=d=>s-d*o,c=this._getHydrationFunction(e,a,l);for(const{geometry:d}of t)v(d)&&c&&c(d);return this.transform=null,this}_quantizePoints(e,t,r){let i,s;const n=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];if(o>0){const c=t(l[0]),d=r(l[1]);c===i&&d===s||(n.push([c-i,d-s]),i=c,s=d)}else i=t(l[0]),s=r(l[1]),n.push([i,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,r){return e==="point"?i=>(i.x=t(i.x),i.y=r(i.y),i):e==="polyline"||e==="polygon"?i=>{const s=D2(i)?i.rings:i.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,t,r);c&&n.push(c)}return n.length>0?(D2(i)?i.rings=n:i.paths=n,i):null}:e==="multipoint"?i=>{const s=this._quantizePoints(i.points,t,r);return s&&s.length>0?(i.points=s,i):null}:e==="extent"?i=>i:null}_getHydrationFunction(e,t,r){return e==="point"?i=>{i.x=t(i.x),i.y=r(i.y)}:e==="polyline"||e==="polygon"?i=>{const s=D2(i)?i.rings:i.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let d=0,p=c.length;d<p;d++){const f=c[d];d>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=t(n),f[1]=r(o)}}}:e==="extent"?i=>{i.xmin=t(i.xmin),i.ymin=r(i.ymin),i.xmax=t(i.xmax),i.ymax=r(i.ymax)}:e==="multipoint"?i=>{const s=i.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=t(n),c[1]=r(o)}}:null}};u([h({type:String,json:{write:!0}})],Qa.prototype,"displayFieldName",void 0),u([h({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Qa.prototype,"exceededTransferLimit",void 0),u([h({type:[_i],json:{write:!0}})],Qa.prototype,"features",void 0),u([me("features")],Qa.prototype,"readFeatures",null),u([h({type:[Aj],json:{write:!0}})],Qa.prototype,"fields",void 0),u([h({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:hee.read}}})],Qa.prototype,"geometryType",void 0),u([Le("geometryType")],Qa.prototype,"writeGeometryType",null),u([h({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Qa.prototype,"hasM",void 0),u([h({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Qa.prototype,"hasZ",void 0),u([h({types:Yx,json:{write:!0}})],Qa.prototype,"queryGeometry",void 0),u([me("queryGeometry")],Qa.prototype,"readQueryGeometry",null),u([h({type:Ve,json:{write:!0}})],Qa.prototype,"spatialReference",void 0),u([Le("spatialReference")],Qa.prototype,"writeSpatialReference",null),u([h({json:{write:!0}})],Qa.prototype,"transform",void 0),Qa=dee=u([I("esri.rest.support.FeatureSet")],Qa),Qa.prototype.toJSON.isDefaultToJSON=!0;const bd=Qa,A6t=Object.freeze(Object.defineProperty({__proto__:null,default:bd},Symbol.toStringTag,{value:"Module"}));let QQe=0;const DRe="esri.layers.graphics.sources.MemorySource",Sq=te.getLogger(DRe);let Y_=class extends Hv.LoadableMixin(G9($0(Ge))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=v(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var t;const e=(t=this.layer)==null?void 0:t.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);cee(e,this.layer.spatialReference,r);const i=bd.fromJSON(r);if(!this._requiresClientGraphicMapping())return i;const s=this.layer.objectIdField;for(const n of i.features){const o=n.attributes[s],a=this._idToClientGraphic.get(o);a&&(n.geometry=a.geometry)}return i.geometryType=this.layer.geometryType,i}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new z("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return cee(e,this.layer.spatialReference,r),r}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(r=>({count:r.count,extent:Sr.fromJSON(r.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new z("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let r=null;const i=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const d=n(c);d!=null&&i.push(d)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(s.push(this._serializeFeature(c)),o){const d=n(c);d!=null&&o.set(d,c)}}GQe(r?r.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:s,deletes:i});return this.fullExtent=a,r&&r.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this._layerOrSourceGeometryType!=="mesh"||C(e))return;const r=[];for(const{geometry:i}of e)!v(i)||i.type!=="mesh"||i.hasExtent||i.loaded||r.push(i.load({signal:t}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const r of t.updateResults){if(!r.success)continue;const i=e.get(r.objectId);i!=null&&this._addIdToClientGraphic(i)}for(const r of t.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new z("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,r=new Array(e.length);let i=null;for(let n=0;n<e.length;n++){const o=e[n],a=this._serializeFeature(o);!i&&v(o.geometry)&&(i=o.geometry.type),r[n]=a,t.set(`${a.uid}`,o)}const s=this;return{features:r,inferredGeometryType:i,finish(n){const o=s.sourceJSON.objectIdField;for(const a in n){const l=n[a],c=t.get(a);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[o]:c.attributes[o]=l,s._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[t];r!=null&&this._idToClientGraphic.set(r,e)}get _layerOrSourceGeometryType(){var e,t,r;return(r=(e=this.layer)==null?void 0:e.geometryType)!=null?r:(t=this.sourceJSON)==null?void 0:t.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,r=this._geometryForSerialization(e),i=(QQe++).toString();return r?{uid:i,geometry:r.toJSON(),attributes:t}:{uid:i,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return C(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?kl.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await IRe("MemorySourceWorker",{strategy:pe("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:r,objectIdField:i,hasM:s,hasZ:n,timeInfo:o}=this.layer,a=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",f=>{Sq.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),f.preventDefault()}));const c={features:l.features,fields:t&&t.map(f=>f.toJSON()),geometryType:ppe.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&s,hasZ:this._layerOrSourceGeometryType==="mesh"||n,objectIdField:i,spatialReference:a?null:r&&r.toJSON(),timeInfo:o?o.toJSON():null},d=await this._connection.invoke("load",c,{signal:e});for(const f of d.warnings)Sq.warn(f.message,{layer:this.layer,warning:f});d.featureErrors.length&&Sq.warn(`Encountered ${d.featureErrors.length} validation errors while loading features`,d.featureErrors);const p=d.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(p.geometryType=ppe.toJSON(l.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(d.assignedObjectIds)}};u([Gne({Type:_i,ensureType:ts(_i)})],Y_.prototype,"itemType",void 0),u([h()],Y_.prototype,"type",void 0),u([h({constructOnly:!0})],Y_.prototype,"layer",void 0),u([h({readOnly:!0})],Y_.prototype,"_workerGeometryType",null),u([h()],Y_.prototype,"sourceJSON",void 0),Y_=u([I(DRe)],Y_);function JF(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function eet(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function tet(e,t,r,i,s,n,o,a,l,c,d,p,f,m,g,_){const x=new Float32Array(16);return x[0]=e,x[1]=t,x[2]=r,x[3]=i,x[4]=s,x[5]=n,x[6]=o,x[7]=a,x[8]=l,x[9]=c,x[10]=d,x[11]=p,x[12]=f,x[13]=m,x[14]=g,x[15]=_,x}function ret(e,t){return new Float32Array(e,t,16)}const iet=JF();Object.freeze(Object.defineProperty({__proto__:null,create:JF,clone:eet,fromValues:tet,createView:ret,IDENTITY:iet},Symbol.toStringTag,{value:"Module"}));function jn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function N0(e,t,r,i,s,n,o,a,l,c,d,p,f,m,g,_,x){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=d,e[10]=p,e[11]=f,e[12]=m,e[13]=g,e[14]=_,e[15]=x,e}function fg(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Iu(e,t){if(e===t){const r=t[1],i=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Pn(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],d=t[8],p=t[9],f=t[10],m=t[11],g=t[12],_=t[13],x=t[14],b=t[15],w=r*a-i*o,T=r*l-s*o,E=r*c-n*o,O=i*l-s*a,A=i*c-n*a,R=s*c-n*l,D=d*_-p*g,k=d*x-f*g,L=d*b-m*g,q=p*x-f*_,G=p*b-m*_,J=f*b-m*x;let ee=w*J-T*G+E*q+O*L-A*k+R*D;return ee?(ee=1/ee,e[0]=(a*J-l*G+c*q)*ee,e[1]=(s*G-i*J-n*q)*ee,e[2]=(_*R-x*A+b*O)*ee,e[3]=(f*A-p*R-m*O)*ee,e[4]=(l*L-o*J-c*k)*ee,e[5]=(r*J-s*L+n*k)*ee,e[6]=(x*E-g*R-b*T)*ee,e[7]=(d*R-f*E+m*T)*ee,e[8]=(o*G-a*L+c*D)*ee,e[9]=(i*L-r*G-n*D)*ee,e[10]=(g*A-_*E+b*w)*ee,e[11]=(p*E-d*A-m*w)*ee,e[12]=(a*k-o*q-l*D)*ee,e[13]=(r*q-i*k+s*D)*ee,e[14]=(_*T-g*O-x*w)*ee,e[15]=(d*O-p*T+f*w)*ee,e):null}function set(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],d=t[8],p=t[9],f=t[10],m=t[11],g=t[12],_=t[13],x=t[14],b=t[15];return e[0]=a*(f*b-m*x)-p*(l*b-c*x)+_*(l*m-c*f),e[1]=-(i*(f*b-m*x)-p*(s*b-n*x)+_*(s*m-n*f)),e[2]=i*(l*b-c*x)-a*(s*b-n*x)+_*(s*c-n*l),e[3]=-(i*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),e[4]=-(o*(f*b-m*x)-d*(l*b-c*x)+g*(l*m-c*f)),e[5]=r*(f*b-m*x)-d*(s*b-n*x)+g*(s*m-n*f),e[6]=-(r*(l*b-c*x)-o*(s*b-n*x)+g*(s*c-n*l)),e[7]=r*(l*m-c*f)-o*(s*m-n*f)+d*(s*c-n*l),e[8]=o*(p*b-m*_)-d*(a*b-c*_)+g*(a*m-c*p),e[9]=-(r*(p*b-m*_)-d*(i*b-n*_)+g*(i*m-n*p)),e[10]=r*(a*b-c*_)-o*(i*b-n*_)+g*(i*c-n*a),e[11]=-(r*(a*m-c*p)-o*(i*m-n*p)+d*(i*c-n*a)),e[12]=-(o*(p*x-f*_)-d*(a*x-l*_)+g*(a*f-l*p)),e[13]=r*(p*x-f*_)-d*(i*x-s*_)+g*(i*f-s*p),e[14]=-(r*(a*x-l*_)-o*(i*x-s*_)+g*(i*l-s*a)),e[15]=r*(a*f-l*p)-o*(i*f-s*p)+d*(i*l-s*a),e}function net(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],_=e[14],x=e[15];return(t*o-r*n)*(p*x-f*_)-(t*a-i*n)*(d*x-f*g)+(t*l-s*n)*(d*_-p*g)+(r*a-i*o)*(c*x-f*m)-(r*l-s*o)*(c*_-p*m)+(i*l-s*a)*(c*g-d*m)}function Hs(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],d=t[7],p=t[8],f=t[9],m=t[10],g=t[11],_=t[12],x=t[13],b=t[14],w=t[15];let T=r[0],E=r[1],O=r[2],A=r[3];return e[0]=T*i+E*a+O*p+A*_,e[1]=T*s+E*l+O*f+A*x,e[2]=T*n+E*c+O*m+A*b,e[3]=T*o+E*d+O*g+A*w,T=r[4],E=r[5],O=r[6],A=r[7],e[4]=T*i+E*a+O*p+A*_,e[5]=T*s+E*l+O*f+A*x,e[6]=T*n+E*c+O*m+A*b,e[7]=T*o+E*d+O*g+A*w,T=r[8],E=r[9],O=r[10],A=r[11],e[8]=T*i+E*a+O*p+A*_,e[9]=T*s+E*l+O*f+A*x,e[10]=T*n+E*c+O*m+A*b,e[11]=T*o+E*d+O*g+A*w,T=r[12],E=r[13],O=r[14],A=r[15],e[12]=T*i+E*a+O*p+A*_,e[13]=T*s+E*l+O*f+A*x,e[14]=T*n+E*c+O*m+A*b,e[15]=T*o+E*d+O*g+A*w,e}function Pu(e,t,r){const i=r[0],s=r[1],n=r[2];if(t===e)e[12]=t[0]*i+t[4]*s+t[8]*n+t[12],e[13]=t[1]*i+t[5]*s+t[9]*n+t[13],e[14]=t[2]*i+t[6]*s+t[10]*n+t[14],e[15]=t[3]*i+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],d=t[4],p=t[5],f=t[6],m=t[7],g=t[8],_=t[9],x=t[10],b=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=d,e[5]=p,e[6]=f,e[7]=m,e[8]=g,e[9]=_,e[10]=x,e[11]=b,e[12]=o*i+d*s+g*n+t[12],e[13]=a*i+p*s+_*n+t[13],e[14]=l*i+f*s+x*n+t[14],e[15]=c*i+m*s+b*n+t[15]}return e}function Oj(e,t,r){const i=r[0],s=r[1],n=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Sd(e,t,r,i){let s,n,o,a,l,c,d,p,f,m,g,_,x,b,w,T,E,O,A,R,D,k,L,q,G=i[0],J=i[1],ee=i[2],se=Math.sqrt(G*G+J*J+ee*ee);return se<Xl()?null:(se=1/se,G*=se,J*=se,ee*=se,s=Math.sin(r),n=Math.cos(r),o=1-n,a=t[0],l=t[1],c=t[2],d=t[3],p=t[4],f=t[5],m=t[6],g=t[7],_=t[8],x=t[9],b=t[10],w=t[11],T=G*G*o+n,E=J*G*o+ee*s,O=ee*G*o-J*s,A=G*J*o-ee*s,R=J*J*o+n,D=ee*J*o+G*s,k=G*ee*o+J*s,L=J*ee*o-G*s,q=ee*ee*o+n,e[0]=a*T+p*E+_*O,e[1]=l*T+f*E+x*O,e[2]=c*T+m*E+b*O,e[3]=d*T+g*E+w*O,e[4]=a*A+p*R+_*D,e[5]=l*A+f*R+x*D,e[6]=c*A+m*R+b*D,e[7]=d*A+g*R+w*D,e[8]=a*k+p*L+_*q,e[9]=l*k+f*L+x*q,e[10]=c*k+m*L+b*q,e[11]=d*k+g*L+w*q,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function $R(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],d=t[9],p=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*i,e[5]=o*s+d*i,e[6]=a*s+p*i,e[7]=l*s+f*i,e[8]=c*s-n*i,e[9]=d*s-o*i,e[10]=p*s-a*i,e[11]=f*s-l*i,e}function Mj(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],d=t[9],p=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*i,e[1]=o*s-d*i,e[2]=a*s-p*i,e[3]=l*s-f*i,e[8]=n*i+c*s,e[9]=o*i+d*s,e[10]=a*i+p*s,e[11]=l*i+f*s,e}function DR(e,t,r){const i=Math.sin(r),s=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],d=t[5],p=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*i,e[1]=o*s+d*i,e[2]=a*s+p*i,e[3]=l*s+f*i,e[4]=c*s-n*i,e[5]=d*s-o*i,e[6]=p*s-a*i,e[7]=f*s-l*i,e}function Rj(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function oet(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Kh(e,t,r){if(t===0)return fg(e);let i,s,n,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<Xl()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*i,e[2]=l*o*n-a*i,e[3]=0,e[4]=o*a*n-l*i,e[5]=a*a*n+s,e[6]=l*a*n+o*i,e[7]=0,e[8]=o*l*n+a*i,e[9]=a*l*n-o*i,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function LRe(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function aet(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function NRe(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function FRe(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=i+i,l=s+s,c=n+n,d=i*a,p=i*l,f=i*c,m=s*l,g=s*c,_=n*c,x=o*a,b=o*l,w=o*c;return e[0]=1-(m+_),e[1]=p+w,e[2]=f-b,e[3]=0,e[4]=p-w,e[5]=1-(d+_),e[6]=g+x,e[7]=0,e[8]=f+b,e[9]=g-x,e[10]=1-(d+m),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function cet(e,t){const r=uet,i=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],d=t[7],p=i*i+s*s+n*n+o*o;return p>0?(r[0]=2*(a*o+d*i+l*n-c*s)/p,r[1]=2*(l*o+d*s+c*i-a*n)/p,r[2]=2*(c*o+d*n+a*s-l*i)/p):(r[0]=2*(a*o+d*i+l*n-c*s),r[1]=2*(l*o+d*s+c*i-a*n),r[2]=2*(c*o+d*n+a*s-l*i)),FRe(e,t,r),e}const uet=$();function det(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function kRe(e,t){const r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],d=t[10];return e[0]=Math.sqrt(r*r+i*i+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+d*d),e}function het(e,t){const r=t[0]+t[5]+t[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e}function pet(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,d=o+o,p=s*l,f=s*c,m=s*d,g=n*c,_=n*d,x=o*d,b=a*l,w=a*c,T=a*d,E=i[0],O=i[1],A=i[2];return e[0]=(1-(g+x))*E,e[1]=(f+T)*E,e[2]=(m-w)*E,e[3]=0,e[4]=(f-T)*O,e[5]=(1-(p+x))*O,e[6]=(_+b)*O,e[7]=0,e[8]=(m+w)*A,e[9]=(_-b)*A,e[10]=(1-(p+g))*A,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fet(e,t,r,i,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,d=o+o,p=a+a,f=n*c,m=n*d,g=n*p,_=o*d,x=o*p,b=a*p,w=l*c,T=l*d,E=l*p,O=i[0],A=i[1],R=i[2],D=s[0],k=s[1],L=s[2],q=(1-(_+b))*O,G=(m+E)*O,J=(g-T)*O,ee=(m-E)*A,se=(1-(f+b))*A,X=(x+w)*A,F=(g+T)*R,N=(x-w)*R,B=(1-(f+_))*R;return e[0]=q,e[1]=G,e[2]=J,e[3]=0,e[4]=ee,e[5]=se,e[6]=X,e[7]=0,e[8]=F,e[9]=N,e[10]=B,e[11]=0,e[12]=r[0]+D-(q*D+ee*k+F*L),e[13]=r[1]+k-(G*D+se*k+N*L),e[14]=r[2]+L-(J*D+X*k+B*L),e[15]=1,e}function met(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r+r,a=i+i,l=s+s,c=r*o,d=i*o,p=i*a,f=s*o,m=s*a,g=s*l,_=n*o,x=n*a,b=n*l;return e[0]=1-p-g,e[1]=d+b,e[2]=f-x,e[3]=0,e[4]=d-b,e[5]=1-c-g,e[6]=m+_,e[7]=0,e[8]=f+x,e[9]=m-_,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function URe(e,t,r,i,s,n,o){const a=1/(r-t),l=1/(s-i),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(s+i)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function get(e,t,r,i,s){const n=1/Math.tan(t/2);let o;return e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(i-s),e[10]=(s+i)*o,e[14]=2*s*i*o):(e[10]=-1,e[14]=-2*i),e}function yet(e,t,r,i){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function qoe(e,t,r,i,s,n,o){const a=1/(t-r),l=1/(i-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(s+i)*l,e[14]=(o+n)*c,e[15]=1,e}function Ij(e,t,r,i){let s,n,o,a,l,c,d,p,f,m;const g=t[0],_=t[1],x=t[2],b=i[0],w=i[1],T=i[2],E=r[0],O=r[1],A=r[2],R=Xl();return Math.abs(g-E)<R&&Math.abs(_-O)<R&&Math.abs(x-A)<R?fg(e):(d=g-E,p=_-O,f=x-A,m=1/Math.sqrt(d*d+p*p+f*f),d*=m,p*=m,f*=m,s=w*f-T*p,n=T*d-b*f,o=b*p-w*d,m=Math.sqrt(s*s+n*n+o*o),m?(m=1/m,s*=m,n*=m,o*=m):(s=0,n=0,o=0),a=p*o-f*n,l=f*s-d*o,c=d*n-p*s,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),e[0]=s,e[1]=a,e[2]=d,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=o,e[9]=c,e[10]=f,e[11]=0,e[12]=-(s*g+n*_+o*x),e[13]=-(a*g+l*_+c*x),e[14]=-(d*g+p*_+f*x),e[15]=1,e)}function BRe(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=i[0],l=i[1],c=i[2];let d=s-r[0],p=n-r[1],f=o-r[2],m=d*d+p*p+f*f;m>0&&(m=1/Math.sqrt(m),d*=m,p*=m,f*=m);let g=l*f-c*p,_=c*d-a*f,x=a*p-l*d;return m=g*g+_*_+x*x,m>0&&(m=1/Math.sqrt(m),g*=m,_*=m,x*=m),e[0]=g,e[1]=_,e[2]=x,e[3]=0,e[4]=p*x-f*_,e[5]=f*g-d*x,e[6]=d*_-p*g,e[7]=0,e[8]=d,e[9]=p,e[10]=f,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function _et(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function vet(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function bet(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function zRe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function wet(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function xet(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function VRe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function jRe(e,t){if(e===t)return!0;const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],d=e[8],p=e[9],f=e[10],m=e[11],g=e[12],_=e[13],x=e[14],b=e[15],w=t[0],T=t[1],E=t[2],O=t[3],A=t[4],R=t[5],D=t[6],k=t[7],L=t[8],q=t[9],G=t[10],J=t[11],ee=t[12],se=t[13],X=t[14],F=t[15],N=Xl();return Math.abs(r-w)<=N*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(i-T)<=N*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(s-E)<=N*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-O)<=N*Math.max(1,Math.abs(n),Math.abs(O))&&Math.abs(o-A)<=N*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-R)<=N*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(l-D)<=N*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(c-k)<=N*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(d-L)<=N*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(p-q)<=N*Math.max(1,Math.abs(p),Math.abs(q))&&Math.abs(f-G)<=N*Math.max(1,Math.abs(f),Math.abs(G))&&Math.abs(m-J)<=N*Math.max(1,Math.abs(m),Math.abs(J))&&Math.abs(g-ee)<=N*Math.max(1,Math.abs(g),Math.abs(ee))&&Math.abs(_-se)<=N*Math.max(1,Math.abs(_),Math.abs(se))&&Math.abs(x-X)<=N*Math.max(1,Math.abs(x),Math.abs(X))&&Math.abs(b-F)<=N*Math.max(1,Math.abs(b),Math.abs(F))}function Woe(e){const t=Xl(),r=e[0],i=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],d=e[10];return Math.abs(1-(r*r+n*n+l*l))<=t&&Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+d*d))<=t}const Tet=Hs,Eet=zRe;Object.freeze(Object.defineProperty({__proto__:null,copy:jn,set:N0,identity:fg,transpose:Iu,invert:Pn,adjoint:set,determinant:net,multiply:Hs,translate:Pu,scale:Oj,rotate:Sd,rotateX:$R,rotateY:Mj,rotateZ:DR,fromTranslation:Rj,fromScaling:oet,fromRotation:Kh,fromXRotation:LRe,fromYRotation:aet,fromZRotation:NRe,fromRotationTranslation:FRe,fromQuat2:cet,getTranslation:det,getScaling:kRe,getRotation:het,fromRotationTranslationScale:pet,fromRotationTranslationScaleOrigin:fet,fromQuat:met,frustum:URe,perspective:get,perspectiveFromFieldOfView:yet,ortho:qoe,lookAt:Ij,targetTo:BRe,str:_et,frob:vet,add:bet,subtract:zRe,multiplyScalar:wet,multiplyScalarAndAdd:xet,exactEquals:VRe,equals:jRe,isOrthoNormal:Woe,mul:Tet,sub:Eet},Symbol.toStringTag,{value:"Module"}));const Cet=(e,t)=>{const r=N0(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return Iu(r,r)},Aet=(e,t)=>{const r=N0(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return Iu(r,r)},Oet=(e,t)=>{const r=1-t,i=N0(e,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return Iu(i,i)},Met=(e,t)=>{const r=Math.sin(t*Math.PI/180),i=Math.cos(t*Math.PI/180),s=N0(e,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return Iu(s,s)},Ret=(e,t)=>{const r=1-2*t,i=N0(e,r,0,0,t,0,r,0,t,0,0,r,t,0,0,0,1);return Iu(i,i)},Iet=(e,t)=>{const r=N0(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return Iu(r,r)},Pet=(e,t)=>{const r=1-t,i=N0(e,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return Iu(i,i)};class Pj{constructor(t,r,i){this.strength=t,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(t,r,i){this.strength=hd(t.strength,r.strength,i),this.radius=hd(t.radius,r.radius,i),this.threshold=hd(t.threshold,r.threshold,i)}clone(){return new Pj(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:zD(this.radius),strength:this.strength,threshold:this.threshold}}}class $j{constructor(t){this.radius=t,this.type="blur"}interpolate(t,r,i){this.radius=Math.round(hd(t.radius,r.radius,i))}clone(){return new $j(this.radius)}toJSON(){return{type:"blur",radius:zD(this.radius)}}}class mN{constructor(t,r){this.type=t,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,i){this.amount=hd(t.amount,r.amount,i),this._updateMatrix()}clone(){return new mN(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||JF();switch(this.type){case"brightness":this._colorMatrix=Cet(t,this.amount);break;case"contrast":this._colorMatrix=Aet(t,this.amount);break;case"grayscale":this._colorMatrix=Oet(t,this.amount);break;case"invert":this._colorMatrix=Ret(t,this.amount);break;case"saturate":this._colorMatrix=Iet(t,this.amount);break;case"sepia":this._colorMatrix=Pet(t,this.amount)}}}class Dj{constructor(t,r,i,s){this.offsetX=t,this.offsetY=r,this.blurRadius=i,this.color=s,this.type="drop-shadow"}interpolate(t,r,i){this.offsetX=hd(t.offsetX,r.offsetX,i),this.offsetY=hd(t.offsetY,r.offsetY,i),this.blurRadius=hd(t.blurRadius,r.blurRadius,i),this.color[0]=Math.round(hd(t.color[0],r.color[0],i)),this.color[1]=Math.round(hd(t.color[1],r.color[1],i)),this.color[2]=Math.round(hd(t.color[2],r.color[2],i)),this.color[3]=hd(t.color[3],r.color[3],i)}clone(){return new Dj(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:zD(this.offsetX),yoffset:zD(this.offsetY),blurRadius:zD(this.blurRadius),color:t}}}class Lj{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,i){this.angle=hd(t.angle,r.angle,i),this._updateMatrix()}clone(){return new Lj(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||JF();this._colorMatrix=Met(t,this.angle)}}class Nj{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,r,i){this.amount=hd(t.amount,r.amount,i)}clone(){return new Nj(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function hd(e,t,r){return e+(t-e)*r}function zD(e){return Math.round(1e3*xf(e))/1e3}function $et(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new mN(e.type,0);case"saturate":case"brightness":case"contrast":return new mN(e.type,1);case"opacity":return new Nj(1);case"hue-rotate":return new Lj(0);case"blur":return new $j(0);case"drop-shadow":return new Dj(0,0,0,[...loe("transparent")]);case"bloom":return new Pj(0,0,1)}}function Det(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every((i,s)=>i.type===r[s].type)}function Let(e,t){const r=e.length>t.length?e:t,i=e.length>t.length?t:e;for(let s=i.length;s<r.length;s++)i.push($et(r[s]))}function Net(e){const t=e[0];return!!t&&"type"in t}var Xfe,Yfe,GRe={exports:{}};function HRe(e){if(!e||e.length===0)return null;if(typeof e=="string"){const r=Zfe(e);return r&&r.length!==0?r:null}const t=e.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new z("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:Zfe(r.value)}});t.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<t.length-1;r++){if(!Det(t[r].effects,t[r+1].effects))throw new z("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[r].effects,b:t[r+1].effects});Let(t[r].effects,t[r+1].effects)}return t.sort((r,i)=>i.scale-r.scale),t}function Zfe(e){let t;if(!e)return[];try{t=GRe.exports.parse(e)}catch(r){throw new z("effect:invalid-syntax","Invalid effect syntax",{value:e,error:r})}return t.map(r=>Fet(r))}function Fet(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return ket(e);case"opacity":return Uet(e);case"hue-rotate":return Bet(e);case"blur":return zet(e);case"drop-shadow":return Vet(e);case"bloom":return jet(e)}}catch(t){throw t.details.filter=e,t}throw new z("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function ket(e){let t=1;return DI(e.parameters,1),e.parameters.length===1&&(t=Mm(e.parameters[0])),new mN(e.name,t)}function Uet(e){let t=1;return DI(e.parameters,1),e.parameters.length===1&&(t=Mm(e.parameters[0])),new Nj(t)}function Bet(e){let t=0;return DI(e.parameters,1),e.parameters.length===1&&(t=Yet(e.parameters[0])),new Lj(t)}function zet(e){let t=0;return DI(e.parameters,1),e.parameters.length===1&&(t=Zoe(e.parameters[0]),KF(t,e.parameters[0])),new $j(t)}function Vet(e){const t=[];let r=null;for(const i of e.parameters)if(i.type==="color"){if(t.length&&Object.freeze(t),r)throw new z("effect:type-error","Accepts only one color",{});r=Zet(i)}else{const s=Zoe(i);if(Object.isFrozen(t))throw new z("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&KF(s,i)}if(t.length<2||t.length>3)throw new z("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new Dj(t[0],t[1],t[2]||0,r||qRe("black"))}function jet(e){let t=1,r=0,i=0;return DI(e.parameters,3),e.parameters[0]&&(t=Mm(e.parameters[0])),e.parameters[1]&&(r=Zoe(e.parameters[1]),KF(r,e.parameters[1])),e.parameters[2]&&(i=Mm(e.parameters[2])),new Pj(t,r,i)}function DI(e,t){if(e.length>t)throw new z("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function Fj(e){if(e.type==="color")return"<color>";if(e.unit){if(Yoe[e.unit])return"<length>";if(Xoe[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function KF(e,t){if(e<0)throw new z("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function Get(e){if(e.type!=="quantity"||e.unit!==null)throw new z("effect:type-error",`Expected <double>, Actual: ${Fj(e)}`,{term:e})}function Het(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new z("effect:type-error",`Expected <double> or <percentage>, Actual: ${Fj(e)}`,{term:e})}Yfe=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function r(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function i(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:q0},d=q0,p="none",f=")",m=",",g="(",_="%",x="px",b="cm",w="mm",T="in",E="pt",O="pc",A="deg",R="rad",D="grad",k="turn",L="#",q=".",G="e",J=/^[ \t\n\r]/,ee=/^[a-z\-]/,se=/^[0-9a-fA-F]/,X=/^[+\-]/,F=/^[0-9]/,N=Bc("none"),B=gn("none",!1),H=gn(")",!1),W=gn(",",!1),K=Bc("whitespace"),Y=Nf([" ","	",`
`,"\r"],!1,!1),ce=Bc("function"),we=gn("(",!1),Oe=Bc("identifier"),Be=Nf([["a","z"],"-"],!1,!1),He=Bc("percentage"),Se=gn("%",!1),he=Bc("length"),Me=gn("px",!1),Xt=gn("cm",!1),Er=gn("mm",!1),Cr=gn("in",!1),bt=gn("pt",!1),ht=gn("pc",!1),rr=Bc("angle"),yr=gn("deg",!1),Ui=gn("rad",!1),it=gn("grad",!1),ur=gn("turn",!1),mi=Bc("number"),zr=Bc("color"),ir=gn("#",!1),Nr=Nf([["0","9"],["a","f"],["A","F"]],!1,!1),_t=Nf(["+","-"],!1,!1),ft=Nf([["0","9"]],!1,!1),Bt=gn(".",!1),Ar=gn("e",!1),Fr=function(){return[]},_r=function(Z,ve){return{type:"function",name:Z,parameters:ve||[]}},Or=function(Z,ve){return ve.length>0?C1(Z,ve,3):[Z]},sr=function(Z){return{type:"quantity",value:Z.value,unit:Z.unit}},gi=function(Z){return{type:"color",colorType:Z.type,value:Z.value}},Hr=function(Z){return Z},is=function(){return H0()},Es=function(Z){return{value:Z,unit:"%"}},Co=function(Z){return{value:Z,unit:"px"}},Wo=function(Z){return{value:Z,unit:"cm"}},co=function(Z){return{value:Z,unit:"mm"}},Nu=function(Z){return{value:Z,unit:"in"}},kc=function(Z){return{value:Z,unit:"pt"}},Xo=function(Z){return{value:Z,unit:"pc"}},Ao=function(Z){return{value:Z,unit:"deg"}},Ls=function(Z){return{value:Z,unit:"rad"}},qs=function(Z){return{value:Z,unit:"grad"}},Vr=function(Z){return{value:Z,unit:"turn"}},Bi=function(Z){return{value:Z,unit:null}},Dn=function(){return{type:"hex",value:H0()}},Ws=function(Z){return{type:"function",value:Z}},uo=function(){return{type:"named",value:H0()}},Uc=function(){return parseFloat(H0())},oe=0,ss=0,Tg=[{line:1,column:1}],Jl=0,G0=[],gt=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');d=c[n.startRule]}function H0(){return s.substring(ss,oe)}function gn(Z,ve){return{type:"literal",text:Z,ignoreCase:ve}}function Nf(Z,ve,Pe){return{type:"class",parts:Z,inverted:ve,ignoreCase:Pe}}function x1(){return{type:"end"}}function Bc(Z){return{type:"other",description:Z}}function I4(Z){var ve,Pe=Tg[Z];if(Pe)return Pe;for(ve=Z-1;!Tg[ve];)ve--;for(Pe={line:(Pe=Tg[ve]).line,column:Pe.column};ve<Z;)s.charCodeAt(ve)===10?(Pe.line++,Pe.column=1):Pe.column++,ve++;return Tg[Z]=Pe,Pe}function P4(Z,ve){var Pe=I4(Z),$r=I4(ve);return{source:l,start:{offset:Z,line:Pe.line,column:Pe.column},end:{offset:ve,line:$r.line,column:$r.column}}}function Jt(Z){oe<Jl||(oe>Jl&&(Jl=oe,G0=[]),G0.push(Z))}function T1(Z,ve,Pe){return new t(t.buildMessage(Z,ve),Z,ve,Pe)}function q0(){var Z;return(Z=S1())===a&&(Z=E1()),Z}function S1(){var Z,ve;return gt++,Z=oe,Si(),s.substr(oe,4)===p?(ve=p,oe+=4):(ve=a,gt===0&&Jt(B)),ve!==a?(Si(),ss=Z,Z=Fr()):(oe=Z,Z=a),gt--,Z===a&&gt===0&&Jt(N),Z}function E1(){var Z,ve;if(Z=[],(ve=Sg())!==a)for(;ve!==a;)Z.push(ve),ve=Sg();else Z=a;return Z}function Sg(){var Z,ve,Pe,$r;return Z=oe,Si(),(ve=ap())!==a?(Si(),(Pe=ZI())===a&&(Pe=null),Si(),s.charCodeAt(oe)===41?($r=f,oe++):($r=a,gt===0&&Jt(H)),$r!==a?(Si(),ss=Z,Z=_r(ve,Pe)):(oe=Z,Z=a)):(oe=Z,Z=a),Z}function ZI(){var Z,ve,Pe,$r,Oo,ns,Ya,nT;if(Z=oe,(ve=Fu())!==a){for(Pe=[],$r=oe,Oo=Si(),s.charCodeAt(oe)===44?(ns=m,oe++):(ns=a,gt===0&&Jt(W)),ns===a&&(ns=null),Ya=Si(),(nT=Fu())!==a?$r=Oo=[Oo,ns,Ya,nT]:(oe=$r,$r=a);$r!==a;)Pe.push($r),$r=oe,Oo=Si(),s.charCodeAt(oe)===44?(ns=m,oe++):(ns=a,gt===0&&Jt(W)),ns===a&&(ns=null),Ya=Si(),(nT=Fu())!==a?$r=Oo=[Oo,ns,Ya,nT]:(oe=$r,$r=a);ss=Z,Z=Or(ve,Pe)}else oe=Z,Z=a;return Z}function Fu(){var Z,ve;return Z=oe,(ve=ya())===a&&(ve=zc())===a&&(ve=Eg())===a&&(ve=W0()),ve!==a&&(ss=Z,ve=sr(ve)),(Z=ve)===a&&(Z=oe,(ve=Cg())!==a&&(ss=Z,ve=gi(ve)),Z=ve),Z}function Si(){var Z,ve;for(gt++,Z=[],J.test(s.charAt(oe))?(ve=s.charAt(oe),oe++):(ve=a,gt===0&&Jt(Y));ve!==a;)Z.push(ve),J.test(s.charAt(oe))?(ve=s.charAt(oe),oe++):(ve=a,gt===0&&Jt(Y));return gt--,ve=a,gt===0&&Jt(K),Z}function ap(){var Z,ve,Pe;return gt++,Z=oe,(ve=lp())!==a?(s.charCodeAt(oe)===40?(Pe=g,oe++):(Pe=a,gt===0&&Jt(we)),Pe!==a?(ss=Z,Z=Hr(ve)):(oe=Z,Z=a)):(oe=Z,Z=a),gt--,Z===a&&(ve=a,gt===0&&Jt(ce)),Z}function lp(){var Z,ve,Pe;if(gt++,Z=oe,ve=[],ee.test(s.charAt(oe))?(Pe=s.charAt(oe),oe++):(Pe=a,gt===0&&Jt(Be)),Pe!==a)for(;Pe!==a;)ve.push(Pe),ee.test(s.charAt(oe))?(Pe=s.charAt(oe),oe++):(Pe=a,gt===0&&Jt(Be));else ve=a;return ve!==a&&(ss=Z,ve=is()),gt--,(Z=ve)===a&&(ve=a,gt===0&&Jt(Oe)),Z}function ya(){var Z,ve,Pe;return gt++,Z=oe,Si(),(ve=Yo())!==a?(s.charCodeAt(oe)===37?(Pe=_,oe++):(Pe=a,gt===0&&Jt(Se)),Pe!==a?(ss=Z,Z=Es(ve)):(oe=Z,Z=a)):(oe=Z,Z=a),gt--,Z===a&&gt===0&&Jt(He),Z}function zc(){var Z,ve,Pe;return gt++,Z=oe,Si(),(ve=Yo())!==a?(s.substr(oe,2)===x?(Pe=x,oe+=2):(Pe=a,gt===0&&Jt(Me)),Pe!==a?(ss=Z,Z=Co(ve)):(oe=Z,Z=a)):(oe=Z,Z=a),Z===a&&(Z=oe,Si(),(ve=Yo())!==a?(s.substr(oe,2)===b?(Pe=b,oe+=2):(Pe=a,gt===0&&Jt(Xt)),Pe!==a?(ss=Z,Z=Wo(ve)):(oe=Z,Z=a)):(oe=Z,Z=a),Z===a&&(Z=oe,Si(),(ve=Yo())!==a?(s.substr(oe,2)===w?(Pe=w,oe+=2):(Pe=a,gt===0&&Jt(Er)),Pe!==a?(ss=Z,Z=co(ve)):(oe=Z,Z=a)):(oe=Z,Z=a),Z===a&&(Z=oe,Si(),(ve=Yo())!==a?(s.substr(oe,2)===T?(Pe=T,oe+=2):(Pe=a,gt===0&&Jt(Cr)),Pe!==a?(ss=Z,Z=Nu(ve)):(oe=Z,Z=a)):(oe=Z,Z=a),Z===a&&(Z=oe,Si(),(ve=Yo())!==a?(s.substr(oe,2)===E?(Pe=E,oe+=2):(Pe=a,gt===0&&Jt(bt)),Pe!==a?(ss=Z,Z=kc(ve)):(oe=Z,Z=a)):(oe=Z,Z=a),Z===a&&(Z=oe,Si(),(ve=Yo())!==a?(s.substr(oe,2)===O?(Pe=O,oe+=2):(Pe=a,gt===0&&Jt(ht)),Pe!==a?(ss=Z,Z=Xo(ve)):(oe=Z,Z=a)):(oe=Z,Z=a)))))),gt--,Z===a&&gt===0&&Jt(he),Z}function Eg(){var Z,ve,Pe;return gt++,Z=oe,(ve=Yo())!==a?(s.substr(oe,3)===A?(Pe=A,oe+=3):(Pe=a,gt===0&&Jt(yr)),Pe!==a?(ss=Z,Z=Ao(ve)):(oe=Z,Z=a)):(oe=Z,Z=a),Z===a&&(Z=oe,(ve=Yo())!==a?(s.substr(oe,3)===R?(Pe=R,oe+=3):(Pe=a,gt===0&&Jt(Ui)),Pe!==a?(ss=Z,Z=Ls(ve)):(oe=Z,Z=a)):(oe=Z,Z=a),Z===a&&(Z=oe,(ve=Yo())!==a?(s.substr(oe,4)===D?(Pe=D,oe+=4):(Pe=a,gt===0&&Jt(it)),Pe!==a?(ss=Z,Z=qs(ve)):(oe=Z,Z=a)):(oe=Z,Z=a),Z===a&&(Z=oe,(ve=Yo())!==a?(s.substr(oe,4)===k?(Pe=k,oe+=4):(Pe=a,gt===0&&Jt(ur)),Pe!==a?(ss=Z,Z=Vr(ve)):(oe=Z,Z=a)):(oe=Z,Z=a)))),gt--,Z===a&&(ve=a,gt===0&&Jt(rr)),Z}function W0(){var Z,ve;return gt++,Z=oe,Si(),(ve=Yo())!==a?(ss=Z,Z=Bi(ve)):(oe=Z,Z=a),gt--,Z===a&&gt===0&&Jt(mi),Z}function Cg(){var Z,ve,Pe,$r;if(gt++,Z=oe,s.charCodeAt(oe)===35?(ve=L,oe++):(ve=a,gt===0&&Jt(ir)),ve!==a){if(Pe=[],se.test(s.charAt(oe))?($r=s.charAt(oe),oe++):($r=a,gt===0&&Jt(Nr)),$r!==a)for(;$r!==a;)Pe.push($r),se.test(s.charAt(oe))?($r=s.charAt(oe),oe++):($r=a,gt===0&&Jt(Nr));else Pe=a;Pe!==a?(ss=Z,Z=Dn()):(oe=Z,Z=a)}else oe=Z,Z=a;return Z===a&&(Z=oe,(ve=Sg())!==a&&(ss=Z,ve=Ws(ve)),(Z=ve)===a&&(Z=oe,(ve=lp())!==a&&(ss=Z,ve=uo()),Z=ve)),gt--,Z===a&&(ve=a,gt===0&&Jt(zr)),Z}function Yo(){var Z,ve,Pe,$r,Oo,ns,Ya;for(Z=oe,X.test(s.charAt(oe))?(s.charAt(oe),oe++):gt===0&&Jt(_t),ve=oe,Pe=[],F.test(s.charAt(oe))?($r=s.charAt(oe),oe++):($r=a,gt===0&&Jt(ft));$r!==a;)Pe.push($r),F.test(s.charAt(oe))?($r=s.charAt(oe),oe++):($r=a,gt===0&&Jt(ft));if(s.charCodeAt(oe)===46?($r=q,oe++):($r=a,gt===0&&Jt(Bt)),$r!==a){if(Oo=[],F.test(s.charAt(oe))?(ns=s.charAt(oe),oe++):(ns=a,gt===0&&Jt(ft)),ns!==a)for(;ns!==a;)Oo.push(ns),F.test(s.charAt(oe))?(ns=s.charAt(oe),oe++):(ns=a,gt===0&&Jt(ft));else Oo=a;Oo!==a?ve=Pe=[Pe,$r,Oo]:(oe=ve,ve=a)}else oe=ve,ve=a;if(ve===a)if(ve=[],F.test(s.charAt(oe))?(Pe=s.charAt(oe),oe++):(Pe=a,gt===0&&Jt(ft)),Pe!==a)for(;Pe!==a;)ve.push(Pe),F.test(s.charAt(oe))?(Pe=s.charAt(oe),oe++):(Pe=a,gt===0&&Jt(ft));else ve=a;if(ve!==a){if(Pe=oe,s.charCodeAt(oe)===101?($r=G,oe++):($r=a,gt===0&&Jt(Ar)),$r!==a){if(X.test(s.charAt(oe))?(Oo=s.charAt(oe),oe++):(Oo=a,gt===0&&Jt(_t)),Oo===a&&(Oo=null),ns=[],F.test(s.charAt(oe))?(Ya=s.charAt(oe),oe++):(Ya=a,gt===0&&Jt(ft)),Ya!==a)for(;Ya!==a;)ns.push(Ya),F.test(s.charAt(oe))?(Ya=s.charAt(oe),oe++):(Ya=a,gt===0&&Jt(ft));else ns=a;ns!==a?Pe=$r=[$r,Oo,ns]:(oe=Pe,Pe=a)}else oe=Pe,Pe=a;Pe===a&&(Pe=null),ss=Z,Z=Uc()}else oe=Z,Z=a;return Z}function sT(Z,ve){return Z.map(function(Pe){return Pe[ve]})}function C1(Z,ve,Pe){return[Z].concat(sT(ve,Pe))}if((o=d())!==a&&oe===s.length)return o;throw o!==a&&oe<s.length&&Jt(x1()),T1(G0,Jl<s.length?s.charAt(Jl):null,Jl<s.length?P4(Jl,Jl+1):P4(Jl,Jl))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var d=this.location.end,p=r("",l.line.toString().length," "),f=a[l.line-1],m=(l.line===d.line?d.column:f.length+1)-l.column||1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+r("",l.column-1," ")+r("",m,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(m.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function d(m){return o[m.type](m)}function p(m){var g,_,x=m.map(d);if(x.sort(),x.length>0){for(g=1,_=1;g<x.length;g++)x[g-1]!==x[g]&&(x[_]=x[g],_++);x.length=_}switch(x.length){case 1:return x[0];case 2:return x[0]+" or "+x[1];default:return x.slice(0,-1).join(", ")+", or "+x[x.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:t,parse:i}},(Xfe=GRe).exports&&(Xfe.exports=Yfe());const Xoe={deg:1,grad:.9,rad:180/Math.PI,turn:360};function qet(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&Xoe[e.unit]!=null))throw new z("effect:type-error",`Expected <angle>, Actual: ${Fj(e)}`,{term:e})}const Yoe={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Wet(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&Yoe[e.unit]!=null))throw new z("effect:type-error",`Expected <length>, Actual: ${Fj(e)}`,{term:e})}function Mm(e){Het(e);const t=e.value;return KF(t,e),e.unit==="%"?.01*t:t}function Xet(e){return Get(e),KF(e.value,e),e.value}function Yet(e){return qet(e),e.value*Xoe[e.unit]||0}function Zoe(e){return Wet(e),e.value*Yoe[e.unit]||0}function Zet(e){switch(e.colorType){case"hex":return eYe(e.value);case"named":return qRe(e.value);case"function":return Qet(e.value)}}function qRe(e){if(!HAe(e))throw new z("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return QXe(e)}const Jet=/^rgba?/i,Ket=/^hsla?/i;function Qet(e){if(DI(e.parameters,4),Jet.test(e.name))return[Mm(e.parameters[0]),Mm(e.parameters[1]),Mm(e.parameters[2]),e.parameters[3]?Mm(e.parameters[3]):1];if(Ket.test(e.name))return qAe(Xet(e.parameters[0]),Mm(e.parameters[1]),Mm(e.parameters[2]),e.parameters[3]?Mm(e.parameters[3]):1);throw new z("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function Joe(e,t,r){var i;try{return ttt(e)}catch(s){(i=r==null?void 0:r.messages)==null||i.push(s)}return null}function Koe(e,t,r,i){try{const s=ett(e);Vl(r,s,t)}catch(s){i.messages&&i.messages.push(s)}}function ett(e){const t=HRe(e);return t?Net(t)?t.map(r=>r.toJSON()):t.map(({scale:r,effects:i})=>({scale:r,value:i.map(s=>s.toJSON())})):null}function ttt(e){if(!e||e.length===0)return null;if(rtt(e)){const t=[];for(const r of e)t.push({scale:r.scale,value:Jfe(r.value)});return t}return Jfe(e)}function rtt(e){const t=e[0];return!!t&&"scale"in t}function Jfe(e){if(!e||!e.length)return"";const t=[];for(const r of e){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[X0(r,"amount")];break;case"blur":i=[X0(r,"radius","pt")];break;case"hue-rotate":i=[X0(r,"angle","deg")];break;case"drop-shadow":i=[X0(r,"xoffset","pt"),X0(r,"yoffset","pt"),X0(r,"blurRadius","pt"),itt(r,"color")];break;case"bloom":i=[X0(r,"strength"),X0(r,"radius","pt"),X0(r,"threshold")]}const s=`${r.type}(${i.filter(Boolean).join(" ")})`;HRe(s),t.push(s)}return t.join(" ")}function X0(e,t,r){if(e[t]==null)throw new z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return r?e[t]+r:""+e[t]}function itt(e,t){if(e[t]==null)throw new z("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const r=e[t];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}const Kfe={read:{reader:Joe},write:{allowNull:!0,writer:Koe}},Qoe=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([h({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),u([h({json:{read:!1,write:!1,origins:{"web-map":Kfe,"portal-item":Kfe}}})],t.prototype,"effect",void 0),t=u([I("esri.layers.mixins.BlendLayer")],t),t},stt=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return u([h({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],t.prototype,"customParameters",void 0),t=u([I("esri.layers.mixins.CustomParametersMixin")],t),t};var pee;let XA=pee=class extends fe{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new pee({mapLayerId:e,gdbVersion:t})}};u([Ue({mapLayer:"map-layer"})],XA.prototype,"type",void 0),u([h({type:bs,json:{write:!0}})],XA.prototype,"mapLayerId",void 0),u([h({type:String,json:{write:!0}})],XA.prototype,"gdbVersion",void 0),XA=pee=u([I("esri.layers.support.source.MapLayerSource")],XA);var fee;let C_=fee=class extends fe{constructor(e){super(e),this.type="query-table"}clone(){var o;const{workspaceId:e,query:t,oidFields:r,spatialReference:i,geometryType:s}=this,n={workspaceId:e,query:t,oidFields:r,spatialReference:(o=i==null?void 0:i.clone())!=null?o:void 0,geometryType:s};return new fee(n)}};u([Ue({queryTable:"query-table"})],C_.prototype,"type",void 0),u([h({type:String,json:{write:!0}})],C_.prototype,"workspaceId",void 0),u([h({type:String,json:{write:!0}})],C_.prototype,"query",void 0),u([h({type:String,json:{write:!0}})],C_.prototype,"oidFields",void 0),u([h({type:Ve,json:{write:!0}})],C_.prototype,"spatialReference",void 0),u([Ue(oAe)],C_.prototype,"geometryType",void 0),C_=fee=u([I("esri.layers.support.source.QueryTableDataSource")],C_);var mee;let YA=mee=class extends fe{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new mee({workspaceId:e,dataSourceName:t})}};u([Ue({raster:"raster"})],YA.prototype,"type",void 0),u([h({type:String,json:{write:!0}})],YA.prototype,"dataSourceName",void 0),u([h({type:String,json:{write:!0}})],YA.prototype,"workspaceId",void 0),YA=mee=u([I("esri.layers.support.source.RasterDataSource")],YA);var gee;let xS=gee=class extends fe{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:r}=this;return new gee({workspaceId:e,gdbVersion:t,dataSourceName:r})}};u([Ue({table:"table"})],xS.prototype,"type",void 0),u([h({type:String,json:{write:!0}})],xS.prototype,"workspaceId",void 0),u([h({type:String,json:{write:!0}})],xS.prototype,"gdbVersion",void 0),u([h({type:String,json:{write:!0}})],xS.prototype,"dataSourceName",void 0),xS=gee=u([I("esri.layers.support.source.TableDataSource")],xS);var yee,_ee;const ntt=Br()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let rh=yee=class extends fe{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,r){return Qfe()(e,t,r)}castLeftTableSource(e){return ug(vee(),e)}readRightTableSource(e,t,r){return Qfe()(e,t,r)}castRightTableSource(e){return ug(vee(),e)}clone(){var o,a;const{leftTableKey:e,rightTableKey:t,leftTableSource:r,rightTableSource:i,joinType:s}=this,n={leftTableKey:e,rightTableKey:t,leftTableSource:(o=r==null?void 0:r.clone())!=null?o:void 0,rightTableSource:(a=i==null?void 0:i.clone())!=null?a:void 0,joinType:s};return new yee(n)}};u([Ue({joinTable:"join-table"})],rh.prototype,"type",void 0),u([h({type:String,json:{write:!0}})],rh.prototype,"leftTableKey",void 0),u([h({type:String,json:{write:!0}})],rh.prototype,"rightTableKey",void 0),u([h({json:{write:!0}})],rh.prototype,"leftTableSource",void 0),u([me("leftTableSource")],rh.prototype,"readLeftTableSource",null),u([Gt("leftTableSource")],rh.prototype,"castLeftTableSource",null),u([h({json:{write:!0}})],rh.prototype,"rightTableSource",void 0),u([me("rightTableSource")],rh.prototype,"readRightTableSource",null),u([Gt("rightTableSource")],rh.prototype,"castRightTableSource",null),u([Ue(ntt)],rh.prototype,"joinType",void 0),rh=yee=u([I("esri.layers.support.source.JoinTableDataSource")],rh);let Eq=null;function Qfe(){return Eq||(Eq=Wx({types:vee()})),Eq}let Cq=null;function vee(){return Cq||(Cq={key:"type",base:null,typeMap:{"data-layer":Rm,"map-layer":XA}}),Cq}const ott={key:"type",base:null,typeMap:{"join-table":rh,"query-table":C_,raster:YA,table:xS}};let Rm=_ee=class extends fe{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new _ee({fields:e,dataSource:t})}};u([Ue({dataLayer:"data-layer"})],Rm.prototype,"type",void 0),u([h({type:[Aj],json:{write:!0}})],Rm.prototype,"fields",void 0),u([h({types:ott,json:{write:!0}})],Rm.prototype,"dataSource",void 0),Rm=_ee=u([I("esri.layers.support.source.DataLayerSource")],Rm),Rm.from=ts(Rm);let TS=class extends ki(fe){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};u([h({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.onFields)&&this.onFields.length>0}}}}})],TS.prototype,"onFields",void 0),u([h({type:String,json:{write:!0}})],TS.prototype,"operator",void 0),u([h({type:String,json:{write:!0}})],TS.prototype,"searchTerm",void 0),u([h({type:String,json:{write:!0}})],TS.prototype,"searchType",void 0),TS=u([I("esri.rest.support.FullTextSearch")],TS);const WRe=TS;var bee;const eme=new gr({upperLeft:"upper-left",lowerLeft:"lower-left"});let SS=bee=class extends fe{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new bee(ne({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([h({type:Sr,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],SS.prototype,"extent",void 0),u([h({type:["view","edit"],json:{write:!0}})],SS.prototype,"mode",void 0),u([h({type:String,json:{read:eme.read,write:eme.write}})],SS.prototype,"originPosition",void 0),u([h({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],SS.prototype,"tolerance",void 0),SS=bee=u([I("esri.rest.support.QuantizationParameters")],SS);const att=SS;var wee;const tme=new gr({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let cm=wee=class extends fe{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=ne(e))}clone(){return new wee({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ne(this.statisticParameters)})}};u([h({type:Number,json:{write:!0}})],cm.prototype,"maxPointCount",void 0),u([h({type:Number,json:{write:!0}})],cm.prototype,"maxRecordCount",void 0),u([h({type:Number,json:{write:!0}})],cm.prototype,"maxVertexCount",void 0),u([h({type:String,json:{write:!0}})],cm.prototype,"onStatisticField",void 0),u([h({type:String,json:{write:!0}})],cm.prototype,"outStatisticFieldName",void 0),u([h({type:String,json:{read:{source:"statisticType",reader:tme.read},write:{target:"statisticType",writer:tme.write}}})],cm.prototype,"statisticType",void 0),u([h({type:Object})],cm.prototype,"statisticParameters",void 0),u([Le("statisticParameters")],cm.prototype,"writeStatisticParameters",null),cm=wee=u([I("esri.rest.support.StatisticDefinition")],cm);const XRe=cm;var $M;const ltt=new gr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),ctt=new gr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let qt=$M=class extends fe{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return rE($M,e)}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const r={};for(const i in e){const s=e[i];Array.isArray(s)?r[i]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?r[i]=s.getTime():r[i]=s}t.parameterValues=r}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new $M(ne({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:v(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};qt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([h({json:{write:!0}})],qt.prototype,"aggregateIds",void 0),u([h({type:Boolean,json:{write:!0}})],qt.prototype,"cacheHint",void 0),u([h({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"compactGeometryEnabled",void 0),u([h({json:{write:!0}})],qt.prototype,"datumTransformation",void 0),u([Gt("datumTransformation")],qt.prototype,"castDatumTransformation",null),u([h({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"defaultSpatialReferenceEnabled",void 0),u([h({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],qt.prototype,"distance",void 0),u([h({type:Rm,json:{write:!0}})],qt.prototype,"dynamicDataSource",void 0),u([h({type:String,json:{write:!0}})],qt.prototype,"formatOf3DObjects",void 0),u([h({type:[WRe],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.fullText)&&this.fullText.length>0}}}}})],qt.prototype,"fullText",void 0),u([h({type:String,json:{write:!0}})],qt.prototype,"gdbVersion",void 0),u([h({types:Yx,json:{read:ql,write:!0}})],qt.prototype,"geometry",void 0),u([h({type:Number,json:{write:!0}})],qt.prototype,"geometryPrecision",void 0),u([h({type:[String],json:{write:!0}})],qt.prototype,"groupByFieldsForStatistics",void 0),u([h({type:String,json:{write:!0}})],qt.prototype,"having",void 0),u([h({type:Date})],qt.prototype,"historicMoment",void 0),u([Le("historicMoment")],qt.prototype,"writeHistoricMoment",null),u([h({type:Number,json:{write:!0}})],qt.prototype,"maxAllowableOffset",void 0),u([h({type:Number,cast:e=>e<1?1:e>$M.MAX_MAX_RECORD_COUNT_FACTOR?$M.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],qt.prototype,"maxRecordCountFactor",void 0),u([h({type:["xyFootprint"],json:{write:!0}})],qt.prototype,"multipatchOption",void 0),u([h({type:Number,json:{read:{source:"resultRecordCount"}}})],qt.prototype,"num",void 0),u([h({json:{write:!0}})],qt.prototype,"objectIds",void 0),u([h({type:[String],json:{write:!0}})],qt.prototype,"orderByFields",void 0),u([h({type:[String],json:{write:!0}})],qt.prototype,"outFields",void 0),u([h({type:Ve,json:{name:"outSR",write:!0}})],qt.prototype,"outSpatialReference",void 0),u([h({type:[XRe],json:{write:{enabled:!0,overridePolicy(){return{enabled:v(this.outStatistics)&&this.outStatistics.length>0}}}}})],qt.prototype,"outStatistics",void 0),u([h({json:{write:!0}})],qt.prototype,"parameterValues",void 0),u([Le("parameterValues")],qt.prototype,"writeParameterValues",null),u([h({type:lt,json:{write:!0}})],qt.prototype,"pixelSize",void 0),u([h({type:att,json:{write:!0}})],qt.prototype,"quantizationParameters",void 0),u([h({type:[Object],json:{write:!0}})],qt.prototype,"rangeValues",void 0),u([h({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],qt.prototype,"relationParameter",void 0),u([h({type:String,json:{write:!0}})],qt.prototype,"resultType",void 0),u([h({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnCentroid",void 0),u([h({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnDistinctValues",void 0),u([h({type:Boolean,json:{default:!0,write:!0}})],qt.prototype,"returnExceededLimitFeatures",void 0),u([h({type:Boolean,json:{write:!0}})],qt.prototype,"returnGeometry",void 0),u([h({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnQueryGeometry",void 0),u([h({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnM",void 0),u([h({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],qt.prototype,"returnZ",void 0),u([h({type:Ve,json:{write:!0}})],qt.prototype,"sourceSpatialReference",void 0),u([Ue(ltt,{ignoreUnknown:!1,name:"spatialRel"})],qt.prototype,"spatialRelationship",void 0),u([h({type:Number,json:{read:{source:"resultOffset"}}})],qt.prototype,"start",void 0),u([Le("start"),Le("num")],qt.prototype,"writeStart",null),u([h({type:String,json:{write:!0}})],qt.prototype,"sqlFormat",void 0),u([h({type:String,json:{write:!0}})],qt.prototype,"text",void 0),u([h({type:bg,json:{write:!0}})],qt.prototype,"timeExtent",void 0),u([h({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"timeReferenceUnknownClient",void 0),u([Ue(ctt,{ignoreUnknown:!1}),h({json:{write:{overridePolicy(e){return{enabled:!!e&&this.distance!=null&&this.distance>0}}}}})],qt.prototype,"units",void 0),u([h({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start!=null&&this.start>0}}}}})],qt.prototype,"where",void 0),u([Le("where")],qt.prototype,"writeWhere",null),qt=$M=u([I("esri.rest.support.Query")],qt);const pf=qt;var xee;const Aq=new gr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Oq=new gr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let dy=xee=class extends fe{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new pf({geometry:ne(r),objectIds:ne(n),spatialRelationship:i,timeExtent:ne(s),where:t,units:o,distance:a,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,timeExtent:i,objectIds:s,units:n,distance:o}=this;return new xee({geometry:ne(t),objectIds:ne(s),spatialRelationship:r,timeExtent:ne(i),where:e,units:n,distance:o})}};u([h({type:String,json:{write:!0}})],dy.prototype,"where",void 0),u([h({types:Yx,json:{write:!0}})],dy.prototype,"geometry",void 0),u([h({type:Aq.apiValues,json:{name:"spatialRel",read:{reader:Aq.read},write:{allowNull:!1,writer:Aq.write,overridePolicy(){return{enabled:v(this.geometry)}}}}})],dy.prototype,"spatialRelationship",void 0),u([h({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],dy.prototype,"distance",void 0),u([h({type:[Number],json:{write:!0}})],dy.prototype,"objectIds",void 0),u([h({type:Oq.apiValues,json:{read:Oq.read,write:{writer:Oq.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],dy.prototype,"units",void 0),u([h({type:bg,json:{write:!0}})],dy.prototype,"timeExtent",void 0),dy=xee=u([I("esri.layers.support.FeatureFilter")],dy);const utt=dy;var Tee;const rme={read:{reader:Joe},write:{writer:Koe,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},ime={read:{reader:Joe},write:{writer:Koe,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},sme={name:"showExcludedLabels",default:!0};let ES=Tee=class extends fe{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){var i,s;const r=super.write(e,t);if(t!=null&&t.origin){if(r.filter){const n=Object.keys(r.filter);if(n.length>1||n[0]!=="where")return(i=t.messages)==null||i.push(new z("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in r)return(s=t.messages)==null||s.push(new z("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return r}clone(){return new Tee({filter:v(this.filter)?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([h({type:utt,json:{write:{allowNull:!0,writer(e,t,r,i){const s=e==null?void 0:e.write({},i);s&&Object.keys(s).length!==0?Vl(r,s,t):Vl(r,null,t)}}}})],ES.prototype,"filter",void 0),u([h({json:{write:!0,origins:{"web-map":rme,"portal-item":rme}}})],ES.prototype,"includedEffect",void 0),u([h({json:{write:!0,origins:{"web-map":ime,"portal-item":ime}}})],ES.prototype,"excludedEffect",void 0),u([h({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":sme,"portal-item":sme}}})],ES.prototype,"excludedLabelsVisible",void 0),ES=Tee=u([I("esri.layers.support.FeatureEffect")],ES);const dtt=ES,nme={write:{allowNull:!0}},htt=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return u([h({type:dtt,json:{origins:{"web-map":nme,"portal-item":nme}}})],t.prototype,"featureEffect",void 0),t=u([I("esri.layers.mixins.FeatureEffectLayer")],t),t};let Iy=class extends ki(fe){constructor(e){super(e)}};u([h({constructOnly:!0,json:{write:!0}})],Iy.prototype,"name",void 0),u([h({constructOnly:!0,json:{write:!0}})],Iy.prototype,"fields",void 0),u([h({constructOnly:!0,json:{write:!0}})],Iy.prototype,"isAscending",void 0),u([h({constructOnly:!0,json:{write:!0}})],Iy.prototype,"indexType",void 0),u([h({constructOnly:!0,json:{write:!0}})],Iy.prototype,"isUnique",void 0),u([h({constructOnly:!0,json:{write:!0}})],Iy.prototype,"description",void 0),Iy=u([I("esri.layers.support.FeatureIndex")],Iy);var See;let el=See=class extends fe{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new See(ne({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([h({type:[String],json:{write:!0}})],el.prototype,"attachmentTypes",void 0),u([h({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],el.prototype,"attachmentsWhere",void 0),u([h({type:Boolean,json:{write:!0}})],el.prototype,"cacheHint",void 0),u([h({type:[String],json:{write:!0}})],el.prototype,"keywords",void 0),u([h({type:[Number],json:{write:!0}})],el.prototype,"globalIds",void 0),u([h({json:{write:!0}})],el.prototype,"name",void 0),u([h({type:Number,json:{read:{source:"resultRecordCount"}}})],el.prototype,"num",void 0),u([h({type:[Number],json:{write:!0}})],el.prototype,"objectIds",void 0),u([h({type:Boolean,json:{default:!1,write:!0}})],el.prototype,"returnMetadata",void 0),u([h({type:[Number],json:{write:!0}})],el.prototype,"size",void 0),u([h({type:Number,json:{read:{source:"resultOffset"}}})],el.prototype,"start",void 0),u([Le("start"),Le("num")],el.prototype,"writeStart",null),u([h({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],el.prototype,"where",void 0),el=See=u([I("esri.rest.support.AttachmentQuery")],el),el.from=ts(el);const Eee=el;var Cee;let Nn=Cee=class extends fe{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new Cee(ne({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([h({type:Boolean,json:{write:!0}})],Nn.prototype,"cacheHint",void 0),u([h({type:Rm,json:{write:!0}})],Nn.prototype,"dynamicDataSource",void 0),u([h({type:String,json:{write:!0}})],Nn.prototype,"gdbVersion",void 0),u([h({type:Number,json:{write:!0}})],Nn.prototype,"geometryPrecision",void 0),u([h({type:Date})],Nn.prototype,"historicMoment",void 0),u([Le("historicMoment")],Nn.prototype,"_writeHistoricMoment",null),u([h({type:Number,json:{write:!0}})],Nn.prototype,"maxAllowableOffset",void 0),u([h({type:[Number],json:{write:!0}})],Nn.prototype,"objectIds",void 0),u([h({type:[String],json:{write:!0}})],Nn.prototype,"orderByFields",void 0),u([h({type:[String],json:{write:!0}})],Nn.prototype,"outFields",void 0),u([h({type:Ve,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Nn.prototype,"outSpatialReference",void 0),u([h({json:{write:!0}})],Nn.prototype,"relationshipId",void 0),u([h({type:Number,json:{read:{source:"resultOffset"}}})],Nn.prototype,"start",void 0),u([Le("start"),Le("num")],Nn.prototype,"writeStart",null),u([h({type:Number,json:{read:{source:"resultRecordCount"}}})],Nn.prototype,"num",void 0),u([h({json:{write:!0}})],Nn.prototype,"returnGeometry",void 0),u([h({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Nn.prototype,"returnM",void 0),u([h({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Nn.prototype,"returnZ",void 0),u([h({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Nn.prototype,"where",void 0),Nn=Cee=u([I("esri.rest.support.RelationshipQuery")],Nn),Nn.from=ts(Nn);const gN=Nn,Aee=new gr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),ptt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function or(e,t,r){return!!(e&&e.hasOwnProperty(t)?e[t]:r)}function N5(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}function ftt(e){var r;const t=(r=e==null?void 0:e.supportedSpatialAggregationStatistics)==null?void 0:r.map(i=>i.toLowerCase());return{envelope:!!(t!=null&&t.includes("envelopeaggregate")),centroid:!!(t!=null&&t.includes("centroidaggregate")),convexHull:!!(t!=null&&t.includes("convexhullaggregate"))}}function QF(e,t){var i;const r=(i=e==null?void 0:e.supportedOperationsWithCacheHint)==null?void 0:i.map(s=>s.toLowerCase());return!!(r!=null&&r.includes(t.toLowerCase()))}function YRe(e,t,r){return{analytics:mtt(t),attachment:gtt(t),data:ytt(t),metadata:_tt(t),operations:vtt(t.capabilities||e,t,r),query:btt(t,r),queryRelated:wtt(t),queryTopFeatures:xtt(t),editing:Ttt(t)}}function mtt(e){return{supportsCacheHint:QF(e.advancedQueryCapabilities,"queryAnalytics")}}function gtt(e){const t=e.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:QF(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:or(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(i=>{const s=ptt[i.name];s&&(r[s]=!!i.isEnabled)}),r}function ytt(e){return{isVersioned:or(e,"isDataVersioned",!1),supportsAttachment:or(e,"hasAttachments",!1),supportsM:or(e,"hasM",!1),supportsZ:or(e,"hasZ",!1)}}function _tt(e){return{supportsAdvancedFieldProperties:or(e,"supportsFieldDescriptionProperty",!1)}}function vtt(e,t,r){const i=e?e.toLowerCase().split(",").map(f=>f.trim()):[],s=r?aC(r):null,n=i.includes(v(s)&&s.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!t.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const d=i.includes("changetracking"),p=t.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:or(t,"supportsCalculate",!1),supportsTruncate:or(t,"supportsTruncate",!1),supportsValidateSql:or(t,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:d,supportsQuery:n,supportsQueryAnalytics:or(p,"supportsQueryAnalytic",!1),supportsQueryAttachments:or(p,"supportsQueryAttachments",!1),supportsQueryTopFeatures:or(p,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:or(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:or(t,"supportsExceedsLimitStatistics",!1)}}function btt(e,t){const r=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,s=e.archivingInfo,n=KRe(e),o=t==null?void 0:t.includes("MapServer"),a=!pe("mapserver-pbf-enabled")&&o&&(n!=null?n:0)<10.81,l=tRe(t),c=(e.supportedQueryFormats||"").split(",").reduce((d,p)=>{const f=p.toLowerCase().trim();return f&&d.add(f),d},new Set);return{supportsStatistics:or(r,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:or(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:or(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:ftt(r),supportsCentroid:or(r,"supportsReturningGeometryCentroid",!1),supportsDistance:or(r,"supportsQueryWithDistance",!1),supportsDistinct:or(r,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:or(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:or(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:or(r,"supportsHavingClause",!1),supportsOrderBy:or(r,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:or(r,"supportsPagination",!1),supportsQuantization:or(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:or(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:or(e,"supportsReturningQueryGeometry",!1),supportsResultType:or(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:or(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:or(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:or(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:or(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:or(i,"allowOthersToQuery",!0),supportsHistoricMoment:or(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!a&&c.has("pbf"),supportsDisjointSpatialRelationship:or(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:or(r,"supportsQueryWithCacheHint",!1)||QF(r,"query"),supportsDefaultSpatialReference:or(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:or(r,"supportsFullTextSearch",!1),maxRecordCountFactor:N5(e,"maxRecordCountFactor",void 0),maxRecordCount:N5(e,"maxRecordCount",void 0),standardMaxRecordCount:N5(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:N5(e,"tileMaxRecordCount",void 0)}}function wtt(e){const t=e.advancedQueryCapabilities,r=or(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:or(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:QF(t,"queryRelated")}}function xtt(e){return{supportsCacheHint:QF(e.advancedQueryCapabilities,"queryTopFilter")}}function Ttt(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:or(e,"allowGeometryUpdates",!0),supportsGlobalId:or(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:or(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:or(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:or(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:or(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:or(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:or(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:or(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:or(t,"allowOthersToUpdate",!0)}}async function Stt(e,t,r,i){const{source:s}=await e.load();if(await eae(e,t,i),!s.addAttachment)throw new z(i,"Layer source does not support addAttachment capability");return s.addAttachment(t,r)}function eae(e,t,r){const{attributes:i}=t,{objectIdField:s}=e;return e.get("capabilities.data.supportsAttachment")?t?i?s&&i[s]?Promise.resolve():Promise.reject(new z(r,`feature is missing the identifying attribute ${s}`)):Promise.reject(new z(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new z(r,"A feature is required to add/delete/update attachments")):Promise.reject(new z(r,"this layer doesn't support attachments"))}async function Ett(e,t,r,i,s){const{source:n}=await e.load();if(await eae(e,t,s),!n.updateAttachment)throw new z(s,"Layer source does not support updateAttachment capability");return n.updateAttachment(t,r,i)}async function Ctt(e,t,r){const i=await re(()=>import("./editingSupport.16203741.js"),[]),s=await e.load();return i.applyEdits(s,s.source,t,r)}async function Att(e,t,r,i){const{source:s}=await e.load();if(await eae(e,t,i),!s.deleteAttachments)throw new z(i,"Layer source does not support deleteAttachments capability");return s.deleteAttachments(t,r)}async function Ott(e,t,r){const{source:i}=await e.load({signal:t==null?void 0:t.signal});if(!i.fetchRecomputedExtents)throw new z(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(t)}async function Mtt(e,t,r,i){var m,g;t=Eee.from(t);const{source:s,capabilities:n}=await e.load();if(!((m=n==null?void 0:n.data)!=null&&m.supportsAttachment))throw new z(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:d,start:p,where:f}=t;if(!((g=n==null?void 0:n.operations)!=null&&g.supportsQueryAttachments)){const _=a&&a.length>1,x=o&&o.length,b=l&&l.length,w=d&&d.length;if(_||x||b||w||c||p||f)throw new z(i,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",t)}if(!(a!=null&&a.length)&&!f)throw new z(i,"'objectIds' or 'where' are required to perform attachment query",t);if(!s.queryAttachments)throw new z(i,"Layer source does not support queryAttachments capability",t);return s.queryAttachments(t)}async function Rtt(e,t,r,i){var n;const{source:s}=await e.load();if(!s.queryObjectIds)throw new z(i,"Layer source does not support queryObjectIds capability");return s.queryObjectIds((n=pf.from(t))!=null?n:e.createQuery(),r)}async function Itt(e,t,r,i){var n;const{source:s}=await e.load();if(!s.queryFeatureCount)throw new z(i,"Layer source does not support queryFeatureCount capability");return s.queryFeatureCount((n=pf.from(t))!=null?n:e.createQuery(),r)}async function Ptt(e,t,r,i){var n;const{source:s}=await e.load();if(!s.queryExtent)throw new z(i,"Layer source does not support queryExtent capability");return s.queryExtent((n=pf.from(t))!=null?n:e.createQuery(),r)}async function $tt(e,t,r,i){const{source:s}=await e.load();if(!s.queryRelatedFeatures)throw new z(i,"Layer source does not support queryRelatedFeatures capability");return s.queryRelatedFeatures(gN.from(t),r)}async function Dtt(e,t,r,i){const{source:s}=await e.load();if(!s.queryRelatedFeaturesCount)throw new z(i,"Layer source does not support queryRelatedFeaturesCount capability");return s.queryRelatedFeaturesCount(gN.from(t),r)}async function Ltt(e){const t=e.source;if(t!=null&&t.refresh)try{const{dataChanged:r,updates:i}=await t.refresh();if(v(i)&&(e.sourceJSON={...e.sourceJSON,...i},e.read(i,{origin:"service",url:e.parsedUrl})),r)return!0}catch{}if(e.definitionExpression)try{return(await cQe(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function Ntt(e){const t=new pf,r=e.get("capabilities.data"),i=e.get("capabilities.query");t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,i&&(t.compactGeometryEnabled=i.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&e.returnZ!=null&&(t.returnZ=e.returnZ),r.supportsM&&e.returnM!=null&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:s,timeExtent:n}=e;return t.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,t.multipatchOption=e.geometryType==="multipatch"?"xyFootprint":null,t}function ZRe(e){const{globalIdField:t,fields:r}=e;if(t)return t;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function JRe(e){const{objectIdField:t,fields:r}=e;if(t)return t;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function KRe(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}let ZA=class extends ki(fe){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([h({type:String,json:{read:{source:"shapeAreaFieldName"}}})],ZA.prototype,"shapeAreaField",void 0),u([h({type:String,json:{read:{source:"shapeLengthFieldName"}}})],ZA.prototype,"shapeLengthField",void 0),u([h({type:String,json:{read:e=>DJe.read(e)||LJe.read(e)}})],ZA.prototype,"units",void 0),ZA=u([I("esri.layers.support.GeometryFieldsInfo")],ZA);const Ftt=ZA;var Oee;let JA=Oee=class extends fe{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new Ge}clone(){return new Oee({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([h({type:String,json:{write:!0}})],JA.prototype,"floorField",void 0),u([h({json:{read:!1,write:!1}})],JA.prototype,"viewAllMode",void 0),u([h({json:{read:!1,write:!1}})],JA.prototype,"viewAllLevelIds",void 0),JA=Oee=u([I("esri.layers.support.LayerFloorInfo")],JA);const QRe=JA,ome=new gr({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),ame=new gr({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Op=class extends ki(fe){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([h({json:{read:ome.read,write:ome.write}})],Op.prototype,"cardinality",void 0),u([h({json:{read:!0,write:!0}})],Op.prototype,"composite",void 0),u([h({json:{read:!0,write:!0}})],Op.prototype,"id",void 0),u([h({json:{read:!0,write:!0}})],Op.prototype,"keyField",void 0),u([h({json:{read:!0,write:!0}})],Op.prototype,"keyFieldInRelationshipTable",void 0),u([h({json:{read:!0,write:!0}})],Op.prototype,"name",void 0),u([h({json:{read:!0,write:!0}})],Op.prototype,"relatedTableId",void 0),u([h({json:{read:!0,write:!0}})],Op.prototype,"relationshipTableId",void 0),u([h({json:{read:ame.read,write:ame.write}})],Op.prototype,"role",void 0),Op=u([I("esri.layers.support.Relationship")],Op);const ktt=Op,Utt=e=>{let t=class extends e{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.spatialReference=Ve.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(Ge.ofType(Iy)),this.userIsAdmin=!1,this.version=void 0}readCapabilitiesFromService(r,i){return YRe(r,i,this.url)}readEditingInfo(r,i){const{editingInfo:s}=i;return s?{lastEditDate:s.lastEditDate!=null?new Date(s.lastEditDate):null}:null}readIsTableFromService(r,i){return i.type==="Table"}readMinScale(r,i){return i.effectiveMinScale||r||0}readMaxScale(r,i){return i.effectiveMaxScale||r||0}readGlobalIdFieldFromService(r,i){return ZRe(i)}readObjectIdFieldFromService(r,i){return JRe(i)}readServiceDefinitionExpression(r,i){return i.definitionQuery||i.definitionExpression}set url(r){const i=iRe({layer:this,url:r,nonStandardUrlAllowed:!0,logger:te.getLogger(this.declaredClass)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,s,n){sRe(this,r,null,i,n)}readVersion(r,i){return KRe(i)}};return u([h({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],t.prototype,"capabilities",void 0),u([me("service","capabilities")],t.prototype,"readCapabilitiesFromService",null),u([h({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),u([h({type:Boolean})],t.prototype,"datesInUnknownTimezone",void 0),u([h({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],t.prototype,"displayField",void 0),u([h({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],t.prototype,"definitionExpression",void 0),u([h({readOnly:!0})],t.prototype,"editFieldsInfo",void 0),u([h({readOnly:!0})],t.prototype,"editingInfo",void 0),u([me("editingInfo")],t.prototype,"readEditingInfo",null),u([h((()=>{const r=ne(pRe),i=r.json.origins;return i["web-map"]={read:!1,write:!1},i["portal-item"]={read:!1,write:!1},r})())],t.prototype,"elevationInfo",void 0),u([h({type:QRe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],t.prototype,"floorInfo",void 0),u([h({type:Sr,json:{origins:{service:{read:{source:"extent"}}}}})],t.prototype,"fullExtent",void 0),u([h()],t.prototype,"gdbVersion",void 0),u([h({readOnly:!0,type:Ftt,json:{read:{source:"geometryProperties"}}})],t.prototype,"geometryFieldsInfo",void 0),u([h({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Aee.read}}}})],t.prototype,"geometryType",void 0),u([h({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasM",void 0),u([h({type:Boolean,json:{origins:{service:{read:!0}}}})],t.prototype,"hasZ",void 0),u([h({readOnly:!0,type:lC})],t.prototype,"heightModelInfo",void 0),u([h({type:Date})],t.prototype,"historicMoment",void 0),u([h({readOnly:!0})],t.prototype,"isTable",void 0),u([me("service","isTable",["type"])],t.prototype,"readIsTableFromService",null),u([h({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],t.prototype,"layerId",void 0),u([h(XKe)],t.prototype,"minScale",void 0),u([me("service","minScale",["minScale","effectiveMinScale"])],t.prototype,"readMinScale",null),u([h(YKe)],t.prototype,"maxScale",void 0),u([me("service","maxScale",["maxScale","effectiveMaxScale"])],t.prototype,"readMaxScale",null),u([h({type:String})],t.prototype,"globalIdField",void 0),u([me("service","globalIdField",["globalIdField","fields"])],t.prototype,"readGlobalIdFieldFromService",null),u([h({type:String})],t.prototype,"objectIdField",void 0),u([me("service","objectIdField",["objectIdField","fields"])],t.prototype,"readObjectIdFieldFromService",null),u([h({type:[ktt],readOnly:!0})],t.prototype,"relationships",void 0),u([h()],t.prototype,"sourceJSON",void 0),u([h({type:Boolean})],t.prototype,"returnM",void 0),u([h({type:Boolean})],t.prototype,"returnZ",void 0),u([h({readOnly:!0})],t.prototype,"serviceDefinitionExpression",void 0),u([me("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],t.prototype,"readServiceDefinitionExpression",null),u([h({type:Ve,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],t.prototype,"spatialReference",void 0),u([h({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],t.prototype,"subtypeField",void 0),u([h({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],t.prototype,"trackIdField",void 0),u([h({readOnly:!0,json:{write:!1}})],t.prototype,"serverGens",void 0),u([h({type:Ge.ofType(Iy),readOnly:!0})],t.prototype,"indexes",void 0),u([h(dRe)],t.prototype,"url",null),u([Le("url")],t.prototype,"writeUrl",null),u([h({readOnly:!0})],t.prototype,"userIsAdmin",void 0),u([h({json:{origins:{service:{read:!0}},read:!1}})],t.prototype,"version",void 0),u([me("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],t.prototype,"readVersion",null),t=u([I("esri.layers.mixins.FeatureLayerBase")],t),t};let KA=class extends ki(fe){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};u([h({type:String,json:{write:!0}})],KA.prototype,"expression",void 0),u([h({type:String,json:{write:!0}})],KA.prototype,"title",void 0),u([h({type:String,json:{write:!0}})],KA.prototype,"returnType",void 0),KA=u([I("esri.layers.support.ExpressionInfo")],KA);const tae=KA;var Mee;let A_=Mee=class extends fe{constructor(e){super(e),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new Mee({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:ne(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};u([h({type:Boolean,json:{write:!0}})],A_.prototype,"isAutoGenerated",void 0),u([h({type:String,json:{write:!0}})],A_.prototype,"name",void 0),u([h({type:String,json:{write:!0}})],A_.prototype,"alias",void 0),u([h({type:String,json:{write:!0}})],A_.prototype,"onStatisticField",void 0),u([h({type:tae,json:{write:!0}})],A_.prototype,"onStatisticExpression",void 0),u([h({type:String,json:{write:!0}})],A_.prototype,"statisticType",void 0),A_=Mee=u([I("esri.layers.support.AggregateField")],A_);const vE=A_,rae="__begin__",iae="__end__",Btt=new RegExp(rae,"ig"),ztt=new RegExp(iae,"ig"),lme=new RegExp("^"+rae,"i"),cme=new RegExp(iae+"$","i"),Vz='"',Vtt=Vz+" + ",jtt=" + "+Vz;function Gtt(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function Htt(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function kj(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=Gtt(e.labelExpression),t.type="conventional"),t}function qtt(e){const t=kj(e);if(!t)return null;switch(t.type){case"conventional":return Ree(t.expression);case"arcade":return t.expression}return null}function Wtt(e){const t=kj(e);if(!t)return null;switch(t.type){case"conventional":return Ytt(t.expression);case"arcade":return sae(t.expression)}return null}function Ree(e){let t;return e?(t=g0(e,r=>rae+'$feature["'+r+'"]'+iae),t=lme.test(t)?t.replace(lme,""):Vz+t,t=cme.test(t)?t.replace(cme,""):t+Vz,t=t.replace(Btt,Vtt).replace(ztt,jtt)):t='""',t}const Xtt=/^\s*\{([^}]+)\}\s*$/i;function Ytt(e){const t=e.match(Xtt);return t&&t[1].trim()||null}const Ztt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,Jtt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Ktt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function sae(e){if(!e)return null;let t=Ztt.exec(e)||Jtt.exec(e);return t?t[1]||t[3]:(t=Ktt.exec(e),t?t[2]:null)}var Iee;let Rb=Iee=class extends fe{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?Ree(t.value):e}writeExpression(e,t,r){this.value!=null&&(e=Ree(this.value)),e!=null&&(t[r]=e)}clone(){return new Iee({expression:this.expression,title:this.title,value:this.value})}};u([h({type:String,json:{write:{writerEnsuresNonNull:!0}}})],Rb.prototype,"expression",void 0),u([me("expression",["expression","value"])],Rb.prototype,"readExpression",null),u([Le("expression")],Rb.prototype,"writeExpression",null),u([h({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Rb.prototype,"title",void 0),u([h({json:{read:!1,write:!1}})],Rb.prototype,"value",void 0),Rb=Iee=u([I("esri.layers.support.LabelExpressionInfo")],Rb);const eIe=Rb,tIe=[252,146,31,255],O6t=[153,153,153,255],Qtt={type:"esriSMS",style:"esriSMSCircle",size:6,color:tIe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},ert={type:"esriSLS",style:"esriSLSSolid",width:.75,color:tIe},trt={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},rrt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},irt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},srt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},nrt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},M6t=ko.fromJSON(Qtt),R6t=Ul.fromJSON(ert),I6t=L0.fromJSON(trt),ort=nC.fromJSON(rrt);ko.fromJSON(irt);Ul.fromJSON(srt);L0.fromJSON(nrt);var Pee;const F5=new gr({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function rIe(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function art(e){return(e==null?void 0:e.type)==="map-image"}function iIe(e){var t,r;return!!art(e)&&!!((r=(t=e.capabilities)==null?void 0:t.exportMap)!=null&&r.supportsArcadeExpressionForLabeling)}function lrt(e){return rIe(e)||iIe(e.layer)}let fo=Pee=class extends fe{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=ort,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const r=(i,s,n)=>{switch(s){case"=":return i==n;case"<>":return i!=n;case">":return i>n;case">=":return i>=n;case"<":return i<n;case"<=":return i<=n}return!1};try{if(e==null)return!0;const i=e.split(" ");if(i.length===3)return r(t[i[0]],i[1],i[2]);if(i.length===7){const s=r(t[i[0]],i[1],i[2]),n=i[3],o=r(t[i[4]],i[5],i[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e}writeLabelExpression(e,t,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=Htt(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=sae(this.labelExpressionInfo.expression);i&&(e="["+i+"]")}}e!=null&&(t[r]=e)}writeLabelExpressionInfo(e,t,r,i){if(e==null&&this.labelExpression!=null&&rIe(i))e=new eIe({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(i);s.expression&&(t[r]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return kj(this)}getLabelExpressionArcade(){return qtt(this)}getLabelExpressionSingleField(){return Wtt(this)}hash(){return JSON.stringify(this)}clone(){return new Pee({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ne(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ne(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([h({type:String,json:{write:!0}})],fo.prototype,"name",void 0),u([h({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],fo.prototype,"allowOverrun",void 0),u([h({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],fo.prototype,"deconflictionStrategy",void 0),u([h({type:String,json:{write:{overridePolicy(e,t,r){return this.labelExpressionInfo&&(r==null?void 0:r.origin)==="service"&&iIe(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],fo.prototype,"labelExpression",void 0),u([me("labelExpression")],fo.prototype,"readLabelExpression",null),u([Le("labelExpression")],fo.prototype,"writeLabelExpression",null),u([h({type:eIe,json:{write:{overridePolicy:(e,t,r)=>lrt(r)?{allowNull:!0}:{enabled:!1}}}})],fo.prototype,"labelExpressionInfo",void 0),u([Le("labelExpressionInfo")],fo.prototype,"writeLabelExpressionInfo",null),u([h({type:F5.apiValues,json:{type:F5.jsonValues,read:F5.read,write:F5.write}})],fo.prototype,"labelPlacement",void 0),u([h({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],fo.prototype,"labelPosition",void 0),u([h({type:Number})],fo.prototype,"maxScale",void 0),u([Le("maxScale")],fo.prototype,"writeMaxScale",null),u([h({type:Number})],fo.prototype,"minScale",void 0),u([Le("minScale")],fo.prototype,"writeMinScale",null),u([h({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],fo.prototype,"repeatLabel",void 0),u([h({type:Number,cast:Fi,json:{write:!0,origins:{"web-scene":{write:!1}}}})],fo.prototype,"repeatLabelDistance",void 0),u([h({types:iJe,json:{origins:{"web-scene":{types:sJe,write:ffe,default:null}},write:ffe,default:null}})],fo.prototype,"symbol",void 0),u([h({type:Boolean,json:{write:!0}})],fo.prototype,"useCodedValues",void 0),u([h({type:String,json:{write:!0}})],fo.prototype,"where",void 0),fo=Pee=u([I("esri.layers.support.LabelClass")],fo);const e4=fo;var $ee;const Mq=Wx({types:gj}),crt="esri.layers.support.FeatureReductionBinning";let Zu=$ee=class extends Ev{constructor(e){super(e),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(e,t,r){const i=e.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Vl(r,i,t)}readRenderer(e,t,r){var s,n;const i=(s=t.drawingInfo)==null?void 0:s.renderer;return i?(n=hN(i,t,r))!=null?n:void 0:t.defaultSymbol?t.types&&t.types.length?new ZF({defaultSymbol:Mq(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map(o=>({id:o.id,symbol:Mq(o.symbol,o,r)}))}):new RR({symbol:Mq(t.defaultSymbol,t,r)}):null}clone(){return new $ee({fields:ne(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:ne(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:ne(this.popupTemplate),renderer:ne(this.renderer)})}};u([Ue({binning:"binning"})],Zu.prototype,"type",void 0),u([Ue({geohash:"geohash"})],Zu.prototype,"binType",void 0),u([h({type:Number,range:{min:1,max:9},json:{write:!0}})],Zu.prototype,"fixedBinLevel",void 0),u([h({type:[e4],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Zu.prototype,"labelingInfo",void 0),u([h(Sj)],Zu.prototype,"labelsVisible",void 0),u([h(Tj)],Zu.prototype,"popupEnabled",void 0),u([h({type:Nc,json:{name:"popupInfo",write:!0}})],Zu.prototype,"popupTemplate",void 0),u([h({type:[vE],json:{write:!0}})],Zu.prototype,"fields",void 0),u([Le("fields")],Zu.prototype,"writeFields",null),u([h({types:bj,json:{write:{target:"drawingInfo.renderer"}}})],Zu.prototype,"renderer",void 0),u([me("renderer",["drawingInfo.renderer"])],Zu.prototype,"readRenderer",null),Zu=$ee=u([I(crt)],Zu);const sIe=Zu;var Dee;const Rq=Wx({types:gj}),urt="esri.layers.support.FeatureReductionCluster";function ume(e){var t;return e.type==="simple"&&!((t=e.visualVariables)!=null&&t.length)}let Ea=Dee=class extends fe{constructor(e){super(e),this.type="cluster",this.clusterRadius=Fi("80px"),this.clusterMinSize=Fi("12px"),this.clusterMaxSize=Fi("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(e,t,r){var s,n,o;const i=(s=t.drawingInfo)==null?void 0:s.renderer;return(n=i==null?void 0:i.authoringInfo)!=null&&n.isAutoGenerated?null:i?ume(i)?null:(o=hN(i,t,r))!=null?o:void 0:t.defaultSymbol?t.types&&t.types.length?new ZF({defaultSymbol:Rq(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map(a=>({id:a.id,symbol:Rq(a.symbol,a,r)}))}):new RR({symbol:Rq(t.defaultSymbol,t,r)}):null}readSymbol(e,t,r){var s,n,o;const i=(s=t.drawingInfo)==null?void 0:s.renderer;return(n=i==null?void 0:i.authoringInfo)!=null&&n.isAutoGenerated?null:i&&ume(i)?(o=hN(i,t,r))==null?void 0:o.symbol:null}writeSymbol(e,t,r,i){var n,o;const s=(o=(n=this.renderer)==null?void 0:n.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||s){const a=new RR({symbol:e});t.drawingInfo={renderer:a.write({},i)}}}writeFields(e,t,r){const i=e.filter(s=>s.statisticType!=="avg_angle").map(s=>s.toJSON());Vl(r,i,t)}readFields(e,t,r){return e.filter(i=>!i.isAutoGenerated).map(i=>vE.fromJSON(i))}clone(){return new Dee({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:ne(this.labelingInfo),labelsVisible:this.labelsVisible,fields:ne(this.fields),renderer:ne(this.renderer),symbol:ne(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:ne(this.popupTemplate)})}};u([h({type:["cluster"],readOnly:!0,json:{write:!0}})],Ea.prototype,"type",void 0),u([h({type:Number,cast:e=>e==="auto"?e:Fi(e),json:{write:!0}})],Ea.prototype,"clusterRadius",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],Ea.prototype,"clusterMinSize",void 0),u([h({type:Number,cast:Fi,json:{write:!0}})],Ea.prototype,"clusterMaxSize",void 0),u([h(Tj)],Ea.prototype,"popupEnabled",void 0),u([h({type:Nc,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ea.prototype,"popupTemplate",void 0),u([h({types:bj,json:{write:{target:"drawingInfo.renderer"}}})],Ea.prototype,"renderer",void 0),u([me("renderer",["drawingInfo.renderer"])],Ea.prototype,"readRenderer",null),u([h({types:tJe})],Ea.prototype,"symbol",void 0),u([me("symbol",["drawingInfo.renderer"])],Ea.prototype,"readSymbol",null),u([Le("symbol")],Ea.prototype,"writeSymbol",null),u([h({type:[e4],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ea.prototype,"labelingInfo",void 0),u([h(Sj)],Ea.prototype,"labelsVisible",void 0),u([h({type:[vE],json:{write:!0}})],Ea.prototype,"fields",void 0),u([Le("fields")],Ea.prototype,"writeFields",null),u([me("fields")],Ea.prototype,"readFields",null),Ea=Dee=u([I(urt)],Ea);const nIe=Ea,dme={key:"type",base:Ev,typeMap:{cluster:nIe,binning:sIe}},drt={types:{key:"type",base:Ev,typeMap:{selection:VQ,cluster:nIe,binning:sIe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:dme},"portal-item":{types:dme},"web-scene":{types:{key:"type",base:Ev,typeMap:{selection:VQ}}}}}},bC={Base64:0,Hex:1,String:2,Raw:3},DM=8,oIe=(1<<DM)-1;function Fw(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function hrt(e){const t=[];for(let r=0,i=e.length*DM;r<i;r+=DM)t[r>>5]|=(e.charCodeAt(r/DM)&oIe)<<r%32;return t}function prt(e){const t=[];for(let r=0,i=32*e.length;r<i;r+=DM)t.push(String.fromCharCode(e[r>>5]>>>r%32&oIe));return t.join("")}function frt(e){const t="0123456789abcdef",r=[];for(let i=0,s=4*e.length;i<s;i++)r.push(t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15));return r.join("")}function mrt(e){const t="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let s=0,n=4*e.length;s<n;s+=3){const o=(e[s>>2]>>s%4*8&255)<<16|(e[s+1>>2]>>(s+1)%4*8&255)<<8|e[s+2>>2]>>(s+2)%4*8&255;for(let a=0;a<4;a++)8*s+6*a>32*e.length?i.push(t):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function grt(e,t){return e<<t|e>>>32-t}function Uj(e,t,r,i,s,n){return Fw(grt(Fw(Fw(t,e),Fw(i,n)),s),r)}function rc(e,t,r,i,s,n,o){return Uj(t&r|~t&i,e,t,s,n,o)}function ic(e,t,r,i,s,n,o){return Uj(t&i|r&~i,e,t,s,n,o)}function sc(e,t,r,i,s,n,o){return Uj(t^r^i,e,t,s,n,o)}function nc(e,t,r,i,s,n,o){return Uj(r^(t|~i),e,t,s,n,o)}function yrt(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let r=1732584193,i=-271733879,s=-1732584194,n=271733878;for(let o=0;o<e.length;o+=16){const a=r,l=i,c=s,d=n;r=rc(r,i,s,n,e[o+0],7,-680876936),n=rc(n,r,i,s,e[o+1],12,-389564586),s=rc(s,n,r,i,e[o+2],17,606105819),i=rc(i,s,n,r,e[o+3],22,-1044525330),r=rc(r,i,s,n,e[o+4],7,-176418897),n=rc(n,r,i,s,e[o+5],12,1200080426),s=rc(s,n,r,i,e[o+6],17,-1473231341),i=rc(i,s,n,r,e[o+7],22,-45705983),r=rc(r,i,s,n,e[o+8],7,1770035416),n=rc(n,r,i,s,e[o+9],12,-1958414417),s=rc(s,n,r,i,e[o+10],17,-42063),i=rc(i,s,n,r,e[o+11],22,-1990404162),r=rc(r,i,s,n,e[o+12],7,1804603682),n=rc(n,r,i,s,e[o+13],12,-40341101),s=rc(s,n,r,i,e[o+14],17,-1502002290),i=rc(i,s,n,r,e[o+15],22,1236535329),r=ic(r,i,s,n,e[o+1],5,-165796510),n=ic(n,r,i,s,e[o+6],9,-1069501632),s=ic(s,n,r,i,e[o+11],14,643717713),i=ic(i,s,n,r,e[o+0],20,-373897302),r=ic(r,i,s,n,e[o+5],5,-701558691),n=ic(n,r,i,s,e[o+10],9,38016083),s=ic(s,n,r,i,e[o+15],14,-660478335),i=ic(i,s,n,r,e[o+4],20,-405537848),r=ic(r,i,s,n,e[o+9],5,568446438),n=ic(n,r,i,s,e[o+14],9,-1019803690),s=ic(s,n,r,i,e[o+3],14,-187363961),i=ic(i,s,n,r,e[o+8],20,1163531501),r=ic(r,i,s,n,e[o+13],5,-1444681467),n=ic(n,r,i,s,e[o+2],9,-51403784),s=ic(s,n,r,i,e[o+7],14,1735328473),i=ic(i,s,n,r,e[o+12],20,-1926607734),r=sc(r,i,s,n,e[o+5],4,-378558),n=sc(n,r,i,s,e[o+8],11,-2022574463),s=sc(s,n,r,i,e[o+11],16,1839030562),i=sc(i,s,n,r,e[o+14],23,-35309556),r=sc(r,i,s,n,e[o+1],4,-1530992060),n=sc(n,r,i,s,e[o+4],11,1272893353),s=sc(s,n,r,i,e[o+7],16,-155497632),i=sc(i,s,n,r,e[o+10],23,-1094730640),r=sc(r,i,s,n,e[o+13],4,681279174),n=sc(n,r,i,s,e[o+0],11,-358537222),s=sc(s,n,r,i,e[o+3],16,-722521979),i=sc(i,s,n,r,e[o+6],23,76029189),r=sc(r,i,s,n,e[o+9],4,-640364487),n=sc(n,r,i,s,e[o+12],11,-421815835),s=sc(s,n,r,i,e[o+15],16,530742520),i=sc(i,s,n,r,e[o+2],23,-995338651),r=nc(r,i,s,n,e[o+0],6,-198630844),n=nc(n,r,i,s,e[o+7],10,1126891415),s=nc(s,n,r,i,e[o+14],15,-1416354905),i=nc(i,s,n,r,e[o+5],21,-57434055),r=nc(r,i,s,n,e[o+12],6,1700485571),n=nc(n,r,i,s,e[o+3],10,-1894986606),s=nc(s,n,r,i,e[o+10],15,-1051523),i=nc(i,s,n,r,e[o+1],21,-2054922799),r=nc(r,i,s,n,e[o+8],6,1873313359),n=nc(n,r,i,s,e[o+15],10,-30611744),s=nc(s,n,r,i,e[o+6],15,-1560198380),i=nc(i,s,n,r,e[o+13],21,1309151649),r=nc(r,i,s,n,e[o+4],6,-145523070),n=nc(n,r,i,s,e[o+11],10,-1120210379),s=nc(s,n,r,i,e[o+2],15,718787259),i=nc(i,s,n,r,e[o+9],21,-343485551),r=Fw(r,a),i=Fw(i,l),s=Fw(s,c),n=Fw(n,d)}return[r,i,s,n]}function aIe(e,t=bC.Hex){const r=t||bC.Base64,i=yrt(hrt(e),e.length*DM);switch(r){case bC.Raw:return i;case bC.Hex:return frt(i);case bC.String:return prt(i);case bC.Base64:return mrt(i)}}var Lee;let f$=Lee=class extends _j{writeLevels(e,t,r){for(const i in e){const s=this.levels[i];return void(t.stops=s)}}clone(){return new Lee({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Nw(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Nw(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:ne(this.levels)})}};u([h()],f$.prototype,"levels",void 0),u([Le("levels")],f$.prototype,"writeLevels",null),f$=Lee=u([I("esri.views.2d.engine.LevelDependentSizeVariable")],f$);const _rt=te.getLogger("esri.views.2d.layers.support.clusterUtils");pe.add("esri-cluster-arcade-enabled",!0);const vrt=pe("esri-cluster-arcade-enabled"),brt=(e,t,r,i,s)=>{const n=t.clone();if(!Srt(n))return n;if(n.authoringInfo||(n.authoringInfo=new Aoe),n.authoringInfo.isAutoGenerated=!0,"visualVariables"in n){const o=(n.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=wrt(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=uT(e,l.field,"avg_angle","number"):l.valueExpression&&(l.field=vP(e,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=uT(e,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=uT(e,l.field,"avg","number"):l.valueExpression&&(l.field=vP(e,l.valueExpression,"avg","number"),l.valueExpression=null)}),C(a)&&!xrt(o)&&s&&(o.push(Trt(r,i)),n.dynamicClusterSize=!0),n.visualVariables=o}switch(n.type){case"simple":break;case"pie-chart":for(const o of n.attributes)o.field?o.field=uT(e,o.field,"sum","number"):o.valueExpression&&(o.field=vP(e,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":n.field?n.field=uT(e,n.field,"mode","string"):n.valueExpression&&(n.field=vP(e,n.valueExpression,"mode","string"),n.valueExpression=null);break;case"class-breaks":n.normalizationField?(n.field=uT(e,n.field,"avg_norm","number",n.normalizationField),n.normalizationField=null):n.field?n.field=uT(e,n.field,"avg","number"):n.valueExpression&&(n.field=vP(e,n.valueExpression,"avg","number"),n.valueExpression=null)}return n},wrt=e=>{for(const t of e)if(t.type==="size")return t;return null},xrt=e=>{for(const t of e)if(t.field==="cluster_count")return!0;return!1},Trt=(e,t)=>{const r=[new zA({value:0,size:0}),new zA({value:1})];if(C(t))return new _j({field:"cluster_count",stops:[...r,new zA({value:2,size:0})]});const i=Object.keys(t).reduce((s,n)=>({...s,[n]:[...r,new zA({value:Math.max(2,t[n].minValue),size:e.clusterMinSize}),new zA({value:Math.max(3,t[n].maxValue),size:e.clusterMaxSize})]}),{});return new f$({field:"cluster_count",levels:i})},Srt=e=>{const t=r=>_rt.error(new z("Unsupported-renderer",r,{renderer:e}));switch(e.type){case"unique-value":if(e.field2||e.field3)return t("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(e.normalizationField){const r=e.normalizationType;if(r!=="field")return t(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1;break}case"simple":case"pie-chart":break;default:return t(`FeatureReductionCluster does not support renderers of type ${e.type}`),!1}if(!vrt){if("valueExpression"in e&&e.valueExpression)return t("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some(r=>!(!("valueExpression"in r)||!r.valueExpression)))return t("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function Ert(e,t,r){switch(e){case"sum":return`cluster_sum_${t}`;case"avg":case"avg_angle":return`cluster_avg_${t}`;case"mode":return`cluster_type_${t}`;case"avg_norm":{const i=r,s="field",n=t.toLowerCase()+",norm:"+s+","+i.toLowerCase();return"cluster_avg_"+aIe(n)}}}function vP(e,t,r,i){const s=aIe(t),n=r==="mode"?`cluster_type_${s}`:r==="sum"?`cluster_sum_${s}`:`cluster_avg_${s}`;return e.some(o=>o.name===n)||e.push(new vE({name:n,isAutoGenerated:!0,onStatisticExpression:new tae({expression:t,returnType:i}),statisticType:r})),n}function uT(e,t,r,i,s){if(t==="cluster_count"||e.some(o=>o.name===t))return t;const n=Ert(r,t,s);return e.some(o=>o.name===n)||(r==="avg_norm"?e.push(new vE({name:n,isAutoGenerated:!0,onStatisticExpression:new tae({expression:`$feature.${t} / $feature.${s}`,returnType:i}),statisticType:"avg"})):e.push(new vE({name:n,isAutoGenerated:!0,onStatisticField:t,statisticType:r}))),n}const Crt=e=>{let t=class extends e{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const i=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",i)}},!0))}set featureReduction(r){const i=this._normalizeFeatureReduction(r);this._set("featureReduction",i)}set renderer(r){}_normalizeFeatureReduction(r){var a,l;if((r==null?void 0:r.type)!=="cluster")return r;const i=r.clone(),s=[new vE({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],n=((a=i.fields)!=null?a:[]).filter(c=>!c.isAutoGenerated);if(r.renderer&&!((l=r.renderer.authoringInfo)!=null&&l.isAutoGenerated))return i.fields=[...s,...n],i;if(r.symbol)return i.fields=[...s,...n],i.renderer=null,i;if(!this.renderer)return r;const o=brt(s,this.renderer,r,null,!1);return i.fields=[...s,...n],i.renderer=o,i}};return u([h(drt)],t.prototype,"featureReduction",null),t=u([I("esri.layers.mixins.FeatureReductionLayer")],t),t};var Nee;const Iq=new gr({asc:"ascending",desc:"descending"});let QA=Nee=class extends fe{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Nee({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([h({type:String,json:{write:!0}})],QA.prototype,"field",void 0),u([h({type:String,json:{write:!0}})],QA.prototype,"valueExpression",void 0),u([h({type:Iq.apiValues,json:{read:Iq.read,write:Iq.write}})],QA.prototype,"order",void 0),QA=Nee=u([I("esri.layers.support.OrderByInfo")],QA);const lIe=QA;function Art(e,t,r){if(!e)return null;const i=e.find(n=>!!n.field);if(!i)return null;const s=new lIe;return s.read(i,r),[s]}function Ort(e,t,r,i){const s=e.find(n=>!!n.field);s&&Vl(r,[s.toJSON()],t)}const Mrt=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return u([h({type:[lIe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:Art},write:{target:"layerDefinition.orderBy",writer:Ort}}})],t.prototype,"orderBy",void 0),t=u([I("esri.layers.mixins.OrderedLayer")],t),t};let m$=class extends be{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};u([h()],m$.prototype,"updating",void 0),u([h()],m$.prototype,"status",void 0),m$=u([I("esri.layers.support.PublishingInfo")],m$);const Rrt=m$,Irt="esri.layers.mixins.PublishableLayer",Prt=e=>{let t=class extends e{get publishingInfo(){if(this.destroyed)return null;const r=this._get("publishingInfo");if(r)return r;const i=new Rrt;return this._checkPublishingStatus(i),i}_checkPublishingStatus(r){let n=0;const o=async l=>{let c;r.updating=!0;try{c=await this.fetchPublishingStatus()}catch{c="unavailable"}c!=="published"&&c!=="unavailable"||(r.status==="publishing"&&this.refresh(),a.remove()),r.status=c,r.updating=!1,a.removed||(n=setTimeout(o,l,l+125))},a={removed:!1,remove(){this.removed=!0,clearTimeout(n)}};this.when().catch(()=>a.remove()),o(250),this.own(a)}};return u([h({readOnly:!0,clonable:!1})],t.prototype,"publishingInfo",null),t=u([I(Irt)],t),t},yN=new Ge,VD=new WeakMap;function $rt(e){cIe(e)&&yN.push(e)}function Drt(e){cIe(e)&&yN.includes(e)&&yN.remove(e)}function cIe(e){return e!=null&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function uIe(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:uIe(t,e%t):0}let Pq=0,k5=0;function Lrt(){var t;const e=Date.now();for(const r of yN)r.refreshInterval&&e-((t=VD.get(r))!=null?t:0)+5>=6e4*r.refreshInterval&&(VD.set(r,e),r.refresh(e))}b2e(()=>{const e=Date.now();let t=0;for(const r of yN)t=uIe(Math.round(6e4*r.refreshInterval),t),r.refreshInterval?VD.get(r)||VD.set(r,e):VD.delete(r);if(t!==k5){if(k5=t,clearInterval(Pq),k5===0)return void(Pq=0);Pq=setInterval(Lrt,k5)}});function Nrt(e){return e!=null&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const Frt=e=>{let t=class extends e{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=Bse(()=>this.hasDataChanged()),this.when().then(()=>{$rt(this)},()=>{})}destroy(){Drt(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){wM(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{te.getLogger(this.declaredClass).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return u([h({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),u([h({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),u([h()],t.prototype,"refreshParameters",null),t=u([I("esri.layers.mixins.RefreshableLayer")],t),t},m2=Br()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var Fee;let g$=Fee=class extends fe{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return Pw(this.value,this.unit,"milliseconds")}clone(){return new Fee({value:this.value,unit:this.unit})}};u([h({type:Number,json:{write:!0},nonNullable:!0})],g$.prototype,"value",void 0),u([h({type:m2.apiValues,json:{type:m2.jsonValues,read:m2.read,write:m2.write},nonNullable:!0})],g$.prototype,"unit",void 0),g$=Fee=u([I("esri.TimeInterval")],g$);const _N=g$;var kee;let eO=kee=class extends fe{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return t.respectsDaylightSaving!==void 0?t.respectsDaylightSaving:t.respectDaylightSaving!==void 0&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new kee({respectsDaylightSaving:e,timezone:t})}};u([h({type:Boolean,json:{write:!0}})],eO.prototype,"respectsDaylightSaving",void 0),u([me("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],eO.prototype,"readRespectsDaylightSaving",null),u([h({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],eO.prototype,"timezone",void 0),eO=kee=u([I("esri.layers.support.TimeReference")],eO);const krt=eO;var Uee;let pc=Uee=class extends fe{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const r=new Date(t.timeExtent[0]),i=new Date(t.timeExtent[1]);return new bg({start:r,end:i})}writeFullTimeExtent(e,t){e&&v(e.start)&&v(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new _N({value:t.timeInterval,unit:m2.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new _N({value:t.defaultTimeInterval,unit:m2.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const r=e.toJSON();t.timeInterval=r.value,t.timeIntervalUnits=r.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:r,interval:i,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:l}=this;return new Uee({cumulative:e,endField:t,hasLiveData:r,interval:i,startField:s,timeReference:ne(n),fullTimeExtent:ne(o),trackIdField:a,useTime:l})}};u([h({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],pc.prototype,"cumulative",void 0),u([h({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],pc.prototype,"endField",void 0),u([h({type:bg,json:{write:{enabled:!0,allowNull:!0}}})],pc.prototype,"fullTimeExtent",void 0),u([me("fullTimeExtent",["timeExtent"])],pc.prototype,"readFullTimeExtent",null),u([Le("fullTimeExtent")],pc.prototype,"writeFullTimeExtent",null),u([h({type:Boolean,json:{write:!0}})],pc.prototype,"hasLiveData",void 0),u([h({type:_N,json:{write:{enabled:!0,allowNull:!0}}})],pc.prototype,"interval",void 0),u([me("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],pc.prototype,"readInterval",null),u([Le("interval")],pc.prototype,"writeInterval",null),u([h({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],pc.prototype,"startField",void 0),u([h({type:krt,json:{write:{enabled:!0,allowNull:!0}}})],pc.prototype,"timeReference",void 0),u([h({type:String,json:{write:{enabled:!0,allowNull:!0}}})],pc.prototype,"trackIdField",void 0),u([h({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],pc.prototype,"useTime",void 0),pc=Uee=u([I("esri.layers.support.TimeInfo")],pc);const dIe=pc,Urt=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const s=i.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=m2.fromJSON(s.timeOffsetUnits);return n&&o?new _N({value:n,unit:o}):null}set timeInfo(r){XAe(r,this.fieldsIndex),this._set("timeInfo",r)}};return u([h({type:bg,json:{write:!1}})],t.prototype,"timeExtent",void 0),u([h({type:_N})],t.prototype,"timeOffset",void 0),u([me("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),u([h({value:null,type:dIe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),u([h({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=u([I("esri.layers.mixins.TemporalLayer")],t),t},hme=new gr({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let Ib=class extends ki(fe){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([h({json:{write:!0}})],Ib.prototype,"name",void 0),u([h({json:{write:!0}})],Ib.prototype,"description",void 0),u([h({json:{read:hme.read,write:hme.write}})],Ib.prototype,"drawingTool",void 0),u([h({json:{write:!0}})],Ib.prototype,"prototype",void 0),u([h({json:{write:!0}})],Ib.prototype,"thumbnail",void 0),Ib=u([I("esri.layers.support.FeatureTemplate")],Ib);const nae=Ib;let O_=class extends ki(fe){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const r of Object.keys(e))t[r]=joe(e[r]);return t}writeDomains(e,t){var i;const r={};for(const s of Object.keys(e))e[s]&&(r[s]=(i=e[s])==null?void 0:i.toJSON());t.domains=r}};u([h({json:{write:!0}})],O_.prototype,"id",void 0),u([h({json:{write:!0}})],O_.prototype,"name",void 0),u([h({json:{write:!0}})],O_.prototype,"domains",void 0),u([me("domains")],O_.prototype,"readDomains",null),u([Le("domains")],O_.prototype,"writeDomains",null),u([h({type:[nae],json:{write:!0}})],O_.prototype,"templates",void 0),O_=u([I("esri.layers.support.FeatureType")],O_);const hIe=O_;function Brt(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function pme(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function fme(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class pIe{constructor(t=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;this.fields=t;const r=[];for(const i of t){const s=i&&i.name;if(s){const n=mme(s),o=gme(s);this._fieldsMap.set(s,i),this._fieldsMap.set(n,i),this._normalizedFieldsMap.set(o,i),r.push(n),Brt(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):ij(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),pme(i)||fme(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)pme(t)||fme(t)||t.nullable||DYe(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){var i;if(!t)return;let r=this._fieldsMap.get(t);return r||(r=(i=this._fieldsMap.get(mme(t)))!=null?i:this._normalizedFieldsMap.get(gme(t)),r&&this._fieldsMap.set(t,r),r)}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){var i;const r=this.get(t);if(r)return(i=r.name)!=null?i:void 0}}function mme(e){return e.trim().toLowerCase()}function gme(e){return TYe(e).toLowerCase()}function fIe(){return{fields:{type:[Aj],value:null},fieldsIndex:{readOnly:!0,get(){return new pIe(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){var t;const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const r of e)((t=this.fieldsIndex)==null?void 0:t.has(r))||te.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${r} found in outFields`,{layer:this,outFields:e});return coe(this.fieldsIndex,e)}}}}const $q=te.getLogger("esri.layers.support.labelingInfo"),zrt=/\[([^\[\]]+)\]/gi;function jz(e,t,r){return e?e.map(i=>{const s=new e4;if(s.read(i,r),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(zrt,(o,a)=>`[${Vrt(a,n)}]`)}return s}):null}function Vrt(e,t){if(!t)return e;const r=e.toLowerCase();for(let i=0;i<t.length;i++){const s=t[i].name;if(s.toLowerCase()===r)return s}return e}const jrt={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function P6t(e,t){const r=ne(e);return r.some(i=>Grt(i,t))?[]:r}function Grt(e,t){const r=e.labelPlacement,i=jrt[t];if(!e.symbol)return $q.warn("No ILabelClass symbol specified."),!0;if(!i)return $q.error(new z("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${t}' is not supported`)),!0;if(!i.includes(r)){const s=i[0];r&&$q.warn(`Found invalid label placement type ${r} for ${t}. Defaulting to ${s}`),e.labelPlacement=s}return!1}const um=[];function Hrt(e,t){var i,s;if(tRe((i=e.url)!=null?i:""))return!0;const{wkid:r}=t;for(const n of um){if(((s=e.version)!=null?s:0)>=n[0])return!0;if(typeof n[1]=="function"&&(n[1]=n[1]()),n[1].has(r))return!1}return!0}um.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),um.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),um.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),um.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),um.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),um.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),um.push([10.61,()=>new Set([102497])]),um.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),um.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),um.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function mIe(e,t,r){const i=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const s=await Jh(i.populateFromStyle());if(Ir(r),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new Ou("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t==null?void 0:t.origin)}}}var Bee;let tO=Bee=class extends fe{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new Bee({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([h({type:[String],json:{write:!0}})],tO.prototype,"groupByFields",void 0),u([h({type:Number,json:{write:!0}})],tO.prototype,"topCount",void 0),u([h({type:[String],json:{write:!0}})],tO.prototype,"orderByFields",void 0),tO=Bee=u([I("esri.rest.support.TopFilter")],tO);const qrt=tO;var zee;const yme=new gr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),_me=new gr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let nn=zee=class extends fe{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new zee(ne({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([h({type:Boolean,json:{write:!0}})],nn.prototype,"cacheHint",void 0),u([h({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],nn.prototype,"distance",void 0),u([h({types:Yx,json:{read:ql,write:!0}})],nn.prototype,"geometry",void 0),u([h({type:Number,json:{write:!0}})],nn.prototype,"geometryPrecision",void 0),u([h({type:Number,json:{write:!0}})],nn.prototype,"maxAllowableOffset",void 0),u([h({type:Number,json:{read:{source:"resultRecordCount"}}})],nn.prototype,"num",void 0),u([h({json:{write:!0}})],nn.prototype,"objectIds",void 0),u([h({type:[String],json:{write:!0}})],nn.prototype,"orderByFields",void 0),u([h({type:[String],json:{write:!0}})],nn.prototype,"outFields",void 0),u([h({type:Ve,json:{read:{source:"outSR"},write:{target:"outSR"}}})],nn.prototype,"outSpatialReference",void 0),u([h({type:String,json:{write:!0}})],nn.prototype,"resultType",void 0),u([h({json:{write:!0}})],nn.prototype,"returnGeometry",void 0),u([h({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],nn.prototype,"returnM",void 0),u([h({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],nn.prototype,"returnZ",void 0),u([h({type:Number,json:{read:{source:"resultOffset"}}})],nn.prototype,"start",void 0),u([Le("start"),Le("num")],nn.prototype,"writeStart",null),u([h({type:String,json:{read:{source:"spatialRel",reader:yme.read},write:{target:"spatialRel",writer:yme.write}}})],nn.prototype,"spatialRelationship",void 0),u([h({type:bg,json:{write:!0}})],nn.prototype,"timeExtent",void 0),u([h({type:qrt,json:{write:!0}})],nn.prototype,"topFilter",void 0),u([h({type:String,json:{read:_me.read,write:{writer:_me.write,overridePolicy(e){return{enabled:v(e)&&v(this.distance)&&this.distance>0}}}}})],nn.prototype,"units",void 0),u([h({type:String,json:{write:!0}})],nn.prototype,"where",void 0),nn=zee=u([I("esri.rest.support.TopFeaturesQuery")],nn),nn.from=ts(nn);const U5=nn,Wrt=["oid","global-id"],Xrt=["oid","global-id","guid"];function gIe({displayField:e,editFieldsInfo:t,fields:r,objectIdField:i,title:s},n){if(!r)return null;const o=eit({editFieldsInfo:t,fields:r,objectIdField:i},n);if(!o.length)return null;const a=iit({titleBase:s,fields:r,displayField:e}),l=rit();return new Nc({title:a,content:l,fieldInfos:o})}const Yrt=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],Zrt=(e,{editFieldsInfo:t,objectIdField:r,visibleFieldNames:i})=>i?i.has(e.name):!yIe(e.name,t)&&(!r||e.name!==r)&&!Wrt.includes(e.type)&&!Yrt.some(s=>s.test(e.name));function Jrt(e,t){const r=e;return t&&(e=e.filter(i=>!t.includes(i.type))),e===r&&(e=e.slice()),e.sort(Krt),e}function Krt(e,t){return e.type==="oid"?-1:t.type==="oid"?1:vme(e)?-1:vme(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function yIe(e,t){if(!e||!t)return!1;const{creationDateField:r,creatorField:i,editDateField:s,editorField:n}=t;return[r&&r.toLowerCase(),i&&i.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function Qrt(e,t){return e.editable&&!Xrt.includes(e.type)&&!yIe(e.name,t)}function eit({editFieldsInfo:e,fields:t,objectIdField:r},i){return Jrt(t!=null?t:[],(i==null?void 0:i.ignoreFieldTypes)||sit).map(s=>new GF({fieldName:s.name,isEditable:Qrt(s,e),label:s.alias,format:tit(s),visible:Zrt(s,{editFieldsInfo:e,objectIdField:r,visibleFieldNames:i==null?void 0:i.visibleFieldNames})}))}function tit(e){switch(e.type){case"small-integer":case"integer":case"single":return new HO({digitSeparator:!0,places:0});case"double":return new HO({digitSeparator:!0,places:2});case"date":return new HO({dateFormat:"long-month-day-year"});default:return e.type==="string"&&eOe(e.name)?new HO({digitSeparator:!0,places:0}):null}}function rit(){return[new SR,new aN]}function iit(e){const t=AYe(e),{titleBase:r}=e;return t?`${r}: {${t.trim()}}`:r!=null?r:""}function vme(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"}const sit=["geometry","blob","raster","guid","xml"],Vc="FeatureLayer",_Ie="esri.layers.FeatureLayer",nit=te.getLogger(_Ie);function B5(e,t){return new z("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function bme(e){return e&&e instanceof Ge}const Dq=fIe();function Lq(e,t,r){const i=!!(r!=null&&r.writeLayerSchema);return{enabled:i,ignoreOrigin:i}}let wt=class extends Utt(Crt(htt(Prt(lRe(Qoe(Mrt(Urt(Ej(Frt(nRe(Uoe(Boe(wj(stt(ZMe(ki(fE))))))))))))))))){constructor(...e){super(...e),this._handles=new hr,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=Ve.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=Qe(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?{url:e,...t}:e}load(e){var i;const t=v(e)?e.signal:null;if(((i=this.portalItem)==null?void 0:i.loaded)&&this.source)return this.addResolvingPromise(this.createGraphicsSource(t).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(zh).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstLayerId(t);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new z("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(r),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,YRe(e,t,this.url)}get createQueryVersion(){var e;return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),((e=this._get("createQueryVersion"))!=null?e:0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,r){return this._readEditingEnabled(t,!0,r)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,r,i){this._writeEditingEnabled(e,t,!0,i)}readIsTable(e,t){var r;return(t=(r=t==null?void 0:t.layerDefinition)!=null?r:t).type==="Table"||!t.geometryType}writeIsTable(e,t,r,i){i!=null&&i.writeLayerSchema&&Vl(r,e?"Table":"Feature Layer",t)}readGlobalIdField(e,t){return ZRe(t.layerDefinition||t)}readObjectIdField(e,t){return JRe(t.layerDefinition||t)}get parsedUrl(){const e=Wa(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=Mu(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=Mu(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){Pz(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,r){var s,n;const i=(s=(t=t.layerDefinition||t).drawingInfo)==null?void 0:s.renderer;if(i){const o=(n=hN(i,t,r))!=null?n:void 0;return o||nit.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r}),o}if(t.defaultSymbol)return t.types&&t.types.length?new ZF({defaultSymbol:Nq(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map(o=>({id:o.id,symbol:Nq(o.symbol,o,r)}))}):new RR({symbol:Nq(t.defaultSymbol,t,r)})}set source(e){const t=this._get("source");t!==e&&(bme(t)&&this._resetMemorySource(t),bme(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof Ge?new Y_({layer:this,items:e}):e:null}readSource(e,t){var i;const r=bd.fromJSON(t.featureSet);return new Y_({layer:this,items:(i=r==null?void 0:r.features)!=null?i:[]})}readTemplates(e,t){const r=t.editFieldsInfo,i=r&&r.creatorField,s=r&&r.editorField;return e=e&&e.map(n=>nae.fromJSON(n)),this._fixTemplates(e,i),this._fixTemplates(e,s),e}readTitle(e,t){var s,n;const r=(n=(s=t.layerDefinition)==null?void 0:s.name)!=null?n:t.name,i=t.title||t.layerDefinition&&t.layerDefinition.title;if(r){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?eRe(this.url,r):r;let a=r;if(!a&&this.url){const l=aC(this.url);v(l)&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),xj(a)):void 0}if(this.sublayerTitleMode==="item-title"&&i)return i}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let r=(t=t.layerDefinition||t).typeIdField;if(r&&t.fields){r=r.toLowerCase();const i=t.fields.find(s=>s.name.toLowerCase()===r);i&&(r=i.name)}return r}readTypes(e,t){e=(t=t.layerDefinition||t).types;const r=t.editFieldsInfo,i=r&&r.creatorField,s=r&&r.editorField;return e&&e.map(n=>(n=hIe.fromJSON(n),this._fixTemplates(n.templates,i),this._fixTemplates(n.templates,s),n))}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}async addAttachment(e,t){return Stt(this,e,t,Vc)}async updateAttachment(e,t,r){return Ett(this,e,t,r,Vc)}async applyEdits(e,t){return Ctt(this,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return gIe(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:t}=await vze(re(()=>import("./FeatureLayerSource.4737bab7.js"),["assets/FeatureLayerSource.4737bab7.js","assets/clientSideDefaults.459207f2.js","assets/QueryEngineCapabilities.78217f95.js","assets/executeForIds.c313e631.js"]),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=Ntt(this);e.dynamicDataSource=this.dynamicDataSource;const t=v(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,r=uQe(this.definitionExpression,t);return e.where=r||"1=1",e}async deleteAttachments(e,t){return Att(this,e,t,Vc)}async fetchRecomputedExtents(e){return Ott(this,e,Vc)}getFeatureType(e){const{typeIdField:t,types:r}=this;if(!t||!e)return null;const i=e.attributes?e.attributes[t]:void 0;if(i==null)return null;let s=null;return r==null||r.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===i.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const r=t&&t.feature,i=this.getFeatureType(r);if(i){const s=i.domains&&i.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,t){return Mtt(this,e,t,Vc)}async queryFeatures(e,t){var s;const r=await this.load(),i=await r.source.queryFeatures((s=pf.from(e))!=null?s:r.createQuery(),t);if(i!=null&&i.features)for(const n of i.features)n.layer=n.sourceLayer=r;return i}async queryObjectIds(e,t){return Rtt(this,e,t,Vc)}async queryFeatureCount(e,t){return Itt(this,e,t,Vc)}async queryExtent(e,t){return Ptt(this,e,t,Vc)}async queryRelatedFeatures(e,t){return $tt(this,e,t,Vc)}async queryRelatedFeaturesCount(e,t){return Dtt(this,e,t,Vc)}async queryTopFeatures(e,t){var n;const{source:r,capabilities:i}=await this.load();if(!r.queryTopFeatures||!((n=i==null?void 0:i.query)!=null&&n.supportsTopFeaturesQuery))throw new z(Vc,"Layer source does not support queryTopFeatures capability");const s=await r.queryTopFeatures(U5.from(e),t);if(s!=null&&s.features)for(const o of s.features)o.layer=o.sourceLayer=this;return s}async queryTopObjectIds(e,t){const{source:r,capabilities:i}=await this.load();if(!r.queryTopObjectIds||!(i!=null&&i.query.supportsTopFeaturesQuery))throw new z(Vc,"Layer source does not support queryTopObjectIds capability");return r.queryTopObjectIds(U5.from(e),t)}async queryTopFeaturesExtent(e,t){var s;const{source:r,capabilities:i}=await this.load();if(!r.queryTopExtents||!((s=i==null?void 0:i.query)!=null&&s.supportsTopFeaturesQuery))throw new z(Vc,"Layer source does not support queryTopExtents capability");return r.queryTopExtents(U5.from(e),t)}async queryTopFeatureCount(e,t){var s;const{source:r,capabilities:i}=await this.load();if(!r.queryTopCount||!((s=i==null?void 0:i.query)!=null&&s.supportsTopFeaturesQuery))throw new z(Vc,"Layer source does not support queryFeatureCount capability");return r.queryTopCount(U5.from(e),t)}read(e,t){const r=e.featureCollection;if(r){const i=r.layers;i&&i.length===1&&(super.read(i[0],t),r.showLegend!=null&&super.read({showLegend:r.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var n,o;t={...t,origin:(n=t==null?void 0:t.origin)!=null?n:void 0,writeLayerSchema:(o=t==null?void 0:t.writeLayerSchema)!=null?o:this._hasMemorySource()};const{origin:r,layerContainerType:i,messages:s}=t;if(this.dynamicDataSource)return s==null||s.push(B5(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(r==="web-scene"||r==="web-map"&&i!=="tables")return s==null||s.push(B5(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(B5(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&r==="web-map"&&i==="tables")return s==null||s.push(B5(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new z(Vc,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var t;return!!this.loaded&&(((t=this.source)==null?void 0:t.type)==="memory"||Hrt(this,e))}async save(e){return(await re(()=>import("./featureLayerUtils.039a3201.js"),["assets/featureLayerUtils.039a3201.js","assets/fetchService.2cb73a25.js","assets/jsonContext.df83b33f.js"])).save(this,e)}async saveAs(e,t){return(await re(()=>import("./featureLayerUtils.039a3201.js"),["assets/featureLayerUtils.039a3201.js","assets/fetchService.2cb73a25.js","assets/jsonContext.df83b33f.js"])).saveAs(this,e,t)}_readEditingEnabled(e,t,r){var s;let i=(s=e.layerDefinition)==null?void 0:s.capabilities;return i?this._hasEditingCapability(i):(i=e.capabilities,t&&(r==null?void 0:r.origin)==="web-map"&&!this._hasMemorySource()&&i?this._hasEditingCapability(i):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,r,i){var s,n;if(!e){const o=(n=(s=this.capabilities)==null?void 0:s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";Vl("layerDefinition.capabilities",o,t),r&&!(i!=null&&i.writeLayerSchema)&&(t.capabilities=o)}}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return lr(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(t=>{const r=t.data;if(r)return Array.isArray(r.layers)&&r.layers.length>0?r.layers[0].id:Array.isArray(r.tables)&&r.tables.length>0?r.tables[0].id:void 0})}async initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),Pz(this.renderer,this.fieldsIndex),XAe(this.timeInfo,this.fieldsIndex),mIe(this,{origin:"service"})}async hasDataChanged(){return Ltt(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var t,r,i;const e=(r=(t=this.parsedUrl)==null?void 0:t.path)!=null?r:"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||((i=this.fields)==null?void 0:i.some(s=>s.type==="geometry"))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(r=>{const i=r.prototype&&r.prototype.attributes;i&&t&&delete i[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new z("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new z("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};u([me("service","capabilities")],wt.prototype,"readCapabilities",null),u([h({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],wt.prototype,"charts",void 0),u([h({readOnly:!0})],wt.prototype,"createQueryVersion",null),u([h({json:{read:{source:"layerDefinition.copyrightText"}}})],wt.prototype,"copyright",void 0),u([h({json:{read:{source:"layerDefinition.displayField"}}})],wt.prototype,"displayField",void 0),u([h({types:un,readOnly:!0})],wt.prototype,"defaultSymbol",void 0),u([h({type:Rm})],wt.prototype,"dynamicDataSource",void 0),u([h({type:Boolean})],wt.prototype,"editingEnabled",null),u([me(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],wt.prototype,"readEditingEnabled",null),u([me("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],wt.prototype,"readEditingEnabledFromWebMap",null),u([Le(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],wt.prototype,"writeEditingEnabled",null),u([Le("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],wt.prototype,"writeEditingEnabledToWebMap",null),u([h({...Dq.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:Lq}}}}})],wt.prototype,"fields",void 0),u([h(Dq.fieldsIndex)],wt.prototype,"fieldsIndex",void 0),u([h({type:TQe,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],wt.prototype,"formTemplate",void 0),u([h({json:{read:{source:"layerDefinition.extent"}}})],wt.prototype,"fullExtent",void 0),u([h({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:Lq,writer(e,t,r){const i=e?Aee.toJSON(e):null;i&&Vl(r,i,t)}}}},read:{source:"layerDefinition.geometryType",reader:Aee.read}}})],wt.prototype,"geometryType",void 0),u([h({json:{read:{source:"layerDefinition.hasM"}}})],wt.prototype,"hasM",void 0),u([h({json:{read:{source:"layerDefinition.hasZ"}}})],wt.prototype,"hasZ",void 0),u([h(fRe)],wt.prototype,"id",void 0),u([h({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],wt.prototype,"infoFor3D",void 0),u([h({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],wt.prototype,"isTable",void 0),u([me("service","isTable",["type","geometryType"]),me("isTable",["layerDefinition.type","layerDefinition.geometryType"])],wt.prototype,"readIsTable",null),u([Le("web-map","isTable")],wt.prototype,"writeIsTable",null),u([h(Sj)],wt.prototype,"labelsVisible",void 0),u([h({type:[e4],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:jz},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:jz},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],wt.prototype,"labelingInfo",void 0),u([h((()=>{const e=ne(WKe);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,r,i){Vl(i,rj(t),r)}}},e})())],wt.prototype,"opacity",void 0),u([h(hRe)],wt.prototype,"legendEnabled",void 0),u([h({type:["show","hide"],json:(()=>{const e=ne(mRe.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],wt.prototype,"listMode",void 0),u([me("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],wt.prototype,"readGlobalIdField",null),u([h({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:Lq}}}}})],wt.prototype,"objectIdField",void 0),u([me("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],wt.prototype,"readObjectIdField",null),u([h({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],wt.prototype,"operationalLayerType",void 0),u([h(Dq.outFields)],wt.prototype,"outFields",void 0),u([h({readOnly:!0})],wt.prototype,"parsedUrl",null),u([h({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],wt.prototype,"path",void 0),u([h(Tj)],wt.prototype,"popupEnabled",void 0),u([h({type:Nc,json:{name:"popupInfo",write:!0}})],wt.prototype,"popupTemplate",void 0),u([h({readOnly:!0})],wt.prototype,"defaultPopupTemplate",null),u([h({types:bj,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:XMe,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}})],wt.prototype,"renderer",null),u([me("service","renderer",["drawingInfo.renderer","defaultSymbol"]),me("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],wt.prototype,"readRenderer",null),u([h((()=>{const e=ne(uRe);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],wt.prototype,"screenSizePerspectiveEnabled",void 0),u([h({clonable:!1})],wt.prototype,"source",null),u([Gt("source")],wt.prototype,"castSource",null),u([me("portal-item","source",["featureSet"]),me("web-map","source",["featureSet"])],wt.prototype,"readSource",null),u([h({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],wt.prototype,"spatialReference",void 0),u([h({type:Number})],wt.prototype,"subtypeCode",void 0),u([h({type:[nae]})],wt.prototype,"templates",void 0),u([me("templates",["editFieldsInfo","creatorField","editorField","templates"])],wt.prototype,"readTemplates",null),u([h({type:dIe})],wt.prototype,"timeInfo",void 0),u([h()],wt.prototype,"title",void 0),u([me("service","title",["name"]),me("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],wt.prototype,"readTitle",null),u([me("web-map","title",["layerDefinition.name","title"])],wt.prototype,"readTitleFromWebMap",null),u([h({type:String})],wt.prototype,"sublayerTitleMode",void 0),u([h({json:{read:!1}})],wt.prototype,"type",void 0),u([h({type:String})],wt.prototype,"typeIdField",void 0),u([me("service","typeIdField"),me("typeIdField",["layerDefinition.typeIdField"])],wt.prototype,"readTypeIdField",null),u([h({type:[hIe]})],wt.prototype,"types",void 0),u([me("service","types",["types"]),me("types",["layerDefinition.types"])],wt.prototype,"readTypes",null),u([h({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],wt.prototype,"visible",void 0),u([me("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],wt.prototype,"readVisible",null),wt=u([I(_Ie)],wt);const Nq=Wx({types:gj}),Gz=wt,$6t=Object.freeze(Object.defineProperty({__proto__:null,default:Gz},Symbol.toStringTag,{value:"Module"}));class oit{constructor(t,r,i,s){var o;this._parsedUrl=t,this._portalItem=r,this._apiKey=i,this.signal=s,this._rootDocument=null;const n=(o=this._parsedUrl)==null?void 0:o.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);n&&(this._urlParts={root:n[1],layerId:parseInt(n[2],10)})}async fetch(){var i;if(!this._urlParts)return null;const t=(i=this._portalItem)!=null?i:await this._portalItemFromServiceItemId();if(C(t))return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(t);return C(r)?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){var r;if(!this._urlParts)return null;const t=(r=this._portalItem)!=null?r:await this._portalItemFromServiceItemId();return C(t)?null:this._findAndLoadRelatedPortalItem(t)}async _fetchRootDocument(){if(v(this._rootDocument))return this._rootDocument;if(C(this._urlParts))return this._rootDocument={},{};const t={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},r=`${this._urlParts.root}/SceneServer`;try{const i=await lr(r,t);this._rootDocument=i.data}catch{this._rootDocument={}}return this._rootDocument}async _fetchServiceOwningPortalUrl(){var s;const t=(s=this._parsedUrl)==null?void 0:s.path,r=t?pn==null?void 0:pn.findServerInfo(t):null;if(r!=null&&r.owningSystemUrl)return r.owningSystemUrl;const i=t?t.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null;try{const n=(await lr(i,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(n)return n}catch(n){zh(n)}return null}async _findAndLoadRelatedPortalItem(t){try{return(await t.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(r=>r.type==="Feature Service")||null}catch(r){return zh(r),null}}async _loadFeatureLayerFromPortalItem(t){var i;await t.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl((i=t.url)!=null?i:"");return new Gz({url:r,portalItem:t}).load({signal:this.signal})}async _loadFromUrl(){var r;const t=await this._findMatchingAssociatedSublayerUrl(`${(r=this._urlParts)==null?void 0:r.root}/FeatureServer`);return new Gz({url:t}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(t){var p;const r=t.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),i={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},s=(p=this._urlParts)==null?void 0:p.layerId,n=this._fetchRootDocument(),o=lr(r,i),[a,l]=await Promise.all([o,n]),c=l&&l.layers,d=a.data&&a.data.layers;if(!Array.isArray(d))throw new Error("expected layers array");if(Array.isArray(c)){for(let f=0;f<Math.min(c.length,d.length);f++)if(c[f].id===s)return`${r}/${d[f].id}`}else if(s!=null&&s<d.length)return`${r}/${d[s].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const t=(await this._fetchRootDocument()).serviceItemId;if(!t)return null;const r=new pE({id:t,apiKey:this._apiKey}),i=await this._fetchServiceOwningPortalUrl();v(i)&&(r.portal=new oo({url:i}));try{return r.load({signal:this.signal})}catch(s){return zh(s),null}}}let QS=class extends fe{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};u([h({type:Number})],QS.prototype,"nodesPerPage",void 0),u([h({type:Number})],QS.prototype,"rootIndex",void 0),u([h({type:String})],QS.prototype,"lodSelectionMetricType",void 0),QS=u([I("esri.layer.support.I3SNodePageDefinition")],QS);let gv=class extends fe{constructor(){super(...arguments),this.factor=1}};u([h({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],gv.prototype,"id",void 0),u([h({type:Number})],gv.prototype,"factor",void 0),gv=u([I("esri.layer.support.I3SMaterialTexture")],gv);let Pb=class extends fe{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};u([h({type:[Number]})],Pb.prototype,"baseColorFactor",void 0),u([h({type:gv})],Pb.prototype,"baseColorTexture",void 0),u([h({type:gv})],Pb.prototype,"metallicRoughnessTexture",void 0),u([h({type:Number})],Pb.prototype,"metallicFactor",void 0),u([h({type:Number})],Pb.prototype,"roughnessFactor",void 0),Pb=u([I("esri.layer.support.I3SMaterialPBRMetallicRoughness")],Pb);let Mp=class extends fe{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};u([Ue({opaque:"opaque",mask:"mask",blend:"blend"})],Mp.prototype,"alphaMode",void 0),u([h({type:Number})],Mp.prototype,"alphaCutoff",void 0),u([h({type:Boolean})],Mp.prototype,"doubleSided",void 0),u([Ue({none:"none",back:"back",front:"front"})],Mp.prototype,"cullFace",void 0),u([h({type:gv})],Mp.prototype,"normalTexture",void 0),u([h({type:gv})],Mp.prototype,"occlusionTexture",void 0),u([h({type:gv})],Mp.prototype,"emissiveTexture",void 0),u([h({type:[Number]})],Mp.prototype,"emissiveFactor",void 0),u([h({type:Pb})],Mp.prototype,"pbrMetallicRoughness",void 0),Mp=u([I("esri.layer.support.I3SMaterialDefinition")],Mp);let y$=class extends fe{};u([h({type:String,json:{read:{source:["name","index"],reader:(e,t)=>e!=null?e:`${t.index}`}}})],y$.prototype,"name",void 0),u([Ue({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],y$.prototype,"format",void 0),y$=u([I("esri.layer.support.I3STextureFormat")],y$);let _$=class extends fe{constructor(){super(...arguments),this.atlas=!1}};u([h({type:[y$]})],_$.prototype,"formats",void 0),u([h({type:Boolean})],_$.prototype,"atlas",void 0),_$=u([I("esri.layer.support.I3STextureSetDefinition")],_$);let Im=class extends fe{};u([Ue({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],Im.prototype,"type",void 0),u([h({type:Number})],Im.prototype,"component",void 0),Im=u([I("esri.layer.support.I3SGeometryAttribute")],Im);let v$=class extends fe{};u([Ue({draco:"draco"})],v$.prototype,"encoding",void 0),u([h({type:[String]})],v$.prototype,"attributes",void 0),v$=u([I("esri.layer.support.I3SGeometryCompressedAttributes")],v$);let zf=class extends fe{constructor(){super(...arguments),this.offset=0}};u([h({type:Number})],zf.prototype,"offset",void 0),u([h({type:Im})],zf.prototype,"position",void 0),u([h({type:Im})],zf.prototype,"normal",void 0),u([h({type:Im})],zf.prototype,"uv0",void 0),u([h({type:Im})],zf.prototype,"color",void 0),u([h({type:Im})],zf.prototype,"uvRegion",void 0),u([h({type:Im})],zf.prototype,"featureId",void 0),u([h({type:Im})],zf.prototype,"faceRange",void 0),u([h({type:v$})],zf.prototype,"compressedAttributes",void 0),zf=u([I("esri.layer.support.I3SGeometryBuffer")],zf);let b$=class extends fe{};u([Ue({triangle:"triangle"})],b$.prototype,"topology",void 0),u([h()],b$.prototype,"geometryBuffers",void 0),b$=u([I("esri.layer.support.I3SGeometryDefinition")],b$);let $b=class extends fe{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};u([h({type:String,json:{read:!0,write:!0}})],$b.prototype,"name",void 0),u([h({type:String,json:{read:!0,write:!0}})],$b.prototype,"field",void 0),u([h({type:[Number],json:{read:!0,write:!0}})],$b.prototype,"currentRangeExtent",void 0),u([h({type:[Number],json:{read:!0,write:!0}})],$b.prototype,"fullRangeExtent",void 0),u([h({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],$b.prototype,"type",void 0),$b=u([I("esri.layers.support.RangeInfo")],$b);function Vee(e){return oae[ait(e)]||cit}function ait(e){return e instanceof Blob?e.type:lit(e.url)}function lit(e){const t=dne(e);return jee[t]||vIe}const oae={},vIe="text/plain",cit=oae[vIe],jee={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const e in jee)oae[jee[e]]=e;function uit(e){var r;const t=(r=e==null?void 0:e.origins)!=null?r:[void 0];return(i,s)=>{const n=dit(e,i,s);for(const o of t){const a=Wse(i,o,s);for(const l in n)a[l]=n[l]}}}function dit(e,t,r){var i;if((e==null?void 0:e.type)==="resource")return hit(e,t,r);switch((i=e==null?void 0:e.type)!=null?i:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:s,write:n}=zZe;return{read:s,write:n}}}}function hit(e,t,r){const i=PF(t,r);return{type:String,read:(s,n,o)=>{const a=dj(s,n,o);return i.type===String?a:typeof i.type=="function"?new i.type({url:a}):void 0},write:{writer(s,n,o,a){if(!a||!a.resources)return typeof s=="string"?void(n[o]=Wv(s,a)):void(n[o]=s.write({},a));const l=git(s),c=Wv(l,{...a,verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},AR.NO),d=i.type!==String&&(!gRe(this)||a&&a.origin&&this.originIdOf(r)>mv(a.origin)),p={object:this,propertyName:r,value:s,targetUrl:c,dest:n,targetPropertyName:o,context:a,params:e};a&&a.portalItem&&c&&!Rd(c)?d?pit(p):fit(p):a&&a.portalItem&&(c==null||LOe(c)!=null||bx(c)||d)?bIe(p):n[o]=c}}}}function bIe(e){var _,x,b;const{targetUrl:t,params:r,value:i,context:s,dest:n,targetPropertyName:o}=e;if(!s.portalItem)return;const a=NOe(t),l=(_=a==null?void 0:a.filename)!=null?_:pne(),c=(x=r==null?void 0:r.prefix)!=null?x:a==null?void 0:a.prefix,d=xIe(i,t,s),p=Mu(c,l),f=`${p}.${Vee(d)}`,m=s.portalItem.resourceFromPath(f);bx(t)&&s.resources&&s.resources.pendingOperations.push(mit(t).then(w=>{m.path=`${p}.${Vee(w)}`,n[o]=m.itemRelativeUrl}).catch(()=>{}));const g=(b=r==null?void 0:r.compress)!=null?b:!1;s.resources&&wIe({...e,resource:m,content:d,compress:g,updates:s.resources.toAdd}),n[o]=m.itemRelativeUrl}function pit(e){var f;const{context:t,targetUrl:r,params:i,value:s,dest:n,targetPropertyName:o}=e;if(!t.portalItem)return;const a=t.portalItem.resourceFromPath(r),l=xIe(s,r,t),c=Vee(l),d=dne(a.path),p=(f=i==null?void 0:i.compress)!=null?f:!1;c===d?(t.resources&&wIe({...e,resource:a,content:l,compress:p,updates:t.resources.toUpdate}),n[o]=r):bIe(e)}function fit({context:e,targetUrl:t,dest:r,targetPropertyName:i}){e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(t),compress:!1}),r[i]=t)}function wIe({object:e,propertyName:t,updates:r,resource:i,content:s,compress:n}){r.push({resource:i,content:s,compress:n,finish:o=>{yit(e,t,o)}})}function xIe(e,t,r){return typeof e=="string"?{url:t}:new Blob([JSON.stringify(e.toJSON(r))],{type:"application/json"})}async function mit(e){const t=(await re(()=>Promise.resolve().then(()=>vEe),void 0)).default,{data:r}=await t(e,{responseType:"blob"});return r}function git(e){return e==null?null:typeof e=="string"?e:e.url}function yit(e,t,r){typeof e[t]=="string"?e[t]=r.url:e[t].url=r.url}let Fq,ae=null;function TIe(){return!!ae}function _it(){return!!pe("esri-wasm")}function SIe(){return Fq||(Fq=re(()=>import("./pe-wasm.031781a0.js"),[]).then(e=>e.p).then(({default:e})=>e({locateFile:t=>ui(`esri/geometry/support/${t}`)})).then(e=>{CIe(e)}),Fq)}var Gee,Tn,Hee;(function(e){function t(n,o,a){ae.ensureCache.prepare();const l=e2(a),c=a===l,d=ae.ensureFloat64(l),p=ae._pe_geog_to_proj(ae.getPointer(n),o,d);return p&&yw(a,o,d,c),p}function r(n,o,a,l){switch(l){case Tn.PE_TRANSFORM_P_TO_G:return i(n,o,a);case Tn.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function i(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){ae.ensureCache.prepare();const c=e2(a),d=a===c,p=ae.ensureFloat64(c),f=ae._pe_proj_to_geog_center(ae.getPointer(n),o,p,l);return f&&yw(a,o,p,d),f}e.geogToProj=t,e.projGeog=r,e.projToGeog=i,e.projToGeogCenter=s})(Gee||(Gee={})),function(e){function t(){e.PE_BUFFER_MAX=ae.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=ae.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=ae.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=ae.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=ae.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=ae.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=ae.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=ae.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=ae.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=ae.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=ae.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=ae.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=ae.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=ae.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=ae.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=ae.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=ae.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=ae.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=ae.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=ae.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=ae.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=ae.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=ae.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=ae.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=ae.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=ae.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=ae.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=ae.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=ae.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=ae.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(Tn||(Tn={})),function(e){const t={},r={},i=m=>{if(m){const g=m.getType();switch(g){case Tn.PE_TYPE_GEOGCS:m=ae.castObject(m,ae.PeGeogcs);break;case Tn.PE_TYPE_PROJCS:m=ae.castObject(m,ae.PeProjcs);break;case Tn.PE_TYPE_GEOGTRAN:m=ae.castObject(m,ae.PeGeogtran);break;default:g&Tn.PE_TYPE_UNIT&&(m=ae.castObject(m,ae.PeUnit))}}return m};function s(){ae.PeFactory.prototype.initialize(null)}function n(m){return o(Tn.PE_TYPE_COORDSYS,m)}function o(m,g){let _=null,x=t[m];if(x||(x={},t[m]=x),x.hasOwnProperty(String(g)))_=x[g];else{const b=ae.PeFactory.prototype.factoryByType(m,g);ae.compare(b,ae.NULL)||(_=b,x[g]=_)}return _=i(_),_}function a(m,g){let _=null,x=r[m];if(x||(x={},r[m]=x),x.hasOwnProperty(g))_=x[g];else{const b=ae.PeFactory.prototype.fromString(m,g);ae.compare(b,ae.NULL)||(_=b,x[g]=_)}return _=i(_),_}function l(m){return o(Tn.PE_TYPE_GEOGCS,m)}function c(m){return o(Tn.PE_TYPE_GEOGTRAN,m)}function d(m){return ae.PeFactory.prototype.getCode(m)}function p(m){return o(Tn.PE_TYPE_PROJCS,m)}function f(m){return o(Tn.PE_TYPE_UNIT,m)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=d,e.projcs=p,e.unit=f}(Hee||(Hee={}));let EIe=null;var Hz,qee,Wee,Xee,qz,Yee,Wz,Xz,Zee;function CIe(e){function t(n,o,a){n[o]=a(n[o])}ae=e,Tn.init(),Hz.init(),qz.init(),Wz.init(),Xz.init(),EIe=class extends ae.PeGCSExtent{destroy(){ae.destroy(this)}};const r=[ae.PeDatum,ae.PeGeogcs,ae.PeGeogtran,ae.PeObject,ae.PeParameter,ae.PePrimem,ae.PeProjcs,ae.PeSpheroid,ae.PeUnit];for(const n of r)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(Tn.PE_NAME_MAX))});for(const n of[ae.PeGeogtran,ae.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(Tn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const d=ae.getValue(l,"*");a[c]=d?ae.wrapPointer(d,ae.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(ae.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return yw(a,o,n.call(this)),a}),t(ae.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=ae._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!ae.compare(l,ae.NULL)){a=[l];const c=this.getSteps();if(c>1){const d=ae.getPointer(l);for(let p=1;p<c;p++)a.push(ae.wrapPointer(d+o*p,ae.PeGTlistExtendedGTs))}}return a}});const i=ae._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!ae.compare(l,ae.NULL)){a=[l];const c=l.getNump();if(c>1){const d=ae.getPointer(l);for(let p=1;p<c;p++)a.push(ae.wrapPointer(d+i*p,ae.PeHorizon))}}return o.set(n,a),a};t(ae.PeProjcs.prototype,"horizonGcsGenerate",s),t(ae.PeProjcs.prototype,"horizonPcsGenerate",s),ae.PeObject.prototype.toString=function(n=Tn.PE_STR_OPTS_NONE){ae.ensureCache.prepare();const o=ae.getPointer(this),a=ae.ensureInt8(new Array(Tn.PE_BUFFER_MAX));return ae.UTF8ToString(ae._pe_object_to_string_ext(o,n,a))}}function Y0(e){if(!e)return;const t=ae.getClass(e);if(!t)return;const r=ae.getCache(t);if(!r)return;const i=ae.getPointer(e);i&&delete r[i]}function z5(e,t){const r=[],i=new Array(t);for(let s=0;s<e;s++)r.push(ae.ensureInt8(i));return r}function e2(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(r=>{t.push(r[0],r[1])})):t=e,t}function yw(e,t,r,i=!1){if(i)for(let s=0;s<2*t;s++)e[s]=ae.getValue(r+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=ae.getValue(r,"double"),e[n][1]=ae.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function r(){e.PE_GTLIST_OPTS_COMMON=ae.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=ae._pe_getPeGTlistExtendedEntrySize()}function i(s,n,o,a,l,c){let d=null;const p=new ae.PeInteger(c);try{const f=ae.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(d=[f],c>1)){const m=ae.getPointer(f);for(let g=1;g<c;g++)d.push(ae.wrapPointer(m+t*g,ae.PeGTlistExtendedEntry))}}finally{ae.destroy(p)}return d}e.init=r,e.getGTlist=i})(Hz||(Hz={})),function(e){function t(r){if(r&&r.length){for(const i of r)Y0(i),i.getEntries().forEach(s=>{Y0(s);const n=s.getGeogtran();Y0(n),n.getParameters().forEach(Y0),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Y0(o);const a=o.getDatum();Y0(a),Y0(a.getSpheroid()),Y0(o.getPrimem()),Y0(o.getUnit())})});ae.PeGTlistExtendedEntry.prototype.Delete(r[0])}}e.destroy=t}(qee||(qee={})),function(e){function t(r,i,s,n,o){ae.ensureCache.prepare();const a=e2(s),l=s===a,c=ae.ensureFloat64(a);let d=0;n&&(d=ae.ensureFloat64(n));const p=ae._pe_geog_to_geog(ae.getPointer(r),i,c,d,o);return p&&yw(s,i,c,l),p}e.geogToGeog=t}(Wee||(Wee={})),function(e){const t=(c,d,p,f,m,g)=>{let _,x;switch(ae.ensureCache.prepare(),c){case"dd":_=ae._pe_geog_to_dd,x=Tn.PE_DD_MAX;break;case"ddm":_=ae._pe_geog_to_ddm,x=Tn.PE_DDM_MAX;break;case"dms":_=ae._pe_geog_to_dms,x=Tn.PE_DMS_MAX}let b=0;d&&(b=ae.getPointer(d));const w=e2(f),T=ae.ensureFloat64(w),E=z5(p,x),O=_(b,p,T,m,ae.ensureInt32(E));if(O)for(let A=0;A<p;A++)g[A]=ae.UTF8ToString(E[A]);return O},r=(c,d,p,f,m)=>{let g;switch(ae.ensureCache.prepare(),c){case"dd":g=ae._pe_dd_to_geog;break;case"ddm":g=ae._pe_ddm_to_geog;break;case"dms":g=ae._pe_dms_to_geog}let _=0;d&&(_=ae.getPointer(d));const x=f.map(E=>ae.ensureString(E)),b=ae.ensureInt32(x),w=ae.ensureFloat64(new Array(2*p)),T=g(_,p,b,w);return T&&yw(m,p,w),T};function i(c,d,p,f,m){return t("dms",c,d,p,f,m)}function s(c,d,p,f){return r("dms",c,d,p,f)}function n(c,d,p,f,m){return t("ddm",c,d,p,f,m)}function o(c,d,p,f){return r("ddm",c,d,p,f)}function a(c,d,p,f,m){return t("dd",c,d,p,f,m)}function l(c,d,p,f){return r("dd",c,d,p,f)}e.geogToDms=i,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}(Xee||(Xee={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=ae.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=ae.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(s,n,o,a,l,c,d){ae.ensureCache.prepare();let p=0;s&&(p=ae.getPointer(s));const f=e2(o),m=ae.ensureFloat64(f),g=z5(n,Tn.PE_MGRS_MAX),_=ae.ensureInt32(g),x=ae._pe_geog_to_mgrs_extended(p,n,m,a,l,c,_);if(x)for(let b=0;b<n;b++)d[b]=ae.UTF8ToString(g[b]);return x}function i(s,n,o,a,l){ae.ensureCache.prepare();let c=0;s&&(c=ae.getPointer(s));const d=o.map(g=>ae.ensureString(g)),p=ae.ensureInt32(d),f=ae.ensureFloat64(new Array(2*n)),m=ae._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&yw(l,n,f),m}e.init=t,e.geogToMgrsExtended=r,e.mgrsToGeogExtended=i}(qz||(qz={})),function(e){function t(i,s,n,o,a,l,c){ae.ensureCache.prepare();let d=0;i&&(d=ae.getPointer(i));const p=e2(n),f=ae.ensureFloat64(p),m=z5(s,Tn.PE_MGRS_MAX),g=ae.ensureInt32(m),_=ae._pe_geog_to_usng(d,s,f,o,a,l,g);if(_)for(let x=0;x<s;x++)c[x]=ae.UTF8ToString(m[x]);return _}function r(i,s,n,o){ae.ensureCache.prepare();let a=0;i&&(a=ae.getPointer(i));const l=n.map(f=>ae.ensureString(f)),c=ae.ensureInt32(l),d=ae.ensureFloat64(new Array(2*s)),p=ae._pe_usng_to_geog(a,s,c,d);return p&&yw(o,s,d),p}e.geogToUsng=t,e.usngToGeog=r}(Yee||(Yee={})),function(e){function t(){e.PE_UTM_OPTS_NONE=ae.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=ae.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=ae.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(s,n,o,a,l){ae.ensureCache.prepare();let c=0;s&&(c=ae.getPointer(s));const d=e2(o),p=ae.ensureFloat64(d),f=z5(n,Tn.PE_UTM_MAX),m=ae.ensureInt32(f),g=ae._pe_geog_to_utm(c,n,p,a,m);if(g)for(let _=0;_<n;_++)l[_]=ae.UTF8ToString(f[_]);return g}function i(s,n,o,a,l){ae.ensureCache.prepare();let c=0;s&&(c=ae.getPointer(s));const d=o.map(g=>ae.ensureString(g)),p=ae.ensureInt32(d),f=ae.ensureFloat64(new Array(2*n)),m=ae._pe_utm_to_geog(c,n,p,a,f);return m&&yw(l,n,f),m}e.init=t,e.geogToUtm=r,e.utmToGeog=i}(Wz||(Wz={})),function(e){const t=new Map;function r(){e.PE_PCSINFO_OPTION_NONE=ae.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=ae.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=ae.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=ae.PePCSInfo.prototype.PE_POLE_POINT}function i(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=ae.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=r,e.generate=i}(Xz||(Xz={})),function(e){function t(){return ae.PeVersion.prototype.version_string()}e.versionString=t}(Zee||(Zee={}));const vit=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return ae},isLoaded:TIe,isSupported:_it,load:SIe,get PeCSTransformations(){return Gee},get PeDefs(){return Tn},get PeFactory(){return Hee},get PeGCSExtent(){return EIe},get PeGTlistExtended(){return Hz},get PeGTlistExtendedEntry(){return qee},get PeGTTransformations(){return Wee},get PeNotationDms(){return Xee},get PeNotationMgrs(){return qz},get PeNotationUsng(){return Yee},get PeNotationUtm(){return Wz},get PePCSInfo(){return Xz},get PeVersion(){return Zee},_init:CIe},Symbol.toStringTag,{value:"Module"})),D6t=Math.PI/180,L6t=/SPHEROID\[([^\]]+)]/i,D1=Pr.radius,Vf=Pr.eccentricitySquared,bit={a1:D1*Vf,a2:D1*Vf*D1*Vf,a3:D1*Vf*Vf/2,a4:D1*Vf*D1*Vf*2.5,a5:D1*Vf+D1*Vf*Vf/2,a6:1-Vf},N6t={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Pr.radius,f:Pr.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Vv.radius,f:Vv.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:n0.radius,f:n0.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:n0.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let V5=0;class LM{constructor(t){this.uid=V5++,t?(this._wkt=t.wkt!=null?t.wkt:null,this._wkid=t.wkid!=null?t.wkid:-1,this._isInverse=t.isInverse!=null&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(t){const r=new LM;return r._wkt=t.wkt,r._wkid=t.wkid,r._isInverse=t.isInverse,r}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=V5++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=V5++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=V5++}getInverse(){const t=new LM;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class kw{constructor(t){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const r of t.steps)r instanceof LM?this.steps.push(r):this.steps.push(new LM({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}static cacheKey(t,r){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(t){const r=new kw;let i="";for(const s of t.steps){const n=LM.fromGE(s);r.steps.push(n),i+=n.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}getInverse(){const t=new kw;t.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];t.steps.push(i.getInverse())}return t}getGTListEntry(){let t="";for(const r of this.steps)t+=r.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=t),this._gtlistentry}assignCachedGe(t,r,i){this._cachedProjection[kw.cacheKey(t,r)]=i}getCachedGeTransformation(t,r){let i="";for(const n of this.steps)i+=n.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const s=this._cachedProjection[kw.cacheKey(t,r)];return s===void 0?null:s}}let ax=null,vN=null,kq=null,Uq={};const AIe=new Hne;function aae(){return!!ax&&TIe()}function Yz(e){return C(kq)&&(kq=Promise.all([SIe(),re(()=>import("./geometryEngineBase.82b25ca5.js"),[]).then(t=>t.g),re(()=>import("./hydrated.11ec29fd.js"),[])])),kq.then(([,t,{hydratedAdapter:r}])=>{Ir(e),vN=r,ax=t.default,ax._enableProjection(vit),AIe.notify()})}function cC(e,t,r=null,i=null){return Array.isArray(e)?e.length===0?[]:wme(vN,e,e[0].spatialReference,t,r,i):wme(vN,[e],e.spatialReference,t,r,i)[0]}function wme(e,t,r,i,s=null,n=null){if(C(r)||C(i))return t;if(Xv(r,i,s))return t.map(o=>MIe(o,r,i));if(C(s)){const o=kw.cacheKey(r,i);Uq[o]!==void 0?s=Uq[o]:(s=xit(r,i,void 0),C(s)&&(s=new kw),Uq[o]=s)}if(C(ax)||C(e))throw new lae;return v(n)?ax._project(e,t,r,i,s,n):ax._project(e,t,r,i,s)}function F6t(e,t){const r=wit([e],t);return v(r.pending)?{pending:r.pending,geometry:null}:v(r.geometries)?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function wit(e,t){if(!aae()){for(const r of e)if(v(r)&&!ml(r.spatialReference,t)&&Ll(r.spatialReference)&&Ll(t)&&!Xv(r.spatialReference,t))return Rr(AIe),{pending:Yz(),geometries:null}}return{pending:null,geometries:e.map(r=>C(r)?null:ml(r.spatialReference,t)?r:Ll(r.spatialReference)&&Ll(t)?Tit(r,t):null)}}function xit(e,t,r=null){if(C(e)||C(t))return null;if(C(ax)||C(vN))throw new lae;const i=ax._getTransformation(vN,e,t,r,r==null?void 0:r.spatialReference);return i!==null?kw.fromGE(i):null}class lae extends z{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var Q;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(Q||(Q={}));function Tit(e,t){try{const r=cC(e,t);if(r==null)return null;"xmin"in e&&"xmin"in r&&(r.zmin=e.zmin,r.zmax=e.zmax);const i=$Re(r.type,e.spatialReference,t);return v(i)&&i(r),r}catch(r){if(!(r instanceof lae))throw r;return null}}function Xv(e,t,r){return!r&&(!!ml(e,t)||Ll(e)&&Ll(t)&&!!hae(e,t,fae))}async function OIe(e,t,r,i){if(aae())return Qde(i);if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!Xv(s,n,o))return Yz(i)}else if(!Xv(e,t,r))return Yz(i);return Qde(i)}function k6t(e,t){switch(hae(e,t,fae)){case ls:return"copy3";case Bw:return"wgs84ToSphericalECEF";case bE:return"wgs84ToWebMercator";case Uw:return"wgs84ToPlateCarree";case Vw:return"wgs84ToWGS84ECEF";case k2:return"webMercatorToWGS84";case LIe:return"webMercatorToSphericalECEF";case NIe:return"webMercatorToWGS84ECEF";case FIe:return"webMercatorToPlateCarree";case jw:return"wgs84ECEFToWGS84";case BIe:return"wgs84ECEFToSphericalECEF";case zIe:return"wgs84ECEFToWebMercator";case zw:return"sphericalECEFToWGS84";case kIe:return"sphericalECEFToWebMercator";case ete:return"sphericalMarsPCPFToMars2000";case Qee:return"sphericalMoonPCPFToMoon2000";case UIe:return"sphericalECEFToWGS84ECEF";case Kee:return"mars2000ToSphericalPCPF";case Jee:return"moon2000ToSphericalPCPF";default:return null}}function MIe(e,t,r){return e?"x"in e?RIe(e,t,new lt,r,0):"xmin"in e?Oit(e,t,new Sr,r,0):"rings"in e?IIe(e,t,new kl,r,0):"paths"in e?Cit(e,t,new ja,r,0):"points"in e?Eit(e,t,new CI,r,0):null:null}function Sit(e,t,r=t.spatialReference,i=0){return v(r)&&v(e.spatialReference)&&v(RIe(e,e.spatialReference,t,r,i))}function RIe(e,t,r,i,s){wi[0]=e.x,wi[1]=e.y;const n=e.z;return wi[2]=n!==void 0?n:s,Yi(wi,t,0,wi,i,0,1)?(r.x=wi[0],r.y=wi[1],r.spatialReference=i,n===void 0?(r.z=void 0,r.hasZ=!1):(r.z=wi[2],r.hasZ=!0),e.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=e.m,r.hasM=!0),r):null}function Eit(e,t,r,i,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,d=[];for(const p of n)d.push(p[0],p[1],o?p[2]:s);if(!Yi(d,t,0,d,i,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=d[f],g=d[f+1];o&&a?l.push([m,g,d[f+2],n[p][3]]):o?l.push([m,g,d[f+2]]):a?l.push([m,g,n[p][2]]):l.push([m,g])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function Cit(e,t,r,i,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return $Ie(n,o!=null?o:!1,a!=null?a:!1,t,l,i,s)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function Ait(e,t,r=t.spatialReference,i=0){return v(e.spatialReference)&&v(r)&&v(IIe(e,e.spatialReference,t,r,i))}function IIe(e,t,r,i,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return $Ie(n,o!=null?o:!1,a!=null?a:!1,t,l,i,s)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function Oit(e,t,r,i,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:d}=e;return xme(n,o,c?e.zmin:s,t,wi,i)?(r.xmin=wi[0],r.ymin=wi[1],c&&(r.zmin=wi[2]),xme(a,l,c?e.zmax:s,t,wi,i)?(r.xmax=wi[0],r.ymax=wi[1],c&&(r.zmax=wi[2]),d&&(r.mmin=e.mmin,r.mmax=e.mmax),r.spatialReference=i,r):null):null}function Cx(e,t,r){if(C(t)||C(r))return null;const i=new lt({spatialReference:r});return Yi(e,t,0,wi,r,0,1)?(i.x=wi[0],i.y=wi[1],i.z=wi[2],i):null}function PIe(e,t,r){return Yi(e,t,0,wi,r.spatialReference,0,1)?(r.x=wi[0],r.y=wi[1],r.z=wi[2],r):null}function fa(e,t,r,i=0){wi[0]=e.x,wi[1]=e.y;const s=e.z;return wi[2]=s!==void 0?s:i,Yi(wi,e.spatialReference,0,t,r,0,1)}function xme(e,t,r,i,s,n){return Js[0]=e,Js[1]=t,Js[2]=r,Yi(Js,i,0,s,n,0,1)}function So(e,t,r,i){return!(C(t)||C(i)||e.length<2)&&(e.length===2&&(Js[0]=e[0],Js[1]=e[1],Js[2]=0,e=Js),Yi(e,t,0,r,i,0,1))}function Mit(e,t){wi[0]=e.x,wi[1]=e.y;const r=e.z;return wi[2]=r!==void 0?r:0,Rit(wi,e.spatialReference,t)}function Rit(e,t,r){return Iit(e,t,r)}function Iit(e,t,r){if(C(t))return!1;const i=Ax(t,zj),s=Yy[i][Q.WGS84_COMPARABLE_LON_LAT];return!C(s)&&(s(e,0,Js,0),r!==Js&&(r[0]=Js[0],r[1]=Js[1],r.length>2&&(r[2]=Js[2])),!0)}function Yi(e,t,r,i,s,n,o=1){const a=hae(t,s,fae);if(C(a))return!1;if(a===ls){if(e===i&&r===n)return!0;const c=r+3*o;for(let d=r,p=n;d<c;d++,p++)i[p]=e[d];return!0}const l=r+3*o;for(let c=r,d=n;c<l;c+=3,d+=3)a(e,c,i,d);return!0}function U6t(e,t,r,i,s){le(wi,e),ye(j5,e,t),So(wi,r,wi,s),So(j5,r,j5,s),ge(i,j5,wi),xe(i,i)}function $Ie(e,t,r,i,s,n,o=0){const a=new Array;for(const c of e)for(const d of c)a.push(d[0],d[1],t?d[2]:o);if(!Yi(a,i,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const d=new Array;for(const p of c)t&&r?d.push([a[l++],a[l++],a[l++],p[3]]):t?d.push([a[l++],a[l++],a[l++]]):r?(d.push([a[l++],a[l++],p[2]]),l++):(d.push([a[l++],a[l++]]),l++);s.push(d)}return!0}function B6t(e,t,r,i){var a,l;if(C(t)||C(i))return!1;const s=VIe(t,i,Uit);if(s.projector===ls)return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],!0;if(C(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===Q.WEB_MERCATOR){const c=Yy[n.spatialReferenceId][Q.WGS84];return!C(c)&&(c(e,0,Cm,0),bE(Cm,0,r,0),r[3]=Tme(Cm[1],e[2],e[3],Pr.radius),!0)}if(n.spatialReferenceId!==Q.WGS84&&n.spatialReferenceId!==Q.CGCS2000||o.spatialReferenceId!==Q.PLATE_CARREE){s.projector(e,0,r,0);const c=(a=n.metersPerUnit)!=null?a:1,d=(l=o.metersPerUnit)!=null?l:1;r[3]=e[3]*c/d}else{const c=Yy[n.spatialReferenceId][Q.SPHERICAL_ECEF],d=Yy[Q.SPHERICAL_ECEF][Q.PLATE_CARREE];let p=e[3];v(c)&&v(d)&&(p=Tme(e[1],e[2],e[3],Pr.radius)),s.projector(e,0,r,0),r[3]=p}return!0}function Tme(e,t,r,i){const s=i+t;if(s<i/2||r>s)return Number.MAX_VALUE;const n=Math.abs(qm*e)+Math.asin(r/s);return n>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(n)}function Bj(e,t,r,i){return e!=null&&(ml(t,i)?(qv(r,e),!0):(Js[0]=e[0],Js[1]=e[1],Js[2]=0,!!Yi(Js,t,0,Js,i,0,1)&&(r[0]=Js[0],r[1]=Js[1],Js[0]=e[2],Js[1]=e[3],Js[2]=0,!!Yi(Js,t,0,Js,i,0,1)&&(r[2]=Js[0],r[3]=Js[1],!0))))}function z6t(e,t,r,i){if(C(t)||C(i))return!1;const s=Ax(t,zj),n=Ax(i,jIe);if(s===n&&s!==Q.UNKNOWN||ml(t,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(s===Q.SPHERICAL_ECEF){const o=Ie(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/Pr.radius;if(n===Q.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(n===Q.WGS84||n===Q.CGCS2000){const c=jD;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(s===Q.PLATE_CARREE){if(n===Q.WGS84||n===Q.CGCS2000)return r[0]=jD,r[1]=jD,r[2]=1,!0;if(n===Q.WEB_MERCATOR){const o=e[1]/Pr.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function Qh(e,t,r,i){if(C(e)||C(i))return!1;const s=Ax(e,zj),n=Ax(i,jIe);if(s===n&&!Sme(n)&&(s!==Q.UNKNOWN||ml(e,i)))return Rj(r,t),!0;if(Sme(n)){const o=Yy[s][Q.LON_LAT],a=Yy[Q.LON_LAT][n];return!C(o)&&!C(a)&&(o(t,0,Cm,0),a(Cm,0,L1,0),DIe(qm*Cm[0],qm*Cm[1],r),r[12]=L1[0],r[13]=L1[1],r[14]=L1[2],!0)}if((n===Q.WEB_MERCATOR||n===Q.PLATE_CARREE)&&(s===Q.WGS84||s===Q.CGCS2000&&n===Q.PLATE_CARREE||s===Q.SPHERICAL_ECEF||s===Q.WEB_MERCATOR)){const o=Yy[s][Q.LON_LAT],a=Yy[Q.LON_LAT][n];return!C(o)&&!C(a)&&(o(t,0,Cm,0),a(Cm,0,L1,0),s===Q.SPHERICAL_ECEF?Pit(qm*Cm[0],qm*Cm[1],r):fg(r),r[12]=L1[0],r[13]=L1[1],r[14]=L1[2],!0)}return!1}function Sme(e){return e===Q.SPHERICAL_ECEF||e===Q.SPHERICAL_MARS_PCPF||e===Q.SPHERICAL_MOON_PCPF}function DIe(e,t,r){const i=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=r;return a[0]=-i,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Pit(e,t,r){return DIe(e,t,r),Iu(r,r),r}function Ax(e,t){return e?t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=Fc(e,1)),e.wkt===dMe.wkt?t.spatialReferenceId=Q.SPHERICAL_ECEF:tN(e)?t.spatialReferenceId=Q.WGS84:oE(e)?t.spatialReferenceId=Q.WEB_MERCATOR:rN(e)?t.spatialReferenceId=Q.PLATE_CARREE:e.wkt===vJe.wkt?t.spatialReferenceId=Q.WGS84_ECEF:e.wkid===tf.CGCS2000?t.spatialReferenceId=Q.CGCS2000:e.wkt===Fz.wkt?t.spatialReferenceId=Q.SPHERICAL_MARS_PCPF:e.wkt===kz.wkt?t.spatialReferenceId=Q.SPHERICAL_MOON_PCPF:I0(e)?t.spatialReferenceId=Q.GCSMARS2000:P0(e)?t.spatialReferenceId=Q.GCSMOON2000:t.spatialReferenceId=Q.UNKNOWN):Q.UNKNOWN}function ls(e,t,r,i){e!==r&&(r[i++]=e[t++],r[i++]=e[t++],r[i]=e[t])}function k2(e,t,r,i){r[i++]=LR*(e[t++]/Pr.radius),r[i++]=LR*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/Pr.radius))),r[i]=e[t]}function LIe(e,t,r,i){k2(e,t,r,i),Bw(r,i,r,i)}function NIe(e,t,r,i){k2(e,t,r,i),Vw(r,i,r,i)}function cae(e,t,r,i,s){const n=.4999999*Math.PI,o=_e(qm*e[t+1],-n,n),a=Math.sin(o);r[i++]=qm*e[t]*s.radius,r[i++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=e[t+2]}function bE(e,t,r,i){cae(e,t,r,i,Pr)}const Eme=Pr.radius*Math.PI/180,jD=180/(Pr.radius*Math.PI);function Uw(e,t,r,i){r[i]=e[t]*Eme,r[i+1]=e[t+1]*Eme,r[i+2]=e[t+2]}function g2(e,t,r,i){r[i]=e[t]*jD,r[i+1]=e[t+1]*jD,r[i+2]=e[t+2]}function FIe(e,t,r,i){k2(e,t,r,i),Uw(r,i,r,i)}function $it(e,t,r,i){jw(e,t,r,i),Uw(r,i,r,i)}function Dit(e,t,r,i){zw(e,t,r,i),Uw(r,i,r,i)}function Lit(e,t,r,i){g2(e,t,r,i),Bw(r,i,r,i)}function Nit(e,t,r,i){g2(e,t,r,i),bE(r,i,r,i)}function Fit(e,t,r,i){g2(e,t,r,i),Vw(r,i,r,i)}function wE(e){if(C(e))return!1;const t=Ax(e,zj);return!!Yy[t][Q.WGS84_COMPARABLE_LON_LAT]}function bP(e,t,r,i){const s=Math.cos(r);e[0]=Math.cos(t)*s*i,e[1]=Math.sin(t)*s*i,e[2]=Math.sin(r)*i}function uae(e,t,r,i,s){const n=s+e[t+2],o=qm*e[t+1],a=qm*e[t],l=Math.cos(o);r[i++]=Math.cos(a)*l*n,r[i++]=Math.sin(a)*l*n,r[i]=Math.sin(o)*n}function Jee(e,t,r,i){uae(e,t,r,i,Vv.radius)}function Kee(e,t,r,i){uae(e,t,r,i,n0.radius)}function Bw(e,t,r,i){uae(e,t,r,i,Pr.radius)}function dae(e,t,r,i,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=vf(a/(l===0?1:l)),d=Math.atan2(o,n);r[i++]=LR*d,r[i++]=LR*c,r[i]=l-s}function Qee(e,t,r,i){dae(e,t,r,i,Vv.radius)}function ete(e,t,r,i){dae(e,t,r,i,n0.radius)}function zw(e,t,r,i){dae(e,t,r,i,Pr.radius)}function kIe(e,t,r,i){zw(e,t,r,i),bE(r,i,r,i)}function UIe(e,t,r,i){zw(e,t,r,i),Vw(r,i,r,i)}function kit(e,t,r,i,s){const n=qm*e[t],o=qm*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),d=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);r[i++]=(d+a)*c*Math.cos(n),r[i++]=(d+a)*c*Math.sin(n),r[i++]=(d*(1-s.eccentricitySquared)+a)*l}function Vw(e,t,r,i){kit(e,t,r,i,Pr)}function jw(e,t,r,i){const s=bit,n=e[t],o=e[t+1],a=e[t+2];let l,c,d,p,f,m,g,_,x,b,w,T,E,O,A,R,D,k,L,q,G;l=Math.abs(a),c=n*n+o*o,d=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),q=Math.atan2(o,n),m=a*a/p,g=c/p,O=s.a2/f,A=s.a3-s.a4/f,g>.3?(_=l/f*(1+g*(s.a1+O+m*A)/f),L=Math.asin(_),b=_*_,x=Math.sqrt(1-b)):(x=d/f*(1-m*(s.a5-O-g*A)/f),L=Math.acos(x),b=1-x*x,_=Math.sqrt(b)),w=1-Pr.eccentricitySquared*b,T=Pr.radius/Math.sqrt(w),E=s.a6*T,O=d-T*x,A=l-E*_,D=x*O+_*A,R=x*A-_*O,k=R/(E/w+D),L+=k,G=D+R*k/2,a<0&&(L=-L),r[i++]=LR*q,r[i++]=LR*L,r[i]=G}function BIe(e,t,r,i){jw(e,t,r,i),Bw(r,i,r,i)}function zIe(e,t,r,i){jw(e,t,r,i),bE(r,i,r,i)}const Yy={[Q.WGS84]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:ls,[Q.WGS84_COMPARABLE_LON_LAT]:ls,[Q.SPHERICAL_ECEF]:Bw,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:bE,[Q.PLATE_CARREE]:Uw,[Q.WGS84]:ls,[Q.WGS84_ECEF]:Vw},[Q.CGCS2000]:{[Q.CGCS2000]:ls,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:ls,[Q.WGS84_COMPARABLE_LON_LAT]:ls,[Q.SPHERICAL_ECEF]:Bw,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:Uw,[Q.WGS84]:null,[Q.WGS84_ECEF]:Vw},[Q.GCSMARS2000]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:ls,[Q.GCSMOON2000]:null,[Q.LON_LAT]:ls,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:Kee,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.GCSMOON2000]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:ls,[Q.LON_LAT]:ls,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:Jee,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.WEB_MERCATOR]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:k2,[Q.WGS84_COMPARABLE_LON_LAT]:k2,[Q.SPHERICAL_ECEF]:LIe,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:ls,[Q.PLATE_CARREE]:FIe,[Q.WGS84]:k2,[Q.WGS84_ECEF]:NIe},[Q.WGS84_ECEF]:{[Q.CGCS2000]:jw,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:jw,[Q.WGS84_COMPARABLE_LON_LAT]:jw,[Q.SPHERICAL_ECEF]:BIe,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:zIe,[Q.PLATE_CARREE]:$it,[Q.WGS84]:jw,[Q.WGS84_ECEF]:ls},[Q.SPHERICAL_ECEF]:{[Q.CGCS2000]:zw,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:zw,[Q.WGS84_COMPARABLE_LON_LAT]:zw,[Q.SPHERICAL_ECEF]:ls,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:kIe,[Q.PLATE_CARREE]:Dit,[Q.WGS84]:zw,[Q.WGS84_ECEF]:UIe},[Q.SPHERICAL_MARS_PCPF]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:ete,[Q.GCSMOON2000]:null,[Q.LON_LAT]:ete,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:ls,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.SPHERICAL_MOON_PCPF]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:Qee,[Q.LON_LAT]:Qee,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:ls,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.UNKNOWN]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:null,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:ls,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.LON_LAT]:{[Q.CGCS2000]:ls,[Q.GCSMARS2000]:ls,[Q.GCSMOON2000]:ls,[Q.LON_LAT]:ls,[Q.WGS84_COMPARABLE_LON_LAT]:ls,[Q.SPHERICAL_ECEF]:Bw,[Q.SPHERICAL_MARS_PCPF]:Kee,[Q.SPHERICAL_MOON_PCPF]:Jee,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:bE,[Q.PLATE_CARREE]:Uw,[Q.WGS84]:ls,[Q.WGS84_ECEF]:Vw},[Q.WGS84_COMPARABLE_LON_LAT]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:ls,[Q.WGS84_COMPARABLE_LON_LAT]:ls,[Q.SPHERICAL_ECEF]:Bw,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:Uw,[Q.WGS84]:ls,[Q.WGS84_ECEF]:Vw},[Q.PLATE_CARREE]:{[Q.CGCS2000]:g2,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:g2,[Q.WGS84_COMPARABLE_LON_LAT]:g2,[Q.SPHERICAL_ECEF]:Lit,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:Nit,[Q.PLATE_CARREE]:ls,[Q.WGS84]:g2,[Q.WGS84_ECEF]:Fit}};function hae(e,t,r=pae()){return C(e)||C(t)?null:VIe(e,t,r).projector}function VIe(e,t,r){if(C(e)||C(t)||r.source.spatialReference===e&&r.dest.spatialReference===t)return r;const i=Ax(e,r.source),s=Ax(t,r.dest);return i===Q.UNKNOWN&&s===Q.UNKNOWN?ml(e,t)?r.projector=ls:r.projector=null:r.projector=Yy[i][s],r}function pae(){return{source:{spatialReference:null,spatialReferenceId:Q.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:Q.UNKNOWN,metersPerUnit:1},projector:ls}}const zj={spatialReference:null,spatialReferenceId:Q.UNKNOWN},jIe={spatialReference:null,spatialReferenceId:Q.UNKNOWN},fae=pae(),Uit=pae(),qm=Zt(1),LR=Lc(1),Js=$(),Cm=$(),L1=$(),wi=$(),j5=$();var vB;let tte=vB=class extends xI(Ge.ofType(kl)){constructor(e){super(e)}clone(){return new vB(this.items.map(e=>e.clone()))}write(e,t){return this.toJSON(t)}toJSON(e){var r;const t=(r=e==null?void 0:e.layer)==null?void 0:r.spatialReference;return t?this.toArray().map(i=>{if(!t.equals(i.spatialReference)){if(!Xv(i.spatialReference,t))return e&&e.messages&&e.messages.push(new Ou("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const n=new kl;Ait(i,n,t),i=n}const s=i.toJSON(e);return delete s.spatialReference,s}).filter(i=>i!=null):(e!=null&&e.messages&&e.messages.push(new Ou("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map(i=>i.toJSON(e)))}static fromJSON(e,t){const r=new vB;return e.forEach(i=>r.add(kl.fromJSON(i,t))),r}};tte=vB=u([I("esri.layers.support.PolygonCollection")],tte);const rte=tte;var ite;let rO=ite=class extends fe{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new rte,this._geometriesSource=null,this._handles=new hr}initialize(){this._handles.add(ms(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,bi))}destroy(){this._handles.destroy()}readGeometries(e,t,r){this._geometriesSource={url:iC(e,r),context:r}}async loadGeometries(e,t){if(C(this._geometriesSource))return;const{url:r,context:i}=this._geometriesSource,s=await lr(r,{responseType:"json",signal:Ks(t,"signal")}),n=e.toJSON(),o=s.data.map(a=>({...a,spatialReference:n}));this.geometries=rte.fromJSON(o,i),this._geometriesSource=null}clone(){return new ite({geometries:ne(this.geometries),spatialRelationship:this.spatialRelationship})}};u([h({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],rO.prototype,"spatialRelationship",void 0),u([h({type:rte,nonNullable:!0,json:{write:!0}}),uit({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],rO.prototype,"geometries",void 0),u([me(["web-scene","portal-item"],"geometries")],rO.prototype,"readGeometries",null),rO=ite=u([I("esri.layers.support.SceneFilter")],rO);const Bit=rO;function Tf(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function zit(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function mae(e,t,r,i,s,n,o,a,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function gae(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Sf(e,t){if(e===t){const r=t[1],i=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function uC(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],d=t[8],p=d*o-a*c,f=-d*n+a*l,m=c*n-o*l;let g=r*p+i*f+s*m;return g?(g=1/g,e[0]=p*g,e[1]=(-d*i+s*c)*g,e[2]=(a*i-s*o)*g,e[3]=f*g,e[4]=(d*r-s*l)*g,e[5]=(-a*r+s*n)*g,e[6]=m*g,e[7]=(-c*r+i*l)*g,e[8]=(o*r-i*n)*g,e):null}function Vit(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],d=t[8];return e[0]=o*d-a*c,e[1]=s*c-i*d,e[2]=i*a-s*o,e[3]=a*l-n*d,e[4]=r*d-s*l,e[5]=s*n-r*a,e[6]=n*c-o*l,e[7]=i*l-r*c,e[8]=r*o-i*n,e}function jit(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+r*(-c*s+o*a)+i*(l*s-n*a)}function NR(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],d=t[7],p=t[8],f=r[0],m=r[1],g=r[2],_=r[3],x=r[4],b=r[5],w=r[6],T=r[7],E=r[8];return e[0]=f*i+m*o+g*c,e[1]=f*s+m*a+g*d,e[2]=f*n+m*l+g*p,e[3]=_*i+x*o+b*c,e[4]=_*s+x*a+b*d,e[5]=_*n+x*l+b*p,e[6]=w*i+T*o+E*c,e[7]=w*s+T*a+E*d,e[8]=w*n+T*l+E*p,e}function Zz(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],d=t[7],p=t[8],f=r[0],m=r[1];return e[0]=i,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=f*i+m*o+c,e[7]=f*s+m*a+d,e[8]=f*n+m*l+p,e}function yae(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],d=t[7],p=t[8],f=Math.sin(r),m=Math.cos(r);return e[0]=m*i+f*o,e[1]=m*s+f*a,e[2]=m*n+f*l,e[3]=m*o-f*i,e[4]=m*a-f*s,e[5]=m*l-f*n,e[6]=c,e[7]=d,e[8]=p,e}function _ae(e,t,r){const i=r[0],s=r[1],n=r[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function Git(e,t,r){const i=r[0],s=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function Hit(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function qit(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Wit(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Xit(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Vj(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r+r,a=i+i,l=s+s,c=r*o,d=i*o,p=i*a,f=s*o,m=s*a,g=s*l,_=n*o,x=n*a,b=n*l;return e[0]=1-p-g,e[3]=d-b,e[6]=f+x,e[1]=d+b,e[4]=1-c-g,e[7]=m-_,e[2]=f-x,e[5]=m+_,e[8]=1-c-p,e}function GIe(e,t){const r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],d=t[10],p=d*o-a*c,f=-d*n+a*l,m=c*n-o*l,g=r*p+i*f+s*m;if(!g)return null;const _=1/g;return e[0]=p*_,e[1]=(-d*i+s*c)*_,e[2]=(a*i-s*o)*_,e[3]=f*_,e[4]=(d*r-s*l)*_,e[5]=(-a*r+s*n)*_,e[6]=m*_,e[7]=(-c*r+i*l)*_,e[8]=(o*r-i*n)*_,e}function FR(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],d=t[8],p=t[9],f=t[10],m=t[11],g=t[12],_=t[13],x=t[14],b=t[15],w=r*a-i*o,T=r*l-s*o,E=r*c-n*o,O=i*l-s*a,A=i*c-n*a,R=s*c-n*l,D=d*_-p*g,k=d*x-f*g,L=d*b-m*g,q=p*x-f*_,G=p*b-m*_,J=f*b-m*x;let ee=w*J-T*G+E*q+O*L-A*k+R*D;return ee?(ee=1/ee,e[0]=(a*J-l*G+c*q)*ee,e[1]=(l*L-o*J-c*k)*ee,e[2]=(o*G-a*L+c*D)*ee,e[3]=(s*G-i*J-n*q)*ee,e[4]=(r*J-s*L+n*k)*ee,e[5]=(i*L-r*G-n*D)*ee,e[6]=(_*R-x*A+b*O)*ee,e[7]=(x*E-g*R-b*T)*ee,e[8]=(g*A-_*E+b*w)*ee,e):null}function Yit(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Zit(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Jit(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function Kit(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function HIe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function Qit(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function est(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function tst(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function rst(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],d=e[8],p=t[0],f=t[1],m=t[2],g=t[3],_=t[4],x=t[5],b=t[6],w=t[7],T=t[8],E=Xl();return Math.abs(r-p)<=E*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-f)<=E*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-m)<=E*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-g)<=E*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(o-_)<=E*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-x)<=E*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(l-b)<=E*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=E*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(d-T)<=E*Math.max(1,Math.abs(d),Math.abs(T))}function vae(e){const t=Xl(),r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],d=e[8];return Math.abs(1-(r*r+n*n+l*l))<=t&&Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+d*d))<=t}const ist=NR,sst=HIe;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:Tf,copy:zit,set:mae,identity:gae,transpose:Sf,invert:uC,adjoint:Vit,determinant:jit,multiply:NR,translate:Zz,rotate:yae,scale:_ae,scaleByVec2:Git,fromTranslation:Hit,fromRotation:qit,fromScaling:Wit,fromMat2d:Xit,fromQuat:Vj,normalFromMat4Legacy:GIe,normalFromMat4:FR,projection:Yit,str:Zit,frob:Jit,add:Kit,subtract:HIe,multiplyScalar:Qit,multiplyScalarAndAdd:est,exactEquals:tst,equals:rst,isOrthoNormal:vae,mul:ist,sub:sst},Symbol.toStringTag,{value:"Module"}));function Ts(){return[1,0,0,0,1,0,0,0,1]}function nst(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function ost(e,t,r,i,s,n,o,a,l){return[e,t,r,i,s,n,o,a,l]}function qIe(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:Ts,clone:nst,fromValues:ost,createView:qIe},Symbol.toStringTag,{value:"Module"}));function $e(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function U2(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function bae(e,t,r,i,s,n,o,a,l,c,d,p,f,m,g,_){return[e,t,r,i,s,n,o,a,l,c,d,p,f,m,g,_]}function WIe(e,t){return new Float64Array(e,t,16)}const Hn=$e();Object.freeze(Object.defineProperty({__proto__:null,create:$e,clone:U2,fromValues:bae,createView:WIe,IDENTITY:Hn},Symbol.toStringTag,{value:"Module"}));function wg(){return[0,0,0,1]}function ast(e){return[e[0],e[1],e[2],e[3]]}function lst(e,t,r,i){return[e,t,r,i]}function XIe(e,t){return new Float64Array(e,t,4)}const cst=wg();Object.freeze(Object.defineProperty({__proto__:null,create:wg,clone:ast,fromValues:lst,createView:XIe,IDENTITY:cst},Symbol.toStringTag,{value:"Module"}));function ust(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Jz(e,t,r){r*=.5;const i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function wae(e,t){const r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>Xl()?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function jj(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1],c=r[2],d=r[3];return e[0]=i*d+o*a+s*c-n*l,e[1]=s*d+o*l+n*a-i*c,e[2]=n*d+o*c+i*l-s*a,e[3]=o*d-i*a-s*l-n*c,e}function dst(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-i*a,e}function hst(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-n*a,e[1]=s*l+o*a,e[2]=n*l+i*a,e[3]=o*l-s*a,e}function pst(e,t,r){r*=.5;const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*a,e[1]=s*l-i*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function fst(e,t){const r=t[0],i=t[1],s=t[2];return e[0]=r,e[1]=i,e[2]=s,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s)),e}function bB(e,t,r,i){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,d,p,f,m=r[0],g=r[1],_=r[2],x=r[3];return c=s*m+n*g+o*_+a*x,c<0&&(c=-c,m=-m,g=-g,_=-_,x=-x),1-c>Xl()?(l=Math.acos(c),d=Math.sin(l),p=Math.sin((1-i)*l)/d,f=Math.sin(i*l)/d):(p=1-i,f=i),e[0]=p*s+f*m,e[1]=p*n+f*g,e[2]=p*o+f*_,e[3]=p*a+f*x,e}function mst(e){const t=LF,r=t(),i=t(),s=t(),n=Math.sqrt(1-r),o=Math.sqrt(r);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=o*Math.sin(2*Math.PI*s),e[3]=o*Math.cos(2*Math.PI*s),e}function gst(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-s*a,e[3]=n*a,e}function Yv(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function YIe(e,t){const r=t[0]+t[4]+t[8];let i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;i=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*i,i=.5/i,e[3]=(t[3*n+o]-t[3*o+n])*i,e[n]=(t[3*n+s]+t[3*s+n])*i,e[o]=(t[3*o+s]+t[3*s+o])*i}return e}function yst(e,t,r,i){const s=.5*Math.PI/180;t*=s,r*=s,i*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),d=Math.cos(i);return e[0]=n*l*d-o*a*c,e[1]=o*a*d+n*l*c,e[2]=o*l*c-n*a*d,e[3]=o*l*d+n*a*c,e}function _st(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const t4=jm,vst=Oi,bst=Ane,wst=jj,xst=NF,Tst=PCe,Sst=K9,ZIe=One,Est=ZIe,JIe=Mne,Cst=JIe,xae=ICe,Ast=QL,Ost=$Ce;function Mst(e,t,r){const i=Te(t,r);return i<-.999999?(At(Rg,Rst,t),Em(Rg)<1e-6&&At(Rg,Ist,t),xe(Rg,Rg),Jz(e,Rg,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(At(Rg,t,r),e[0]=Rg[0],e[1]=Rg[1],e[2]=Rg[2],e[3]=1+i,xae(e,e))}const Rg=$(),Rst=Fe(1,0,0),Ist=Fe(0,1,0);function Pst(e,t,r,i,s,n){return bB(Cme,t,s,n),bB(Ame,r,i,n),bB(e,Cme,Ame,2*n*(1-n)),e}const Cme=wg(),Ame=wg();function $st(e,t,r,i){const s=Dst;return s[0]=r[0],s[3]=r[1],s[6]=r[2],s[1]=i[0],s[4]=i[1],s[7]=i[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],xae(e,YIe(e,s))}const Dst=Ts();Object.freeze(Object.defineProperty({__proto__:null,identity:ust,setAxisAngle:Jz,getAxisAngle:wae,multiply:jj,rotateX:dst,rotateY:hst,rotateZ:pst,calculateW:fst,slerp:bB,random:mst,invert:gst,conjugate:Yv,fromMat3:YIe,fromEuler:yst,str:_st,copy:t4,set:vst,add:bst,mul:wst,scale:xst,dot:Tst,lerp:Sst,length:ZIe,len:Est,squaredLength:JIe,sqrLen:Cst,normalize:xae,exactEquals:Ast,equals:Ost,rotationTo:Mst,sqlerp:Pst,setAxes:$st},Symbol.toStringTag,{value:"Module"}));function KIe(){const e=new Float32Array(4);return e[3]=1,e}function QIe(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Lst(e,t,r,i){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function ePe(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:KIe,clone:QIe,fromValues:Lst,createView:ePe},Symbol.toStringTag,{value:"Module"}));var Ye;function Ome(e){return e==="global"?Ye.Global:Ye.Local}function Bq(e){return e===Ye.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(Ye||(Ye={}));const Sn=!0,y2={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function Tae(e,t,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,r+y2.identifierOffset,y2.identifierLength)),version:t.getUint16(r+y2.versionOffset,Sn),checksum:t.getUint32(r+y2.checksumOffset,Sn)}}const Ju={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function Nst(e,t){return{sizeLo:e.getUint32(t+Ju.sizeLo,Sn),sizeHi:e.getUint32(t+Ju.sizeHi,Sn),minX:e.getFloat64(t+Ju.minX,Sn),minY:e.getFloat64(t+Ju.minY,Sn),minZ:e.getFloat64(t+Ju.minZ,Sn),maxX:e.getFloat64(t+Ju.maxX,Sn),maxY:e.getFloat64(t+Ju.maxY,Sn),maxZ:e.getFloat64(t+Ju.maxZ,Sn),errorX:e.getFloat64(t+Ju.errorX,Sn),errorY:e.getFloat64(t+Ju.errorY,Sn),errorZ:e.getFloat64(t+Ju.errorZ,Sn),count:e.getUint32(t+Ju.count,Sn),reserved:e.getUint32(t+Ju.reserved,Sn)}}function V6t(e){const t=new DataView(e,0);let r=0;const{identifier:i,version:s}=Tae(e,t,r);if(r+=y2.byteCount,i!=="LEPCC     ")throw new z("lepcc-decode-error","Bad identifier");if(s>1)throw new z("lepcc-decode-error","Unknown version");const n=Nst(t,r);if(r+=Ju.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new z("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],d=[];if(r=G5(e,r,a),r=G5(e,r,l),r=G5(e,r,c),r=G5(e,r,d),r!==e.byteLength)throw new z("lepcc-decode-error","Bad length");let p=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let g=0;for(let _=0;_<l[m];_++){g+=c[p];const x=d[p];o[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*g),o[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*x),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function G5(e,t,r){const i=[];t=ste(e,t,i);const s=[];for(let n=0;n<i.length;n++){s.length=0,t=ste(e,t,s);for(let o=0;o<s.length;o++)r.push(s[o]+i[n])}return t}function ste(e,t,r){const i=new DataView(e,t),s=i.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=i.getUint32(1,Sn),t+=5;else if(a===1)l=i.getUint16(1,Sn),t+=3;else{if(a!==2)throw new z("lepcc-decode-error","Bad count type");l=i.getUint8(1),t+=2}if(o)throw new z("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),d=new Uint8Array(e,t,c);let p=0,f=0,m=0;const g=-1>>>32-n;for(let _=0;_<l;_++){for(;f<n;)p|=d[m]<<f,f+=8,m+=1;r[_]=p&g,p>>>=n,f-=n,f+n>32&&(p|=d[m-1]>>8-f)}return t+m}const CS={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function Fst(e,t){return{sizeLo:e.getUint32(t+CS.sizeLo,Sn),sizeHi:e.getUint32(t+CS.sizeHi,Sn),count:e.getUint32(t+CS.count,Sn),colorMapCount:e.getUint16(t+CS.colorMapCount,Sn),lookupMethod:e.getUint8(t+CS.lookupMethod),compressionMethod:e.getUint8(t+CS.compressionMethod)}}function kst(e){const t=new DataView(e,0);let r=0;const{identifier:i,version:s}=Tae(e,t,r);if(r+=y2.byteCount,i!=="ClusterRGB")throw new z("lepcc-decode-error","Bad identifier");if(s>1)throw new z("lepcc-decode-error","Unknown version");const n=Fst(t,r);if(r+=CS.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new z("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+r!==e.byteLength||n.colorMapCount>256)throw new z("lepcc-decode-error","Bad count");const o=new Uint8Array(e,r,3*n.colorMapCount),a=new Uint8Array(e,r+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const d=a[c];l[3*c]=o[3*d],l[3*c+1]=o[3*d+1],l[3*c+2]=o[3*d+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+r!==e.byteLength||n.colorMapCount!==0)throw new z("lepcc-decode-error","Bad count");return new Uint8Array(e,r).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(r+3!==e.byteLength||n.colorMapCount!==1)throw new z("lepcc-decode-error","Bad count");const o=t.getUint8(r),a=t.getUint8(r+1),l=t.getUint8(r+2),c=new Uint8Array(3*n.count);for(let d=0;d<n.count;d++)c[3*d]=o,c[3*d+1]=a,c[3*d+2]=l;return c}throw new z("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const AS={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function Ust(e,t){return{sizeLo:e.getUint32(t+AS.sizeLo,Sn),sizeHi:e.getUint32(t+AS.sizeHi,Sn),count:e.getUint32(t+AS.count,Sn),scaleFactor:e.getUint16(t+AS.scaleFactor,Sn),bitsPerPoint:e.getUint8(t+AS.bitsPerPoint),reserved:e.getUint8(t+AS.reserved)}}function Bst(e){const t=new DataView(e,0);let r=0;const{identifier:i,version:s}=Tae(e,t,r);if(r+=y2.byteCount,i!=="Intensity ")throw new z("lepcc-decode-error","Bad identifier");if(s>1)throw new z("lepcc-decode-error","Unknown version");const n=Ust(t,r);if(r+=AS.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new z("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+r!==e.byteLength)throw new z("lepcc-decode-error","Bad size");const a=new Uint8Array(e,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+r!==e.byteLength)throw new z("lepcc-decode-error","Bad size");const a=new Uint16Array(e,r,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(ste(e,r,a)!==e.byteLength)throw new z("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}var M;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude",e.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",e.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced"})(M||(M={}));const nte=te.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function zst(e,t,r){let i="",s=0;for(;s<r;){const n=e[t+s];if(n<128)i+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=r)throw new z("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&e[t+s+1];i+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=r)throw new z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&e[t+s+1])<<6|63&e[t+s+2];i+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new z("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=r)throw new z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&e[t+s+1])<<12|(63&e[t+s+2])<<6|63&e[t+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);i+=String.fromCharCode(a,l)}else i+=String.fromCharCode(o);s+=4}}}return i}function tPe(e,t){const r={byteOffset:0,byteCount:0,fields:Object.create(null)};let i=0;for(let s=0;s<t.length;s++){const n=t[s],o=n.valueType||n.type,a=Yst[o];r.fields[n.property]=a(e,i),i+=Gj[o].BYTES_PER_ELEMENT}return r.byteCount=i,r}function Vst(e,t,r){const i=[];let s,n,o=0;for(n=0;n<e;n+=1){if(s=t[n],s>0){if(i.push(zst(r,o,s-1)),r[o+s-1]!==0)throw new z("string-array-error","Invalid string array: missing null termination.")}else i.push(null);o+=s}return i}function Mme(e,t){return new Gj[t.valueType](e,t.byteOffset,t.count*t.valuesPerElement)}function jst(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function Gst(e,t,r){const i=t.header!=null?tPe(e,t.header):{byteOffset:0,byteCount:0,fields:{count:r}},s={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let n=i.byteCount;for(let o=0;o<t.ordering.length;o++){const a=t.ordering[o],l=ne(t[a]);if(l.count=i.fields.count,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=i.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new z("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding})}else{if(!iPe(l.valueType))throw new z("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=wB(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function rPe(e,t,r){if(t!==e&&nte.error(`Invalid ${r} buffer size
 expected: ${e}, actual: ${t})`),t<e)throw new z("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function Hst(e){return{isDraco:!1,isLegacy:!1,color:e.color!=null,normal:e.normal!=null,uv0:e.uv0!=null,uvRegion:e.uvRegion!=null,featureIndex:e.faceRange!=null&&e.featureId!=null}}function j6t(e,t){const r=tPe(e,t&&t.header);let i=r.byteCount;const s={isDraco:!1,header:r,byteOffset:r.byteCount,byteCount:0,vertexAttributes:{}},n=r.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of t.ordering){if(!t.vertexAttributes[c])continue;const d={...t.vertexAttributes[c],byteOffset:i,count:o},p=Rme[c]?Rme[c]:"_"+c;s.vertexAttributes[p]=d,i+=wB(d.valueType)*d.valuesPerElement*o}const a=n.faceCount;if(t.faces&&a){s.faces={};for(const c of t.ordering){if(!t.faces[c])continue;const d={...t.faces[c],byteOffset:i,count:a};s.faces[c]=d,i+=wB(d.valueType)*d.valuesPerElement*a}}const l=n.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&l){s.featureAttributes={};for(const c of t.featureAttributeOrder){if(!t.featureAttributes[c])continue;const d={...t.featureAttributes[c],byteOffset:i,count:l};s.featureAttributes[c]=d,i+=(d.valueType==="UInt64"?8:wB(d.valueType))*d.valuesPerElement*l}}return rPe(i,e.byteLength,"geometry"),s.byteCount=i-s.byteOffset,s}function G6t(e,t){return!e||!e.compressedAttributes||e.compressedAttributes.encoding!=="draco"?e?Hst(e):qst(t):Wst(e.compressedAttributes.attributes)}function qst(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of e.ordering)if(e.vertexAttributes[r])switch(r){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function Wst(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of e)switch(r){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}const Rme={position:M.POSITION,normal:M.NORMAL,color:M.COLOR,uv0:M.UV0,region:M.UVREGION};function Xst(e,t,r){if(e.encoding==="lepcc-rgb")return kst(t);if(e.encoding==="lepcc-intensity")return Bst(t);if(e.encoding!=null&&e.encoding!=="")throw new z("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(nte.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),e.ordering[0]==="ObjectIds"&&e.hasOwnProperty("objectIds")&&(nte.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const i=Gst(t,e,r);rPe(i.byteOffset+i.byteCount,t.byteLength,"attribute");const s=i.entries.attributeValues||i.entries.objectIds;if(s){if(s.valueType==="String"){const n=i.entries.attributeByteCounts,o=Mme(t,n),a=jst(t,s);return Vst(n.count,o,a)}return Mme(t,s)}throw new z("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const Gj={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},Yst={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function iPe(e){return Gj.hasOwnProperty(e)}function wB(e){return iPe(e)?Gj[e].BYTES_PER_ELEMENT:0}function Zst(e,t,r,i){const s=Jst(e,t,r),n=$e();return Qh(r,s,n,i),n}const sPe=1,Ime=5-sPe;function Jst(e,t,r){const i=$(),s=e[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/Ime)*Ime+sPe);if(r.isGeographic){const l=n/Kr(r).radius*180/Math.PI,c=Math.round(e[1]/l),d=Math.max(-90,Math.min(90,c*l)),p=l/Math.cos((Math.abs(d)-l/2)/180*Math.PI),f=Math.round(e[0]/p)*p;i[0]=f,i[1]=d}else{const l=Math.round(e[0]/n),c=Math.round(e[1]/n);i[0]=l*n,i[1]=c*n}const o=e[2]+t,a=Math.round(o/n);return i[2]=a*n,i}function Kst(e){return e.type==="fill"}function Qst(e){return e.type==="extrude"}var dr;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(dr||(dr={}));function ent(e){return e&&e.enabled&&(Qst(e)||Kst(e))&&v(e.edges)}function tnt(e){return e&&e.enabled&&e.edges||null}function nPe(e,t){return oPe(tnt(e),t)}function oPe(e,t){if(C(e))return null;const r=v(e.color)?Noe(Ze.toUnitRGBA(e.color)):ar(0,0,0,0),i=Ga(e.size),s=Ga(e.extensionLength);switch(e.type){case"solid":return aPe({color:r,size:i,extensionLength:s,...t});case"sketch":return rnt({color:r,size:i,extensionLength:s,...t});default:return}}function aPe(e){return{...int,...e,type:"solid"}}function rnt(e){return{...snt,...e,type:"sketch"}}const int={color:ar(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:dr.OPAQUE,hasSlicePlane:!1},snt={color:ar(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:dr.OPAQUE,hasSlicePlane:!1};var Gn;function lPe(e){switch(e){case"multiply":default:return Gn.Multiply;case"ignore":return Gn.Ignore;case"replace":return Gn.Replace;case"tint":return Gn.Tint}}function cPe(e,t,r){if(C(e)||t===Gn.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=_e(Math.round(e[3]*Kz),0,Kz),s=i===0||t===Gn.Tint?0:t===Gn.Replace?nnt:ont;r[0]=_e(Math.round(e[0]*wC),0,wC),r[1]=_e(Math.round(e[1]*wC),0,wC),r[2]=_e(Math.round(e[2]*wC),0,wC),r[3]=i+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(Gn||(Gn={}));const wC=255,Kz=85,nnt=Kz,ont=2*Kz;function Ki(){return new Float32Array(3)}function Qz(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function fi(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function uPe(e,t){return new Float32Array(e,t,3)}function Sae(){return Ki()}function dPe(){return fi(1,1,1)}function hPe(){return fi(1,0,0)}function pPe(){return fi(0,1,0)}function fPe(){return fi(0,0,1)}const ant=Sae(),lnt=dPe(),cnt=hPe(),unt=pPe(),dnt=fPe();Object.freeze(Object.defineProperty({__proto__:null,create:Ki,clone:Qz,fromValues:fi,createView:uPe,zeros:Sae,ones:dPe,unitX:hPe,unitY:pPe,unitZ:fPe,ZEROS:ant,ONES:lnt,UNIT_X:cnt,UNIT_Y:unt,UNIT_Z:dnt},Symbol.toStringTag,{value:"Module"}));var Ed;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(Ed||(Ed={}));class c1{constructor(t){this._allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&lR(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Pme);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,Pme));t++)this._items.push(this._allocator())}}const Pme=1024;function mPe(e){return 32+e.length}function gPe(e){return 16}function yPe(e){if(!e)return 0;let t=bPe;for(const r in e)if(e.hasOwnProperty(r)){const i=e[r];switch(typeof i){case"string":t+=mPe(i);break;case"number":t+=gPe();break;case"boolean":t+=4}}return t}function _Pe(e){if(!e)return 0;if(Array.isArray(e))return hnt(e);let t=bPe;for(const r in e)e.hasOwnProperty(r)&&(t+=vPe(e[r]));return t}function hnt(e){const t=e.length;if(t===0||typeof e[0]=="number")return 32+8*t;let r=wPe;for(let i=0;i<t;i++)r+=vPe(e[i]);return r}function vPe(e){switch(typeof e){case"object":return _Pe(e);case"string":return mPe(e);case"number":return gPe();case"boolean":return 4;default:return 8}}function H6t(e,t){return wPe+e.length*t}const bPe=32,wPe=32;var kR;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(kR||(kR={}));function rt(){return[0,0]}function w$(e){return[e[0],e[1]]}function pi(e,t){return[e,t]}function xPe(e){const t=rt(),r=Math.min(2,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function TPe(e,t){return new Float64Array(e,t,2)}function SPe(){return rt()}function EPe(){return pi(1,1)}function CPe(){return pi(1,0)}function APe(){return pi(0,1)}const Ud=SPe(),OPe=EPe(),pnt=CPe(),fnt=APe();Object.freeze(Object.defineProperty({__proto__:null,create:rt,clone:w$,fromValues:pi,fromArray:xPe,createView:TPe,zeros:SPe,ones:EPe,unitX:CPe,unitY:APe,ZEROS:Ud,ONES:OPe,UNIT_X:pnt,UNIT_Y:fnt},Symbol.toStringTag,{value:"Module"}));class Ah{constructor(t,r,i){this._itemByteSize=t,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&lR(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=xC){return new Ah(16,TPe,t)}static createVec3f64(t=xC){return new Ah(24,Tne,t)}static createVec4f64(t=xC){return new Ah(32,NMe,t)}static createMat3f64(t=xC){return new Ah(72,qIe,t)}static createMat4f64(t=xC){return new Ah(128,WIe,t)}static createQuatf64(t=xC){return new Ah(32,XIe,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}const xC=4*kR.KILOBYTES,q6t=Ah.createVec2f64(),Xe=Ah.createVec3f64(),Eae=Ah.createVec4f64();Ah.createMat3f64();const Cae=Ah.createMat4f64(),W6t=Ah.createQuatf64();function ca(e){return e?$me(ws(e.origin),ws(e.direction)):$me($(),$())}function $me(e,t){return{origin:e,direction:t}}function X6t(e,t){return Bv(e.origin,t.origin)&&Bv(e.direction,t.direction)}function ep(e,t){const r=_nt.get();return r.origin=e,r.direction=t,r}function eV(e,t=ca()){return MPe(e.origin,e.direction,t)}function mnt(e,t,r=ca()){return le(r.origin,e),ge(r.direction,t,e),r}function MPe(e,t,r=ca()){return le(r.origin,e),le(r.direction,t),r}function gnt(e,t){const r=At(Xe.get(),xe(Xe.get(),e.direction),ge(Xe.get(),t,e.origin));return Te(r,r)}function ynt(e,t,r){const i=Te(e.direction,ge(r,t,e.origin));return ye(r,e.origin,de(r,e.direction,i)),r}const _nt=new c1(()=>ca());function GD(e,t){return Te(e,t)/Ie(e)}function Aae(e,t){const r=Te(e,t)/(Ie(e)*Ie(t));return-Eo(r)}function RPe(e,t,r){xe(H5,e),xe(zq,t);const i=Te(H5,zq),s=Eo(i),n=At(H5,H5,zq);return Te(n,r)<0?2*Math.PI-s:s}const H5=$(),zq=$();function qo(){return Lr()}function UR(e,t=qo()){return jm(t,e)}function IPe(e,t){return ar(e[0],e[1],e[2],t)}function vnt(e){return e}function PPe(e){e[0]=e[1]=e[2]=e[3]=0}function Hj(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function Cv(e){return e[3]}function bnt(e){return e}function $Pe(e,t,r,i){return ar(e,t,r,i)}function wnt(e,t,r){return e!==r&&le(r,e),r[3]=e[3]+t,r}function xnt(e,t,r){return te.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),e===r?r:UR(e,r)}function Qx(e,t,r){if(C(t))return!1;const{origin:i,direction:s}=t,n=Tnt;n[0]=i[0]-e[0],n[1]=i[1]-e[1],n[2]=i[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2];if(o===0)return!1;const a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let d=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(d<0||p<d&&p>0)&&(d=p),!(d<0)&&(r&&(r[0]=i[0]+s[0]*d,r[1]=i[1]+s[1]*d,r[2]=i[2]+s[2]*d),!0)}const Tnt=$();function ote(e,t){return Qx(e,t,null)}function Snt(e,t,r){if(Qx(e,t,r))return r;const i=LI(e,t,Xe.get());return ye(r,t.origin,de(Xe.get(),t.direction,Ni(t.origin,i)/Ie(t.direction))),r}function LI(e,t,r){const i=Xe.get(),s=Cae.get();At(i,t.origin,t.direction);const n=Cv(e);At(r,i,t.origin),de(r,r,1/Ie(r)*n);const o=NPe(e,t.origin),a=Aae(t.origin,r);return Kh(s,a+o,i),je(r,r,s),r}function Ent(e,t,r){return Qx(e,t,r)?r:(ynt(t,e,r),DPe(e,r,r))}function DPe(e,t,r){const i=ge(Xe.get(),t,e),s=de(Xe.get(),i,e[3]/Ie(i));return ye(r,s,e)}function LPe(e,t){const r=ge(Xe.get(),t,e),i=Rc(r),s=e[3]*e[3];return Math.sqrt(Math.abs(i-s))}function NPe(e,t){const r=ge(Xe.get(),t,e),i=Ie(r),s=Cv(e),n=s+Math.abs(s-i);return Eo(s/n)}const Vq=$();function FPe(e,t,r,i){const s=ge(Vq,t,e);switch(r){case Ed.X:{const n=spe(s,Vq)[2];return ue(i,-Math.sin(n),Math.cos(n),0)}case Ed.Y:{const n=spe(s,Vq),o=n[1],a=n[2],l=Math.sin(o);return ue(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Ed.Z:return xe(i,s);default:return}}function kPe(e,t){const r=ge(ate,t,e);return Ie(r)-e[3]}function Cnt(e,t,r,i){const s=kPe(e,t),n=FPe(e,t,Ed.Z,ate),o=de(ate,n,r-s);return ye(i,t,o)}function Ant(e,t){const r=jo(e,t),i=Cv(e);return r<=i*i}const ate=$(),qj=qo(),Ont=Object.freeze(Object.defineProperty({__proto__:null,create:qo,copy:UR,fromCenterAndRadius:IPe,wrap:vnt,clear:PPe,fromRadius:Hj,getRadius:Cv,getCenter:bnt,fromValues:$Pe,elevate:wnt,setExtent:xnt,intersectRay:Qx,intersectsRay:ote,intersectRayClosestSilhouette:Snt,closestPointOnSilhouette:LI,closestPoint:Ent,projectPoint:DPe,distanceToSilhouette:LPe,angleToSilhouette:NPe,axisAt:FPe,altitudeAt:kPe,setAltitudeAt:Cnt,containsPoint:Ant,tmpSphere:qj},Symbol.toStringTag,{value:"Module"}));function xE(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],i=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}function Mnt(e,t){const r=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),i=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return ue(e,r,i,s),e}function Y6t(e,t,r){r=r||e;const i=Te(e,t);ue(r,e[0]-i*t[0],e[1]-i*t[1],e[2]-i*t[2]),xe(r,r)}function Z6t(e,t,r){Math.abs(e[0])>Math.abs(e[1])?ue(t,0,1,0):ue(t,1,0,0),At(r,e,t),xe(t,t),At(t,r,e),xe(r,r)}function q5(e,t,r,i,s,n){const o=e+(t-e)*s;return o+(r+(i-r)*s-o)*n}function Rnt(e,t,r,i=$()){const s=Ie(e),n=Ie(t),o=Te(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*s+r*n)/Math.sin(a),c=l/s*Math.sin((1-r)*a),d=l/n*Math.sin(r*a);return de(_2,e,c),de(v2,t,d),ye(i,_2,v2)}return $n(i,e,t,r)}function J6t(e,t,r,i=$(),s=$()){const n=Ie(e),o=Ie(t),a=Te(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),d=Math.sin(r*l),p=Math.sin((1-r)*l),f=(1-r)*n+r*o;{const m=f/c,g=m/o*d;de(_2,e,m/n*p),de(v2,t,g),ye(i,_2,v2)}{const m=1/n*(-Math.cos((1-r)*l)*l*f+p*(-n+o));de(_2,e,m);const g=1/o*(Math.cos(r*l)*l*f+d*(-n+o));de(v2,t,g),ye(s,_2,v2),de(s,s,1/c)}return s}return $n(i,e,t,r),ge(s,t,e),xe(s,s),s}function xB(e,t,r){e=xe(_2,e),t=xe(v2,t);const i=Eo(Te(e,t));if(r){const s=At(Int,e,t);if(Te(s,r)<0)return-i}return i}function TB(e){const t=e.length;return r=>{if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];let i=1;for(;r>e[i][0];)i++;const s=e[i-1][0],n=e[i][0],o=(n-r)/(n-s);return o*e[i-1][1]+(1-o)*e[i][1]}}function K6t(e,t,r,i){ge(Dme,t,e),ge(Lme,r,e),At(i,Dme,Lme),xe(i,i),i[3]=-Te(e,i)}const Dme=$(),Lme=$(),Int=$(),_2=$(),v2=$();function di(e=x$){return[e[0],e[1],e[2],e[3]]}function Pnt(e=x$[0],t=x$[1],r=x$[2],i=x$[3]){return Oae(e,t,r,i,Eae.get())}function Wj(e,t){return Oae(t[0],t[1],t[2],t[3],e)}function Oae(e,t,r,i,s=di()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function UPe(e,t,r){return le(r,e),r[3]=t,r}function BR(e,t,r){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function Il(e,t,r,i=di()){const s=r[0]-t[0],n=r[1]-t[1],o=r[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],d=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=d*d+p*p+f*f,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=d*g,i[1]=p*g,i[2]=f*g,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function BPe(e,t,r,i,s){if(e.count<3)return!1;e.getVec(r,wP);let n=i,o=!1;for(;n<e.count-1&&!o;)e.getVec(n,TC),n++,o=!_u(wP,TC);if(!o)return!1;for(n=Math.max(n,s),o=!1;n<e.count&&!o;)e.getVec(n,t2),n++,ge(W5,wP,TC),xe(W5,W5),ge(X5,TC,t2),xe(X5,X5),o=!_u(wP,t2)&&!_u(TC,t2)&&Math.abs(Te(W5,X5))<$nt;return o?(Il(wP,TC,t2,t),!0):(r!==0||i!==1||s!==2)&&BPe(e,t,0,1,2)}const $nt=.99619469809,wP=$(),TC=$(),t2=$(),W5=$(),X5=$();function lte(e,t,r){return t!==e&&Wj(e,t),e[3]=-Te(e,r),e}function cte(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function bN(e,t,r,i){return At(t2,t,e),BR(r,t2,i)}function Q6t(e,t,r,i){return Xj(e,t,ge(Xe.get(),r,t),Unt,i)}function dC(e,t,r){return!!v(t)&&Xj(e,t.origin,t.direction,Bnt,r)}function Dnt(e,t,r){return Xj(e,t.origin,t.vector,d0.NONE,r)}function Lnt(e,t,r){return Xj(e,t.origin,t.vector,d0.CLAMP,r)}function zPe(e,t){return Hi(e,t)>=0}function Nnt(e,t){const r=Te(e,t.ray.direction),i=-Hi(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const s=i/r;return r>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function Fnt(e,t){const r=Te(e,t.ray.direction),i=-Hi(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const s=i/r;return r>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function knt(e,t,r){const i=de(Xe.get(),e,-e[3]),s=ute(e,ge(Xe.get(),t,i),Xe.get());return ye(r,s,i),r}function ute(e,t,r){const i=de(Xe.get(),e,Te(e,t));return ge(r,t,i),r}function Hi(e,t){return Te(e,t)+e[3]}function Xj(e,t,r,i,s){const n=Te(e,r);if(n===0)return!1;let o=-(Te(e,t)+e[3])/n;return i&d0.CLAMP&&(o=_e(o,0,1)),!(!(i&d0.INFINITE_MIN)&&o<0||!(i&d0.INFINITE_MAX)&&o>1)&&(ye(s,t,de(s,r,o)),!0)}function eBt(e){return e}const x$=[0,0,1,0];var d0;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(d0||(d0={}));const Unt=d0.INFINITE_MIN|d0.INFINITE_MAX,Bnt=d0.INFINITE_MAX,zR=1e-6,xP=[0,0,0],Y5=[0,0,0];function znt(e,t){const{data:r,size:i}=e,s=r.length/i;if(s<=0)return;const n=new Znt(e);SB(xP,n.minProj,n.maxProj),r2(xP,xP,.5),Yp(Y5,n.maxProj,n.minProj);const o=dte(Y5),a=new Jnt;a.quality=o,s<14&&(e={data:new Float64Array(n.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],d=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],g=[0,0,0];switch(Vnt(n,e,g,l,c,d,p,f,m,a)){case 1:return void Ume(xP,Y5,t);case 2:return void Ynt(e,p,t)}jnt(e,g,l,c,d,p,f,m,a),VPe(e,a.b0,a.b1,a.b2,FM,kM);const _=[0,0,0];Yp(_,kM,FM),a.quality=dte(_),a.quality<o?jPe(a.b0,a.b1,a.b2,FM,kM,_,t):Ume(xP,Y5,t)}function Vnt(e,t,r,i,s,n,o,a,l,c){return Gnt(e,i,s),hte(i,s)<zR?1:(Yp(o,i,s),il(o,o),Hnt(t,i,o,n)<zR?2:(Yp(a,s,n),il(a,a),Yp(l,n,i),il(l,l),Zp(r,a,o),il(r,r),OS(t,r,o,a,l,c),0))}const TP=[0,0,0],SP=[0,0,0],up=[0,0,0],dp=[0,0,0],hp=[0,0,0],N1=[0,0,0],F1=[0,0,0],k1=[0,0,0];function jnt(e,t,r,i,s,n,o,a,l){qnt(e,t,r,TP,SP),TP[0]!==void 0&&(Yp(up,TP,r),il(up,up),Yp(dp,TP,i),il(dp,dp),Yp(hp,TP,s),il(hp,hp),Zp(N1,dp,n),il(N1,N1),Zp(F1,hp,o),il(F1,F1),Zp(k1,up,a),il(k1,k1),OS(e,N1,n,dp,up,l),OS(e,F1,o,hp,dp,l),OS(e,k1,a,up,hp,l)),SP[0]!==void 0&&(Yp(up,SP,r),il(up,up),Yp(dp,SP,i),il(dp,dp),Yp(hp,SP,s),il(hp,hp),Zp(N1,dp,n),il(N1,N1),Zp(F1,hp,o),il(F1,F1),Zp(k1,up,a),il(k1,k1),OS(e,N1,n,dp,up,l),OS(e,F1,o,hp,dp,l),OS(e,k1,a,up,hp,l))}function Gnt(e,t,r){let i=hte(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=hte(e.maxVert[n],e.minVert[n]);o>i&&(i=o,s=n)}Cd(t,e.minVert[s]),Cd(r,e.maxVert[s])}const pp=[0,0,0];function Hnt(e,t,r,i){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){pp[0]=s[l]-t[0],pp[1]=s[l+1]-t[1],pp[2]=s[l+2]-t[2];const c=r[0]*pp[0]+r[1]*pp[1]+r[2]*pp[2],d=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],p=pp[0]*pp[0]+pp[1]*pp[1]+pp[2]*pp[2]-c*c/d;p>o&&(o=p,a=l)}return Cd(i,s,a),o}const Do=[0,0];function qnt(e,t,r,i,s){Xnt(e,t,Do,s,i);const n=HPe(r,t);Do[1]-zR<=n&&(i[0]=void 0),Do[0]+zR>=n&&(s[0]=void 0)}const Nme=[0,0,0],Fme=[0,0,0],kme=[0,0,0],SC=[0,0,0],EC=[0,0,0],Z5=[0,0,0];function OS(e,t,r,i,s,n){if(GPe(t)<zR)return;Zp(Nme,r,t),Zp(Fme,i,t),Zp(kme,s,t),NM(e,t,Do),EC[1]=Do[0],SC[1]=Do[1],Z5[1]=SC[1]-EC[1];const o=[r,i,s],a=[Nme,Fme,kme];for(let l=0;l<3;++l){NM(e,o[l],Do),EC[0]=Do[0],SC[0]=Do[1],NM(e,a[l],Do),EC[2]=Do[0],SC[2]=Do[1],Z5[0]=SC[0]-EC[0],Z5[2]=SC[2]-EC[2];const c=dte(Z5);c<n.quality&&(Cd(n.b0,o[l]),Cd(n.b1,t),Cd(n.b2,a[l]),n.quality=c)}}const Wnt=[0,0,0];function NM(e,t,r){const{data:i,size:s}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<i.length;n+=s){const o=i[n]*t[0]+i[n+1]*t[1]+i[n+2]*t[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function Xnt(e,t,r,i,s){const{data:n,size:o}=e;Cd(i,n),Cd(s,i),r[0]=HPe(Wnt,t),r[1]=r[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<r[0]&&(r[0]=l,Cd(i,n,a)),l>r[1]&&(r[1]=l,Cd(s,n,a))}}function Ume(e,t,r){Cd(r.center,e),r2(r.halfSize,t,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const Z0=[0,0,0],CC=[0,0,0],EP=[0,0,0],FM=[0,0,0],kM=[0,0,0],Bme=[0,0,0];function Ynt(e,t,r){Cd(Z0,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?Z0[0]=0:Math.abs(t[1])>Math.abs(t[2])?Z0[1]=0:Z0[2]=0,GPe(Z0)<zR&&(Z0[0]=Z0[1]=Z0[2]=1),Zp(CC,t,Z0),il(CC,CC),Zp(EP,t,CC),il(EP,EP),VPe(e,t,CC,EP,FM,kM),Yp(Bme,kM,FM),jPe(t,CC,EP,FM,kM,Bme,r)}function VPe(e,t,r,i,s,n){NM(e,t,Do),s[0]=Do[0],n[0]=Do[1],NM(e,r,Do),s[1]=Do[0],n[1]=Do[1],NM(e,i,Do),s[2]=Do[0],n[2]=Do[1]}const J5=[0,0,0],Ig=[1,0,0,0,1,0,0,0,1],AC=[0,0,0];function jPe(e,t,r,i,s,n,o){Ig[0]=e[0],Ig[1]=e[1],Ig[2]=e[2],Ig[3]=t[0],Ig[4]=t[1],Ig[5]=t[2],Ig[6]=r[0],Ig[7]=r[1],Ig[8]=r[2],Knt(o.quaternion,Ig),SB(AC,i,s),r2(AC,AC,.5),r2(o.center,e,AC[0]),r2(J5,t,AC[1]),SB(o.center,o.center,J5),r2(J5,r,AC[2]),SB(o.center,o.center,J5),r2(o.halfSize,n,.5)}const Gd=7;class Znt{constructor(t){this.minVert=new Array(Gd),this.maxVert=new Array(Gd);const r=64*Gd;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Gd),i+=8*Gd,this.maxProj=new Float64Array(this.buffer,i,Gd),i+=8*Gd;for(let l=0;l<Gd;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Gd;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Gd;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Gd),n=new Array(Gd),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Gd;++l){let c=s[l];Cd(this.minVert[l],o,c),c=n[l],Cd(this.maxVert[l],o,c)}}}class Jnt{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function dte(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function SB(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function Yp(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function r2(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function Cd(e,t,r=0){e[0]=t[r+0],e[1]=t[r+1],e[2]=t[r+2]}function Zp(e,t,r){const i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2];e[0]=s*l-n*a,e[1]=n*o-i*l,e[2]=i*a-s*o}function il(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function GPe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function hte(e,t){const r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return r*r+i*i+s*s}function HPe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Knt(e,t){const r=t[0]+t[4]+t[8];if(r>0){let i=Math.sqrt(r+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;let o=Math.sqrt(t[3*i+i]-t[3*s+s]-t[3*n+n]+1);e[i]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+i]+t[3*i+s])*o,e[n]=(t[3*n+i]+t[3*i+n])*o}}const HD=wg(),b2=$(),Qnt=$(),eot=Ts();class tBt{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:Tne(this.buffer,56*a+0),halfSize:uPe(this.buffer,56*a+24),quaternion:ePe(this.buffer,56*a+36)}}}function Mae(e=[0,0,0],t=[-1,-1,-1],r=[0,0,0,1]){return{center:ws(e),halfSize:Qz(t),quaternion:QIe(r)}}function zme(e){return Mae(e.center,e.halfSize,e.quaternion)}function rBt(e,t){le(t.center,e.center),le(t.halfSize,e.halfSize),t4(t.quaternion,e.quaternion)}function qPe(e,t){return t=t||Mae(),znt(e,t),t}function MS(e,t){const r=Hi(t,e.center),i=Yj(e,t);return r>i?1:r<-i?-1:0}function iBt(e,t){t||(t=ao());const r=Vj(eot,e.quaternion),i=e.halfSize[0]*Math.abs(r[0])+e.halfSize[1]*Math.abs(r[3])+e.halfSize[2]*Math.abs(r[6]),s=e.halfSize[0]*Math.abs(r[1])+e.halfSize[1]*Math.abs(r[4])+e.halfSize[2]*Math.abs(r[7]),n=e.halfSize[0]*Math.abs(r[2])+e.halfSize[1]*Math.abs(r[5])+e.halfSize[2]*Math.abs(r[8]);return t[0]=e.center[0]-i,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+i,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function sBt(e,t){return Hi(t,e.center)-Yj(e,t)}function nBt(e,t){return Hi(t,e.center)+Yj(e,t)}function oBt(e,t){return MS(e,t[0])<=0&&MS(e,t[1])<=0&&MS(e,t[2])<=0&&MS(e,t[3])<=0&&MS(e,t[4])<=0&&MS(e,t[5])<=0}function aBt(e,t,r,i=0){Yv(HD,e.quaternion),ge(b2,t,e.center);const s=Vh(b2,b2,HD),n=Vh(Qnt,r,HD);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(i+e.halfSize[l]-s[l])/n[l],d=(-i-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,d)),a=Math.min(a,Math.max(c,d))}else if(s[l]>e.halfSize[l]+i||s[l]<-e.halfSize[l]-i)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const r=i=>{for(let s=0;s<i.length;s++)e[t+s]=i[s];t+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),e})();function Yj(e,t){Yv(HD,e.quaternion),Vh(b2,t,HD);const r=e.halfSize;return Math.abs(b2[0]*r[0])+Math.abs(b2[1]*r[1])+Math.abs(b2[2]*r[2])}function WPe(e,t){for(let r=0;r<8;++r){const i=t[r];i[0]=1&r?-e.halfSize[0]:e.halfSize[0],i[1]=2&r?-e.halfSize[1]:e.halfSize[1],i[2]=4&r?-e.halfSize[2]:e.halfSize[2],Vh(i,i,e.quaternion),ye(i,i,e.center)}}function tot(e){return Em(e.halfSize)}function XPe(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function lBt(e){var t;if(pe("disable-feature:i3s-draco")||!e)return!1;for(const r of e)for(const i of r.geometryBuffers)if(((t=i.compressedAttributes)==null?void 0:t.encoding)==="draco")return!0;return!1}function cBt(e,t,r,i){r.traverse(t,s=>{const n=s.mbs;return rot(e,n)!==w2.OUTSIDE&&(i(s),!0)})}function uBt(e,t,r){let i=0,s=0;for(let n=0;n<t.length&&i<e.length;n++)e[i]===t[n]&&(r(n)&&(e[s]=e[i],s++),i++);e.length=s}function dBt(e,t,r){let i=0,s=0;for(;i<r.length;)qSe(e,r[i])>=0===t&&(r[s]=r[i],s++),i++;r.length=s}const CP=tr();function hBt(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return CP[0]=(e[0]-t.position[0])/t.rotationScale[0],CP[1]=(e[1]-t.position[1])/t.rotationScale[4],CP[2]=(e[2]-t.position[0])/t.rotationScale[0],CP[3]=(e[3]-t.position[1])/t.rotationScale[4],CP}var w2;function rot(e,t){const r=t[0],i=t[1],s=t[3],n=e[0]-r,o=r-e[2],a=e[1]-i,l=i-e[3],c=Math.max(n,o,0),d=Math.max(a,l,0),p=c*c+d*d;return p>s*s?w2.OUTSIDE:p>0?w2.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?w2.INSIDE:w2.INTERSECTS_CENTER_INSIDE}function iot(e,t,r){const i=[],s=r&&r.missingFields,n=r&&r.originalFields;for(const o of e){const a=o.toLowerCase();let l=!1;for(const c of t)if(a===c.name.toLowerCase()){i.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return i}async function pBt(e,t,r,i,s){if(t.length===0)return[];const n=e.attributeStorageInfo;if(v(e.associatedLayer))try{return await not(e.associatedLayer,t,r,i)}catch(o){if(e.associatedLayer.loaded)throw o}if(n){const o=sot(t,r,s);if(C(o))throw new z("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=e.parsedUrl.path;return(await Promise.all(o.map(l=>oot(a,n,l.node,l.indices,i).then(c=>{for(let d=0;d<l.graphics.length;d++){const p=l.graphics[d],f=c[d];if(p.attributes)for(const m in p.attributes)m in f||(f[m]=p.attributes[m]);p.attributes=f}return l.graphics})))).flat()}throw new z("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function sot(e,t,r){const i=new Map,s=[],n=r();for(const o of e){const a=o.attributes[t];for(let l=0;l<n.length;l++){const c=n[l],d=c.featureIds.indexOf(a);if(d>=0){let p=i.get(c.node);p||(p={node:c.node,indices:[],graphics:[]},s.push(p),i.set(c.node,p)),p.indices.push(d),p.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function not(e,t,r,i){t.sort((l,c)=>l.attributes[r]-c.attributes[r]);const s=t.map(l=>l.attributes[r]),n=[],o=iot(i,e.fields,{originalFields:n}),a=await YPe(e,s,o);for(let l=0;l<t.length;l++){const c=t[l],d=a[l],p={};if(c.attributes)for(const f in c.attributes)p[f]=c.attributes[f];for(let f=0;f<n.length;f++)p[n[f]]=d[o[f]];c.attributes=p}return t}function YPe(e,t,r){const i=e.capabilities.query.maxRecordCount;if(i!=null&&t.length>i){const n=ize(t,i);return Promise.all(n.map(o=>YPe(e,o,r))).then(o=>o.flat())}const s=new pf({objectIds:t,outFields:r,orderByFields:[e.objectIdField]});return e.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===t.length)return n.features.map(o=>o.attributes);throw new z("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function oot(e,t,r,i,s){return ZPe(e,t,r.resources.attributes,i,s)}function ZPe(e,t,r,i,s){const n=[];for(const o of t)if(o&&s.includes(o.name)){const a=`${e}/nodes/${r}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return zo(n.map(o=>lr(o.url,{responseType:"array-buffer"}).then(a=>Xst(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of i){const c={};for(let d=0;d<o.length;d++)o[d].value!=null&&(c[n[d].storageInfo.name]=cot(o[d].value,l));a.push(c)}return a})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(w2||(w2={}));const aot=-32768,lot=-(2**31);function cot(e,t){if(!e)return null;const r=e[t];return YSe(e)?r===aot?null:r:ZSe(e)?r===lot?null:r:r!=r?null:r}function uot(e){const t=e.store.indexCRS||e.store.geographicCRS,r=t===void 0?e.store.indexWKT:void 0;if(r){if(!e.spatialReference)throw new z("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new z("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const i=t?new Ve(XPe(t)):e.spatialReference;return i.equals(e.spatialReference)?e.spatialReference:i}function dot(e){const t=e.store.vertexCRS||e.store.projectedCRS,r=t===void 0?e.store.vertexWKT:void 0;if(r){if(!e.spatialReference)throw new z("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new z("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const i=t?new Ve(XPe(t)):e.spatialReference;return i.equals(e.spatialReference)?e.spatialReference:i}function fBt(e,t){return C(t)?"@null":t===T0(t)?"@ECEF":e.equals(t)?"":t.wkid!=null?"@"+t.wkid:null}function pte(e,t,r){if(!Xv(e,t))throw new z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(r==="local"&&!hot(e,t))throw new z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function hot(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function pot(e,t,r){const i=uot(e),s=dot(e);pte(i,t,r),pte(s,t,r)}function fot(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function mBt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!fot(e.store.defaultGeometrySchema))throw new z("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function gBt(e,t){pot(e,t.spatialReference,t.viewingMode)}function mot(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function yBt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!mot(e.store.defaultGeometrySchema))throw new z("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function _Bt(e,t){pte(e.spatialReference,t.spatialReference,t.viewingMode)}function got(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function yot(e){return e.type==="mesh-3d"}function vBt(e){if(e==null||!got(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;const t=e.getSymbols();if(t.length===0)return!0;for(const r of t){if(!yot(r)||r.symbolLayers.length===0)return!0;for(const i of r.symbolLayers.items)if(i.type!=="fill"||C(i.material)||C(i.material.color)||i.material.colorMixMode!=="replace")return!0}return!1}const bBt=aPe({color:[0,0,0,0],opacity:0});class _ot{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function wBt(e){const t=new _ot;let r=!1,i=!1;for(const s of e.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(v(n)&&!r){const a=n.color,l=lPe(n.colorMixMode);v(a)?t.material={color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:t.material={color:[1,1,1],alpha:1,colorMixMode:Gn.Multiply},t.castShadows=s.castShadows,r=!0}v(o)&&!i&&(t.edgeMaterial=oPe(o,{}),i=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:Gn.Multiply}),t}function xBt(e,t){return(0|e)+(0|t)|0}function vot(e,t,r,i,s=0){i===T0(i)?t.isGeographic?Cot(e,r,t,s):Eot(e,r,t,s):t.isWGS84&&(i.isWebMercator||rN(i))?wot(t,e,i,r,s):t.isWebMercator&&rN(i)?Sot(t,e,i,r,s):e===r?(r.center[2]+=s,Yi(r.center,t,0,r.center,i,0,1)):(ue(r.center,e.center[0],e.center[1],e.center[2]+s),Yi(r.center,t,0,r.center,i,0,1),t4(r.quaternion,e.quaternion),le(r.halfSize,e.halfSize))}function bot(e,t,r,i,s){if(t4(s.quaternion,e.quaternion),i===Ye.Global){Yv(K5,e.quaternion),Vh(U1,e.center,K5),AJ(OC,U1),ECe(MC,OC,e.halfSize),Pc(MC,OC,MC);const n=Ie(MC);ye(MC,OC,e.halfSize);const o=Ie(MC);if(n<r)le(s.center,e.center),ue(U1,r,r,r),ye(s.halfSize,e.halfSize,U1);else{const a=o>0?1+t/o:1,l=n>0?1+r/n:1,c=(l+a)/2,d=(l-a)/2;de(s.halfSize,OC,d),p2(s.halfSize,s.halfSize,e.halfSize,c),de(s.center,OC,c),p2(s.center,s.center,e.halfSize,d),SCe(U1,U1),Z9(s.center,s.center,U1),Vh(s.center,s.center,s.quaternion)}}else{const n=ue(U1,0,0,1);p2(s.center,e.center,n,(r+t)/2),Yv(K5,e.quaternion),Vh(n,n,K5),AJ(n,n),p2(s.halfSize,e.halfSize,n,(r-t)/2)}return s}const U1=$(),OC=$(),MC=$(),K5=wg();function wot(e,t,r,i,s){le(_w,t.center),_w[2]+=s;const n=T0(r);Yi(_w,e,0,_w,n,0,1),JPe(n,t,_w,r,i)}const EB=new Float64Array(24),xot={data:EB,size:3},Vme=$(),_w=$(),Tot=Ts();function Sot(e,t,r,i,s){le(_w,t.center),_w[2]+=s,JPe(e,t,_w,r,i)}function JPe(e,t,r,i,s){const n=Vj(Tot,t.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)Vme[a]=t.halfSize[a]*((o&1<<a)!=0?-1:1);for(let a=0;a<3;++a){let l=r[a];for(let c=0;c<3;++c)l+=Vme[c]*n[3*c+a];EB[3*o+a]=l}}Yi(EB,e,0,EB,i,0,8),qPe(xot,s)}function Eot(e,t,r,i){WPe(e,fte),ue(t.center,e.center[0],e.center[1],e.center[2]+i),Qh(r,t.center,Hd,T0(r)),ue(t.center,Hd[12],Hd[13],Hd[14]);const s=2*Math.sqrt(1+Hd[0]+Hd[5]+Hd[10]);Z_[0]=(Hd[6]-Hd[9])/s,Z_[1]=(Hd[8]-Hd[2])/s,Z_[2]=(Hd[1]-Hd[4])/s,Z_[3]=.25*s,jj(t.quaternion,Z_,e.quaternion),Yv(Z_,t.quaternion);let n=0,o=0,a=0;for(const l of fte)l[2]+=i,Yi(l,r,0,l,T0(r),0,1),Pc(ii,l,t.center),Vh(ii,ii,Z_),n=Math.max(n,Math.abs(ii[0])),o=Math.max(o,Math.abs(ii[1])),a=Math.max(a,Math.abs(ii[2]));ue(t.halfSize,n,o,a)}function Cot(e,t,r,i){const s=Kr(r),n=1+Math.max(0,i)/(s.radius+e.center[2]);ue(t.center,e.center[0],e.center[1],e.center[2]+i),Yi(t.center,r,0,t.center,T0(r),0,1),t4(t.quaternion,e.quaternion),Yv(Z_,e.quaternion),ue(ii,0,0,1),Vh(ii,ii,Z_),ue(ii,e.halfSize[0]*Math.abs(ii[0]),e.halfSize[1]*Math.abs(ii[1]),e.halfSize[2]*Math.abs(ii[2])),de(ii,ii,s.inverseFlattening),ye(t.halfSize,e.halfSize,ii),de(t.halfSize,t.halfSize,n)}function TBt(e,t,r,i,s,n){if(!n||n.length===0||C(t))return null;const o=Zst(e.mbs,s,r,t);let a;Pn(ek,o);const l=()=>{if(!a)if(a=fte,kd(Q5),v(e.serviceObb)){vot(e.serviceObb,r,jme,t,s),WPe(jme,a);for(const m of a)je(m,m,ek),RM(Q5,m)}else{const m=e.mbs,g=m[3];So(m,r,ii,t),je(ii,ii,ek),ii[2]+=s;for(let _=0;_<8;++_){const x=1&_?g:-g,b=2&_?g:-g,w=4&_?g:-g,T=a[_];le(T,[ii[0]+x,ii[1]+b,ii[2]+w]),RM(Q5,T)}}};let c=1/0,d=-1/0;const p=m=>{if(m.type!=="replace")return;const g=m.geometry;if(!g.hasZ)return;kd(jq);const _=g.spatialReference||i,x=g.rings.reduce((b,w)=>w.reduce((T,E)=>(So(E,_,ii,t),je(ii,ii,ek),RM(jq,ii),Math.min(ii[2],T)),b),1/0);l(),HF(Q5,jq)&&(c=Math.min(c,x),d=Math.max(d,x))};if(n.forEach(m=>p(m)),c===1/0)return null;const f=(m,g,_)=>{je(ii,_,o),m[g+0]=ii[0],m[g+1]=ii[1],m[g+2]=ii[2],g+=24,_[2]=c,je(ii,_,o),m[g+0]=ii[0],m[g+1]=ii[1],m[g+2]=ii[2],g+=24,_[2]=d,je(ii,_,o),m[g+0]=ii[0],m[g+1]=ii[1],m[g+2]=ii[2]};for(let m=0;m<8;++m)f(Gme.data,3*m,a[m]);return qPe(Gme)}function SBt(e){return v(e)&&e.halfSize[0]>=0}function EBt(e){return e[3]>=0}function CBt(e){v(e)&&(e.halfSize[0]=-1)}function ABt(e){v(e)&&(e[3]=-1)}const Hd=$e(),Z_=KIe(),fte=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],jq=tr(),Q5=tr(),jme=Mae(),ii=[0,0,0],Gme={data:new Array(72),size:3},ek=$e();async function Aot(e,t=e.popupTemplate){if(C(t))return[];const r=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:i}=t,{objectIdField:s,typeIdField:n,globalIdField:o,relationships:a}=e;if(r.includes("*"))return["*"];const l=i?await PYe(e):[],c=coe(e.fieldsIndex,[...r,...l]);return n&&c.push(n),c&&s&&e.fieldsIndex.has(s)&&!c.includes(s)&&c.push(s),c&&o&&e.fieldsIndex.has(o)&&!c.includes(o)&&c.push(o),a&&a.forEach(d=>{const{keyField:p}=d;c&&p&&e.fieldsIndex.has(p)&&!c.includes(p)&&c.push(p)}),c}function Oot(e,t){return e.popupTemplate?e.popupTemplate:v(t)&&t.defaultPopupTemplateEnabled&&v(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}const Mot=["3DObject","Point"],Hme=fIe();let Wt=class extends lRe(oQe(nRe(Uoe(Boe(Ej(wj(ZMe(fE)))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new Ge,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(e,t){return typeof e=="string"?{url:e,...t}:e}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var i,s,n,o;const r=(s=(i=this.getFeatureType(t==null?void 0:t.feature))==null?void 0:i.domains)==null?void 0:s[e];return r&&r.type!=="inherited"?r:(o=(n=this.getField(e))==null?void 0:n.domain)!=null?o:null}getFeatureType(e){return e!=null&&v(this.associatedLayer)?this.associatedLayer.getFeatureType(e):null}get types(){var e;return v(this.associatedLayer)?(e=this.associatedLayer.types)!=null?e:[]:[]}get typeIdField(){return v(this.associatedLayer)?this.associatedLayer.typeIdField:null}get formTemplate(){return v(this.associatedLayer)?this.associatedLayer.formTemplate:null}get fieldsIndex(){return new pIe(this.fields)}readNodePages(e,t,r){return t.layerType==="Point"&&(e=t.pointNodePages),e==null||typeof e!="object"?null:QS.fromJSON(e,r)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get geometryType(){return Rot[this.profile]||"mesh"}set renderer(e){Pz(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return e!=null&&typeof e=="object"||(e={}),e.color==null&&(e.color=!1),e}get capabilities(){const e=v(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:lQe,{query:t,editing:{supportsGlobalId:r,supportsRollbackOnFailure:i,supportsUploadWithItemId:s,supportsReturnServiceEditsInSourceSpatialReference:n},data:{supportsZ:o,supportsM:a,isVersioned:l,supportsAttachment:c},operations:{supportsEditing:d,supportsAdd:p,supportsUpdate:f,supportsDelete:m,supportsQuery:g,supportsQueryAttachments:_}}=e,x=e.operations.supportsChangeTracking,b=SKe();return{query:t,editing:{supportsGlobalId:r,supportsReturnServiceEditsInSourceSpatialReference:n,supportsRollbackOnFailure:i,supportsGeometryUpdate:!1,supportsUploadWithItemId:s},data:{supportsAttachment:c,supportsZ:o,supportsM:a,isVersioned:l},operations:{supportsQuery:g,supportsQueryAttachments:_,supportsEditing:d&&x,supportsAdd:b&&p&&x,supportsDelete:b&&m&&x,supportsUpdate:f&&x}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get infoFor3D(){return v(this.associatedLayer)?this.associatedLayer.infoFor3D:null}get defaultPopupTemplate(){return v(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeOID"&&(e=r.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeGlobalID"&&(e=r.name),!!e)),e||void 0}get displayField(){return v(this.associatedLayer)?this.associatedLayer.displayField:null}readProfile(e,t){const r=t.store.profile;return r!=null&&qme[r]?qme[r]:(te.getLogger(this.declaredClass).error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}load(e){const t=v(e)?e.signal:null,r=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(zh).then(()=>this._fetchService(t)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),v(this.filter)?this.filter.loadGeometries(this.spatialReference):null])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>mIe(this,{origin:"service"},t)).then(()=>Pz(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(r),Promise.resolve(this)}async beforeSave(){v(this.filter)&&await this.load()}createQuery(){const e=new pf;return this.geometryType!=="mesh"&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(e||this.createQuery(),t)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=this,i.sourceLayer=this;return r})}async queryCachedAttributes(e,t){const r=CYe(this.fieldsIndex,await Aot(this,Oot(this)));return ZPe(this.parsedUrl.path,this.attributeStorageInfo,e,t,r)}async queryCachedFeature(e,t){const r=await this.queryCachedAttributes(e,[t]);if(!r||r.length===0)throw new z("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const i=new _i;return i.attributes=r[0],i.layer=this,i.sourceLayer=this,i}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(e,t))}getFieldUsageInfo(e){const t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(te.getLogger(this.declaredClass).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return gIe(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return v(e)&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),C(this.associatedLayer))throw new z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new z("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){if(await this.load(t),!this.statisticsInfo)throw new z("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const r=this.fieldsIndex.get(e);if(!r)throw new z("scenelayer:field-unexisting",`Field '${e}' does not exist on the layer`);for(const i of this.statisticsInfo)if(i.name===r.name){const s=Mu(this.parsedUrl.path,i.href);return lr(s,{query:{f:"json",token:this.apiKey},responseType:"json",signal:t?t.signal:null}).then(n=>n.data)}throw new z("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(e,t){return this._debouncedSaveOperations(IR.SAVE_AS,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(IR.SAVE,e)}async applyEdits(e,t){const r=await re(()=>import("./editingSupport.16203741.js"),[]);if(await this.load(),C(this.associatedLayer))throw new z(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),r.applyEdits(this,this.associatedLayer.source,e,t)}on(e,t){return super.on(e,t)}validateLayer(e){if(e.layerType&&!Mot.includes(e.layerType))throw new z("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new z("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new z("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function t(r,i){let s=!1,n=!1;if(r==null)s=!0,n=!0;else{const o=i&&i.isGeographic;switch(r){case"east-north-up":case"earth-centered":s=!0,n=o;break;case"vertex-reference-frame":s=!0,n=!o;break;default:s=!1}}if(!s)throw new z("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!n)throw new z("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}t(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if(this.profile==="points")e.push("Point");else{if(this.profile!=="mesh-pyramids")throw new z("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const t=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(s=>s.name===e.name)),r=!!(v(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(s=>s&&e.name===s.name)),i={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||r,supportsLayerQuery:r};this._fieldUsageInfo[e.name]=i}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides()}_applyAssociatedLayerFieldsOverrides(){if(C(this.associatedLayer)||!this.associatedLayer.fields)return;let e=null;for(const t of this.associatedLayer.fields){const r=this.getField(t.name);r?(!r.domain&&t.domain&&(r.domain=t.domain.clone()),r.editable=t.editable,r.nullable=t.nullable,r.length=t.length):(e||(e=this.fields?this.fields.slice():[]),e.push(t.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(C(this.associatedLayer))return;const e=["popupTemplate","popupEnabled"],t=Gl(this);for(let r=0;r<e.length;r++){const i=e[r],s=this.originIdOf(i),n=this.associatedLayer.originIdOf(i);s<n&&(n===Jr.SERVICE||n===Jr.PORTAL_ITEM)&&t.setAtOrigin(i,this.associatedLayer[i],n)}}async _setAssociatedFeatureLayer(e){if(!["mesh-pyramids","points"].includes(this.profile))return;const t=new oit(this.parsedUrl,this.portalItem,this.apiKey,e);try{this.associatedLayer=await t.fetch()}catch(r){Ps(r)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await vx(()=>this.popupEnabled&&this.popupTemplate!=null);const e=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?te.getLogger(this.declaredClass).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):te.getLogger(this.declaredClass).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;e&&(this.profile==="mesh-pyramids"&&e.mode==="relative-to-scene"&&te.getLogger(this.declaredClass).warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),e.featureExpressionInfo&&e.featureExpressionInfo.expression!=="0"&&te.getLogger(this.declaredClass).warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};u([h({types:{key:"type",base:Ev,typeMap:{selection:VQ}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],Wt.prototype,"featureReduction",void 0),u([h({type:[$b],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],Wt.prototype,"rangeInfos",void 0),u([h({json:{read:!1}})],Wt.prototype,"associatedLayer",void 0),u([h({type:["show","hide"]})],Wt.prototype,"listMode",void 0),u([h({type:["ArcGISSceneServiceLayer"]})],Wt.prototype,"operationalLayerType",void 0),u([h({json:{read:!1},readOnly:!0})],Wt.prototype,"type",void 0),u([h({...Hme.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Wt.prototype,"fields",void 0),u([h()],Wt.prototype,"types",null),u([h()],Wt.prototype,"typeIdField",null),u([h()],Wt.prototype,"formTemplate",null),u([h({readOnly:!0})],Wt.prototype,"fieldsIndex",null),u([h({type:QRe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Wt.prototype,"floorInfo",void 0),u([h(Hme.outFields)],Wt.prototype,"outFields",void 0),u([h({type:QS,readOnly:!0,json:{read:!1}})],Wt.prototype,"nodePages",void 0),u([me("service","nodePages",["nodePages","pointNodePages"])],Wt.prototype,"readNodePages",null),u([h({type:[Mp],readOnly:!0})],Wt.prototype,"materialDefinitions",void 0),u([h({type:[_$],readOnly:!0})],Wt.prototype,"textureSetDefinitions",void 0),u([h({type:[b$],readOnly:!0})],Wt.prototype,"geometryDefinitions",void 0),u([h({readOnly:!0})],Wt.prototype,"serviceUpdateTimeStamp",void 0),u([h({readOnly:!0})],Wt.prototype,"attributeStorageInfo",void 0),u([h({readOnly:!0})],Wt.prototype,"statisticsInfo",void 0),u([h({type:Ge.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],Wt.prototype,"excludeObjectIds",void 0),u([h({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Wt.prototype,"definitionExpression",void 0),u([h({type:Bit,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],Wt.prototype,"filter",void 0),u([h({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Wt.prototype,"path",void 0),u([h(pRe)],Wt.prototype,"elevationInfo",null),u([h({type:String})],Wt.prototype,"geometryType",null),u([h(Sj)],Wt.prototype,"labelsVisible",void 0),u([h({type:[e4],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:jz},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:jz},write:!0}})],Wt.prototype,"labelingInfo",void 0),u([h(hRe)],Wt.prototype,"legendEnabled",void 0),u([h({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){var i,s;if(typeof e=="number"&&e>=0&&e<=1)return e;const r=(s=(i=t.layerDefinition)==null?void 0:i.drawingInfo)==null?void 0:s.transparency;return r!==void 0?xR(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],Wt.prototype,"opacity",void 0),u([h({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Wt.prototype,"priority",void 0),u([h({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Wt.prototype,"semantic",void 0),u([h({types:XMe,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],Wt.prototype,"renderer",null),u([h({json:{read:!1}})],Wt.prototype,"cachedDrawingInfo",void 0),u([me("service","cachedDrawingInfo")],Wt.prototype,"readCachedDrawingInfo",null),u([h({readOnly:!0,json:{read:!1}})],Wt.prototype,"capabilities",null),u([h({type:Boolean,json:{read:!1}})],Wt.prototype,"editingEnabled",null),u([h({readOnly:!0,json:{write:!1,read:!1}})],Wt.prototype,"infoFor3D",null),u([h(Tj)],Wt.prototype,"popupEnabled",void 0),u([h({type:Nc,json:{name:"popupInfo",write:!0}})],Wt.prototype,"popupTemplate",void 0),u([h({readOnly:!0,json:{read:!1}})],Wt.prototype,"defaultPopupTemplate",null),u([h({type:String,json:{read:!1}})],Wt.prototype,"objectIdField",void 0),u([me("service","objectIdField",["objectIdField","fields"])],Wt.prototype,"readObjectIdField",null),u([h({type:String,json:{read:!1}})],Wt.prototype,"globalIdField",void 0),u([me("service","globalIdField",["globalIdField","fields"])],Wt.prototype,"readGlobalIdField",null),u([h({readOnly:!0,type:String,json:{read:!1}})],Wt.prototype,"displayField",null),u([h({type:String,json:{read:!1}})],Wt.prototype,"profile",void 0),u([me("service","profile",["store.profile"])],Wt.prototype,"readProfile",null),u([h({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],Wt.prototype,"normalReferenceFrame",void 0),u([h(uRe)],Wt.prototype,"screenSizePerspectiveEnabled",void 0),Wt=u([I("esri.layers.SceneLayer")],Wt);const qme={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},Rot={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},KPe=Wt,OBt=Object.freeze(Object.defineProperty({__proto__:null,default:KPe},Symbol.toStringTag,{value:"Module"}));let qD=class extends $0(Ge){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{C(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Ge.ofType(this.itemType.Type))(e):new Ge(e)}};function tV(e,t){return{type:e,cast:UAe,set(r){const i=hE(r,this._get(t),e);i.owner=this,this._set(t,i)}}}u([h()],qD.prototype,"owner",null),qD=u([I("esri.core.support.OwningCollection")],qD);function xg(e){return e?{origin:ws(e.origin),vector:ws(e.vector)}:{origin:$(),vector:$()}}function Iot(e,t){const r=$ot.get();return r.origin=e,r.vector=t,r}function MBt(e,t=xg()){return Pot(e.origin,e.vector,t)}function Pot(e,t,r=xg()){return le(r.origin,e),le(r.vector,t),r}function B2(e,t,r=xg()){return le(r.origin,e),ge(r.vector,t,e),r}function Rae(e,t){const r=ge(Xe.get(),t,e.origin),i=Te(e.vector,r),s=Te(e.vector,e.vector),n=_e(i/s,0,1),o=ge(Xe.get(),de(Xe.get(),e.vector,n),r);return Te(o,o)}function RBt(e,t,r){return mte(e,t,0,1,r)}function IBt(e,t,r){return ye(r,e.origin,de(r,e.vector,t))}function mte(e,t,r,i,s){const{vector:n,origin:o}=e,a=ge(Xe.get(),t,o),l=Te(n,a)/Rc(n);return de(s,n,_e(l,r,i)),ye(s,s,e.origin)}function PBt(e,t){if(e3e(e,Iot(t.origin,t.direction),!1,rV)){const{tA:r,pB:i,distance2:s}=rV;if(r>=0&&r<=1)return s;if(r<0)return jo(e.origin,i);if(r>1)return jo(ye(Xe.get(),e.origin,e.vector),i)}return null}function QPe(e,t,r){return!!e3e(e,t,!0,rV)&&(le(r,rV.pA),!0)}function e3e(e,t,r,i){const n=e.origin,o=ye(Xe.get(),n,e.vector),a=t.origin,l=ye(Xe.get(),a,t.vector),c=Xe.get(),d=Xe.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],d[0]=l[0]-a[0],d[1]=l[1]-a[1],d[2]=l[2]-a[2],Math.abs(d[0])<1e-6&&Math.abs(d[1])<1e-6&&Math.abs(d[2])<1e-6)return!1;const p=Xe.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*d[0]+c[1]*d[1]+c[2]*d[2],m=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],g=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],_=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],x=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*_-m*m;if(Math.abs(x)<1e-6)return!1;let b=(f*m-g*_)/x,w=(f+m*b)/_;r&&(b=_e(b,0,1),w=_e(w,0,1));const T=Xe.get(),E=Xe.get();return T[0]=n[0]+b*p[0],T[1]=n[1]+b*p[1],T[2]=n[2]+b*p[2],E[0]=a[0]+w*d[0],E[1]=a[1]+w*d[1],E[2]=a[2]+w*d[2],i.tA=b,i.tB=w,i.pA=T,i.pB=E,i.distance2=jo(T,E),!0}const rV={tA:0,tB:0,pA:$(),pB:$(),distance2:0},$ot=new c1(()=>xg()),Gq=te.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class t3e{constructor(){this.plane=di(),this.origin=$(),this.basis1=$(),this.basis2=$()}}function u1(e=h3e){return{plane:di(e.plane),origin:ws(e.origin),basis1:ws(e.basis1),basis2:ws(e.basis2)}}function Dot(e,t,r){const i=qot.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=Pnt(0,0,0,0),Zj(i),i}function hC(e,t=u1()){return Iae(e.origin,e.basis1,e.basis2,t)}function Lot(e,t){le(t.origin,e.origin),le(t.basis1,e.basis1),le(t.basis2,e.basis2),Wj(t.plane,e.plane)}function Iae(e,t,r,i=u1()){return le(i.origin,e),le(i.basis1,t),le(i.basis2,r),Zj(i),Got(i,"fromValues()"),i}function Zj(e){bN(e.basis2,e.basis1,e.origin,e.plane)}function r3e(e,t,r){e!==r&&hC(e,r);const i=de(Xe.get(),Zv(e),t);return ye(r.origin,r.origin,i),r.plane[3]-=t,r}function Not(e,t,r){return i3e(t,r),r3e(r,Lae(e,e.origin),r),r}function i3e(e,t=u1()){const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return ue(t.origin,e[0]+r,e[1]+i,0),ue(t.basis1,r,0,0),ue(t.basis2,0,i,0),Oae(0,0,1,0,t.plane),t}function Pae(e,t,r){return!!dC(e.plane,t,r)&&u3e(e,r)}function Fot(e,t,r){if(Pae(e,t,r))return r;const i=s3e(e,t,Xe.get());return ye(r,t.origin,de(Xe.get(),t.direction,Ni(t.origin,i)/Ie(t.direction))),r}function s3e(e,t,r){const i=iV.get();d3e(e,t,i,iV.get());let s=Number.POSITIVE_INFINITY;for(const n of Fae){const o=Nae(e,n,Jj.get()),a=Xe.get();if(Dnt(i,o,a)){const l=n1(Xe.get(),t.origin,a),c=Math.abs(Eo(Te(t.direction,l)));c<s&&(s=c,le(r,a))}}return s===Number.POSITIVE_INFINITY?n3e(e,t,r):r}function n3e(e,t,r){if(Pae(e,t,r))return r;const i=iV.get(),s=iV.get();d3e(e,t,i,s);let n=Number.POSITIVE_INFINITY;for(const o of Fae){const a=Nae(e,o,Jj.get()),l=Xe.get();if(Lnt(i,a,l)){const c=gnt(t,l);if(!zPe(s,l))continue;c<n&&(n=c,le(r,l))}}return $ae(e,t.origin)<n&&o3e(e,t.origin,r),r}function o3e(e,t,r){const i=knt(e.plane,t,Xe.get()),s=mte(Wme(e,e.basis1),i,-1,1,Xe.get()),n=mte(Wme(e,e.basis2),i,-1,1,Xe.get());return ge(r,ye(Xe.get(),s,n),e.origin),r}function a3e(e,t,r){const{origin:i,basis1:s,basis2:n}=e,o=ge(Xe.get(),t,i),a=GD(s,o),l=GD(n,o),c=GD(Zv(e),o);return ue(r,a,l,c)}function $ae(e,t){const r=a3e(e,t,Xe.get()),{basis1:i,basis2:s}=e,n=Ie(i),o=Ie(s),a=Math.max(Math.abs(r[0])-n,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function kot(e,t){return Math.sqrt($ae(e,t))}function Uot(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of Fae){const s=Nae(e,i,Jj.get()),n=Rae(s,t);n>r&&(r=n)}return Math.sqrt(r)}function Dae(e,t){return zPe(e.plane,t)&&u3e(e,t)}function Bot(e,t,r,i){return jot(e,r,i)}function Lae(e,t){const r=-e.plane[3];return GD(Zv(e),t)-r}function zot(e,t,r,i){const s=Lae(e,t),n=de(Hot,Zv(e),r-s);return ye(i,t,n),i}function l3e(e,t){return _u(e.basis1,t.basis1)&&_u(e.basis2,t.basis2)&&_u(e.origin,t.origin)}function c3e(e,t,r){return e!==r&&hC(e,r),Pn(RC,t),Iu(RC,RC),je(r.basis1,e.basis1,RC),je(r.basis2,e.basis2,RC),je(r.plane,e.plane,RC),je(r.origin,e.origin,t),lte(r.plane,r.plane,r.origin),r}function Vot(e,t,r,i){return e!==i&&hC(e,i),Kh(Hq,t,r),je(i.basis1,e.basis1,Hq),je(i.basis2,e.basis2,Hq),Zj(i),i}function Zv(e){return e.plane}function jot(e,t,r){switch(t){case Ed.X:le(r,e.basis1),xe(r,r);break;case Ed.Y:le(r,e.basis2),xe(r,r);break;case Ed.Z:le(r,Zv(e))}return r}function u3e(e,t){const r=ge(Xe.get(),t,e.origin),i=Rc(e.basis1),s=Rc(e.basis2),n=Te(e.basis1,r),o=Te(e.basis2,r);return-n-i<0&&n-i<0&&-o-s<0&&o-s<0}function Wme(e,t){const r=Jj.get();return le(r.origin,e.origin),le(r.vector,t),r}function Nae(e,t,r){const{basis1:i,basis2:s,origin:n}=e,o=de(Xe.get(),i,t.origin[0]),a=de(Xe.get(),s,t.origin[1]);ye(r.origin,o,a),ye(r.origin,r.origin,n);const l=de(Xe.get(),i,t.direction[0]),c=de(Xe.get(),s,t.direction[1]);return de(r.vector,ye(l,l,c),2),r}function Got(e,t){Math.abs(Te(e.basis1,e.basis2)/(Ie(e.basis1)*Ie(e.basis2)))>1e-6&&Gq.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Te(e.basis1,Zv(e)))>1e-6&&Gq.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Te(Zv(e),e.origin)-e.plane[3])>1e-6&&Gq.warn(t,"Plane offset is not consistent with plane origin")}function d3e(e,t,r,i){const s=Zv(e);bN(s,t.direction,t.origin,r),bN(r,s,t.origin,i)}const h3e={plane:di(),origin:Fe(0,0,0),basis1:Fe(1,0,0),basis2:Fe(0,1,0)},iV=new c1(di),Jj=new c1(xg),Hot=$(),qot=new c1(()=>u1()),Fae=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],RC=$e(),Hq=$e(),Wot=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:t3e,create:u1,wrap:Dot,copy:hC,copyWithoutVerify:Lot,fromValues:Iae,updateUnboundedPlane:Zj,elevate:r3e,setExtent:Not,fromAABoundingRect:i3e,intersectRay:Pae,intersectRayClosestSilhouette:Fot,closestPointOnSilhouette:s3e,closestPoint:n3e,projectPoint:o3e,projectPointLocal:a3e,distance2:$ae,distance:kot,distanceToSilhouette:Uot,extrusionContainsPoint:Dae,axisAt:Bot,altitudeAt:Lae,setAltitudeAt:zot,equals:l3e,transform:c3e,rotate:Vot,normal:Zv,UP:h3e},Symbol.toStringTag,{value:"Module"}));function Xot(e){const{value:t,operations:r}=e;return{operations:r,value:r.create(t)}}function Yot(e,t,r){return e.operations.setExtent(e.value,t,r.value),r}function Zot(e){return{operations:e,value:e.create()}}function p3e(e,t,r=Zot(e)){return r.operations=e,e.copy(t,r.value),r}function Jot(e){return p3e(Ont,$Pe(0,0,0,Kr(e).radius))}const Xme=2**50;function Kot(){return p3e(Wot,Iae([0,0,0],[Xme,0,0],[0,Xme,0]))}function Qot(e,t,r){return e.operations.axisAt(e.value,t,Ed.Z,r)}function eat(e,t,r,i){return e.operations.axisAt(e.value,t,r,i)}function tat(e,t,r){return e.operations.intersectRay(e.value,t,r)}function rat(e,t,r){return e.operations.intersectRayClosestSilhouette(e.value,t,r)}function iat(e,t){return e.operations.altitudeAt(e.value,t)}function f3e(e,t,r,i){return e.operations.setAltitudeAt(e.value,t,r,i)}function sat(e,t,r,i){return t!==i&&jn(i,t),ue(IC,i[12],i[13],i[14]),f3e(e,IC,r,IC),i[12]=IC[0],i[13]=IC[1],i[14]=IC[2],i}function qq(e,t,r){return e.operations.elevate(e.value,t,r.value)}const IC=$();function Yme(e,t,r,i,s){return s[0]=Te(e,t),s[1]=Te(e,r),s[2]=Te(e,i),s}function gte(e,t,r,i,s){le(r,e),le(tk,t),xe(tk,tk),At(i,tk,r),At(s,i,r)}function m3e(e,t){return e?T0(t):t.isGeographic?Ve.PlateCarree:t}const tk=$(),kae=96;function $Bt(e,t){const r=t||e.extent,i=e.width,s=Fc(r&&r.spatialReference);return r&&i?r.width/i*s*Moe*kae:0}function g3e(e,t){return e/(Fc(t)*Moe*kae)}function nat(e){return e/(Moe*kae)}function oat(e,t){const r=e.extent,i=e.width-(e.padding?e.padding.left+e.padding.right:0),s=g3e(t,r.spatialReference);return r.clone().expand(s*i/r.width)}const y3e="OBJECTID";let VR=class extends qD{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{C(t.item)||t.item.parent===this.owner&&(te.getLogger(this.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};VR=u([I("esri.support.AnalysesCollection")],VR);const CB={widthBreakpoint:{getValue(e){const t=e.viewSize[0],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,r=t[0],i=t[1],s=this.values;return i>=r?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Wq={xsmall:544,small:768,medium:992,large:1200};function aat(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function Xq(e,t){return t?CB[e].valueToClassName[t].split(" "):[]}const lat=e=>{let t=class extends e{constructor(...r){super(...r),this._breakpointsHandles=new hr,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Wq}initialize(){this._breakpointsHandles.add(ie(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),pt))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Qe(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=aat(r);if(!i){const s=JSON.stringify(Wq,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}r=i?r:Wq,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=yd.acquire(),i=yd.acquire();let s,n=!1;for(s in CB){const o=this[s],a=CB[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,Xq(s,o).forEach(l=>i.push(l)),Xq(s,a).forEach(l=>r.push(l)))}n&&(this._applyClassNameChanges(r,i),yd.release(r),yd.release(i))}_applyClassNameChanges(r,i){const s=this.container;s&&(i.forEach(n=>s.classList.remove(n)),r.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in CB)Xq(i,this[i]).forEach(s=>r.classList.remove(s))}};return u([h()],t.prototype,"breakpoints",null),u([h()],t.prototype,"orientation",void 0),u([h()],t.prototype,"widthBreakpoint",void 0),u([h()],t.prototype,"heightBreakpoint",void 0),t=u([I("esri.views.BreakpointsOwner")],t),t};let Db=class extends be{constructor(){super(...arguments),this.items=new Ge,this._watchUpdatingTracking=new a0,this._callbacks=new Map,this._projector=TJ(),this._hiddenProjector=TJ()}get needsRender(){return this.items.length>0}get updating(){var e,t;return(t=(e=this._watchUpdatingTracking)==null?void 0:e.updating)!=null?t:!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const r of t.added){const i=()=>r.render();this._callbacks.set(r,i),this._projector.append(this.surface,i)}for(const r of t.removed){const i=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(i.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,r=this._hiddenProjector;let i=null;const s=()=>(i=e.render(),i);r.append(t,s),r.renderNow();const n={left:0,top:0,right:0,bottom:0};if(i&&i.domNode){const o=i.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(r.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const r=this.computeBoundingRect(e),i=this.computeBoundingRect(t);return Math.max(r.left,i.left)<=Math.min(r.right,i.right)&&Math.max(r.top,i.top)<=Math.min(r.bottom,i.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(r=>r.visible))return;const t=e.getContext("2d");t.save(),t.font=this._fontString(),this.items.forEach(r=>{t.save(),r.renderCanvas(t),t.restore()}),t.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};u([h({readOnly:!0})],Db.prototype,"surface",void 0),u([h({readOnly:!0})],Db.prototype,"items",void 0),u([h({readOnly:!0})],Db.prototype,"needsRender",null),u([h({readOnly:!0})],Db.prototype,"_watchUpdatingTracking",void 0),u([h({readOnly:!0})],Db.prototype,"updating",null),Db=u([I("esri.views.overlay.ViewOverlay")],Db);const Zme=Db;function UM(e,t,r,i){let s=null,n=1e3;typeof t=="number"?(n=t,i=r):(s=t!=null?t:null,n=r);let o,a=0;const l=()=>{a=0,e.apply(i,o)},c=(...d)=>{s&&s.apply(i,d),o=d,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}function cat(e,t,r){return e.units[t][r]}function r4(e,t,r,i=2,s="abbr"){return`${Yh(t,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:t>0?"never":"exceptZero"})} ${cat(e,r,s)}`}function DBt(e,t,r,i=2,s="abbr"){const n=fMe(t,r);return r4(e,zn(t,r,n),n,i,s)}function LBt(e,t,r,i=2,s="abbr"){const n=mMe(t,r);return r4(e,zn(t,r,n),n,i,s)}function NBt(e,t,r,i=2,s="abbr"){const n=gMe(t,r);return r4(e,zn(t,r,n),n,i,s)}function FBt(e,t,r,i=2,s="abbr"){const n=yMe(t,r);return r4(e,zn(t,r,n),n,i,s)}const Jme=["B","kB","MB","GB","TB"];function uat(e,t){let r=t===0?0:Math.floor(Math.log(t)/Math.log(kR.KILOBYTES));r=_e(r,0,Jme.length-1);const i=Yh(t/kR.KILOBYTES**r,{maximumFractionDigits:2});return g0(e.units.bytes[Jme[r]],{fileSize:i})}function dat(e){const{exifInfo:t,exifName:r,tagName:i}=e;if(!t||!r||!i)return null;const s=t.find(n=>n.name===r);return s?hat({tagName:i,tags:s.tags}):null}function hat(e){const{tagName:t,tags:r}=e;if(!r||!t)return null;const i=r.find(s=>s.name===t);return i&&i.value||null}var yte;const pat={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let Ku=yte=class extends fe{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=dat({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return pat[t]||null}clone(){return new yte({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([h({type:String})],Ku.prototype,"contentType",void 0),u([h()],Ku.prototype,"exifInfo",void 0),u([h({readOnly:!0})],Ku.prototype,"orientationInfo",null),u([h({type:bs})],Ku.prototype,"id",void 0),u([h({type:String})],Ku.prototype,"globalId",void 0),u([h({type:String})],Ku.prototype,"keywords",void 0),u([h({type:String})],Ku.prototype,"name",void 0),u([h({json:{read:!1}})],Ku.prototype,"parentGlobalId",void 0),u([h({json:{read:!1}})],Ku.prototype,"parentObjectId",void 0),u([h({type:bs})],Ku.prototype,"size",void 0),u([h({json:{read:!1}})],Ku.prototype,"url",void 0),Ku=yte=u([I("esri.layers.support.AttachmentInfo")],Ku);const fat=Ku,mat="esri.widgets.Feature.support.featureUtils",Kme=te.getLogger(mat),gat=/href=(""|'')/gi,yat=/(\{([^\{\r\n]+)\})/g,_at=/\'/g,_3e=/^\s*expression\//i,vat=/(\n)/gi,bat=/[\u00A0-\u9999<>\&]/gim,wat=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,xat=/^(?:mailto:|tel:)/,v3e="relationships/",_te=iE("short-date-short-time");function b3e(e){if(!C(e))return e.get("sourceLayer")||e.get("layer")}async function sV(e,t){return typeof e=="function"?e.call(null,t):e}function w3e(e=""){if(e)return!xat.test(e.trim().toLowerCase())}function Uae(e){return!!e&&_3e.test(e)}function Tat(e,t){if(!Uae(t)||!e)return null;const r=t.replace(_3e,"").toLowerCase();let i;return e.some(s=>s.name.toLowerCase()===r&&(i=s,!0)),i}function x3e(e,t){const r=Tat(t,e==null?void 0:e.fieldName);return r?r.title||null:e?e.label||e.fieldName:null}function Sat(e,t){const r=t.get(e.toLowerCase());return`{${r&&r.fieldName||e}}`}function Eat(e){return e.replace(gat,"")}function wN(e,t){const r=Bae(t,e);return r?r.name:e}function Cat(e,t){return e&&e.map(r=>wN(r,t))}function Bae(e,t){return e&&typeof e.getField=="function"?e.getField(t):null}function T3e(e){return`${e}`.trim()}function x2({attributes:e,globalAttributes:t,layer:r,text:i,expressionAttributes:s,fieldInfoMap:n}){return i?vte({formattedAttributes:t,template:Rat(i,{...t,...s,...e},r),fieldInfoMap:n}):""}function vte({formattedAttributes:e,template:t,fieldInfoMap:r}){return T3e(Eat(g0(g0(t,i=>Sat(i,r)),e)))}function Aat(e,t,r=!1){const i=t[e];if(typeof i=="string"){const s="%27",n=(r?encodeURIComponent(i):i).replace(_at,s);t[e]=n}}function Oat(e,t=!1){const r={...e};return Object.keys(r).forEach(i=>Aat(i,r,t)),r}function Mat(e,t,r){const i=(t=T3e(t))&&t[0]!=="{";return g0(e,Oat(r,i))}function bte(e,t){return e.replace(yat,(r,i,s)=>{const n=Bae(t,s);return n?`{${n.name}}`:i})}function Rat(e,t,r){const i=bte(e,r);return i&&i.replace(wat,(s,n,o)=>Mat(s,n||o,t))}function Iat(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const r=Number(e);if(!isNaN(r))return r}return e}function Pat(e){return(e==null?void 0:e.type)==="feature"}function Qme(e){return!!(e!=null&&e.layer)}function $at(e){return(e==null?void 0:e.type)==="map-image"}function Dat(e,t){var c;const r=t.fieldInfos,i=t.fieldName,s=(c=S3e(r,i))==null?void 0:c.clone(),n=t.preventPlacesFormatting,o=t.layer,a=Bae(o,i);if(s&&(a==null?void 0:a.type)==="date"){const d=s.format||new HO;d.dateFormat=d.dateFormat||"short-date-short-time",d.dateTimeFormatOptions=!Qme(o)&&Pat(o)&&o.datesInUnknownTimezone||Qme(o)&&$at(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=d}const l=s&&s.format;return typeof e=="string"&&eOe(i)&&l?l.formatRasterPixelValue(e):typeof(e=Iat(e,l))=="string"||e==null||l==null?i4(e):n?Yh(e,{...K2e(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}function S3e(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let i;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==r)&&(i=s,!0)),i}function Lat({fieldName:e,graphic:t,layer:r}){if(yv(e)||!r||typeof r.getFeatureType!="function")return null;const{typeIdField:i}=r;if(!i||e!==i)return null;const s=r.getFeatureType(t);return s?s.name:null}function Nat({fieldName:e,value:t,graphic:r,layer:i}){if(yv(e)||!i||typeof i.getFieldDomain!="function")return null;const s=i.getFieldDomain(e,{feature:r});return s&&s.type==="coded-value"?s.getName(t):null}function Fat(e,t){const{creatorField:r,creationDateField:i,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if(typeof o=="number"){const l=t[s];return{type:"edit",date:_s(o,_te),user:l}}const a=t[i];if(typeof a=="number"){const l=t[r];return{type:"create",date:_s(a,_te),user:l}}return null}function kat(e,t){const r=new Map;return e&&e.forEach(i=>{const s=wN(i.fieldName,t);i.fieldName=s,r.set(s.toLowerCase(),i)}),r}function ege(e){const t=[];if(!e)return t;const{fieldInfos:r,content:i}=e;return r&&t.push(...r),i&&Array.isArray(i)&&i.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function zae(e){return e.replace(bat,t=>`&#${t.charCodeAt(0)};`)}function i4(e){return typeof e=="string"?e.replace(vat,'<br class="esri-text-new-line" />'):e}function E3e(e){const{value:t,fieldName:r,fieldInfos:i,fieldInfoMap:s,layer:n,graphic:o}=e;if(t==null)return"";const a=Nat({fieldName:r,value:t,graphic:o,layer:n});if(a)return a;const l=Lat({fieldName:r,graphic:o,layer:n});if(l)return l;if(s.get(r.toLowerCase()))return Dat(t,{fieldInfos:i||Array.from(s.values()),fieldName:r,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(r)?_s(t,_te):i4(t)}function Yq({fieldInfos:e,attributes:t,layer:r,graphic:i,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>jat({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:e,layer:r})),Object.keys(t).forEach(a=>{const l=t[a];o[a]=E3e({fieldName:a,fieldInfos:e,fieldInfoMap:s,layer:r,value:l,graphic:i})}),o}async function Uat(e,t){var d,p;const{layer:r,graphic:i,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=e,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:r,graphic:i,objectId:l,requiredFields:s};return Kme.warn(f,m),null}if(!((p=(d=r.capabilities)==null?void 0:d.operations)!=null&&p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:r,graphic:i,requiredFields:s,returnGeometry:o};return Kme.warn(f,m),null}const c=r.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[r.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await r.queryFeatures(c,t)).features[0]}async function Bat(e){var i;if(!((i=e.expressionInfos)!=null&&i.length))return!1;const t=await b0(),{arcadeUtils:{hasGeometryFunctions:r}}=t;return r(e)}async function zat({graphic:e,popupTemplate:t,layer:r,spatialReference:i},s){if(!r||!t||(typeof r.load=="function"&&await r.load(s),!e.attributes))return;const n=e.attributes[r.objectIdField];if(n==null)return;const o=[n],a=await t.getRequiredFields(r.fieldsIndex),l=qYe(a,e),c=l?[]:a,d=t.returnGeometry||await Bat(t);if(l&&!d)return;const p=await Uat({layer:r,graphic:e,outFields:c,objectIds:o,returnGeometry:d,spatialReference:i},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes={...e.attributes,...p.attributes}))}function yv(e=""){return!!e&&e.includes(v3e)}function Vat(e){return e?`${v3e}${e.layerId}/${e.fieldName}`:""}function tge({attributes:e,graphic:t,relatedInfo:r,fieldInfos:i,fieldInfoMap:s,layer:n}){e&&t&&r&&Object.keys(t.attributes).forEach(o=>{const a=Vat({layerId:r.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=E3e({fieldName:a,fieldInfos:i,fieldInfoMap:s,layer:n,value:l,graphic:t})})}function jat({attributes:e,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(n=>tge({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:s})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(n=>tge({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:s})))}const rge=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},C3e=({layer:e,method:t,query:r,definitionExpression:i})=>{var o,a;if(!((a=(o=e.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||t==="attachments")return;const s=v(r.where)&&r.where,n=v(r.geometry)&&r.geometry;rge(i)||rge(s)||(n==null?void 0:n.type)==="extent"||r.resultType==="tile"||(r.cacheHint=!0)},Gat=({query:e,layer:t,method:r})=>{C3e({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},Hat=({queryPayload:e,layer:t,method:r})=>{C3e({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})};function qat(e,t,r){return e&&t&&r?ige(e.allLayers,t,r)||ige(e.allTables,t,r):null}function ige(e,t,r){return e.find(i=>i!==t&&i.type==="feature"&&i.url===t.url&&i.layerId===r.relatedTableId)}const sge={editing:!1,operations:{add:!0,update:!0,delete:!0}},A3e=Ge.ofType(fat);let Qu=class extends be{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...sge},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new A3e,this.fileInfos=new Ge,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(ie(()=>this.graphic,()=>this._graphicChanged(),pt))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...sge,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const t=e.layer||e.sourceLayer;return(t==null?void 0:t.loaded)&&"capabilities"in t&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new z("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getObjectId(),i=new Eee({objectIds:[r],returnMetadata:!0}),s=[],n=e.queryAttachments(i).then(a=>a[r]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e,t=this.graphic){const{_attachmentLayer:r,attachmentInfos:i,abilities:s}=this;if(!t)throw new z("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new z("invalid-abilities","addAttachment(): add abilities are required.");if(!r||typeof r.addAttachment!="function")throw new z("invalid-layer","addAttachment(): A valid layer is required.");const n=r.addAttachment(t,e).then(a=>this._queryAttachment(a.objectId,t)),o=await n;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:r,graphic:i,abilities:s}=this;if(!e)throw new z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new z("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new z("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(i,[e.id]).then(()=>e),o=await n;return r.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:r,attachmentInfos:i,graphic:s,abilities:n}=this;if(!e)throw new z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new z("invalid-abilities","updateAttachment(): Update abilities are required.");const o=i.findIndex(c=>c===t);if(!r||typeof r.updateAttachment!="function")throw new z("invalid-layer","updateAttachment(): A valid layer is required.");const a=r.updateAttachment(s,t.id,e).then(c=>this._queryAttachment(c.objectId)),l=await a;return i.splice(o,1,l),l}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;const r={file:e,form:t};return this.fileInfos.add(r),r}updateFile(e,t,r=this.activeFileInfo){if(!e||!t||!r)return null;const i=this.fileInfos.findIndex(s=>r===s);return i>-1&&this.fileInfos.splice(i,1,{file:e,form:t}),this.fileInfos.items[i]}deleteFile(e){var r;const t=this.fileInfos.find(i=>i.file===e);return(r=this.fileInfos.remove(t))!=null?r:null}async _queryAttachment(e,t){if(!e)throw new z("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:r}=this,i=this._getObjectId(t),s=new Eee({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return r.queryAttachments(s).then(n=>n[i][0])}_getObjectId(e=this.graphic){var t;return(t=e==null?void 0:e.getObjectId())!=null?t:null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=b3e(e);this._attachmentLayer=t?t.type==="scene"&&v(t.associatedLayer)?t.associatedLayer:t:null}};u([h()],Qu.prototype,"abilities",void 0),u([Gt("abilities")],Qu.prototype,"castAbilities",null),u([h()],Qu.prototype,"activeAttachmentInfo",void 0),u([h()],Qu.prototype,"activeFileInfo",void 0),u([h({readOnly:!0,type:A3e})],Qu.prototype,"attachmentInfos",void 0),u([h()],Qu.prototype,"fileInfos",void 0),u([h({type:_i})],Qu.prototype,"graphic",void 0),u([h()],Qu.prototype,"mode",void 0),u([h({readOnly:!0})],Qu.prototype,"state",null),u([h()],Qu.prototype,"filesEnabled",void 0),u([h({readOnly:!0})],Qu.prototype,"supportsResizeAttachments",null),Qu=u([I("esri.widgets.Attachments.AttachmentsViewModel")],Qu);const Vae=Qu;function nge(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function Wat(e){const t=ui("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}const oge={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Ke={base:"esri-attachments",loaderContainer:"esri-attachments__loader-container",loader:"esri-attachments__loader",fadeIn:"esri-attachments--fade-in",container:"esri-attachments__container",containerList:"esri-attachments__container--list",containerPreview:"esri-attachments__container--preview",actions:"esri-attachments__actions",deleteButton:"esri-attachments__delete-button",addAttachmentButton:"esri-attachments__add-attachment-button",errorMessage:"esri-attachments__error-message",items:"esri-attachments__items",item:"esri-attachments__item",itemButton:"esri-attachments__item-button",itemMask:"esri-attachments__item-mask",itemMaskIcon:"esri-attachments__item-mask--icon",itemImage:"esri-attachments__image",itemImageResizable:"esri-attachments__image--resizable",itemLabel:"esri-attachments__label",itemFilename:"esri-attachments__filename",itemChevronIcon:"esri-attachments__item-chevron-icon",itemLink:"esri-attachments__item-link",itemLinkOverlay:"esri-attachments__item-link-overlay",itemLinkOverlayIcon:"esri-attachments__item-link-overlay-icon",itemEditIcon:"esri-attachments__item-edit-icon",itemAddIcon:"esri-attachments__item-add-icon",itemAddButton:"esri-attachments__item-add-button",formNode:"esri-attachments__form-node",fileFieldset:"esri-attachments__file-fieldset",fileLabel:"esri-attachments__file-label",fileName:"esri-attachments__file-name",fileInput:"esri-attachments__file-input",metadata:"esri-attachments__metadata",metadataFieldset:"esri-attachments__metadata-fieldset",progressBar:"esri-attachments__progress-bar",esriWidget:"esri-widget",esriButton:"esri-button",buttonDisabled:"esri-button--disabled",esriButtonSecondary:"esri-button--secondary",esriButtonTertiary:"esri-button--tertiary",esriButtonThird:"esri-button--third",esriButtonSmall:"esri-button--small",esriButtonHalf:"esri-button--half",empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},Zq=window.CSS;let fc=class extends Ss{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new Vae,this.visibleElements={...oge},this._supportsImageOrientation=Zq&&Zq.supports&&Zq.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.addHandles([ms(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),ms(()=>{var e;return(e=this.viewModel)==null?void 0:e.fileInfos},"change",()=>this.scheduleRender()),ie(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),pt)])}loadDependencies(){return Promise.all([re(()=>import("./calcite-icon.85645cae.js"),["assets/calcite-icon.85645cae.js","assets/icon.1cb7558b.js","assets/observers.2da64440.js"])])}get abilities(){return this.viewModel.abilities}set abilities(e){this.viewModel.abilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{...oge,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),t.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new z("attachments:add-attachment",this.messages.addErrorMessage,r)),r})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),t.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new z("attachments:delete-attachment",this.messages.deleteErrorMessage,r)),r})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(r=>(this._set("submitting",!1),this._set("error",null),e.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new z("attachments:update-attachment",this.messages.updateErrorMessage,r)),r})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){const t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo.file);return this.viewModel.mode="view",t}render(){const{submitting:e,viewModel:t}=this,{state:r}=t;return P("div",{class:this.classes(Ke.base,Ke.esriWidget)},e?this.renderProgressBar():null,r==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?P("div",{key:"error-message",class:Ke.errorMessage},e.message):null}renderAttachments(){const{activeFileInfo:e,mode:t,activeAttachmentInfo:r}=this.viewModel;return t==="add"?this.renderAddForm():t==="edit"?this.renderDetailsForm(r||e):this.renderAttachmentContainer()}renderLoading(){return P("div",{class:Ke.loaderContainer,key:"loader"},P("div",{class:Ke.loader}))}renderProgressBar(){return this.visibleElements.progressBar?P("div",{class:Ke.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,r=e||!t,i=this.visibleElements.cancelAddButton?P("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Ke.esriButton,Ke.esriButtonTertiary,Ke.esriButtonSmall,Ke.esriButtonHalf,e&&Ke.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?P("button",{type:"submit",disabled:r,class:this.classes(Ke.esriButton,Ke.esriButtonSecondary,Ke.esriButtonSmall,Ke.esriButtonHalf,{[Ke.buttonDisabled]:r})},this.messages.add):null,n=t?P("span",{key:"file-name",class:Ke.fileName},t.name):null,o=P("form",{bind:this,afterCreate:af,afterRemoved:Lhe,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},P("fieldset",{class:Ke.fileFieldset},n,P("label",{class:this.classes(Ke.fileLabel,Ke.esriButton,Ke.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,P("input",{class:Ke.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,i);return P("div",{key:"add-form-container",class:Ke.formNode},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:r,selectedFile:i,submitting:s}=this,{abilities:n}=r,o=s||!i;let a,l,c,d;i?(a=i.type,l=i.name,c=i.size):"file"in e?(a=e.file.type,l=e.file.name,c=e.file.size):(a=e.contentType,l=e.name,c=e.size,d=e.url);const p=n.editing&&n.operations.delete&&t.deleteButton?P("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:T=>this._submitDeleteAttachment(T,e),class:this.classes(Ke.esriButton,Ke.esriButtonSmall,Ke.esriButtonTertiary,Ke.deleteButton,{[Ke.buttonDisabled]:s})},this.messages.delete):void 0,f=n.editing&&n.operations.update&&t.updateButton?P("button",{disabled:o,key:"update-button",type:"submit",class:this.classes(Ke.esriButton,Ke.esriButtonSmall,Ke.esriButtonThird,{[Ke.buttonDisabled]:o})},this.messages.update):void 0,m=this.visibleElements.cancelUpdateButton?P("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Ke.esriButton,Ke.esriButtonSmall,Ke.esriButtonTertiary,Ke.esriButtonThird,{[Ke.buttonDisabled]:s})},this.messages.cancel):void 0,g=n.editing&&n.operations.update?P("fieldset",{key:"file",class:Ke.fileFieldset},P("span",{key:"file-name",class:Ke.fileName},l),P("label",{class:this.classes(Ke.fileLabel,Ke.esriButton,Ke.esriButtonSecondary)},this.messages.changeFile,P("input",{class:Ke.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,_=P("fieldset",{key:"size",class:Ke.metadataFieldset},P("label",null,uat(this.messagesUnits,c))),x=P("fieldset",{key:"content-type",class:Ke.metadataFieldset},P("label",null,a)),b=v(d)?P("a",{class:Ke.itemLink,href:d,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),P("div",{class:Ke.itemLinkOverlay},P("span",{class:Ke.itemLinkOverlayIcon},P("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),w=P("form",{bind:this,afterCreate:af,afterRemoved:Lhe,"data-node-ref":"_updateAttachmentForm",onsubmit:T=>this._submitUpdateAttachment(T,e)},P("div",{class:Ke.metadata},_,x),g,P("div",{class:Ke.actions},p,m,f));return P("div",{key:"edit-form-container",class:Ke.formNode},b,w)}renderImageMask(e,t){return"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,t)}renderGenericImageMask(e,t){const{supportsResizeAttachments:r}=this.viewModel,i=Wat(t),s={[Ke.itemImageResizable]:r};return P("div",{class:this.classes(Ke.itemMaskIcon,Ke.itemMask)},P("img",{title:e,alt:e,src:i,class:this.classes(s,Ke.itemImage)}))}renderImageMaskForAttachment(e,t){const{supportsResizeAttachments:r}=this.viewModel,{contentType:i,name:s,url:n}=e;if(!r||!nge(i))return this.renderGenericImageMask(s,i);const o=this._getCSSTransform(e),a=o?{transform:o,"image-orientation":"none"}:{},l=`${n}${n.includes("?")?"&":"?"}w=${t}`,c={[Ke.itemImageResizable]:r};return P("div",{class:this.classes(Ke.itemMask)},P("img",{styles:a,alt:s,title:s,src:l,class:this.classes(c,Ke.itemImage)}))}renderFile(e){const{file:t}=e;return P("li",{class:Ke.item,key:t},P("button",{key:"details-button",bind:this,class:Ke.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:()=>this._startEditFile(e),type:"button"},this.renderImageMask(e),P("label",{class:Ke.itemLabel},P("span",{class:Ke.itemFilename},t.name||this.messages.noTitle),P("span",{"aria-hidden":"true",class:this.classes(Ke.itemChevronIcon,Fh(this.container)?Ke.iconLeft:Ke.iconRight)}))))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:r,effectiveDisplayType:i}=this,{abilities:s,supportsResizeAttachments:n}=r,{contentType:o,name:a,url:l}=e,c=this.renderImageMask(e,t==="list"?48:400),d=s.editing?P("span",{"aria-hidden":"true",class:this.classes(Ke.itemChevronIcon,Fh(this.container)?Ke.iconLeft:Ke.iconRight)}):null,p=[c,i==="preview"&&n&&nge(o)?null:P("label",{class:Ke.itemLabel},P("span",{class:Ke.itemFilename},a||this.messages.noTitle),d)],f=s.editing?P("button",{key:"details-button",bind:this,class:Ke.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},p):P("a",{key:"details-link",class:Ke.itemButton,href:l,target:"_blank"},p);return P("li",{class:Ke.item,key:e},f)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:r}=this,{attachmentInfos:i,abilities:s,fileInfos:n}=t,o=!!(i!=null&&i.length),a=!!(n!=null&&n.length),l={[Ke.containerList]:e!=="preview",[Ke.containerPreview]:e==="preview"},c=s.editing&&s.operations.add&&r.addButton?P("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(Ke.esriButton,Ke.esriButtonTertiary,Ke.addAttachmentButton),type:"button"},P("span",{"aria-hidden":"true",class:this.classes(Ke.itemAddIcon,Ke.iconPlus)}),this.messages.add):void 0,d=o?P("ul",{key:"attachments-list",class:Ke.items},i.toArray().map(m=>this.renderAttachmentInfo({attachmentInfo:m,displayType:e}))):void 0,p=a?P("ul",{key:"file-list",class:Ke.items},n.toArray().map(m=>this.renderFile(m))):void 0,f=a||o?void 0:P("div",{class:Ke.empty},this.messages.noAttachments);return P("div",{key:"attachments-container",class:this.classes(Ke.container,l)},d,p,f,c)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,r=t&&t.files&&t.files.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,t){e.preventDefault(),"file"in t?this.deleteFile(t.file):this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){const{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}};u([h()],fc.prototype,"abilities",null),u([h()],fc.prototype,"displayType",void 0),u([h({readOnly:!0})],fc.prototype,"effectiveDisplayType",null),u([h()],fc.prototype,"graphic",null),u([h()],fc.prototype,"label",null),u([h(),xi("esri/widgets/Attachments/t9n/Attachments")],fc.prototype,"messages",void 0),u([h(),xi("esri/core/t9n/Units")],fc.prototype,"messagesUnits",void 0),u([h({readOnly:!0})],fc.prototype,"selectedFile",void 0),u([h({readOnly:!0})],fc.prototype,"submitting",void 0),u([h({readOnly:!0})],fc.prototype,"error",void 0),u([h({type:Vae})],fc.prototype,"viewModel",void 0),u([h()],fc.prototype,"visibleElements",void 0),u([Gt("visibleElements")],fc.prototype,"castVisibleElements",null),fc=u([I("esri.widgets.Attachments")],fc);const Xat=fc;let T$=class extends Vae{constructor(e){super(e),this.description=null,this.title=null}};u([h()],T$.prototype,"description",void 0),u([h()],T$.prototype,"title",void 0),T$=u([I("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],T$);const jae=T$,Jq={base:"esri-feature-element-info",title:"esri-feature-element-info__title",description:"esri-feature-element-info__description"};let iO=class extends Ss{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return P("div",{class:Jq.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?P(Sh,{level:this.headingLevel,class:Jq.title},e):null}renderDescription(){const{description:e}=this;return e?P("div",{key:"description",class:Jq.description},e):null}};u([h()],iO.prototype,"description",void 0),u([h()],iO.prototype,"headingLevel",void 0),u([h()],iO.prototype,"title",void 0),iO=u([I("esri.widgets.Feature.support.FeatureElementInfo")],iO);const Kj=iO,Yat={base:"esri-feature-attachments"};let hy=class extends Ss{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new Xat,this.headingLevel=2,this.viewModel=new jae}initialize(){this._featureElementInfo=new Kj,this.addHandles([ie(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),pt),ie(()=>{var e;return(e=this.viewModel)==null?void 0:e.graphic},e=>this.attachmentsWidget.graphic=e,pt)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var t;const{attachmentsWidget:e}=this;return P("div",{class:Yat.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:r}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:r})}};u([h({readOnly:!0})],hy.prototype,"attachmentsWidget",void 0),u([h()],hy.prototype,"description",null),u([h()],hy.prototype,"displayType",null),u([h()],hy.prototype,"graphic",null),u([h()],hy.prototype,"headingLevel",void 0),u([h()],hy.prototype,"title",null),u([h({type:jae})],hy.prototype,"viewModel",void 0),hy=u([I("esri.widgets.Feature.FeatureAttachments")],hy);const Zat=hy;let Lb=class extends $0(be){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(ie(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},pt))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:r}=this;e&&(sV(r,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,r=sV(e,{graphic:t}).catch(()=>null);this._loadingPromise=r,this.notifyChange("state");const i=await r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",i))}};u([h({readOnly:!0})],Lb.prototype,"created",void 0),u([h()],Lb.prototype,"creator",void 0),u([h()],Lb.prototype,"destroyer",void 0),u([h({type:_i})],Lb.prototype,"graphic",void 0),u([h({readOnly:!0})],Lb.prototype,"state",null),Lb=u([I("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Lb);const nV=Lb,Kq={base:"esri-feature-content",loaderContainer:"esri-feature-content__loader-container",loader:"esri-feature-content__loader"};let sO=class extends Ss{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=r=>{Array.from(r.querySelectorAll("a")).forEach(i=>{w3e(i.href)&&!i.hasAttribute("target")&&i.setAttribute("target","_blank")})}}get creator(){return this.viewModel.creator}set creator(e){this.viewModel.creator=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}renderLoading(){return P("div",{class:Kq.loaderContainer,key:"loader"},P("div",{class:Kq.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?P("div",{key:e,bind:e,afterCreate:this._attachToNode}):Oz(e)?P("div",{key:e},!e.destroyed&&e.render()):P("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return P("div",{class:Kq.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};u([h()],sO.prototype,"creator",null),u([h()],sO.prototype,"graphic",null),u([h({type:nV})],sO.prototype,"viewModel",void 0),sO=u([I("esri.widgets.Feature.FeatureContent")],sO);const AB=sO;let M_=class extends be{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,r=[];return t==null||t.forEach(i=>{if(!(!i.hasOwnProperty("visible")||i.visible))return;const s=i.clone();s.label=x3e(s,e),r.push(s)}),r}};u([h()],M_.prototype,"attributes",void 0),u([h({type:[cOe]})],M_.prototype,"expressionInfos",void 0),u([h()],M_.prototype,"description",void 0),u([h({type:[GF]})],M_.prototype,"fieldInfos",void 0),u([h({readOnly:!0})],M_.prototype,"formattedFieldInfos",null),u([h()],M_.prototype,"title",void 0),M_=u([I("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],M_);const Qj=M_,Jat=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Kat(e){let t=null;return Jat.some(r=>(r.pattern.test(e)&&(t=r),!!t)),t}function Qat(e,t){if(typeof t!="string"||!t)return t;const r=Kat(t);if(!r)return t;const i=t.match(r.pattern),s=i&&i[2],n=g0(g0(r.label,{messages:e,hierPart:s}),{appName:r.appName}),o=r.target?` target="${r.target}"`:"",a=r.target==="_blank"?' rel="noreferrer"':"";return t.replace(r.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const AP={base:"esri-feature-fields",fieldHeader:"esri-feature-fields__field-header",fieldData:"esri-feature-fields__field-data",fieldDataDate:"esri-feature-fields__field-data--date",esriTable:"esri-widget__table"};let dm=class extends Ss{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new Qj,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Kj,this.addHandles(ie(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),pt))}destroy(){this._featureElementInfo.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}renderFieldInfo(e,t){const{attributes:r}=this.viewModel,i=e.fieldName,s=e.label||i,n=r?r[i]==null?"":r[i]:"",o=!(!e.format||!e.format.dateFormat),a=typeof n=="number"&&!o?this._forceLTR(n):Qat(this.messagesURIUtils,n),l={[AP.fieldDataDate]:o};return P("tr",{key:`fields-element-info-row-${i}-${t}`},P("th",{key:`fields-element-info-row-header-${i}-${t}`,class:AP.fieldHeader,innerHTML:s}),P("td",{key:`fields-element-info-row-data-${i}-${t}`,class:this.classes(AP.fieldData,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?P("table",{class:AP.esriTable,summary:this.messages.fieldsSummary},P("tbody",null,e.map((t,r)=>this.renderFieldInfo(t,r)))):null}render(){var e;return P("div",{class:AP.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};u([h()],dm.prototype,"attributes",null),u([h()],dm.prototype,"description",null),u([h()],dm.prototype,"expressionInfos",null),u([h()],dm.prototype,"fieldInfos",null),u([h()],dm.prototype,"title",null),u([h({type:Qj,nonNullable:!0})],dm.prototype,"viewModel",void 0),u([h(),xi("esri/widgets/Feature/t9n/Feature")],dm.prototype,"messages",void 0),u([h(),xi("esri/widgets/support/t9n/uriUtils")],dm.prototype,"messagesURIUtils",void 0),dm=u([I("esri.widgets.Feature.FeatureFields")],dm);const O3e=dm,elt={maximumFractionDigits:20};function tlt(e){return Yh(e,elt)}class rlt{constructor(t,r){this._storage=new Doe,this._storage.maxSize=t,r&&this._storage.registerRemoveFunc("",r)}put(t,r){this._storage.put(t,r,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}new rlt(1e3);new Ze([128,128,128]);const age=/\/resource\/(.*?)\.svg$/,ilt=new Ze("white");function slt(e,t){const r=gd(t.resource).href;return!pe("esri-canvas-svg-support")&&e.styleOrigin&&age.test(r)?r.replace(age,"/resource/png/$1.png"):r}function PC(e,t){if(!e)return null;let r=null;return OR(e)?r=nlt(e):mj(e)&&(r=e.color?new Ze(e.color):null),r?xN(r,t):null}function nlt(e){const t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach(i=>{var s;i.type==="object"&&((s=i.resource)==null?void 0:s.href)!=null||(r=i.type==="water"?i.color:v(i.material)?i.material.color:null)}),r?new Ze(r):null}function xN(e,t){if(t==null||e==null)return e;const r=e.toRgba();return r[3]=r[3]*t,new Ze(r)}function olt(e,t,r){const i=e.symbolLayers;if(!i)return;const s=n=>{var a;const o=v(n)?n:null;return xN(t=(a=t!=null?t:o)!=null?a:r!=null?ilt:null,r)};i.forEach(n=>{var o;if(n.type!=="object"||((o=n.resource)==null?void 0:o.href)==null||t)if(n.type==="water")n.color=s(n.color);else{const a=v(n.material)?n.material.color:null,l=s(a);C(n.material)?n.material=new Gh({color:l}):n.material.color=l,r!=null&&"outline"in n&&v(n.outline)&&v(n.outline.color)&&(n.outline.color=xN(n.outline.color,r))}})}function alt(e,t,r){(t=t!=null?t:e.color)&&(e.color=xN(t,r)),r!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=xN(e.outline.color,r))}function Qq(e,t,r){e&&(t||r!=null)&&(t&&(t=new Ze(t)),OR(e)?olt(e,t,r):mj(e)&&alt(e,t,r))}async function llt(e,t){const r=e.symbolLayers;r&&await tj(r,async i=>clt(i,t))}async function clt(e,t){switch(e.type){case"extrude":dlt(e,t);break;case"icon":case"line":case"text":ult(e,t);break;case"path":plt(e,t);break;case"object":await hlt(e,t)}}function ult(e,t){const r=M3e(t);v(r)&&(e.size=r)}function M3e(e){for(const t of e)if(typeof t=="number")return t;return null}function dlt(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function hlt(e,t){const{resourceSize:r,symbolSize:i}=await flt(e),s=R3e(t,r,i);e.width=WD(t[0],i[0],r[0],s),e.depth=WD(t[1],i[1],r[1],s),e.height=WD(t[2],i[2],r[2],s)}function plt(e,t){const r=R3e(t,Xy,[e.width,void 0,e.height]);e.width=WD(t[0],e.width,1,r),e.height=WD(t[2],e.height,1,r)}function R3e(e,t,r){for(let i=0;i<3;i++){const s=e[i];switch(s){case"symbol-value":{const n=r[i];return n!=null?n/t[i]:1}case"proportional":break;default:if(s&&t[i])return s/t[i]}}return 1}async function flt(e){const t=await re(()=>import("./symbolLayerUtils.f5b73ac6.js"),[]),r=await t.computeObjectLayerResourceSize(e,10),{width:i,height:s,depth:n}=e,o=[i,n,s];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function WD(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return t!=null?t:r;default:return e}}function mlt(e,t){const r=M3e(t);if(!C(r))switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const i=e.width/e.height;i>1?(e.width=r,e.height=r*i):(e.width=r*i,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}async function glt(e,t){if(e&&t)return OR(e)?llt(e,t):void(mj(e)&&mlt(e,t))}function ylt(e,t,r){if(e&&t!=null)if(OR(e)){const i=e.symbolLayers;i&&i.forEach(s=>{if(s&&s.type==="object")switch(r){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else mj(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}function kBt(e){return v(e)&&e.type==="polygon-3d"&&e.symbolLayers.some(t=>t.type==="extrude")}const _lt="<",vlt=">",blt=iE("short-date");function wlt(e,t,r,i){let s="";t===0?s=`${_lt} `:t===r&&(s=`${vlt} `);let n=null;return n=i?_s(e,blt):tlt(e),s+n}const xlt=new Ze([64,64,64]);function Tlt(e,t){const r=[],i=e.length-1;return e.length===5?r.push(0,2,4):r.push(0,i),e.map((s,n)=>r.includes(n)?wlt(s,n,i,t):null)}async function Slt(e,t,r){let i=!1,s=[],n=[];if(e.stops){const c=e.stops;s=c.map(d=>d.value),i=c.some(d=>!!d.label),i&&(n=c.map(d=>d.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=i?null:Tlt(s,r);return(await Promise.all(s.map(async(c,d)=>({value:c,color:e.type==="opacity"?await Elt(c,e,t):(await re(()=>Promise.resolve().then(()=>$oe),void 0)).getColor(e,c),label:i?n[d]:l[d]})))).reverse()}async function Elt(e,t,r=xlt){const i=new Ze(r),s=(await re(()=>Promise.resolve().then(()=>$oe),void 0)).getOpacity(t,e);return s!=null&&(i.a=s),i}function Clt(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(i=>{var s;return((s=i.color)==null?void 0:s.a)>0});let r=t.length-1;if(t&&t[0]){const i=t[r];i&&i.ratio!==1&&(t.push(new ND({ratio:1,color:i.color})),r++)}return t.map((i,s)=>{var o,a;let n="";return s===0?n=((o=e.legendOptions)==null?void 0:o.minLabel)||"low":s===r&&(n=((a=e.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:i.color,label:n,ratio:i.ratio}}).reverse()}te.getLogger("esri.renderers.support.utils");async function qd(e,t,r){Hse(e,t,()=>[]).push(...r)}async function Alt(e){var r,i,s,n;const t=new Map;if(!e)return t;if("visualVariables"in e&&e.visualVariables){const o=e.visualVariables.filter(a=>a.type==="color");for(const a of o){const l=(await Slt(a)).map(c=>c.color);await qd(t,a.field||a.valueExpression,l)}}if(e.type==="heatmap"){const o=Clt(e).map(a=>a.color);await qd(t,e.field||e.valueExpression,o)}else if(e.type==="pie-chart"){for(const o of e.attributes)await qd(t,o.field||o.valueExpression,[o.color]);await qd(t,"default",[(r=e==null?void 0:e.othersCategory)==null?void 0:r.color,PC(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const o of e.attributes)await qd(t,o.field||o.valueExpression,[o.color]);await qd(t,"default",[e.backgroundColor])}else if(e.type==="unique-value")if(((i=e.authoringInfo)==null?void 0:i.type)==="predominance")for(const o of(s=e.uniqueValueInfos)!=null?s:[])await qd(t,o.value.toString(),[PC(o.symbol,null)]);else{const o=((n=e.uniqueValueInfos)!=null?n:[]).map(p=>PC(p.symbol,null)),{field:a,field2:l,field3:c,valueExpression:d}=e;(a||d)&&await qd(t,a||d,o),l&&await qd(t,l,o),c&&await qd(t,c,o)}else if(e.type==="class-breaks"){const o=e.classBreakInfos.map(c=>PC(c.symbol,null)),{field:a,valueExpression:l}=e;await qd(t,a!=null?a:l,o)}else e.type==="simple"&&await qd(t,"default",[PC(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&await qd(t,"default",[PC(e.defaultSymbol,null)]),t.forEach((o,a)=>{const l=OF(o.filter(Boolean),(c,d)=>JSON.stringify(c)===JSON.stringify(d));t.set(a,l)}),t}function Ox(e,t){return t?{...t,query:{...e,...t.query}}:{query:e}}function eT(e){return typeof e=="string"?Wa(e):ne(e)}function e7(e,t,r){const i={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){i[s]=[];for(let o=0;o<n.length;o++)i[s][o]=e7(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(r&&r[s]);i[s]=t?o:JSON.stringify(o)}else i[s]=t?n:JSON.stringify(n);else i[s]=n}return i}const rk={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new ja({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ve.WebMercator}),minus180Line:new ja({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ve.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new ja({paths:[[[180,-180],[180,180]]],spatialReference:Ve.WGS84}),minus180Line:new ja({paths:[[[-180,-180],[-180,180]]],spatialReference:Ve.WGS84})}};function T2(e,t){return Math.ceil((e-t)/(2*t))}function I3e(e,t){const r=XD(e);for(const i of r)for(const s of i)s[0]+=t;return e}function XD(e){return D2(e)?e.rings:e.paths}async function Olt(e,t,r,i){const s=eT(e),n=t[0].spatialReference,o={...i,query:{...s.query,f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:AI(t[0]),geometries:t}),cutter:JSON.stringify(r)}},a=await lr(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(d=>{const p=ql(d);return p.spatialReference=n,p})}}function Mlt(e){return{geometryType:AI(e[0]),geometries:e.map(t=>t.toJSON())}}function P3e(e,t,r){const i=gqe(t);return e.map(s=>{const n=i.fromJSON(s);return n.spatialReference=r,n})}async function Rlt(e,t,r){const i=typeof e=="string"?Wa(e):e,s=t[0].spatialReference,n=AI(t[0]),o={...r,query:{...i.query,f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(Mlt(t))}},{data:a}=await lr(i.path+"/simplify",o);return P3e(a.geometries,n,s)}const $3e=te.getLogger("esri.geometry.support.normalizeUtils");function Ilt(e){return e.type==="polygon"}function Plt(e){return e[0].type==="polygon"}function $lt(e){return e[0].type==="polyline"}function Dlt(e,t){if(!(e instanceof ja||e instanceof kl)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw $3e.error(s),new z(s)}const r=XD(e),i=[];for(const s of r){const n=[];i.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],d=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(d-l)*(d-l)),f=(d-l)/p,m=(c-a)/p,g=p/t;if(g>1){for(let w=1;w<=g-1;w++){const T=w*t,E=m*T+a,O=f*T+l;n.push([E,O])}const _=(p+Math.floor(g-1)*t)/2,x=m*_+a,b=f*_+l;n.push([x,b])}n.push([c,d])}}return Ilt(e)?new kl({rings:i,spatialReference:e.spatialReference}):new ja({paths:i,spatialReference:e.spatialReference})}function lge(e,t,r){if(t){const i=Dlt(e,1e6);e=jO(i,!0)}return r&&(e=I3e(e,r)),e}function cge(e,t,r){if(Array.isArray(e)){const i=e[0];if(i>t){const s=T2(i,t);e[0]=i+s*(-2*t)}else if(i<r){const s=T2(i,r);e[0]=i+s*(-2*r)}}else{const i=e.x;if(i>t){const s=T2(i,t);e=e.clone().offset(s*(-2*t),0)}else if(i<r){const s=T2(i,r);e=e.clone().offset(s*(-2*r),0)}}return e}function Llt(e,t){let r=-1;for(let i=0;i<t.cutIndexes.length;i++){const s=t.cutIndexes[i],n=t.geometries[i],o=XD(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let d=0;for(let f=0;f<l.length;f++){const m=l[f][0];d=m>d?m:d}d=Number(d.toFixed(9));const p=-360*T2(d,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(s===r){if(Plt(e))for(const a of XD(n))e[s]=e[s].addRing(a);else if($lt(e))for(const a of XD(n))e[s]=e[s].addPath(a)}else r=s,e[s]=n}return e}async function Gae(e,t,r){var E;if(!Array.isArray(e))return Gae([e],t);t&&typeof t!="string"&&$3e.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i=typeof t=="string"?t:(E=t==null?void 0:t.url)!=null?E:Gr.geometryServiceUrl;let s,n,o,a,l,c,d,p,f=0;const m=[],g=[];for(const O of e)if(C(O))g.push(O);else if(s||(s=O.spatialReference,n=sx(s),o=s.isWebMercator,c=o?102100:4326,a=rk[c].maxX,l=rk[c].minX,d=rk[c].plus180Line,p=rk[c].minus180Line),n)if(O.type==="mesh")g.push(O);else if(O.type==="point")g.push(cge(O.clone(),a,l));else if(O.type==="multipoint"){const A=O.clone();A.points=A.points.map(R=>cge(R,a,l)),g.push(A)}else if(O.type==="extent"){const A=O.clone()._normalize(!1,!1,n);g.push(A.rings?new kl(A):A)}else if(O.extent){const A=O.extent,R=T2(A.xmin,l)*(2*a);let D=R===0?O.clone():I3e(O.clone(),R);A.offset(R,0),A.intersects(d)&&A.xmax!==a?(f=A.xmax>f?A.xmax:f,D=lge(D,o),m.push(D),g.push("cut")):A.intersects(p)&&A.xmin!==l?(f=A.xmax*(2*a)>f?A.xmax*(2*a):f,D=lge(D,o,360),m.push(D),g.push("cut")):g.push(D)}else g.push(O.clone());else g.push(O);let _=T2(f,a),x=-90;const b=_,w=new ja;for(;_>0;){const O=360*_-180;w.addPath([[O,x],[O,-1*x]]),x*=-1,_--}if(m.length>0&&b>0){const O=Llt(m,await Olt(i,m,w,r)),A=[],R=[];for(let L=0;L<g.length;L++){const q=g[L];if(q!=="cut")R.push(q);else{const G=O.shift(),J=e[L];v(J)&&J.type==="polygon"&&J.rings&&J.rings.length>1&&G.rings.length>=J.rings.length?(A.push(G),R.push("simplify")):R.push(o?o0(G):G)}}if(!A.length)return R;const D=await Rlt(i,A,r),k=[];for(let L=0;L<R.length;L++){const q=R[L];q!=="simplify"?k.push(q):k.push(o?o0(D.shift()):D.shift())}return k}const T=[];for(let O=0;O<g.length;O++){const A=g[O];if(A!=="cut")T.push(A);else{const R=m.shift();T.push(o===!0?o0(R):R)}}return T}function D3e(e){const t={};for(const r in e){if(r==="declaredClass")continue;const i=e[r];if(i!=null&&typeof i!="function")if(Array.isArray(i)){t[r]=[];for(let s=0;s<i.length;s++)t[r][s]=D3e(i[s])}else typeof i=="object"?i.toJSON&&(t[r]=JSON.stringify(i)):t[r]=i}return t}var nw;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(nw||(nw={}));const uge=4294967296,Nlt=new TextDecoder("utf-8"),Flt=pe("safari")||pe("ios")?6:pe("ff")?12:32;class z2{constructor(t,r,i=0,s=t?t.byteLength:0){this._tag=0,this._dataType=nw.unknown,this._init(t,r,i,s)}_init(t,r,i,s){this._data=t,this._dataView=r,this._pos=i,this._end=s}asUnsafe(){return this}clone(){return new z2(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const r=this._decodeVarint();if(this._tag=r>>3,this._dataType=7&r,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();if(t!==void 0)return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,r=this._pos,i=t.getUint32(r,!0)+t.getUint32(r+4,!0)*uge;return this._skip(8),i}getSFixed64(){const t=this._dataView,r=this._pos,i=t.getUint32(r,!0)+t.getInt32(r+4,!0)*uge;return this._skip(8),i}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),r=this._pos,i=this._toString(this._data,r,r+t);return this._skip(t),i}getBytes(){const t=this._getLength(),r=this._pos,i=this._toBytes(this._data,r,r+t);return this._skip(t),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,r,i,s){const n=this.getMessage(),o=t(n,r,i,s);return n.release(),o}processMessage(t){const r=this.getMessage(),i=t(r);return r.release(),i}getMessage(){const t=this._getLength(),r=z2.pool.acquire();return r._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),r}release(){z2.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case nw.varint:this._decodeVarint();break;case nw.fixed64:this._skip(8);break;case nw.delimited:this._skip(this._getLength());break;case nw.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let r=this._pos,i=0,s=0;if(this._end-r>=10)do{if(s=t[r++],i|=127&s,(128&s)==0||(s=t[r++],i|=(127&s)<<7,(128&s)==0)||(s=t[r++],i|=(127&s)<<14,(128&s)==0)||(s=t[r++],i|=(127&s)<<21,(128&s)==0)||(s=t[r++],i+=268435456*(127&s),(128&s)==0)||(s=t[r++],i+=34359738368*(127&s),(128&s)==0)||(s=t[r++],i+=4398046511104*(127&s),(128&s)==0)||(s=t[r++],i+=562949953421312*(127&s),(128&s)==0)||(s=t[r++],i+=72057594037927940*(127&s),(128&s)==0)||(s=t[r++],i+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(s=t[r],(128&s)!=0);)++r,i+=(127&s)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=s*n}return this._pos=r,i}_decodeSVarint(){const t=this._data;let r=this._pos,i=0,s=0;const n=1&t[r];if(this._end-r>=10)do{if(s=t[r++],i|=127&s,(128&s)==0||(s=t[r++],i|=(127&s)<<7,(128&s)==0)||(s=t[r++],i|=(127&s)<<14,(128&s)==0)||(s=t[r++],i|=(127&s)<<21,(128&s)==0)||(s=t[r++],i+=268435456*(127&s),(128&s)==0)||(s=t[r++],i+=34359738368*(127&s),(128&s)==0)||(s=t[r++],i+=4398046511104*(127&s),(128&s)==0)||(s=t[r++],i+=562949953421312*(127&s),(128&s)==0)||(s=t[r++],i+=72057594037927940*(127&s),(128&s)==0)||(s=t[r++],i+=9223372036854776e3*(127&s),(128&s)==0))break;throw new Error("Varint too long!")}while(0);else{let o=1;for(;r!==this._end&&(s=t[r],(128&s)!=0);)++r,i+=(127&s)*o,o*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=s*o}return this._pos=r,n?-(i+1)/2:i/2}_getLength(){if(this._dataType!==nw.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,r,i){if((i=Math.min(this._end,i))-r>Flt){const o=t.subarray(r,i);return Nlt.decode(o)}let s="",n="";for(let o=r;o<i;++o){const a=t[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,r,i){return i=Math.min(this._end,i),new Uint8Array(t.buffer,r,i-r)}}z2.pool=new ro(z2,void 0,e=>{e._data=null,e._dataView=null});class Eu{constructor(t=[],r=[],i=!1){this.lengths=t!=null?t:[],this.coords=r!=null?r:[],this.hasIndeterminateRingOrder=i}static fromRect(t){const[r,i,s,n]=t,o=s-r,a=n-i;return new Eu([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,r)=>t+r)}forEachVertex(t){let r=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const s=this.lengths[i];for(let n=0;n<s;n++)t(this.coords[2*(n+r)],this.coords[2*(n+r)+1]);r+=s}}clone(t){return t?(t.set(this.coords),new Eu(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new Eu(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class S0{constructor(t=null,r={},i,s){this.geometry=t,this.attributes=r,this.centroid=i,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new S0(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function klt(e){return!(C(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class UBt extends S0{}class t7{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new t7;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const L3e=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class BBt{constructor(t){this._options=t,this.geometryTypes=L3e,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new t7}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this._options.sourceSpatialReference||!t.spatialReference||ml(t.spatialReference,this._options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const r=_E(this._options.sourceSpatialReference)/_E(t.spatialReference);if(r!==1)for(const i of t.features){if(!klt(i))continue;const s=i.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=r}}addFeature(t,r){t.features.push(r)}createFeature(){return new S0}createSpatialReference(){return{wkid:0}}createGeometry(){return new Eu}addField(t,r){t.fields.push(r)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((r,i)=>r+i,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,r){t.coords[this._coordinatePtr++]=r}addCoordinatePoint(t,r){t.coords.push(r)}addLength(t,r){t.lengths.push(r)}addQueryGeometry(t,r){t.queryGeometry=r.queryGeometry,t.queryGeometryType=r.queryGeometryType}createPointGeometry(){return new Eu}}const dge=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],hge=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],pge=["upperLeft","lowerLeft"];function fge(e){return e>=dge.length?null:dge[e]}function Ult(e){return e>=hge.length?null:hge[e]}function mge(e){return e>=pge.length?null:pge[e]}function gge(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function Blt(e,t,r){const s=e.asUnsafe(),n=t.createPointGeometry(r);for(;s.next();)switch(s.tag()){case 3:{const o=s.getUInt32(),a=s.pos()+o;let l=0;for(;s.pos()<a;)t.addCoordinatePoint(n,s.getSInt64(),l++);break}default:s.skip()}return n}function zlt(e,t,r){const n=e.asUnsafe(),o=t.createGeometry(r),a=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;n.next();)switch(n.tag()){case 2:{const l=n.getUInt32(),c=n.pos()+l;let d=0;for(;n.pos()<c;)t.addLength(o,n.getUInt32(),d++);break}case 3:{const l=n.getUInt32(),c=n.pos()+l;let d=0;for(t.allocateCoordinates(o);n.pos()<c;)t.addCoordinate(o,n.getSInt64(),d),d++,d===a&&(d=0);break}default:n.skip()}return o}function Vlt(e){const s=e.asUnsafe(),n=new Eu;let o="esriGeometryPoint";for(;s.next();)switch(s.tag()){case 2:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.lengths.push(s.getUInt32());break}case 3:{const a=s.getUInt32(),l=s.pos()+a;for(;s.pos()<l;)n.coords.push(s.getSInt64());break}case 1:o=L3e[s.getEnum()];break;default:s.skip()}return{queryGeometry:n,queryGeometryType:o}}function jlt(e){const d=e.asUnsafe();for(;d.next();)switch(d.tag()){case 1:return d.getString();case 2:return d.getFloat();case 3:return d.getDouble();case 4:return d.getSInt32();case 5:return d.getUInt32();case 6:return d.getInt64();case 7:return d.getUInt64();case 8:return d.getSInt64();case 9:return d.getBool();default:return d.skip(),null}return null}function Glt(e){const a=e.asUnsafe(),l={type:fge(0)};for(;a.next();)switch(a.tag()){case 1:l.name=a.getString();break;case 2:l.type=fge(a.getEnum());break;case 3:l.alias=a.getString();break;case 4:l.sqlType=Ult(a.getEnum());break;case 5:a.skip();break;case 6:l.defaultValue=a.getString();break;default:a.skip()}return l}function Hlt(e){const i={},s=e.asUnsafe();for(;s.next();)switch(s.tag()){case 1:i.name=s.getString();break;case 2:i.isSystemMaintained=s.getBool();break;default:s.skip()}return i}function qlt(e,t,r,i){const a=t.createFeature(r);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=i[l++].name;a.attributes[c]=e.processMessage(jlt);break}case 2:a.geometry=e.processMessageWithArgs(zlt,t,r);break;case 4:a.centroid=e.processMessageWithArgs(Blt,t,r);break;default:e.skip()}return a}function Wlt(e){const n=[1,1,1,1],o=e.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function Xlt(e){const n=[0,0,0,0],o=e.asUnsafe();for(;o.next();)switch(o.tag()){case 1:n[0]=o.getDouble();break;case 2:n[1]=o.getDouble();break;case 4:n[2]=o.getDouble();break;case 3:n[3]=o.getDouble();break;default:o.skip()}return n}function Ylt(e){const s={originPosition:mge(0)},n=e.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.originPosition=mge(n.getEnum());break;case 2:s.scale=n.processMessage(Wlt);break;case 3:s.translate=n.processMessage(Xlt);break;default:n.skip()}return s}function Zlt(e){const s={},n=e.asUnsafe();for(;n.next();)switch(n.tag()){case 1:s.shapeAreaFieldName=n.getString();break;case 2:s.shapeLengthFieldName=n.getString();break;case 3:s.units=n.getString();break;default:n.skip()}return s}function Jlt(e,t){const a=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:a.wkid=e.getUInt32();break;case 5:a.wkt=e.getString();break;case 2:a.latestWkid=e.getUInt32();break;case 3:a.vcsWkid=e.getUInt32();break;case 4:a.latestVcsWkid=e.getUInt32();break;default:e.skip()}return a}function Klt(e,t){const _=t.createFeatureResult(),x=e.asUnsafe();_.geometryType=gge(t,0);let b=!1;for(;x.next();)switch(x.tag()){case 1:_.objectIdFieldName=x.getString();break;case 3:_.globalIdFieldName=x.getString();break;case 4:_.geohashFieldName=x.getString();break;case 5:_.geometryProperties=x.processMessage(Zlt);break;case 7:_.geometryType=gge(t,x.getEnum());break;case 8:_.spatialReference=x.processMessageWithArgs(Jlt,t);break;case 10:_.hasZ=x.getBool();break;case 11:_.hasM=x.getBool();break;case 12:_.transform=x.processMessage(Ylt);break;case 9:{const w=x.getBool();_.exceededTransferLimit=w;break}case 13:t.addField(_,x.processMessage(Glt));break;case 15:b||(t.prepareFeatures(_),b=!0),t.addFeature(_,x.processMessageWithArgs(qlt,t,_,_.fields));break;case 2:_.uniqueIdField=x.processMessage(Hlt);break;default:x.skip()}return t.finishFeatureResult(_),_}function Qlt(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(Vlt);break;case 1:s.featureResult=e.processMessageWithArgs(Klt,t);break;default:e.skip()}return v(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function ect(e,t){try{const i=new z2(new Uint8Array(e),new DataView(e)),s={};for(;i.next();)i.tag()===2?s.queryResult=i.processMessageWithArgs(Qlt,t):i.skip();return s}catch(r){throw new z("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:r})}}function tct(e,t){const r=ect(e,t),i=r.queryResult.featureResult,s=r.queryResult.queryGeometry,n=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const o=i.objectIdFieldName;for(const a of i.features)a.attributes&&(a.objectId=a.attributes[o])}return i&&(i.queryGeometry=s,i.queryGeometryType=n),i}const yge="Layer does not support extent calculation.";function N3e(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function F3e(e,t){const r=e.geometry,i=e.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const s=i;let n,o,a;if(v(r)&&(o=r.spatialReference,a=r.spatialReference.wkid||JSON.stringify(r.spatialReference),s.geometryType=AI(r),s.geometry=N3e(r,e.compactGeometryEnabled),s.inSR=a),i.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(s.objectIds=i.objectIds.join(",")),i.orderByFields&&(s.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?delete s.outFields:i.outFields.includes("*")?s.outFields="*":s.outFields=i.outFields.join(","),i.outSR?(s.outSR=i.outSR.wkid||JSON.stringify(i.outSR),n=e.outSpatialReference):r&&(i.returnGeometry||i.returnCentroid)&&(s.outSR=s.inSR,n=o),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(s.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(s.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(s.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&v(o)&&v(e.quantizationParameters)&&v(e.quantizationParameters.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(s.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(s.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(s.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const l=i.timeExtent,{start:c,end:d}=l;c==null&&d==null||(s.time=c===d?c:`${c!=null?c:"null"},${d!=null?d:"null"}`),delete i.timeExtent}return e.defaultSpatialReferenceEnabled&&v(o)&&v(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function k3e(e,t,r,i){const s=v(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await NI(e,t,"json",i);return cee(t,r,s.data),s}async function rct(e,t,r,i){if(v(t.timeExtent)&&t.timeExtent.isEmpty)return{data:r.createFeatureResult()};const s=await U3e(e,t,i),n=s;return n.data=tct(s.data,r),n}function U3e(e,t,r){return NI(e,t,"pbf",r)}function ict(e,t,r){return v(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):NI(e,t,"json",r,{returnIdsOnly:!0})}function sct(e,t,r){return v(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):NI(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function nct(e,t,r){return v(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):NI(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(i=>{const s=i.data;if(s.hasOwnProperty("extent"))return i;if(s.features)throw new Error(yge);if(s.hasOwnProperty("count"))throw new Error(yge);return i})}function NI(e,t,r,i={},s={}){const n=typeof e=="string"?Wa(e):e,o=t.geometry?[t.geometry]:[];return i.responseType=r==="pbf"?"array-buffer":"json",Gae(o,null,i).then(a=>{const l=a&&a[0];v(l)&&((t=t.clone()).geometry=l);const c=D3e({...n.query,f:r,...s,...F3e(t,s)});return lr(Mu(n.path,"query"),{...i,query:{...c,...i.query}})})}const zBt=Object.freeze(Object.defineProperty({__proto__:null,encodeGeometry:N3e,executeQuery:k3e,executeQueryForCount:sct,executeQueryForExtent:nct,executeQueryForIds:ict,executeQueryPBF:rct,executeQueryPBFBuffer:U3e,queryToQueryStringParameters:F3e,runQuery:NI},Symbol.toStringTag,{value:"Module"}));async function eW(e,t,r){const i=await oct(e,t,r);return bd.fromJSON(i)}async function oct(e,t,r){const i=eT(e),s={...r},n=pf.from(t),{data:o}=await k3e(i,n,n.sourceSpatialReference,s);return o}function Wl(e,t){return e?t?4:3:t?3:2}const s4=te.getLogger("esri.layers.graphics.featureConversionUtils"),B3e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},act=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n},_ge=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+2]},lct=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+3]},cct=(e,t,r,i,s,n)=>{e[r]=s,e[r+1]=n,e[r+2]=t[i+2],e[r+3]=t[i+3]};function Hae(e,t,r,i){if(e){if(r)return t&&i?cct:_ge;if(t&&i)return lct}else if(t&&i)return _ge;return act}function tW({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function rW({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function iW({scale:e,translate:t},r,i){return r*e[i]+t[i]}function VBt(e,t,r){return e?t?r?Xae(e):qae(e):r?Wae(e):r7(e):null}function r7(e){const t=e.coords;return{x:t[0],y:t[1]}}function z3e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function qae(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function uct(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function Wae(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function dct(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function Xae(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function hct(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function pct(e,t,r,i){let s=r7;r&&i?s=Xae:r?s=qae:i&&(s=Wae);for(const n of t){const{geometry:o,attributes:a}=n,l=v(o)?s(o):null;e.push({attributes:a,geometry:l})}return e}function Yae(e,t){return e&&t?hct:e?uct:t?dct:z3e}function fct(e,t,r,i,s){const n=Yae(r,i);for(const{geometry:o,attributes:a}of t){const l=v(o)?n(new Eu,o):null;e.push(new S0(l,a,null,s?a[s]:void 0))}return e}function jBt(e,t,r=Yae(t.z!=null,t.m!=null)){return r(e,t)}function mct(e,t,r,i){for(const{geometry:s,attributes:n}of t)e.push({attributes:n,geometry:v(s)?V3e(s,r,i):null});return e}function V3e(e,t,r){if(C(e))return null;const i=Wl(t,r),s=[];for(let n=0;n<e.coords.length;n+=i){const o=[];for(let a=0;a<i;a++)o.push(e.coords[n+a]);s.push(o)}return t?r?{points:s,hasZ:t,hasM:r}:{points:s,hasZ:t}:r?{points:s,hasM:r}:{points:s}}function gct(e,t,r,i,s){const n=Wl(r,i);for(const{geometry:o,attributes:a}of t){const l=v(o)?j3e(new Eu,o,n):null;e.push(new S0(l,a,null,s?a[s]:void 0))}return e}function j3e(e,t,r=Wl(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let s=0;for(const n of t.points)for(let o=0;o<r;o++)i[s++]=n[o];return e}function yct(e,t,r,i){for(const{geometry:s,attributes:n}of t)e.push({attributes:n,geometry:v(s)?G3e(s,r,i):null});return e}function G3e(e,t,r){if(!e)return null;const i=Wl(t,r),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let d=0;d<l;d++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?r?{paths:o,hasZ:t,hasM:r}:{paths:o,hasZ:t}:r?{paths:o,hasM:r}:{paths:o}}function _ct(e,t,r,i,s){const n=Wl(r,i);for(const{geometry:o,attributes:a}of t){const l=v(o)?H3e(new Eu,o,n):null;e.push(new S0(l,a,null,s?a[s]:void 0))}return e}function H3e(e,t,r=Wl(t.hasZ,t.hasM)){const{lengths:i,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<r;l++)s[n++]=a[l];i.push(o.length)}return e}function vct(e,t,r,i){for(const{geometry:s,attributes:n,centroid:o}of t){const a=v(s)?q3e(s,r,i):null;if(v(o)){const l=r7(o);e.push({attributes:n,centroid:l,geometry:a})}else e.push({attributes:n,geometry:a})}return e}function q3e(e,t,r){if(!e)return null;const i=Wl(t,r),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let d=0;d<l;d++){const p=[];for(let f=0;f<i;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?r?{rings:o,hasZ:t,hasM:r}:{rings:o,hasZ:t}:r?{rings:o,hasM:r}:{rings:o}}function bct(e,t,r,i,s){for(const{geometry:n,centroid:o,attributes:a}of t){const l=v(n)?W3e(new Eu,n,r,i):null,c=s?a[s]:void 0;v(o)?e.push(new S0(l,a,z3e(new Eu,o),c)):e.push(new S0(l,a,null,c))}return e}function W3e(e,t,r=t.hasZ,i=t.hasM){return wct(e,t.rings,r,i),e}function wct(e,t,r,i){const s=Wl(r,i),{lengths:n,coords:o}=e;let a=0;Av(e);for(const l of t){for(const c of l)for(let d=0;d<s;d++)o[a++]=c[d];n.push(l.length)}return e}const BM=[],YD=[];function GBt(e,t,r,i,s){BM[0]=e;const[n]=X3e(YD,BM,t,r,i,s);return mg(BM),mg(YD),n}function X3e(e,t,r,i,s,n){if(mg(e),!r){for(const o of t){const a=n?o.attributes[n]:void 0;e.push(new S0(null,o.attributes,null,a))}return e}switch(r){case"esriGeometryPoint":return fct(e,t,i,s,n);case"esriGeometryMultipoint":return gct(e,t,i,s,n);case"esriGeometryPolyline":return _ct(e,t,i,s,n);case"esriGeometryPolygon":return bct(e,t,i,s,n);default:s4.error("convertToFeatureSet:unknown-geometry",new z(`Unable to parse unknown geometry type '${r}'`)),mg(e)}return e}function HBt(e,t,r,i){YD[0]=e,Y3e(BM,YD,t,r,i);const s=BM[0];return mg(BM),mg(YD),s}function xct(e,t,r){if(C(e))return null;const i=new Eu;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&r==null&&(r=e.hasM),Vne(e)?Yae(t!=null?t:e.z!=null,r!=null?r:e.m!=null)(i,e):D2(e)?W3e(i,e,t,r):jne(e)?H3e(i,e,Wl(t,r)):zne(e)?j3e(i,e,Wl(t,r)):void s4.error("convertFromGeometry:unknown-geometry",new z(`Unable to parse unknown geometry type '${e}'`))}function Tct(e,t,r,i){const s=e&&("coords"in e?e:e.geometry);if(C(s))return null;switch(t){case"esriGeometryPoint":{let n=r7;return r&&i?n=Xae:r?n=qae:i&&(n=Wae),n(s)}case"esriGeometryMultipoint":return V3e(s,r,i);case"esriGeometryPolyline":return G3e(s,r,i);case"esriGeometryPolygon":return q3e(s,r,i);default:return s4.error("convertToGeometry:unknown-geometry",new z(`Unable to parse unknown geometry type '${t}'`)),null}}function Sct(e,t){for(const r of t)e.push({attributes:r.attributes});return e}function Y3e(e,t,r,i,s){if(mg(e),C(r))return Sct(e,t);switch(r){case"esriGeometryPoint":return pct(e,t,i,s);case"esriGeometryMultipoint":return mct(e,t,i,s);case"esriGeometryPolyline":return yct(e,t,i,s);case"esriGeometryPolygon":return vct(e,t,i,s);default:s4.error("convertToFeatureSet:unknown-geometry",new z(`Unable to parse unknown geometry type '${r}'`))}return e}function qBt(e){const{objectIdFieldName:t,spatialReference:r,transform:i,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:d,queryGeometry:p,queryGeometryType:f}=e,m={features:Y3e([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:d,queryGeometry:Tct(p,f,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function WBt(e,t){var f;const r=new t7,{hasM:i,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:d,fields:p}=e;return p&&(r.fields=p),r.geometryType=l!=null?l:null,r.objectIdFieldName=(f=o!=null?o:t)!=null?f:null,r.spatialReference=a!=null?a:null,r.objectIdFieldName?(n&&X3e(r.features,n,l,s,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),s&&(r.hasZ=s),d&&(r.transform=d),r):(s4.error(new z("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function XBt(e){const{transform:t,features:r,hasM:i,hasZ:s}=e;if(!t)return e;for(const n of r)v(n.geometry)&&bge(n.geometry,n.geometry,i,s,t),v(n.centroid)&&bge(n.centroid,n.centroid,i,s,t);return e.transform=null,e}function YBt(e,t){const{geometryType:r,features:i,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new Eu,vge(l.geometry,a.geometry,s,n,r,e),a.centroid&&(l.centroid=new Eu,vge(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),i[o]=l}return t.transform=e,t}function vge(e,t,r,i,s,n,o=r,a=i){if(Av(e),C(t)||!t.coords.length)return null;const l=B3e[s],{coords:c,lengths:d}=t,p=Wl(r,i),f=Wl(r&&o,i&&a),m=Hae(r,i,o,a);if(!d.length)return m(e.coords,c,0,0,tW(n,c[0]),rW(n,c[1])),Av(e,p,0),e;let g,_,x,b,w=0,T=0,E=T;for(const O of d){if(O<l)continue;let A=0;T=E,x=g=tW(n,c[w]),b=_=rW(n,c[w+1]),m(e.coords,c,T,w,x,b),A++,w+=p,T+=f;for(let R=1;R<O;R++,w+=p)x=tW(n,c[w]),b=rW(n,c[w+1]),x===g&&b===_||(m(e.coords,c,T,w,x-g,b-_),T+=f,A++,g=x,_=b);A>=l&&(e.lengths.push(A),E=T)}return mg(e.coords,E),e.coords.length?e:null}function ZBt(e,t,r,i,s,n,o=r,a=i){if(Av(e),!t||!t.coords.length)return null;const l=B3e[s],{coords:c,lengths:d}=t,p=Wl(r,i),f=Wl(r&&o,i&&a),m=Hae(r,i,o,a);if(!d.length)return m(e.coords,c,0,0,c[0],c[1]),Av(e,p,0),e;let g=0;const _=n*n;for(const x of d){if(x<l){g+=x*p;continue}const b=e.coords.length/f,w=g,T=g+(x-1)*p;m(e.coords,c,e.coords.length,w,c[w],c[w+1]),wte(e.coords,c,p,_,m,w,T),m(e.coords,c,e.coords.length,T,c[T],c[T+1]);const E=e.coords.length/f-b;E>=l?e.lengths.push(E):mg(e.coords,b*f),g+=x*p}return e.coords.length?e:null}function Ect(e,t,r,i){const s=e[t],n=e[t+1],o=e[r],a=e[r+1],l=e[i],c=e[i+1];let d=o,p=a,f=l-d,m=c-p;if(f!==0||m!==0){const g=((s-d)*f+(n-p)*m)/(f*f+m*m);g>1?(d=l,p=c):g>0&&(d+=f*g,p+=m*g)}return f=s-d,m=n-p,f*f+m*m}function wte(e,t,r,i,s,n,o){let a,l=i,c=0;for(let d=n+r;d<o;d+=r)a=Ect(t,d,n,o),a>l&&(c=d,l=a);l>i&&(c-n>r&&wte(e,t,r,i,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>r&&wte(e,t,r,i,s,c,o))}function JBt(e,t,r,i){if(C(t)||!t.coords||!t.coords.length)return null;const s=Wl(r,i);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let d=0;d<c.length;d+=s){const p=c[d],f=c[d+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function bge(e,t,r,i,s){var _,x,b,w,T,E,O,A;const{coords:n,lengths:o}=t,a=Wl(r,i);if(!n.length)return e!==t&&Av(e),e;Ose(s);const{originPosition:l,scale:c,translate:d}=s,p=Act;p.originPosition=l;const f=p.scale;f[0]=(_=c[0])!=null?_:1,f[1]=-((x=c[1])!=null?x:1),f[2]=(b=c[2])!=null?b:1,f[3]=(w=c[3])!=null?w:1;const m=p.translate;if(m[0]=(T=d[0])!=null?T:0,m[1]=(E=d[1])!=null?E:0,m[2]=(O=d[2])!=null?O:0,m[3]=(A=d[3])!=null?A:0,!o.length){for(let R=0;R<a;++R)e.coords[R]=iW(p,n[R],R);return e!==t&&Av(e,a,0),e}let g=0;for(let R=0;R<o.length;R++){const D=o[R];e.lengths[R]=D;for(let q=0;q<a;++q)e.coords[g+q]=iW(p,n[g+q],q);let k=e.coords[g],L=e.coords[g+1];g+=a;for(let q=1;q<D;q++,g+=a){k+=n[g]*f[0],L+=n[g+1]*f[1],e.coords[g]=k,e.coords[g+1]=L;for(let G=2;G<a;++G)e.coords[g+G]=iW(p,n[g+G],G)}}return e!==t&&Av(e,n.length,o.length),e}function KBt(e,t,r,i,s,n){if(Av(e),e.lengths.push(...t.lengths),r===s&&i===n)for(let o=0;o<t.coords.length;o++)e.coords.push(t.coords[o]);else{const o=Wl(r,i),a=Hae(r,i,s,n),l=t.coords;for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1])}return e}function Cct(e,t,r,i){let s=0,n=e[i*t],o=e[i*(t+1)];for(let a=1;a<r;a++){const l=n+e[i*(t+a)],c=o+e[i*(t+a)+1],d=(l-n)*(c+o);n=l,o=c,s+=d}return .5*s}function QBt(e,t){const{coords:r,lengths:i}=e;let s=0,n=0;for(let o=0;o<i.length;o++){const a=i[o];n+=Cct(r,s,a,t),s+=a}return Math.abs(n)}function e8t(e,t){if(C(e))return null;const r=e.clone(),i=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=i[t*n],c=i[t*n+1];for(let d=1;d<a;d++){const p=l+i[t*(n+d)],f=c+i[t*(n+d)+1];r.coords[t*(n+d)]=p,r.coords[t*(n+d)+1]=f,l=p,c=f}n+=a}return r}function Av(e,t=0,r=0){mg(e.lengths,r),mg(e.coords,t)}function mg(e,t=0){e.length!==t&&(e.length=t)}const Act={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Oct="esri.widgets.Feature.support.relatedFeatureUtils",wge=te.getLogger(Oct),xge=new Map;function xte(e){if(!yv(e))return null;const[t,r]=e.split("/").slice(1);return{layerId:t,fieldName:r}}function Mct(e,t){if(!t.relationships)return null;let r=null;const{relationships:i}=t;return i.some(s=>s.id===parseInt(e,10)&&(r=s,!0)),r}function Rct({originRelationship:e,relationships:t,layerId:r}){let i;return t&&t.some(s=>(`${s.relatedTableId}`===r&&s.id===e.id&&(i=s),!!i)),i}function Ict(e,t){const r=t.toLowerCase();for(const i in e)if(i.toLowerCase()===r)return e[i];return null}function Pct(e,t){const r=Mct(e,t);if(!!r)return{url:`${t.url}/${r.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:r,relatedFields:[],outStatistics:[]}}function $ct(e,t){if(!t||!e)return;const{features:r,statsFeatures:i}=e,s=r&&r.value;t.relatedFeatures=s?s.features:[];const n=i&&i.value;t.relatedStatsFeatures=n?n.features:[]}function Dct(e,t,r,i){const s=new gN;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[r.objectIdField]],r.queryRelatedFeatures(s,i)}function Lct(e,t,r){let i=0;const s=[];for(;i<t.length;)s.push(`${e} IN (${t.slice(i,r+i)})`),i+=r;return s.join(" OR ")}async function Nct(e,t,r,i){const s=r.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:d}=t,p=Rct({originRelationship:o,relationships:n.relationships,layerId:s});if(p.relationshipTableId&&p.keyFieldInRelationshipTable){const m=(await Dct(e,p,r,i))[e.attributes[r.objectIdField]];if(!m)return null;const g=m.features.map(_=>_.attributes[n.objectIdField]);if((l==null?void 0:l.length)>0&&n.supportsStatistics){const _=new pf;_.where=Lct(n.objectIdField,g,1e3),_.outFields=a,_.outStatistics=l,_.sourceSpatialReference=d;const x={features:Promise.resolve(m),statsFeatures:eW(c,_)};return zo(x)}}const f=p==null?void 0:p.keyField;if(f){const m=ij(zct(n.fields,f)),g=Ict(e.attributes,o.keyField),_=m?`${f}=${g}`:`${f}='${g}'`,x=eW(c,new pf({where:_,outFields:t.relatedFields,sourceSpatialReference:d}),i),b=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?eW(c,new pf({where:_,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:d}),i):null,w={features:x};return b&&(w.statsFeatures=b),zo(w)}return null}function Fct(e,t){return lr(e,{query:{f:"json"},signal:t&&t.signal})}function kct({relatedInfos:e,layer:t},r){const i={};return e.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new z("relation-required","A relation is required on a layer to retrieve related records.");throw wge.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new z("A related table ID is required on a layer to retrieve related records.");throw wge.error(p),p}const l=`${t.url}/${a}`,c=xge.get(l),d=c||Fct(l,r);c||xge.set(l,d),i[n]=d}),zo(i)}function Uct({graphic:e,relatedInfos:t,layer:r},i){const s={};return t.forEach((n,o)=>{n.layerInfo&&(s[o]=Nct(e,n,r,i))}),zo(s)}function Bct({relatedInfo:e,fieldName:t,fieldInfo:r}){if(e.relatedFields.push(t),r.statisticType){const i=new XRe({statisticType:r.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(i)}}function zct(e,t){if(e!=null){t=t.toLowerCase();for(const r of e)if(r&&r.name.toLowerCase()===t)return r}return null}const Tge={chartAnimation:!0};let Ca=class extends be{constructor(e){super(e),this.abilities={...Tge},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Tge,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,r=(e+t)%t;this.activeMediaInfoIndex=r}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,r=t+e;this._setContentElementMedia(r)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:r,expressionAttributes:i,fieldInfoMap:s,layer:n}=this;return t==null?void 0:t.map(o=>{const a=o==null?void 0:o.clone();if(!a)return null;if(a.title=x2({attributes:e,fieldInfoMap:s,globalAttributes:r,expressionAttributes:i,layer:n,text:a.title}),a.caption=x2({attributes:e,fieldInfoMap:s,globalAttributes:r,expressionAttributes:i,layer:n,text:a.caption}),a.altText=x2({attributes:e,fieldInfoMap:s,globalAttributes:r,expressionAttributes:i,layer:n,text:a.altText}),a.type==="image"){const{value:l}=a;return this._setImageValue({value:l,formattedAttributes:r,layer:n}),a.value.sourceURL?a:void 0}if(a.type==="pie-chart"||a.type==="line-chart"||a.type==="column-chart"||a.type==="bar-chart"){const{value:l}=a;return this._setChartValue({value:l,chartType:a.type,attributes:e,formattedAttributes:r,layer:n,expressionAttributes:i}),a}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:r,formattedAttributes:i,layer:s}=e,{linkURL:n,sourceURL:o}=r;if(o){const a=bte(o,s);r.sourceURL=vte({formattedAttributes:i,template:a,fieldInfoMap:t})}if(n){const a=bte(n,s);r.linkURL=vte({formattedAttributes:i,template:a,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:r,formattedAttributes:i,chartType:s,layer:n,expressionAttributes:o}=e,{popupTemplate:a,relatedInfos:l}=this,{fields:c,normalizeField:d}=t;if(t.fields=Cat(c,n),d&&(t.normalizeField=wN(d,n)),!c.some(f=>!!(i[f]!=null||yv(f)&&l.size)))return;const p=a==null?void 0:a.fieldInfos;c.forEach(f=>{if(yv(f))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:p,fieldName:f,formattedAttributes:i,chartType:s,value:t})]);const m=this._getChartOption({value:t,attributes:r,chartType:s,formattedAttributes:i,expressionAttributes:o,fieldName:f,fieldInfos:p});t.series.push(m)})}_getRelatedChartInfos(e){var g;const{fieldInfos:t,fieldName:r,formattedAttributes:i,chartType:s,value:n}=e,o=[],a=xte(r),{layerId:l,fieldName:c}=a,d=(g=this.relatedInfos)==null?void 0:g.get(l.toString());if(!d)return o;const{relatedFeatures:p,relation:f}=d;if(!f||!p)return o;const{cardinality:m}=f;return p.forEach(_=>{const{attributes:x}=_;x&&Object.keys(x).forEach(b=>{b===c&&o.push(this._getChartOption({value:n,attributes:x,formattedAttributes:i,fieldName:r,chartType:s,relatedFieldName:b,fieldInfos:t}))})}),m==="one-to-many"||m==="many-to-many"?o:[o[0]]}_getTooltip({label:e,value:t,chartType:r}){return r==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var E,O,A,R,D,k;const{value:t,attributes:r,formattedAttributes:i,expressionAttributes:s,fieldName:n,relatedFieldName:o,fieldInfos:a,chartType:l}=e,{layer:c,fieldInfoMap:d}=this,{normalizeField:p,tooltipField:f}=t,m=p?yv(p)?r[xte(p).fieldName]:r[p]:null,g=Uae(n)&&s&&s[n]!==void 0?s[n]:o&&r[o]!==void 0?r[o]:r[n]!==void 0?r[n]:i[n],_=new rOe({fieldName:n,value:g===void 0?null:g&&m?g/m:g});if(yv(n)){const L=d.get(n.toLowerCase()),q=d.get(f.toLowerCase()),G=(E=L==null?void 0:L.fieldName)!=null?E:n,J=(D=(R=(A=i[(O=q==null?void 0:q.fieldName)!=null?O:f])!=null?A:L==null?void 0:L.label)!=null?R:L==null?void 0:L.fieldName)!=null?D:o,ee=i[G];return _.tooltip=this._getTooltip({label:J,value:ee,chartType:l}),_}const x=S3e(a,n),b=wN(n,c),w=f&&i[f]!==void 0?i[f]:x3e(x||new GF({fieldName:b}),(k=this.popupTemplate)==null?void 0:k.expressionInfos),T=i[b];return _.tooltip=this._getTooltip({label:w,value:T,chartType:l}),_}};u([h()],Ca.prototype,"abilities",void 0),u([Gt("abilities")],Ca.prototype,"castAbilities",null),u([h()],Ca.prototype,"activeMediaInfoIndex",void 0),u([h({readOnly:!0})],Ca.prototype,"activeMediaInfo",null),u([h()],Ca.prototype,"attributes",void 0),u([h()],Ca.prototype,"description",void 0),u([h()],Ca.prototype,"fieldInfoMap",void 0),u([h()],Ca.prototype,"formattedAttributes",void 0),u([h()],Ca.prototype,"expressionAttributes",void 0),u([h({readOnly:!0})],Ca.prototype,"formattedMediaInfos",null),u([h()],Ca.prototype,"layer",void 0),u([h({readOnly:!0})],Ca.prototype,"formattedMediaInfoCount",null),u([h()],Ca.prototype,"mediaInfos",void 0),u([h()],Ca.prototype,"popupTemplate",void 0),u([h()],Ca.prototype,"relatedInfos",void 0),u([h()],Ca.prototype,"title",void 0),Ca=u([I("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Ca);const S2=Ca;var Sge=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Vct=[].concat(Sge.slice(30,39),Sge.slice(28,30).reverse()),jct=[{name:"default",colors:Vct},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Ege="en-us",Zae=new Map([["ar",()=>re(()=>import("./ar.86cc1692.js"),["assets/ar.86cc1692.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.a)],["bg-bg",()=>re(()=>import("./bg_BG.b736e920.js"),["assets/bg_BG.b736e920.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.b)],["bs-ba",()=>re(()=>import("./bs_BA.a323ad66.js"),["assets/bs_BA.a323ad66.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.b)],["ca-es",()=>re(()=>import("./ca_ES.ef58828b.js"),["assets/ca_ES.ef58828b.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.c)],["cs-cz",()=>re(()=>import("./cs_CZ.b2d386a1.js"),["assets/cs_CZ.b2d386a1.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.c)],["da-dk",()=>re(()=>import("./da_DK.16566135.js"),["assets/da_DK.16566135.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.d)],["de-de",()=>re(()=>import("./de_DE.ce6610cd.js"),["assets/de_DE.ce6610cd.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.d)],["de-ch",()=>re(()=>import("./de_CH.60578987.js"),["assets/de_CH.60578987.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.d)],["el-gr",()=>re(()=>import("./el_GR.d4c6a4ee.js"),["assets/el_GR.d4c6a4ee.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.e)],["en-us",()=>re(()=>import("./en_US.71a65555.js"),["assets/en_US.71a65555.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.e)],["en-ca",()=>re(()=>import("./en_CA.ec6c2b7c.js"),["assets/en_CA.ec6c2b7c.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.e)],["es-es",()=>re(()=>import("./es_ES.ef1b40e9.js"),["assets/es_ES.ef1b40e9.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.e)],["et-ee",()=>re(()=>import("./et_EE.b9efffde.js"),["assets/et_EE.b9efffde.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.e)],["fi-fi",()=>re(()=>import("./fi_FI.6b2b8640.js"),["assets/fi_FI.6b2b8640.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.f)],["fr-fr",()=>re(()=>import("./fr_FR.0d0aa4b2.js"),["assets/fr_FR.0d0aa4b2.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.f)],["he-il",()=>re(()=>import("./he_IL.cefd7375.js"),["assets/he_IL.cefd7375.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.h)],["hr-hr",()=>re(()=>import("./hr_HR.f054665f.js"),["assets/hr_HR.f054665f.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.h)],["hu-hu",()=>re(()=>import("./hu_HU.6eb2e3c1.js"),["assets/hu_HU.6eb2e3c1.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.h)],["id-id",()=>re(()=>import("./id_ID.2f4d1d20.js"),["assets/id_ID.2f4d1d20.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.i)],["it-it",()=>re(()=>import("./it_IT.d99d283a.js"),["assets/it_IT.d99d283a.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.i)],["ja-jp",()=>re(()=>import("./ja_JP.02630a59.js"),["assets/ja_JP.02630a59.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.j)],["ko-kr",()=>re(()=>import("./ko_KR.494abdb6.js"),["assets/ko_KR.494abdb6.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.k)],["lt-lt",()=>re(()=>import("./lt_LT.e5dc3b07.js"),["assets/lt_LT.e5dc3b07.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.l)],["lv-lv",()=>re(()=>import("./lv_LV.006fe0d6.js"),["assets/lv_LV.006fe0d6.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.l)],["nb-no",()=>re(()=>import("./nb_NO.17aa1247.js"),["assets/nb_NO.17aa1247.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.n)],["nl-nl",()=>re(()=>import("./nl_NL.bb55a4a7.js"),["assets/nl_NL.bb55a4a7.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.n)],["pl-pl",()=>re(()=>import("./pl_PL.ca3d90a7.js"),["assets/pl_PL.ca3d90a7.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.p)],["pt-br",()=>re(()=>import("./pt_BR.07fbb84b.js"),["assets/pt_BR.07fbb84b.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.p)],["pt-pt",()=>re(()=>import("./pt_PT.e82fce8e.js"),["assets/pt_PT.e82fce8e.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.p)],["ro-ro",()=>re(()=>import("./ro_RO.08a11e64.js"),["assets/ro_RO.08a11e64.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.r)],["ru-ru",()=>re(()=>import("./ru_RU.4b08b8da.js"),["assets/ru_RU.4b08b8da.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.r)],["sk-sk",()=>re(()=>import("./sk_SK.c9cf24d2.js"),["assets/sk_SK.c9cf24d2.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.s)],["sl-sl",()=>re(()=>import("./sl_SL.7bddc01e.js"),["assets/sl_SL.7bddc01e.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.s)],["sr-rs",()=>re(()=>import("./sr_RS.9d484aca.js"),["assets/sr_RS.9d484aca.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.s)],["sv-se",()=>re(()=>import("./sv_SE.122bb1e9.js"),["assets/sv_SE.122bb1e9.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.s)],["th-th",()=>re(()=>import("./th_TH.50530bc1.js"),["assets/th_TH.50530bc1.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.t)],["tr-tr",()=>re(()=>import("./tr_TR.027c89bc.js"),["assets/tr_TR.027c89bc.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.t)],["uk-ua",()=>re(()=>import("./uk_UA.831b2f6d.js"),["assets/uk_UA.831b2f6d.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.u)],["vi-vn",()=>re(()=>import("./vi_VN.f6625b5d.js"),["assets/vi_VN.f6625b5d.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.v)],["zh-cn",()=>re(()=>import("./zh_Hans.38cb8157.js"),["assets/zh_Hans.38cb8157.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.z)],["zh-hk",()=>re(()=>import("./zh_Hant.e4eb7b89.js"),["assets/zh_Hant.e4eb7b89.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.z)],["zh-tw",()=>re(()=>import("./zh_Hant.e4eb7b89.js"),["assets/zh_Hant.e4eb7b89.js","assets/_commonjsHelpers.773c2c82.js"]).then(e=>e.z)]]);function Gct(e){const t=e.split("-")[0].toLowerCase();let r=null;for(const i of Zae.keys())if(i.startsWith(t)){r=i;break}return r}function Hct(e){return e?Zae.has(e.toLowerCase())?e.toLowerCase():Gct(e)||Ege:Ege}let $C,OP;async function qct(e=fl()){if(e=Hct(e),$C&&e===OP)return $C;$C=re(()=>import("./index.f6f524c6.js"),["assets/index.f6f524c6.js","assets/_commonjsHelpers.773c2c82.js"]).then(t=>t.i),OP=e;try{const[t,r]=await Promise.all([$C,Zae.get(OP)()]);OP===e&&(t.am4core.options.defaultLocale=r.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return $C=null,OP=null,null}return $C}function Wct(e,t="default"){const r=jct.find(i=>i.name===t);return r?r.colors.map(i=>e.color(i)):null}const Wn={base:"esri-feature-media",mediaContainer:"esri-feature-media__container",mediaItemContainer:"esri-feature-media__item-container",mediaItem:"esri-feature-media__item",mediaItemTitle:"esri-feature-media__item-title",mediaItemCaption:"esri-feature-media__item-caption",mediaPrevious:"esri-feature-media__previous",mediaPreviousIconLTR:"esri-feature-media__previous-icon",mediaPreviousIconRTL:"esri-feature-media__previous-icon--rtl",mediaNext:"esri-feature-media__next",mediaNextIconLTR:"esri-feature-media__next-icon",mediaNextIconRTL:"esri-feature-media__next-icon--rtl",mediaChart:"esri-feature-media__chart",mediaButton:"esri-feature-media__button",mediaIcon:"esri-feature-media__icon",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},sW=.05,nW=.95,oW=15,J0="color",B1="tooltip",MP="value",Cge="default-line-value";let ed=class extends Ss{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.viewModel=new S2,this.messages=null,this._getChartDependencies=async r=>{const i=await qct(),{destroyed:s,viewModel:n}=this;if(s||!n||!r)return;const{activeMediaInfo:o}=n,a=await this._getRendererColors(i);this._renderChart({chartDiv:r,mediaInfo:o,chartsModule:i,colorMap:a})}}initialize(){this._featureElementInfo=new Kj,this.addHandles([ie(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),pt),ie(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),pt)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){var e;return P("div",{bind:this,class:Wn.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?P("div",{key:"media-element-container",class:Wn.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:r,formattedMediaInfoCount:i}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:d}=s,p=w3e(d)?"_blank":"_self",f=p==="_blank"?"noreferrer":"",m=n?t:null,g=m?m.timestamp:0,_=m?m.sourceURL:c,x=P("img",{alt:o||a,key:`media-${l}-${r}-${i}-${g}`,src:_});return(d?P("a",{title:a,href:d,rel:f,target:p},x):null)||x}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:r}=this.viewModel;return P("div",{key:`media-${e.type}-${t}-${r}`,bind:this,class:Wn.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?P("div",{key:"media-title",class:Wn.mediaItemTitle,innerHTML:e.title}):null,r=e.caption?P("div",{key:"media-caption",class:Wn.mediaItemCaption,innerHTML:e.caption}):null;return P("div",{key:"media-container",class:Wn.mediaItemContainer},P("div",{key:"media-item-container",class:Wn.mediaItem},this.renderMediaInfoType()),t,r)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",r=t?this.messages.previous:this.messages.next,i=t?this.classes(Wn.mediaButton,Wn.mediaPrevious):this.classes(Wn.mediaButton,Wn.mediaNext),s=t?this.classes(Wn.mediaIcon,Wn.mediaPreviousIconLTR,Wn.iconLeftTriangleArrow):this.classes(Wn.mediaIcon,Wn.mediaNextIconLTR,Wn.iconRightTriangleArrow),n=t?this.classes(Wn.mediaIcon,Wn.mediaPreviousIconRTL,Wn.iconRightTriangleArrow):this.classes(Wn.mediaIcon,Wn.mediaNextIconRTL,Wn.iconLeftTriangleArrow),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return P("button",{type:"button",key:o,title:r,"aria-label":r,tabIndex:0,class:i,bind:this,onclick:a},P("span",{"aria-hidden":"true",class:s}),P("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getRendererColors(e){var o,a;const{am4core:t}=e,r=new Map,i=(a=(o=this.viewModel)==null?void 0:o.layer)==null?void 0:a.renderer,s="default";if(!i)return r;const n=await Alt(i);return n.delete(s),Array.from(n.values()).every(l=>(l==null?void 0:l.length)===1)&&(r.set(Cge,t.color({r:50,g:50,b:50,a:1})),Array.from(n.keys()).forEach(l=>{l&&r.set(l,t.color(n.get(l)[0].toCss(!0)))})),r}_handleMediaKeyup(e){const t=Uo(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:r,chartDiv:i,mediaInfo:s,colorMap:n}=e,{value:o,type:a}=s,{am4core:l}=r,c=Wct(l);function d(m){m instanceof l.ColorSet&&c&&(m.list=c)}Az()&&l.useTheme(r.am4themes_dark);const p=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!p.matches?l.useTheme(r.am4themes_animated):l.unuseTheme(r.am4themes_animated),l.useTheme(d);const f=a==="pie-chart"?this._createPieChart(e):this._createXYChart(e);i.setAttribute("aria-label",s.altText||s.title),f.data=o.series.map(m=>({[B1]:m.tooltip,[MP]:m.value,[J0]:n.get(m.fieldName)})).filter(m=>a!=="pie-chart"||m.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:r}=e,{am4core:i,am4charts:s}=r,n=i.create(t,s.PieChart);n.rtl=Fh(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=MP,o.dataFields.category=B1,this._customizeChartTooltip(o.tooltip,i),o.slices.template.propertyFields.fill=J0,o.slices.template.propertyFields.stroke=J0,n}_getMinSeriesValue(e){let t=0;return e.forEach(r=>t=Math.min(r.value,t)),t}_createColumnChart(e,t){const{chartsModule:r,mediaInfo:i}=t,{value:s}=i,{am4core:n,am4charts:o}=r,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category=B1,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dy=-a.tooltip.contentHeight});const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=sW,l.renderer.maxLabelPosition=nW,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const d=e.series.push(new o.ColumnSeries);d.dataFields.valueY=MP,d.dataFields.categoryX=B1,d.columns.template.propertyFields.fill=J0,d.columns.template.propertyFields.stroke=J0,e.cursor=new o.XYCursor,s.series.length>oW&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:r,mediaInfo:i}=t,{value:s}=i,{am4core:n,am4charts:o}=r,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category=B1,a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dx=a.tooltip.contentWidth});const l=e.xAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=sW,l.renderer.maxLabelPosition=nW,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const d=e.series.push(new o.ColumnSeries);d.dataFields.valueX=MP,d.dataFields.categoryY=B1,d.columns.template.propertyFields.fill=J0,d.columns.template.propertyFields.stroke=J0,e.cursor=new o.XYCursor,s.series.length>oW&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:r,mediaInfo:i,colorMap:s}=t,{value:n}=i,{am4core:o,am4charts:a}=r,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=B1,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,o),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dy=-l.tooltip.contentHeight});const c=e.yAxes.push(new a.ValueAxis),d=c.renderer.labels.template;c.renderer.minLabelPosition=sW,c.renderer.maxLabelPosition=nW,c.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(c.tooltip,o),d.wrap=!0;const p=e.series.push(new a.LineSeries);p.dataFields.categoryX=B1,p.dataFields.valueY=MP,p.strokeWidth=1;const f=s.get(Cge);f&&(p.stroke=f);const m=p.bullets.push(new a.CircleBullet);m.propertyFields.fill=J0,m.propertyFields.stroke=J0,e.cursor=new a.XYCursor,n.series.length>oW&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:r,mediaInfo:i}=e,{type:s}=i,{am4core:n,am4charts:o}=r,a=n.create(t,o.XYChart);return a.rtl=Fh(this.container),s==="column-chart"&&this._createColumnChart(a,e),s==="bar-chart"&&this._createBarChart(a,e),s==="line-chart"&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:r}=e;if(!t)return;const i=6e4*t;this._updateMediaInfoTimestamp(r.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(r.sourceURL)},i);this._refreshTimer=s}_getImageSource(e,t){const r=e.includes("?")?"&":"?",[i,s=""]=e.split("#");return`${i}${r}timestamp=${t}${s?"#":""}${s}`}};u([h()],ed.prototype,"attributes",null),u([h()],ed.prototype,"activeMediaInfoIndex",null),u([h()],ed.prototype,"description",null),u([h()],ed.prototype,"fieldInfoMap",null),u([h()],ed.prototype,"layer",null),u([h()],ed.prototype,"mediaInfos",null),u([h()],ed.prototype,"popupTemplate",null),u([h()],ed.prototype,"relatedInfos",null),u([h()],ed.prototype,"title",null),u([h({type:S2})],ed.prototype,"viewModel",void 0),u([h(),xi("esri/widgets/Feature/t9n/Feature")],ed.prototype,"messages",void 0),ed=u([I("esri.widgets.Feature.FeatureMedia")],ed);const Z3e=ed,Xct=["$datastore","$map","$layer","$aggregatedfeatures"],Yct="esri.widgets.Feature.support.arcadeFeatureUtils",Zct=te.getLogger(Yct);function Jct(e){return typeof e=="string"?i4(zae(e)):Array.isArray(e)?Kct(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?Qct(e):e}function Kct(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?i4(zae(t)):t}</li>`).join("")}</ul>`}function Qct(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const r=e.field(t);return`<tr><th>${t}</th><td>${typeof r=="string"?i4(zae(r)):r}</td></tr>`}).join("")}</table>`}function eut({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:r,context:i,viewInfo:s,map:n,graphic:o,interceptor:a}){r.forEach(l=>{const c=l.toLowerCase(),d={map:n,spatialReference:s.sr,interceptor:a};if(c==="$map"&&(i.vars[c]=t.convertMapToFeatureSetCollection(d)),c==="$layer"&&(i.vars[c]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:s.sr,interceptor:a})),c==="$datastore"&&(i.vars[c]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:s.sr,interceptor:a})),c==="$aggregatedfeatures"){const p=o.layer,{fields:f,objectIdField:m,geometryType:g,spatialReference:_,displayField:x}=p,b=new Gz({fields:f,objectIdField:m,geometryType:g,spatialReference:_,displayField:x,...p.type==="feature"?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null,source:e});i.vars[c]=t.convertFeatureLayerToFeatureSet({layer:b,spatialReference:s.sr,interceptor:a})}})}function J3e(){return re(()=>import("./arcadeUtils.4c0abe01.js").then(e=>e.ax),["assets/arcadeUtils.4c0abe01.js","assets/number.ad2b9bcd.js","assets/hash.e6424875.js"])}function tut(e){return"createQuery"in e&&"queryFeatures"in e}async function rut({graphic:e,view:t}){const{isAggregate:r,layer:i}=e;if(!r||!i||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(i);if(!tut(s))return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(n);return o}async function K3e({expressionInfo:e,arcadeUtils:t,interceptor:r,spatialReference:i,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=Xct.filter(m=>t.hasVariable(a,m)),[c]=await Promise.all([rut({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),d=t.getViewInfo({spatialReference:i}),p=t.createExecContext(n,d);p.interceptor=r,p.useAsync=!0,eut({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:p,viewInfo:d,map:s,graphic:n,interceptor:r});const f=t.createFunction(a,p);return t.executeAsyncFunction(f,p).catch(m=>Zct.error("arcade-execution-error",{error:m,graphic:n,expressionInfo:e}))}async function iut({expressionInfos:e,spatialReference:t,graphic:r,interceptor:i,map:s,view:n}){if(!e||!e.length)return{};const o=await J3e(),a={};for(const d of e)a[`expression/${d.name}`]=K3e({expressionInfo:d,arcadeUtils:o,interceptor:i,spatialReference:t,map:s,graphic:r,view:n});const l=await zo(a),c={};for(const d in l)c[d]=Jct(l[d].value);return c}const sut=1;let ih=class extends $0(be){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var i,s;const t=(i=this.contentElement)==null?void 0:i.type;(s=this.contentElementViewModel)==null||s.destroy();const r=t==="fields"?new Qj:t==="media"?new S2:t==="text"?new nV:null;this._set("contentElementViewModel",r)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=UM(this._compile,sut,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:r,interceptor:i,spatialReference:s,map:n,view:o,_abortController:a}=this;if(!(t&&r&&s&&n))return void this._set("contentElement",null);const l=await J3e();if(a!==this._abortController)return;const c=await K3e({arcadeUtils:l,expressionInfo:t,graphic:r,interceptor:i,map:n,spatialReference:s,view:o});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const d=await c.castAsJsonAsync(a.signal),p=d==null?void 0:d.type,f=p==="media"?cN.fromJSON(d):p==="text"?ER.fromJSON(d):p==="fields"?SR.fromJSON(d):null;this._set("contentElement",f)},this.handles.add([ie(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),pt),ie(()=>[this.contentElement],()=>this._createVM(),pt)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e,t;return(t=(e=this.view)==null?void 0:e.spatialReference)!=null?t:null}set spatialReference(e){this._override("spatialReference",e)}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:r}=this;return e?"loading":t||r?"ready":"disabled"}get map(){var e,t;return(t=(e=this.view)==null?void 0:e.map)!=null?t:null}set map(e){this._override("map",e)}};u([h()],ih.prototype,"_abortController",void 0),u([h({type:tOe})],ih.prototype,"expressionInfo",void 0),u([h({type:_i})],ih.prototype,"graphic",void 0),u([h({readOnly:!0})],ih.prototype,"contentElement",void 0),u([h({readOnly:!0})],ih.prototype,"contentElementViewModel",void 0),u([h()],ih.prototype,"interceptor",void 0),u([h()],ih.prototype,"spatialReference",null),u([h({readOnly:!0})],ih.prototype,"state",null),u([h()],ih.prototype,"map",null),u([h()],ih.prototype,"view",void 0),ih=u([I("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],ih);const Jae=ih,ik={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let OB=class extends Ss{constructor(e,t){super(e,t),this.viewModel=new Jae}initialize(){this.addHandles(ie(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),pt))}destroy(){this._destroyContentWidget()}renderLoading(){return P("div",{key:"loading-container",class:ik.loadingSpinnerContainer},P("span",{class:this.classes(ik.iconLoading,ik.spinner)}))}render(){var t;const{state:e}=this.viewModel;return P("div",{class:ik.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,r=t==null?void 0:t.type;this._destroyContentWidget();const i=e?r==="fields"?new O3e({viewModel:e}):r==="media"?new Z3e({viewModel:e}):r==="text"?new AB({viewModel:e}):null:null;this._contentWidget=i,this.scheduleRender()}};u([h({type:Jae})],OB.prototype,"viewModel",void 0),OB=u([I("esri.widgets.Feature.FeatureExpression")],OB);const nut=OB,aW=100;let Xs=class extends ki(eC($0(be))){constructor(e){super(e),this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const t=new AbortController;this._queryAbortController=t,await wM(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._cancelQueryFeatureCount();const t=new AbortController;this._queryFeatureCountAbortController=t,await wM(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null)},this._queryPageController=async()=>{const t=new AbortController;this._queryPageAbortController=t,await wM(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)},this._queryThrottled=UM(this._queryController,aW,this),this._queryFeatureCountThrottled=UM(this._queryFeatureCountController,aW,this),this._queryPageThrottled=UM(this._queryPageController,aW,this),this._query=async()=>{const{_queryAbortController:t,relatedFeatures:r}=this;this._destroyRelatedFeatureViewModels(),this.featurePage=1,r.removeAll(),r.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:t==null?void 0:t.signal})))},this.handles.add([ie(()=>[this.displayCount,this.graphic,this.layer,this.map,this.orderByFieldsFixedCasing,this.relationshipId,this.featuresPerPage,this.showAllEnabled],()=>this._queryThrottled(),pt),ie(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageThrottled()),ie(()=>[this.layer,this.relationshipId,this.objectId],()=>this._queryFeatureCountThrottled())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:t,featureCount:r}=this,i=1,s=Math.ceil(r/t)||1;this._set("featurePage",Math.min(Math.max(e,i),s))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:t}=this;return e&&(t==null?void 0:t.loaded)?e.map(r=>{const i=r.clone(),s=wN(r.field,t);return i.field=s,i}):e}get itemDescriptionFieldName(){var e,t;return((t=(e=this.orderByFieldsFixedCasing)==null?void 0:e[0])==null?void 0:t.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,t,r;return(r=(t=(e=this.graphic)==null?void 0:e.attributes)==null?void 0:t[this.objectIdField])!=null?r:null}get objectIdField(){var e;return((e=this.layer)==null?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new Ge}get relatedLayer(){const{layer:e,map:t,relationship:r}=this;return e!=null&&e.loaded?qat(t,e,r):null}get relationship(){var r,i;const{relationshipId:e,layer:t}=this;return typeof e=="number"&&(i=(r=t==null?void 0:t.relationships)==null?void 0:r.find(({id:s})=>s===e))!=null?i:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new Ge}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:r,graphic:i,relatedLayer:s}=this;return t?"loading":e||r?"querying":i&&s?"ready":"disabled"}_destroyRelatedFeatureViewModels(){var e;(e=this.relatedFeatureViewModels)==null||e.forEach(t=>!t.destroyed&&t.destroy()),this.relatedFeatureViewModels.removeAll()}async _queryFeatureCount(){var c,d,p,f,m;const{layer:e,relatedLayer:t,relationshipId:r,objectId:i,_queryFeatureCountAbortController:s}=this;if(await(e==null?void 0:e.load()),!t||typeof i!="number"||!((d=(c=e==null?void 0:e.capabilities)==null?void 0:c.queryRelated)!=null&&d.supportsCount))return void this._set("featureCount",0);await t.load();const n=t.createQuery(),o=(m=(f=(p=e.capabilities)==null?void 0:p.queryRelated)==null?void 0:f.supportsCacheHint)!=null?m:!1,a=new gN({cacheHint:o,relationshipId:r,returnGeometry:!1,objectIds:[i],where:n.where}),l=await e.queryRelatedFeaturesCount(a,{signal:s==null?void 0:s.signal});this._set("featureCount",l[i]||0)}_sliceFeatures(e){const{showAllEnabled:t,displayCount:r}=this;return t?e:r?e.slice(0,r):[]}async _queryPage(){const{relatedFeatures:e,featurePage:t,showAllEnabled:r,_queryPageAbortController:i}=this;!r||t<2||e.addMany(await this._queryRelatedFeatures({signal:i==null?void 0:i.signal}))}async _queryRelatedFeatures(e){var O,A,R,D,k;const{orderByFieldsFixedCasing:t,showAllEnabled:r,featuresPerPage:i,displayCount:s,layer:n,relationshipId:o,featurePage:a,featureCount:l,relatedLayer:c}=this;await(n==null?void 0:n.load());const{relationship:d,objectId:p}=this;if(!d||typeof p!="number"||!((A=(O=n==null?void 0:n.capabilities)==null?void 0:O.queryRelated)!=null&&A.supportsPagination))return[];const f=r?((a-1)*i+l)%l:0,m=r?i:s;if(!c)return[];await c.load();const g=c.objectIdField,_=[...t==null?void 0:t.map(L=>L.field),g],x=t==null?void 0:t.map(L=>`${L.field} ${L.order}`),b=((D=(R=n.capabilities)==null?void 0:R.queryRelated)==null?void 0:D.supportsCacheHint)||!1,w=c.createQuery(),T=new gN({orderByFields:x,start:f,num:m,outFields:_,cacheHint:b,relationshipId:o,returnGeometry:!1,objectIds:[p],where:w.where}),E=((k=(await n.queryRelatedFeatures(T,{signal:e==null?void 0:e.signal}))[p])==null?void 0:k.features)||[];return E.forEach(L=>L.sourceLayer=c),E}};u([h()],Xs.prototype,"_queryAbortController",void 0),u([h()],Xs.prototype,"_queryPageAbortController",void 0),u([h()],Xs.prototype,"_queryFeatureCountAbortController",void 0),u([h({value:1})],Xs.prototype,"featurePage",null),u([h()],Xs.prototype,"featuresPerPage",void 0),u([h({readOnly:!0})],Xs.prototype,"orderByFieldsFixedCasing",null),u([h()],Xs.prototype,"description",void 0),u([h({readOnly:!0})],Xs.prototype,"itemDescriptionFieldName",null),u([h({value:3})],Xs.prototype,"displayCount",null),u([h({type:_i})],Xs.prototype,"graphic",void 0),u([h()],Xs.prototype,"layer",void 0),u([h()],Xs.prototype,"map",void 0),u([h({readOnly:!0})],Xs.prototype,"objectId",null),u([h({readOnly:!0})],Xs.prototype,"objectIdField",null),u([h()],Xs.prototype,"orderByFields",void 0),u([h({readOnly:!0})],Xs.prototype,"relatedFeatures",null),u([h({readOnly:!0})],Xs.prototype,"relatedLayer",null),u([h({readOnly:!0})],Xs.prototype,"relationship",null),u([h({readOnly:!0})],Xs.prototype,"featureCount",void 0),u([h({readOnly:!0})],Xs.prototype,"relatedFeatureViewModels",null),u([h()],Xs.prototype,"relationshipId",void 0),u([h()],Xs.prototype,"showAllEnabled",void 0),u([h({readOnly:!0})],Xs.prototype,"state",null),u([h()],Xs.prototype,"title",void 0),Xs=u([I("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],Xs);const Kae=Xs,K0={base:"esri-feature-relationship",esriWidget:"esri-widget",listContainer:"esri-feature-relationship__list",listContainerQuerying:"esri-feature-relationship__list--querying",featureObserver:"esri-feature__feature-observer",stickySpinnerContainer:"esri-feature__sticky-loading-container",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner",iconLoading:"esri-icon-loading-indicator esri-rotating"},Age={title:!0,description:!0};let eu=class extends Ss{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([r])=>{r!=null&&r.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Kae,this.messages=null,this.messagesCommon=null,this.visibleElements={...Age},this._increaseFeaturePage=()=>{const{state:r,showAllEnabled:i,relatedFeatures:s,featuresPerPage:n,featurePage:o}=this.viewModel;r==="ready"&&i&&s.length>=n*o&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new Kj,this.addHandles([ie(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),pt),ie(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),ms(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return Promise.all([re(()=>import("./calcite-list.bf0d53b0.js"),["assets/calcite-list.bf0d53b0.js","assets/interactive.d71a7a54.js"]),re(()=>import("./calcite-list-item.c4ec9227.js"),["assets/calcite-list-item.c4ec9227.js","assets/conditionalSlot.57b8b866.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js"]),re(()=>import("./calcite-icon.85645cae.js"),["assets/calcite-icon.85645cae.js","assets/icon.1cb7558b.js","assets/observers.2da64440.js"]),re(()=>import("./calcite-notice.81a0d339.js"),["assets/calcite-notice.81a0d339.js","assets/conditionalSlot.57b8b866.js","assets/observers.2da64440.js","assets/icon.1cb7558b.js"])])}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Qe(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:e,featureCount:t,displayCount:r}=this.viewModel;return!e&&(t>r||r===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){const{messages:e}=this,{featureCount:t}=this.viewModel;return hu(t===1?e==null?void 0:e.numberRecord:e==null?void 0:e.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return{...Age,...e}}renderStickyLoading(){return this.viewModel.state==="querying"?P("div",{key:"sticky-loader",class:K0.stickySpinnerContainer},this.renderLoadingIcon()):null}renderLoadingIcon(){return P("span",{class:this.classes(K0.iconLoading,K0.spinner)})}renderLoading(){return P("div",{key:"loading-container",class:K0.loadingSpinnerContainer},this.renderLoadingIcon())}renderShowAllIconNode(){return P("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}renderChevronIconNode(){const e=Fh(this.container)?"chevron-left":"chevron-right";return P("calcite-icon",{scale:"s",icon:e,slot:"content-end"})}renderRelatedFeature(e){var s,n;const{itemDescriptionFieldName:t}=this.viewModel,r=e.title;e.description=t&&((s=e.formattedAttributes)==null?void 0:s.global[t]);const i=e.state==="loading";return P("calcite-list-item",{key:e.uid,label:i?`${(n=this.messagesCommon)==null?void 0:n.loading}\u2026`:r,description:i?"\u2026":e.description,onclick:()=>this.emit("select-record",{featureViewModel:e})},this.renderChevronIconNode())}renderShowAllListItem(){var e;return this.displayShowAllButton?P("calcite-list-item",{key:"show-all-item",label:(e=this.messages)==null?void 0:e.showAll,description:this.featureCountDescription,onclick:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null}renderNoRelatedFeaturesMessage(){var e;return P("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,color:"blue",scale:"s",width:"full"},P("div",{slot:"message"},(e=this.messages)==null?void 0:e.noRelatedFeatures))}renderFeatureObserver(){return P("div",{key:"feature-observer",class:K0.featureObserver,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}renderList(){const{relatedFeatureViewModels:e}=this.viewModel;return P("calcite-list",null,e.toArray().map(t=>this.renderRelatedFeature(t)),this.renderShowAllListItem())}renderRelatedFeatures(){const{displayListItems:e}=this,{state:t}=this.viewModel;return P("div",{key:"list-container",class:this.classes(K0.listContainer,{[K0.listContainerQuerying]:t==="querying"})},e?this.renderList():t==="ready"?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}renderRelationshipNotFound(){var e;return P("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,color:"red",scale:"s",width:"full"},P("div",{slot:"message"},(e=this.messages)==null?void 0:e.relationshipNotFound))}render(){var t;const{state:e}=this.viewModel;return P("div",{class:this.classes(K0.base,K0.esriWidget)},(t=this._featureElementInfo)==null?void 0:t.render(),e==="loading"?this.renderLoading():e==="disabled"?this.renderRelationshipNotFound():this.renderRelatedFeatures())}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e==null||e.forEach(r=>{this.addHandles(ie(()=>[r.title,r.state],()=>this.scheduleRender(),pt),t)}),this.scheduleRender()}_setupFeatureElementInfo(){const{headingLevel:e,visibleElements:t}=this,r=t.description&&this.description,i=t.title&&this.title;this._featureElementInfo.set({description:r,title:i,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();const{state:e,showAllEnabled:t}=this.viewModel;await yx(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};u([h()],eu.prototype,"_relatedFeatureIntersectionObserverNode",void 0),u([h({readOnly:!0})],eu.prototype,"displayShowAllButton",null),u([h({readOnly:!0})],eu.prototype,"displayListItems",null),u([h()],eu.prototype,"description",null),u([h({readOnly:!0})],eu.prototype,"featureCountDescription",null),u([h()],eu.prototype,"headingLevel",void 0),u([h()],eu.prototype,"title",null),u([h({type:Kae})],eu.prototype,"viewModel",void 0),u([h(),xi("esri/widgets/Feature/t9n/Feature")],eu.prototype,"messages",void 0),u([h(),xi("esri/t9n/common")],eu.prototype,"messagesCommon",void 0),u([h()],eu.prototype,"visibleElements",void 0),u([Gt("visibleElements")],eu.prototype,"castVisibleElements",null),eu=u([I("esri.widgets.Feature.FeatureRelationship")],eu);const Oge=eu;class out{constructor(t,r){this.preLayerQueryCallback=t,this.preRequestCallback=r,this.preLayerQueryCallback||(this.preLayerQueryCallback=i=>{}),this.preRequestCallback||(this.preLayerQueryCallback=i=>{})}}var S$;const aut=1,Mge="content-view-models",Rge="relationship-view-models",Ige={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let wn=S$=class extends eC(be){constructor(e){super(e),this._handles=new hr,this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=UM(this._graphicChanged,aut,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Ige},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:r}=this;return t.type==="attachments"&&r.attachmentsContent||t.type==="custom"&&r.customContent||t.type==="fields"&&r.fieldsContent||t.type==="media"&&r.mediaContent||t.type==="text"&&r.textContent||t.type==="expression"&&r.expressionContent||t.type==="relationship"&&r.relationshipContent},this._handles.add(ie(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),pt))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return v(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return kat(ege(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return b3e(this.graphic)}castAbilities(e){return{...Ige,...e}}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){var e,t;return(t=(e=this.view)==null?void 0:e.spatialReference)!=null?t:null}set spatialReference(e){this._override("spatialReference",e)}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){this._override("map",e)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const r=this.contentViewModels[e];r instanceof S2&&r.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof S2&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof S2&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(r){Ps(r)||(this._error=r,te.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:r,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,r)=>this._compileContentElement(t,r)):typeof e=="string"?this._compileText(new ER({text:e}),0).text:e}_destroyContentViewModels(){var e,t;(e=this._handles)==null||e.remove(Rge),(t=this._handles)==null||t.remove(Mge),this.contentViewModels.forEach(r=>r&&!r.destroyed&&r.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){var s;const r=(s=e==null?void 0:e.graphic)==null?void 0:s.getObjectId(),i=t==null?void 0:t.getObjectId();return v(r)&&v(i)&&r===i}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:r}){t==null||t.filter(Boolean).forEach(i=>{e.find(s=>this._matchesFeature(s,i))||e.add(new S$({abilities:{relationshipContent:!1},map:r,graphic:i}))}),e.forEach(i=>{(t==null?void 0:t.find(n=>this._matchesFeature(i,n)))||e.remove(i)})}_setExpressionContentVM(e,t){const{formattedAttributes:r}=this,{contentElement:i,contentElementViewModel:s}=e,n=i==null?void 0:i.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:i,contentElementIndex:t,formattedAttributes:r}),s.set(this._createFieldsVMParams(i,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:i,contentElementIndex:t,formattedAttributes:r}),s.set(this._createMediaVMParams(i,t))),n==="text"&&s.set(this._createTextVMParams(i)))}_compileRelationship(e,t){const{displayCount:r,orderByFields:i,relationshipId:s,title:n,description:o}=e,{_sourceLayer:a,graphic:l,map:c}=this,d=new Kae({displayCount:r,graphic:l,orderByFields:i,relationshipId:s,layer:a,map:c,...this._compileTitleAndDesc({title:n,description:o})});return this.contentViewModels[t]=d,this._handles.add(ms(()=>d.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(d)),Rge),e}_compileExpression(e,t){const{expressionInfo:r}=e,{graphic:i,map:s,spatialReference:n,view:o}=this,a=new Jae({expressionInfo:r,graphic:i,interceptor:S$.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[t]=a,this._handles.add(ie(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,t),pt),Mge),e}_compileAttachments(e,t){const{graphic:r}=this,{description:i,title:s}=e;return this.contentViewModels[t]=new jae({graphic:r,...this._compileTitleAndDesc({title:s,description:i})}),e}_compileCustom(e,t){const{graphic:r}=this,{creator:i,destroyer:s}=e;return this.contentViewModels[t]=new nV({graphic:r,creator:i,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:r,_sourceLayer:i,graphic:s,formattedAttributes:n,_expressionAttributes:o}=this,{attributes:a}=s,l=n.global;return{title:x2({attributes:a,fieldInfoMap:r,globalAttributes:l,expressionAttributes:o,layer:i,text:e}),description:x2({attributes:a,fieldInfoMap:r,globalAttributes:l,expressionAttributes:o,layer:i,text:t})}}_createFieldsVMParams(e,t){var c;const{_effectivePopupTemplate:r,formattedAttributes:i}=this,s={...i.global,...i.content[t]},n=(c=(e==null?void 0:e.fieldInfos)||(r==null?void 0:r.fieldInfos))==null?void 0:c.filter(({fieldName:d})=>Uae(d)||yv(d)||s.hasOwnProperty(d)),o=r==null?void 0:r.expressionInfos,{description:a,title:l}=e;return{attributes:s,expressionInfos:o,fieldInfos:n,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(e,t){const r=e.clone(),i=new Qj(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=i,r.fieldInfos=i.formattedFieldInfos.slice(0),r}_createMediaVMParams(e,t){const{abilities:r,graphic:i,_fieldInfoMap:s,formattedAttributes:n,_effectivePopupTemplate:o,relatedInfos:a,_sourceLayer:l,_expressionAttributes:c}=this,{attributes:d}=i,{description:p,mediaInfos:f,title:m}=e;return{abilities:{chartAnimation:r.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:d,layer:l,fieldInfoMap:s,formattedAttributes:{...n.global,...n.content[t]},expressionAttributes:c,mediaInfos:f,popupTemplate:o,relatedInfos:a,...this._compileTitleAndDesc({title:m,description:p})}}_compileMedia(e,t){const r=e.clone(),i=new S2(this._createMediaVMParams(e,t));return r.mediaInfos=i.formattedMediaInfos.slice(0),this.contentViewModels[t]=i,r}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:r,_sourceLayer:i,_expressionAttributes:s}=this;if(e&&e.text){const{attributes:n}=t,o=this.formattedAttributes.global;e.text=x2({attributes:n,fieldInfoMap:r,globalAttributes:o,expressionAttributes:s,layer:i,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const r=e.clone();return this.contentViewModels[t]=new nV(this._createTextVMParams(r)),r}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:r}=this;if(!e)return;const{lastEditInfoEnabled:i}=e,s=t==null?void 0:t.editFieldsInfo;return i&&s?Fat(s,r.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:r,graphic:i,_expressionAttributes:s}=this,{attributes:n}=i,o=this.formattedAttributes.global;return x2({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:r,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,r=e==null?void 0:e.title;return sV(r,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,r=e==null?void 0:e.content;return sV(r,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:r,graphic:i,_effectivePopupTemplate:s,spatialReference:n,map:o,view:a}=this;if(t!==this._featureAbortController||!i)return;await zat({graphic:i,popupTemplate:s,layer:r,spatialReference:n},e);const{content:{value:l},title:{value:c}}=await zo({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:d}}=await zo({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:iut({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:n,graphic:i,map:o,interceptor:S$.interceptor,view:a})});t===this._featureAbortController&&i&&(this._expressionAttributes=d,this._graphicExpressionAttributes={...i.attributes,...d},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:r}){const{_effectivePopupTemplate:i,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;r.content[t]=Yq({fieldInfos:i==null?void 0:i.fieldInfos,graphic:s,attributes:{...l,...e.attributes},layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:r}){if(e.fieldInfos){const{graphic:i,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;r.content[t]=Yq({fieldInfos:e.fieldInfos,graphic:i,attributes:{...a,...e.attributes},layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:r,relatedInfos:i,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t==null?void 0:t.fieldInfos,l={global:Yq({fieldInfos:a,graphic:r,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:i}),content:[]};return Array.isArray(e)&&e.forEach((c,d)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:d,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:d,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:r}=this;return this._queryRelatedInfos(t,ege(r),e)}async _queryRelatedInfos(e,t,r){const{relatedInfos:i,_sourceLayer:s}=this;i.clear();const n=v(s.associatedLayer)?await s.associatedLayer.load(r):s;if(!n)return;const o=t.filter(c=>c&&yv(c.fieldName));if(!o||!o.length)return;t.forEach(c=>this._configureRelatedInfo(c,n));const a=await kct({relatedInfos:i,layer:n},r);Object.keys(a).forEach(c=>{var f;const d=i.get(c.toString()),p=(f=a[c])==null?void 0:f.value;d&&p&&(d.layerInfo=p.data)});const l=await Uct({graphic:e,relatedInfos:i,layer:n},r);Object.keys(l).forEach(c=>{var d;$ct((d=l[c])==null?void 0:d.value,i.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:r}=this,i=xte(e.fieldName);if(!i)return;const{layerId:s,fieldName:n}=i;if(!s)return;const o=r.get(s.toString())||Pct(s,t);o&&(Bct({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};wn.interceptor=new out(Gat,Hat),u([h()],wn.prototype,"_error",void 0),u([h()],wn.prototype,"_featureAbortController",void 0),u([h({readOnly:!0})],wn.prototype,"_effectivePopupTemplate",null),u([h({readOnly:!0})],wn.prototype,"_fieldInfoMap",null),u([h({readOnly:!0})],wn.prototype,"_sourceLayer",null),u([h()],wn.prototype,"abilities",void 0),u([Gt("abilities")],wn.prototype,"castAbilities",null),u([h({readOnly:!0})],wn.prototype,"content",void 0),u([h({readOnly:!0})],wn.prototype,"contentViewModels",void 0),u([h()],wn.prototype,"description",void 0),u([h({type:Boolean})],wn.prototype,"defaultPopupTemplateEnabled",void 0),u([h({readOnly:!0})],wn.prototype,"state",null),u([h({readOnly:!0})],wn.prototype,"formattedAttributes",void 0),u([h({type:_i,value:null})],wn.prototype,"graphic",null),u([h({readOnly:!0})],wn.prototype,"lastEditInfo",void 0),u([h({readOnly:!0})],wn.prototype,"relatedInfos",void 0),u([h()],wn.prototype,"spatialReference",null),u([h({readOnly:!0})],wn.prototype,"title",void 0),u([h()],wn.prototype,"map",null),u([h({readOnly:!0})],wn.prototype,"waitingForContent",null),u([h()],wn.prototype,"view",void 0),wn=S$=u([I("esri.widgets.FeatureViewModel")],wn);const Qae=wn,Un={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentNode:"esri-feature__content-node",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},Q3e=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=r=>Oz(r)&&!r.destroyed?P("div",{class:Un.contentNode,key:r},r.render()):r instanceof HTMLElement?P("div",{class:Un.contentNode,key:r,bind:r,afterCreate:this._attachToNode}):kAe(r)?P("div",{class:Un.contentNode,key:r,bind:r.domNode,afterCreate:this._attachToNode}):null}_attachToNode(r){const i=this;r.appendChild(i)}};return t=u([I("esri.widgets.Feature.ContentMixin")],t),t};var Tte;const Pge={title:!0,content:!0,lastEditedInfo:!0},$ge="relationship-handles";let tl=Tte=class extends Q3e(Ss){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...Pge},this.viewModel=new Qae}initialize(){this.addHandles(ie(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),pt))}loadDependencies(){return re(()=>import("./calcite-notice.81a0d339.js"),["assets/calcite-notice.81a0d339.js","assets/conditionalSlot.57b8b866.js","assets/observers.2da64440.js","assets/icon.1cb7558b.js"])}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}castVisibleElements(e){return{...Pge,...e}}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const{state:e}=this.viewModel,t=P("div",{class:Un.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return P("div",{class:this.classes(Un.base,Un.esriWidget)},t)}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:r}=this;return P("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},r.title?P("div",{key:"error-title",slot:"title"},e.errorMessage):null,P("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return P("div",{key:"loading-container",class:Un.loadingSpinnerContainer},P("span",{class:this.classes(Un.iconLoading,Un.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?P("div",{class:Un.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?P(Sh,{level:this.headingLevel,class:Un.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?P("div",{class:Un.contentNode,key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const r=this._contentWidgets[0];return!r||r.destroyed?null:P("div",{class:Un.contentNode,key:`${t}-content`},r.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:r}=this;if(typeof r.content!="boolean"&&!r.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);case"relationship":return this.renderRelationship(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:r,attachmentInfos:i}=t.viewModel;return r==="loading"||i.length>0?P("div",{key:this._buildKey("attachments-element",e),class:this.classes(Un.contentElement)},t.render()):null}renderRelationship(e){const t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?P("div",{key:this._buildKey("relationship-element",e),class:Un.contentElement},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:P("div",{key:this._buildKey("expression-element",e),class:Un.contentElement},t.render())}renderCustom(e,t){const{creator:r}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:r?P("div",{key:this._buildKey("custom-element",t),class:Un.contentElement},i.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:P("div",{key:this._buildKey("fields-element",e),class:Un.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:P("div",{key:this._buildKey("media-element",e),class:Un.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:r}=this.viewModel;if(!r||!e.lastEditedInfo)return null;const{date:i,user:s}=r,n=r.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=hu(n,{date:i,user:s});return P("div",{key:"edit-info-element",class:this.classes(Un.lastEditedInfo,Un.contentElement)},o)}renderText(e,t){const r=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:r?P("div",{key:this._buildKey("text-element",t),class:this.classes(Un.contentElement,Un.text)},i.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this.removeHandles($ge),this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_addFeatureRelationshipHandles(e){const{flowItems:t,visibleElements:r}=this;this.addHandles([ms(()=>e,"select-record",({featureViewModel:i})=>{t&&(i.abilities={relationshipContent:!0},t.push(new Tte({flowItems:t,viewModel:i,visibleElements:r})))}),ms(()=>e,"show-all-records",()=>{if(!t)return;const{viewModel:i}=e;i.showAllEnabled=!0;const s=new Oge({visibleElements:{title:!1,description:!1},viewModel:i});this._addFeatureRelationshipHandles(s),t.push(s)})],$ge)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,r=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(r))r.forEach((s,n)=>{if(s.type==="attachments"&&(this._contentWidgets[n]=new Zat({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:i[n]})),s.type==="fields"&&(this._contentWidgets[n]=new O3e({viewModel:i[n]})),s.type==="media"&&(this._contentWidgets[n]=new Z3e({viewModel:i[n]})),s.type==="text"&&(this._contentWidgets[n]=new AB({viewModel:i[n]})),s.type==="custom"&&(this._contentWidgets[n]=new AB({viewModel:i[n]})),s.type==="expression"&&(this._contentWidgets[n]=new nut({viewModel:i[n]})),s.type==="relationship"){const o=new Oge({viewModel:i[n]});this._addFeatureRelationshipHandles(o),this._contentWidgets[n]=o}},this);else{const s=i[0];s&&!s.destroyed&&(this._contentWidgets[0]=new AB({viewModel:s}))}this.scheduleRender()}};u([h()],tl.prototype,"graphic",null),u([h()],tl.prototype,"defaultPopupTemplateEnabled",null),u([h()],tl.prototype,"flowItems",void 0),u([h()],tl.prototype,"headingLevel",void 0),u([h()],tl.prototype,"label",null),u([h(),xi("esri/widgets/Feature/t9n/Feature")],tl.prototype,"messages",void 0),u([h(),xi("esri/t9n/common")],tl.prototype,"messagesCommon",void 0),u([h(),xi("esri/widgets/support/t9n/uriUtils")],tl.prototype,"messagesURIUtils",void 0),u([h()],tl.prototype,"spatialReference",null),u([h({readOnly:!0})],tl.prototype,"title",null),u([h()],tl.prototype,"visibleElements",void 0),u([Gt("visibleElements")],tl.prototype,"castVisibleElements",null),u([h()],tl.prototype,"map",null),u([h()],tl.prototype,"view",null),u([h({type:Qae})],tl.prototype,"viewModel",void 0),tl=Tte=u([I("esri.widgets.Feature")],tl);const lut=tl;var e$e;const MB=Symbol("anchorHandles");let RS=class extends $s.EventedAccessor{constructor(e){super(e),this[e$e]=new hr,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[MB].add([no(()=>qi(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),ie(()=>this.screenLocation,(t,r)=>{v(t)&&v(r)&&this.emit("view-change")})])}destroy(){this.view=null,this[MB]=Qe(this[MB])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:r}=this;return r&&v(e)&&v(t)&&t.ready?t.toScreen(e):null}};e$e=MB,u([h()],RS.prototype,"location",void 0),u([h()],RS.prototype,"screenLocation",null),u([h()],RS.prototype,"screenLocationEnabled",void 0),u([h()],RS.prototype,"view",void 0),RS=u([I("esri.widgets.support.AnchorElementViewModel")],RS);const t$e=RS,cut="esri.widgets.CompassViewModel";let RB=class extends t$e{constructor(e){super(e),this.visible=!1}};u([h()],RB.prototype,"visible",void 0),RB=u([I(cut)],RB);const r$e=RB,lW={base:"esri-spinner",spinnerStart:"esri-spinner--start",spinnerFinish:"esri-spinner--finish"};let IS=class extends Ss{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new r$e}initialize(){this.addHandles(ie(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:t,promise:r}=e;t&&(this.viewModel.location=t),this.visible=!0;const i=()=>this.hide();r&&r.catch(()=>{}).then(i)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,r=!!t,i=e&&r,s=!e&&r,n={[lW.spinnerStart]:i,[lW.spinnerFinish]:s},o=this._getPositionStyles();return P("div",{class:this.classes(lW.base,n),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=yx(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(C(t)||C(e))return{};const{padding:r}=t;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}};u([h()],IS.prototype,"location",null),u([h()],IS.prototype,"view",null),u([h({type:r$e})],IS.prototype,"viewModel",void 0),u([h()],IS.prototype,"visible",null),IS=u([I("esri.widgets.Spinner")],IS);const uut=IS;var Dge;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(Dge||(Dge={}));function i$e(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function dut(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function hut(e,t,r,i,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=s,o[5]=n,o}function put(e,t){return new Float32Array(e,t,6)}function s$e(e,t,r,i){const s=t[i],n=t[i+1];e[i]=r[0]*s+r[2]*n+r[4],e[i+1]=r[1]*s+r[3]*n+r[5]}function fut(e,t,r,i=0,s=0,n=2){const o=s||t.length/n;for(let a=i;a<o;a++)s$e(e,t,r,a*n)}Object.freeze(Object.defineProperty({__proto__:null,create:i$e,clone:dut,fromValues:hut,createView:put,transform:s$e,transformMany:fut},Symbol.toStringTag,{value:"Module"}));function mut(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function gut(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function yut(e,t,r,i,s,n,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e[4]=n,e[5]=o,e}function n$e(e,t){const r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=r*n-i*s;return l?(l=1/l,e[0]=n*l,e[1]=-i*l,e[2]=-s*l,e[3]=r*l,e[4]=(s*a-n*o)*l,e[5]=(i*o-r*a)*l,e):null}function _ut(e){return e[0]*e[3]-e[1]*e[2]}function o$e(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],d=r[1],p=r[2],f=r[3],m=r[4],g=r[5];return e[0]=i*c+n*d,e[1]=s*c+o*d,e[2]=i*p+n*f,e[3]=s*p+o*f,e[4]=i*m+n*g+a,e[5]=s*m+o*g+l,e}function ele(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(r),d=Math.cos(r);return e[0]=i*d+n*c,e[1]=s*d+o*c,e[2]=i*-c+n*d,e[3]=s*-c+o*d,e[4]=a,e[5]=l,e}function a$e(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],d=r[1];return e[0]=i*c,e[1]=s*c,e[2]=n*d,e[3]=o*d,e[4]=a,e[5]=l,e}function tle(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],d=r[1];return e[0]=i,e[1]=s,e[2]=n,e[3]=o,e[4]=i*c+n*d+a,e[5]=s*c+o*d+l,e}function vut(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function but(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function rle(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function wut(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function xut(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function Tut(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function l$e(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function Sut(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function Eut(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e}function Cut(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function Aut(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],d=t[2],p=t[3],f=t[4],m=t[5],g=Xl();return Math.abs(r-l)<=g*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=g*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-d)<=g*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(n-p)<=g*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=g*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=g*Math.max(1,Math.abs(a),Math.abs(m))}const Out=o$e,Mut=l$e;Object.freeze(Object.defineProperty({__proto__:null,copy:mut,identity:gut,set:yut,invert:n$e,determinant:_ut,multiply:o$e,rotate:ele,scale:a$e,translate:tle,fromRotation:vut,fromScaling:but,fromTranslation:rle,str:wut,frob:xut,add:Tut,subtract:l$e,multiplyScalar:Sut,multiplyScalarAndAdd:Eut,exactEquals:Cut,equals:Aut,mul:Out,sub:Mut},Symbol.toStringTag,{value:"Module"}));const Lge=pe("android");pe("chrome")||Lge&&Lge>=4;TJ();function c$e(e){return e&&"opacity"in e?e.opacity*c$e(e.parent):1}async function Rut(e,t){var x,b;if(!e)return;const r=e.sourceLayer,i=(x=v(t)&&t.useSourceLayer?r:e.layer)!=null?x:r,s=c$e(i);if(v(e.symbol)&&(!v(t)||t.ignoreGraphicSymbol!==!0)){const w=e.symbol.type==="web-style"?await e.symbol.fetchSymbol({...t,cache:v(t)?t.webStyleCache:null}):e.symbol.clone();return Qq(w,null,s),w}const n=(b=v(t)?t.renderer:null)!=null?b:i&&"renderer"in i?i.renderer:null;let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(e,t):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...t,cache:v(t)?t.webStyleCache:null}):o.clone(),!(n&&"visualVariables"in n&&n.visualVariables&&n.visualVariables.length))return Qq(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(C(t)||C(t.arcade))){const w={...t};w.arcade=await b0(),t=w}const a=await re(()=>Promise.resolve().then(()=>$oe),void 0),l=[],c=[],d=[],p=[];for(const w of n.visualVariables)switch(w.type){case"color":l.push(w);break;case"opacity":c.push(w);break;case"rotation":p.push(w);break;case"size":w.target||d.push(w)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,e,t):null,g=!!c.length&&c[c.length-1];let _=g?a.getOpacity(g,e,t):null;if(s!=null&&(_=_!=null?_*s:s),Qq(o,m,_),d.length){const w=a.getAllSizes(d,e,t);await glt(o,w)}for(const w of p)ylt(o,a.getRotationAngle(w,e,t),w.axis);return o}class Jv{constructor(t,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in t){const s=t[i],n=new n2e(s,void 0,void 0,2,2);this._properties[i]={pool:n,acquired:[]}}this._afterDispatchHandle=T2e(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const t in this._properties){const r=this._properties[t];for(const i of r.acquired)nhe(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(t){const r=this._owner._get(t),i=this._properties[t];let s=i.pool.acquire();for(i.acquired.push(s);s===r;)i.acquired.push(s),s=i.pool.acquire();return s}_release(){for(const t in this._properties){const r=this._properties[t];let i=0;for(const s of r.acquired)nhe(s)?r.acquired[i++]=s:r.pool.release(s);r.acquired.length=i}}}const Iut=pe("mac")?"Meta":"Ctrl",i7={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)i7[e]=String.fromCharCode(e);for(let e=1;e<25;e++)i7[111+e]=`F${e}`;for(let e=65;e<91;e++)i7[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function Put(e){if(e.key!==void 0)return Uo(e);const t=i7[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function $ut(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class Dut{constructor(t,r=[]){this.eventType=t,this.keyModifiers=r}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=t.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}}const Nge=te.getLogger("esri.views.input.InputHandler");class Xa{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const r=this._incoming[t];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?Nge.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(r=>this._handleEvent(r)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,r,i){let s;typeof r=="function"?(i=r,s=[]):s=r||[];const n=typeof t=="string"?new Dut(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=d=>{const p=this._incoming[d.match.eventType];if(p){const f=p.indexOf(d);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new Lut(n,i,{onPause:a,onRemove:a,onResume:d=>{const p=this._incoming[d.match.eventType];p&&!p.includes(d)&&(p.push(d),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw new Error("There is already a callback registered for this outgoing InputEvent: "+t);const r=new Nut(t,{onEmit:(i,s,n,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,s,n,o)},onRemove:i=>{var s;delete this._outgoing[i.eventType],(s=this._manager)==null||s.updateDependencies()}});return this._outgoing[t]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(t){var r;(r=this._manager)==null||r.setPointerCapture(t,!0)}stopCapturingPointer(t){var r;(r=this._manager)==null||r.setPointerCapture(t,!1)}refreshHasPendingInputs(){var t;(t=this._manager)==null||t.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Nge.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){var i;const r=this._incoming[t.type];if(r){for(const s of r)if(s.match.matches(t)&&((i=s.callback)==null||i.call(s,t),t.shouldStopPropagation()))break}}}class Lut{constructor(t,r,i){this.match=t,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class Nut{constructor(t,r){this.eventType=t,this._removed=!1,this._handler=r}emit(t,r,i){this._removed||this._handler.onEmit(this,t,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}class Fut extends Xa{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(t){const r=t.native.pointerType==="touch"?"touch":"mouse",{x:i,y:s}=t;r===this._value&&this._x===i&&this._y===s||(this._value=r,this._x=i,this._y=s,this._onChange(r,i,s))}}class oV{constructor(t){this._observable=new Hne,this._value=t}get(){return Rr(this._observable),this._value}set(t){t!==this._value&&(this._value=t,this._observable.notify())}}class kut extends Xa{constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=new oV(!1),this._onPointerAdd=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.add(t.native.pointerId),this._update())},this._onPointerRemove=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.delete(t.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}get multiTouchActive(){return this._multiTouchActive.get()}_update(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}}let py=class extends be{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Iut,this._latestPointerType="mouse",this._propertiesPool=new Jv({latestPointerLocation:But},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}installHandlers(e,t,r=lx.INTERNAL){if(this._nameToGroup[e])return void te.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void te.getLogger(this.declaredClass).error("Can't register a group of zero handlers");const i={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=i;for(let s=i.handlers.length-1;s>=0;s--){const n=i.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,d)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,d,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(i,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(r=>{var i;r.removed=!0,(i=r.uninstallCallback)==null||i.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):te.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const i=this._handlers[r];i.priorityIndex=r,this._handlersPriority.push(i)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const i=this._handlersPriority[r];i.priorityIndex=r;let s=i.handler.hasSideEffects;if(!s){for(const n of i.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of i.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)$ut(o)||t.add(o)}i.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,r){this._latestPointerType=e;const i=this._get("latestPointerLocation");if(C(i)||i.x!==t||i.y!==r){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=r,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const r=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,i=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,r,i)}_updateKeyModifiers(e,t){if(!t)return;let r=!1;const i=()=>{if(!r){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,r=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(i(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(i(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new Fut((e,t,r)=>this._setLatestPointer(e,t,r)),this._multiTouchHandler=new kut,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],lx.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,lx.INTERNAL)}_setPointerCapture(e,t,r,i){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,n),i?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,r,i){this._emitInputEvent(0,e,t,r,i)}_emitInputEvent(e,t,r,i,s,n){const o=i!==void 0?i:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new Uut(t,r,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new aee,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var t,r;const e=gd(this._currentPropagation);for(;e.events.length>0;){const{event:i,priorityIndex:s}=e.events.pop(),n=i.data&&i.data.eventId;if(!(n!=null&&this._stoppedPropagationEventIds.has(n)))for(e.currentHandler=this._handlersPriority[s];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!i.shouldStopPropagation()&&((r=(t=e.currentHandler).eventCallback)==null||r.call(t,i)),i.shouldStopPropagation()){n!=null&&this._stoppedPropagationEventIds.add(n);break}if(i.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:i,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}_pausePropagation(e){const t=new aee;t.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)t.push(r.events.pop());r.events=t,r.currentHandler=null}}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const i of t.handler.incomingEventMatches){if(r.eventType!==i.eventType)continue;const s=r.keyModifiers.filter(n=>i.keyModifiers.includes(n));if(s.length===r.keyModifiers.length!=(s.length===i.keyModifiers.length))return r.keyModifiers.length>i.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const r of e){let i=0;for(;i<t.length&&this._compareHandlerPriority(r,t[i])>=0;)i++;t.splice(i,0,r)}return t}get debug(){const e=t=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=r};return{injectEvent:(t,r)=>{e(()=>{this._onEventReceived(t,r)})},disablePointerCapture:e}}};u([h({readOnly:!0})],py.prototype,"hasPendingInputs",null),u([h({constructOnly:!0})],py.prototype,"eventSource",void 0),u([h({constructOnly:!0})],py.prototype,"recognizers",void 0),u([h()],py.prototype,"_latestPointerType",void 0),u([h()],py.prototype,"latestPointerType",null),u([h()],py.prototype,"multiTouchActive",null),u([h({readOnly:!0})],py.prototype,"latestPointerLocation",void 0),py=u([I("esri.views.input.InputManager")],py);class Uut{constructor(t,r,i,s,n){this.type=t,this.data=r,this.timestamp=i,this.modifiers=s,this.cancelable=n,this._propagationState=ow.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=ow.STOPPED}shouldStopPropagation(){return(this._propagationState&ow.STOPPED)!=0}async(t){this._propagationState|=ow.PAUSED;const r=(i,s)=>{this._propagationState&=~ow.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw i;return i};return(typeof t=="function"?t():t).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(t){return!!(this._propagationState&ow.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var ow;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(ow||(ow={}));const lx={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class But{}function Ste(e){return e&&typeof e.highlight=="function"}function zut(e){return e&&typeof e.maskOccludee=="function"}function t8t(e,t,r){return C(e)||e>r&&(t===0||e<t)}function r8t(e,t){return e>0||t>0}function i8t(e){var r,i;const t=e.effectiveScaleRange;return{minScale:(r=t==null?void 0:t.minScale)!=null?r:0,maxScale:(i=t==null?void 0:t.maxScale)!=null?i:0}}const s7={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},E2=new OI({id:"zoom-to-feature",title:"{messages.zoom}",className:s7.iconZoom}),Fge=new OI({id:"remove-selected-feature",title:"{messages.remove}",className:s7.iconTrash}),XO=new OI({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:s7.iconZoom}),YO=new OI({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:s7.iconBrowseClusteredFeatures}),Vut="esri.widgets.Popup.PopupViewModel",aV=te.getLogger(Vut),jut=e=>{const{event:t,view:r}=e,{action:i}=t,s=r&&r.popup;if(!i)return Promise.reject(new z("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new z("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=i;if(!o)return Promise.reject(new z("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new z("trigger-action:invalid-action","Action is disabled"));if(o===E2.id)return Hut(s.viewModel).catch(YZ);if(o===XO.id)return qut(s.viewModel);if(o===YO.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===Fge.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new z(`trigger-action:${Fge.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):r.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function u$e(e){const{selectedFeature:t,location:r,view:i}=e;return i?i.type==="3d"?t||r:e.get("selectedFeature.geometry")||r:null}function i2(e){var t,r;return(e==null?void 0:e.isAggregate)&&((r=(t=e==null?void 0:e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:r.type)==="cluster"}async function Gut(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const r=t.getViewForGraphic(e);if(r&&"whenGraphicBounds"in r){let i;try{i=await r.whenGraphicBounds(e,{useViewElevation:!0})}catch{}return!i||!i.boundingBox||i.boundingBox[0]===i.boundingBox[3]&&i.boundingBox[1]===i.boundingBox[4]&&i.boundingBox[2]===i.boundingBox[5]}return!0}async function Hut(e){const{location:t,selectedFeature:r,view:i,zoomFactor:s}=e,n=u$e(e);if(!n){const c=new z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:i});throw aV.error(c),c}const o=i.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&a.type==="point"&&await Gut(r,i);E2.active=!0,E2.disabled=!0;try{await e.zoomTo({target:{target:n,scale:l?o:void 0}})}catch{const d=new z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:r});aV.error(d)}finally{E2.active=!1,E2.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}}async function qut(e){const{selectedFeature:t,view:r}=e;if((r==null?void 0:r.type)!=="2d"){const a=new z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:r});throw aV.error(a),a}if(!i2(t)){const a=new z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw aV.error(a),a}const i=t.sourceLayer,s=await r.whenLayerView(i),n=s.createQuery();n.aggregateIds=[t.getObjectId()],XO.active=!0,XO.disabled=!0;const{extent:o}=await s.queryExtent(n);await e.zoomTo({target:o}),XO.active=!1,XO.disabled=!1}async function Wut(e){const{selectedFeature:t,view:r}=e,i=t.sourceLayer,s=await r.whenLayerView(i),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,r.graphics.add(e.selectedClusterBoundaryFeature)}async function Xut(e){const{selectedFeature:t,view:r}=e,i=t.sourceLayer,s=await r.whenLayerView(i),n=s.createQuery();n.aggregateIds=[t.getObjectId()],YO.active=!0,YO.disabled=!0;const{features:o}=await s.queryFeatures(n);YO.active=!1,YO.disabled=!1,r.popup.open({features:[t].concat(o),featureMenuOpen:!0})}function Yut(e){const t=e.features.filter(r=>i2(r));t.length&&(e.features=t)}const ZD=Ge.ofType({key:"type",defaultKeyValue:"button",base:oj,typeMap:{button:OI,toggle:uOe}}),Zut=()=>[E2.clone()],Jut=()=>[XO.clone(),YO.clone()];let ci=class extends FF(t$e){constructor(e){super(e),this._handles=new hr,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new ZD,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new _i({symbol:new L0({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}initialize(){this._handles.add([ie(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),ie(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),ie(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),ie(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),ie(()=>this.location,e=>this._locationChange(e)),ie(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),ie(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),ie(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),ie(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>jut({event:e,view:this.view})),no(()=>!this.waitingForResult,()=>this._waitingForResultChange(),bi),ie(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),ie(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),no(()=>!this.visible,()=>this.browseClusterEnabled=!1),ie(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new ZD;e.removeAll();const{actions:t,defaultActions:r,defaultPopupTemplateEnabled:i,includeDefaultActions:s,selectedFeature:n}=this,o=s?r.concat(t):t,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(i)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach(d=>e.add(d)),e}get defaultActions(){const e=this._get("defaultActions")||new ZD;return e.removeAll(),e.addMany(i2(this.selectedFeature)?Jut():Zut()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:r,promiseCount:i,selectedFeatureIndex:s}=this,n=i&&t.length;n&&r&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=o0(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const r=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},i=()=>this._updatePendingPromises(t);t.then(r,i)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=u$e(this);return t?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:r}=this;if(!r||!e)throw new z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:r});return r.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:r}=t;delete t.fetchFeatures,r&&this._setFetchFeaturesPromises(t.location);const i=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of i)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){Yut(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?i2(t)?(await Wut(this),await Xut(this)):te.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):te.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(E2.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(i2(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:r}=this;r&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:r,featuresPerPage:i,featureViewModels:s}=this;if(r===null)return;const n=((r-1)*i+t)%t,o=n+i;s.slice(n,o).forEach((a,l)=>{a&&!a.graphic&&(a.graphic=e[n+l])})}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:r,view:i}=this;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(i.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),i2(e)?void 0:(e.symbol=await Rut(e),this._selectedClusterFeature=e,void i.graphics.add(this._selectedClusterFeature));!r&&t||!e.geometry?r&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=i.center.clone()}):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:r,promisesPerLayerView:i}=t,s=Promise.resolve(r),n=i.map(o=>o.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:r}=this;if(i2(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const i=r.slice(0),s=[];t.forEach((n,o)=>{var l,c;if(!n)return;let a=null;if(i.some((d,p)=>(d&&d.graphic===n&&(a=d,i.splice(p,1)),!!a)),a)s[o]=a;else{const d=new Qae({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:n===e?n:null,map:(c=this.view)==null?void 0:c.map,view:this.view});s[o]=d}}),i.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:r}=this;if(t.remove(e),r&&this.view){const i=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},lx.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const r=new AbortController,{signal:i}=r;this._fetchFeaturesController=r,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:i,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:r}=e,{view:i}=this;this._fetchFeaturesWithController(t,e).then(s=>{const{clientOnlyGraphics:n,promisesPerLayerView:o,location:a}=s,l=[Promise.resolve(n),...o.map(c=>c.promise)];return i.popup.open({location:a||r,promises:l}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){var t;return C(e)?null:e.type==="point"?e:e.type==="extent"?e.center:e.type==="polygon"?e.centroid:e.type==="multipoint"||e.type==="polyline"?(t=e.extent)==null?void 0:t.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:r}=e;return r&&"layer"in r&&r.layer?r.layer:(r==null?void 0:r.type)==="map-notes"||(r==null?void 0:r.type)==="subtype-group"?r:t}_getHighlightTarget(e,t){const r=t.type==="imagery"?void 0:"objectIdField"in t?t.objectIdField||y3e:null,i=e.attributes;return i&&r&&i[r]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:r,activeFeature:i,visible:s}=this;if(!(i&&r&&t&&s))return;const n=this._getHighlightLayer(i);if(!(n&&n instanceof fE))return;const o=this._getLayerView(r,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&Ste(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(i,n));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:r,view:i,visible:s}=this;if(!(t&&i&&r&&s))return;const n=this._getHighlightLayer(t);if(!(n&&n instanceof fE))return;const o=this._getLayerView(i,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&Ste(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,n));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const r=e.filter(i=>!t.includes(i));this.features=t.concat(r)}};u([h()],ci.prototype,"featurePage",void 0),u([h()],ci.prototype,"isLoadingFeature",null),u([h({type:ZD})],ci.prototype,"actions",void 0),u([h({readOnly:!0})],ci.prototype,"active",null),u([h()],ci.prototype,"activeFeature",void 0),u([h({readOnly:!0})],ci.prototype,"allActions",null),u([h({type:Boolean})],ci.prototype,"defaultPopupTemplateEnabled",void 0),u([h()],ci.prototype,"autoCloseEnabled",void 0),u([h()],ci.prototype,"autoOpenEnabled",void 0),u([h()],ci.prototype,"browseClusterEnabled",void 0),u([h()],ci.prototype,"content",void 0),u([h({type:ZD,readOnly:!0})],ci.prototype,"defaultActions",null),u([h({readOnly:!0})],ci.prototype,"featureCount",null),u([h()],ci.prototype,"features",null),u([h()],ci.prototype,"featuresPerPage",void 0),u([h()],ci.prototype,"featureViewModelAbilities",void 0),u([h({readOnly:!0})],ci.prototype,"featureViewModels",void 0),u([h()],ci.prototype,"highlightEnabled",void 0),u([h()],ci.prototype,"includeDefaultActions",void 0),u([h({type:lt})],ci.prototype,"location",null),u([h({readOnly:!0})],ci.prototype,"pendingPromisesCount",null),u([h({readOnly:!0})],ci.prototype,"selectedClusterBoundaryFeature",void 0),u([h({readOnly:!0})],ci.prototype,"waitingForResult",null),u([h({readOnly:!0})],ci.prototype,"promiseCount",null),u([h()],ci.prototype,"promises",null),u([h({value:null,readOnly:!0})],ci.prototype,"selectedFeature",null),u([h({value:-1})],ci.prototype,"selectedFeatureIndex",null),u([h({readOnly:!0})],ci.prototype,"selectedFeatureViewModel",null),u([h({readOnly:!0})],ci.prototype,"state",null),u([h()],ci.prototype,"title",void 0),u([h()],ci.prototype,"updateLocationEnabled",void 0),u([h()],ci.prototype,"view",void 0),u([h()],ci.prototype,"visible",void 0),u([h()],ci.prototype,"zoomFactor",void 0),u([h()],ci.prototype,"zoomToLocation",void 0),u([h()],ci.prototype,"centerAtLocation",null),ci=u([I("esri.widgets.Popup.PopupViewModel")],ci);const d$e=ci,kge="selected-index",Kut=0,Uge="popup-spinner",Re={calciteThemeLight:"calcite-theme-light",calciteThemeDark:"calcite-theme-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",actionExit:"esri-popup__action--exit",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button",collapseIcon:"esri-popup__collapse-icon"},Bge={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},zge="esri-popup";function Q0(e,t){return t===void 0?`${zge}__${e}`:`${zge}__${e}-${t}`}const Vge={closeButton:!0,featureNavigation:!0};let $t=class extends Q3e(Ss){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new hr,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([r])=>{r!=null&&r.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=UM(()=>this._displaySpinner(),Kut),this._exitRelatedRecordsActions=new WeakMap,this._flowItems=new Ge,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureMenuOpen=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.spinnerEnabled=!0,this.viewModel=new d$e,this.visibleElements={...Vge},this._addSelectedFeatureIndexHandle(),this.addHandles([ie(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},()=>this._positionContainer()),ie(()=>{var r;return[(r=this.viewModel)==null?void 0:r.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),ie(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},(r,i)=>{!!r!=!!i&&this.reposition()}),ie(()=>{var r,i,s,n,o,a;return[(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.padding,(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.size,(o=this.viewModel)==null?void 0:o.active,(a=this.viewModel)==null?void 0:a.location,this.alignment]},()=>this.reposition()),ie(()=>this.spinnerEnabled,r=>this._spinnerEnabledChange(r)),ie(()=>{var r,i;return(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.size},(r,i)=>this._updateDockEnabledForViewSize(r,i)),ie(()=>{var r;return(r=this.viewModel)==null?void 0:r.view},(r,i)=>this._viewChange(r,i)),ie(()=>{var r,i;return(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.ready},(r,i)=>this._viewReadyChange(r,i)),ie(()=>{var r,i;return[(r=this.viewModel)==null?void 0:r.waitingForResult,(i=this.viewModel)==null?void 0:i.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),ie(()=>this.selectedFeatureWidget,()=>this._destroyFlowItemWidgets()),ie(()=>{var r,i,s,n;return[(i=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:i.title,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setTitleFromFeatureWidget()),ie(()=>{var r,i,s,n;return[(i=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:i.content,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setContentFromFeatureWidget()),no(()=>!this.collapsed,()=>{var r,i;((i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),ms(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},"change",()=>this._watchActions()),ie(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},()=>this._watchActions(),pt),ie(()=>{var r;return(r=this.viewModel)==null?void 0:r.featureViewModels},()=>this._featureMenuViewportScrollTop()),ms(()=>this._flowItems,"change",()=>{this.notifyChange("_activeFlowItemWidget"),this.scheduleRender()}),ie(()=>{var r,i,s,n;return[(i=(r=this._activeFlowItemWidget)==null?void 0:r.viewModel)==null?void 0:i.state,(n=(s=this._activeFlowItemWidget)==null?void 0:s.viewModel)==null?void 0:n.title]},()=>this.scheduleRender())])}loadDependencies(){return Promise.all([re(()=>import("./calcite-flow.69a331bd.js"),["assets/calcite-flow.69a331bd.js","assets/observers.2da64440.js"]),re(()=>import("./calcite-flow-item.d86ee829.js"),["assets/calcite-flow-item.d86ee829.js","assets/panel.28437f15.js","assets/popover.941796be.js","assets/floating-ui.52045298.js","assets/guid.ae96513b.js","assets/openCloseComponent.4cb32f59.js","assets/key.eb5605f7.js","assets/action.e2cbe816.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js","assets/icon.1cb7558b.js","assets/loader.4ea8c9eb.js","assets/tooltip.6ed2d306.js"]),re(()=>import("./calcite-action.3291f9c4.js"),["assets/calcite-action.3291f9c4.js","assets/action.e2cbe816.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js","assets/icon.1cb7558b.js","assets/loader.4ea8c9eb.js","assets/guid.ae96513b.js"]),re(()=>import("./calcite-tooltip.94007c88.js"),["assets/calcite-tooltip.94007c88.js","assets/tooltip.6ed2d306.js","assets/guid.ae96513b.js","assets/floating-ui.52045298.js"]),re(()=>import("./calcite-icon.85645cae.js"),["assets/calcite-icon.85645cae.js","assets/icon.1cb7558b.js","assets/observers.2da64440.js"])])}destroy(){var e,t;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){const{selectedFeatureWidget:e,viewModel:t}=this;if(!e)return!!(t!=null&&t.content);const r=e.viewModel;if((r==null?void 0:r.waitingForContent)||(r==null?void 0:r.state)==="error")return!0;const i=r==null?void 0:r.content;return Array.isArray(i)?!!i.length:!!i}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}get _activeFlowItemWidget(){const{_flowItems:e}=this;return e.getItemAt(e.length-1)||null}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Bge}set dockOptions(e){const t={...Bge},r=this.get("viewModel.view.breakpoints"),i={};r&&(i.width=r.xsmall,i.height=r.xsmall);const s={...t,...e},n={...t.breakpoint,...i},{breakpoint:o}=s;o===!0?s.breakpoint=n:typeof o=="object"&&(s.breakpoint={...n,...o}),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:r,_flowItems:i}=this,{selectedFeatureViewModel:s}=this.viewModel,n={...t,title:!1};return s?(e?(e.viewModel=s,e.visibleElements=n):this._feature=new lut({flowItems:i,headingLevel:r+1,viewModel:s,visibleElements:n}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}castVisibleElements(e){return{...Vge,...e}}blur(){const{active:e}=this.viewModel;e||te.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||te.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,n;this._handles.remove(kge);const t=!!e&&!!e.featureMenuOpen,r=!!e&&!!e.actionsMenuOpen,i={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:r,featureMenuOpen:t};((n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&(i.collapsed=!0),this.set(i),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){var g,_,x,b;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:r,dividedActions:i,currentAlignment:s,currentDockPosition:n}=this,{active:o}=this.viewModel,{menuActions:a}=i,l=o&&a.length>1&&e,c=o&&t,d=o&&!t,p=(_=(g=this.selectedFeature)==null?void 0:g.layer)==null?void 0:_.title,f=(b=(x=this.selectedFeature)==null?void 0:x.layer)==null?void 0:b.id,m={[Re.alignTopCenter]:s==="top-center",[Re.alignBottomCenter]:s==="bottom-center",[Re.alignTopLeft]:s==="top-left",[Re.alignBottomLeft]:s==="bottom-left",[Re.alignTopRight]:s==="top-right",[Re.alignBottomRight]:s==="bottom-right",[Re.isDocked]:c,[Re.shadow]:d,[Re.isDockedTopLeft]:n==="top-left",[Re.isDockedTopCenter]:n==="top-center",[Re.isDockedTopRight]:n==="top-right",[Re.isDockedBottomLeft]:n==="bottom-left",[Re.isDockedBottomCenter]:n==="bottom-center",[Re.isDockedBottomRight]:n==="bottom-right",[Re.isFeatureMenuOpen]:r,[Re.isActionsMenuOpen]:l};return P("div",{class:this.classes(Re.base,m),role:"presentation","data-layer-title":p,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return P("span",{"aria-hidden":"true",class:this.classes(Re.icon,Re.iconLoading,Re.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?P("div",{key:Q0("loading-container"),role:"presentation",class:Re.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=Fh(this.container),t={[Re.iconRightTriangleArrow]:e,[Re.paginationPreviousIconRTL]:e,[Re.iconLeftTriangleArrow]:!e,[Re.paginationPreviousIconLTR]:!e};return P("span",{"aria-hidden":"true",class:this.classes(Re.icon,t)})}renderPreviousButton(){const{messages:e}=this;return P("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Re.button,Re.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=Fh(this.container),t={[Re.iconLeftTriangleArrow]:e,[Re.paginationNextIconRTL]:e,[Re.iconRightTriangleArrow]:!e,[Re.paginationNextIconLTR]:!e};return P("span",{"aria-hidden":"true",class:this.classes(Re.icon,t)})}renderNextButton(){const{messages:e}=this;return P("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Re.button,Re.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:r}=this,{featureCount:i,selectedFeatureIndex:s}=this.viewModel;return P("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Re.button,Re.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":r.menu,title:r.menu},this._getPageText(i,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),r={[Re.iconUndock]:e,[Re.iconDock]:!e,[Re.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[Re.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[Re.iconDockToTop]:!e&&t==="top-center",[Re.iconDockToBottom]:!e&&t==="bottom-center"};return P("span",{"aria-hidden":"true",class:this.classes(r,Re.icon)})}renderDockButton(){var s,n,o;const{dockEnabled:e,messages:t}=this,r=(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint,i=e?t.undock:t.dock;return r!=="xsmall"&&((o=this.dockOptions)==null?void 0:o.buttonEnabled)?P("div",{role:"button","aria-label":i,title:i,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Re.button,Re.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:r,contentCollapsed:i,messagesCommon:s}=this,n={[Re.headerContainerButton]:r},o=P(Sh,{level:this.headingLevel,class:Re.headerTitle,innerHTML:e}),a=r?P("button",{key:`${e}--collapsible`,id:t,title:i?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Re.headerContainer,n),"aria-expanded":i?"false":"true",onclick:this._toggleCollapsed,type:"button"},o,P("calcite-icon",{class:Re.collapseIcon,key:"collapse-icon",icon:i?"chevron-down":"chevron-up",scale:"m"})):P("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Re.headerContainer,n)},o);return e?a:null}renderCloseIcon(){return P("span",{"aria-hidden":"true",class:this.classes(Re.icon,Re.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?P("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Re.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return P("header",{class:Re.header},this.renderTitle(),P("div",{class:Re.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:r,_flowItems:i,messagesCommon:s}=this,{content:n}=this.viewModel,o=i.toArray(),a={[Re.contentHasFlows]:!!o.length};return t&&!r?P("div",{key:n,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:this.classes(Re.content,a)},P("calcite-flow",{bind:this,onCalciteFlowItemBack:this._handleBackClick},P("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode","intl-back":s.back,afterCreate:af,key:"root-flow-item"},this.renderContent()),o.map(l=>this.renderFlowItem(l))),o.map(l=>this.renderFlowItemTooltip(l))):null}renderFlowItem(e){const{messages:t,messagesCommon:r}=this,i=Az();return P("calcite-flow-item",{class:this.classes({[Re.calciteThemeDark]:!i,[Re.calciteThemeLight]:i}),heading:e.title,"intl-back":r.back,description:this._getFlowItemDescription(e),key:`flow-item-${e.viewModel.uid}`},P("calcite-action",{class:Re.actionExit,icon:"move-up",label:t==null?void 0:t.exitRelatedRecords,text:t==null?void 0:t.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:s=>this._storeExitRelatedRecordsAction(e,s),onclick:this._destroyFlowItemWidgets}),P("div",{class:this.classes(Re.contentFlowItem,{[Re.calciteThemeDark]:i,[Re.calciteThemeLight]:!i})},e.render()))}renderFlowItemTooltip(e){const{messages:t,_exitRelatedRecordsActions:r}=this,i=Az();return P("calcite-tooltip",{class:this.classes({[Re.calciteThemeDark]:!i,[Re.calciteThemeLight]:i}),key:`exit-related-records-tooltip-${e.viewModel.uid}`,label:t==null?void 0:t.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:r.get(e),placement:"top"},t==null?void 0:t.exitRelatedRecords)}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:i,messagesCommon:s}=this,n=r?s.close:s.open,{menuActions:o}=i;return o.length?P("div",{key:Q0("actions-menu-button"),class:this.classes(Re.button,Re.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":r?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},P("span",{"aria-hidden":"true",class:Re.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:i}=this,{menuActions:s}=i;return s.length&&r?P("ul",{id:e,role:"menu","aria-labelledby":t,key:Q0("actions"),class:Re.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(t=>this.renderAction({action:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,r=!!e.length,i=!!t.length;return r||i?P("div",{key:"inline-actions-container","data-inline-actions":r.toString(),"data-menu-actions":i.toString(),class:Re.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?P("section",{key:Q0("navigation"),class:this.classes(Re.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:r,menuActions:i}=t,s=!!r.length,n=!!i.length,o={[Re.footerHasPagination]:e,[Re.footerHasActions]:s,[Re.footerHasActionsMenu]:n};return e||s?P("div",{key:Q0("feature-buttons"),class:this.classes(Re.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:r}=this.viewModel,i=hu(e.selectedFeatures,{total:t.length});return P("section",{key:Q0("menu"),class:Re.featureMenu},P("strong",{class:Re.featureMenuHeader},i),P("nav",{bind:this,class:Re.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:af},this.renderFeatureMenu(),P("div",{class:Re.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),r?P("div",{class:Re.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:P("div",{key:Q0("pointer"),class:Re.pointer,role:"presentation"},P("div",{class:this.classes(Re.pointerDirection,Re.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:r,titleId:i,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,d=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||r==="top-left"||r==="top-center"||r==="top-right",p=t==="top-left"||t==="top-center"||t==="top-right"||r==="bottom-left"||r==="bottom-center"||r==="bottom-right",f={[Re.shadow]:e,[Re.isCollapsible]:n,[Re.isCollapsed]:a};return P("div",{class:this.classes(Re.main,Re.widget,f),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?i:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},d?this.renderFooter():null,d?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?P("div",{class:Un.contentNode,key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return P("span",{key:"text",class:Re.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),r=this._getActionImage(e),i={[Re.iconLoading]:e.active,[Re.rotating]:e.active,[Re.icon]:!!t,[Re.actionImage]:!e.active&&!!r};return t&&(i[t]=!e.active),P("span",{key:"icon","aria-hidden":"true",class:this.classes(Re.icon,i),styles:this._getIconStyles(r)})}renderAction(e){const{action:t,type:r}=e,i=this._getActionTitle(t),s={[Re.action]:t.type!=="toggle",[Re.actionToggle]:t.type==="toggle",[Re.actionToggleOn]:t.type==="toggle"&&t.value,[Re.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(i)],o=r==="menu-item"?P("li",{key:t.uid,role:"menuitem",tabIndex:0,title:i,"aria-label":i,class:this.classes(Re.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):P("div",{key:t.uid,role:"button",tabIndex:0,title:i,"aria-label":i,class:this.classes(Re.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:r,messagesCommon:i}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[Re.featureMenuSelected]:o},l=o?P("span",{key:Q0(`feature-menu-selected-feature-${s}`),title:r.selectedFeature,"aria-label":r.selectedFeature,class:Re.iconCheckMark}):null,c=P("span",{innerHTML:e.title||i.untitled});return P("li",{role:"menuitem",tabIndex:-1,key:Q0(`feature-menu-feature-${s}`),class:this.classes(a,Re.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},P("span",{class:Re.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?P("ol",{class:Re.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(r=>!!r.graphic).map((r,i)=>this.renderFeatureMenuItem(r,i))):null}_storeExitRelatedRecordsAction(e,t){this._exitRelatedRecordsActions.set(e,t),this.scheduleRender()}_getFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description}_destroyFlowItemWidgets(){this._flowItems.removeAll().forEach(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_handleBackClick(){const e=this._flowItems.pop();this._exitRelatedRecordsActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy())}_getActionTitle(e){const{messages:t,selectedFeature:r,messagesCommon:i}=this,{id:s}=e,n=r==null?void 0:r.attributes,o=s==="zoom-to-feature"?hu(e.title,{messages:t}):s==="remove-selected-feature"?hu(e.title,{messages:i}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?hu(e.title,{messages:t}):e.title;return o&&n?hu(o,n):o}_getActionClass(e){const{selectedFeature:t}=this,r=t==null?void 0:t.attributes,{className:i,image:s}=e,n=s||i?i:Re.iconDefaultAction;return n&&r?hu(n,r):n}_getActionImage(e){const{selectedFeature:t}=this,r=t==null?void 0:t.attributes,{image:i}=e;return i&&r?hu(i,r):i}_createFeatureUpdatedAnimation(){return u7e("enter",Re.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const r=Math.round(e);return Math.max(t?r-1:r,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(r=>{this._handles.add(ie(()=>[r.uid,r.active,r.className,r.disabled,r.id,r.title,r.image,r.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),r=this._getInlineActionCount(),i=r===null,s=r===0;return{inlineActions:i?t.slice(0):s?new Ge:t.slice(0,r),menuActions:i?new Ge:s?t.slice(0):t.slice(r)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var r,i;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((r=e.viewModel)==null?void 0:r.state)==="error"?t.errorMessage:((i=e.viewModel)==null?void 0:i.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){Uo(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){Uo(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,r=e.currentTarget["data-feature-index"];t.activeFeature=t.features[r]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=Uo(e),{_featureMenuNode:r}=this,i=e.currentTarget["data-feature-index"];if(!r)return;const s=r.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(i+1+n)%n].focus()):(e.stopPropagation(),s[(i-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=Uo(e),{_actionsMenuNode:r}=this,i=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(l=>l.uid===i);if(!r)return;const o=r.querySelectorAll("li"),a=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=Uo(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:r}=this.viewModel;r?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await vx(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=ie(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,r)=>this._selectedFeatureIndexUpdated(t,r));this._handles.add(e,kge)}_selectedFeatureIndexUpdated(e,t){const{featureCount:r}=this;r&&e!==t&&e!==-1&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:r,screenLocation:i,side:s,view:n}=e;if(isNaN(r)||isNaN(t)||!n||!i)return!1;const o=n.padding;return s==="right"&&i.x+r/2>n.width-o.right||s==="left"&&i.x-r/2<o.left||s==="top"&&i.y-t<o.top||s==="bottom"&&i.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:r,_mainContainerNode:i,viewModel:s}=this,{screenLocation:n,view:o}=s;if(C(n)||!o||!r)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(T){return parseInt(T.replace(/[^-\d\.]/g,""),10)}const l=i?window.getComputedStyle(i,null):null,c=l?a(l.getPropertyValue("max-height")):0,d=l?a(l.getPropertyValue("height")):0,{height:p,width:f}=r.getBoundingClientRect(),m=f+t,g=Math.max(p,c,d)+t,_=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"right",view:o}),x=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"left",view:o}),b=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"top",view:o}),w=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:n,side:"bottom",view:o});return x?b?"bottom-right":"top-right":_?b?"bottom-left":"top-left":b?w?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return Fh(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var o;if(e!=="auto")return e;const t=(o=this.viewModel)==null?void 0:o.view,r=Fh(this.container)?"top-left":"top-right";if(!t)return r;const i=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-i.left-i.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:r}=e.getBoundingClientRect(),i=this._calculatePositionStyle(t,r);i&&(e.style.top=i.top,e.style.left=i.left,e.style.bottom=i.bottom,e.style.right=i.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:r}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+r:e}_calculateAlignmentPosition(e,t,r,i){const{currentAlignment:s,_pointerOffsetInPx:n}=this,o=i/2,a=r.height-t,l=r.width-e,{padding:c}=this.view;return s==="bottom-center"?{top:t+n-c.top,left:e-o-c.left}:s==="top-left"?{bottom:a+n-c.bottom,right:l+n-c.right}:s==="bottom-left"?{top:t+n-c.top,right:l+n-c.right}:s==="top-right"?{bottom:a+n-c.bottom,left:e+n-c.left}:s==="bottom-right"?{top:t+n-c.top,left:e+n-c.left}:s==="top-center"?{bottom:a+n-c.bottom,left:e-o-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:r,view:i}=this;if(!i)return;if(r)return{left:"",top:"",right:"",bottom:""};if(C(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,i,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const r=this.get("viewModel.view");this._wireUpView(r)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,r){const[i,s]=e,[n,o]=t,{width:a,height:l}=r;return i<=a&&n>a||i>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const r=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},i=r.left+r.right,s=r.top+r.bottom,n=[],o=[];n[0]=e[0]-i,n[1]=e[1]-s,o[0]=t[0]-i,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const r=t.active&&!e;t.screenLocationEnabled=r}_shouldDockAtCurrentViewSize(e){var a,l;const t=e.breakpoint,r=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!r)return!1;const{width:i,height:s}=r;if(isNaN(i)||isNaN(s))return!1;const n=t.hasOwnProperty("width")&&i<=t.width,o=t.hasOwnProperty("height")&&s<=t.height;return n||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?hu(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,Uge),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new uut({view:e}),e.ui.add(this._spinner,{key:Uge,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:r}=this.viewModel,i=r.findIndex(n=>n.uid===t),s=r.getItemAt(i);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(i)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([h({readOnly:!0})],$t.prototype,"actionsMenuId",null),u([h({readOnly:!0})],$t.prototype,"actionsMenuButtonId",null),u([h({readOnly:!0})],$t.prototype,"featureMenuId",null),u([h({readOnly:!0})],$t.prototype,"titleId",null),u([h({readOnly:!0})],$t.prototype,"contentId",null),u([h({readOnly:!0})],$t.prototype,"hasContent",null),u([h({readOnly:!0})],$t.prototype,"featureNavigationVisible",null),u([h({readOnly:!0})],$t.prototype,"collapsible",null),u([h({readOnly:!0})],$t.prototype,"featureMenuVisible",null),u([h({readOnly:!0})],$t.prototype,"contentCollapsed",null),u([h({readOnly:!0})],$t.prototype,"dividedActions",null),u([h({readOnly:!0,dependsOn:["_flowItems.length"]})],$t.prototype,"_activeFlowItemWidget",null),u([h()],$t.prototype,"actions",null),u([h()],$t.prototype,"actionsMenuOpen",null),u([h()],$t.prototype,"alignment",void 0),u([h()],$t.prototype,"autoCloseEnabled",null),u([h()],$t.prototype,"autoOpenEnabled",null),u([h()],$t.prototype,"defaultPopupTemplateEnabled",null),u([h()],$t.prototype,"content",null),u([h()],$t.prototype,"collapsed",void 0),u([h()],$t.prototype,"collapseEnabled",void 0),u([h({readOnly:!0})],$t.prototype,"currentAlignment",null),u([h({readOnly:!0})],$t.prototype,"currentDockPosition",null),u([h()],$t.prototype,"dockOptions",null),u([h()],$t.prototype,"dockEnabled",void 0),u([h({readOnly:!0})],$t.prototype,"featureCount",null),u([h()],$t.prototype,"featureMenuOpen",void 0),u([h()],$t.prototype,"features",null),u([h()],$t.prototype,"goToOverride",null),u([h()],$t.prototype,"headingLevel",void 0),u([h()],$t.prototype,"highlightEnabled",null),u([h()],$t.prototype,"location",null),u([h()],$t.prototype,"label",null),u([h()],$t.prototype,"maxInlineActions",void 0),u([h(),xi("esri/widgets/Popup/t9n/Popup")],$t.prototype,"messages",void 0),u([h(),xi("esri/t9n/common")],$t.prototype,"messagesCommon",void 0),u([h()],$t.prototype,"promises",null),u([h({readOnly:!0})],$t.prototype,"selectedFeature",null),u([h()],$t.prototype,"selectedFeatureIndex",null),u([h({readOnly:!0})],$t.prototype,"selectedFeatureWidget",null),u([h()],$t.prototype,"spinnerEnabled",void 0),u([h()],$t.prototype,"title",null),u([h()],$t.prototype,"updateLocationEnabled",null),u([h()],$t.prototype,"view",null),u([h({type:d$e}),eoe(["triggerAction","trigger-action"])],$t.prototype,"viewModel",void 0),u([h()],$t.prototype,"visible",null),u([h()],$t.prototype,"visibleElements",void 0),u([Gt("visibleElements")],$t.prototype,"castVisibleElements",null),u([An()],$t.prototype,"_close",null),u([An()],$t.prototype,"_toggleDockEnabled",null),u([An()],$t.prototype,"_toggleFeatureMenu",null),u([An()],$t.prototype,"_toggleActionsMenu",null),u([An()],$t.prototype,"_triggerAction",null),u([An()],$t.prototype,"_selectFeature",null),u([An()],$t.prototype,"_next",null),u([An()],$t.prototype,"_previous",null),$t=u([I("esri.widgets.Popup")],$t);const jge=$t,cW=[0,0];function Qut(e){var i,s;const t=(e.ownerDocument||window.document).defaultView,r=e.getBoundingClientRect();return cW[0]=r.left+((i=t==null?void 0:t.pageXOffset)!=null?i:0),cW[1]=r.top+((s=t==null?void 0:t.pageYOffset)!=null?s:0),cW}function Gge(e){e&&(bEe(e),e.parentNode&&e.parentNode.removeChild(e))}function edt(e){const t=document.createElement("div");return e.appendChild(t),t}const RP=16,sk=750,tdt=512,rdt=2,idt=e=>{let t=class extends e{constructor(...r){var i;super(...r),this._freqInfo={freq:RP,time:sk},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,r.length!==0&&((i=r[0])==null?void 0:i.popup)!==void 0||(this.popup=new jge({view:this})),this.handles.add([ie(()=>this.cursor,s=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",s)}),ie(()=>this.interacting,s=>{const{surface:n}=this;n&&n.setAttribute("data-interacting",s.toString())})])}initialize(){this.handles.add(ie(()=>this.ui,(r,i)=>this._handleUIChange(r,i))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Qe(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}get container(){var r;return(r=this._get("container"))!=null?r:null}set container(r){const i=this._get("container"),s=$F(r),n=s instanceof HTMLDivElement?s:null;if(n||typeof r!="string"||te.getLogger(this.declaredClass).error("#container",`element with id '${r}' not found`),i===n)return;const o="dom-size";if(this.handles.remove(o),this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(Gge(this.root),this._set("root",null)),this.userContent&&(Rhe(this.userContent,i),Gge(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const a=document.createElement("div");a.className="esri-view-user-storage",Rhe(n,a),n.appendChild(a),this._set("userContent",a);const l=document.createElement("div");l.className="esri-view-root",n.insertBefore(l,n.firstChild),this._set("root",l);const c=document.createElement("div");c.className="esri-view-surface",c.setAttribute("role","application"),c.tabIndex=0,l.appendChild(c),this._set("surface",c);const d=new Zme;l.appendChild(d.surface),this._set("overlay",d),ie(()=>d.needsRender,p=>{p&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=cR({render:()=>{var f;return(f=this.overlay)==null?void 0:f.render()}}):this._overlayRenderTaskHandle=Gs(this._overlayRenderTaskHandle)}),this.forceDOMReadyCycle(),this.handles.add(ie(()=>this.size,p=>{const[f,m]=p,g="esri-view-surface--inset-outline";f>=document.body.clientWidth||m>=document.body.clientHeight?c.classList.add(g):c.classList.remove(g)},pt),o),this._set("container",n),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}set popup(r){const i=this._get("popup");i&&i!==r&&i.destroy(),this._set("popup",r)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(r,i,s){const n=this.position;return r-=n?n[0]:0,i-=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}containerToPage(r,i,s){const n=this.position;return r+=n?n[0]:0,i+=n?n[1]:0,s?(s[0]=r,s[1]=i):s=[r,i],s}_handleUIChange(r,i){i&&(this.handles.remove("ui"),i.destroy()),r&&this._wireUI(r),this._set("ui",r)}_wireUI(r){this.handles.remove("ui"),r&&(r.view=this,this.handles.add([ie(()=>this.root,i=>{r.container=i?edt(i):null},pt),ie(()=>this.popup,(i,s)=>{const n="popup",o="manual";s&&r.remove(s,n),i&&(i.view=r.view,r.add(i,{key:n,position:o}))},pt)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=RP,r.time=sk,this.handles.add([(()=>{const i=()=>{r.freq=RP,r.time=sk};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),cR({prepare:i=>{const s=this._measure(),n=this._freqInfo;if(n.time+=i.deltaTime,s&&(n.freq=RP,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?RP:Math.min(sk,n.freq*rdt),!s&&n.freq>=tdt&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,s=r?r.clientHeight:0;if(i===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return i===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:i,height:s}),!0)}_position(){const r=this.container,i=this.position,s=r&&Qut(r);return!!s&&(!i||s[0]!==i[0]||s[1]!==i[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([h()],t.prototype,"container",null),u([h({readOnly:!0})],t.prototype,"focused",null),u([h({readOnly:!0})],t.prototype,"height",void 0),u([h({type:jge})],t.prototype,"popup",null),u([h({type:Zme})],t.prototype,"overlay",void 0),u([h({readOnly:!0})],t.prototype,"position",void 0),u([h({readOnly:!0})],t.prototype,"resizing",void 0),u([h({readOnly:!0})],t.prototype,"root",void 0),u([h({value:null,readOnly:!0})],t.prototype,"size",null),u([h({readOnly:!0})],t.prototype,"surface",void 0),u([h({readOnly:!0})],t.prototype,"suspended",void 0),u([h()],t.prototype,"ui",void 0),u([h({readOnly:!0})],t.prototype,"userContent",void 0),u([h({readOnly:!0})],t.prototype,"width",void 0),u([h()],t.prototype,"widthBreakpoint",void 0),t=u([I("esri.views.DOMContainer")],t),t},ile=te.getLogger("esri.layers.support.ElevationSampler");class h$e{queryElevation(t){return p$e(t.clone(),this)}on(){return ldt}projectIfRequired(t,r){return f$e(t,r)}}class sdt extends h$e{constructor(t,r,i){super(),this.tile=t,this.noDataValue=i;const s=t.tile.extent;this.extent=aj(s,r.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this._aaExtent=s;const n=Fc(r.spatialReference),o=r.lodAt(t.tile.level).resolution*n;this.demResolution={min:o,max:o}}get spatialReference(){return this.extent.spatialReference}contains(t){const r=this.projectIfRequired(t,this.spatialReference);return!C(r)&&this.containsAt(r.x,r.y)}containsAt(t,r){return lj(this._aaExtent,t,r)}elevationAt(t,r){if(!this.containsAt(t,r)){const i=this.extent,s=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return ile.warn("#elevationAt()",`Point used to sample elevation (${t}, ${r}) is outside of the sampler extent (${s})`),this.noDataValue}return yt(this.tile.sample(t,r),this.noDataValue)}}class s8t extends h$e{constructor(t,r,i){let s;super(),typeof r=="number"?(this.noDataValue=r,s=null):(s=r,this.noDataValue=i),this.samplers=s?t.map(o=>new sdt(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=aj(tr(),s.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t,r){for(const i of this.samplers)if(i.containsAt(t,r))return i.elevationAt(t,r);return ile.warn("#elevationAt()",`Point used to sample elevation (${t}, ${r}) is outside of the sampler`),this.noDataValue}}function p$e(e,t){const r=f$e(e,t.spatialReference);if(!r)return null;switch(e.type){case"point":ndt(e,r,t);break;case"polyline":odt(e,r,t);break;case"multipoint":adt(e,r,t)}return e}function f$e(e,t){if(C(e))return null;const r=e.spatialReference;if(r.equals(t))return e;const i=QE(e,t);return i||ile.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),i}function ndt(e,t,r){e.z=r.elevationAt(t.x,t.y)}function odt(e,t,r){jy.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];jy.x=c[0],jy.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(jy.x,jy.y)}}e.hasZ=!0}function adt(e,t,r){jy.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];jy.x=o[0],jy.y=o[1],i&&(n[3]=n[2]),n[2]=r.elevationAt(jy.x,jy.y)}e.hasZ=!0}const jy=new lt,ldt={remove(){}};var Ete;let fy=Ete=class extends fe{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new Ete({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([h({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],fy.prototype,"cols",void 0),u([h({type:bs,json:{write:!0}})],fy.prototype,"level",void 0),u([h({type:String,json:{write:!0}})],fy.prototype,"levelValue",void 0),u([h({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],fy.prototype,"origin",void 0),u([h({type:Number,json:{write:!0}})],fy.prototype,"resolution",void 0),u([h({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],fy.prototype,"rows",void 0),u([h({type:Number,json:{write:!0}})],fy.prototype,"scale",void 0),fy=Ete=u([I("esri.layers.support.LOD")],fy);const m$e=fy;class cdt{constructor(t,r,i,s,n){this.id=t,this.level=r,this.row=i,this.col=s,this.extent=n}}var Nb;const Hge=new gr({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Aa=Nb=class extends fe{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:r,size:i=256,spatialReference:s=Ve.WebMercator,numLODs:n=24}=e;if(!Ll(s)){const p=[];if(r)for(let f=0;f<r.length;f++){const m=r[f];p.push({level:f,scale:m,resolution:m})}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift({level:m,scale:f,resolution:f}),f*=2}return new Nb({dpi:96,lods:p,origin:new lt(0,0,s),size:[i,i],spatialReference:s})}const o=sx(s),a=e.origin?new lt({x:e.origin.x,y:e.origin.y,spatialReference:s}):new lt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Fc(s)*39.37*l),d=[];if(r)for(let p=0;p<r.length;p++){const f=r[p],m=f*c;d.push({level:p,scale:f,resolution:m})}else{let p=FCe(s)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const f=Math.ceil(n/t);d.push({level:0,scale:p,resolution:p*c});for(let m=1;m<f;m++){const g=p/2**t,_=g*c;d.push({level:m,scale:g,resolution:_}),p=g}}return new Nb({dpi:l,lods:d,origin:a,size:[i,i],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=sx(e);return e.isWrappable&&!!r&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return lt.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const i=[],s=this._levelToLOD={};e&&(t=-1/0,r=1/0,e.forEach(n=>{i.push(n.scale),t=n.scale>t?n.scale:t,r=n.scale<r?n.scale:r,s[n.level]=n})),this._set("scales",i),this._set("minScale",t),this._set("maxScale",r),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const r=Math.floor(e),i=r+1;return t[r]/(t[r]/t[i])**(e-r)}scaleToZoom(e){const t=this.scales,r=t.length-1;let i=0;for(;i<r;i++){const s=t[i],n=t[i+1];if(s<=e)return i;if(n===e)return i+1;if(s>e&&n<e)return i+Math.log(s/e)/Math.log(s/n)}return i}snapScale(e,t=.95){const r=this.scaleToZoom(e);return r%Math.floor(r)>=t?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(e,t,r,i){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=r;else if(ml(t.spatialReference,this.spatialReference))n=t.x,o=t.y,i=r;else{const c=QE(t,this.spatialReference);if(C(c))return null;n=c.x,o=c.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new cdt(null,0,0,0,tr())),i.level=e,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(e,t=Nb.ExtrapolateOptions.NONE){let r=this.lodAt(e.level);if(!r&&t===Nb.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(r=o)}if(!r)return;const i=e.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=tr()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const r=this.lodAt(t.level);if(r==null)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return e[0]=this.origin.x+t.col*s,e[1]=this.origin.y-(t.row+1)*n,e[2]=e[0]+s,e[3]=e[1]+n,e}lodAt(e){var t,r;return(r=(t=this._levelToLOD)==null?void 0:t[e])!=null?r:null}clone(){return Nb.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const r=[],i=this.lods.length;for(let s=0;s<i;s++){const n=this.lods[s],o=n.resolution*t;r.push(new m$e({level:n.level,scale:n.scale,resolution:o}))}return new Nb({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const i=e[r];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}};u([h({type:Number,json:{write:!0}})],Aa.prototype,"compressionQuality",void 0),u([h({type:Number,json:{write:!0}})],Aa.prototype,"dpi",void 0),u([h({type:String,json:{read:Hge.read,write:Hge.write,origins:{"web-scene":{read:!1,write:!1}}}})],Aa.prototype,"format",void 0),u([h({readOnly:!0})],Aa.prototype,"isWrappable",null),u([h({type:lt,json:{write:!0}})],Aa.prototype,"origin",void 0),u([me("origin")],Aa.prototype,"readOrigin",null),u([h({type:[m$e],value:null,json:{write:!0}})],Aa.prototype,"lods",null),u([h({readOnly:!0})],Aa.prototype,"minScale",void 0),u([h({readOnly:!0})],Aa.prototype,"maxScale",void 0),u([h({readOnly:!0})],Aa.prototype,"scales",void 0),u([h({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],Aa.prototype,"size",void 0),u([me("size",["rows","cols"])],Aa.prototype,"readSize",null),u([Le("size",{cols:{type:bs},rows:{type:bs}})],Aa.prototype,"writeSize",null),u([h({type:Ve,json:{write:!0}})],Aa.prototype,"spatialReference",void 0),Aa=Nb=u([I("esri.layers.support.TileInfo")],Aa),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(Aa||(Aa={}));const IB=Aa,udt=12;class Ms{constructor(t){const r=Ms.checkUnsupported(t);if(v(r))throw r;const i=t;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=wE(this.spatialReference)||I0(this.spatialReference)||P0(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const s=i.lods.reduce((c,d,p)=>(d.level<c.min&&(c.min=d.level,c.minIndex=p),c.max=Math.max(c.max,d.level),c),{min:1/0,minIndex:0,max:-1/0}),n=i.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new Ms(this.toTileInfo())}toTileInfo(){return new IB({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,r)=>({level:r,scale:t.scale,resolution:t.resolution}))})}getExtent(t,r,i,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+i*o,s[2]=this.origin[0]+(i+1)*o,s[3]=this.origin[1]-r*a,s[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(t,r){this._isWebMercator?(r[0]=lpe(t[0]),r[1]=vz(t[1]),r[2]=lpe(t[2]),r[3]=vz(t[3])):this._isGCS&&(r[0]=Zt(t[0]),r[1]=Zt(t[1]),r[2]=Zt(t[2]),r[3]=Zt(t[3]))}getExtentGeometry(t,r,i,s=new Sr){return this.getExtent(t,r,i,Pg),s.spatialReference=this.spatialReference,s.xmin=Pg[0],s.ymin=Pg[1],s.xmax=Pg[2],s.ymax=Pg[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let r=!1;for(;this.levels.length<=t;){const i=this.levels[this.levels.length-1],s=i.resolution/2;this.levels.push({resolution:s,scale:i.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),r=!0}return r}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const r=this.levels[0].scale;return t>=r?0:Math.log(r/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof Ms)){if(Ms.checkUnsupported(t))return!1;t=new Ms(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,t.levels.length)-1,i=this.levels[r].resolution;let s=.5*i;return!OM(t.origin[0],this.origin[0],s)||!OM(t.origin[1],this.origin[1],s)?!1:(s=.5*i/2**r/this.pixelSize*udt,OM(i,t.levels[r].resolution,s))}rootTilesInExtent(t,r=null,i=1/0){const s=new Array,n=this.levels[0].tileSize;if(C(t)||n[0]===0||n[1]===0)return s;Ms.computeRowColExtent(t,n,this.origin,Pg);let o=Pg[1],a=Pg[3],l=Pg[0],c=Pg[2];const d=c-l,p=a-o;if(d*p>i){const f=Math.floor(Math.sqrt(i));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),d>f&&(l=l+Math.floor(.5*d)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return v(r)&&(r[0]=this.origin[0]+l*n[0],r[1]=this.origin[1]-a*n[1],r[2]=this.origin[0]+c*n[0],r[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,r,i,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-i[0])/r[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-i[0])/r[0])),s[1]=Math.max(0,Math.floor((i[1]-t[3]+n)/r[1])),s[3]=Math.max(0,Math.ceil((i[1]-t[1]-n)/r[1]))}static isPowerOfTwo(t){const r=t.lods,i=r[0].resolution*2**r[0].level;return!r.some(s=>!EHe(s.resolution,i/2**s.level))}static hasGapInLevels(t){const r=t.lods.map(i=>i.level);r.sort((i,s)=>i-s);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(t){const r=t.size[1];return r===t.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(t){const r=t.origin;return t.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return C(t)?sle():t.lods.length<1?new z("tilingscheme:generic","Tiling scheme must have at least one level"):Ms.isPowerOfTwo(t)?Ms.hasGapInLevels(t)?new z("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Ms.tileSizeSupported(t)?Ms.hasOriginPerLODs(t)?new z("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new z("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new z("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,r){const i=t[2]-t[0],s=t[3]-t[1],n=Fc(r),o=1.2*Math.max(i,s),a=256,l=96,c=.0254,d=new Ms(new IB({size:[a,a],origin:{x:t[0]-.5*(o-i),y:t[3]+.5*(o-s)},lods:[{level:0,resolution:o/a,scale:1/(a/l*c/(o*n))}],spatialReference:r}));return d.ensureMaxLod(20),d}static makeWebMercatorAuxiliarySphere(t){const r=new Ms(Ms.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(t),r}static makeGCSWithTileSize(t,r=256,i=16){const s=256/r,n=new Ms(new IB({size:[r,r],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*s,scale:295497598570834e-6*s}]}));return n.ensureMaxLod(i),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function sle(){return new z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Ms.WebMercatorAuxiliarySphereTileInfo=new IB({size:[256,256],origin:{x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ve.WebMercator},spatialReference:Ve.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527591555e-6}]}),Ms.WebMercatorAuxiliarySphere=Ms.makeWebMercatorAuxiliarySphere(19);const Pg=tr(),ZO=64,E$=512,ddt=2.5,TN=CHe(RJ/10),g$e=4,y$e=tr();Ms.WebMercatorAuxiliarySphere.getExtent(0,0,0,y$e);const hdt=tr([-180,-90,180,90]),pdt="Cannot extend surface to encompass all layers because it would result in too many root tiles.",fdt="Surface extent is too large for tile resolution at level 0.";let mdt=4;const PB=e=>e<4?3:mdt;let Fb=class extends $s.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=TN}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(C(e.extent)||C(e.spatialReference))return null;const t=aj(e.extent,e.spatialReference);return t.zmin=e.visibleElevationBounds.min,t.zmax=e.visibleElevationBounds.max,t}get spatialReference(){return yt(this.view.basemapTerrain.spatialReference,Ve.WGS84)}elevationAt(e,t){if(C(this.extent)||!Cc(this.extent,e,t)){const r=v(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return te.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${r})`),this.noDataValue}return yt(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return p$e(e.clone(),this)}};u([h({readOnly:!0})],Fb.prototype,"demResolution",void 0),u([h({readOnly:!0})],Fb.prototype,"extent",null),u([h({readOnly:!0})],Fb.prototype,"noDataValue",void 0),u([h()],Fb.prototype,"spatialReference",null),u([h({constructOnly:!0})],Fb.prototype,"view",void 0),Fb=u([I("esri.views.support.GroundViewElevationSampler")],Fb);const gdt=Fb;let kb=class extends be{constructor(e){super(e),this._handles=new hr,this.view=null,this.layerViews=new Ge}initialize(){this._handles.add(no(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new gdt({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this._handles.remove("updating"),this._handles.add(this.layerViews.map(e=>ie(()=>e.updating,()=>this._updateUpdating(),bi)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([h({readOnly:!0})],kb.prototype,"elevationSampler",null),u([h({type:Boolean,readOnly:!0})],kb.prototype,"updating",null),u([h({constructOnly:!0})],kb.prototype,"view",void 0),u([h({type:Ge,readOnly:!0})],kb.prototype,"layerViews",void 0),u([h({readOnly:!0})],kb.prototype,"suspended",null),kb=u([I("esri.views.GroundView")],kb);const ydt=kb,_dt=e=>{let t=class extends e{async fetchPopupFeatures(r,i){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,i),d=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:ZZ([l,...d]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(r,i,s){return i.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:v(s)?s.event:null,signal:v(s)?s.signal:null,defaultPopupTemplateEnabled:!!v(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(r,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(v(i)&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(r,i){const{results:s,mapPoint:n}=await this.popupHitTest(r),o=s.filter(l=>l.type==="graphic"&&this._isValidPopupGraphic(l.graphic,i)),a=o.length?o[0].mapPoint:null;return{clientGraphics:o.map(l=>l.graphic),queryArea:n,location:n||a}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),v(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return v(r)&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const s=[],n=new Map,o=i.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return t=u([I("esri.views.PopupView")],t),t};let V2=class extends qD{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([Gne({Type:_i,ensureType:ts(_i)})],V2.prototype,"itemType",void 0),V2=u([I("esri.support.GraphicsCollection")],V2);let Ub=class extends be{constructor(e){super(e),this.view=null,this.baseLayerViews=new Ge,this.referenceLayerViews=new Ge,this._loadingHandle=ie(()=>{var t,r;return(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.basemap},t=>{t&&t.load().catch(()=>{})},pt)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,r;if(this.view&&this.view.suspended)return!1;const e=(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};u([h({constructOnly:!0})],Ub.prototype,"view",void 0),u([h({readOnly:!0})],Ub.prototype,"baseLayerViews",void 0),u([h({readOnly:!0})],Ub.prototype,"referenceLayerViews",void 0),u([h({readOnly:!0})],Ub.prototype,"suspended",null),u([h({type:Boolean,readOnly:!0})],Ub.prototype,"updating",null),Ub=u([I("esri.views.BasemapView")],Ub);class vdt{constructor(t,r,i){this.layer=t,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=gx(),this._started=!1,this.done=!1,jl(this._controller.signal,()=>{const s=new z("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:t}),i.emit("layerview-destroy",{layer:r,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:r,view:i}=this;this._map=i.map;try{let o,a;if(await r.load({signal:t}),"prefetchResources"in r&&await r.prefetchResources({signal:t}),r.createLayerView)o=await r.createLayerView(i,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new z("layer:view-not-supported","No layerview implementation was found");const d=await this.layerViewImporter.importLayerView(r);Ir(t),o="default"in d?new d.default({layer:r,view:i}):new d({layer:r,view:i})}const l=()=>{a=Gs(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=jl(t,l),Ir(t);try{await o.when()}catch(d){throw l(),d}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(r)))return l(),void this._deferred.reject(new z("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=o,r.emit("layerview-create",{view:i,layerView:o}),i.emit("layerview-create",{layer:r,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){r.emit("layerview-create-error",{view:i,error:o}),i.emit("layerview-create-error",{layer:r,error:o}),this.done=!0,this._deferred.reject(new z("layerview:create-error","layerview creation failed",{layer:r,error:o}))}}}let Rp=class extends be{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new a0,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const t=(r=this.view.map)==null?void 0:r.allLayers;if(t)for(const i of t)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>(C(this._workPromise)&&(this._workPromise=gx(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(JE(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var o,a,l;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),C(this._workPromise))return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=[],i=c=>{if(!C(c))for(const d of c)d&&(r.push(d),this._createLayerView(d),"layers"in d&&d.layers&&i(d.layers))};for(const c of this._rootCollectionNames)i(this.get(c));this._refreshCollections();for(const[c,d]of this._layerLayerViewInfoMap)r.includes(c)||(this._layerLayerViewInfoMap.delete(d.layer),d.destroy());const s=r.filter(c=>c.type==="group").map(c=>c.layers),n=[(o=t==null?void 0:t.ground)==null?void 0:o.layers,(a=t==null?void 0:t.basemap)==null?void 0:a.baseLayers,(l=t==null?void 0:t.basemap)==null?void 0:l.referenceLayers,t==null?void 0:t.layers,...s].filter(c=>!!c);this.addHandles(n.map(c=>this._watchUpdatingTracking.addOnCollectionChange(()=>c,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([ms(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ie(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Qi)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,v(this._workPromise)&&(this._workPromise.reject(oi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return v(this._workPromise)||this._watchUpdatingTracking.updating||wo(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new z("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,r){if(!e||!t)return void(t&&t.removeAll());let i=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=r,t.getItemAt(i)!==o&&t.splice(i,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),i+=1}i<t.length&&t.splice(i,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new vdt(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),r=>{var i,s;r&&(Ps(r)||r.name==="cancelled:layerview-create")||te.getLogger(this.declaredClass).error(`Failed to create layerview for layer title:'${(i=e.title)!=null?i:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([h()],Rp.prototype,"_workPromise",void 0),u([h({readOnly:!0})],Rp.prototype,"_watchUpdatingTracking",void 0),u([h({readOnly:!0})],Rp.prototype,"_layersToLayerViews",null),u([h({readOnly:!0})],Rp.prototype,"_rootCollectionNames",null),u([h()],Rp.prototype,"layerViewImporter",void 0),u([h()],Rp.prototype,"supportsGround",void 0),u([h({readOnly:!0})],Rp.prototype,"updating",null),u([h({readOnly:!0})],Rp.prototype,"updatingRemaining",null),u([h({constructOnly:!0})],Rp.prototype,"view",void 0),Rp=u([I("esri.views.LayerViewManager")],Rp);const bdt=Rp;let sh=class extends be{constructor(e){super(e),this.factor=1.5,this.offset=hg(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([h({type:Number})],sh.prototype,"factor",void 0),u([h({nonNullable:!0})],sh.prototype,"offset",void 0),u([h()],sh.prototype,"position",void 0),u([h({type:Number,range:{min:0}})],sh.prototype,"size",void 0),u([h()],sh.prototype,"maskUrl",void 0),u([h()],sh.prototype,"maskEnabled",void 0),u([h()],sh.prototype,"overlayUrl",void 0),u([h()],sh.prototype,"overlayEnabled",void 0),u([h({readOnly:!0})],sh.prototype,"version",null),u([h({type:Boolean})],sh.prototype,"visible",void 0),sh=u([I("esri.views.Magnifier")],sh);const _$e=sh;class wdt{constructor(){this._tasks=new Array,this._running=new oV(!1)}get length(){return this._tasks.length}get running(){return this._running.get()}destroy(){this.cancelAll()}runTask(t){for(;!t.done&&this._process(t);)t.madeProgress()}push(t,r,i){return this._running.set(!0),new Promise((s,n)=>this._tasks.push(new qge(s,n,t,r,i)))}unshift(t,r,i){return this._running.set(!0),new Promise((s,n)=>this._tasks.unshift(new qge(s,n,t,r,i)))}_process(t){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const s=Bo(r.signal);if(s&&!r.abortCallback)r.reject(oi());else{const n=s?(i=r.abortCallback)==null?void 0:i.call(r,oi()):r.callback(t);np(n)?n.then(r.resolve,r.reject):r.resolve(n)}}catch(s){r.reject(s)}return this._running.set(this._tasks.length>0),!0}cancelAll(){const t=oi();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(t);r.resolve(i)}else r.reject(t);this._tasks.length=0,this._running.set(!1)}}class qge{constructor(t,r,i,s,n){this.resolve=t,this.reject=r,this.callback=i,this.signal=s,this.abortCallback=n}}let C$=class extends be{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([h()],C$.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([h()],C$.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),C$=u([I("esri.views.support.DebugFlags")],C$);const xdt=new C$;var Kn;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(Kn||(Kn={}));function Tdt(){return new lV.Scheduler}var Ot;(function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="cloud generator",e[e.TEST_PRIO=1]="TEST_PRIO"})(Ot||(Ot={}));const Ly=0,Wge=new Map([[Ot.RESOURCE_CONTROLLER,Ly],[Ot.SLIDE,Ly],[Ot.STREAM_DATA_LOADER,Ly],[Ot.ELEVATION_QUERY,Ly],[Ot.TERRAIN_SURFACE,1],[Ot.SURFACE_GEOMETRY_UPDATES,1],[Ot.GRAPHICS_CORE,2],[Ot.I3S_CONTROLLER,2],[Ot.POINT_CLOUD_LAYER,2],[Ot.FEATURE_TILE_FETCHER,2],[Ot.OVERLAY,4],[Ot.STAGE,4],[Ot.GRAPHICS_DECONFLICTOR,4],[Ot.FILTER_VISIBILITY,4],[Ot.SCALE_VISIBILITY,4],[Ot.FRUSTUM_VISIBILITY,4],[Ot.CLOUDS_GENERATOR,4],[Ot.POINT_OF_INTEREST_FREQUENT,6],[Ot.POINT_OF_INTEREST_INFREQUENT,30],[Ot.LABELER,8],[Ot.FEATURE_QUERY_ENGINE,8],[Ot.FEATURE_TILE_TREE,16],[Ot.FEATURE_TILE_TREE_ACTIVE,Ly],[Ot.ELEVATION_ALIGNMENT,12],[Ot.TEXT_TEXTURE_ATLAS,12],[Ot.TEXTURE_UNLOAD,12],[Ot.LINE_OF_SIGHT_TOOL,16],[Ot.LINE_OF_SIGHT_TOOL_INTERACTIVE,Ly],[Ot.SNAPPING,Ly],[Ot.SHADOW_ACCUMULATOR,30]]),uW=32;function Xge(e){return Wge.has(e)?Wge.get(e):typeof e=="number"?e:1}const Yge=6.5,Zge=1,Sdt=30,Jge=1e3/30,Kge=100,Qge=.9;var lV,dT;(function(e){class t{constructor(){this._updating=new oV(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new fv("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Kn.INTERACTING,this._tasks=new Qt,this._runQueue=new Qt,this._load=0,this._idleStateCallbacks=new Qt,this._idleUpdatesStartFired=!1,this._maxReschedule=uW,this._forceTask=!1,this._debug=!1,this._debugHandle=ie(()=>xdt.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,pt);for(const o of Object.keys(Ot))this.performanceInfo.tasks.set(Ot[o],new fv(Ot[o]));const n=this;this._test={FRAME_SAFETY_BUDGET:Yge,INTERACTING_BUDGET:Jge,IDLE_BUDGET:Kge,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}get updating(){return this._updating.get()}set updating(n){this._updating.set(n)}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Gs(this._debugHandle),this._microTaskQueued=!1,this._updating.set(!1)}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=uW,this._schedule(),this.frame()))}))}registerTask(n,o){const a=Xge(n),l=new r(this,n,o,a);return this._tasks.push(l),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new fv(n)),l}registerIdleStateCallbacks(n,o){const a={idleBegin:n,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Kn.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Kn.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Kn.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(n){this._test.usedBudget=0,++this._frameNumber;let o=Yge,a=n.frameDuration,l=Zge;switch(this.state){case Kn.IDLE:o=0,a=Math.max(Kge,n.frameDuration),l=Sdt;break;case Kn.INTERACTING:a=Math.max(Jge,n.frameDuration);case Kn.ANIMATING:}return a=a-n.elapsedFrameTime-o,this.state!==Kn.IDLE&&a<Zge&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._maxReschedule=uW,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Kn.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Kn.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n)}_updateTask(n){this._tasks.forAll(o=>{o.name===n&&o.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return dT.SCHEDULED;let o=dT.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?o=dT.READY:o!==dT.READY&&(o=dT.WAITING))}),o}_getRuntime(n){let o=0;return this._tasks.forAll(a=>{a.name===n&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let o="";return n.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Qge+n*(1-Qge)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===Ly&&n.needsUpdate&&!this._runQueue.includes(n)&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==Ly&&(!a.task.runOncePerFrame||a.lastFrameRun!==this._frameNumber)&&(n=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this._updating.set(!1),!1;--this._maxReschedule}return this._updating.set(!0),!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)}catch(c){te.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}a.schedulePriority=a.basePriority,a.lastFrameRun=this._frameNumber;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",a.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updating.set(this._tasks.some(c=>c.needsUpdate)),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this._updating.set(this._tasks.some(o=>o.needsUpdate)),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(Ot))this._frameTaskTimes.set(Ot[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(n)}get test(){return this._test}}e.Scheduler=t;class r{constructor(n,o,a,l){this._scheduler=n,this.name=o,this._basePriority=l,this.lastFrameRun=0,this.runtime=0,this._queue=new wdt,this._handles=new hr,this.schedulePriority=this._basePriority,this._task=new oV(v(a)?a:this._queue),this._handles.add(no(()=>this.task.running,()=>n.activate()))}get task(){return this._task.get()}get updating(){return this._queue.running}remove(){this.processQueue(FI),this._scheduler.removeTask(this),this.schedule=SN.schedule,this.reschedule=SN.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const o=Xge(n);this._basePriority!==Ly&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,o,a){return this._queue.push(n,o,a)}reschedule(n,o,a){return this._queue.unshift(n,o,a)}processQueue(n){this._queue.runTask(n)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Kn.IDLE,this._done=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){this._done=this.elapsed>=this._budget&&this._enabled}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this._done=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._done=!1}get hasProgressed(){return this._done}}e.Budget=i})(lV||(lV={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(dT||(dT={}));const FI=(()=>{const e=new lV.Budget;return e.enabled=!1,e})();class Edt{remove(){}processQueue(){}schedule(t,r,i){try{if(Bo(r)){const s=oi();return i?Promise.resolve(i(s)):Promise.reject(s)}return JZ(t(FI))}catch(s){return Promise.reject(s)}}reschedule(t,r,i){return this.schedule(t,r,i)}}const SN=new Edt;let JO=class extends be{constructor(e,t){var r;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r=t==null?void 0:t.registerTask(Ot.TEXTURE_UNLOAD))!=null?r:SN}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,r){const i=this.makeUid(e);let s=this._textureRequests.get(i);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:r},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(i,s)),s.referenceCount++,{uid:i,texture:s.texture,release:()=>this._release(i)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return v(t)?`${e}.${t}px`:e}};u([h()],JO.prototype,"_frameTask",void 0),u([h()],JO.prototype,"updating",null),JO=u([I("esri.views.3d.support.TextureCollection")],JO);var eye;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(eye||(eye={}));const v$e=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],b$e={};function w$e(e){return!!b$e[e]}function Cdt(e){for(const t of e)if(!w$e(t))return!1;return!0}v$e.forEach(e=>{b$e[e]=!0});class Adt{constructor(t){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this._handlers.forEach(({handler:r,priority:i},s)=>this.inputManager.installHandlers(s,[r],i))}disconnect(){this.inputManager&&this._handlers.forEach((t,r)=>this.inputManager.uninstallHandlers(r)),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(t,r,i,s){const n=Array.isArray(t)?t:t.split(",");if(!Cdt(n))return n.some(w$e)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:s=i,s=s!=null?s:lx.DEFAULT;const l=this._createUniqueGroupName(),c=new Odt(this.view,n,a,o);this._handlers.set(l,{handler:c,priority:s});for(const d of n){const p=this._handlerCounts.get(d)||0;this._handlerCounts.set(d,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this._handlerCounts.get(t)}_removeHandler(t,r){if(this._handlers.has(t)){this._handlers.delete(t);for(const i of r){const s=this._handlerCounts.get(i);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):s===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}}class Odt extends Xa{constructor(t,r,i,s){super(!0),this.view=t;for(const n of r)switch(n){case"click":this.registerIncoming("click",i,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:r=>t.async(r),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:r=>t.async(r),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:d}=t;return{type:"click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,screenPoint:hg(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:d}=t;return{type:"double-click",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:d,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:d,timestamp:p}=t;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:d,timestamp:p}=t;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:r,button:i,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:r,button:i,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:d=>t.async(d),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,r){return this.view.toMap(hg(t,r),{exclude:[]})}_wrapDrag(t){const r=t.data,{x:i,y:s}=r.center,{action:n,pointerType:o,button:a}=r;if(n==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:d,timestamp:p}=t,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return n==="end"&&(this._latestDragStart=void 0),{type:"drag",action:n,x:i,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:r.radius,angle:Lc(r.angle),native:l,timestamp:p,cancelable:d,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:r,repeat:i,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:r,repeat:i,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:r,native:i}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:r,native:i,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,r){const{x:i,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,d=a.pointerType,{cancelable:p,timestamp:f}=t;return{type:r,x:i,y:s,pointerId:c,pointerType:d,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:r,y:i,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,d=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:m}=t;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:s,action:d,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:r,data:i,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:r,state:i,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=i;return{type:"gamepad",device:s,timestamp:o,action:r,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var EN,tye,rye;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(EN||(EN={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(tye||(tye={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(rye||(rye={}));function Mdt(e){return[e.on("before-add",t=>{const r=t.item;if(r==null||e.includes(r))return te.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();r.onAdd()}),e.on("after-remove",t=>{const r=t.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function Cte(e){return e.visible&&e.getEditableFlag(EN.USER)&&e.getEditableFlag(EN.MANAGER)}function my(e){return hg(e.x,e.y)}function n8t(e){return Vs(e.x,e.y)}function x$e(e,t){const r=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return hg(t.clientX-r.left,t.clientY-r.top)}function iye(e,t){return t instanceof Event?x$e(e,t):my(t)}function sye(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class Rdt{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,r){const i=()=>t.stopPropagation();switch(t.type){case"pointer-move":nye(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!oye(t))break;const s=my(t),n=this._intersect(s,t.pointerType,r.forEachTool);if(C(n))break;const o=n.manipulator,a=n.tool;!(v(o)&&v(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(t)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,t,r),v(o)&&v(a)&&o.interactive&&o.grabbable&&o.grabbableForEvent(t)&&!o.grabbing&&(this._grabbedManipulators.set(t.pointerId,{manipulator:o,tool:a,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&C(r.activeTool)&&(this._revertToNullActiveTool=!0,r.setActiveTool(n.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),i());break}case"pointer-up":this._draggedManipulators.has(t.pointerId)||this._handlePointerEnd(t,r);break;case"pointer-drag":{if(!oye(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=qi(s,({manipulator:d})=>d),o=qi(s,({tool:d})=>d);if(C(n)||C(o))break;const a=my(t);a.x=_e(a.x,0,r.view.width),a.y=_e(a.y,0,r.view.height);const l=s.start,c=this._draggedManipulators.get(t.pointerId);switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(n.dragging=!0,c?n.events.emit("drag",{action:"update",start:l,screenPoint:a}):n.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{tool:o,manipulator:n,start:l}));break;case"end":n.dragging=!1,c&&n.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,r)}i();break}case"immediate-click":{const s=my(t),n=this._intersect(s,t.pointerType,r.forEachTool);if(Idt(t)||r.forEachTool(c=>{if((!v(n)||n.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let d=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,d=!0)}),d&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),C(n))break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=t.native.shiftKey;o.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const s=my(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=v(n)?n.manipulator:null;if(C(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),i();break}case"double-click":{const s=my(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=v(n)?n.manipulator:null;if(C(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const s=my(t),n=this._intersect(s,t.pointerType,r.forEachTool),o=v(n)?n.manipulator:null;if(C(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(t,r,i){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:my(r)}),this._grabbedManipulators.forEach(({manipulator:s},n)=>{s===t&&this._grabbedManipulators.delete(n)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(t,r){const i=qi(this._grabbedManipulators.get(t.pointerId),({manipulator:s})=>s);C(i)||i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:my(t)}),this._grabbedManipulators.delete(t.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(t){let r=null;return wo(t,({manipulator:i})=>!(C(i)||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(t){this._updateCursor(),this._updateFocusedManipulatorTools(t)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:s})=>{r.add(s)}),this._hoveredManipulators.forEach(({tool:s})=>{i.add(s)}),t(s=>{s.hasGrabbedManipulators=r.has(s),s.hasHoveredManipulators=i.has(s);const n=this._grabbedManipulators.values(),o=J8e(n,({tool:a})=>a===s);s.firstGrabbedManipulator=v(o)?o.manipulator:null})}clearPointers(t,{forEachTool:r,setActiveTool:i},s=!0,n){const o=(a,l)=>a===t&&(C(n)||n===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},d)=>{o(a,l)&&(this._grabbedManipulators.delete(d),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),s&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(t,r,i){let s=null;return i(n=>{if(n.manipulators==null||!Cte(n))return!1;const o=n.manipulators.intersect(t,r);return!C(o)&&(s={tool:n,manipulator:o},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(hg(r.x,r.y),i,r.pointerType,t)})}handleHoverEvent(t,r){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!nye(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(my(t),t.pointerId,t.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(t,r,i,s){let n=this._intersect(t,i,s);const o=qi(this._hoveredManipulators.get(r),({manipulator:a})=>a);v(n)&&!n.manipulator.interactive&&(n=null),v(n)&&o===n.manipulator||(v(o)&&(o.hovering=!1),v(n)?(n.manipulator.hovering=!0,this._hoveredManipulators.set(r,n)):this._hoveredManipulators.delete(r),this._onFocusChange(s))}_afterManipulatorUngrab(t){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(t(null),this._revertToNullActiveTool=!1)}}function nye(e){return e==="mouse"}function oye(e){return e.pointerType!=="mouse"||e.button===0}function Idt(e){return!!e.native.shiftKey}const aye="attached",dW="tools";let R_=class extends gR{constructor(e){super(e),this._manipulatorState=new Rdt,this.tools=new Ge,this.cursor=null,this._forEachTool=t=>{for(const r of this.tools.items)if(t(r))return}}initialize(){this.handles.add([this.view.on(v$e,e=>{this._handleInputEvent(e)},lx.TOOL),...Mdt(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(v(e)&&!this.view.ready)return void te.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),v(t)&&t.deactivate(),v(e)&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const i=Cte(r);!C(this.activeTool)&&i||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!i)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||((t=(e=this.textures)==null?void 0:e.updating)!=null?t:!1)}attach(){this.view.type==="3d"?(this._set("textures",new JO(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ie(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this._forEachManipulator(t=>{t.onElevationChange!=null&&t.onElevationChange(e)})}),cg(()=>this._set("textures",Qe(this.textures)))],aye)):this.handles.add(ie(()=>this.view.extent,()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}))}detach(){v(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(aye)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:r})=>e(r,t))})}_handleInputEvent(e){let t=!1;const r={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};v(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(i=>{!t&&i.visible&&i.handleInputEvent(r)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),!t&&v(this.activeTool)&&this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(dW),this._forEachTool(e=>{if(e instanceof be){const t=ie(()=>[e.cursor,e.visible,e.editable],()=>{Cte(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(t,dW)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],dW)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){e.setEditableFlag(EN.MANAGER,C(this.activeTool)||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;C(e)&&this._forEachTool(t=>!(!v(t.cursor)||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(C(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};u([h({constructOnly:!0,nonNullable:!0})],R_.prototype,"view",void 0),u([h({readOnly:!0,nonNullable:!0})],R_.prototype,"textures",void 0),u([h({value:null})],R_.prototype,"activeTool",null),u([h({readOnly:!0,type:Ge})],R_.prototype,"tools",void 0),u([h({readOnly:!0})],R_.prototype,"cursor",void 0),u([h({readOnly:!0})],R_.prototype,"updating",null),R_=u([I("esri.views.ToolViewManager")],R_);const Pdt=R_;let nO=class extends be{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":$dt.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Ddt[this.deviceType]}};u([h({nonNullable:!0,readOnly:!0})],nO.prototype,"nativeIndex",void 0),u([h({type:String,readOnly:!0})],nO.prototype,"deviceType",null),u([h({type:Number,readOnly:!0})],nO.prototype,"axisThreshold",null),nO=u([I("esri.views.input.gamepad.GamepadInputDevice")],nO);const $dt=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Ddt={standard:.15,spacemouse:.025,unknown:0},nle=nO;let A$=class extends be{constructor(...e){super(...e),this.devices=new Ge,this.enabledFocusMode="document"}};u([h({type:Ge.ofType(nle),readOnly:!0})],A$.prototype,"devices",void 0),u([h({type:["document","view","none"]})],A$.prototype,"enabledFocusMode",void 0),A$=u([I("esri.views.input.gamepad.GamepadSettings")],A$);const Ldt=A$;let $B=class extends be{constructor(){super(...arguments),this.gamepad=new Ldt}};u([h({readOnly:!0})],$B.prototype,"gamepad",void 0),$B=u([I("esri.views.input.Input")],$B);const Ndt=$B;let Bb=class extends be{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([h({type:Boolean,nonNullable:!0})],Bb.prototype,"enabled",void 0),u([h({type:nle})],Bb.prototype,"device",void 0),u([h({type:["pan","zoom"],nonNullable:!0})],Bb.prototype,"mode",void 0),u([h({type:["forward-down","forward-up"],nonNullable:!0})],Bb.prototype,"tiltDirection",void 0),u([h({type:Number,nonNullable:!0})],Bb.prototype,"velocityFactor",void 0),Bb=u([I("esri.views.navigation.gamepad.GamepadSettings")],Bb);const T$e=Bb;let PS=class extends be{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new T$e,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([h({type:Boolean})],PS.prototype,"browserTouchPanEnabled",void 0),u([h({type:T$e,nonNullable:!0})],PS.prototype,"gamepad",void 0),u([h({type:Boolean})],PS.prototype,"momentumEnabled",void 0),u([h({type:Boolean})],PS.prototype,"mouseWheelZoomEnabled",void 0),PS=u([I("esri.views.navigation.Navigation")],PS);const S$e=PS;function o8t(e,t,r){const i=E$e(e),s=t,n=Fdt(i,s,r);if(i){const o=lC.deriveUnitFromSR(i,e.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new z("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!kdt(e)||n===cd.Unsupported)return new z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(n){case cd.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(s==null?void 0:s.heightUnit)||"unknown",l=new z("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case cd.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(s==null?void 0:s.heightModel)||"unknown",l=new z("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}case cd.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(s==null?void 0:s.vertCRS)||"unknown",l=new z("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:s,error:l})}}return null}function Fdt(e,t,r){if(!lye(e)||!lye(t))return cd.Unsupported;if(e==null||t==null)return cd.Ok;if(!r&&e.heightUnit!==t.heightUnit)return cd.Units;if(e.heightModel!==t.heightModel)return cd.HeightModel;switch(e.heightModel){case"gravity-related-height":return cd.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?cd.Ok:cd.CRS;default:return cd.Unsupported}}var cd;function lye(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function kdt(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!O$e(e)}function E$e(e){var i;const t=e.url?aC(e.url):void 0;return!(((i=e.spatialReference)==null?void 0:i.vcsWkid)==null&&v(t)&&t.serverType==="ImageServer")&&C$e(e)&&e.heightModelInfo?e.heightModelInfo:O$e(e)?lC.deriveUnitFromSR(Bdt,e.spatialReference):null}function C$e(e){return"heightModelInfo"in e}function A$e(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":return!0;default:return!1}}function O$e(e){return A$e(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):M$e(e)}function Udt(e){return e.layers!=null||M$e(e)||A$e(e)||C$e(e)}function M$e(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(cd||(cd={}));const Bdt=new lC({heightModel:"gravity-related-height"});let Ate,hW=null;async function zdt(e){hW||(hW=re(()=>Promise.resolve().then(()=>PAt),void 0).then(t=>Ate=t)),await hW,Ir(e)}async function R$e(e,t,r,i){if(!e)return null;const s=e.spatialReference;return aae()||Xv(s,t)?cC(e,t):Ate?Ate.projectGeometry(e,t,r,i):(await Promise.race([zdt(i),Yz(i)]),R$e(e,t,r,i))}let Cs=class extends be{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=lg(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return v(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return C(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,i,s,n;const e=(r=this.map)==null?void 0:r.call(this),t=[];return v(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(i=e==null?void 0:e.basemap)==null?void 0:i.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var s;if(this.suspended)return(s=this._get("_spatialReferenceTask"))!=null?s:{updating:!1};const{layers:e,updating:t}=this._allLayers;let r=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);v(a)&&(r=a)}if(v(r)&&r.length===1)break}if(t&&(C(r)||r.length!==1))return{updating:!0};const i=this._pickSpatialReferenceCandidate(r);return{spatialReference:v(i)?i.spatialReference:null,viewingMode:v(i)?i.viewingMode:null,updating:!1}}get _tileInfoTask(){var r,i,s,n,o,a,l,c;if(!this.required.tileInfo)return(r=this._get("_tileInfoTask"))!=null?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(i=this.map)==null?void 0:i.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const d=e[0].tileInfo;return{tileInfo:d&&d.spatialReference.equals(this.spatialReference)?d:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var r,i,s,n;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))==null?void 0:r.heightModelInfo))return(i=this._get("_heightModelInfoTask"))!=null?i:{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const o of e)if(Udt(o)){const a=E$e(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){var i,s;if(this.suspended||!this.required.extent)return(i=this._get("_extentCandidatesTask"))!=null?i:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,r=[];for(const n of e.layers){const o="fullExtents"in n&&n.fullExtents||(v(n.fullExtent)?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=(s=o.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?s:a;if(l)return{candidates:[{extent:l,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const c of o)r.push({extent:c,layer:n})}return{candidates:r,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(C(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),i=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&i.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:v(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(v(this._projectExtentTask.task)&&(this._projectExtentTask.task=lg(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:i.clone(),task:VF(async s=>{try{const n=await R$e(r.extent,i,r.layer.portalItem,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:n}}catch{if(Bo(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(C(e))return t;const r=[],i=(s,n)=>v(s)?v(n)?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=i(s.viewingMode,n.viewingMode);if(o!==!1){r.push({spatialReference:s.spatialReference,viewingMode:o});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return C(e)||e.length<1?v(t)?{spatialReference:t,viewingMode:null}:null:(v(t)&&e.length>1&&e.some(({spatialReference:r})=>r.equals(t))&&(e=e.filter(({spatialReference:r})=>r.equals(t))),e.length>1&&e.some(({viewingMode:r})=>r!==Ye.Local)&&(e=e.filter(({viewingMode:r})=>r!==Ye.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const r=[];for(const i of t){const s=this.getSpatialReferenceSupport({spatialReference:i,layer:e});if(v(s)){const n=v(s.constraints)?s.constraints:[{spatialReference:i,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)(!this.requiresExtentInSpatialReference||C(this.userSpatialReference)||o.equals(this.userSpatialReference))&&r.push({spatialReference:o,viewingMode:a})}}return r}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:r})=>t.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const i of e)if(this._collectCollection(i,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?e.loadStatus==="not-loaded"?(e.load().catch(()=>{}),"loading"):e.loadStatus:"loaded"}};u([h()],Cs.prototype,"required",void 0),u([h({constructOnly:!0})],Cs.prototype,"map",void 0),u([h({constructOnly:!0})],Cs.prototype,"getSpatialReferenceSupport",void 0),u([h()],Cs.prototype,"defaultSpatialReference",void 0),u([h()],Cs.prototype,"userSpatialReference",void 0),u([h()],Cs.prototype,"sourcePreloadCount",void 0),u([h()],Cs.prototype,"priorityCollection",void 0),u([h()],Cs.prototype,"requiresExtentInSpatialReference",void 0),u([h()],Cs.prototype,"suspended",void 0),u([h({readOnly:!0})],Cs.prototype,"ready",null),u([h({readOnly:!0})],Cs.prototype,"heightModelInfoReady",null),u([h({readOnly:!0})],Cs.prototype,"spatialReference",null),u([h({readOnly:!0})],Cs.prototype,"extent",null),u([h({readOnly:!0})],Cs.prototype,"heightModelInfo",null),u([h({readOnly:!0})],Cs.prototype,"vcsWkid",null),u([h({readOnly:!0})],Cs.prototype,"latestVcsWkid",null),u([h({readOnly:!0})],Cs.prototype,"viewingMode",null),u([h({readOnly:!0})],Cs.prototype,"tileInfo",null),u([h({readOnly:!0})],Cs.prototype,"mapCollections",null),u([h({readOnly:!0})],Cs.prototype,"_allLayers",null),u([h({readOnly:!0})],Cs.prototype,"_spatialReferenceTask",null),u([h({readOnly:!0})],Cs.prototype,"_tileInfoTask",null),u([h({readOnly:!0})],Cs.prototype,"_heightModelInfoTask",null),u([h({readOnly:!0})],Cs.prototype,"_extentCandidatesTask",null),u([h()],Cs.prototype,"_extentTask",null),u([h()],Cs.prototype,"_projectExtentTask",void 0),Cs=u([I("esri.views.support.DefaultsFromMap")],Cs);var DB;let Yt=DB=class extends $0($s.EventedMixin(G9(be))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new nN({getCollections:()=>{var t,r,i;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new V2,this.analyses=new VR,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Ge,this.magnifier=new _$e,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Ndt,this.navigation=new S$e,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Adt(this),this.persistableViewModels=new Ge,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(ie(()=>this.preconditionsReady,t=>{var r,i;t?(this._currentSpatialReference=this.spatialReference,DB.views.add(this)):(this._currentSpatialReference=null,DB.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((r=this.toolViewManager)==null||r.detach(),v(this.analysisViewManager)&&this.analysisViewManager.detach(),(i=this.layerViewManager)==null||i.clear(),this._teardown()):t&&!this.ready&&(this._startup(),v(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},bi))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,vx(()=>this.ready)))),this.basemapView=new Ub({view:this}),this.layerViewManager=new bdt({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Pdt({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ie(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e},{sync:!0,initial:!0}),ie(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),ie(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([ie(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(t&&!this.spatialReference&&r){if(v(e))return;const s=cg(()=>e=lg(e));e=VF(async n=>{try{await yx(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}te.getLogger(this.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Qe(this.graphics),this.analyses=Qe(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Qe(this.analysisViewManager),this.toolViewManager=Qe(this.toolViewManager),this.layerViewManager=Qe(this.layerViewManager),this.basemapView=Qe(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return te.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var e;return(e=this.toolViewManager)==null?void 0:e.activeTool}set activeTool(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}get animation(){return this._get("animation")}set animation(e){this._set("animation",e)}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Cs({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(e){this._set("extent",e)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Hv.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((e=this.defaultsFromMap)!=null&&e.ready)||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&(e!=null&&e.destroyed&&(te.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:e}),e=null),Hv.isLoadable(e)&&e.load().catch(()=>{}),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var t,r;let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&((r=(t=this.defaultsFromMap)==null?void 0:t.required)==null?void 0:r.heightModelInfo)&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!ml(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var e;return(e=this.toolViewManager)==null?void 0:e.tools}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return v(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,r;return(r=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)!=null?r:null}importLayerView(e){throw new z("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return v(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&te.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(no(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};Yt.views=new Ge,u([h()],Yt.prototype,"_userSpatialReference",void 0),u([h()],Yt.prototype,"activeTool",null),u([h({readOnly:!0})],Yt.prototype,"allLayerViews",void 0),u([h()],Yt.prototype,"groundView",void 0),u([h()],Yt.prototype,"animation",null),u([h()],Yt.prototype,"basemapView",void 0),u([h({readOnly:!0})],Yt.prototype,"_defaultsFromMapSettings",null),u([h()],Yt.prototype,"defaultsFromMap",null),u([h()],Yt.prototype,"fatalError",void 0),u([h({type:Sr})],Yt.prototype,"extent",null),u([h(tV(V2,"graphics"))],Yt.prototype,"graphics",void 0),u([h(tV(VR,"analyses"))],Yt.prototype,"analyses",void 0),u([h({readOnly:!0,type:lC})],Yt.prototype,"heightModelInfo",null),u([h({readOnly:!0})],Yt.prototype,"interacting",null),u([h({readOnly:!0})],Yt.prototype,"navigating",null),u([h({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Yt.prototype,"preconditionsReady",null),u([h({readOnly:!0})],Yt.prototype,"typeSpecificPreconditionsReady",void 0),u([h({type:Ge,readOnly:!0})],Yt.prototype,"layerViews",void 0),u([h({type:_$e})],Yt.prototype,"magnifier",void 0),u([h({value:null,type:WAe})],Yt.prototype,"map",null),u([h()],Yt.prototype,"padding",void 0),u([h({readOnly:!0})],Yt.prototype,"ready",void 0),u([h({type:Ve})],Yt.prototype,"spatialReference",null),u([h()],Yt.prototype,"spatialReferenceWarningDelay",void 0),u([h()],Yt.prototype,"stationary",null),u([h({readOnly:!0})],Yt.prototype,"supportsGround",void 0),u([h({type:bg})],Yt.prototype,"timeExtent",void 0),u([h()],Yt.prototype,"tools",null),u([h()],Yt.prototype,"toolViewManager",void 0),u([h({readOnly:!0})],Yt.prototype,"type",void 0),u([h({type:Number})],Yt.prototype,"scale",void 0),u([h({readOnly:!0})],Yt.prototype,"updating",void 0),u([h({readOnly:!0})],Yt.prototype,"initialExtentRequired",void 0),u([h({readOnly:!0})],Yt.prototype,"initialExtent",null),u([h()],Yt.prototype,"cursor",null),u([h({readOnly:!0})],Yt.prototype,"input",void 0),u([h({type:S$e,nonNullable:!0})],Yt.prototype,"navigation",void 0),u([h()],Yt.prototype,"layerViewManager",void 0),u([h()],Yt.prototype,"analysisViewManager",void 0),u([h()],Yt.prototype,"width",void 0),u([h()],Yt.prototype,"height",void 0),u([h({readOnly:!0})],Yt.prototype,"resizing",void 0),u([h({value:null,readOnly:!0})],Yt.prototype,"size",null),u([h({readOnly:!0})],Yt.prototype,"suspended",void 0),u([h({readOnly:!0})],Yt.prototype,"viewEvents",void 0),u([h({readOnly:!0})],Yt.prototype,"persistableViewModels",void 0),u([h()],Yt.prototype,"_isValid",void 0),u([h()],Yt.prototype,"_readyCycleForced",void 0),u([h()],Yt.prototype,"_currentSpatialReference",void 0),Yt=DB=u([I("esri.views.View")],Yt);const Vdt=Yt;let zb=class extends az{constructor(e){super(e),this.state="running",this.target=null,this._dfd=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._dfd)==null||e.reject(new z("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._dfd)==null||e.resolve())}update(e,t){t||(t=np(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([h({readOnly:!0})],zb.prototype,"done",null),u([h({readOnly:!0,type:String})],zb.prototype,"state",void 0),u([h()],zb.prototype,"target",void 0),zb=u([I("esri.views.ViewAnimation")],zb),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(zb||(zb={}));const jR=zb,IP=()=>re(()=>import("./TileLayerView3D.01b3bdc3.js"),["assets/TileLayerView3D.01b3bdc3.js","assets/LayerView3D.f1da0554.js","assets/TiledLayerView3D.1a5598ab.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js","assets/clickToleranceUtils.974405a9.js","assets/drapedUtils.8f9216e3.js"]),cye=()=>re(()=>import("./ElevationLayerView3D.1c9ff786.js"),["assets/ElevationLayerView3D.1c9ff786.js","assets/LayerView3D.f1da0554.js","assets/TiledLayerView3D.1a5598ab.js","assets/LayerView.936aa3b6.js"]),uye={"base-dynamic":()=>re(()=>import("./BaseDynamicLayerView3D.c66942bb.js"),["assets/BaseDynamicLayerView3D.c66942bb.js","assets/DynamicLayerView3D.f6630392.js","assets/LayerView3D.f1da0554.js","assets/projectExtentUtils.4964cd94.js","assets/ImageMaterial.d515ca27.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js"]),"base-elevation":cye,"base-tile":IP,"bing-maps":IP,"building-scene":()=>re(()=>import("./BuildingSceneLayerView3D.348f0a75.js"),["assets/BuildingSceneLayerView3D.348f0a75.js","assets/BuildingGroupSublayer.9683b246.js","assets/BuildingComponentSublayer.7ba7d0e6.js","assets/WhereClause.b191b7a3.js","assets/I3SMeshView3D.cf880255.js","assets/I3SOverrides.23567206.js","assets/I3SNode.c9dda13d.js","assets/RenderTexture.01478576.js","assets/FeatureLayerView3D.1d7d300a.js","assets/FeatureLayerViewBase3D.03d2caaa.js","assets/FeatureLikeLayerView3D.0bbb378c.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/hash.e6424875.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/floorFilterUtils.05eb8c6a.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/FeatureStore.d33bd861.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView3D.f1da0554.js","assets/EventedSet.fd44f218.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js","assets/SceneModification.d9d56272.js","assets/SceneLayerWorker.bca20aca.js","assets/I3SQueryFeatureStore.d4cb3fbd.js","assets/DefinitionExpressionSceneLayerView.edff38b3.js"]),csv:()=>re(()=>import("./CSVLayerView3D.94727a79.js"),["assets/CSVLayerView3D.94727a79.js","assets/FeatureLayerViewBase3D.03d2caaa.js","assets/FeatureLikeLayerView3D.0bbb378c.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/hash.e6424875.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/floorFilterUtils.05eb8c6a.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/FeatureStore.d33bd861.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView3D.f1da0554.js","assets/EventedSet.fd44f218.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js"]),dimension:()=>re(()=>import("./DimensionLayerView3D.f6e465b4.js"),["assets/DimensionLayerView3D.f6e465b4.js","assets/LayerView3D.f1da0554.js","assets/LayerView.936aa3b6.js"]),elevation:cye,feature:()=>re(()=>import("./FeatureLayerView3D.1d7d300a.js"),["assets/FeatureLayerView3D.1d7d300a.js","assets/FeatureLayerViewBase3D.03d2caaa.js","assets/FeatureLikeLayerView3D.0bbb378c.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/hash.e6424875.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/floorFilterUtils.05eb8c6a.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/FeatureStore.d33bd861.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView3D.f1da0554.js","assets/EventedSet.fd44f218.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js"]),geojson:()=>re(()=>import("./GeoJSONLayerView3D.7d062811.js"),["assets/GeoJSONLayerView3D.7d062811.js","assets/FeatureLayerViewBase3D.03d2caaa.js","assets/FeatureLikeLayerView3D.0bbb378c.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/hash.e6424875.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/floorFilterUtils.05eb8c6a.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/FeatureStore.d33bd861.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView3D.f1da0554.js","assets/EventedSet.fd44f218.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js"]),graphics:()=>re(()=>import("./GraphicsLayerView3D.a1687817.js"),["assets/GraphicsLayerView3D.a1687817.js","assets/LayerView3D.f1da0554.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/GraphicsProcessor.035ada2b.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView.936aa3b6.js"]),group:()=>re(()=>import("./GroupLayerView.d1a84946.js"),["assets/GroupLayerView.d1a84946.js","assets/LayerView.936aa3b6.js"]),imagery:()=>re(()=>import("./ImageryLayerView3D.80b2c160.js"),["assets/ImageryLayerView3D.80b2c160.js","assets/DynamicLayerView3D.f6630392.js","assets/LayerView3D.f1da0554.js","assets/projectExtentUtils.4964cd94.js","assets/ImageMaterial.d515ca27.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js"]),"integrated-mesh":()=>re(()=>import("./IntegratedMeshLayerView3D.91fe367c.js"),["assets/IntegratedMeshLayerView3D.91fe367c.js","assets/I3SMeshView3D.cf880255.js","assets/I3SOverrides.23567206.js","assets/I3SNode.c9dda13d.js","assets/RenderTexture.01478576.js","assets/FeatureLayerView3D.1d7d300a.js","assets/FeatureLayerViewBase3D.03d2caaa.js","assets/FeatureLikeLayerView3D.0bbb378c.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/hash.e6424875.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/floorFilterUtils.05eb8c6a.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/FeatureStore.d33bd861.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView3D.f1da0554.js","assets/EventedSet.fd44f218.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js","assets/SceneModification.d9d56272.js","assets/SceneLayerWorker.bca20aca.js"]),"line-of-sight":()=>re(()=>import("./LineOfSightLayerView3D.15351855.js"),["assets/LineOfSightLayerView3D.15351855.js","assets/LayerView3D.f1da0554.js","assets/LayerView.936aa3b6.js"]),"map-image":()=>re(()=>import("./MapImageLayerView3D.7958bfb2.js"),["assets/MapImageLayerView3D.7958bfb2.js","assets/DynamicLayerView3D.f6630392.js","assets/LayerView3D.f1da0554.js","assets/projectExtentUtils.4964cd94.js","assets/ImageMaterial.d515ca27.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js","assets/ExportImageParameters.1114027d.js","assets/floorFilterUtils.05eb8c6a.js","assets/sublayerUtils.31d4b536.js","assets/clickToleranceUtils.974405a9.js","assets/drapedUtils.8f9216e3.js"]),media:()=>re(()=>import("./MediaLayerView3D.2d1ea156.js"),["assets/MediaLayerView3D.2d1ea156.js","assets/normalizeUtilsSync.4b82c19d.js","assets/LayerView3D.f1da0554.js","assets/ImageMaterial.d515ca27.js","assets/LayerView.936aa3b6.js"]),"ogc-feature":()=>re(()=>import("./OGCFeatureLayerView3D.25c095f3.js"),["assets/OGCFeatureLayerView3D.25c095f3.js","assets/FeatureLayerViewBase3D.03d2caaa.js","assets/FeatureLikeLayerView3D.0bbb378c.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/hash.e6424875.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/floorFilterUtils.05eb8c6a.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/FeatureStore.d33bd861.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView3D.f1da0554.js","assets/EventedSet.fd44f218.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js"]),"open-street-map":IP,"oriented-imagery":()=>re(()=>import("./FeatureLayerView3D.1d7d300a.js"),["assets/FeatureLayerView3D.1d7d300a.js","assets/FeatureLayerViewBase3D.03d2caaa.js","assets/FeatureLikeLayerView3D.0bbb378c.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/hash.e6424875.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/floorFilterUtils.05eb8c6a.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/FeatureStore.d33bd861.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView3D.f1da0554.js","assets/EventedSet.fd44f218.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js"]),"point-cloud":()=>re(()=>import("./PointCloudLayerView3D.6b7487ca.js").then(e=>e.P),["assets/PointCloudLayerView3D.6b7487ca.js","assets/LayerView3D.f1da0554.js","assets/PointCloudWorkerUtil.bcceab02.js","assets/PointCloudUniqueValueRenderer.a85b1572.js","assets/PopupSceneLayerView.2ab81202.js","assets/LayerView.936aa3b6.js"]),voxel:()=>re(()=>import("./VoxelLayerView3D.e776587b.js"),["assets/VoxelLayerView3D.e776587b.js","assets/LayerView3D.f1da0554.js","assets/LayerView.936aa3b6.js"]),route:()=>re(()=>import("./RouteLayerView3D.b4660596.js"),["assets/RouteLayerView3D.b4660596.js","assets/LayerView3D.f1da0554.js","assets/GraphicsProcessor.035ada2b.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/projectExtentUtils.4964cd94.js","assets/EventedSet.fd44f218.js","assets/LayerView.936aa3b6.js"]),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?re(()=>import("./SceneLayerView3D.bdedd0cb.js"),["assets/SceneLayerView3D.bdedd0cb.js","assets/WhereClause.b191b7a3.js","assets/floorFilterUtils.05eb8c6a.js","assets/I3SMeshView3D.cf880255.js","assets/I3SOverrides.23567206.js","assets/I3SNode.c9dda13d.js","assets/RenderTexture.01478576.js","assets/FeatureLayerView3D.1d7d300a.js","assets/FeatureLayerViewBase3D.03d2caaa.js","assets/FeatureLikeLayerView3D.0bbb378c.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/hash.e6424875.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/FeatureStore.d33bd861.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView3D.f1da0554.js","assets/EventedSet.fd44f218.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js","assets/SceneModification.d9d56272.js","assets/SceneLayerWorker.bca20aca.js","assets/SceneLayerView.2f49acea.js","assets/DefinitionExpressionSceneLayerView.edff38b3.js","assets/I3SQueryFeatureStore.d4cb3fbd.js","assets/PopupSceneLayerView.2ab81202.js"]):re(()=>import("./SceneLayerGraphicsView3D.ee309e73.js"),["assets/SceneLayerGraphicsView3D.ee309e73.js","assets/I3SOverrides.23567206.js","assets/I3SNode.c9dda13d.js","assets/RenderTexture.01478576.js","assets/FeatureLayerView3D.1d7d300a.js","assets/FeatureLayerViewBase3D.03d2caaa.js","assets/FeatureLikeLayerView3D.0bbb378c.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/hash.e6424875.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/floorFilterUtils.05eb8c6a.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/FeatureStore.d33bd861.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView3D.f1da0554.js","assets/EventedSet.fd44f218.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js","assets/SceneLayerView.2f49acea.js","assets/DefinitionExpressionSceneLayerView.edff38b3.js","assets/PopupSceneLayerView.2ab81202.js"]),stream:()=>re(()=>import("./StreamLayerView3D.9498e139.js"),["assets/StreamLayerView3D.9498e139.js","assets/StreamFeatureManager.a70d79e9.js","assets/createConnection.2c16c68b.js","assets/EventedSet.fd44f218.js","assets/FeatureLikeLayerView3D.0bbb378c.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/hash.e6424875.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/floorFilterUtils.05eb8c6a.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/FeatureStore.d33bd861.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView3D.f1da0554.js","assets/LayerView.936aa3b6.js"]),tile:IP,"imagery-tile":()=>re(()=>import("./ImageryTileLayerView3D.fe698480.js"),["assets/ImageryTileLayerView3D.fe698480.js","assets/LayerView3D.f1da0554.js","assets/TiledLayerView3D.1a5598ab.js","assets/rasterProjectionHelper.756a5400.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js","assets/drapedUtils.8f9216e3.js"]),"vector-tile":()=>re(()=>import("./VectorTileLayerView3D.13bb7628.js"),["assets/VectorTileLayerView3D.13bb7628.js","assets/GeometryUtils.12948ca8.js","assets/rasterizingUtils.662fbc15.js","assets/StyleRepository.fa6f6392.js","assets/enums.6b5e3ac2.js","assets/colorUtils.bb6424b7.js","assets/Geometry.d049a63c.js","assets/TileInfoView.2ed0d6a8.js","assets/number.30628ef2.js","assets/LayerView3D.f1da0554.js","assets/TiledLayerView3D.1a5598ab.js","assets/LayerView.936aa3b6.js"]),wcs:()=>re(()=>import("./ImageryTileLayerView3D.fe698480.js"),["assets/ImageryTileLayerView3D.fe698480.js","assets/LayerView3D.f1da0554.js","assets/TiledLayerView3D.1a5598ab.js","assets/rasterProjectionHelper.756a5400.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js","assets/drapedUtils.8f9216e3.js"]),"web-tile":IP,wfs:()=>re(()=>import("./WFSLayerView3D.75a9214f.js"),["assets/WFSLayerView3D.75a9214f.js","assets/FeatureLayerViewBase3D.03d2caaa.js","assets/FeatureLikeLayerView3D.0bbb378c.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/queryForSymbologySnapping.35ee0400.js","assets/elevationInfoUtils.85d694b1.js","assets/hash.e6424875.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js","assets/floorFilterUtils.05eb8c6a.js","assets/QueryEngine.cce283e7.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/QueryEngineCapabilities.78217f95.js","assets/FeatureStore.d33bd861.js","assets/projectExtentUtils.4964cd94.js","assets/LayerView3D.f1da0554.js","assets/EventedSet.fd44f218.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js"]),wms:()=>re(()=>import("./WMSLayerView3D.304f1df0.js"),["assets/WMSLayerView3D.304f1df0.js","assets/DynamicLayerView3D.f6630392.js","assets/LayerView3D.f1da0554.js","assets/projectExtentUtils.4964cd94.js","assets/ImageMaterial.d515ca27.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js","assets/ExportWMSImageParameters.ffb1409c.js"]),wmts:()=>re(()=>import("./WMTSLayerView3D.d7937850.js"),["assets/WMTSLayerView3D.d7937850.js","assets/LayerView3D.f1da0554.js","assets/TiledLayerView3D.1a5598ab.js","assets/LayerView.936aa3b6.js","assets/RefreshableLayerView.7541f643.js"]),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function jdt(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new z(`${r}:view-not-supported`,`${t} is not supported in 3D`)}const dye={hasLayerViewModule:e=>v(uye[e.type]),importLayerView:e=>{const t=uye[e.type];if(C(t))throw jdt(e);return t(e)}},hye="analyses-owner-handles";var KO,s2;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(KO||(KO={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(s2||(s2={}));let $S=class extends gR{constructor(e){super(e),this._allAnalysisViews=new Ge,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=pye(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(oi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(oi()),this._attachedToViewResolver=pye()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(C(t)||t.state.list===s2.REMOVED)throw new z("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),hye)}_disconnectOwners(){this.handles.remove(hye),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const i of e)this._addAnalysis(i);const t=e.on("after-add",i=>this._addAnalysis(i.item)),r=e.on("after-remove",i=>this._removeAnalysis(i.item));return{remove:()=>{t.remove(),r.remove();for(const i of e)this._removeAnalysis(i)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const r={state:{view:KO.PENDING,list:s2.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=VF(i=>this._createAnalysisViewPromise(r,i))}else t.state.list=s2.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=s2.REMOVED,this._scheduleUpdate()):te.getLogger(this.declaredClass).error("Trying to remove analysis which was not added")}_scheduleUpdate(){v(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=JE(()=>this._update()))}_update(){this._scheduledUpdateHandle=Gs(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===s2.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case KO.PENDING:e.createAnalysisViewTask=lg(e.createAnalysisViewTask);break;case KO.CREATED:v(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=Qe(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const r=e.analysis,i=r.type,s=this._analysisModules[i];if(this._creatingViewCount+=1,C(s.module))try{s.module=await this._loadAnalysisModule(i)}catch(o){throw this._creatingViewCount-=1,o}if(Bo(t))throw this._creatingViewCount-=1,oi("AnalysisView creation aborted");const n=new s.module.default({analysis:r,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(Bo(t))throw this._creatingViewCount-=1,n.destroy(),oi("AnalysisView creation aborted");return e.view=n,e.state.view=KO.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return re(()=>import("./AreaMeasurementAnalysisView3D.c7a5a666.js").then(t=>t.A),["assets/AreaMeasurementAnalysisView3D.c7a5a666.js","assets/LineVisualElement.cecc7fde.js","assets/UnitNormalizer.9627ba49.js","assets/geometryEngine.52f29a6f.js","assets/geometryEngineBase.82b25ca5.js","assets/hydrated.11ec29fd.js","assets/EditGeometryOperations.0fb2a4e3.js","assets/Segment.325480c6.js","assets/elevationInfoUtils.85d694b1.js"]);case"dimension":return re(()=>import("./DimensionAnalysisView3D.a9359da6.js").then(t=>t.D),["assets/DimensionAnalysisView3D.a9359da6.js","assets/LineVisualElement.cecc7fde.js","assets/LengthDimension.3c5edd6c.js","assets/Segment.325480c6.js","assets/elevationInfoUtils.85d694b1.js","assets/analysisViewUtils.9f937a13.js","assets/ImageMaterial.d515ca27.js","assets/Factory.03b5acfe.js","assets/PointVisualElement.4fcc80cb.js","assets/RightAngleQuadVisualElement.03ca81cb.js","assets/colorUtils.bb6424b7.js","assets/EditGeometryOperations.0fb2a4e3.js","assets/QueryEngineResult.fb48dac5.js","assets/WhereClause.b191b7a3.js","assets/utils.40423a49.js","assets/generateRendererUtils.a175dd7f.js","assets/json.879c9adc.js","assets/dehydratedFeatureComparison.f850b7c4.js","assets/RenderTexture.01478576.js"]);case"direct-line-measurement":return re(()=>import("./DirectLineMeasurementAnalysisView3D.c54f5f69.js").then(t=>t.D),["assets/DirectLineMeasurementAnalysisView3D.c54f5f69.js","assets/LineVisualElement.cecc7fde.js","assets/UnitNormalizer.9627ba49.js","assets/geometryEngine.52f29a6f.js","assets/geometryEngineBase.82b25ca5.js","assets/hydrated.11ec29fd.js","assets/Segment.325480c6.js","assets/elevationInfoUtils.85d694b1.js","assets/RightAngleQuadVisualElement.03ca81cb.js"]);case"line-of-sight":return re(()=>import("./LineOfSightAnalysisView3D.02e68fb1.js"),["assets/LineOfSightAnalysisView3D.02e68fb1.js","assets/LineVisualElement.cecc7fde.js","assets/LineOfSightAnalysisTarget.b39ec941.js","assets/elevationInfoUtils.85d694b1.js","assets/analysisViewUtils.9f937a13.js","assets/ImageMaterial.d515ca27.js","assets/PointVisualElement.4fcc80cb.js"]);case"slice":return re(()=>import("./SliceAnalysisView3D.765d0c81.js").then(t=>t.S),["assets/SliceAnalysisView3D.765d0c81.js","assets/LineVisualElement.cecc7fde.js","assets/BuildingComponentSublayer.7ba7d0e6.js","assets/analysisViewUtils.9f937a13.js","assets/ImageMaterial.d515ca27.js","assets/Factory.03b5acfe.js"])}}};function pye(){const e=_x();return e.promise.catch(()=>{}),e}u([h()],$S.prototype,"updating",null),u([h({constructOnly:!0})],$S.prototype,"view",void 0),u([h()],$S.prototype,"_allAnalysisViews",void 0),u([h()],$S.prototype,"_creatingViewCount",void 0),$S=u([I("esri.views.3d.analysis.AnalysisViewManager3D")],$S);const Gdt=$S;let I_=class extends be{constructor(e){super(e),this.collision=new O$,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Ye.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ye.Local?this._set("altitude",e):te.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?_e(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const r=this.tilt(e);return _e(t,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ye.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,r=pW)=>(r.min=al.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?TB([[4e3,al.max],[1e4,Zt(88)],[6e6,Zt(88)]]):()=>al.max;return(t,r=pW)=>(r.min=al.min,r.max=e(t),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?TB([[4e3,al.max],[5e4,Zt(88)],[6e6,Zt(88)],[2e7,al.min]]):TB([[3e5,al.max],[3e6,Zt(88)],[6e6,Zt(88)],[2e7,al.min]]);return(t,r=pW)=>(r.min=al.min,r.max=e(t),r)}};function Hdt(e){return{min:-2e5,max:4*e.radius}}u([h()],I_.prototype,"altitude",null),u([h({readOnly:!0})],I_.prototype,"collision",void 0),u([h()],I_.prototype,"distance",void 0),u([h({readOnly:!0})],I_.prototype,"minimumPoiDistance",void 0),u([h()],I_.prototype,"tilt",void 0),u([h({constructOnly:!0})],I_.prototype,"mode",void 0),I_=u([I("esri.views.3d.state.Constraints")],I_);const fye=Hdt(Pr),al={min:Zt(.5),max:Zt(179.5)},pW={min:0,max:0};let O$=class extends be{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([h({type:Boolean})],O$.prototype,"enabled",void 0),u([h({type:Number})],O$.prototype,"elevationMargin",void 0),O$=u([I("esri.views.3d.state.Constraints.CollisionConstraint")],O$);let QO=class extends be{constructor(){super(...arguments),this.min=fye.min,this.max=fye.max}};u([h({type:Number})],QO.prototype,"min",void 0),u([h({type:Number})],QO.prototype,"max",void 0),QO=u([I("esri.views.3d.constraints.AltitudeConstraint")],QO);let J_=class extends be{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([h({type:Number,value:1e-8})],J_.prototype,"near",null),u([Gt("near")],J_.prototype,"castNear",null),u([h({type:Number,value:1e-8})],J_.prototype,"far",null),u([Gt("far")],J_.prototype,"castFar",null),u([h({type:["auto","manual"]})],J_.prototype,"mode",void 0),J_=u([I("esri.views.3d.constraints.ClipDistanceConstraint")],J_);const Ote={min:Lc(al.min),max:Lc(al.max)};let n2=class extends be{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return _e(e,Ote.min,Ote.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([h({type:["auto","manual"]})],n2.prototype,"mode",void 0),u([h({type:Number,value:Ote.max})],n2.prototype,"max",null),u([Gt("max")],n2.prototype,"castMax",null),n2=u([I("esri.views.3d.constraints.TiltConstraint")],n2);let o2=class extends be{constructor(){super(...arguments),this.tilt=new n2,this.altitude=new QO,this.clipDistance=new J_}};u([h({type:n2})],o2.prototype,"tilt",void 0),u([h({type:QO})],o2.prototype,"altitude",void 0),u([h({type:J_})],o2.prototype,"clipDistance",void 0),o2=u([I("esri.views.3d.constraints.Constraints")],o2);var Mte;let Ip=Mte=class extends fe{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,r){t[r]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,r){e&&(t[r]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new Mte(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([h({readOnly:!0,type:["sun"],json:{write:!0}})],Ip.prototype,"type",void 0),u([h({type:Date,json:{type:Number,write:{target:"datetime"}}})],Ip.prototype,"date",void 0),u([me("date",["datetime"])],Ip.prototype,"readDate",null),u([Le("date")],Ip.prototype,"writeDate",null),u([h({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Ip.prototype,"directShadowsEnabled",void 0),u([me("directShadowsEnabled",["directShadows"])],Ip.prototype,"readDirectShadowsEnabled",null),u([Le("directShadowsEnabled")],Ip.prototype,"writedirectShadowsEnabled",null),u([h({type:Number,json:{write:!0}})],Ip.prototype,"displayUTCOffset",void 0),u([Le("displayUTCOffset")],Ip.prototype,"writeDisplayUTCOffset",null),Ip=Mte=u([I("esri.webscene.SunLighting")],Ip);const CN=Ip;var oO;let gy=oO=class extends $s.EventedMixin(CN){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),r=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new oO(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const r=oO.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let i=null;v(e)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(e.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime()))));const s=oO.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==s&&(fW.target=this,fW.timezoneOffset=s,this.emit("timezone-will-change",fW)),v(e))return!!isNaN(e.getTime())||i!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new oO({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([h({type:Boolean})],gy.prototype,"cameraTrackingEnabled",void 0),u([h({type:Boolean})],gy.prototype,"ambientOcclusionEnabled",void 0),u([h({type:Boolean})],gy.prototype,"waterReflectionEnabled",void 0),u([h({type:Date})],gy.prototype,"defaultDate",null),u([h({type:Date})],gy.prototype,"date",null),gy=oO=u([I("esri.views.3d.environment.SunLighting")],gy),function(e){function t({hours:r,minutes:i,seconds:s}){return Math.round(r+i/60+s/3600)}e.calculateTimezoneOffset=t}(gy||(gy={}));const fW={target:null,timezoneOffset:0},Ny=gy;var Rte;let M$=Rte=class extends fe{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Rte(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([h({readOnly:!0,type:["virtual"],json:{write:!0}})],M$.prototype,"type",void 0),u([h({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],M$.prototype,"directShadowsEnabled",void 0),M$=Rte=u([I("esri.webscene.VirtualLighting")],M$);const n7=M$;var LB;let aO=LB=class extends $s.EventedMixin(n7){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.cameraTrackingEnabled=!0}clone(){return new LB({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(e){return new LB(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}cloneNonPersistentConstructProperties(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}}};u([h({type:Boolean})],aO.prototype,"ambientOcclusionEnabled",void 0),u([h({type:Boolean})],aO.prototype,"waterReflectionEnabled",void 0),u([h({type:Boolean})],aO.prototype,"cameraTrackingEnabled",void 0),aO=LB=u([I("esri.views.3d.environment.VirtualLighting")],aO);const eM=aO,qdt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Ny,virtual:eM}};var Ite;let JD=Ite=class extends be{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new Ite({quality:this.quality})}};u([h({type:["low","high"],value:"low"})],JD.prototype,"quality",null),JD=Ite=u([I("esri.views.3d.environment.SceneViewAtmosphere")],JD);var Pte;let R$=Pte=class extends fe{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new Pte({cloudCover:this.cloudCover})}};u([Ue({sunny:"sunny"})],R$.prototype,"type",void 0),u([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],R$.prototype,"cloudCover",void 0),R$=Pte=u([I("esri.views.3d.environment.SunnyWeather")],R$);const cV=R$;var $te;let I$=$te=class extends fe{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new $te({cloudCover:this.cloudCover})}};u([Ue({cloudy:"cloudy"})],I$.prototype,"type",void 0),u([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],I$.prototype,"cloudCover",void 0),I$=$te=u([I("esri.views.3d.environment.CloudyWeather")],I$);const I$e=I$;var Dte;let P$=Dte=class extends fe{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new Dte({fogStrength:this.fogStrength})}};u([Ue({foggy:"foggy"})],P$.prototype,"type",void 0),u([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],P$.prototype,"fogStrength",void 0),P$=Dte=u([I("esri.views.3d.environment.FoggyWeather")],P$);const P$e=P$;var Lte;let lO=Lte=class extends fe{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Lte({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([Ue({rainy:"rainy"})],lO.prototype,"type",void 0),u([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],lO.prototype,"cloudCover",void 0),u([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],lO.prototype,"precipitation",void 0),lO=Lte=u([I("esri.views.3d.environment.RainyWeather")],lO);const $$e=lO;var Nte;let DS=Nte=class extends fe{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Nte({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([Ue({snowy:"snowy"})],DS.prototype,"type",void 0),u([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],DS.prototype,"cloudCover",void 0),u([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],DS.prototype,"precipitation",void 0),u([h({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],DS.prototype,"snowCover",void 0),DS=Nte=u([I("esri.views.3d.environment.SnowyWeather")],DS);const D$e=DS,L$e={key:"type",base:cV,typeMap:{sunny:cV,cloudy:I$e,rainy:$$e,snowy:D$e,foggy:P$e}},N$e=Object.keys(L$e.typeMap);function F$e(e,t){return!!N$e.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const Vp=1e4,Wdt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:CN,virtual:n7}};let NB=class extends fe{constructor(e){super(e)}clone(){}};u([h({readOnly:!0,json:{read:!1}})],NB.prototype,"type",void 0),NB=u([I("esri.webscene.background.Background")],NB);const k$e=NB;var Fte;const Xdt={...a1,nonNullable:!0};let $$=Fte=class extends k$e{constructor(e){super(e),this.type="color",this.color=new Ze([0,0,0,1])}clone(){return new Fte(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([Ue({color:"color"},{readOnly:!0})],$$.prototype,"type",void 0),u([h(Xdt)],$$.prototype,"color",void 0),$$=Fte=u([I("esri.webscene.background.ColorBackground")],$$);const U$e=$$,mye={base:k$e,key:"type",typeMap:{color:U$e}};function Ydt(e){return(t,r,i)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,i),n}}}const Zdt={types:mye,json:{read:Ydt(mye),write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.isPresentation})}}};var kte;const B$e="esri.webscene.Environment",Jdt=te.getLogger(B$e),gye=(e,t,r)=>({enabled:!r||!r.isPresentation});let Vb=kte=class extends fe{constructor(e){super(e),this.lighting=new CN,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){F$e(e==null?void 0:e.type,Jdt)&&this._set("weather",e)}clone(){return new kte(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?n7.prototype.clone.call(this.lighting):CN.prototype.clone.call(this.lighting),background:ne(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([h({types:Wdt,nonNullable:!0,json:{write:!0}})],Vb.prototype,"lighting",void 0),u([h(Zdt)],Vb.prototype,"background",void 0),u([h({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:gye}}})],Vb.prototype,"atmosphereEnabled",void 0),u([h({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:gye}}})],Vb.prototype,"starsEnabled",void 0),u([h({types:L$e,nonNullable:!0,json:{write:!0},value:new cV})],Vb.prototype,"weather",null),Vb=kte=u([I(B$e)],Vb);const z$e=Vb;var D$;let cO=D$=class extends z$e{constructor(e){super(e),this.atmosphere=new JD,this.lighting=new Ny,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new D$({...t,lighting:t.lighting.type==="virtual"?eM.fromWebsceneLighting(t.lighting):Ny.fromWebsceneLighting(t.lighting)})}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){var t,r;return e?e instanceof Ny||e instanceof eM?e:e instanceof CN?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(e):new Ny({...e.cloneConstructProperties(),...(t=this.lighting)==null?void 0:t.cloneNonPersistentConstructProperties()}):e instanceof n7?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new eM({...e.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):ug(qdt,e):new Ny}clone(){return new D$({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ne(this.background)})}cloneWithWebsceneEnvironment(e){return new D$({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ne(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){switch(e.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):Ny.fromWebsceneLighting(e.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):eM.fromWebsceneLighting(e.lighting);default:return e.lighting,Ny.fromWebsceneLighting(e.lighting)}}};u([h({type:JD,json:{read:!1},nonNullable:!0})],cO.prototype,"atmosphere",void 0),u([h({nonNullable:!0})],cO.prototype,"lighting",void 0),u([Gt("lighting")],cO.prototype,"castLighting",null),cO=D$=u([I("esri.views.3d.environment.SceneViewEnvironment")],cO);const uO=cO;var $a;(function(e){e[e.Simple=0]="Simple",e[e.Realistic=1]="Realistic",e[e.Panoramic=2]="Panoramic",e[e.None=3]="None"})($a||($a={}));function Ho(e,t){return e[0]=t[0],e[1]=t[1],e}function mr(e,t,r){return e[0]=t,e[1]=r,e}function Pm(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Gy(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function V$e(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function j$e(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Kdt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Qdt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function eht(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function tht(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function rht(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function wd(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function iht(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function TE(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function uV(e,t){const r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function ole(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function G$e(e){const t=e[0],r=e[1];return t*t+r*r}function ale(e,t){return e[0]=-t[0],e[1]=-t[1],e}function sht(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function AN(e,t){const r=t[0],i=t[1];let s=r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function go(e,t){return e[0]*t[0]+e[1]*t[1]}function nht(e,t,r){const i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function dO(e,t,r,i){const s=t[0],n=t[1];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e}function oht(e,t){t=t||1;const r=2*LF()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Ute(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s,e[1]=r[1]*i+r[3]*s,e}function LS(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s+r[4],e[1]=r[1]*i+r[3]*s+r[5],e}function aht(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[3]*s+r[6],e[1]=r[1]*i+r[4]*s+r[7],e}function lht(e,t,r){const i=t[0],s=t[1];return e[0]=r[0]*i+r[4]*s+r[12],e[1]=r[1]*i+r[5]*s+r[13],e}function cht(e,t,r,i){const s=t[0]-r[0],n=t[1]-r[1],o=Math.sin(i),a=Math.cos(i);return e[0]=s*a-n*o+r[0],e[1]=s*o+n*a+r[1],e}function uht(e,t){const r=e[0],i=e[1],s=t[0],n=t[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*s+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function dht(e){return"vec2("+e[0]+", "+e[1]+")"}function H$e(e,t){return e[0]===t[0]&&e[1]===t[1]}function q$e(e,t){const r=e[0],i=e[1],s=t[0],n=t[1],o=Xl();return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))}function hht(e,t,r,i,s){let n=t[0]-r[0],o=t[1]-r[1];const a=(i[0]*n+i[1]*o)*(s-1);return n=i[0]*a,o=i[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const pht=ole,fht=Gy,mht=V$e,ght=j$e,W$e=TE,yht=uV,_ht=G$e;Object.freeze(Object.defineProperty({__proto__:null,copy:Ho,set:mr,add:Pm,subtract:Gy,multiply:V$e,divide:j$e,ceil:Kdt,floor:Qdt,min:eht,max:tht,round:rht,scale:wd,scaleAndAdd:iht,distance:TE,squaredDistance:uV,length:ole,squaredLength:G$e,negate:ale,inverse:sht,normalize:AN,dot:go,cross:nht,lerp:dO,random:oht,transformMat2:Ute,transformMat2d:LS,transformMat3:aht,transformMat4:lht,rotate:cht,angle:uht,str:dht,exactEquals:H$e,equals:q$e,projectAndScale:hht,len:pht,sub:fht,mul:mht,div:ght,dist:W$e,sqrDist:yht,sqrLen:_ht},Symbol.toStringTag,{value:"Module"}));function X$e(e){return Math.min(1,Math.max(0,(e-1e5)/(1e6-1e5)))}const Bte=1e4,vht=.085,ON=1e5;class Zi{}function S(e,...t){let r="";for(let i=0;i<t.length;i++)r+=e[i]+t[i];return r+=e[e.length-1],r}(function(e){function t(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}e.int=t,e.float=r})(S||(S={}));var Mn;function h0(e,t){switch(t.textureCoordinateType){case Mn.Default:return e.attributes.add(M.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Mn.Compressed:return e.attributes.add(M.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(S`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Mn.Atlas:return e.attributes.add(M.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(M.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:t.textureCoordinateType;case Mn.None:return void e.vertex.code.add(S`void forwardTextureCoordinates() {}`);case Mn.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.Compressed=3]="Compressed",e[e.COUNT=4]="COUNT"})(Mn||(Mn={}));function Vd(e){e.code.add(S`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function tp(e){e.include(Vd),e.code.add(S`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function o7(e){e.fragment.code.add(S`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Ri;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(Ri||(Ri={}));class tn{constructor(t,r,i,s,n=null){this.name=t,this.type=r,this.arraySize=n,this.bind={[Ri.Pass]:null,[Ri.Draw]:null},v(i)&&v(s)&&(this.bind[i]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class er extends tn{constructor(t,r){super(t,"vec3",Ri.Pass,(i,s,n)=>i.setUniform3fv(t,r(s,n)))}}class De extends tn{constructor(t,r){super(t,"float",Ri.Pass,(i,s,n)=>i.setUniform1f(t,r(s,n)))}}function d1(e){e.uniforms.add(new er("mainLightDirection",(t,r)=>r.lighting.mainLight.direction))}function F0(e){e.uniforms.add(new er("mainLightIntensity",(t,r)=>r.lighting.mainLight.intensity))}function bht(e,t){t.useLegacyTerrainShading?e.uniforms.add(new De("lightingFixedFactor",(r,i)=>i.lighting.noonFactor*(1-i.lighting.globalFactor))):e.constants.add("lightingFixedFactor","float",0)}function lle(e,t){const r=e.fragment;d1(r),F0(r),bht(r,t),r.code.add(S`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}class ai extends tn{constructor(t,r){super(t,"vec2",Ri.Pass,(i,s,n)=>i.setUniform2fv(t,r(s,n)))}}class Tr extends tn{constructor(t,r){super(t,"vec4",Ri.Pass,(i,s,n)=>i.setUniform4fv(t,r(s,n)))}}class xs extends tn{constructor(t,r){super(t,"mat4",Ri.Pass,(i,s,n)=>i.setUniformMatrix4fv(t,r(s,n)))}}const Y$e=te.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class Z$e{constructor(){this._includedModules=new Map}include(t,r){if(this._includedModules.has(t)){const i=this._includedModules.get(t);if(i!==r){Y$e.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(i))i[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))i[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${i[n]} new ${t[n]}`))}}else this._includedModules.set(t,r),t(this.builder,r)}}class Qr extends Z$e{constructor(){super(...arguments),this.vertex=new yye,this.fragment=new yye,this.attributes=new Tht,this.varyings=new Sht,this.extensions=new GR,this.constants=new kn}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const r=this.extensions.generateSource(t),i=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?Cht:Eht,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];v(a)&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];v(a)&&i.set(o.name,a)});const s=Array.from(i.values()),n=s.length;return(o,a,l)=>{for(let c=0;c<n;++c)s[c](r,o,a,l)}}}class wht{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const r of t)this._add(r)}get(t){return this._entries.get(t)}_add(t){if(C(t))Y$e.error(`Trying to add null Uniform from ${new Error().stack}.`);else{if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new z(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}}generateSource(){return Array.from(this._entries.values()).map(t=>v(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class xht{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class yye extends Z$e{constructor(){super(...arguments),this.uniforms=new wht,this.code=new xht,this.constants=new kn}get builder(){return this}}class Tht{constructor(){this._entries=new Array}add(t,r){this._entries.push([t,r])}generateSource(t){return t==="fragment"?[]:this._entries.map(r=>`attribute ${r[1]} ${r[0]};`)}}class Sht{constructor(){this._entries=new Array}add(t,r){this._entries.push([t,r])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class GR{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const r=t==="vertex"?GR.ALLOWLIST_VERTEX:GR.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}}GR.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],GR.ALLOWLIST_VERTEX=[];class kn{constructor(){this._entries=new Set}add(t,r,i){let s="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":s=kn._numberToFloatStr(i);break;case"int":s=kn._numberToIntStr(i);break;case"bool":s=i.toString();break;case"vec2":s=`vec2(${kn._numberToFloatStr(i[0])},                            ${kn._numberToFloatStr(i[1])})`;break;case"vec3":s=`vec3(${kn._numberToFloatStr(i[0])},                            ${kn._numberToFloatStr(i[1])},                            ${kn._numberToFloatStr(i[2])})`;break;case"vec4":s=`vec4(${kn._numberToFloatStr(i[0])},                            ${kn._numberToFloatStr(i[1])},                            ${kn._numberToFloatStr(i[2])},                            ${kn._numberToFloatStr(i[3])})`;break;case"ivec2":s=`ivec2(${kn._numberToIntStr(i[0])},                             ${kn._numberToIntStr(i[1])})`;break;case"ivec3":s=`ivec3(${kn._numberToIntStr(i[0])},                             ${kn._numberToIntStr(i[1])},                             ${kn._numberToIntStr(i[2])})`;break;case"ivec4":s=`ivec4(${kn._numberToIntStr(i[0])},                             ${kn._numberToIntStr(i[1])},                             ${kn._numberToIntStr(i[2])},                             ${kn._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${r}(${Array.prototype.map.call(i,n=>kn._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${r} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const Eht=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Cht=`precision highp float;
precision highp sampler2D;`,cle="Size",a7="InvSize";function ff(e,t,r=!1,i=0){if(e.hasWebGL2Context){const s=S`vec2(textureSize(${t}, ${S.int(i)}))`;return r?"(1.0 / "+s+")":s}return r?t+a7:t+cle}function vu(e,t,r,i=null,s=0){if(e.hasWebGL2Context)return S`texelFetch(${t}, ivec2(${r}), ${S.int(s)})`;let n=S`texture2D(${t}, ${r} * `;return n+=i?S`(${i}))`:S`${t+a7})`,n}var vi;(function(e){e[e.None=0]="None",e[e.Size=1]="Size",e[e.InvSize=2]="InvSize"})(vi||(vi={}));class Rt extends tn{constructor(t,r){super(t,"sampler2D",Ri.Pass,(i,s,n)=>i.bindTexture(t,r(s,n)))}}function sg(e,t,r=vi.None){const i=[new Rt(e,t)];if(r&vi.Size){const s=e+cle;i.push(new ai(s,(n,o)=>{const a=t(n,o);return v(a)?mr(_ye,a.descriptor.width,a.descriptor.height):Ud}))}if(r&vi.InvSize){const s=e+a7;i.push(new ai(s,(n,o)=>{const a=t(n,o);return v(a)?mr(_ye,1/a.descriptor.width,1/a.descriptor.height):Ud}))}return i}const _ye=rt(),KD=Fe(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),mW=3,gW=Fe(mW*parseFloat(Number(65e-8).toFixed(6)),mW*parseFloat(Number(1881e-9).toFixed(6)),mW*parseFloat(Number(85e-9).toFixed(6))),Aht=3996e-9,Oht=Fe(parseFloat(Number(KD[0]+gW[0]).toFixed(6)),parseFloat(Number(KD[1]+gW[1]).toFixed(6)),parseFloat(Number(KD[2]+gW[2]).toFixed(6)));function Mht(e){const t=new Qr;t.attributes.add(M.POSITION,"vec2"),t.include(h0,{textureCoordinateType:Mn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=t;return r.uniforms.add([new xs("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new xs("inverseViewMatrix",(s,n)=>Pn(Rht,n.camera.viewMatrix))]),r.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add([new ai("radii",s=>s.radii),new er("cameraPosition",(s,n)=>n.camera.eye),new Tr("heightParameters",s=>s.heightParameters),new De("innerFadeDistance",s=>s.innerFadeDistance),new De("altitudeFade",s=>s.altitudeFade),new Rt("depthTex",s=>s.depthTex),new De("hazeStrength",s=>s.hazeStrength)]),i.constants.add("betaRayleigh","vec3",KD),i.constants.add("betaCombined","vec3",Oht),i.constants.add("betaMie","float",Aht),i.constants.add("scaleHeight","float",vht*ON),d1(i),t.include(o7),e.haze&&(i.include(tp),i.uniforms.add(new ai("nearFar",(s,n)=>n.camera.nearFar))),i.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(S`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(S`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(S`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?S`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?S``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":S`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${e.haze?S`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:S`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?S`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:S`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?S`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:S`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":S`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `),t}const Rht=$e(),Iht=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:KD,build:Mht},Symbol.toStringTag,{value:"Module"}));class ei{constructor(t,r){this._module=t,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var ds,Ut,Ae,E0,Dt,Wm,HR,mt,rs,fn,at,It,xt,qe,Tt,Nt,Ac,ni,Oh,sa,Qs,si;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(ds||(ds={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ut||(Ut={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Ae||(Ae={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(E0||(E0={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Dt||(Dt={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Wm||(Wm={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(HR||(HR={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(mt||(mt={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(rs||(rs={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(fn||(fn={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(at||(at={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(It||(It={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(xt||(xt={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(qe||(qe={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(Tt||(Tt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Nt||(Nt={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Ac||(Ac={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(ni||(ni={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Oh||(Oh={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(sa||(sa={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(Qs||(Qs={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(si||(si={}));const yW=33984;var Vo,mh;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(Vo||(Vo={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(mh||(mh={}));const vye=33306;var an,bye,wye,xye,dV,zte,Tye;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(an||(an={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(bye||(bye={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(wye||(wye={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(xye||(xye={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(dV||(dV={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(zte||(zte={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Tye||(Tye={}));class li{constructor(t,r,i){this.release=i,this.initializeConfiguration(t,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=tt(this._program),this._pipeline=this._configuration=null}reload(t){tt(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(t,r=null,i){t.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return Ut.TRIANGLES}getPipelineState(t,r){return this._pipeline}initializeConfiguration(t,r){}}const Yr=new Map([[M.POSITION,0],[M.NORMAL,1],[M.UV0,2],[M.COLOR,3],[M.SIZE,4],[M.TANGENT,4],[M.AUXPOS1,5],[M.SYMBOLCOLOR,5],[M.AUXPOS2,6],[M.FEATUREATTRIBUTE,6],[M.INSTANCEFEATUREATTRIBUTE,6],[M.INSTANCECOLOR,7],[M.OBJECTANDLAYERIDCOLOR,7],[M.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[M.MODEL,8],[M.MODELNORMAL,12],[M.MODELORIGINHI,11],[M.MODELORIGINLO,15]]),Pht=te.getLogger("esri.views.webgl.checkWebGLError");function $ht(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const J$e=!!pe("enable-feature:webgl-debug");function vh(){return J$e}function Vte(){return J$e}function vw(e){if(vh()){const t=e.getError();if(t){const r=$ht(e,t),i=new Error().stack;Pht.error(new z("webgl-error","WebGL error occured",{message:r,stack:i}))}}}class ti{constructor(t,r,i){this._context=t,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Qt({deallocator:null}),this._glProgram=t.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(Ri.Pass,this),this.bindDraw=r.generateBind(Ri.Draw,this),this._fragmentUniforms=vh()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,r){this._glProgram.setUniform1i(t,r?1:0)}setUniform1i(t,r){this._glProgram.setUniform1i(t,r)}setUniform1f(t,r){this._glProgram.setUniform1f(t,r)}setUniform2fv(t,r){this._glProgram.setUniform2fv(t,r)}setUniform3fv(t,r){this._glProgram.setUniform3fv(t,r)}setUniform4fv(t,r){this._glProgram.setUniform4fv(t,r)}setUniformMatrix3fv(t,r){this._glProgram.setUniformMatrix3fv(t,r)}setUniformMatrix4fv(t,r){this._glProgram.setUniformMatrix4fv(t,r)}setUniform1fv(t,r){this._glProgram.setUniform1fv(t,r)}setUniform1iv(t,r){this._glProgram.setUniform1iv(t,r)}setUniform2iv(t,r){this._glProgram.setUniform3iv(t,r)}setUniform3iv(t,r){this._glProgram.setUniform3iv(t,r)}setUniform4iv(t,r){this._glProgram.setUniform4iv(t,r)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,r){if(C(r)||r.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let i=this._textures.get(t);return i==null?(i=this._allocTextureUnit(r),this._textures.set(t,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(t,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,r)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(r,t.unit)}),v(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var Xi,SE,cn,Ov,Cu,qR,Kv,Bl,cx,WR,Mi,EE;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(Xi||(Xi={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(SE||(SE={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(cn||(cn={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(Ov||(Ov={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Cu||(Cu={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(qR||(qR={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(Kv||(Kv={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(Bl||(Bl={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(cx||(cx={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(WR||(WR={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(Mi||(Mi={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(EE||(EE={}));function Pf(e,t,r=E0.ADD,i=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function ma(e,t,r,i,s=E0.ADD,n=E0.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:i,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const ule={face:Wm.BACK,mode:HR.CCW},K$e={face:Wm.FRONT,mode:HR.CCW},l7=e=>e===Xi.Back?ule:e===Xi.Front?K$e:null,$u={zNear:0,zFar:1},cr={r:!0,g:!0,b:!0,a:!0};function Dht(e){return Vht.intern(e)}function Lht(e){return jht.intern(e)}function Nht(e){return Ght.intern(e)}function Fht(e){return Hht.intern(e)}function kht(e){return qht.intern(e)}function Uht(e){return Wht.intern(e)}function Bht(e){return Xht.intern(e)}function zht(e){return Yht.intern(e)}function Ht(e){return Zht.intern(e)}class h1{constructor(t,r){this._makeKey=t,this._makeRef=r,this._interns=new Map}intern(t){var s;if(!t)return null;const r=this._makeKey(t),i=this._interns;return i.has(r)||i.set(r,this._makeRef(t)),(s=i.get(r))!=null?s:null}}function p1(e){return"["+e.join(",")+"]"}const Vht=new h1(Q$e,e=>({__tag:"Blending",...e}));function Q$e(e){return e?p1([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const jht=new h1(eDe,e=>({__tag:"Culling",...e}));function eDe(e){return e?p1([e.face,e.mode]):null}const Ght=new h1(tDe,e=>({__tag:"PolygonOffset",...e}));function tDe(e){return e?p1([e.factor,e.units]):null}const Hht=new h1(rDe,e=>({__tag:"DepthTest",...e}));function rDe(e){return e?p1([e.func]):null}const qht=new h1(iDe,e=>({__tag:"StencilTest",...e}));function iDe(e){return e?p1([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const Wht=new h1(sDe,e=>({__tag:"DepthWrite",...e}));function sDe(e){return e?p1([e.zNear,e.zFar]):null}const Xht=new h1(nDe,e=>({__tag:"ColorWrite",...e}));function nDe(e){return e?p1([e.r,e.g,e.b,e.a]):null}const Yht=new h1(oDe,e=>({__tag:"StencilWrite",...e}));function oDe(e){return e?p1([e.mask]):null}const Zht=new h1(Jht,e=>({blending:Dht(e.blending),culling:Lht(e.culling),polygonOffset:Nht(e.polygonOffset),depthTest:Fht(e.depthTest),stencilTest:kht(e.stencilTest),depthWrite:Uht(e.depthWrite),colorWrite:Bht(e.colorWrite),stencilWrite:zht(e.stencilWrite)}));function Jht(e){return e?p1([Q$e(e.blending),eDe(e.culling),tDe(e.polygonOffset),rDe(e.depthTest),iDe(e.stencilTest),sDe(e.depthWrite),nDe(e.colorWrite),oDe(e.stencilWrite)]):null}class Kht{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,r,i,s){return(i||t!==r)&&(s(t),this._pipelineInvalid=!0),t}}class Qht extends Zi{constructor(){super(...arguments),this.heightParameters=Lr(),this.radii=rt(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1}}class MN extends li{initializeProgram(t){return new ti(t.rctx,MN.shader.get().build(this.configuration),Yr)}initializePipeline(){return this.configuration.haze?Ht({blending:ma(Ae.ONE,Ae.ZERO,Ae.ONE_MINUS_SRC_COLOR,Ae.ONE),colorWrite:cr}):Ht({blending:ma(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),depthTest:{func:rs.LEQUAL},colorWrite:cr})}}MN.shader=new ei(Iht,()=>re(()=>import("./ChapmanAtmosphere.glsl.64a768d3.js"),[]));class Yl{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,r={key:this.key};for(const i of t)r[i]=this[i];return r}}function j(e={}){return(t,r)=>{var i,s;if(t._parameterNames=(i=t._parameterNames)!=null?i:[],t._parameterNames.push(r),e.constValue!=null)Object.defineProperty(t,r,{get:()=>e.constValue});else{const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(Math.log2(o)),l=(s=t._parameterBits)!=null?s:[0];let c=0;for(;l[c]+a>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const d=l[c],p=(1<<a)-1<<d;l[c]+=a,Object.defineProperty(t,r,{get(){return this[n]},set(f){if(this[n]!==f&&(this[n]=f,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~p|+f<<d&p,typeof f!="number"&&typeof f!="boolean"))throw"Configuration value for "+r+" must be boolean or number, got "+typeof f}})}}}class aDe extends Yl{constructor(){super(...arguments),this.haze=!1}}u([j()],aDe.prototype,"haze",void 0);class Ha{constructor(t,r,i,s,n,o=!1,a=0){this.name=t,this.count=r,this.type=i,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new Ha(M.POSITION,3,mt.FLOAT,0,12);new Ha(M.POSITION,3,mt.FLOAT,0,20),new Ha(M.UV0,2,mt.FLOAT,12,20);new Ha(M.POSITION,3,mt.FLOAT,0,32),new Ha(M.NORMAL,3,mt.FLOAT,12,32),new Ha(M.UV0,2,mt.FLOAT,24,32);new Ha(M.POSITION,3,mt.FLOAT,0,16),new Ha(M.COLOR,4,mt.UNSIGNED_BYTE,12,16);const dle=[new Ha(M.POSITION,2,mt.FLOAT,0,8)],kI=[new Ha(M.POSITION,2,mt.FLOAT,0,16),new Ha(M.UV0,2,mt.FLOAT,8,16)];function Sye(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function da(e,t){return e.vertexBuffers[t].size/ept(e.layout[t])}function ept(e){return e[0].stride}function hle(e,t,r,i,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(r);for(const a of i){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let d=0;d<3;d++)n.vertexAttribPointer(l+d,3,a.type,a.normalized,a.stride,a.offset+12*d+c),n.enableVertexAttribArray(l+d),a.divisor>0&&o&&o.vertexAttribDivisor(l+d,a.divisor);else if(a.count===16)for(let d=0;d<4;d++)n.vertexAttribPointer(l+d,4,a.type,a.normalized,a.stride,a.offset+16*d+c),n.enableVertexAttribArray(l+d),a.divisor>0&&o&&o.vertexAttribDivisor(l+d,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function ple(e,t,r,i){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(r);for(const o of i){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(Dt.ARRAY_BUFFER)}function lDe(e){switch(e){case qe.ALPHA:case qe.LUMINANCE:case qe.RED:case qe.RED_INTEGER:case Tt.R8:case Tt.R8I:case Tt.R8UI:case Tt.R8_SNORM:case Ac.STENCIL_INDEX8:return 1;case qe.LUMINANCE_ALPHA:case qe.RG:case qe.RG_INTEGER:case Tt.RGBA4:case Tt.R16F:case Tt.R16I:case Tt.R16UI:case Tt.RG8:case Tt.RG8I:case Tt.RG8UI:case Tt.RG8_SNORM:case Tt.RGB565:case Tt.RGB5_A1:case Ac.DEPTH_COMPONENT16:return 2;case qe.DEPTH_COMPONENT:case qe.RGB:case qe.RGB_INTEGER:case Tt.RGB8:case Tt.RGB8I:case Tt.RGB8UI:case Tt.RGB8_SNORM:case Tt.SRGB8:case Ac.DEPTH_COMPONENT24:return 3;case qe.DEPTH_STENCIL:case qe.RGBA:case qe.RGBA_INTEGER:case Tt.RGBA8:case Tt.R32F:case Tt.R11F_G11F_B10F:case Tt.RG16F:case Tt.R32I:case Tt.R32UI:case Tt.RG16I:case Tt.RG16UI:case Tt.RGBA8I:case Tt.RGBA8UI:case Tt.RGBA8_SNORM:case Tt.SRGB8_ALPHA8:case Tt.RGB9_E5:case Tt.RGB10_A2UI:case Tt.RGB10_A2:case Ac.DEPTH_STENCIL:case Ac.DEPTH_COMPONENT32F:case Ac.DEPTH24_STENCIL8:return 4;case Ac.DEPTH32F_STENCIL8:return 5;case Tt.RGB16F:case Tt.RGB16I:case Tt.RGB16UI:return 6;case Tt.RG32F:case Tt.RG32I:case Tt.RG32UI:case Tt.RGBA16F:case Tt.RGBA16I:case Tt.RGBA16UI:return 8;case Tt.RGB32F:case Tt.RGB32I:case Tt.RGB32UI:return 12;case Tt.RGBA32F:case Tt.RGBA32I:case Tt.RGBA32UI:return 16;case an.COMPRESSED_RGB_S3TC_DXT1_EXT:case an.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case an.COMPRESSED_RGBA_S3TC_DXT3_EXT:case an.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case an.COMPRESSED_R11_EAC:case an.COMPRESSED_SIGNED_R11_EAC:case an.COMPRESSED_RGB8_ETC2:case an.COMPRESSED_SRGB8_ETC2:case an.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case an.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case an.COMPRESSED_RG11_EAC:case an.COMPRESSED_SIGNED_RG11_EAC:case an.COMPRESSED_RGBA8_ETC2_EAC:case an.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function CE(e){if(C(e))return 0;if("descriptor"in e)return e.glName?CE(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const r="hasMipmap"in e&&e.hasMipmap?1.3:1,i=e.width*e.height;return lDe(t)*i*r}const hT=te.getLogger("esri.views.webgl.VertexArrayObject");class Ef{constructor(t,r,i,s,n=null){this._context=t,this._locations=r,this._layout=i,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,t.instanceCounter.increment(Vo.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,r)=>t+this._buffers[r].size,v(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){var r,i,s;if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&hT.warn("Leaked WebGL VAO"));if(this._glName){const n=(i=(r=this._context)==null?void 0:r.capabilities)==null?void 0:i.vao;n?(n.deleteVertexArray(this._glName),this._glName=null):hT.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const n in this._buffers)(s=this._buffers[n])==null||s.dispose(),delete this._buffers[n];this._indexBuffer=tt(this._indexBuffer)}this._context.instanceCounter.decrement(Vo.VertexArrayObject,this),this._context=eE(this._context)}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const r=t.createVertexArray();t.bindVertexArray(r),this._bindLayout(),t.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:r,_indexBuffer:i}=this;t||hT.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in t){const o=t[n];o||hT.error("Vertex buffer is uninitialized!");const a=r[n];a||hT.error("Vertex element descriptor is empty!"),hle(this._context,this._locations,o,a)}v(i)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:r}=this;t||hT.error("Vertex buffer dictionary is empty!");for(const i in t){const s=t[i];s||hT.error("Vertex buffer is uninitialized!");const n=r[i];ple(this._context,this._locations,s,n)}v(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}class Cf extends Ef{}var jt;function tpt(e,t,r={}){const i=cDe(e);for(;i.length>1;){const s=hV(t,i.shift(),r);if(v(s))return s}return rpt(t,i.shift(),r)}function cDe(e){const t=pe("esri-force-webgl");if(t===jt.WEBGL1||t===jt.WEBGL2)return[t];switch(e){case"2d":return pe("mac")&&pe("chrome")?[jt.WEBGL1,jt.WEBGL2]:[jt.WEBGL2,jt.WEBGL1];case"3d":return[jt.WEBGL2,jt.WEBGL1]}}function rpt(e,t,r={}){if(!window.WebGLRenderingContext)return Eye(e,ipt),null;const i=hV(e,t,r);return C(i)&&Eye(e,spt),i}function hV(e,t,r={}){const i=t===jt.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of i){try{s=e.getContext(n,r)}catch{}if(s)break}return s}function Eye(e,t){const r=e.parentNode;r&&(r.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(jt||(jt={}));const ipt='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',spt=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,$g=te.getLogger("esri.views.webgl.BufferObject");function npt(e){return rze(e)}class Ur{constructor(t,r,i,s){this._context=t,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(Vo.BufferObject,this),this._glName=this._context.gl.createBuffer(),vw(this._context.gl),s&&this.setData(s)}static createIndex(t,r,i){return new Ur(t,Dt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(t,r,i){return new Ur(t,Dt.ARRAY_BUFFER,r,i)}static createUniform(t,r,i){if(t.type!==jt.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new Ur(t,Dt.UNIFORM_BUFFER,r,i)}static createPixelPack(t,r=ni.STREAM_READ,i){if(t.type!==jt.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new Ur(t,Dt.PIXEL_PACK_BUFFER,r);return i&&s.setSize(i),s}static createPixelUnpack(t,r=ni.STREAM_DRAW,i){if(t.type!==jt.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new Ur(t,Dt.PIXEL_UNPACK_BUFFER,r,i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===Dt.ELEMENT_ARRAY_BUFFER?this._indexType===mt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Dt.ELEMENT_ARRAY_BUFFER||this.bufferType===Dt.ARRAY_BUFFER}dispose(){var t;(t=this._context)!=null&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Vo.BufferObject,this),this._context=eE(this._context)):this._glName&&$g.warn("Leaked WebGL buffer object")}setSize(t,r=null){if(t<=0&&$g.error("Buffer size needs to be positive!"),this.bufferType===Dt.ELEMENT_ARRAY_BUFFER&&v(r))switch(this._indexType=r,r){case mt.UNSIGNED_SHORT:t*=2;break;case mt.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let r=t.byteLength;this.bufferType===Dt.ELEMENT_ARRAY_BUFFER&&($se(t)&&(r/=2,this._indexType=mt.UNSIGNED_SHORT),Dse(t)&&(r/=4,this._indexType=mt.UNSIGNED_INT)),this._setBufferData(r,t)}_setBufferData(t,r=null){this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;v(r)?s.bufferData(this.bufferType,r,this.usage):s.bufferData(this.bufferType,t,this.usage),vw(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,r,i,s){if(!t)return;(r<0||r>=this._size)&&$g.error("offset is out of range!"),i>=s&&$g.error("end must be bigger than start!"),r+(s-i)>this._size&&$g.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===jt.WEBGL2)o.bufferSubData(this.bufferType,r*t.BYTES_PER_ELEMENT,t,i,s-i);else{const a=i===0&&s===t.length?t:t.subarray(i,s);o.bufferSubData(this.bufferType,r*t.BYTES_PER_ELEMENT,a)}vw(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,r=0,i,s){if(this._context.type!==jt.WEBGL2)return void $g.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||s<0)return void $g.error("Problem getting subdata: offset and length were less than zero!");const n=npt(t)?t.BYTES_PER_ELEMENT:1;if(n*((i!=null?i:0)+(s!=null?s:0))>t.byteLength)return void $g.error("Problem getting subdata: offset and length exceeded destination size!");r+n*(s!=null?s:0)>this.byteSize&&$g.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Dt.COPY_READ_BUFFER),o.getBufferSubData(Dt.COPY_READ_BUFFER,r,t,i,s),this._context.unbindBuffer(Dt.COPY_READ_BUFFER)}async getSubDataAsync(t,r=0,i,s){this._context.type===jt.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,r,i,s)):$g.error("Get buffer subdata is supported in WebGL2 only!")}}function eo(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}const _W={target:xt.TEXTURE_2D,samplingMode:at.LINEAR,wrapMode:It.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},Cye=4;class dt{constructor(t,r,i=null){this._context=t,this.type="texture",this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(Vo.Texture,this),this._descriptor={..._W,...r};for(const s in _W)this._descriptor[s]===void 0&&(this._descriptor[s]=_W[s]);if(t.type!==jt.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),pT(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===xt.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(Vo.Texture,this))}release(){this.dispose()}resize(t,r){const i=this._descriptor;if(i.width!==t||i.height!==r){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");i.width=t,i.height=r,this._descriptor.target===xt.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let r=xt.TEXTURE_CUBE_MAP_POSITIVE_X;r<=xt.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(t,r)}setData(t){this._setData(t)}_setData(t,r){var d,p;if(!this._context||!this._context.gl)return;const i=this._context.gl;this._glName||(this._glName=i.createTexture()),t===void 0&&(t=null);const s=this._descriptor,n=r!=null?r:s.target,o=pT(n);t===null&&(s.width=s.width||Cye,s.height=s.height||Cye,o&&(s.depth=(d=s.depth)!=null?d:1));const a=this._context.bindTexture(this,dt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(dt.TEXTURE_UNIT_FOR_UPDATES),dt._validateTexture(this._context,s),this._configurePixelStorage(),vw(i);const l=s.pixelFormat;let c=(p=s.internalFormat)!=null?p:this._deriveInternalFormat(l,s.dataType);if(vW(t)){let f=t.width,m=t.height;const g=1;t instanceof HTMLVideoElement&&(f=t.videoWidth,m=t.videoHeight),s.width&&s.height,o&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,c,s.hasMipmap,f,m,g),this._texImage(n,0,c,f,m,g,t),vw(i),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=f),s.height===void 0&&(s.height=m),o&&s.depth===void 0&&(s.depth=g)}else{const{width:f,height:m,depth:g}=s;if(f==null||m==null)throw new Error("Width and height must be specified!");if(o&&g==null)throw new Error("Depth must be specified!");if(s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(n,c,s.hasMipmap,f,m,g),i.DEPTH24_STENCIL8&&c===i.DEPTH_STENCIL&&(c=i.DEPTH24_STENCIL8),FB(t)){const _=t.levels,x=Aye(n,f,m,g),b=Math.min(x-1,_.length-1);eo(i)?i.texParameteri(s.target,i.TEXTURE_MAX_LEVEL,b):s.hasMipmap=s.hasMipmap&&x===_.length;const w=c;if(!apt(w))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((T,E,O,A)=>{const R=_[Math.min(T,_.length-1)];this._compressedTexImage(n,T,w,E,O,A,R)},b)}else v(t)?(this._texImage(n,0,c,f,m,g,t),vw(i),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((_,x,b,w)=>{this._texImage(n,_,c,x,b,w,null),vw(i)})}dt._applySamplingMode(i,this._descriptor),dt._applyWrapMode(i,this._descriptor),dt._applyAnisotropicFilteringParameters(this._context,this._descriptor),vw(i),this._context.bindTexture(a,dt.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,r,i,s,n,o,a=0){var x;o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._context.gl,c=this._descriptor,{pixelFormat:d,dataType:p,target:f,isImmutable:m}=c,g=(x=c.internalFormat)!=null?x:this._deriveInternalFormat(d,p);if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const _=this._context.bindTexture(this,dt.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||s>c.width||n>c.height||r+s>c.width||i+n>c.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!eo(l))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(l.UNPACK_SKIP_ROWS,a)}if(vW(o)?eo(l)?l.texSubImage2D(f,t,r,i,s,n,d,p,o):l.texSubImage2D(f,t,r,i,d,p,o):FB(o)?l.compressedTexSubImage2D(f,t,r,i,s,n,g,o.levels[t]):l.texSubImage2D(f,t,r,i,s,n,d,p,o),a){if(!eo(l))return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(l.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(_,dt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,r,i,s,n,o,a,l){var b;l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl;if(!eo(c))throw new Error("3D textures are not supported in WebGL1");const d=this._descriptor,{pixelFormat:p,dataType:f,isImmutable:m,target:g}=d,_=(b=d.internalFormat)!=null?b:this._deriveInternalFormat(p,f);if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");pT(g)||console.warn("Attempting to set 3D texture data on a non-3D texture");const x=this._context.bindTexture(this,dt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(dt.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||s<0||n>d.width||o>d.height||a>d.depth||r+n>d.width||i+o>d.height||s+a>d.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),FB(l))l=l.levels[t],c.compressedTexSubImage3D(g,t,r,i,s,n,o,a,_,l);else{const w=l;c.texSubImage3D(g,t,r,i,s,n,o,a,p,f,w)}this._context.bindTexture(x,dt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,dt._validateTexture(this._context,t)}t.samplingMode===at.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=at.LINEAR_MIPMAP_NEAREST):t.samplingMode===at.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=at.NEAREST_MIPMAP_NEAREST);const r=this._context.bindTexture(this,dt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(dt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(r,dt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,dt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,r=this._descriptor;this._samplingModeDirty&&(dt._applySamplingMode(t,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(dt._applyWrapMode(t,r),this._wrapModeDirty=!1)}_deriveInternalFormat(t,r){if(this._context.type===jt.WEBGL1)return t;switch(r){case Nt.FLOAT:switch(t){case qe.RGBA:return Tt.RGBA32F;case qe.RGB:return Tt.RGB32F;default:throw new Error("Unable to derive format")}case Nt.UNSIGNED_BYTE:switch(t){case qe.RGBA:return Tt.RGBA8;case qe.RGB:return Tt.RGB8}default:return t}}_configurePixelStorage(){const t=this._context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:s}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,r),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,i?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(t,r,i,s,n,o){const a=this._context.gl;if(!eo(a))throw new Error("Immutable textures are not supported in WebGL1");if(!opt(r))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?Aye(t,s,n,o):1;if(pT(t)){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");a.texStorage3D(t,l,r,s,n,o)}else a.texStorage2D(t,l,r,s,n);this._wasImmutablyAllocated=!0}_texImage(t,r,i,s,n,o,a){const l=this._context.gl;let c=null;const d=this._context.type===jt.WEBGL2,p=pT(t),{isImmutable:f,pixelFormat:m,dataType:g}=this._descriptor;if(d&&(c=l),d||!vW(a))if(f){if(v(a)){const _=a;if(p){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texSubImage3D(t,r,0,0,0,s,n,o,m,g,_)}else l.texSubImage2D(t,r,0,0,s,n,m,g,_)}}else{const _=a;if(p){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.texImage3D(t,r,i,s,n,o,0,m,g,_)}else l.texImage2D(t,r,i,s,n,0,m,g,_)}else l.texImage2D(t,0,i,m,g,a)}_compressedTexImage(t,r,i,s,n,o,a){const l=this._context.gl;let c=null;const d=pT(t),p=this._descriptor.isImmutable;if(d){if(this._context.type!==jt.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}if(p){if(v(a))if(d){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(t,r,0,0,0,s,n,o,i,a)}else l.compressedTexSubImage2D(t,r,0,0,s,n,i,a)}else if(d){if(o==null)throw new Error("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(t,r,i,s,n,o,0,a)}else l.compressedTexImage2D(t,r,i,s,n,0,a)}_forEachMipmapLevel(t,r=1/0){let{width:i,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===xt.TEXTURE_3D;if(i==null||s==null||l&&n==null)throw new Error("Missing texture dimensions for mipmap calculation");for(let c=0;t(c,i,s,n),o&&(i!==1||s!==1||l&&n!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(t,r){(r.width!=null&&r.width<0||r.height!=null&&r.height<0||r.depth!=null&&r.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=eo(t.gl),s=r.width!=null&&dg(r.width)&&r.height!=null&&dg(r.height);i||!r.isImmutable&&!pT(r.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),i||s||(typeof r.wrapMode=="number"?r.wrapMode!==It.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):r.wrapMode.s===It.CLAMP_TO_EDGE&&r.wrapMode.t===It.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),r.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,r){let i=r.samplingMode,s=r.samplingMode;i===at.LINEAR_MIPMAP_NEAREST||i===at.LINEAR_MIPMAP_LINEAR?(i=at.LINEAR,r.hasMipmap||(s=at.LINEAR)):i!==at.NEAREST_MIPMAP_NEAREST&&i!==at.NEAREST_MIPMAP_LINEAR||(i=at.NEAREST,r.hasMipmap||(s=at.NEAREST)),t.texParameteri(r.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(r.target,t.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(t,r){typeof r.wrapMode=="number"?(t.texParameteri(r.target,t.TEXTURE_WRAP_S,r.wrapMode),t.texParameteri(r.target,t.TEXTURE_WRAP_T,r.wrapMode)):(t.texParameteri(r.target,t.TEXTURE_WRAP_S,r.wrapMode.s),t.texParameteri(r.target,t.TEXTURE_WRAP_T,r.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,r){var s;const i=t.capabilities.textureFilterAnisotropic;!i||t.gl.texParameterf(r.target,i.TEXTURE_MAX_ANISOTROPY,(s=r.maxAnisotropy)!=null?s:1)}}function opt(e){return e in Tt}function apt(e){return e in an}function FB(e){return v(e)&&"type"in e&&e.type==="compressed"}function lpt(e){return v(e)&&"byteLength"in e}function vW(e){return v(e)&&!FB(e)&&!lpt(e)}function pT(e){return e===xt.TEXTURE_3D||e===xt.TEXTURE_2D_ARRAY}function Aye(e,t,r,i=1){let s=Math.max(t,r);return e===xt.TEXTURE_3D&&(s=Math.max(s,i)),Math.round(Math.log(s)/Math.LN2)+1}dt.TEXTURE_UNIT_FOR_UPDATES=0;function Zl(e,t=dle,r=Yr,i=-1,s=1){let n=null;return t===kI?n=new Float32Array([i,i,0,0,s,i,1,0,i,s,0,1,s,s,1,1]):n=new Float32Array([i,i,s,i,i,s,s,s]),new Cf(e,r,{geometry:t},{geometry:Ur.createVertex(e,ni.STATIC_DRAW,n)})}function cpt(e,t=dle,r=Yr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new Cf(e,r,{geometry:t},{geometry:Ur.createVertex(e,ni.STATIC_DRAW,i)})}const uDe=4;function dDe(e,t=uDe){return new dt(e,{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.NEAREST,width:t,height:t})}function upt(e,t,r=uDe){const i=new Uint8Array(r*r*4);for(let s=0;s<i.length;s+=4)i[s+0]=255*t[0],i[s+1]=255*t[1],i[s+2]=255*t[2],i[s+3]=255*t[3];return new dt(e,{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.NEAREST,width:r,height:r},i)}function hDe(e){return new dt(e,{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class Oye{constructor(t){this._view=t,this.type=$a.Realistic,this._passParameters=new Qht,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Pr.radius,this._fadeHaze=0,this._updateRadius(Pr.radius)}destroy(){this._atmosphereTechnique=Di(this._atmosphereTechnique),this._atmosphereHazeTechnique=Di(this._atmosphereHazeTechnique),this._vao=tt(this._vao),this._handles=Qe(this._handles)}initializeRenderContext(t){const r=t.renderContext.rctx,i=this._handles=new hr;this._updateRootTileElevationBounds(),i.add(ie(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds())),i.add(ie(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds()));const s=new aDe;s.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(MN,s),s.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(MN,s),this._vao=Zl(r,kI)}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,r){this._fadeHaze=r,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,r,i){if(C(i))return;this._update(t.bindParameters.camera),this._passParameters.depthTex=i;const s=t.rctx.bindTechnique(r,this._passParameters,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>{this._renderCommon(s,t)})}_renderCommon(t,r){C(this._vao)||(r.rctx.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(Ut.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const t=this._view.basemapTerrain.rootTileElevationBounds.min;t!==this._rootTileElevationMin&&(this._rootTileElevationMin=t,this._lowerBoundEarthRadius=Pr.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation(Pr.radius+this._view.basemapTerrain.visibleElevationBounds.min);t<this._lowerBoundEarthRadius&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,mr(this._passParameters.radii,t,t+ON),this._passParameters.innerFadeDistance=2*Math.sqrt((2*t-Bte)*Bte)}_update(t){if(C(t))return;const r=Ie(t.eye),i=r*r,s=i-this._passParameters.radii[1]*this._passParameters.radii[1],n=Math.min(1,Math.max(0,(r-this._passParameters.radii[0])/ON));Oi(this._passParameters.heightParameters,r,i,s,n),this._passParameters.altitudeFade=X$e(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Ft(Ft(.6,1,hR(9500,10500,r-Pr.radius)),1,this._fadeHaze)}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}function pDe(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(S`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function fle(e,t){switch(e.include(h0,t),e.fragment.code.add(S`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case Mn.Default:case Mn.Compressed:return void e.fragment.code.add(S`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case Mn.Atlas:return e.include(pDe),void e.fragment.code.add(S`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case Mn.None:case Mn.COUNT:return}}class Hh extends tn{constructor(t,r){super(t,"vec3",Ri.Draw,(i,s,n,o)=>i.setUniform3fv(t,r(s,n,o)))}}class RN extends tn{constructor(t,r){super(t,"vec2",Ri.Draw,(i,s,n,o)=>i.setUniform2fv(t,r(s,n,o)))}}class n4 extends tn{constructor(t,r){super(t,"sampler2D",Ri.Draw,(i,s,n)=>i.bindTexture(t,r(s,n)))}}function ux(e,t,r=vi.None){const i=[new n4(e,t)];if(r&vi.Size){const s=e+cle;i.push(new RN(s,(n,o)=>{const a=t(n,o);return v(a)?mr(Mye,a.descriptor.width,a.descriptor.height):Ud}))}if(r&vi.InvSize){const s=e+a7;i.push(new RN(s,(n,o)=>{const a=t(n,o);return v(a)?mr(Mye,1/a.descriptor.width,1/a.descriptor.height):Ud}))}return i}const Mye=rt();class tT{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}ensureTechnique(t,r,i=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(i,r),this._technique),this._technique}ensureResources(t){return Ov.LOADED}}class mle extends tT{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,r=>this._texture=r),this._acquire(t.normalTextureId,r=>this._textureNormal=r),this._acquire(t.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(t.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(t.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=Di(this._texture),this._textureNormal=Di(this._textureNormal),this._textureEmissive=Di(this._textureEmissive),this._textureOcclusion=Di(this._textureOcclusion),this._textureMetallicRoughness=Di(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?Ov.LOADED:Ov.LOADING}get textureBindParameters(){return new fDe(v(this._texture)?this._texture.glTexture:null,v(this._textureNormal)?this._textureNormal.glTexture:null,v(this._textureEmissive)?this._textureEmissive.glTexture:null,v(this._textureOcclusion)?this._textureOcclusion.glTexture:null,v(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(C(this._texture)||t!==this._texture.id)&&(this._texture=Di(this._texture),this._textureId=t,this._acquire(this._textureId,r=>this._texture=r))}_acquire(t,r){if(C(t))return void r(null);const i=this._textureRepository.acquire(t);if(np(i))return++this._numLoading,void i.then(s=>{if(this._disposed)return Di(s),void r(null);r(s)}).finally(()=>--this._numLoading);r(i)}}class fDe extends Zi{constructor(t=null,r=null,i=null,s=null,n=null){super(),this.texture=t,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=s,this.textureMetallicRoughness=n}}const a8t=fi(0,.6,.2);var kt;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"})(kt||(kt={}));function gle(e,t){const r=e.fragment,i=t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===kt.Normal&&i&&e.include(fle,t),t.pbrMode!==kt.Schematic)if(t.pbrMode!==kt.Disabled){if(t.pbrMode===kt.Normal){r.code.add(S`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.supportsTextureAtlas?t.hasWebGL2Context?vi.None:vi.Size:vi.None,n=t.pbrTextureBindType;t.hasMetallicRoughnessTexture&&(r.uniforms.add(n===Ri.Pass?sg("texMetallicRoughness",o=>o.textureMetallicRoughness,s):ux("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),r.code.add(S`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(r.uniforms.add(n===Ri.Pass?sg("texEmission",o=>o.textureEmissive,s):ux("texEmission",o=>o.textureEmissive,s)),r.code.add(S`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(r.uniforms.add(n===Ri.Pass?sg("texOcclusion",o=>o.textureOcclusion,s):ux("texOcclusion",o=>o.textureOcclusion,s)),r.code.add(S`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(S`float getBakedOcclusion() { return 1.0; }`),r.uniforms.add(n===Ri.Pass?[new er("emissionFactor",o=>o.emissiveFactor),new er("mrrFactors",o=>o.mrrFactors)]:[new Hh("emissionFactor",o=>o.emissiveFactor),new Hh("mrrFactors",o=>o.mrrFactors)]),r.code.add(S`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${i?S`vtc.uv = vuv0;`:""}
      ${t.hasMetallicRoughnessTextureTransform?S`vtc.uv = metallicRoughnessUV;`:""}
      ${t.hasMetallicRoughnessTexture?t.supportsTextureAtlas?S`
                vtc.size = ${ff(t,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:S`applyMetallnessAndRoughness(vtc);`:""}
      ${t.hasEmissiveTextureTransform?S`vtc.uv = emissiveUV;`:""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?S`
                vtc.size = ${ff(t,"texEmission")};
                applyEmission(vtc);`:S`applyEmission(vtc);`:""}
      ${t.hasOcclusionTextureTransform?S`vtc.uv = occlusionUV;`:""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?S`
                vtc.size = ${ff(t,"texOcclusion")};
                applyOcclusion(vtc);`:S`applyOcclusion(vtc);`:""}
    }
  `)}}else r.code.add(S`float getBakedOcclusion() { return 1.0; }`);else r.code.add(S`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function yle(e,t){const r=e.fragment,i=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new er("lightingAmbientSH0",(s,n)=>ue(Rye,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add([new Tr("lightingAmbientSH_R",(s,n)=>Oi(e_,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new Tr("lightingAmbientSH_G",(s,n)=>Oi(e_,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new Tr("lightingAmbientSH_B",(s,n)=>Oi(e_,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add([new er("lightingAmbientSH0",(s,n)=>ue(Rye,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new Tr("lightingAmbientSH_R1",(s,n)=>Oi(e_,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new Tr("lightingAmbientSH_G1",(s,n)=>Oi(e_,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new Tr("lightingAmbientSH_B1",(s,n)=>Oi(e_,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new Tr("lightingAmbientSH_R2",(s,n)=>Oi(e_,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new Tr("lightingAmbientSH_G2",(s,n)=>Oi(e_,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new Tr("lightingAmbientSH_B2",(s,n)=>Oi(e_,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==kt.Normal&&t.pbrMode!==kt.Schematic||r.code.add(S`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Rye=$(),e_=Lr();function c7(e){e.vertex.code.add(S`const float PI = 3.141592653589793;`),e.fragment.code.add(S`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var dn,AE;function dpt(e){return v(e)&&v(e.cubeMap)}function _le(e){return v(e)&&!e.running}(function(e){e[e.RENDERING=0]="RENDERING",e[e.FINISHED_RENDERING=1]="FINISHED_RENDERING",e[e.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",e[e.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",e[e.FINISHED=4]="FINISHED"})(dn||(dn={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(AE||(AE={}));class hpt{constructor(){this.readChannels=AE.RG,this.renderingStage=dn.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=$(),this.isCameraPositionFinal=!0,this.parallax=new Iye,this.parallaxNew=new Iye,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:$o.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:pd.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:Mx.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===$o.FADE_OUT||this.fadeInOut.stage===$o.FADE_IN||this.fadeIn.stage===pd.FADE_IN||this.fadeInOutHeight.stage!==Mx.FINISHED||this.renderingStage===dn.FADING_TEXTURE_CHANNELS}}var pd,$o,Mx;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(pd||(pd={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}($o||($o={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(Mx||(Mx={}));class Iye{constructor(){this.anchorPointClouds=$(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=$e()}}class Mv extends tn{constructor(t,r){super(t,"bool",Ri.Pass,(i,s,n)=>i.setUniform1b(t,r(s,n)))}}class ppt extends tn{constructor(t,r){super(t,"samplerCube",Ri.Pass,(i,s,n)=>i.bindTexture(t,r(s,n)))}}function mDe(e){const t=e.fragment;t.uniforms.add([new xs("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new xs("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new er("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new er("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new De("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new De("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new De("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===$o.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new De("crossFadeAnchorFactor",(r,i)=>_e(i.cloudsFade.crossFade.factor,0,1)),new ppt("cubeMap",(r,i)=>v(i.cloudsFade.data)&&v(i.cloudsFade.data.cubeMap)?i.cloudsFade.data.cubeMap.colorTexture:null),new Mv("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new Mv("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===AE.RG),new Mv("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===dn.FADING_TEXTURE_CHANNELS)]),t.constants.add("planetRadius","float",Pr.radius),t.code.add(S`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(S`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(S`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),d1(t),F0(t),t.code.add(S`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(S`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),t.code.add(S`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(S`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(S`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function k0(e){e.code.add(S`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function fpt(){const e=new Qr;e.attributes.add(M.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:r}=e;return t.uniforms.add([new xs("inverseProjectionMatrix",(i,s)=>s.camera.inverseProjectionMatrix),new xs("inverseViewMatrix",(i,s)=>Pn(mpt,s.camera.viewMatrix))]),t.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(k0),r.include(Vd),e.include(yle,{pbrMode:kt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(c7),e.include(o7),e.include(lle,{useLegacyTerrainShading:!1}),e.include(mDe,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1}),r.uniforms.add([new er("cameraPosition",(i,s)=>s.camera.eye)]),r.code.add(S`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const mpt=$e(),gpt=Object.freeze(Object.defineProperty({__proto__:null,build:fpt},Symbol.toStringTag,{value:"Module"}));class u7 extends li{constructor(t){super(t,new Yl,()=>this.destroy())}initializeProgram(t){return new ti(t.rctx,u7.shader.get().build(),Yr)}initializePipeline(){return Ht({blending:Pf(Ae.ONE,Ae.SRC_ALPHA),depthTest:{func:rs.LEQUAL},colorWrite:cr})}}u7.shader=new ei(gpt,()=>re(()=>import("./CloudsComposition.glsl.7d610998.js"),[]));let NS=class extends be{constructor(e){super(e),this._technique=new u7(e),this._vao=Zl(e.rctx)}destroy(){this._technique=Di(this._technique),this._vao=tt(this._vao)}render(e){const t=e.bindParameters.cloudsFade;if(C(this._vao)||C(t.data))return;if(!this._technique.compiled)return void this.requestRender();const r=e.rctx.bindTechnique(this._technique,ypt,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Ut.TRIANGLE_STRIP,0,4)}};u([h({constructOnly:!0})],NS.prototype,"rctx",void 0),u([h({constructOnly:!0})],NS.prototype,"viewingMode",void 0),u([h({constructOnly:!0})],NS.prototype,"planetRadius",void 0),u([h({constructOnly:!0})],NS.prototype,"requestRender",void 0),NS=u([I("esri.views.3d.environment.CloudsComposition")],NS);const ypt=new Zi;var bu;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(bu||(bu={}));class kB extends Yl{constructor(){super(...arguments),this.steps=bu.SIXTEEN,this.writeTextureChannels=AE.RG}}u([j({count:bu.COUNT})],kB.prototype,"steps",void 0),u([j({constValue:pe("esri-mobile")?1024:2048})],kB.prototype,"cubeMapSize",void 0),u([j()],kB.prototype,"writeTextureChannels",void 0);class L${constructor(t,r,i,s,n,o,a,l,c=.5){this.coverage=t,this.density=r,this.absorption=i,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}}const Pye=new L$([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],bu.SIXTEEN),Sl={sunny:Pye,cloudy:new L$([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],bu.TWOHUNDRED,.6),rainy:new L$([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],bu.TWOHUNDRED,.4),snowy:new L$([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],bu.HUNDRED,.65),foggy:new L$([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],bu.SIXTEEN),default:Pye},jp=pe("esri-mobile")?64:128,_pt=jp/128,bm=Math.ceil(Math.sqrt(jp)),Nm=(jp+2)*bm,vpt=1e5,bW=128,bpt=Nm/1560;function $f(e,t=!0){e.attributes.add(M.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(S`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?S`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class IN extends tn{constructor(t,r){super(t,"mat3",Ri.Draw,(i,s,n)=>i.setUniformMatrix3fv(t,r(s,n)))}}class gDe extends Zi{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Sl.default.raymarchingSteps,this.weatherTile=rt()}}class yDe extends Zi{constructor(){super(...arguments),this.viewMatrix=Ts()}}function wpt(e){const t=new Qr;t.include($f,!1);const r=t.fragment;return r.uniforms.add([new De("cloudRadius",i=>i.cloudRadius),new De("power",i=>Ft(35,120,i.absorption)),new De("sigmaE",i=>1+i.absorption),new De("density",i=>Ft(0,.3,i.density)),new De("cloudSize",i=>Ft(0,.02,Math.max(.01,1-i.cloudSize))),new De("detailSize",i=>Ft(0,.2,Math.max(.01,1-i.detailSize))),new De("smoothness",i=>Ft(0,.5,1-i.smoothness)),new De("cloudHeight",i=>Ft(0,1500,i.cloudHeight)),new De("coverage",i=>i.coverage),new IN("view",i=>i.viewMatrix),new Rt("cloudShapeTexture",i=>v(i.noiseTexture)?i.noiseTexture.textureAtlas:null),new ai("cloudVariables",i=>mr(xpt,i.coverage,i.absorption))]),r.constants.add("halfCubeMapSize","float",.5*e.cubeMapSize),r.code.add(S`
    const int STEPS = ${e.steps===bu.SIXTEEN?S`16`:e.steps===bu.HUNDRED?S`100`:S`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(S`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${S.float(Nm)};
      const float dataWidth = ${S.float(Nm)};
      const float tileRows = ${S.float(bm)};
      const vec3 atlasDimensions = vec3(${S.float(jp)}, ${S.float(jp)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${S.float(_pt)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${S.float(bpt)} * p) / ${S.float(Nm)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),r.code.add(S`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(S`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(S`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(S`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(S`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),t}const xpt=rt(),Tpt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:gDe,CloudsDrawParameters:yDe,build:wpt},Symbol.toStringTag,{value:"Module"}));class d7 extends li{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){return new ti(t.rctx,d7.shader.get().build(this.configuration),Yr)}initializePipeline(){return Ht({blending:Pf(Ae.CONSTANT_COLOR,Ae.ONE_MINUS_CONSTANT_COLOR,E0.ADD,this.configuration.writeTextureChannels===AE.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:rs.LEQUAL},colorWrite:cr})}}d7.shader=new ei(Tpt,()=>re(()=>import("./Clouds.glsl.b8a3cd57.js"),[]));var $h;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})($h||($h={}));class jte extends Yl{constructor(){super(...arguments),this.mode=$h.Full}}u([j({count:$h.COUNT})],jte.prototype,"mode",void 0);class _De extends Zi{constructor(){super(...arguments),this.weatherTile=pi(0,0)}}function Spt(e){const t=new Qr;return t.include($f,!1),t.fragment.code.add(S`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),e.mode===$h.Full&&t.fragment.code.add(S`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${S.float(bm)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${S.float(8)});

      float worley0 = worley(p, ${S.float(2)} * 2.0);
      float worley1 = worley(p, ${S.float(2)} * 8.0);
      float worley2 = worley(p, ${S.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${S.float(2)});
      float worley1 = worley(p, ${S.float(2)} * 2.0);
      float worley2 = worley(p, ${S.float(2)} * 4.0);
      float worley3 = worley(p, ${S.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.uniforms.add(new ai("weatherTile",r=>r.weatherTile)),t.fragment.code.add(S`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${S.float(bW)});

      // Get global coordinates of p
      p += weatherTile * ${S.float(bW)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${S.float(vpt)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(S`void main() {`),e.mode===$h.Full&&t.fragment.code.add(S`
        float padWidth = 1.0;
        float paddedSize = ${S.float(jp)} + 2.0 * padWidth;
        float tileCount = ${S.float(bm)} * ${S.float(bm)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${S.float(jp)};
          }

          if (startPadY) {
            pixel.y += ${S.float(jp)};
          }

          if (endPadX) {
            pixel.x -= ${S.float(jp)};
          }

          if (endPadY) {
            pixel.y -= ${S.float(jp)};
          }

          uv = vec2(pixel.xy / ${S.float(jp)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${S.float(jp)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${S.float(bm)} * ${S.float(bm)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${S.float(bm)} * ${S.float(bm)});
        p = p_;
        p.z /= (${S.float(bm)} * ${S.float(bm)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(S`
      vec2 mapUV = ${S.float(bW)} * (gl_FragCoord.xy / ${S.float(Nm)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===$h.Full?S`gl_FragColor.ba = vec2(0.0, map);`:S`gl_FragColor = vec4(map);`};
    }
  `),t}const Ept=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:_De,build:Spt},Symbol.toStringTag,{value:"Module"}));class PN extends li{initializeProgram(t){return new ti(t.rctx,PN.shader.get().build(this.configuration),Yr)}initializePipeline(){return Ht({blending:this.configuration.mode===$h.Full?Pf(Ae.ONE,Ae.ZERO):ma(Ae.ZERO,Ae.ONE,Ae.ONE,Ae.ZERO),depthTest:{func:rs.ALWAYS},colorWrite:cr})}}PN.shader=new ei(Ept,()=>re(()=>import("./NoiseTextureAtlas.glsl.76d4c166.js"),[]));class hO{constructor(t,r){this._context=t,this._desc=r,this.type="renderbuffer",this._context.instanceCounter.increment(Vo.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==jt.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,s,n)}else i.renderbufferStorage(i.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,r=this._context.parameters.maxSamples;return t?Math.min(t,r):r}resize(t,r){const i=this._desc;if(i.width===t&&i.height===r)return;i.width=t,i.height=r;const s=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):s.renderbufferStorage(s.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Vo.Renderbuffer,this),this._context=eE(this._context))}}class ps{constructor(t,r,i=null,s=null){var n;if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._depthStencilTexture=null,this._initialized=!1,this._desc={...r},t.instanceCounter.increment(Vo.FramebufferObject,this),v(i)){Array.isArray(i)||(i=[i]);for(let o=0;o<i.length;++o){const a=i[o],l=mh.COLOR_ATTACHMENT0+o;let c;Dye(a)?(P_(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new dt(this._context,c))),nk(c,this._desc)):($ye(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new hO(this._context,c))),wW(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(v(s)){let o,a;if(Dye(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),P_(s)?(a=s.descriptor,this._depthStencilTexture=s):(a=s,this._depthStencilTexture=new dt(this._context,a)),nk(a,this._desc);else{$ye(s)?(a=s.descriptor,o=s):(a=s,o=new hO(this._context,a));const l=(n=this._desc.depthStencilTarget)!=null?n:si.DEPTH_STENCIL_RENDER_BUFFER;l===si.STENCIL_RENDER_BUFFER?this._stencilAttachment=o:l===si.DEPTH_RENDER_BUFFER||l===si.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=o:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=l,wW(a,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(Vo.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(mh.COLOR_ATTACHMENT0);return t&&P_(t)?t:null}get colorAttachment(){return this._colorAttachments.get(mh.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){var t;return(t=this._desc.width)!=null?t:0}get height(){var t;return(t=this._desc.height)!=null?t:0}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[r,i])=>t+CE(i),0)+CE(this.depthStencilAttachment)}getColorTexture(t){const r=this._colorAttachments.get(t);return r&&P_(r)?r:null}attachColorTexture(t,r=mh.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(r),nk(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,r)),this._colorAttachments.set(r,t))}detachColorTexture(t=mh.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(t);if(P_(r)){const i=r;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),i}}setColorTextureTarget(t,r=mh.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);P_(i)&&this._framebufferTexture2D(i.glName,r,t)}attachDepthStencilTexture(t){if(C(t))return;const r=t.descriptor;r.pixelFormat!==qe.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==Nt.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),nk(r,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==si.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=si.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,vye)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,vye)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(C(t))return;const r=t.descriptor;if(r.internalFormat!==Ac.DEPTH_STENCIL&&r.internalFormat!==Ac.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),wW(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=r.internalFormat===Ac.DEPTH_STENCIL?si.DEPTH_STENCIL_RENDER_BUFFER:si.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,s=this._desc.depthStencilTarget===si.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(sa.FRAMEBUFFER,s,i.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,r=this._depthAttachment;if(r&&this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===si.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(sa.FRAMEBUFFER,i,t.RENDERBUFFER,null)}return this._depthAttachment=null,r}detachAll(){this._colorAttachments.forEach((t,r)=>this._detachColorAttachment(r)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,r,i,s,n,o,a){(t<0||r<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==xt.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||(c==null?void 0:c.width)==null||(c==null?void 0:c.height)==null||t+i>l.width||r+s>l.height||n+i>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const d=this._context,p=d.bindTexture(a,dt.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(dt.TEXTURE_UNIT_FOR_UPDATES),d.bindFramebuffer(this),d.gl.copyTexSubImage2D(xt.TEXTURE_2D,0,n,o,t,r,i,s),d.bindTexture(p,dt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,r,i,s,n,o,a){(i<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,r,i,s,n,o,a)}async readPixelsAsync(t,r,i,s,n,o,a){if(this._context.type!==jt.WEBGL2)return vh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,r,i,s,n,o,a);const l=this._context.gl,c=Ur.createPixelPack(this._context,ni.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,r,i,s,n,o,0),this._context.unbindBuffer(Dt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,r){const i=this._desc;if(i.width!==t||i.height!==r){if(!this._initialized)return i.width=t,i.height=r,this._colorAttachments.forEach(s=>{s&&s.resize(t,r)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,r));i.width=t,i.height=r,this._colorAttachments.forEach(s=>{s&&s.resize(t,r)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,r):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,r),this._stencilAttachment&&this._stencilAttachment.resize(t,r)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=sa.FRAMEBUFFER){var d,p,f,m;const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(t,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=this._context,s=r.createFramebuffer(),n=this._desc,o=(d=n.colorTarget)!=null?d:Qs.RENDER_BUFFER,a=(p=n.width)!=null?p:1,l=(f=n.height)!=null?f:1;if(r.bindFramebuffer(t,s),this._colorAttachments.size===0)if(o===Qs.TEXTURE||o===Qs.CUBEMAP)this._colorAttachments.set(mh.COLOR_ATTACHMENT0,Cpt(i,n,this.descriptor.colorTarget===Qs.CUBEMAP?xt.TEXTURE_CUBE_MAP:xt.TEXTURE_2D));else{const g=new hO(i,{internalFormat:Tt.RGBA4,width:a,height:l});this._colorAttachments.set(mh.COLOR_ATTACHMENT0,g)}this._colorAttachments.forEach((g,_)=>{g&&(P_(g)?this._framebufferTexture2D(g.glName,_,Lye(g),t):r.framebufferRenderbuffer(t,_,r.RENDERBUFFER,g.glName))});const c=(m=n.depthStencilTarget)!=null?m:si.NONE;switch(c){case si.DEPTH_RENDER_BUFFER:case si.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new hO(i,{internalFormat:n.depthStencilTarget===si.DEPTH_RENDER_BUFFER?Ac.DEPTH_COMPONENT16:Ac.DEPTH_STENCIL,width:a,height:l}));const g=c===si.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(t,g,r.RENDERBUFFER,this._depthAttachment.glName);break}case si.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new hO(i,{internalFormat:Ac.STENCIL_INDEX8,width:a,height:l})),r.framebufferRenderbuffer(t,r.STENCIL_ATTACHMENT,r.RENDERBUFFER,this._stencilAttachment.glName);break;case si.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){i.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const g={target:xt.TEXTURE_2D,pixelFormat:qe.DEPTH_STENCIL,dataType:Nt.UNSIGNED_INT_24_8,samplingMode:at.NEAREST,wrapMode:It.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new dt(i,g)}this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,Lye(this._depthStencilTexture),t)}vh()&&r.checkFramebufferStatus(t)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(t,r=mh.COLOR_ATTACHMENT0,i=xt.TEXTURE_2D,s=sa.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,r,i,t,n)}_detachColorAttachment(t){vh()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const r=this._context.gl,i=this._colorAttachments.get(t);return P_(i)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(sa.FRAMEBUFFER,t,r.RENDERBUFFER,null)),this._colorAttachments.delete(t),i}_disposeColorAttachments(){this._colorAttachments.forEach((t,r)=>{this._detachColorAttachment(r),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===si.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(sa.FRAMEBUFFER,r,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(sa.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(ps._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const s=this._context.gl;ps._MAX_COLOR_ATTACHMENTS=s.getParameter(i.MAX_COLOR_ATTACHMENTS)}else ps._MAX_COLOR_ATTACHMENTS=1}const r=t-mh.COLOR_ATTACHMENT0;r+1>ps._MAX_COLOR_ATTACHMENTS&&te.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${ps._MAX_COLOR_ATTACHMENTS} color attachments`)}}function P_(e){return e!=null&&"type"in e&&e.type==="texture"}function $ye(e){return e!=null&&"type"in e&&e.type==="renderbuffer"}function Dye(e){return P_(e)||e!=null&&"pixelFormat"in e}function Cpt(e,t,r){return new dt(e,{target:r,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.NEAREST,wrapMode:It.CLAMP_TO_EDGE,width:t.width,height:t.height})}function nk(e,t){e.target!==xt.TEXTURE_2D&&e.target!==xt.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function wW(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function Lye(e){return e.descriptor.target===xt.TEXTURE_CUBE_MAP?xt.TEXTURE_CUBE_MAP_POSITIVE_X:xt.TEXTURE_2D}ps._MAX_COLOR_ATTACHMENTS=-1;let N$=class extends be{constructor(e){super(e),this._needsRender=!0,this._passParameters=new _De,this._frameBuffer=new ps(e.context.renderContext.rctx,{colorTarget:Qs.TEXTURE,width:Nm,height:Nm},{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.LINEAR,hasMipmap:!1,width:Nm,height:Nm}),this._vao=Zl(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.shaderTechniqueRepository}get textureAtlas(){return v(this._texture)?v(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render($h.WeatherMap)):v(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render($h.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Ho(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=Di(this._fullTechniqueCached),this._weatherMapTechniqueCached=Di(this._weatherMapTechniqueCached),this._frameBuffer=tt(this._frameBuffer),this._vao=tt(this._vao)}get _fullTechnique(){if(C(this._fullTechniqueCached)){const e=new jte;e.mode=$h.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(PN,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(C(this._weatherMapTechniqueCached)){const e=new jte;e.mode=$h.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(PN,e)}return this._weatherMapTechniqueCached}_render(e){if(C(this._vao)||C(this._frameBuffer))return null;const t=e===$h.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,i=r.getViewport();r.setViewport(0,0,Nm,Nm),r.bindFramebuffer(this._frameBuffer);const s=r.bindTechnique(t,this._passParameters,null);return r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(i.x,i.y,i.width,i.height),this._needsRender=!1,this._frameBuffer.colorTexture}};u([h({constructOnly:!0})],N$.prototype,"context",void 0),u([h({readOnly:!0})],N$.prototype,"_techniqueRepository",null),N$=u([I("esri.views.3d.environment.NoiseTextureAtlas")],N$);function vDe(e){e.include(tp),e.uniforms.add([new Rt("geometryDepthTexture",(t,r)=>r.multipassGeometry.linearDepthTexture),new ai("nearFar",(t,r)=>r.camera.nearFar)]),e.code.add(S`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class Apt{constructor(){this.enabled=!1}}function rp(e,t){t.hasMultipassTerrain&&(e.fragment.include(tp),e.fragment.uniforms.add(new Rt("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new ai("nearFar",(r,i)=>i.camera.nearFar)),e.fragment.uniforms.add(new ai("inverseViewport",(r,i)=>i.inverseViewport)),e.fragment.code.add(S`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class Opt{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function Mpt(e,t){const r=e.fragment;r.include(tp),r.uniforms.add(new ai("nearFar",(i,s)=>s.camera.nearFar)),r.uniforms.add(new Rt("depthMap",(i,s)=>s.linearDepthTexture)),r.uniforms.add(new xs("proj",(i,s)=>s.ssr.camera.projectionMatrix)),r.uniforms.add(new De("invResolutionHeight",(i,s)=>1/s.ssr.camera.height)),r.uniforms.add(new xs("reprojectionMatrix",(i,s)=>s.ssr.reprojectionMatrix)),r.code.add(S`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class Rpt{constructor(){this.reprojectionMatrix=$e()}}var Ee;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(Ee||(Ee={}));class vle{constructor(t=$()){this.intensity=t}}class bDe{constructor(t=$(),r=Fe(.57735,.57735,.57735)){this.intensity=t,this.direction=r}}class pV{constructor(t=$(),r=Fe(.57735,.57735,.57735),i=!0,s=1,n=1){this.intensity=t,this.direction=r,this.castShadows=i,this.specularStrength=s,this.environmentStrength=n}}class wDe{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function Ipt(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r}function xW(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r}function zM(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}function xDe(e){return(e+1)*(e+1)}function Ppt(e){return _e(Math.floor(Math.sqrt(e)-1),0,2)}function TDe(e,t,r){const i=e[0],s=e[1],n=e[2],o=r||[];return o.length=xDe(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*i*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*i*n,o[8]=.54627421529*(i*i-s*s)),o}function $pt(e,t){const r=xDe(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let s=0;s<r;s++)i.r[s]=i.g[s]=i.b[s]=0;return i}function Dpt(e,t){const r=Ppt(t.r.length);for(const i of e)Fl(Gte,i.direction),TDe(Gte,r,uv),Ipt(uv,UB),xW(uv,i.intensity[0],DC),zM(t.r,DC),xW(uv,i.intensity[1],DC),zM(t.g,DC),xW(uv,i.intensity[2],DC),zM(t.b,DC);return t}function Lpt(e,t){TDe(Gte,0,uv);for(const r of e)t.r[0]+=uv[0]*UB[0]*r.intensity[0]*4*Math.PI,t.g[0]+=uv[0]*UB[0]*r.intensity[1]*4*Math.PI,t.b[0]+=uv[0]*UB[0]*r.intensity[2]*4*Math.PI;return t}function Npt(e,t,r,i){$pt(t,i),ue(r.intensity,0,0,0);let s=!1;const n=Fpt,o=kpt,a=Upt;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof pV&&!s?(le(r.direction,l.direction),le(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,s=!0):l instanceof pV||l instanceof bDe?n.push(l):l instanceof vle?o.push(l):l instanceof wDe&&a.push(l);Dpt(n,i),Lpt(o,i);for(const l of a)zM(i.r,l.r),zM(i.g,l.g),zM(i.b,l.b)}const Fpt=[],kpt=[],Upt=[],uv=[0],DC=[0],Gte=$(),UB=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class Nye{constructor(){this.color=$(),this.intensity=1}}class Bpt{constructor(){this.direction=$(),this.ambient=new Nye,this.diffuse=new Nye}}const SDe=.4;class TW{constructor(){this._shOrder=2,this._legacy=new Bpt,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new wDe,this._mainLight=new pV($(),Fe(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(t){Npt(t,this._shOrder,this._mainLight,this._sphericalHarmonics),le(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,de(this._legacy.diffuse.color,this._mainLight.intensity,r),le(ok,this._legacy.diffuse.color),de(ok,ok,SDe*this.globalFactor),ye(this._legacy.ambient.color,this._legacy.ambient.color,ok)}copyFrom(t){this._sphericalHarmonics.r=Array.from(t.sh.r),this._sphericalHarmonics.g=Array.from(t.sh.g),this._sphericalHarmonics.b=Array.from(t.sh.b),this._mainLight.direction=ws(t.mainLight.direction),this._mainLight.intensity=ws(t.mainLight.intensity),this._mainLight.castShadows=t.mainLight.castShadows,this._mainLight.specularStrength=t.mainLight.specularStrength,this._mainLight.environmentStrength=t.mainLight.environmentStrength,this.globalFactor=t.globalFactor,this.noonFactor=t.noonFactor}lerpLighting(t,r,i){if($n(this._mainLight.intensity,t.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=Ft(t.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=Ft(t.mainLight.specularStrength,r.mainLight.specularStrength,i),le(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=Ft(t.globalFactor,r.globalFactor,i),this.noonFactor=Ft(t.noonFactor,r.noonFactor,i),t.sh.r.length===r.sh.r.length)for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=Ft(t.sh.r[s],r.sh.r[s],i),this._sphericalHarmonics.g[s]=Ft(t.sh.g[s],r.sh.g[s],i),this._sphericalHarmonics.b[s]=Ft(t.sh.b[s],r.sh.b[s],i);else for(let s=0;s<r.sh.r.length;s++)this._sphericalHarmonics.r[s]=r.sh.r[s],this._sphericalHarmonics.g[s]=r.sh.g[s],this._sphericalHarmonics.b[s]=r.sh.b[s]}}const ok=$();class h7{constructor(t,r,i){this.shadowMap=t,this.ssaoHelper=r,this.slicePlane=i,this.slot=Ee.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=rt(),this.oldLighting=new TW,this.newLighting=new TW,this._fadedLighting=new TW,this._lighting=this.newLighting,this.ssr=new Rpt,this.multipassTerrain=new Opt,this.multipassGeometry=new Apt,this.overlays=[],this.cloudsFade=new hpt}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(t){const{oldLighting:r,newLighting:i}=this;t>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,t),this._lighting=this._fadedLighting)}}let tu=class extends be{constructor(e){super(e),this.runOncePerFrame=!0,this._handles=new hr,this._techniques=new Array,this._techniqueConfiguration=new kB,this._bindParameters=new h7(null,null,null),this._passParameters=new gDe,this._drawParameters=new yDe,this._weatherTile=rt(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Ft(Sl.default.coverage[0],Sl.default.coverage[1],.5),this.density=Ft(Sl.default.density[0],Sl.default.density[1],.5),this.absorption=Ft(Sl.default.absorption[0],Sl.default.absorption[1],.5),this.cloudSize=Ft(Sl.default.cloudSize[0],Sl.default.cloudSize[1],.5),this.detailSize=Ft(Sl.default.detailSize[0],Sl.default.detailSize[1],.5),this.smoothness=Ft(Sl.default.smoothness[0],Sl.default.smoothness[1],.5),this.cloudHeight=Ft(Sl.default.cloudHeight[0],Sl.default.cloudHeight[1],.5),this.raymarchingSteps=Sl.default.raymarchingSteps,this._viewMatrix=$e(),this._dirty=!1,this.running=!1}_getTechnique(e){const t=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=t===AE.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=t,this._techniqueConfiguration.steps=e,this._techniques[r]=new d7({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;mr(this._weatherTile,(e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let i=0,s=0;if(v(this.view.environment)&&this.view.environment.lighting.type!=="virtual"&&v(this.view.environment.lighting.date)){const n=new Date(this.view.environment.lighting.date);n.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),i=31*n.getUTCMonth()+n.getUTCDate(),s=n.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+i)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),q$e(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){this._vao=Zl(this.context.renderContext.rctx);const e=Kr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(Ot.CLOUDS_GENERATOR,this),ie(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),pt)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Di(e)),this._frameBufferCube=tt(this._frameBufferCube),this._techniques.length=0,this._vao=tt(this._vao),this._passParameters.noiseTexture=Qe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case bu.SIXTEEN:return 1;case bu.HUNDRED:return 4;case bu.COUNT:case bu.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(v(this._passParameters.noiseTexture))this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new N$({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return v(this._passParameters.noiseTexture.textureAtlas)}_ensureFrameBufferCube(e){if(C(this._frameBufferCube)){const t={target:xt.TEXTURE_CUBE_MAP,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.LINEAR,hasMipmap:!1,width:e,height:e};this._frameBufferCube=new ps(this.context.renderContext.rctx,{colorTarget:Qs.CUBEMAP,width:e,height:e},t)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=tt(this._frameBufferCube)}applyPreset(e,t){const r=e.median,i=s=>{const n=Ft(s[0],s[1],r);return t<.5?Ft(s[0],n,2*t):Ft(n,s[1],2*(t-.5))};this.coverage=i(e.coverage),this.density=i(e.density),this.absorption=i(e.absorption),this.cloudSize=i(e.cloudSize),this.detailSize=i(e.detailSize),this.smoothness=i(e.smoothness),this.cloudHeight=i(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){if(C(this._vao))return this._dirty=this.running=!1,void(this.context.renderContext.bindParameters.cloudsFade.renderingStage=dn.FINISHED_RENDERING);this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Ho(this._passParameters.weatherTile,this._weatherTile));const t=this._getTechnique(this._passParameters.raymarchingSteps);if(!t.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=dn.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,i=r.bindTechnique(t,this._passParameters,this._bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao);const s=r.getViewport(),n=t.configuration.cubeMapSize,o=n/this._tilesPerFace,a=this._tileIndex*o;r.setViewport(0,a,n,o);const l=this._ensureFrameBufferCube(n);r.bindFramebuffer(l);const c=zpt[this._faceIndex],d=Vpt[this._faceIndex];BRe(this._viewMatrix,jpt,c,d),Tf(this._drawParameters.viewMatrix,this._viewMatrix);const p=xt.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;l.setColorTextureTarget(p),i.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),e.madeProgress(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=dn.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0)}};u([h({constructOnly:!0})],tu.prototype,"context",void 0),u([h({constructOnly:!0})],tu.prototype,"view",void 0),u([h({constructOnly:!0})],tu.prototype,"requestRender",void 0),u([h()],tu.prototype,"coverage",void 0),u([h()],tu.prototype,"density",void 0),u([h()],tu.prototype,"absorption",void 0),u([h()],tu.prototype,"cloudSize",void 0),u([h()],tu.prototype,"detailSize",void 0),u([h()],tu.prototype,"smoothness",void 0),u([h()],tu.prototype,"cloudHeight",void 0),u([h()],tu.prototype,"raymarchingSteps",void 0),u([h()],tu.prototype,"running",void 0),tu=u([I("esri.views.3d.environment.CloudsGenerator")],tu);const zpt=[fi(1,0,0),fi(-1,0,0),fi(0,1,0),fi(0,-1,0),fi(0,0,1)],Vpt=[fi(0,1,0),fi(0,1,0),fi(0,0,-1),fi(0,0,1),fi(0,1,0)],jpt=Sae();class ble extends Zi{constructor(){super(...arguments),this.fogColor=$(),this.hazeColor=$(),this.fogStrength=4e-6,this.hazeStrength=4e-6,this.atmosphereC=1}}function Gpt(e){const t=new Qr;t.attributes.add(M.POSITION,"vec2"),t.include(h0,{textureCoordinateType:Mn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=t;return r.uniforms.add([new xs("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new xs("inverseViewMatrix",(s,n)=>Pn(Hpt,n.camera.viewMatrix))]),r.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new De("atmosphereC",s=>s.atmosphereC)),i.uniforms.add(new er("cameraPosition",(s,n)=>n.camera.eye)),i.uniforms.add(new ai("nearFar",(s,n)=>n.camera.nearFar)),i.uniforms.add(new Rt("depthTex",s=>s.depthTexture)),i.uniforms.add(new De("fogStrength",s=>e.haze?s.hazeStrength:s.fogStrength)),i.uniforms.add(new De("fogAmount",s=>e.haze?s.hazeAmount:s.fogAmount)),i.uniforms.add(new er("fogColor",s=>e.haze?s.hazeColor:s.fogColor)),t.include(o7),i.include(tp),i.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(S`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(S`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?S`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const Hpt=$e(),EDe=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:ble,build:Gpt},Symbol.toStringTag,{value:"Module"}));class p7 extends li{initializeProgram(t){return new ti(t.rctx,p7.shader.get().build(this.configuration),Yr)}initializePipeline(){return this.configuration.haze?Ht({blending:ma(Ae.ONE,Ae.ZERO,Ae.ONE_MINUS_SRC_COLOR,Ae.ONE),colorWrite:cr}):Ht({blending:ma(Ae.SRC_ALPHA,Ae.ZERO,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE),colorWrite:cr})}}p7.shader=new ei(EDe,()=>re(()=>import("./FogHaze.glsl.c11cf945.js"),[]));class wle extends Yl{constructor(){super(...arguments),this.haze=!1}}u([j()],wle.prototype,"haze",void 0);const qpt=.95,Wpt=1;let F$=class extends be{constructor(e){super(e),this._passParameters=new ble;const t=e.context.renderContext.rctx;this._vao=Zl(t,kI);const r=Kr(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+ON}destroy(){this._thickFogTechniqueCached=Di(this._thickFogTechniqueCached),this._vao=tt(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}get _thickFogTechnique(){if(C(this._thickFogTechniqueCached)){const e=new wle;e.haze=!1,this._thickFogTechniqueCached=this._shaderTechniqueRepository.acquire(p7,e)}return this._thickFogTechniqueCached}render(e,t){if(this._update(e,t),this._passParameters.fogAmount<=0)return;const r=this._thickFogTechnique;if(!r.compiled)return void this.context.requestRender();const i=e.offscreenRenderingHelper;i.renderDepthDetached(()=>{this._passParameters.depthTexture=i.depthTexture;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,t){if(C(this._vao))return;const r=t.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Ut.TRIANGLE_STRIP,0,4)}_update(e,t){const r=e.bindParameters.camera;xe(Fye,r.eye);const i=Math.max(0,Te(Fye,e.bindParameters.lighting.mainLight.direction)),s=t.color;de(kye,s,.1),$n(this._passParameters.fogColor,kye,s,i);const n=Ie(r.eye),o=n*n;this._passParameters.atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-hR(qpt*Vp,Wpt*Vp,Math.abs(n-this._planetRadius)))*t.amount,this._passParameters.fogStrength=t.strength}static isSupported(e){return e.capabilities.depthTexture}};u([h({constructOnly:!0})],F$.prototype,"context",void 0),u([h({constructOnly:!0})],F$.prototype,"view",void 0),F$=u([I("esri.views.3d.environment.Fog")],F$);class Xpt{constructor(){this.color=$(),this.strength=0,this.amount=0}}const Fye=$(),kye=$();class aa extends Yl{constructor(){super(...arguments),this.hasWebGL2Context=!1}}u([j({constValue:!0})],aa.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],aa.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],aa.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!1})],aa.prototype,"useLegacyTerrainShading",void 0),u([j({constValue:!1})],aa.prototype,"hasModelTransformation",void 0),u([j({constValue:Ri.Pass})],aa.prototype,"pbrTextureBindType",void 0),u([j()],aa.prototype,"hasWebGL2Context",void 0);var C0;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(C0||(C0={}));class fV extends aa{constructor(){super(...arguments),this.geometry=C0.Cone}}u([j({count:C0.COUNT})],fV.prototype,"geometry",void 0);var V;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.ShadowHighlight=4]="ShadowHighlight",e[e.ShadowExludeHighlight=5]="ShadowExludeHighlight",e[e.Highlight=6]="Highlight",e[e.Alpha=7]="Alpha",e[e.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",e[e.COUNT=9]="COUNT"})(V||(V={}));function o4(e){e.attributes.add(M.POSITION,"vec3"),e.vertex.code.add(S`vec3 positionModel() { return position; }`)}function mV({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(S`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(S`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function a4(e){return!!pe("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}class U0 extends tn{constructor(t,r){super(t,"mat3",Ri.Pass,(i,s,n)=>i.setUniformMatrix3fv(t,r(s,n)))}}function VM(e,t){e.include(o4);const r=e.vertex;r.include(mV,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),r.uniforms.add([new er("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new er("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new U0("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new xs("transformProjFromView",i=>i.transformProjFromView),new IN("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Hh("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Hh("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)]),r.code.add(S`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(S`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?S`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:S`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new er("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class CDe extends Zi{constructor(){super(...arguments),this.transformWorldFromViewTH=$(),this.transformWorldFromViewTL=$(),this.transformViewFromCameraRelativeRS=Ts(),this.transformProjFromView=$e()}}class ADe extends Zi{constructor(){super(...arguments),this.transformWorldFromModelRS=Ts(),this.transformWorldFromModelTH=Ki(),this.transformWorldFromModelTL=Ki()}}function Rx(e){e.varyings.add("linearDepth","float")}function OE(e){e.vertex.uniforms.add(new ai("nearFar",(t,r)=>r.camera.nearFar))}function f7(e){e.vertex.code.add(S`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function UI(e,t){const{vertex:r}=e;switch(t.output){case V.Color:if(t.receiveShadows)return Rx(e),void r.code.add(S`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case V.Depth:case V.Shadow:case V.ShadowHighlight:case V.ShadowExludeHighlight:return e.include(VM,t),Rx(e),OE(e),f7(e),void r.code.add(S`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(S`void forwardLinearDepth() {}`)}function wu(e,t){if(f7(e),t.hasModelTransformation)return e.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),void e.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);e.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class xle extends Zi{constructor(){super(...arguments),this.texV=rt(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new ODe}}class ODe{constructor(){this.center=$(),this.v1=$(),this.v2=$()}}function Ypt(e){const t=new Qr,{vertex:r,fragment:i}=t;if(d1(r),e.geometry===C0.Underground)t.attributes.add(M.POSITION,"vec2"),t.varyings.add("color","vec4"),r.uniforms.add([new er("cameraPosition",(s,n)=>n.camera.eye),new De("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)]),r.code.add(S`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(S`void main() {
gl_FragColor = color;
}`);else{t.include(wu,e),t.attributes.add(M.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===C0.Cylinder;r.uniforms.add([new xs("proj",(a,l)=>l.camera.projectionMatrix),new xs("view",(a,l)=>l.camera.viewMatrix)]),s||(t.varyings.add("innerFactor","float"),r.uniforms.add(new er("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new er("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new er("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new ai("texV",a=>a.texV)),r.uniforms.add(new De("innerScale",a=>a.innerScale)));const n=6.2831853,o=1/128;r.code.add(S`
		void main(void) {
      ${s?S`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:S`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${S.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${S.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new Rt("tex",a=>a.texture)),s||i.uniforms.add(new De("altitudeFade",a=>a.altitudeFade)),i.code.add(S`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?S`gl_FragColor = atmosphereColor;`:S`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const Zpt=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:xle,SilhouetteCircle:ODe,build:Ypt},Symbol.toStringTag,{value:"Module"}));class XR extends li{initializeProgram(t){return new ti(t.rctx,XR.shader.get().build(this.configuration),Yr)}initializePipeline(){return this.configuration.geometry===C0.Cylinder?Ht({blending:ma(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),culling:ule,depthTest:{func:rs.LEQUAL},colorWrite:cr}):Ht({blending:ma(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),depthTest:{func:rs.LEQUAL},colorWrite:cr})}}XR.shader=new ei(Zpt,()=>re(()=>import("./SimpleAtmosphere.glsl.f48e704e.js"),[]));const MDe=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function jd(e,t=0){const r=e.stride;return e.fieldNames.filter(i=>{const s=e.fields.get(i).optional;return!(s&&s.glPadding)}).map(i=>{const s=e.fields.get(i),n=s.constructor.ElementCount,o=Jpt(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new Ha(i,n,o,a,r,l,t)})}function Jpt(e){const t=Kpt[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const Kpt={u8:mt.UNSIGNED_BYTE,u16:mt.UNSIGNED_SHORT,u32:mt.UNSIGNED_INT,i8:mt.BYTE,i16:mt.SHORT,i32:mt.INT,f32:mt.FLOAT};class Tle{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<9;s++)r[s]=this.typedBuffer[i++];return r}setMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[i++]=r[s]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}Tle.ElementCount=9;class Sle{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<16;s++)r[s]=this.typedBuffer[i++];return r}setMat(t,r){let i=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[i++]=r[s]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}Sle.ElementCount=16;class f1{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.stride=s,this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,r){this.typedBuffer[t*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}}f1.ElementCount=1;class m1{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,mr(r,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t]=r[1]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t]=i}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}m1.ElementCount=2;class g1{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,ue(r,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t++]=r[1],this.typedBuffer[t]=r[2]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i,s){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t++]=i,this.typedBuffer[t]=s}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}g1.ElementCount=3;class y1{constructor(t,r,i=0,s,n){this.TypedArrayConstructor=t,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=n==null?new o(r,a):new o(r,a,(n-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const s=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,s,this.stride,s+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,Oi(r,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t++]=r[1],this.typedBuffer[t++]=r[2],this.typedBuffer[t]=r[3]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t++]=i,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,r,i){const s=this.typedBuffer,n=r.typedBuffer;let o=t*this.typedBufferStride,a=i*r.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}y1.ElementCount=4;class l4 extends f1{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}static fromTypedArray(t,r){return new l4(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}l4.ElementType="f32";class Af extends m1{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(Af,t,r)}static fromTypedArray(t,r){return new Af(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Af.ElementType="f32";class Ii extends g1{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(Ii,t,r)}static fromTypedArray(t,r){return new Ii(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Ii.ElementType="f32";class ga extends y1{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(ga,t,r)}static fromTypedArray(t,r){return new ga(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ga.ElementType="f32";class gg extends Tle{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(gg,t,r)}static fromTypedArray(t,r){return new gg(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}gg.ElementType="f32";class Ix extends Tle{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(Ix,t,r)}static fromTypedArray(t,r){return new Ix(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Ix.ElementType="f64";class YR extends Sle{constructor(t,r=0,i,s){super(Float32Array,t,r,i,s),this.elementType="f32"}slice(t,r){return this.sliceBuffer(YR,t,r)}static fromTypedArray(t,r){return new YR(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}YR.ElementType="f32";class Px extends Sle{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(Px,t,r)}static fromTypedArray(t,r){return new Px(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Px.ElementType="f64";class ZR extends f1{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(ZR,t,r)}static fromTypedArray(t,r){return new ZR(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ZR.ElementType="f64";class JR extends m1{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(JR,t,r)}static fromTypedArray(t,r){return new JR(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}JR.ElementType="f64";class qn extends g1{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(qn,t,r)}static fromTypedArray(t,r){return new qn(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}qn.ElementType="f64";class ME extends y1{constructor(t,r=0,i,s){super(Float64Array,t,r,i,s),this.elementType="f64"}slice(t,r){return this.sliceBuffer(ME,t,r)}static fromTypedArray(t,r){return new ME(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ME.ElementType="f64";class Qv extends f1{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(Qv,t,r)}static fromTypedArray(t,r){return new Qv(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Qv.ElementType="u8";class RE extends m1{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(RE,t,r)}static fromTypedArray(t,r){return new RE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}RE.ElementType="u8";class $x extends g1{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer($x,t,r)}static fromTypedArray(t,r){return new $x(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}$x.ElementType="u8";class Go extends y1{constructor(t,r=0,i,s){super(Uint8Array,t,r,i,s),this.elementType="u8"}slice(t,r){return this.sliceBuffer(Go,t,r)}static fromTypedArray(t,r){return new Go(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Go.ElementType="u8";class IE extends f1{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(IE,t,r)}static fromTypedArray(t,r){return new IE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}IE.ElementType="u16";class KR extends m1{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(KR,t,r)}static fromTypedArray(t,r){return new KR(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}KR.ElementType="u16";class PE extends g1{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(PE,t,r)}static fromTypedArray(t,r){return new PE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}PE.ElementType="u16";class Dx extends y1{constructor(t,r=0,i,s){super(Uint16Array,t,r,i,s),this.elementType="u16"}slice(t,r){return this.sliceBuffer(Dx,t,r)}static fromTypedArray(t,r){return new Dx(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Dx.ElementType="u16";class $E extends f1{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer($E,t,r)}static fromTypedArray(t,r){return new $E(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}$E.ElementType="u32";class QR extends m1{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(QR,t,r)}static fromTypedArray(t,r){return new QR(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}QR.ElementType="u32";class $N extends g1{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer($N,t,r)}static fromTypedArray(t,r){return new $N(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}$N.ElementType="u32";class DN extends y1{constructor(t,r=0,i,s){super(Uint32Array,t,r,i,s),this.elementType="u32"}slice(t,r){return this.sliceBuffer(DN,t,r)}static fromTypedArray(t,r){return new DN(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}DN.ElementType="u32";class eI extends f1{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(eI,t,r)}static fromTypedArray(t,r){return new eI(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}eI.ElementType="i8";class DE extends m1{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(DE,t,r)}static fromTypedArray(t,r){return new DE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}DE.ElementType="i8";class LN extends g1{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(LN,t,r)}static fromTypedArray(t,r){return new LN(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}LN.ElementType="i8";class NN extends y1{constructor(t,r=0,i,s){super(Int8Array,t,r,i,s),this.elementType="i8"}slice(t,r){return this.sliceBuffer(NN,t,r)}static fromTypedArray(t,r){return new NN(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}NN.ElementType="i8";class FN extends f1{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(FN,t,r)}static fromTypedArray(t,r){return new FN(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}FN.ElementType="i16";class LE extends m1{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(LE,t,r)}static fromTypedArray(t,r){return new LE(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}LE.ElementType="i16";class kN extends g1{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(kN,t,r)}static fromTypedArray(t,r){return new kN(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}kN.ElementType="i16";class UN extends y1{constructor(t,r=0,i,s){super(Int16Array,t,r,i,s),this.elementType="i16"}slice(t,r){return this.sliceBuffer(UN,t,r)}static fromTypedArray(t,r){return new UN(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}UN.ElementType="i16";class BN extends f1{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(BN,t,r)}static fromTypedArray(t,r){return new BN(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}BN.ElementType="i32";class zN extends m1{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(zN,t,r)}static fromTypedArray(t,r){return new zN(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}zN.ElementType="i32";class VN extends g1{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(VN,t,r)}static fromTypedArray(t,r){return new VN(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}VN.ElementType="i32";class jN extends y1{constructor(t,r=0,i,s){super(Int32Array,t,r,i,s),this.elementType="i32"}slice(t,r){return this.sliceBuffer(jN,t,r)}static fromTypedArray(t,r){return new jN(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}jN.ElementType="i32";function RDe(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}function Qpt(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0}}function eft(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1}}function tft(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303}}class gV{constructor(t,r){this.layout=t,this.buffer=typeof r=="number"?new ArrayBuffer(r*t.stride):r;for(const i of t.fieldNames){const s=t.fields.get(i);this[i]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,r){const i=this[t];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(t,r){return new gV(this.layout,this.buffer.slice(t*this.stride,r*this.stride))}copyFrom(t,r,i,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,r*n,s*n/4);new Uint32Array(this.buffer,i*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,r*n,s*n);new Uint8Array(this.buffer,i*n,s*n).set(o)}}}class Ele{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,r){return this._appendField(t,Af,r),this}vec2f64(t,r){return this._appendField(t,JR,r),this}vec3f(t,r){return this._appendField(t,Ii,r),this}vec3f64(t,r){return this._appendField(t,qn,r),this}vec4f(t,r){return this._appendField(t,ga,r),this}vec4f64(t,r){return this._appendField(t,ME,r),this}mat3f(t,r){return this._appendField(t,gg,r),this}mat3f64(t,r){return this._appendField(t,Ix,r),this}mat4f(t,r){return this._appendField(t,YR,r),this}mat4f64(t,r){return this._appendField(t,Px,r),this}vec4u8(t,r){return this._appendField(t,Go,r),this}f32(t,r){return this._appendField(t,l4,r),this}f64(t,r){return this._appendField(t,ZR,r),this}u8(t,r){return this._appendField(t,Qv,r),this}u16(t,r){return this._appendField(t,IE,r),this}i8(t,r){return this._appendField(t,eI,r),this}vec2i8(t,r){return this._appendField(t,DE,r),this}vec2i16(t,r){return this._appendField(t,LE,r),this}vec2u8(t,r){return this._appendField(t,RE,r),this}vec4u16(t,r){return this._appendField(t,Dx,r),this}u32(t,r){return this._appendField(t,$E,r),this}_appendField(t,r,i){const s=r.ElementCount*RDe(r.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:r,offset:n,optional:i}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new gV(this,t)}createView(t){return new gV(this,t)}clone(){const t=new Ele;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((r,i)=>t.fields.set(i,r)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function Ds(){return new Ele}var Hte;(function(e){function t(o,a){const l=o[a],c=o[a+1],d=o[a+2];return Math.sqrt(l*l+c*c+d*d)}function r(o,a){const l=o[a],c=o[a+1],d=o[a+2],p=1/Math.sqrt(l*l+c*c+d*d);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,d,p=a){(d=d||o)[p]=o[a]+l[c],d[p+1]=o[a+1]+l[c+1],d[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,d,p=a){(d=d||o)[p]=o[a]-l[c],d[p+1]=o[a+1]-l[c+1],d[p+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=r,e.scale=i,e.add=s,e.subtract=n})(Hte||(Hte={}));const oc=Lr();class rft{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function Et(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new rft(t)}function LC(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function Uye(e,t,r,i){let s,n=(r[0]-e[0])/t[0],o=(i[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(r[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(r[2]-e[2])/t[2],d=(i[2]-e[2])/t[2];return c>d&&(s=c,c=d,d=s),!(n>d||c>o)&&(d<o&&(o=d),!(o<0))}function ak(e,t,r,i,s,n=rt()){const o=(i[s]-r[s])*(t[0]-e[0])-(i[0]-r[0])*(t[s]-e[s]),a=(i[0]-r[0])*(e[s]-r[s])-(i[s]-r[s])*(e[0]-r[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function Bye(e,t,r,i,s){s||(s=e),oc[0]=e[0],oc[1]=e[1],oc[2]=e[2],oc[3]=1,kh(oc,oc,t),s.length>2&&(s[2]=-oc[2]),kh(oc,oc,r),Et(oc[3]!==0),s[0]=oc[0]/oc[3],s[1]=oc[1]/oc[3],s[2]=oc[2]/oc[3],s[0]=(.5*s[0]+.5)*i[2]+i[0],s[1]=(.5*s[1]+.5)*i[3]+i[1]}function ift(e,t){return Math.log(e)/Math.log(t)}function IDe(e,t,r,i){e[12]=t,e[13]=r,e[14]=i}function PDe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}function sft(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}function nft(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}function oft(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}function aft(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}class m7{constructor(t,r,i,s){this.primitiveIndices=t,this._numIndexPerPrimitive=r,this.indices=i,this.position=s,this.center=$(),this._children=void 0,Et(t.length>=1),Et(i.length%this._numIndexPerPrimitive==0),Et(i.length>=t.length*this._numIndexPerPrimitive),Et(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*i[this._numIndexPerPrimitive*t[0]];fT.clear(),fT.push(l),this.bbMin=Fe(n[l],n[l+1],n[l+2]),this.bbMax=ws(this.bbMin);for(let d=0;d<a;++d){const p=this._numIndexPerPrimitive*t[d];for(let f=0;f<this._numIndexPerPrimitive;++f){l=o*i[p+f],fT.push(l);let m=n[l];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=n[l+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=n[l+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}}$n(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let c=this.radius*this.radius;for(let d=0;d<fT.length;++d){l=fT.getItemAt(d);const p=n[l]-this.center[0],f=n[l+1]-this.center[1],m=n[l+2]-this.center[2],g=p*p+f*f+m*m;if(g<=c)continue;const _=Math.sqrt(g),x=.5*(_-this.radius);this.radius=this.radius+x,c=this.radius*this.radius;const b=x/_;this.center[0]+=p*b,this.center[1]+=f*b,this.center[2]+=m*b}fT.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(jo(this.bbMin,this.bbMax)>1){const t=$n($(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<r;++c){let d=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],g=n[f+1],_=n[f+2];for(let x=1;x<this._numIndexPerPrimitive;++x){f=o*this.indices[p+x];const b=n[f],w=n[f+1],T=n[f+2];b<m&&(m=b),w<g&&(g=w),T<_&&(_=T)}m<t[0]&&(d|=1),g<t[1]&&(d|=2),_<t[2]&&(d|=4),i[c]=d,++s[d]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<r;++c){const d=i[c];l[d][s[d]++]=this.primitiveIndices[c]}this._children=new Array(8);for(let c=0;c<8;++c)l[c]!==void 0&&(this._children[c]=new m7(l[c],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){fT.prune()}}const fT=new Qt({deallocator:null});class c4{constructor(){this.id=Su()}unload(){}}var yg;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"})(yg||(yg={}));function lft(e){return e?{p0:ws(e.p0),p1:ws(e.p1),p2:ws(e.p2)}:{p0:$(),p1:$(),p2:$()}}function zye(e,t,r){const i=t[0]-e[0],s=t[1]-e[1],n=r[0]-e[0],o=r[1]-e[1];return .5*Math.abs(i*o-s*n)}function cft(e,t,r){return ge(SW,t,e),ge(Vye,r,e),Ie(At(SW,SW,Vye))/2}new c1(xg);new c1(()=>lft());const SW=$(),Vye=$();function $De(e,t,r){if(!e||!t)return!1;const{size:i,data:s}=e;ue(r,0,0,0),ue(Bp,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a+0]*i,c=t[a+1]*i,d=t[a+2]*i;ue(na,s[l+0],s[l+1],s[l+2]),ue(dv,s[c+0],s[c+1],s[c+2]),ue(lk,s[d+0],s[d+1],s[d+2]);const p=cft(na,dv,lk);p?(ye(na,na,dv),ye(na,na,lk),de(na,na,1/3*p),ye(r,r,na),n+=p):(ye(Bp,Bp,na),ye(Bp,Bp,dv),ye(Bp,Bp,lk),o+=3)}return(o!==0||n!==0)&&(n!==0?(de(r,r,1/n),!0):o!==0&&(de(r,Bp,1/o),!0))}function DDe(e,t,r){if(!e||!t)return!1;const{size:i,data:s}=e;ue(r,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*i;n!==l&&(r[0]+=s[l+0],r[1]+=s[l+1],r[2]+=s[l+2],o++),n=l}return o>1&&de(r,r,1/o),o>0}function Cle(e,t,r,i){if(!e)return!1;const{size:s,data:n}=e;ue(i,0,0,0),ue(Bp,0,0,0);let o=0,a=0;const l=t?t.length-1:n.length/s-1,c=l+(r?2:0);for(let d=0;d<c;d+=2){const p=d<l?d:l,f=d<l?d+1:0,m=(t?t[p]:p)*s,g=(t?t[f]:f)*s;na[0]=n[m+0],na[1]=n[m+1],na[2]=n[m+2],dv[0]=n[g+0],dv[1]=n[g+1],dv[2]=n[g+2],de(na,ye(na,na,dv),.5);const _=J9(na,dv);_>0?(ye(i,i,de(na,na,_)),o+=_):(ye(Bp,Bp,na),a++)}return o!==0?(de(i,i,1/o),!0):a!==0&&(de(i,Bp,1/a),!0)}const na=$(),dv=$(),lk=$(),Bp=$(),g7=1024;function uft(e){if(Array.isArray(e)){if(e.length<g7)return e;for(const t of e)if(t>=65536)return new Uint32Array(e);return new Uint16Array(e)}if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}function dft(e){const t=3*e;return t<=g7?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}let aw=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const LDe=[0],jM=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function tI(e){if(e===1)return LDe;if(e<g7)return Array.from(new Uint16Array(jM.buffer,0,e));if(e<jM.length)return new Uint16Array(jM.buffer,0,e);if(e>aw.length){const t=Math.max(2*aw.length,e);aw=new Uint32Array(t);for(let r=0;r<aw.length;r++)aw[r]=r}return new Uint32Array(aw.buffer,0,e)}function l8t(e){if(e===1)return LDe;if(e<g7)return Array.from(new Uint16Array(jM.buffer,0,e));if(e<jM.length)return new Uint16Array(jM.slice(0,e));if(e>aw.length){const t=new Uint32Array(e);for(let r=0;r<t.length;r++)t[r]=r;return t}return new Uint32Array(aw.slice(0,e))}class mn extends c4{constructor(t,r=[],i=Bl.Triangle,s=null,n=-1){super(),this._primitiveType=i,this.objectAndLayerIdColor=s,this.edgeIndicesLength=n,this.type=yg.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[o,a]of t)a&&this._vertexAttributes.set(o,{...a});if(r==null||r.length===0){const o=hft(this._vertexAttributes),a=tI(o);this.edgeIndicesLength=this.edgeIndicesLength<0?o:this.edgeIndicesLength;for(const l of this._vertexAttributes.keys())this._indices.set(l,a)}else for(const[o,a]of r)a&&(this._indices.set(o,uft(a)),o===M.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(o).length:this.edgeIndicesLength))}cloneShallow(){const t=new mn([],void 0,this._primitiveType,this.objectAndLayerIdColor,void 0),{_vertexAttributes:r,_indices:i}=t;return this._vertexAttributes.forEach((s,n)=>r.set(n,s)),this._indices.forEach((s,n)=>i.set(n,s)),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const r=this._vertexAttributes.get(t);return r&&!r.exclusive&&(r.data=Array.from(r.data),r.exclusive=!0),r}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return C(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===Bl.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const r=this.indices.get(M.POSITION),i=this.vertexAttributes.get(M.POSITION);return $De(i,r,t)}_computeAttachmentOriginPoints(t){const r=this.indices.get(M.POSITION),i=this.vertexAttributes.get(M.POSITION);return DDe(i,r,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(M.POSITION);if(!t||t.length===0)return null;const r=this.primitiveType===Bl.Triangle?3:1;Et(t.length%r==0,"Indexing error: "+t.length+" not divisible by "+r);const i=tI(t.length/r),s=this.vertexAttributes.get(M.POSITION);return s?new m7(i,r,t,s):null}}function hft(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}const NC=Hte;var qte,Wte,Xte;(function(e){const r=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],i=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],o=new Array(36);for(let c=0;c<6;c++)for(let d=0;d<6;d++)o[6*c+d]=c;const a=new Array(36);for(let c=0;c<6;c++)a[6*c+0]=0,a[6*c+1]=1,a[6*c+2]=2,a[6*c+3]=2,a[6*c+4]=3,a[6*c+5]=0;function l(c){Array.isArray(c)||(c=[c,c,c]);const d=new Array(24);for(let p=0;p<8;p++)d[3*p]=r[p][0]*c[0],d[3*p+1]=r[p][1]*c[1],d[3*p+2]=r[p][2]*c[2];return new mn([[M.POSITION,{size:3,data:d,exclusive:!0}],[M.NORMAL,{size:3,data:i}],[M.UV0,{size:2,data:s}]],[[M.POSITION,n],[M.NORMAL,o],[M.UV0,a]])}e.createGeometry=l})(qte||(qte={})),function(e){const r=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],i=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],n=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function o(a){Array.isArray(a)||(a=[a,a,a]);const l=new Array(18);for(let c=0;c<6;c++)l[3*c]=r[c][0]*a[0],l[3*c+1]=r[c][1]*a[1],l[3*c+2]=r[c][2]*a[2];return new mn([[M.POSITION,{size:3,data:l,exclusive:!0}],[M.NORMAL,{size:3,data:i}]],[[M.POSITION,s],[M.NORMAL,n]])}e.createGeometry=o}(Wte||(Wte={})),function(e){const i=fi(-.5,0,-.5),s=fi(.5,0,-.5),n=fi(0,0,.5),o=fi(0,0+.5,0),a=Ki(),l=Ki(),c=Ki(),d=Ki(),p=Ki();ge(a,i,o),ge(l,i,s),At(c,a,l),xe(c,c),ge(a,s,o),ge(l,s,n),At(d,a,l),xe(d,d),ge(a,n,o),ge(l,n,i),At(p,a,l),xe(p,p);const f=[i,s,n,o],m=[0,-1,0,c[0],c[1],c[2],d[0],d[1],d[2],p[0],p[1],p[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],_=[0,0,0,1,1,1,2,2,2,3,3,3];function x(b){Array.isArray(b)||(b=[b,b,b]);const w=new Array(12);for(let T=0;T<4;T++)w[3*T]=f[T][0]*b[0],w[3*T+1]=f[T][1]*b[1],w[3*T+2]=f[T][2]*b[2];return new mn([[M.POSITION,{size:3,data:w,exclusive:!0}],[M.NORMAL,{size:3,data:m}]],[[M.POSITION,g],[M.NORMAL,_]])}e.createGeometry=x}(Xte||(Xte={}));const pft=qte.createGeometry,fft=Wte.createGeometry,mft=Xte.createGeometry;function c8t(e,t,r,i={uv:!0}){const s=-Math.PI,n=2*Math.PI,o=-Math.PI/2,a=Math.PI,l=Math.max(3,Math.floor(t)),c=Math.max(2,Math.floor(r)),d=(l+1)*(c+1),p=new Float32Array(3*d),f=new Float32Array(3*d),m=new Float32Array(2*d),g=[];let _=0;for(let T=0;T<=c;T++){const E=[],O=T/c,A=o+O*a,R=Math.cos(A);for(let D=0;D<=l;D++){const k=D/l,L=s+k*n,q=Math.cos(L)*R,G=Math.sin(A),J=-Math.sin(L)*R;p[3*_]=q*e,p[3*_+1]=G*e,p[3*_+2]=J*e,f[3*_]=q,f[3*_+1]=G,f[3*_+2]=J,m[2*_]=k,m[2*_+1]=O,E.push(_),++_}g.push(E)}const x=new Array;for(let T=0;T<c;T++)for(let E=0;E<l;E++){const O=g[T][E],A=g[T][E+1],R=g[T+1][E+1],D=g[T+1][E];T===0?(x.push(O),x.push(R),x.push(D)):T===c-1?(x.push(O),x.push(A),x.push(R)):(x.push(O),x.push(A),x.push(R),x.push(R),x.push(D),x.push(O))}const b=[[M.POSITION,x],[M.NORMAL,x]],w=[[M.POSITION,{size:3,data:p,exclusive:!0}],[M.NORMAL,{size:3,data:f,exclusive:!0}]];return i.uv&&(w.push([M.UV0,{size:2,data:m,exclusive:!0}]),b.push([M.UV0,x])),i.offset&&(b[0][0]=M.OFFSET,w[0][0]=M.OFFSET,b.push([M.POSITION,new Array(x.length).fill(0)]),w.push([M.POSITION,{size:3,data:Float64Array.from(i.offset),exclusive:!0}])),new mn(w,b)}function NDe(e,t,r){const i=e;let s,n;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const p=i*(1+Math.sqrt(5))/2;s=[-i,p,0,i,p,0,-i,-p,0,i,-p,0,0,-i,p,0,i,p,0,-i,-p,0,i,-p,p,0,-i,p,0,i,-p,0,-i,-p,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let p=0;p<s.length;p+=3)NC.scale(s,p,e/NC.length(s,p));let o={};function a(p,f){p>f&&([p,f]=[f,p]);const m=p.toString()+"."+f.toString();if(o[m])return o[m];let g=s.length;return s.length+=3,NC.add(s,3*p,s,3*f,s,g),NC.scale(s,g,e/NC.length(s,g)),g/=3,o[m]=g,g}for(let p=0;p<t;p++){const f=n.length,m=new Array(4*f);for(let g=0;g<f;g+=3){const _=n[g],x=n[g+1],b=n[g+2],w=a(_,x),T=a(x,b),E=a(b,_),O=4*g;m[O]=_,m[O+1]=w,m[O+2]=E,m[O+3]=x,m[O+4]=T,m[O+5]=w,m[O+6]=b,m[O+7]=E,m[O+8]=T,m[O+9]=w,m[O+10]=T,m[O+11]=E}n=m,o={}}const l=new Float32Array(s);for(let p=0;p<l.length;p+=3)NC.normalize(l,p);const c=[[M.POSITION,n],[M.NORMAL,n]],d=[[M.POSITION,{size:3,data:new Float32Array(s),exclusive:!0}],[M.NORMAL,{size:3,data:l,exclusive:!0}]];return new mn(d,c)}function Yte(e,t,r,i,s,n,o,a){const l=t?[t[0],t[1],t[2]]:[0,0,0],c=e?[e[0],e[1],e[2]]:[0,0,1];n=n||[0,0];const d=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],p=i!=null&&i.length===2?i:[1,1],f=[[M.POSITION,{size:3,data:l,exclusive:!0}],[M.NORMAL,{size:3,data:c,exclusive:!0}],[M.UV0,{size:n.length,data:n}],[M.COLOR,{size:4,data:d,exclusive:!0}],[M.SIZE,{size:2,data:p}]];if(s!=null){const m=new Float32Array([s[0],s[1],s[2],s[3]]);f.push([M.AUXPOS1,{size:4,data:m}])}if(o!=null){const m=new Float32Array([o[0],o[1],o[2],o[3]]);f.push([M.AUXPOS2,{size:4,data:m}])}return new mn(f,null,Bl.Point,a)}const gft=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function u8t(e=gft){const t=new Array(12);for(let c=0;c<4;c++)for(let d=0;d<3;d++)t[3*c+d]=e[c][d];const r=[0,1,2,2,3,0],i=[0,0,1],s=[0,0,0,0,0,0],n=[0,0,1,0,1,1,0,1],o=[255,255,255,255],a=[[M.POSITION,r],[M.NORMAL,s],[M.UV0,r],[M.COLOR,s]],l=[[M.POSITION,{size:3,data:t,exclusive:!0}],[M.NORMAL,{size:3,data:i,exclusive:!0}],[M.UV0,{size:2,data:n,exclusive:!0}],[M.COLOR,{size:4,data:o,exclusive:!0}]];return new mn(l,a)}function jye(e,t,r,i,s=!0,n=!0){let o=0;const a=t,l=e;let c=fi(0,o,0),d=fi(0,o+l,0),p=fi(0,-1,0),f=fi(0,1,0);i&&(o=l,d=fi(0,0,0),c=fi(0,o,0),p=fi(0,1,0),f=fi(0,-1,0));const m=[d,c],g=[p,f],_=r+2,x=Math.sqrt(l*l+a*a);if(i)for(let R=r-1;R>=0;R--){const D=R*(2*Math.PI/r),k=fi(Math.cos(D)*a,o,Math.sin(D)*a);m.push(k);const L=fi(l*Math.cos(D)/x,-a/x,l*Math.sin(D)/x);g.push(L)}else for(let R=0;R<r;R++){const D=R*(2*Math.PI/r),k=fi(Math.cos(D)*a,o,Math.sin(D)*a);m.push(k);const L=fi(l*Math.cos(D)/x,a/x,l*Math.sin(D)/x);g.push(L)}const b=new Array,w=new Array;if(s){for(let R=3;R<m.length;R++)b.push(1),b.push(R-1),b.push(R),w.push(0),w.push(0),w.push(0);b.push(m.length-1),b.push(2),b.push(1),w.push(0),w.push(0),w.push(0)}if(n){for(let R=3;R<m.length;R++)b.push(R),b.push(R-1),b.push(0),w.push(R),w.push(R-1),w.push(1);b.push(0),b.push(2),b.push(m.length-1),w.push(1),w.push(2),w.push(g.length-1)}const T=new Float32Array(3*_);for(let R=0;R<_;R++)T[3*R]=m[R][0],T[3*R+1]=m[R][1],T[3*R+2]=m[R][2];const E=new Float32Array(3*_);for(let R=0;R<_;R++)E[3*R]=g[R][0],E[3*R+1]=g[R][1],E[3*R+2]=g[R][2];const O=[[M.POSITION,b],[M.NORMAL,w]],A=[[M.POSITION,{size:3,data:T,exclusive:!0}],[M.NORMAL,{size:3,data:E,exclusive:!0}]];return new mn(A,O)}function yft(e,t,r,i,s,n){const o=i?Qz(i):fi(1,0,0),a=s?Qz(s):fi(0,0,0);n=n!=null?n:!0;const l=Ki();xe(l,o);const c=Ki();de(c,l,Math.abs(e));const d=Ki();de(d,c,-.5),ye(d,d,a);const p=fi(0,1,0);Math.abs(1-Te(l,p))<.2&&ue(p,0,0,1);const f=Ki();At(f,l,p),xe(f,f),At(p,f,l);const m=2*r+(n?2:0),g=r+(n?2:0),_=new Float32Array(3*m),x=new Float32Array(3*g),b=new Float32Array(2*m),w=new Array(3*r*(n?4:2)),T=new Array(3*r*(n?4:2));n&&(_[3*(m-2)+0]=d[0],_[3*(m-2)+1]=d[1],_[3*(m-2)+2]=d[2],b[2*(m-2)]=0,b[2*(m-2)+1]=0,_[3*(m-1)+0]=_[3*(m-2)+0]+c[0],_[3*(m-1)+1]=_[3*(m-2)+1]+c[1],_[3*(m-1)+2]=_[3*(m-2)+2]+c[2],b[2*(m-1)]=1,b[2*(m-1)+1]=1,x[3*(g-2)+0]=-l[0],x[3*(g-2)+1]=-l[1],x[3*(g-2)+2]=-l[2],x[3*(g-1)+0]=l[0],x[3*(g-1)+1]=l[1],x[3*(g-1)+2]=l[2]);const E=(L,q,G)=>{w[L]=q,T[L]=G};let O=0;const A=Ki(),R=Ki();for(let L=0;L<r;L++){const q=L*(2*Math.PI/r);de(A,p,Math.sin(q)),de(R,f,Math.cos(q)),ye(A,A,R),x[3*L+0]=A[0],x[3*L+1]=A[1],x[3*L+2]=A[2],de(A,A,t),ye(A,A,d),_[3*L+0]=A[0],_[3*L+1]=A[1],_[3*L+2]=A[2],b[2*L+0]=L/r,b[2*L+1]=0,_[3*(L+r)+0]=_[3*L+0]+c[0],_[3*(L+r)+1]=_[3*L+1]+c[1],_[3*(L+r)+2]=_[3*L+2]+c[2],b[2*(L+r)+0]=L/r,b[2*L+1]=1;const G=(L+1)%r;E(O++,L,L),E(O++,L+r,L),E(O++,G,G),E(O++,G,G),E(O++,L+r,L),E(O++,G+r,G)}if(n){for(let L=0;L<r;L++){const q=(L+1)%r;E(O++,m-2,g-2),E(O++,L,g-2),E(O++,q,g-2)}for(let L=0;L<r;L++){const q=(L+1)%r;E(O++,L+r,g-1),E(O++,m-1,g-1),E(O++,q+r,g-1)}}const D=[[M.POSITION,w],[M.NORMAL,T],[M.UV0,w]],k=[[M.POSITION,{size:3,data:_,exclusive:!0}],[M.NORMAL,{size:3,data:x,exclusive:!0}],[M.UV0,{size:2,data:b,exclusive:!0}]];return new mn(k,D)}function d8t(e,t,r,i,s,n=fi(0,0,0)){const o=e.length,a=new Float32Array(t.length*o*3+(6*r.length||0)),l=new Float32Array(t.length*o*3+(r?6:0)),c=new Array,d=new Array;let p=0,f=0;const m=Ki(),g=Ki(),_=Ki(),x=Ki(),b=Ki(),w=Ki(),T=Ki(),E=$(),O=Ki(),A=Ki(),R=Ki(),D=Ki(),k=Ki(),L=di();ue(O,0,1,0),ge(g,t[1],t[0]),xe(g,g),s?(ye(E,t[0],n),xe(_,E)):ue(_,0,0,1),yV(g,_,O,O,b,_,Gye),le(x,_),le(D,b);for(let N=0;N<r.length;N++)de(w,b,r[N][0]),de(E,_,r[N][2]),ye(w,w,E),ye(w,w,t[0]),a[p++]=w[0],a[p++]=w[1],a[p++]=w[2];l[f++]=-g[0],l[f++]=-g[1],l[f++]=-g[2];for(let N=0;N<i.length;N++)c.push(i[N][0]>0?i[N][0]:-i[N][0]-1+r.length),c.push(i[N][1]>0?i[N][1]:-i[N][1]-1+r.length),c.push(i[N][2]>0?i[N][2]:-i[N][2]-1+r.length),d.push(0),d.push(0),d.push(0);let q=r.length;const G=r.length-1;for(let N=0;N<t.length;N++){let B=!1;N>0&&(le(m,g),N<t.length-1?(ge(g,t[N+1],t[N]),xe(g,g)):B=!0,ye(A,m,g),xe(A,A),ye(R,t[N-1],x),BR(t[N],A,L),dC(L,ep(R,m),E)?(ge(E,E,t[N]),xe(_,E),At(b,A,_),xe(b,b)):yV(A,x,D,O,b,_,Gye),le(x,_),le(D,b)),s&&(ye(E,t[N],n),xe(k,E));for(let H=0;H<o;H++)if(de(w,b,e[H][0]),de(E,_,e[H][1]),ye(w,w,E),xe(T,w),l[f++]=T[0],l[f++]=T[1],l[f++]=T[2],ye(w,w,t[N]),a[p++]=w[0],a[p++]=w[1],a[p++]=w[2],!B){const W=(H+1)%o;c.push(q+H),c.push(q+o+H),c.push(q+W),c.push(q+W),c.push(q+o+H),c.push(q+o+W);for(let K=0;K<6;K++){const Y=c.length-6;d.push(c[Y+K]-G)}}q+=o}const J=t[t.length-1];for(let N=0;N<r.length;N++)de(w,b,r[N][0]),de(E,_,r[N][1]),ye(w,w,E),ye(w,w,J),a[p++]=w[0],a[p++]=w[1],a[p++]=w[2];const ee=f/3;l[f++]=g[0],l[f++]=g[1],l[f++]=g[2];const se=q-o;for(let N=0;N<i.length;N++)c.push(i[N][0]>=0?q+i[N][0]:-i[N][0]-1+se),c.push(i[N][2]>=0?q+i[N][2]:-i[N][2]-1+se),c.push(i[N][1]>=0?q+i[N][1]:-i[N][1]-1+se),d.push(ee),d.push(ee),d.push(ee);const X=[[M.POSITION,c],[M.NORMAL,d]],F=[[M.POSITION,{size:3,data:a,exclusive:!0}],[M.NORMAL,{size:3,data:l,exclusive:!0}]];return new mn(F,X)}function h8t(e,t,r){Et(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Et(e[0].length===3,"createPolylineGeometry(): malformed vertex"),Et(t==null||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Et(t==null||t[0].length===3,"createPolylineGeometry(): malformed normal");const i=new Float64Array(3*e.length),s=new Array(2*(e.length-1));let n=0,o=0;for(let c=0;c<e.length;c++){for(let d=0;d<3;d++)i[n++]=e[c][d];c>0&&(s[o++]=c-1,s[o++]=c)}const a=[],l=[];if(a.push([M.POSITION,s]),l.push([M.POSITION,{size:3,data:i,exclusive:!0}]),t){const c=new Float32Array(3*t.length);let d=0;for(let p=0;p<e.length;p++)for(let f=0;f<3;f++)c[d++]=t[p][f];a.push([M.NORMAL,s]),l.push([M.NORMAL,{size:3,data:c,exclusive:!0}])}return r&&(l.push([M.COLOR,{size:4,data:r}]),a.push([M.COLOR,tI(r.length/4)])),new mn(l,a,Bl.Line)}function p8t(e,t,r,i,s=0){const n=new Array(18),o=[[-t,s,i/2],[r,s,i/2],[0,e+s,i/2],[-t,s,-i/2],[r,s,-i/2],[0,e+s,-i/2]],a=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let l=0;l<6;l++)n[3*l]=o[l][0],n[3*l+1]=o[l][1],n[3*l+2]=o[l][2];return new mn([[M.POSITION,{size:3,data:n,exclusive:!0}]],[[M.POSITION,a]])}function _ft(e,t=e){const r=e.vertexAttributes,i=r.get(M.POSITION).data,s=r.get(M.NORMAL).data;if(s){const n=t.getMutableAttribute(M.NORMAL).data;for(let o=0;o<s.length;o+=3){const a=s[o+1];n[o+1]=-s[o+2],n[o+2]=a}}if(i){const n=t.getMutableAttribute(M.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];n[o+1]=-i[o+2],n[o+2]=a}}return t}function EW(e,t,r,i,s){return!(Math.abs(Te(t,e))>s)&&(At(r,e,t),xe(r,r),At(i,r,e),xe(i,i),!0)}function yV(e,t,r,i,s,n,o){return EW(e,t,s,n,o)||EW(e,r,s,n,o)||EW(e,i,s,n,o)}const Gye=.99619469809;class vft{constructor(){this.type=$a.Panoramic,this._configuration=new fV,this._passParameters=new xle}destroy(){this._passParameters.texture=tt(this._passParameters.texture),this._vao=tt(this._vao)}initializeRenderContext(t){this._configuration.geometry=C0.Cylinder,this._technique=t.shaderTechniqueRepository.acquire(XR,this._configuration);const r=t.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=da(this._vao,"geometry"),this._passParameters.texture=new dt(r,{pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.LINEAR,flipped:!0,width:1,height:512},MDe),t.requestRender()}render(t){if(C(this._vao)||C(this._passParameters.texture))return;const r=t.rctx,i=r.bindTechnique(this._technique,this._passParameters,t.bindParameters);bft(Hye,t.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",Hye),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Ut.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const r=NDe(1,2,!1),i=r.indices.get(M.POSITION);for(let a=0;a<i.length;a+=3){const l=i[a];i[a]=i[a+2],i[a+2]=l}const s=r.vertexAttributes.get(M.POSITION).data,n=qye.createBuffer(i.length),o=n.position;for(let a=0;a<i.length;++a){const l=3*i[a];o.set(a,0,s[l]),o.set(a,1,s[l+1]),o.set(a,2,s[l+2])}return new Cf(t,Yr,{geometry:jd(qye)},{geometry:Ur.createVertex(t,ni.STATIC_DRAW,n.buffer)})}}function bft(e,t){jn(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const Hye=$e(),qye=Ds().vec3f(M.POSITION);var e1;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(e1||(e1={}));class Zte extends Yl{constructor(){super(...arguments),this.type=e1.Rain}}u([j({count:e1.COUNT})],Zte.prototype,"type",void 0);function wft(e){const t=new Qr;return t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new er("cameraPosition",(r,i)=>i.camera.eye)),t.vertex.uniforms.add(new er("offset",(r,i)=>xft(r,i))),t.vertex.uniforms.add(new De("width",r=>r.width)),t.vertex.uniforms.add(new xs("proj",(r,i)=>i.camera.projectionMatrix)),t.vertex.uniforms.add(new xs("view",(r,i)=>i.camera.viewMatrix)),t.vertex.uniforms.add(new De("time",r=>r.time)),t.varyings.add("vUv","vec2"),t.vertex.code.add(S`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===e1.Rain?S`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:S`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add([new De("opacity",r=>r.opacity),new er("particleColor",(r,i)=>Tft(i,e))]),t.fragment.code.add(S`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===e1.Rain?S`d = 0.35 * smoothstep(0.5, 0.0, d);`:S`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}function xft(e,t){const r=t.camera.eye,i=.5*e.width,s=1/e.width,n=TCe(Jte,ue(Jte,(r[0]+i)*s,(r[1]+i)*s,(r[2]+i)*s));return Pc(n,r,de(n,n,e.width))}function Tft(e,t){const r=t.type===e1.Rain?Eft:Sft,i=de(Jte,r,Cft),s=e.camera.eye;xe(Wye,s);const n=Math.max(0,Te(Wye,e.lighting.mainLight.direction));return $n(i,i,r,n)}const Jte=$(),Wye=$(),Sft=Fe(1,1,1),Eft=Fe(.85,.85,.85),Cft=.7,Aft=Object.freeze(Object.defineProperty({__proto__:null,build:wft},Symbol.toStringTag,{value:"Module"}));class Oft extends Zi{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}}class GN extends li{initializeProgram(t){return new ti(t.rctx,GN.shader.get().build(this.configuration),BB)}initializePipeline(){return Ht({blending:ma(Ae.ONE,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),depthTest:{func:rs.LEQUAL},colorWrite:cr})}}GN.shader=new ei(Aft,()=>re(()=>import("./Precipitation.glsl.e79eaee2.js"),[]));const BB=new Map([[M.POSITION,0],[M.INSTANCEFEATUREATTRIBUTE,1]]);class FDe{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance(t){return this._time!==t.time&&(this._time=t.time,!0)}}let FS=class extends be{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new Oft,this._animation=new FDe,this._updatingTracking=new a0,this._passParameters.time=0,this._passParameters.radius=Kr(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=Di(this._snowTechniqueCached),this._rainTechniqueCached=Di(this._rainTechniqueCached),this._vao=tt(this._vao),this._instanceIdBuffer=tt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(C(this._rainTechniqueCached)){const e=new Zte;e.type=e1.Rain,this._rainTechniqueCached=this._shaderTechniqueRepository.acquire(GN,e)}return this._rainTechniqueCached}get _snowTechnique(){if(C(this._snowTechniqueCached)){const e=new Zte;e.type=e1.Snow,this._snowTechniqueCached=this._shaderTechniqueRepository.acquire(GN,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,t,r){const i=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!i.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),C(i)||C(this._vao)||C(this._instanceIdBuffer)||(v(e.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const n=.35;t=t<.5?Ft(0,n,2*t):Ft(n,1,2*(t-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*zse(this._animation.time)%1e5;const o=s.bindTechnique(i,this._passParameters,e.bindParameters);s.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),hle(s,BB,this._instanceIdBuffer,Xye,0),s.capabilities.instancing.drawArraysInstanced(Ut.TRIANGLES,0,3,this._numParticles*t),ple(s,BB,this._instanceIdBuffer,Xye)}_ensureResources(e){C(this._vao)&&(this._vao=this._createVertexArrayObject(e)),C(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let r=0;r<this._numParticles;r++)t.push(r);return Ur.createVertex(e,ni.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Cf(e,BB,{geometry:jd(Mft)},{geometry:Ur.createVertex(e,ni.STATIC_DRAW,t)})}};u([h({constructOnly:!0})],FS.prototype,"context",void 0),u([h({constructOnly:!0})],FS.prototype,"view",void 0),u([h({readOnly:!0})],FS.prototype,"updating",null),u([h()],FS.prototype,"_updatingTracking",void 0),FS=u([I("esri.views.3d.environment.Precipitation")],FS);const Mft=Ds().vec3f(M.POSITION),Xye=jd(Ds().f32(M.INSTANCEFEATUREATTRIBUTE),1),Rft=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),ck=128,Yye=-Bte,Zye=0,CW=50,Ift=()=>1-511/512,Pft=TB([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class $ft{constructor(t){this.view=t,this.type=$a.Simple,this._passParameters=new xle,this._fadeVaoCount=0,this._texV1=1,this._isOnMars=I0(t.spatialReference);const r=Kr(t.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+Yye)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Zye)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Zye/this._outerRimWidth,this._texVScale=this._texV1-this._texV0}destroy(){this._cameraChangeHandle=Gs(this._cameraChangeHandle),this._passParameters.texture=tt(this._passParameters.texture),this._fadeVao=tt(this._fadeVao),this._vao=tt(this._vao)}async initializeRenderContext(t){this._shaderTechniqueRepository=t.shaderTechniqueRepository;const r=t.renderContext.rctx;this._cameraChangeHandle=ie(()=>{var s;return(s=this.view.state)==null?void 0:s.camera},()=>t.requestRender(),Qi),this._vao=this._createRibbon(r),this._vaoCount=da(this._vao,"geometry"),this._fadeVao=Zl(r),this._fadeVaoCount=da(this._fadeVao,"geometry");const i=this._isOnMars?Rft:MDe;this._passParameters.texture=new dt(r,{pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.LINEAR,flipped:!0,width:1,height:512},i),t.requestRender()}get _coneTechnique(){if(C(this._coneTechniqueCached)){const t=new fV;t.geometry=C0.Cone,this._coneTechniqueCached=this._shaderTechniqueRepository.acquire(XR,t)}return this._coneTechniqueCached}get _undergroundTechnique(){if(C(this._undergroundTechniqueCached)){const t=new fV;t.geometry=C0.Underground,this._undergroundTechniqueCached=this._shaderTechniqueRepository.acquire(XR,t)}return this._undergroundTechniqueCached}render(t){if(C(this._vao)||C(this._passParameters.texture))return;const r=t.bindParameters.camera;this._update(r);const i=t.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,t.bindParameters),i.bindVAO(this._vao),i.drawArrays(Ut.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,t.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(Ut.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(t){const r=$(),i=this._planetRadius,s=Ie(t.eye),n=s-i;if(n<0){const m=Math.min(-n/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(CW,n),a=i+Yye;this._passParameters.innerScale=Dft(i+o,i,a)-1,this._passParameters.altitudeFade=X$e(n),de(r,t.eye,(i+CW)/s),Jye(r,t.center,t.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(t,r,t.up,this._passParameters.silhouette),c=Ift(),d=Pft(n);let p=this._texV0+c*this._texVScale,f=this._texV0+l*d*this._texVScale;if(n>CW){Jye(t.eye,t.center,t.up,i,this._passParameters.silhouette);const m=this._computeScreenRimWidth(t,t.eye,t.up,this._passParameters.silhouette),g=_e((m-1.5)/(l-1.5),0,1);p=this._texV0+g*c*this._texVScale,f=this._texV0+Ft(this._texV1,l*d,g)*this._texVScale}mr(this._passParameters.texV,p,f)}_createRibbon(t){const r=new Float32Array(3+3*ck*3),i=new Uint32Array(3*ck*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<ck;o++){const a=9*o+3;r[a+0]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===ck-1?1:l+3,d=15*o;i[d+0]=l,i[d+1]=l+1,i[d+2]=c+1,i[d+3]=c+1,i[d+4]=c,i[d+5]=l,i[d+6]=l+1,i[d+7]=l+2,i[d+8]=c+2,i[d+9]=c+2,i[d+10]=c+1,i[d+11]=l+1,i[d+12]=l,i[d+13]=c,i[d+14]=0}const s=Kye.createBuffer(i.length),n=s.position;for(let o=0;o<i.length;++o){const a=3*i[o];n.set(o,0,r[a]),n.set(o,1,r[a+1]),n.set(o,2,r[a+2])}return new Cf(t,Yr,{geometry:jd(Kye)},{geometry:Ur.createVertex(t,ni.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,r,i,s){return ye(PP,s.center,s.v2),de(OW,PP,this._outerRimFactor),Ij(AW,r,PP,i),Bye(PP,AW,t.projectionMatrix,t.viewport),Bye(OW,AW,t.projectionMatrix,t.viewport),Ni(PP,OW)/t.height}}function Jye(e,t,r,i,s){const n=Ie(e),o=i*Math.sqrt(n*n-i*i)/n,a=Math.sqrt(i*i-o*o),l=s.v1,c=s.v2;return de(s.center,e,a/n),At(l,e,t),Rc(l)<1&&At(l,e,r),de(l,l,o/Ie(l)),At(c,l,e),de(c,c,o/Ie(c)),o}const AW=$e(),PP=$(),OW=$();function Dft(e,t,r){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-r*r)+t*r)}const Kye=Ds().vec3f(M.POSITION);class y7 extends li{initializeProgram(t){return new ti(t.rctx,y7.shader.get().build(this.configuration),Yr)}initializePipeline(){return Ht({blending:ma(Ae.ONE,Ae.ZERO,Ae.ONE_MINUS_SRC_COLOR,Ae.ONE),colorWrite:cr})}}y7.shader=new ei(EDe,()=>re(()=>import("./FogHaze.glsl.c11cf945.js"),[]));const Lft=.7,Nft=1;let k$=class extends be{constructor(e){super(e),this._passParameters=new ble;const t=e.context.renderContext.rctx;this._vao=Zl(t,kI);const r=Kr(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+ON}destroy(){this._hazeTechniqueCached=Di(this._hazeTechniqueCached),this._vao=tt(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._passParameters.hazeStrength=e}get strength(){return this._passParameters.hazeStrength}get _hazeTechnique(){if(C(this._hazeTechniqueCached)){const e=new wle;e.haze=!0,this._hazeTechniqueCached=this._shaderTechniqueRepository.acquire(y7,e)}return this._hazeTechniqueCached}render(e,t){if(this.view.basemapTerrain.baseOpacity===0||(this._update(e,t),this._passParameters.hazeAmount<=0))return;const r=this._hazeTechnique;if(!r.compiled)return void this.context.requestRender();const i=e.offscreenRenderingHelper;i.renderDepthDetached(()=>{this._passParameters.depthTexture=i.depthTexture;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderSimpleHaze(s,e)})}_renderSimpleHaze(e,t){if(C(this._vao))return;const r=t.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Ut.TRIANGLE_STRIP,0,4)}_update(e,t){const r=e.bindParameters.camera;xe(Qye,r.eye);const i=Math.max(0,Te(Qye,e.bindParameters.lighting.mainLight.direction)),s=kft;de(e0e,s,0),$n(this._passParameters.hazeColor,e0e,s,i);const n=Ie(r.eye),o=n*n;this._passParameters.atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.hazeAmount=(1-hR(Lft*Vp,Nft*Vp,Math.abs(n-this._planetRadius)))*t.amount,this._passParameters.fogStrength=t.strength}static isSupported(e){return e.capabilities.depthTexture}};u([h({constructOnly:!0})],k$.prototype,"context",void 0),u([h({constructOnly:!0})],k$.prototype,"view",void 0),k$=u([I("esri.views.3d.environment.SimpleHaze")],k$);class Fft{constructor(){this.strength=0,this.amount=0}}const kft=Fe(.24,.44,.8),Qye=$(),e0e=$();function Ale(e){const t=S`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,r=S`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(r),e.fragment.code.add(t),e.fragment.code.add(r)}function Uft(){const e=new Qr;return e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.COLOR,"vec4"),e.attributes.add(M.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new xs("transform",(t,r)=>Bft(t,r)),new Tr("viewport",(t,r)=>r.camera.fullViewport),new De("pixelRatio",(t,r)=>r.camera.pixelRatio)]),e.include(Ale),e.vertex.code.add(S`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(S`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function Bft(e,t){return jn(z1,t.camera.projectionMatrix),z1[10]=24e-8-1,z1[11]=-1,z1[14]=(24e-8-2)*t.camera.near,Hs(z1,z1,t.camera.viewMatrix),Hs(z1,z1,e.modelMatrix)}const z1=$e(),zft=Object.freeze(Object.defineProperty({__proto__:null,build:Uft},Symbol.toStringTag,{value:"Module"}));class Vft extends Zi{constructor(){super(...arguments),this.modelMatrix=$e()}}class _7 extends li{constructor(t){super(t,new Yl,()=>this.destroy())}initializeProgram(t){return new ti(t.rctx,_7.shader.get().build(),Yr)}initializePipeline(){return Ht({blending:ma(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),depthTest:{func:rs.LEQUAL},colorWrite:cr})}}_7.shader=new ei(zft,()=>re(()=>import("./Stars.glsl.4065de69.js"),[]));let jb=class extends be{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new Vft,this._updatingTracking=new a0}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return v(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=lg(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Di(this._technique),this._vao=tt(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),C(this._technique)||C(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const r=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Ut.POINTS,0,this._numPoints)}_ensureResources(e){if(v(this._technique)||C(FC))return;this._technique=new _7({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=FC.byteLength/t0e;const t=new Float32Array(FC,0,2*this._numPoints),r=new Uint8Array(FC,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,i=>this._update(i),pt)}_computeDayDuration(e){const t=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),i=jn(this._renderParameter.modelMatrix,Hft);DR(i,i,-r*Math.PI),Hs(i,Gft,i),DR(i,i,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,r,i){const s=r0e.createBuffer(i),n=s.position,o=s.color,a=s.size;for(let l=0;l<i;l++){const c=t[2*l+0],d=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(d)),n.set(l,1,-Math.sin(c)*Math.sin(d)),n.set(l,2,-Math.cos(d));const p=this._unpackUint8Attributes(r[l]),f=this._hexToRGB(jft[p[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,p[0])}return new Cf(e,Yr,{geometry:jd(r0e)},{geometry:Ur.createVertex(e,ni.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(v(FC))return null;const e=VF(async t=>{const{data:r}=await oje("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(r),FC=r});return e.promise.catch(t=>{Ps(t)||te.getLogger(this.declaredClass).error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new z("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/t0e;if(t%1!=0||t>5e4||t<5e3)throw new z("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([h({constructOnly:!0})],jb.prototype,"view",void 0),u([h({constructOnly:!0})],jb.prototype,"requestRender",void 0),u([h({readOnly:!0})],jb.prototype,"updating",null),u([h()],jb.prototype,"_loadDataTask",void 0),u([h()],jb.prototype,"_updatingTracking",void 0),jb=u([I("esri.views.3d.environment.Stars")],jb);const jft=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],Gft=bae(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Hft=bae(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),t0e=9,r0e=Ds().vec3f(M.POSITION).vec4u8(M.COLOR).f32(M.SIZE);let FC=null;function u4(e=Wft){return[e[0],e[1],e[2],e[3]]}function f8t(e,t,r=u4()){return le(r,e),r[3]=t,r}function i0e(e,t,r=u4()){return At(r,e,t),xe(r,r),r[3]=-CCe(e,t),r}function m8t(e,t,r=u4()){return Jz(uk,e,s0e(e)),Jz(n0e,t,s0e(t)),jj(uk,n0e,uk),qft(r,Lc(wae(r,uk)))}function g8t(e){return e}function s0e(e){return Zt(e[3])}function qft(e,t){return e[3]=t,e}const Wft=[0,0,1,0],uk=wg(),n0e=wg();u4();function Xft(e,t,r){const i=e.parallax.anchorPointClouds;e.fadeIn.stage===pd.FINISHED&&(e.fadeIn.factor=0,le(i,Hy),e.fadeIn.stage=pd.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=$o.FINISHED),e.fadeIn.stage===pd.CHANGE_ANCHOR&&e.isCameraPositionFinal&&(_le(e.data)&&e.renderingStage!==dn.RENDERING||e.renderingStage===dn.FADING_TEXTURE_CHANNELS)&&(le(i,Hy),e.fadeIn.stage=pd.FADE_IN,e.startTime=t,e.renderingStage===dn.FADING_TEXTURE_CHANNELS&&(e.renderingStage=dn.SWITCH_CHANNELS)),e.fadeIn.factor<1&&e.fadeIn.stage===pd.FADE_IN?e.fadeIn.factor=r?_e((t-e.startTime)/(kDe*r),0,1):1:e.fadeIn.factor>=1&&e.fadeIn.stage===pd.FADE_IN&&(e.fadeIn.stage=pd.FINISHED,e.fadeIn.factor=1)}function Yft(e,t,r){const{fadeInOut:i,crossFade:s}=e;i.stage===$o.FINISHED&&(e.startTime=t,i.factor=1,i.stage=$o.FADE_OUT),i.factor>0&&i.stage===$o.FADE_OUT?i.factor=r?1-_e((t-e.startTime)/(emt*r),0,1):0:(i.factor<=0&&i.stage===$o.FADE_OUT&&(i.factor=0,le(e.parallax.anchorPointClouds,Hy)),i.factor<=0&&i.stage===$o.FADE_OUT&&e.isCameraPositionFinal&&(i.factor=0,i.stage=$o.SWITCH,e.crossFade.enabled=!1,s.factor=1),i.stage===$o.SWITCH&&(_le(e.data)&&e.renderingStage!==dn.RENDERING||e.renderingStage===dn.FADING_TEXTURE_CHANNELS)&&(e.startTime=t,i.factor=0,i.stage=$o.FADE_IN,le(e.parallax.anchorPointClouds,Hy),e.crossFade.enabled=!1,s.factor=1,e.renderingStage===dn.FADING_TEXTURE_CHANNELS&&(e.renderingStage=dn.SWITCH_CHANNELS)),i.factor<1&&i.stage===$o.FADE_IN?i.factor=r?_e((t-e.startTime)/(kDe*r),0,1):1:i.factor>=1&&i.stage===$o.FADE_IN&&(i.stage=$o.FINISHED,i.factor=1))}function Zft(e,t,r,i){const{crossFade:s}=e,n=e.parallax.anchorPointClouds;e.crossFade.enabled&&!i||(le(e.parallaxNew.anchorPointClouds,Hy),e.startTime=t,s.factor=0,e.crossFade.enabled=!0),s.factor<1&&e.crossFade.enabled?s.factor=r?_e((t-e.startTime)/(tmt*r),0,1):1:s.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,s.factor=1,le(n,e.parallaxNew.anchorPointClouds),e.renderingStage===dn.FADING_TEXTURE_CHANNELS&&(e.renderingStage=dn.SWITCH_CHANNELS))}function o0e(e,t,r,i){const s=e.fadeInOutHeight,n=s.stage===Mx.FINISHED?r:e.startTimeHeightFade;if(i!==0){const o=(r-n)/(rmt*i);s.factor+=t?-o:o}else s.factor=t?0:1;e.startTimeHeightFade=r,s.factor=_e(s.factor,0,1),s.stage=Mx.HEIGHT_FADE}function Jft(e,t,r,i,s){e.renderingStage===dn.FINISHED_RENDERING&&(e.renderingStage=dn.FADING_TEXTURE_CHANNELS);const n=Ie(t.eye);e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=n-Pr.radius>Vp?1:0),e.isCameraPositionFinal=wx(e.cameraPositionLastFrame,t.eye),xe(Hy,t.eye),de(Hy,Hy,Pr.radius);const o=e.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&le(o.anchorPointClouds,Hy);const a=Ie(ge(Qft,o.anchorPointClouds,Hy));let l=!0;a>e.fadeIn.distanceThresholdFactor*o.cloudsHeight||e.fadeIn.stage!==pd.FINISHED?Xft(e,i,s):a>e.fadeInOut.distanceThresholdFactor*o.cloudsHeight||e.fadeInOut.stage!==$o.FINISHED?Yft(e,i,s):a>e.crossFade.distanceThresholdFactor*o.cloudsHeight||e.crossFade.enabled||e.renderingStage===dn.FADING_TEXTURE_CHANNELS?Zft(e,i,s,(r!==Kn.IDLE||!_le(e.data))&&e.renderingStage!==dn.FADING_TEXTURE_CHANNELS):l=!1;const c=n-Pr.radius;if((c>1.7*Vp||c<-Vp)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(c>Vp||c<-.35*Vp)&&e.fadeInOutHeight.factor<1?o0e(e,!1,i,s):c<Vp&&c>-.35*Vp&&e.fadeInOutHeight.factor>0?o0e(e,!0,i,s):e.fadeInOutHeight.stage=Mx.FINISHED,e.renderingStage===dn.SWITCH_CHANNELS&&(e.readChannels=1-e.readChannels,e.renderingStage=dn.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-Pr.radius*Pr.radius,0))/n,i0e(a0e,o.anchorPointClouds,kC),Sd(o.transform,Hn,kC[3],kC),l){const{parallaxNew:d}=e;i0e(a0e,d.anchorPointClouds,kC),Sd(d.transform,Hn,kC[3],kC)}le(e.cameraPositionLastFrame,t.eye)}function Kft(e){return e.crossFade.enabled||e.fadeInOut.stage!==$o.FINISHED||e.fadeIn.stage!==pd.FINISHED||e.fadeInOutHeight.stage!==Mx.FINISHED||e.renderingStage!==dn.FINISHED}const a0e=Fe(0,0,1),kC=u4(),Hy=$(),Qft=$(),kDe=1,emt=.5,tmt=1.3,rmt=1;var GM;(function(e){e[e.Immediate=0]="Immediate",e[e.Faded=1]="Faded"})(GM||(GM={}));var pO;const imt=[Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE,Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let bl=pO=class extends be{constructor(e){super(e),this._handles=new hr,this._context=null,this._atmosphere=null,this._oldWeatherParameters=new MW,this._newWeatherParameters=new MW,this._fadedWeatherParameters=new MW,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(imt,this)}destroy(){var e;((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._handles=Qe(this._handles),this._set("view",null)}get atmosphereType(){return v(this._atmosphere)?this._atmosphere.type:$a.None}get canRender(){var e;return!!((e=this.view.basemapTerrain)!=null&&e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return v(this._atmosphere)&&this._atmosphere.type===$a.Realistic}updateAnimation(e){return!!v(this._precipitation)&&this._precipitation.update(e)}get updating(){return v(this._stars)&&this._stars.updating||v(this._clouds)&&this._clouds.running}get weatherVisible(){return Ie(this.view.state.camera.eye)-Kr(this.view.spatialReference).radius<=Vp}get _stars(){var i,s;const e=this.view,t=(s=(i=e.environment)==null?void 0:i.starsEnabled)!=null?s:!1,r=this._get("_stars");return!t||C(this._context)?(Qe(r),null):v(r)?r:new jb({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||C(this._context))return Qe(e),null;const t=this.view,r=this._context;return v(e)&&e.context===r?e:(Qe(e),new FS({context:r,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||C(this._context))return Qe(e),null;if(v(e))return e;const t=this.view,r=this._context;return Qe(e),new tu({context:r,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||C(this._context))return Qe(e),null;const t=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Kr(this.view.spatialReference).radius;return v(e)&&e.viewingMode===t&&e.planetRadius===i?e:(Qe(e),new NS({rctx:r,viewingMode:t,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||C(this._context))return Qe(e),null;if(v(e))return e;const t=this.view,r=this._context;return new F$({context:r,view:t})}get _simpleHaze(){const e=this._get("_simpleHaze");if(!this.weatherEnabled||C(this._context))return Qe(e),null;if(v(e))return e;const t=this.view,r=this._context;return new k$({context:r,view:t})}get weatherEnabled(){var e,t;return!!((t=(e=this.view)==null?void 0:e.environmentManager)!=null&&t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e;const t=()=>this._setNeedsRender();this._handles.add([no(()=>{var r;return(r=this.view)==null?void 0:r.basemapTerrain},()=>this._updateBasemapTerrain(),Qi),ie(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),Qi),ie(()=>this._stars,t),ie(()=>this._precipitation,t),ie(()=>this._clouds,()=>this._updateWeather(),pt),ie(()=>this._fog,()=>this._updateFogHaze(),pt),ie(()=>this._simpleHaze,()=>this._updateFogHaze(),pt),ie(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Qi)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Qe(this._atmosphere),this._set("_stars",Qe(this._stars)),this._set("_precipitation",Qe(this._precipitation)),this._set("_clouds",Qe(this._clouds)),this._set("_cloudsComposition",Qe(this._cloudsComposition)),this._set("_fog",Qe(this._fog)),this._set("_simpleHaze",Qe(this._simpleHaze))}prepareRender(e){e.bindParameters.cloudsFade.data=dpt(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&(Jft(e.bindParameters.cloudsFade,e.bindParameters.camera,this.view.state.mode,pO.test.time||e.time,this.view.qualitySettings.weatherFadeDuration),this._updateWeatherFading(e.bindParameters),e.bindParameters.cloudsFade.renderingStage===dn.FINISHED&&v(this._clouds)&&this._clouds.coverage===0&&this._clouds.running===!1&&this._clouds.destroyFrameBufferCube())}render(e){if(e.output===V.Color)switch(e.bindParameters.slot){case Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE:v(this._stars)&&this._stars.render(e),v(this._atmosphere)&&(this._atmosphere.render(e),v(this._cloudsComposition)&&v(e.bindParameters.cloudsFade.data)&&(this.weatherVisible&&v(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(e)),Kft(e.bindParameters.cloudsFade)&&v(this._context)&&this._context.requestRender());break;case Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(v(this._atmosphere)&&(this._atmosphere.renderHaze(e,this._weatherParameters.haze.amount),this._weatherParameters.haze.amount>0&&this._selectAtmosphereType()!==$a.Realistic&&v(this._simpleHaze)&&this._simpleHaze.render(e,this._weatherParameters.haze),this._weatherParameters.fog.amount>0&&v(this._fog)&&this._fog.render(e,this._weatherParameters.fog),v(this._precipitation))){const t=this.view.environment.weather;t.type!=="rainy"&&t.type!=="snowy"||this._precipitation.render(e,t.precipitation,t.type)}}}updateLightSources(e,t,r,i){if(v(this._context)){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=t,s.bindParameters.newLighting.globalFactor=r,s.bindParameters.newLighting.set(e),i===GM.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return C(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeatherFading(e){if(!e.weatherFading)return;const t=e.cloudsFade;return t.fadeIn.stage===pd.FADE_IN?(e.fadeLighting(t.fadeIn.factor),void this._fadeWeather(t.fadeIn.factor)):t.fadeInOut.stage===$o.FADE_IN?(e.fadeLighting(t.fadeInOut.factor),void this._fadeWeather(t.fadeInOut.factor)):t.crossFade.enabled?(e.fadeLighting(t.crossFade.factor),void this._fadeWeather(t.crossFade.factor)):(e.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(e){const{_newWeatherParameters:t,_oldWeatherParameters:r}=this;e>=1?this._weatherParameters=t:(this._fadedWeatherParameters.lerp(r,t,e),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const e=this._weatherUpdateParameters;C(e)||C(this._clouds)||(this._clouds.applyPreset(Sl[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){v(this._context)&&this._context.requestRender()}_updateFogHaze(){const e=this._weatherUpdateParameters;if(C(this._fog)||C(this._simpleHaze)||C(e)||C(this._context))return;const t=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),e.type){case"foggy":this._newWeatherParameters.fog.strength=Ft(3e-5,.005,e.weatherAdjustment**3),le(this._newWeatherParameters.fog.color,l0e),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._selectAtmosphereType()===$a.Realistic?1:0,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Ft(4e-6,2e-4,e.effect**3),le(this._newWeatherParameters.fog.color,smt),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Ft(4e-6,2e-4,e.effect**3),le(this._newWeatherParameters.fog.color,l0e),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.haze.strength=0,this._newWeatherParameters.haze.amount=this._selectAtmosphereType()===$a.Realistic?1:0,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.haze.strength=4e-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}t.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;const t=this._getAtmosphereClass();if(!t)return v(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();v(this._context)&&(Qe(this._atmosphere),this._atmosphere=new t(this.view),this._atmosphere.initializeRenderContext(this._context),this._setNeedsRender(),this._updateBasemapTerrain())}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case $a.None:return null;case $a.Realistic:return Oye;case $a.Panoramic:return vft;case $a.Simple:return $ft;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),r=this.view.viewingMode;return!e||t==null||P0(this.view.spatialReference)?$a.None:r==="local"?$a.Panoramic:t==="high"&&v(this._context)&&Oye.isSupported(this._context)&&eN(this.view.spatialReference)?$a.Realistic:$a.Simple}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=v(this._atmosphere)&&this.atmosphereType===$a.Simple)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{c0e=pO.prototype._getAtmosphereClass,pO.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{pO.prototype._getAtmosphereClass=c0e}}}};bl.test={time:0},u([h({constructOnly:!0})],bl.prototype,"view",void 0),u([h({type:Boolean,readOnly:!0})],bl.prototype,"updating",null),u([h({readOnly:!0})],bl.prototype,"weatherVisible",null),u([h()],bl.prototype,"_context",void 0),u([h({readOnly:!0})],bl.prototype,"_stars",null),u([h({readOnly:!0})],bl.prototype,"_precipitation",null),u([h({readOnly:!0})],bl.prototype,"_clouds",null),u([h({readOnly:!0})],bl.prototype,"_cloudsComposition",null),u([h({readOnly:!0})],bl.prototype,"_fog",null),u([h({readOnly:!0})],bl.prototype,"_simpleHaze",null),u([h({readOnly:!0})],bl.prototype,"weatherEnabled",null),u([h({readOnly:!0})],bl.prototype,"_precipitationEnabled",null),u([h({readOnly:!0})],bl.prototype,"_weatherUpdateParameters",null),bl=pO=u([I("esri.views.3d.environment.EnvironmentRenderer")],bl);class MW{constructor(){this.fog=new Xpt,this.haze=new Fft}copyFrom(t){this.fog.amount=t.fog.amount,this.haze.amount=t.haze.amount,this.fog.strength=t.fog.strength,this.haze.strength=t.haze.strength,le(this.fog.color,t.fog.color)}lerp(t,r,i){this.fog.amount=Ft(t.fog.amount,r.fog.amount,i),this.haze.amount=Ft(t.haze.amount,r.haze.amount,i),this.fog.strength=Ft(t.fog.strength,r.fog.strength,i),this.haze.strength=Ft(t.haze.strength,r.haze.strength,i),$n(this.fog.color,t.fog.color,r.fog.color,i)}}const smt=Fe(.5,.5,.5),l0e=Fe(1.5,1.5,1.5);let c0e;function u0e(e,t,r){if(C(t.longitude)||C(t.latitude)||C(r.longitude)||C(r.latitude))throw new Error("Invalid points: no lon/lat");return nmt(e,t.longitude,t.latitude,r.longitude,r.latitude)}function nmt(e,t,r,i,s){const n=Zt(r),o=Zt(s),a=n-o,l=Zt(t)-Zt(i),c=Math.sin(a/2),d=Math.sin(l/2),p=2*vf(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*d*d))*e;return Math.round(1e4*p)/1e4}function omt(e,t,r){const i=t.spatialReference,s=Kr(i),n=new lt(t.x,e.y,i),o=new lt(r.x,e.y,i),a=new lt(e.x,t.y,i),l=new lt(e.x,r.y,i);return{lon:u0e(s.radius,n,o),lat:u0e(s.radius,a,l)}}function amt(e,t,r){const i=t/r,s=Zt(e),n=Math.sin(i/2),o=Math.cos(s),a=2*vf(Math.sqrt(n*n/(o*o)));return Lc(a)}function lmt(e,t){let r=e/15;return t||(r=Math.round(r)),r}function Kte(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=lmt(e[0],!0);const r=t.hours%1;t.hours-=r,t.minutes=60*r;const i=t.minutes%1;return t.minutes-=i,t.seconds=Math.round(60*i),t}var d0e,h0e,p0e,UDe={exports:{}};d0e=UDe,h0e=function(){var e=Math.PI,t=Math.sin,r=Math.cos,i=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,d=2451545,p={dec:0,ra:0};function f(F){return F.valueOf()/l-.5+c}function m(F){return new Date((F+.5-c)*l)}function g(F){return f(F)-d}var _=23.4397*a;function x(F,N){return n(t(F)*r(_)-i(N)*t(_),r(F))}function b(F,N){return s(t(N)*r(_)+r(N)*t(_)*t(F))}function w(F,N,B){return n(t(F),r(F)*t(N)-i(B)*r(N))}function T(F,N,B){return s(t(N)*t(B)+r(N)*r(B)*r(F))}function E(F,N){return a*(280.16+360.9856235*F)-N}function O(F){return a*(357.5291+.98560028*F)}function A(F){return a*(1.9148*t(F)+.02*t(2*F)+3e-4*t(3*F))}function R(F,N){return F+N+102.9372*a+e}function D(F,N){var B=O(F),H=R(B,A(B));return N||(N={dec:0,ra:0}),N.dec=b(H,0),N.ra=x(H,0),N}var k={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(F,N,B,H){var W=a*-B,K=a*N,Y=g(F),ce=D(Y,p),we=E(Y,W)-ce.ra;return H||(H={azimuth:0,altitude:0}),H.azimuth=w(we,K,ce.dec),H.altitude=T(we,K,ce.dec),H}},L=[[-.83,"sunrise","sunset"]];k.addTime=function(F,N,B){L.push([F,N,B])};var q=9e-4;function G(F,N){return Math.round(F-q-N/(2*e))}function J(F,N,B){return q+(F+N)/(2*e)+B}function ee(F,N,B){return d+F+.0053*t(N)-.0069*t(2*B)}function se(F,N,B){return o((t(F)-t(N)*t(B))/(r(N)*r(B)))}function X(F){var N=a*(134.963+13.064993*F),B=a*(93.272+13.22935*F),H=a*(218.316+13.176396*F)+6.289*a*t(N),W=5.128*a*t(B),K=385001-20905*r(N);return{ra:x(H,W),dec:b(H,W),dist:K}}return k.getTimes=function(F,N,B){var H=a*-B,W=a*N,K=G(g(F),H),Y=J(0,H,K),ce=O(Y),we=A(ce),Oe=R(ce,we),Be=b(Oe,0),He=ee(Y,ce,Oe);function Se(rr){return ee(J(se(rr,W,Be),H,K),ce,Oe)}function he(rr){var yr=(t(rr)-t(W)*t(Be))/(r(W)*r(Be));return yr<-1?k.PolarException.MIDNIGHT_SUN:yr>1?k.PolarException.POLAR_NIGHT:k.PolarException.NORMAL}var Me,Xt,Er,Cr,bt,ht={solarNoon:m(He),nadir:m(He-.5),polarException:k.PolarException.NORMAL};for(Me=0,Xt=L.length;Me<Xt;Me+=1)bt=He-((Cr=Se((Er=L[Me])[0]*a))-He),ht[Er[1]]=m(bt),ht[Er[2]]=m(Cr);return ht.polarException=he(L[0][0]*a),ht},k.getMoonPosition=function(F,N,B){var H=a*-B,W=a*N,K=g(F),Y=X(K),ce=E(K,H)-Y.ra,we=T(ce,W,Y.dec);return we+=.017*a/i(we+10.26*a/(we+5.1*a)),{azimuth:w(ce,W,Y.dec),altitude:we,distance:Y.dist}},k.getMoonFraction=function(F){var N=g(F),B=D(N),H=X(N),W=149598e3,K=o(t(B.dec)*t(H.dec)+r(B.dec)*r(H.dec)*r(B.ra-H.ra)),Y=n(W*t(K),H.dist-W*r(K));return(1+r(Y))/2},k},(p0e=h0e())!==void 0&&(d0e.exports=p0e);const Lx=UDe.exports,Fy={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function cmt(e,t,r,i,s,n){ue(n.ambient.color,1,1,1),n.ambient.intensity=Fy.global.ambient,ue(n.direct.color,1,1,1),n.direct.intensity=Fy.global.direct;const o=t[2],a=_e((Math.abs(o)-Fy.local.altitude)/(Fy.global.altitude-Fy.local.altitude),0,1);let l;if(n.globalFactor=a,v(e)&&(l=Lx.getTimes(e,t[1],t[0])),a<1){let c;if(v(e))c=gmt(e,l,i);else{const d=VDe(i);c={direct:{intensity:Fy.local.directAtNoon*d.direct,color:Fe(1,1,1)},ambient:{intensity:Fy.local.ambientAtNoon*d.ambient,color:Fe(1,1,1)},timeOfDay:"early afternoon"}}$n(n.ambient.color,c.ambient.color,n.ambient.color,a),n.ambient.intensity=Ft(c.ambient.intensity,n.ambient.intensity,a),$n(n.direct.color,c.direct.color,n.direct.color,a),n.direct.intensity=Ft(c.direct.intensity,n.direct.intensity,a),n.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,n.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}n.noonFactor=v(e)?mmt(e,l):1,v(e)?umt(e,t,r,n.direct.directionToLightSource):BDe(s,r,n.direct.directionToLightSource)}function BDe(e,t,r){t===Ye.Global?xe(RW,e.eye):ue(RW,0,0,1),de(IW,e.viewForward,-1);const i=xB(IW,RW),s=Math.max(i-2*PW,0),n=.85*s/(s+1),o=Math.max(PW,i-PW-n);Kh(m0e,-o,e.viewRight),je(r,IW,m0e),ye(r,r,de(ymt,e.viewRight,_mt)),xe(r,r)}function umt(e,t,r,i){const s=fmt,n=fg(pmt);if(r===Ye.Global)Lx.getPosition(e,0,0,s),ue(i,0,0,-1),$R(n,n,-s.azimuth),Mj(n,n,-s.altitude),je(i,i,n);else{const o=Fy.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=_e(c,0,1),c<1?(Lx.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),ue(i,0,-1,0),DR(n,n,-s.azimuth),$R(n,n,-s.altitude),je(i,i,n)}}function dmt(e,t){if(t===Ye.Global)return!0;const r=Fy.planarDirection;return Math.abs(e)<r.localAltitude}const hmt=Fe(.5773502691896258,-.5773502691896258,.5773502691896258);class zDe{constructor(){this.ambient={color:Fe(1,1,1),intensity:.55},this.direct={color:Fe(1,1,1),intensity:.55,directionToLightSource:ws(hmt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const pmt=$e(),fmt={azimuth:0,altitude:0};function mmt(e,t){const r=e.valueOf();let i,s;t.polarException===Lx.PolarException.MIDNIGHT_SUN?(i=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=i+432e6):t.polarException===Lx.PolarException.POLAR_NIGHT?(i=r-2,s=r-1):(i=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=i+(s-i)/2;return 1-_e(Math.abs(r-n)/432e5,0,1)}function VDe(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function f0e(e,t){const r=(e[0]+e[1]+e[2])/3;for(let i=0;i<3;i++)e[i]=e[i]+(r-e[i])*t;return e}function gmt(e,t,r){const i=e.valueOf();let s,n;t.polarException===Lx.PolarException.MIDNIGHT_SUN?(s=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===Lx.PolarException.POLAR_NIGHT?(s=i-2,n=i-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,d=a+l,p=.06*o,f=s-p/2,m=s+p/2,g=n-p/2,_=n+p/2,x=Fy.local,b=[.01,x.ambientAtNight],w=[.8,.8,1],T=[.01,.01,.01],E=[x.directAtTwilight,x.ambientAtTwilight],O=[1,.6,.5],A=[.8,.8,1],R=[.9*x.directAtNoon,x.ambientAtNoon],D=[1,.98,.98],k=[.98,.98,1],L=[x.directAtNoon,x.ambientAtNoon],q=[1,1,1],G=[1,1,1],J=R,ee=D,se=k,X=E,F=O,N=A;let B,H,W=[0,0],K=[0,0,0],Y=[0,0,0];i<f||i>_?(W=b,K=T,Y=w,H="night"):i<m?(B=m-f,W=Ja(i-f,B,b,E),K=Ja(i-f,B,T,O),Y=Ja(i-f,B,w,A),H="sun rising"):i<c?(B=c-m,W=Ja(i-m,B,E,R),K=Ja(i-m,B,O,D),Y=Ja(i-m,B,A,k),H="early morning"):i<a?(B=a-c,W=Ja(i-c,B,R,L),K=Ja(i-c,B,D,q),Y=Ja(i-c,B,k,G),H="late morning"):i<d?(B=d-a,W=Ja(i-a,B,L,J),K=Ja(i-a,B,q,ee),Y=Ja(i-a,B,G,se),H="early afternoon"):i<g?(B=g-d,W=Ja(i-d,B,J,X),K=Ja(i-d,B,ee,F),Y=Ja(i-d,B,se,N),H="late afternoon"):i<_&&(B=_-g,W=Ja(i-g,B,X,b),K=Ja(i-g,B,F,T),Y=Ja(i-g,B,N,w),H="sun setting");let ce=0;switch(r){case"rainy":case"foggy":ce=.9;case"snowy":ce=.5}ce>0&&(K=f0e(K,ce),Y=f0e(Y,ce));const we=Fe(K[0],K[1],K[2]),Oe=Fe(Y[0],Y[1],Y[2]),Be=VDe(r);return{direct:{intensity:W[0]*Be.direct,color:we},ambient:{intensity:W[1]*Be.ambient,color:Oe},timeOfDay:H}}function Ja(e,t,r,i){const s=[];for(let n=0;n<r.length;n++)s[n]=(i[n]-r[n])*e/t+r[n];return s}const m0e=$e(),RW=$(),IW=$(),ymt=$(),PW=.25,_mt=.2;let hm=class extends $s.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new hr,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new pV,this._ambientLight=new vle,this._moonLight=new bDe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,t,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(t=this._view)==null?void 0:t.state)==null?void 0:r.viewingMode)===Ye.Global&&eN(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new bl({view:e});const t=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this._viewHandles.add([ie(()=>e.environment.lighting,i=>this._updateLightingHandler(i),bi),ie(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,i=>this._lightingDateHandler(i),bi),ie(()=>e.stationary,()=>this._interactingStationaryHandler()),ie(()=>e.environment.lighting.directShadowsEnabled,t,bi),ie(()=>e.environment.lighting.ambientOcclusionEnabled,t,bi),ie(()=>e.environment.lighting.waterReflectionEnabled,t,bi),ie(()=>{var i;return(i=e.environment.background)==null?void 0:i.color},t,bi),ie(()=>e.spatialReference,()=>this._resetReferencePosition(!0),bi),ie(()=>e.environment.weather.type,()=>this._updateLighting(null,GM.Faded),bi),ie(()=>this.weatherEnabled,()=>this._updateLighting(null,GM.Faded),bi),ie(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Qi),ie(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,i=>this._updateCameraTracking(i),Qi),ie(()=>e.state.camera,r,Qi),ie(()=>this.disableQueries,r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Qe(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)!=="virtual"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!wE(r)){const i=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(i))return void this._requestReferencePositionUpdate(i)}if(this._preupdateTracking(e),v(this._referencePosWGS84Comparable)){const i=Kte(this._referencePosWGS84Comparable,g0e);v(i)&&(t.autoUpdate(null,i),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const r=t.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,t){const r=eN(this._view.spatialReference);if(r&&!wE(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const i=e.position;return C(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=$()),r?Mit(i,this._referencePosWGS84Comparable):ue(this._referencePosWGS84Comparable,i.longitude,i.latitude,i.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,t=GM.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const i=this._referencePosWGS84Comparable,s=v(i)?vmt:bmt,n=this.weatherVisible?r.environment.weather.type:"disabled";v(i)?cmt(e,i,r.state.viewingMode,n,r.state.camera,s):r.environment.lighting.type==="virtual"&&BDe(r.state.camera,r.state.viewingMode,s.direct.directionToLightSource);const o=this._mainLight,a=s.direct;de(o.intensity,a.color,a.intensity*Math.PI),le(o.direction,a.directionToLightSource),o.specularStrength=s.specularStrength,o.environmentStrength=s.environmentStrength;const l=this._ambientLight;de(l.intensity,s.ambient.color,s.ambient.intensity);const c=this._moonLight;$n(c.intensity,xmt,Tmt,s.globalFactor);const d=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));de(c.intensity,c.intensity,d),le(c.direction,a.directionToLightSource),this._renderer.updateLightSources([o,l,c],s.noonFactor,s.globalFactor,t),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||C(e))return!1;const r=wmt;r.setTime((t||this._view.environment.lighting.date).getTime());const i=Kte(e,g0e);if(C(i))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===i.hours&&s.minutes===i.minutes&&s.seconds===i.seconds)return!1}else s=i;const n=r.getUTCHours()-(i.hours-s.hours),o=r.getUTCMinutes()-(i.minutes-s.minutes),a=r.getUTCSeconds()-(i.seconds-s.seconds);return r.setUTCHours(n),r.setUTCMinutes(o),r.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(r,i)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=Ch(this._referencePosWGS84Comparable,!0,s=>dmt(s[2],this._view.state.viewingMode)),r=this._view.environment.background,i=r instanceof U$e?{type:"color",color:Noe(Ze.toUnitRGBA(r.color))}:{type:"color",color:ar(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=yx(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const s=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),i=this._referencePosUpdateTimer=yx(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===i&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const r=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[t[0],t[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};u([h({type:Boolean,readOnly:!0})],hm.prototype,"updating",null),u([h()],hm.prototype,"disableQueries",void 0),u([h()],hm.prototype,"_disableWeather",void 0),u([h()],hm.prototype,"weatherEnabled",null),u([h()],hm.prototype,"weatherVisible",null),u([h()],hm.prototype,"referencePositionWGS84Comparable",null),u([h()],hm.prototype,"_renderer",void 0),u([h()],hm.prototype,"_referencePosWGS84Comparable",void 0),hm=u([I("esri.views.3d.environment.SceneViewEnvironmentManager")],hm);const vmt=new zDe,bmt=new zDe,wmt=new Date,g0e={hours:0,minutes:0,seconds:0},xmt=Fe(.22,.22,.33),Tmt=Fe(.22,.22,.22);var hs;(function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(hs||(hs={}));var fr;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(fr||(fr={}));var pa;(function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"})(pa||(pa={}));function HN(e,t){return(e&t)!=0}function _V(e,t,r,i,s,n){e!==0&&(r?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):i!=null?(n.min-=Math.max(0,(t-n.min)*(1-i)),n.max+=Math.max(0,(t-n.max)*(1-i))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}const Nx={selection:hs.NONE,interactionType:fr.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:pa.TUMBLE};function jDe(e,t,r,i){return t=t||e.viewForward,le(i,t),de(i,i,Math.sign(Te(t,r))),i}function Smt(e,t,r,i){return Mmt(e,t,r,Amt(i,t,r,!0))}function Emt(e,t,r,i){const s=Te(r,ge(e,i,t));return ye(e,t,de(e,r,s))}const Cmt={dir:$(),len:0,clip:rt()};function Amt(e,t,r,i){const s=Cmt;return e?(r&&i&&(s.len=Ni(t,r)),le(s.dir,e)):i?(s.len=Ni(t,r),ge(s.dir,r,t),de(s.dir,s.dir,1/s.len)):(ge(s.dir,r,t),xe(s.dir,s.dir)),s}function Omt(e,t,r){const i=Te(e,r.dir),s=-Hi(e,t);if(s<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return s>0;if((s<0||i<0)&&!(s<0&&i<0))return!0;const n=s/i;return i>0?n<r.clip[1]&&(r.clip[1]=n):n>r.clip[0]&&(r.clip[0]=n),r.clip[0]<=r.clip[1]}function Mmt(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!Omt(e[s],t,i))return!1;return!0}function Rmt(e,t,r=Nx){const i=Ole(e,t,r);if(i===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+i,o=jDe(t,r.interactionDirection,$mt(e,t,Math.sign(i),Fmt),Nmt),a=le(kmt,t.viewForward),l=s.intersectInfiniteManifold(ep(t.eye,o),n,$W);return t.eye=v(l)?l:s.setAltitude($W,n,t.eye),t.center=Emt($W,t.eye,a,t.center),!0}function Ole(e,t,r=Nx){if(!Imt(e,r))return 0;const i=Dmt(e.state.constraints.altitude,Lmt);Pmt(e,r,i);const s=e.renderCoordsHelper.getAltitude(t.eye),n=_e(s,i.min,i.max)-s;return Math.abs(n)<=1e-6?0:n}function Imt(e,t){const r=e.state.constraints.altitude;return!(!e.state.isGlobal||!r)&&(t.interactionType!==fr.TUMBLE||!HN(t.selection,hs.TILT))}function Pmt(e,t,r){const i=t.interactionType;if(i===fr.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=t,l=i===fr.TUMBLE||i===fr.ZOOM,c=Ole(e,o),d=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);r.min=s,r.max=n,_V(c,d,l,a,.05*d,r)}function $mt(e,t,r,i){return e.renderCoordsHelper.worldUpAtPosition(t.eye,i),de(i,i,r),i}function Dmt(e,t){return t.min=e.min,t.max=e.max,t}const Lmt={min:0,max:0},Nmt=$(),Fmt=$(),kmt=$(),$W=$();function Mle(e,t,r=Nx){if(!e.state.isLocal)return 0;const i=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;dk.min=0,dk.max=i,Bmt(e,r,dk);const s=Rle(e,t),n=dk.max-s;return n>=-1e-6?0:n}function Umt(e,t,r=Nx){const i=Mle(e,t,r);if(i===0)return!1;const s=e.pointsOfInterest.surfaceOrigin,n=Rle(e,t)+i,o=le(Vmt,t.eye),a=jDe(t,r.interactionDirection,zmt(e,t,Hmt),Gmt);if(!Qx(IPe(s.renderLocation,n),ep(t.eye,a),hk))return!1;t.eye=hk;const l=ge(jmt,t.eye,o);t.center=ye(hk,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),d=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,hk);return v(d)&&(t.center=d),!0}function Bmt(e,t,r){const i=t.interactionType;if(i===fr.NONE)return;const{min:s,max:n}=r,{interactionStartCamera:o,interactionFactor:a}=t,l=i===fr.ZOOM||i===fr.PAN,c=Mle(e,o),d=c===0?0:Rle(e,o);r.min=s,r.max=n,_V(c,d,l,a,.05*d,r)}function Rle(e,t){const r=e.pointsOfInterest.surfaceOrigin;return Ni(t.eye,r.renderLocation)}function zmt(e,t,r){const i=e.pointsOfInterest.surfaceOrigin;return n1(r,t.eye,i.renderLocation)}const dk={min:0,max:0},Vmt=$(),jmt=$(),Gmt=$(),Hmt=$(),hk=$();var zs,qa;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(zs||(zs={}));class qmt{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=qa.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(qa||(qa={}));function B0(e){return v(e)&&v(e.dist)}function y0e(e){return(t,r,i)=>($n(_0e,t,r,i),!Dae(e,_0e))}function v7(e){return B0(e)&&e.intersector===zs.OBJECT&&!!e.target}function b7(e){return B0(e)&&e.intersector===zs.HUD&&!!e.target&&v(e.target.center)}const _0e=$();class Wmt{constructor(){this._transform=$e(),this._transformInverse=new pk({value:this._transform},Pn,$e),this._transformInverseTranspose=new pk(this._transformInverse,Iu,$e),this._transformTranspose=new pk({value:this._transform},Iu,$e),this._transformInverseRotation=new pk({value:this._transform},GIe,Ts)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){jn(this._transform,t)}multiplyTransform(t){Hs(this._transform,this._transform,t)}set(t){jn(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,r){this.setTransformMatrix(t),this.multiplyTransform(r),this._invalidateLazyTransforms()}}class pk{constructor(t,r,i){this._original=t,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}class Xmt{constructor(t=0){this.offset=t,this.tmpVertex=$()}applyToVertex(t,r,i){const s=t+this.localOrigin[0],n=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=r+n*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)V1[n]=t[0+n]+this.localOrigin[n],fk[n]=t[3+n]+this.localOrigin[n],UC[n]=V1[n];const r=this.applyToVertex(V1[0],V1[1],V1[2]);for(let n=0;n<3;++n)t[n]=r[n],t[n+3]=r[n];const i=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a+0]=Math.min(t[a+0],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)UC[o]=(n&1<<o)==0?V1[o]:fk[o];i(UC)}let s=0;for(let n=0;n<3;++n)V1[n]*fk[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)s[o]?UC[o]=0:UC[o]=(n&1<<o)!=0?V1[o]:fk[o];i(UC)}}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const V1=$(),fk=$(),UC=$();class Ymt{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=$(),this._mbs=qo(),this._obb={center:$(),halfSize:Ki(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,r,i){const s=t,n=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=t+s*a,this._tmpVertex[1]=r+n*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(t){const r=t[0],i=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=r*n<0?0:Math.min(Math.abs(r),Math.abs(n)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),d=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+d*d);if(p<this._totalOffset)return t[0]-=r<0?this._totalOffset:0,t[1]-=i<0?this._totalOffset:0,t[2]-=s<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=o>0?this._totalOffset:0,t[5]+=a>0?this._totalOffset:0,t;const f=Math.max(Math.abs(r),Math.abs(n)),m=Math.max(Math.abs(i),Math.abs(o)),g=Math.max(Math.abs(s),Math.abs(a)),_=Math.sqrt(f*f+m*m+g*g),x=this._totalOffset/_,b=this._totalOffset/p;return t[0]+=r*(r>0?x:b),t[1]+=i*(i>0?x:b),t[2]+=s*(s>0?x:b),t[3]+=n*(n<0?x:b),t[4]+=o*(o<0?x:b),t[5]+=a*(a<0?x:b),t}applyToMbs(t){const r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this._totalOffset/r;return this._mbs[0]=t[0]+t[0]*i,this._mbs[1]=t[1]+t[1]*i,this._mbs[2]=t[2]+t[2]*i,this._mbs[3]=t[3]+t[3]*this._totalOffset/r,this._mbs}applyToObb(t){const r=t.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,Vh(this._obb.halfSize,t.halfSize,t.quaternion),ye(this._obb.halfSize,this._obb.halfSize,t.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,ge(this._obb.halfSize,this._obb.halfSize,t.center),Yv(x0e,t.quaternion),Vh(this._obb.halfSize,this._obb.halfSize,x0e),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class Zmt{constructor(t=0){this.offset=t,this.sphere=qo(),this.tmpVertex=$()}applyToVertex(t,r,i){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*r+s[8]*i+s[12],o=s[1]*t+s[5]*r+s[9]*i+s[13],a=s[2]*t+s[6]*r+s[10]*i+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,r){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const s=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*s,r[1]+=r[1]*s,r[2]+=r[2]*s}applyToAabb(t){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const i=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*i,t[4]+=t[4]*i,t[5]+=t[5]*i,t}applyToBoundingSphere(t){const r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/r;return this.sphere[0]=t[0]+t[0]*i,this.sphere[1]=t[1]+t[1]*i,this.sphere[2]=t[2]+t[2]*i,this.sphere[3]=t[3]+t[3]*this.offset/r,this.sphere}}const v0e=new Zmt;function Qte(e){return v(e)?(v0e.offset=e,v0e):null}const b0e=new Ymt;function Jmt(e){return v(e)?(b0e.offset=e,b0e):null}const w0e=new Xmt;function Kmt(e){return v(e)?(w0e.offset=e,w0e):null}const Um="terrain",x0e=wg();function ere(e,t,r){for(let i=0;i<r;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}function Qmt(e,t){const r=e.length;for(let i=0;i<r;++i)tM[0]=e[i],t[i]=tM[0];return t}function egt(e,t){const r=e.length;for(let i=0;i<r;++i)tM[0]=e[i],tM[1]=e[i]-tM[0],t[i]=tM[1];return t}const tM=new Float32Array(2);function tre(e,t){return C(e)&&(e=[]),e.push(t),e}function rre(e,t){if(C(e))return null;const r=e.filter(i=>i!==t);return r.length===0?null:r}function d4(e){return!!v(e)&&!e.visible}function tgt(e,t,r){const i=e.origin.vec3;IDe(DW,-i[0],-i[1],-i[2]),v(e.transformation)?Hs(t,DW,e.transformation):jn(t,DW),Pn(r,t),Iu(r,r)}function rgt(e,t,r,i,s){mk[0]=e.get(t,0),mk[1]=e.get(t,1),mk[2]=e.get(t,2),ere(mk,mT,3),r.set(s,0,mT[0]),i.set(s,0,mT[1]),r.set(s,1,mT[2]),i.set(s,1,mT[3]),r.set(s,2,mT[4]),i.set(s,2,mT[5])}const mk=new Float64Array(3),mT=new Float32Array(6),DW=$e(),rI=1e-5;class igt{constructor(t){this.options=new qmt,this._results=new sgt,this.transform=new Wmt,this.tolerance=rI,this.verticalOffset=null,this._ray=ca(),this._rayEnd=$(),this._rayBeginTransformed=$(),this._rayEndTransformed=$(),this.viewingMode=t!=null?t:Ye.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,r,i){this.resetWithRay(mnt(t,r,this._ray),i)}resetWithRay(t,r){this.camera=r,t!==this._ray&&eV(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ye.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,ye(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,r,i,s,n){this.point=r,this.filterPredicate=s,this.tolerance=i!=null?i:rI;const o=Qte(this.verticalOffset);if(v(t)&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();v(c)?(v(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(d=>a(d))}}this.sortResults()}intersectObject(t){const r=t.geometryRecords;if(!r)return;const i=t.transformation,s=Qte(this.verticalOffset);for(const n of r){const{geometry:o,material:a,instanceParameters:l}=n;if(d4(l))continue;const c=o.id;this.transform.setAndInvalidateLazyTransforms(i,n.getShaderTransformation()),je(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),je(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const d=this.transform.transform;v(s)&&(s.objectTransform=this.transform),a.intersect(o,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(p,f,m,g,_,x)=>{if(p>=0){if(v(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,p))return;const b=g?this._results.hud:this._results,w=g?T=>{const E={object:t,geometryId:c,triangleNr:m,center:v(x)?[x[0],x[1],x[2]]:null};T.set(zs.HUD,E,p,f,Hn,_)}:T=>T.set(zs.OBJECT,{object:t,geometryId:c,triangleNr:m},p,f,d,_);if((b.min.drapedLayerOrder==null||_>=b.min.drapedLayerOrder)&&(b.min.dist==null||p<b.min.dist)&&w(b.min),this.options.store!==qa.MIN&&(b.max.drapedLayerOrder==null||_<b.max.drapedLayerOrder)&&(b.max.dist==null||p>b.max.dist)&&w(b.max),this.options.store===qa.ALL)if(g){const T=new ire(this._ray);w(T),this._results.hud.all.push(T)}else{const T=new HM(this._ray);w(T),this._results.all.push(T)}}},n.shaderTransformation)}}sortResults(t=this._results.all){t.sort((r,i)=>r.dist!==i.dist?yt(r.dist,0)-yt(i.dist,0):r.drapedLayerOrder!==i.drapedLayerOrder?yt(r.drapedLayerOrder,Number.MAX_VALUE)-yt(i.drapedLayerOrder,Number.MAX_VALUE):yt(i.drapedLayerGraphicOrder,Number.MIN_VALUE)-yt(r.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function Of(e){return new igt(e)}class sgt{constructor(){this.min=new HM(ca()),this.max=new HM(ca()),this.hud={min:new ire(ca()),max:new ire(ca()),all:new Array},this.ground=new HM(ca()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class HM{constructor(t){this.intersector=zs.OBJECT,this.normal=$(),this.transformation=$e(),this._ray=ca(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return v(this.dist)?(de(gk,this.ray.direction,this.dist),Ie(gk)):null}getIntersectionPoint(t){return!!B0(this)&&(de(gk,this.ray.direction,this.dist),ye(t,this.ray.origin,gk),!0)}getTransformedNormal(t){return le($P,this.normal),$P[3]=0,kh($P,$P,this.transformation),le(t,$P),xe(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=zs.OBJECT,eV(t,this._ray)}set(t,r,i,s,n,o,a){this.intersector=t,this.dist=i,le(this.normal,yt(s,xCe)),jn(this.transformation,yt(n,Hn)),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){eV(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,le(this.normal,t.normal),jn(this.transformation,t.transformation)}}class ire extends HM{constructor(){super(...arguments),this.intersector=zs.HUD}}function Ile(e){return new HM(e)}const gk=$(),$P=Lr();function GDe(e,t,r,i){return v(e.renderCoordsHelper.fromRenderCoords(t.eye,vV,i))&&SOe(r,vV)}function w7(e,t){return e.elevationProvider?yt(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function pC(e,t,r,i){const s=e.state.camera.clone();t&&(s.eye=t,s.center=r,s.up=i),ngt(e,s.ray,j1)||le(j1,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(jo(s.eye,j1)<o){const a=n.collision.enabled;le(gT,s.viewForward),de(gT,gT,o),a?s.eye=ge(vV,j1,gT):ye(j1,s.eye,gT);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),d=n.collision.elevationMargin;a&&c<d&&(ge(gT,j1,s.eye),s.eye=l.setAltitude(vV,d,s.eye),ye(j1,s.eye,gT))}return s.center=j1,s}function T0e(e,t,r){if(!e.state.isGlobal)return!1;const i=w7(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,r,e.renderDataExtent,i,agt),o=n*n;return jo(t,r)>o}function ngt(e,t,r){let i=S0e[e.viewingMode];i||(i=Of(e.state.viewingMode),i.options.backfacesTerrain=!e.state.isGlobal,i.options.invisibleTerrain=!0,S0e[e.viewingMode]=i);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,i,r)||T0e(e,t.origin,r))||!(!e.renderCoordsHelper.intersectManifold(t,0,r)||T0e(e,t.origin,r))||!!s&&ogt(t,r,Kr(e.spatialReference).radius)}function ogt(e,t,r){const i=Te(e.origin,e.origin)-r*r,s=i>0?Math.sqrt(i)/3:1;return de(t,e.direction,s/Ie(e.direction)),ye(t,t,e.origin),!0}const S0e={},vV=$(),j1=$(),gT=$(),agt={near:0,far:0};function BI(e,t,r=lf.EYE){const i=e.state.constraints;if(!i.collision.enabled)return!1;const s=w7(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+i.collision.elevationMargin;if(n>=o)return!1;const a=Ie(t.eye);if(ge(yk,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(lgt,o,t.eye),r===lf.EYE_AND_CENTER)t.center=ye(yk,t.eye,yk);else if(r===lf.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=de(yk,t.center,l)}return!0}var lf;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(lf||(lf={}));const yk=$(),lgt=$();function Fx(e,t,r){e.worldUpAtPosition(t,E0e),ge(LW,r,t);const i=Ie(LW);return i===0?0:Eo(Te(LW,E0e)/i)}const E0e=$(),LW=$();function HDe(e,t,r=Nx,i=!0){DP.eyeCenterDistance=0,DP.requiresTwoSteps=!1;const s=Ple(e,t,r,void 0,DP);if(s===0)return!1;switch(Kh(_k,-s,t.viewRight),r.tiltMode){case pa.LOOK_AROUND:je(G1,t.viewForward,_k),de(G1,G1,DP.eyeCenterDistance),t.center=ye(bw,t.eye,G1);break;case pa.TUMBLE:ge(G1,t.center,t.eye),je(G1,G1,_k),t.eye=ge(bw,t.center,G1);break;default:r.tiltMode}return t.up=je(bw,t.up,_k),!DP.requiresTwoSteps||!i||HDe(e,t,r,!1)}function Ple(e,t,r=Nx,i=Nx,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,_gt);return ygt(e,r,o),i.interactionType===fr.TUMBLE&&HN(i.selection,hs.ALTITUDE)&&qDe(e,i.interactionStartCamera,o),r.tiltMode===pa.LOOK_AROUND||i.tiltMode===pa.LOOK_AROUND?ugt(e,t,o,s):cgt(e,t,o)}function cgt(e,t,r){const i=Fx(e.renderCoordsHelper,t.center,t.eye),s=i-_e(i,r.min,r.max);return qN(s)?s:0}function ugt(e,t,r,i){switch(i&&(i.requiresTwoSteps=!1),e.viewingMode){case"global":return hgt(e,t,r,i);case"local":return dgt(e,t,r,i);default:return void(e.viewingMode,void 0)}}function dgt(e,t,r,i){const s=Fx(e.renderCoordsHelper,t.center,t.eye),n=_e(s,r.min,r.max),o=s-n;if(!qN(o))return 0;if(i){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=t.distance}return o}function hgt(e,t,r,i){const s=pgt(e,t,vgt),n=_e(s.tiltAtCenter,r.min,r.max);if(!qN(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=fgt(s),a=mgt(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=ggt(s,o)),i&&(i.eyeCenterDistance=sre(s,o)),a}function pgt(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=i+Kr(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,i,bw);return r.eyeCenterDistance=t.distance,r.centerIsOnSurface=!1,v(n)?(r.eyeCenterDistance=Ni(t.eye,n),r.tiltAtCenter=Fx(e.renderCoordsHelper,n,t.eye),r.centerIsOnSurface=!0):e.state.isLocal?r.tiltAtCenter=Fx(e.renderCoordsHelper,t.center,t.eye):(LI(Hj(qj,s),t.ray,bw),r.eyeCenterDistance=Ni(t.eye,bw),r.tiltAtCenter=Eo(-Te(t.viewForward,xe(bw,bw)))),r.radius=s,r.eyeRadius=Ie(t.eye),r.constraints=e.state.constraints,r}function qN(e){return Math.abs(e)>1e-9}function fgt(e){const{constraints:t,eyeCenterDistance:r,tiltAtCenter:i}=e;let s=i,n=t.clampTilt(r,i);const o=sre(e,n);if(t.clampTilt(o,i)===n)return n;let a=0;for(;a<10&&qN(n-s);){const l=(s+n)/2,c=sre(e,l);qN(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function sre(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const r=Math.PI-_e(t,0,Math.PI),i=vf(e.radius/e.eyeRadius*Math.sin(r)),s=Math.PI-r-i,n=Math.sin(s)/Math.sin(r);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*e.eyeRadius}return n*e.eyeRadius}function mgt(e,t){const r=vf(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),i=vf(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?r-i:i-r}function ggt(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function ygt(e,t,r){if(t.interactionType===fr.NONE)return;const{interactionStartCamera:i,interactionFactor:s}=t,{min:n,max:o}=r,a=Ple(e,i,Nx,t),l=a===0?0:Fx(e.renderCoordsHelper,i.center,i.eye);r.min=n,r.max=o,t.interactionType===fr.TUMBLE?(HN(t.selection,hs.ALTITUDE)&&qDe(e,i,r),_V(a,l,!0,s,C0e,r)):_V(a,l,!1,s,C0e,r)}function qDe(e,t,r){if(e.state.isLocal)return;const i=e.state.constraints;if(!i.altitude)return;const s=Rc(t.center),n=Math.sqrt(s),o=t.distance,a=Kr(e.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,d=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);r.min=Math.max(r.min,Math.min(Math.PI-Eo(p),r.max)),r.max=Math.min(r.max,Math.PI-Eo(d))}const G1=$(),_k=$e(),bw=$(),C0e=Zt(5),_gt={min:0,max:0},vgt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},DP={eyeCenterDistance:0,requiresTwoSteps:!1};function bgt(e){return e}const x7=e=>e*e,$le=e=>1-x7(1-e),wgt=e=>e<.5?x7(2*e)/2:($le(2*(e-.5))+1)/2,Dle=e=>e*e*e,WDe=e=>1-Dle(1-e),XDe=e=>e<.5?Dle(2*e)/2:(WDe(2*(e-.5))+1)/2,Lle=e=>e*e*e*e,YDe=e=>1-Lle(1-e),xgt=e=>e<.5?Lle(2*e)/2:(YDe(2*(e-.5))+1)/2,Nle=e=>e*e*e*e*e,ZDe=e=>1-Nle(1-e),Tgt=e=>e<.5?Nle(2*e)/2:(ZDe(2*(e-.5))+1)/2,Fle=e=>1-Math.cos(e*Math.PI/2),JDe=e=>1-Fle(1-e),Sgt=e=>e<.5?Fle(2*e)/2:(JDe(2*(e-.5))+1)/2,kle=e=>2**(10*(e-1)),h4=e=>1-kle(1-e),Egt=e=>e<.5?kle(2*e)/2:(h4(2*(e-.5))+1)/2,Ule=e=>-(Math.sqrt(1-e*e)-1),KDe=e=>1-Ule(1-e),Cgt=e=>e<.5?Ule(2*e)/2:(KDe(2*(e-.5))+1)/2;function Df(e){const t=2*(e-Math.sqrt((e-1)*e)),r=t/2/e;return i=>i<r?e*i*i:t*i-t+1}function Lf(e,t){return(r,i)=>r<t?t*e(r/t,i):1-e((1-r)/(1-t),i)*(1-t)}const Agt=Lf(Df(1),1),Ogt=Lf(Df(1),0),QDe=Lf(Df(1),.5),Mgt=Lf(Df(2),1),Rgt=Lf(Df(2),0),Igt=Lf(Df(2),.5),Pgt=Lf(Df(3),1),$gt=Lf(Df(3),0),Dgt=Lf(Df(3),.5),Lgt=Lf(Df(4),1),Ngt=Lf(Df(4),0),Fgt=Lf(Df(4),.5),kgt={linear:bgt,"in-quad":x7,"out-quad":$le,"in-out-quad":wgt,"in-coast-quad":Agt,"out-coast-quad":Ogt,"in-out-coast-quad":QDe,"in-cubic":Dle,"out-cubic":WDe,"in-out-cubic":XDe,"in-coast-cubic":Mgt,"out-coast-cubic":Rgt,"in-out-coast-cubic":Igt,"in-quart":Lle,"out-quart":YDe,"in-out-quart":xgt,"in-coast-quart":Pgt,"out-coast-quart":$gt,"in-out-coast-quart":Dgt,"in-quint":Nle,"out-quint":ZDe,"in-out-quint":Tgt,"in-coast-quint":Lgt,"out-coast-quint":Ngt,"in-out-coast-quint":Fgt,"in-sine":Fle,"out-sine":JDe,"in-out-sine":Sgt,"in-expo":kle,"out-expo":h4,"in-out-expo":Egt,"in-circ":Ule,"out-circ":KDe,"in-out-circ":Cgt};function On(e,t,r=Vgt,i=t){i!==t&&i.copyFrom(t),i.computeUp(e.state.viewingMode);let s=!1;for(let a=0;a<jgt;a++){let l=0;for(const c of zgt)if(HN(r.selection,c.type)){const d=Math.abs(c.error(e,i,r));c.apply(e,i,r)&&(s=!0,l+=d)}if(l===0)break}const n=HN(r.selection,hs.COLLISION),o=Ugt(r.interactionType,e);return n&&BI(e,i,o)&&(s=!0),s&&i.computeUp(e.state.viewingMode),s}function Ugt(e,t){switch(e){case fr.PAN:return lf.EYE_AND_CENTER;case fr.ASCEND:return t.state.isGlobal?lf.EYE_AND_CENTER_SCALE:lf.EYE_AND_CENTER;default:return lf.EYE}}function Fm(e){const t=Math.min(1,e/150);return XDe(t)}function Bgt(e,t,r){return Ple(e,t,r)*t.distance}const zgt=[{type:hs.TILT,error:Bgt,apply:HDe},{type:hs.ALTITUDE,error:Ole,apply:Rmt},{type:hs.DISTANCE,error:Mle,apply:Umt}],Vgt={selection:hs.ALL,interactionType:fr.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:pa.TUMBLE},jgt=5,Wd=$(),Uu=$(),H1=$(),gl=$(),yT=$(),Ggt=$(),Xd={upward:Fe(0,0,1),forward:Fe(0,1,0),sideway:Fe(1,0,0)},A0e=Ts();class O0e{constructor(t=Ye.Global){this.viewingMode=t,this.center=$(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=ws(Xd.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ye.Global){const n=(Ie(this.center)+Ie(t.center))/2;r.pan=xB(this.center,t.center)*n}else r.pan=Ni(this.center,t.center);let i=Math.abs(t.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(t.pitch-this.pitch);return r.rotate=Math.max(i,s),r.sourceZoom=this.distance,r.targetZoom=t.distance,r}interpolate(t,r,i){this.viewingMode===Ye.Global?Rnt(t.center,r.center,i.pan,this.center):$n(this.center,t.center,r.center,i.pan),this.distance=isFinite(r.distance)?Ft(t.distance,r.distance,i.zoom):t.distance,this.pitch=Ft(t.pitch,r.pitch,i.rotate);let s=t.yaw;const n=r.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=Ft(s,n,i.rotate)}copyFrom(t){le(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,le(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const r=this._lookAtOrientation(t.center,A0e);le(this.center,t.center),ge(gl,t.center,t.eye),Td(gl,gl,r),Td(yT,t.up,r),this.distance=Ie(gl),this.distance!==0&&(gl[0]/=this.distance,gl[1]/=this.distance,gl[2]/=this.distance),this.pitch=this._eyeUpToPitch(gl),this.yaw=this._eyeUpToYaw(gl,yT),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const r=this._lookAtOrientation(this.center,A0e);Sf(r,r),this._axisAngleVec3(Xd.sideway,this.pitch-Math.PI/2,Xd.forward,gl),this._axisAngleVec3(Xd.upward,this.yaw,gl),this._axisAngleVec3(Xd.sideway,this.pitch-Math.PI/2,Xd.upward,yT),this._axisAngleVec3(Xd.upward,this.yaw,yT),de(gl,gl,this.distance),Td(gl,gl,r),Td(yT,yT,r),t.center=this.center,t.eye=ge(gl,this.center,gl),t.up=yT}_axisAngleVec3(t,r,i,s=i){const n=Math.cos(r),o=Math.sin(r);return de(Wd,i,n),At(Uu,t,i),de(Uu,Uu,o),de(H1,t,(1-n)*Te(t,i)),ye(s,ye(s,Wd,Uu),H1)}_lookAtOrientation(t,r=Ts()){return this._upAtLookAt(t,H1),At(Wd,this.lookAtDirection,H1),xe(Wd,Wd),Wd[0]===0&&Wd[1]===0&&Wd[2]===0&&le(Wd,Xd.sideway),At(Uu,H1,Wd),xe(Uu,Uu),r[0]=Wd[0],r[1]=Uu[0],r[2]=H1[0],r[3]=Wd[1],r[4]=Uu[1],r[5]=H1[1],r[6]=Wd[2],r[7]=Uu[2],r[8]=H1[2],r}_upAtLookAt(t,r){return this.viewingMode===Ye.Local?le(r,Xd.upward):xe(r,t)}_eyeUpToPitch(t){return Math.PI-xB(Xd.upward,t)}_eyeUpToYaw(t,r){const i=Ggt;return Math.abs(r[2])<.5?(le(i,r),t[2]>0&&de(i,i,-1)):le(i,t),At(Uu,i,Xd.upward),xe(Uu,Uu),xB(Xd.sideway,Uu,Xd.upward)}}function T7(e){return e?{ray:ca(e.ray),c0:e.c0,c1:e.c1}:{ray:ca(),c0:0,c1:Number.MAX_VALUE}}function Hgt(e,t=T7()){return eV(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function qgt(e,t,r=T7()){const i=Ie(e.vector);return MPe(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function y8t(e,t){return eLe(e,e.c0,t)}function _8t(e,t){return eLe(e,e.c1,t)}function eLe(e,t,r){return ye(r,e.ray.origin,de(r,e.ray.direction,t))}new c1(()=>T7());function WN(e){return e?[di(e[0]),di(e[1]),di(e[2]),di(e[3]),di(e[4]),di(e[5])]:[di(),di(),di(),di(),di(),di()]}function tLe(){return[$(),$(),$(),$(),$(),$(),$(),$()]}function bV(e,t){for(let r=0;r<kx.NUM;r++)Wj(e[r],t[r])}function rLe(e,t,r,i=Jgt){const s=Hs(Cae.get(),t,e);Pn(s,s);for(let n=0;n<nre.NUM;++n){const o=kh(Eae.get(),Zgt[n],s);ue(i[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}iLe(r,i)}function iLe(e,t){Il(t[ot.FAR_BOTTOM_LEFT],t[ot.NEAR_BOTTOM_LEFT],t[ot.NEAR_TOP_LEFT],e[Gi.LEFT]),Il(t[ot.NEAR_BOTTOM_RIGHT],t[ot.FAR_BOTTOM_RIGHT],t[ot.FAR_TOP_RIGHT],e[Gi.RIGHT]),Il(t[ot.FAR_BOTTOM_LEFT],t[ot.FAR_BOTTOM_RIGHT],t[ot.NEAR_BOTTOM_RIGHT],e[Gi.BOTTOM]),Il(t[ot.NEAR_TOP_LEFT],t[ot.NEAR_TOP_RIGHT],t[ot.FAR_TOP_RIGHT],e[Gi.TOP]),Il(t[ot.NEAR_BOTTOM_LEFT],t[ot.NEAR_BOTTOM_RIGHT],t[ot.NEAR_TOP_RIGHT],e[Gi.NEAR]),Il(t[ot.FAR_BOTTOM_RIGHT],t[ot.FAR_BOTTOM_LEFT],t[ot.FAR_TOP_LEFT],e[Gi.FAR])}function Gw(e,t){for(let r=0;r<kx.NUM;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function Wgt(e,t){return nLe(e,Hgt(t,oLe.get()))}function v8t(e,t){for(let r=0;r<kx.NUM;r++){const i=e[r];if(!Fnt(i,t))return!1}return!0}function Xgt(e,t,r){return nLe(e,qgt(t,r,oLe.get()))}function sLe(e,t){for(let r=0;r<kx.NUM;r++)if(Hi(e[r],t)>0)return!1;return!0}function nLe(e,t){for(let r=0;r<kx.NUM;r++)if(!Nnt(e[r],t))return!1;return!0}var Gi,ot;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(Gi||(Gi={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(ot||(ot={}));const Ygt={bottom:[ot.FAR_BOTTOM_RIGHT,ot.NEAR_BOTTOM_RIGHT,ot.NEAR_BOTTOM_LEFT,ot.FAR_BOTTOM_LEFT],near:[ot.NEAR_BOTTOM_LEFT,ot.NEAR_BOTTOM_RIGHT,ot.NEAR_TOP_RIGHT,ot.NEAR_TOP_LEFT],far:[ot.FAR_BOTTOM_RIGHT,ot.FAR_BOTTOM_LEFT,ot.FAR_TOP_LEFT,ot.FAR_TOP_RIGHT],right:[ot.NEAR_BOTTOM_RIGHT,ot.FAR_BOTTOM_RIGHT,ot.FAR_TOP_RIGHT,ot.NEAR_TOP_RIGHT],left:[ot.FAR_BOTTOM_LEFT,ot.NEAR_BOTTOM_LEFT,ot.NEAR_TOP_LEFT,ot.FAR_TOP_LEFT],top:[ot.FAR_TOP_LEFT,ot.NEAR_TOP_LEFT,ot.NEAR_TOP_RIGHT,ot.FAR_TOP_RIGHT]};var kx,nre;(function(e){e[e.NUM=6]="NUM"})(kx||(kx={})),function(e){e[e.NUM=8]="NUM"}(nre||(nre={}));const Zgt=[ar(-1,-1,-1,1),ar(1,-1,-1,1),ar(1,1,-1,1),ar(-1,1,-1,1),ar(-1,-1,1,1),ar(1,-1,1,1),ar(1,1,1,1),ar(-1,1,1,1)],oLe=new c1(T7),Jgt=tLe();class Li{constructor(t=null,r=null,i=null){this._viewUp=$(),this._viewForward=$(),this._viewRight=$(),this._ray=ca(),this._viewport=ar(0,0,1,1),this._padding=ar(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=pi(1,1e3),this._viewDirty=!0,this._viewMatrix=$e(),this._projectionDirty=!0,this._projectionMatrix=$e(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=$e(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=$e(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=WN(),this._fullViewport=Lr(),this._pixelRatio=1,this.relativeElevation=0,v(t)&&le(this._ray.origin,t),this._center=v(r)?ws(r):$(),this._up=v(i)?ws(i):Fe(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return ge(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){jn(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[Vt.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[Vt.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[Vt.RIGHT]+this._padding[Vt.LEFT]}set fullWidth(t){this.width=t-(this._padding[Vt.RIGHT]+this._padding[Vt.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Vt.TOP]+this._padding[Vt.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Vt.TOP]+this._padding[Vt.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Vt.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Vt.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[Vt.TOP]===t[Vt.TOP]&&this._padding[Vt.RIGHT]===t[Vt.RIGHT]&&this._padding[Vt.BOTTOM]===t[Vt.BOTTOM]&&this._padding[Vt.LEFT]===t[Vt.LEFT]||(this._viewport[0]+=t[Vt.LEFT]-this._padding[Vt.LEFT],this._viewport[1]+=t[Vt.BOTTOM]-this._padding[Vt.BOTTOM],this._viewport[2]-=t[Vt.RIGHT]+t[Vt.LEFT]-(this._padding[Vt.RIGHT]+this._padding[Vt.LEFT]),this._viewport[3]-=t[Vt.TOP]+t[Vt.BOTTOM]-(this._padding[Vt.TOP]+this._padding[Vt.BOTTOM]),jm(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Hs(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,r=this.height,i=this.near*Math.tan(this.fovY/2),s=i*this.aspect;URe(this._projectionMatrix,-s*(1+2*this._padding[Vt.LEFT]/t),s*(1+2*this._padding[Vt.RIGHT]/t),-i*(1+2*this._padding[Vt.BOTTOM]/r),i*(1+2*this._padding[Vt.TOP]/r),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return C(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=$e()),this._inverseProjectionDirty&&Pn(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){jn(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return oft(this._fov,this.width,this.height)}set fovX(t){this._fov=sft(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return aft(this._fov,this.width,this.height)}set fovY(t){this._fov=nft(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Ni(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Pn(this._viewInverseTransposeMatrix,this.viewMatrix),Iu(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const r=2*t-1;return 2*this.near*this.far/(this.far+this.near-r*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){le(this._ray.origin,t.eye),le(this._center,t.center),le(this._up,t.up),jm(this._viewport,t.viewport),jm(this._padding,t.padding),Ho(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const r=t;return this._viewDirty=r._viewDirty,this._viewDirty||(jn(this._viewMatrix,t.viewMatrix),le(this._viewRight,t.viewRight),le(this._viewUp,t.viewUp),le(this._viewForward,t.viewForward)),r._projectionDirty?this._projectionDirty=!0:(jn(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=r._frustumDirty,this._frustumDirty||(bV(this._frustum,t.frustum),this._frustumDirty=!1),r._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(jn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),jm(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new Li().copyFrom(this)}equals(t){return _u(this.eye,t.eye)&&_u(this._center,t.center)&&_u(this._up,t.up)&&QL(this._viewport,t.viewport)&&QL(this._padding,t.padding)&&H$e(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const r=5e-4,i=1-1e-10;Pc(yl,t.eye,t.center),Pc(NW,this.eye,this._center);const s=Te(yl,NW),n=OJ(yl),o=OJ(NW);return s*s>=i*n*o&&Cne(t.eye,this.eye)<Math.max(n,o)*r*r&&yz(t.padding,this._padding)<.5&&yz(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(GD(this.viewForward,ge(yl,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,r){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(r||1)))}getScreenCenter(t=Vs()){return t[0]=(this.padding[Vt.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[Vt.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t,r=.5,i=.5){return t[0]=this.padding[Vt.LEFT]+this.width*r,t[1]=this.padding[Vt.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const r=this.viewport,i=this.padding;t.setViewport(r[0]-i[3],r[1]-i[2],r[2]+i[1]+i[3],r[3]+i[0]+i[2])}applyProjection(t,r){t!==vr&&le(vr,t),vr[3]=1,kh(vr,vr,this.projectionMatrix);const i=Math.abs(vr[3]);de(vr,vr,1/i);const s=this.fullViewport;r[0]=Ft(0,s[0]+s[2],.5+.5*vr[0]),r[1]=Ft(0,s[1]+s[3],.5+.5*vr[1]),r[2]=.5*(vr[2]+1),r[3]=i}unapplyProjection(t,r){const i=this.fullViewport;vr[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],vr[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],vr[2]=(2*t[2]-1)*t[3],vr[3]=t[3],kh(vr,vr,this.inverseProjectionMatrix),r[0]=vr[0],r[1]=vr[1],r[2]=vr[2]}projectToScreen(t,r){return this.projectToRenderScreen(t,FW),this.renderToScreen(FW,r),r}projectToRenderScreen(t,r){if(vr[0]=t[0],vr[1]=t[1],vr[2]=t[2],vr[3]=1,kh(vr,vr,this.viewProjectionMatrix),vr[3]===0)return null;de(vr,vr,1/Math.abs(vr[3]));const i=this.fullViewport;return"x"in r?(r.x=Ft(0,i[0]+i[2],.5+.5*vr[0]),r.y=Ft(0,i[1]+i[3],.5+.5*vr[1])):(r[0]=Ft(0,i[0]+i[2],.5+.5*vr[0]),r[1]=Ft(0,i[1]+i[3],.5+.5*vr[1]),r.length>2&&(r[2]=.5*(vr[2]+1))),r}unprojectFromScreen(t,r){return this.unprojectFromRenderScreen(this.screenToRender(t,FW),r)}unprojectFromRenderScreen(t,r){if(Hs(vk,this.projectionMatrix,this.viewMatrix),!Pn(vk,vk))return null;const i=this.fullViewport;return vr[0]=2*(t[0]-i[0])/i[2]-1,vr[1]=2*(t[1]-i[1])/i[3]-1,vr[2]=2*t[2]-1,vr[3]=1,kh(vr,vr,vk),vr[3]===0?null:(r[0]=vr[0]/vr[3],r[1]=vr[1]/vr[3],r[2]=vr[2]/vr[3],r)}constrainWindowSize(t,r,i,s=i){const n=t*this._pixelRatio,o=r*this._pixelRatio,a=Math.max(n-i/2,0),l=Math.max(this.fullHeight-o-s/2,0),c=-Math.min(n-i/2,0),d=-Math.min(this.fullHeight-o-s/2,0);return[a,l,i-c- -Math.min(this.fullWidth-n-i/2,0),s-d- -Math.min(o-s/2,0)]}computeUp(t){t===Ye.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,r){const i=t[0]*this._pixelRatio,s=this.fullHeight-t[1]*this._pixelRatio;return r[0]=i,r[1]=s,r}renderToScreen(t,r){const i=t[0]/this._pixelRatio,s=(this.fullHeight-t[1])/this._pixelRatio;r[0]=i,r[1]=s}_computeUpGlobal(){ge(yl,this.center,this.eye);const t=Ie(this.center);t<1?(ue(this._up,0,0,1),this._markViewDirty()):Math.abs(Te(yl,this.center))>.9999*Ie(yl)*t||(At(this._up,yl,this.center),At(this._up,this._up,yl),xe(this._up,this._up),this._markViewDirty())}_computeUpLocal(){n1(yl,this.eye,this.center),Math.abs(yl[2])<=.9999&&(de(yl,yl,yl[2]),ue(this._up,-yl[0],-yl[1],1-yl[2]),xe(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,r){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?_u(t,r)||(le(r,t),this._markViewDirty()):te.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(rLe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Ij(this._viewMatrix,this.eye,this._center,this._up),ue(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),ue(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),ue(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const vr=Lr(),vk=$e(),yl=$(),NW=$(),FW=ul();var Vt;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(Vt||(Vt={}));const wV={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class Ble{constructor(t){this._createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:wV.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new Ble(this._createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,r,i){this.source!==t&&this.source.copyFrom(t),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:wV.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const r=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class Kgt{constructor(){this.segments=[]}get time(){return this.segments.reduce((t,r)=>t+r.time,0)}interpolateComponentsAt(t,r){t=Math.min(Math.max(t,0),1),t*=this.time;let i=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(t<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:t/a.time,r),n.hasPan&&!isNaN(r.pan)&&isFinite(n.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/n.compared.pan:r.pan=1,n.hasRotate&&!isNaN(r.rotate)&&isFinite(n.compared.rotate)?r.rotate=(s+l.compared.rotate*r.rotate)/n.compared.rotate:r.rotate=1,n.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,d=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-d)/(p-d)}else r.zoom=1;return r}t-=a.time,i+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(t,r,i){return t.interpolateComponentsAt(r,i)}}class kW{constructor(t){t&&this.update(t)}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,r=t.compared,i=r.sourceZoom,s=r.targetZoom;this._zoomSign=i>s?1:-1,this._panPixelsAtSource=r.pan*t.source.pixelsPerPanAtZoom(i);const n=(t.source.pixelsPerRotateAtZoom(i)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=r.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;i&&(s&&(o=(r/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,d=1+c;this._panPixelFlow=c/d*l,this._rotatePixelFlow=1/d*l}else s?this._panPixelFlow=l:i?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:i?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=t*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-t-r)/(i-r)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*t*this._time)-1))/(r*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,r){t=Math.min(Math.max(t,0),1);const i=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return r?(r.zoom=i,r.pan=s,r.rotate=n):r={zoom:i,pan:s,rotate:n},r}}function Qgt(e,t,r){const i=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(i);return-e.halfWindowSize*(r.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function eyt(e,t,r){const i=1/t,s=Math.log(e.compared.sourceZoom*i),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*i*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function tyt(e,t,r){const i=t-e.compared.sourceZoom,s=1/i,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(i))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(i*i)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function ryt(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function iyt(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function syt(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function nyt(e,t,r){return-e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function oyt(e,t,r){return e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function ayt(e,t,r){return-2*e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function lyt(e,t,r){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function cyt(e,t,r){const i=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*i*s*n*a+e.halfWindowSize*i*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function uyt(e,t,r){const i=t-e.compared.targetZoom,s=1/i,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+r.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(i*i)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function dyt(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function hyt(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function pyt(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function fyt(e){const t=Math.LN2*e.compared.pan,r=e.compared.sourceZoom-e.compared.targetZoom,i=e.halfWindowPanAtZoom(r),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*i);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-i):s*(t+i)}function myt(e,t){let r=gyt(e,t);const i={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=i.ascensionFactor===0,n=i.descensionFactor===0,o=s?ryt:Qgt,a=s?iyt:eyt,l=s?syt:tyt,c=n?dyt:lyt,d=n?hyt:cyt,p=n?pyt:uyt,f=E=>o(e,E,i)+nyt(e,E,i)+c(e,E,i),m=E=>a(e,E,i)+oyt(e,E,i)+d(e,E,i),g=E=>l(e,E,i)+ayt(e,E,i)+p(e,E,i);let _=f(r);const x=fyt(e);let b;const w=t.maximumIterations||20,T=t.maximumDistance!=null?t.maximumDistance:1/0;for(b=0;b<w;b++){const O=(m(r)+1e-6)/g(r);if(isNaN(O)||r>=T&&O<0){if(!isFinite(T))return null;r=T,_=f(r);break}if(r-=O,r<e.compared.sourceZoom||r<e.compared.targetZoom)return null;const A=f(r);if(Math.abs(A-_)/_<=.005)break;_=A}return _>x*(1-.3)||r<e.compared.sourceZoom||r<e.compared.targetZoom?null:r}function gyt(e,t){const r=Math.max(e.compared.sourceZoom,e.compared.targetZoom),i=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return i<r?t.maximumDistance!=null?r+(t.maximumDistance-r)/2:1.5*r:t.maximumDistance?Math.min(t.maximumDistance,i):i}class yyt extends Kgt{constructor(t,r){super(),this._preallocSegments=[new kW,new kW,new kW],this.update(t,r)}update(t,r){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let i=null;r&&r.apex&&(i=myt(t,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r.apex)}segmentInterpolateComponentsAt(t,r,i){return i=t.interpolateComponentsAt(r,i),t===this._ascensionSegment?i.zoom=$le(i.zoom):t===this._descensionSegment&&(i.zoom=x7(i.zoom)),i}_updateWithApex(t,r){const[i,s,n]=this._preallocSegments,o=r.ascensionFactor!=null?r.ascensionFactor:.5,a=Math.min(1-o,r.ascensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=t,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const _yt={zoom:0,pan:0,rotate:0};class vyt{constructor(t){this._createCamera=t,this._time=0,this.definition=new Ble(t),this.path=new yyt}get time(){return this._time}update(t,r,i){this.definition.update(t,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(o2e(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing?i.easing:this._time>=1e3?QDe:h4}cameraAt(t,r){r=r||this._createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const i=this.path.interpolateComponentsAt(t,_yt);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(t){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(t,this._time)-r)/(i-r)}_applyTimeSettings(t,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?t=r.duration:r.speedFactor!=null&&(t=t/i);const s=r.minDuration!=null?r.minDuration:wV.minDuration/i,n=r.maxDuration!=null?r.maxDuration:wV.maxDuration/i;return Math.min(Math.max(s,t),n)}}const byt=$();class wyt{constructor(t){this.currentTime=0,this._animation=new vyt(()=>new O0e(t)),this._current=new O0e(t)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(t,r,i){const s=this._animation.definition.source,n=this._animation.definition.target,o=ge(byt,r.center,t.center),a=Ie(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),le(s.lookAtDirection,o),le(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(r),this._current.copyFrom(s),this._animation.update(s,n,i),this.currentTime=0,t.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(t,r){return this._animation.cameraAt(t,this._current),r=r||new Li,this._current.copyToRenderCamera(r),r}step(t,r){return this.finished||(this.currentTime=this.currentTime+o2e(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}}var Bs;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(Bs||(Bs={}));let sv=class extends be{constructor(e){super(e),this.state=Bs.Ready}get active(){return this.state===Bs.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Bs.Stopped,!0)}finishController(){this.state=Bs.Finished}get steppingFinished(){return!1}};u([h({constructOnly:!0})],sv.prototype,"view",void 0),u([h({readOnly:!0})],sv.prototype,"active",null),u([h()],sv.prototype,"state",void 0),u([h({readOnly:!0})],sv.prototype,"isInteractive",null),sv=u([I("esri.views.3d.state.controllers.CameraController")],sv);let XN=class extends sv{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(oi()),this._asyncResult=null),this.state===Bs.Finished||this.state===Bs.Stopped?(Ose(e),this.state===Bs.Finished?e.resolve():e.reject(oi())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Bs.Running,v(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!v(this.viewAnimation)||this.state!==Bs.Ready&&this.state!==Bs.Running||(this.viewAnimation.state===jR.State.FINISHED?this.finish():this.viewAnimation.state===jR.State.STOPPED&&(this.state=Bs.Stopped))}onControllerEnd(){v(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Bs.Finished?this.viewAnimation.finish():this.state===Bs.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Bs.Finished?this._asyncResult.resolve():this._asyncResult.reject(oi()))}finish(){this.finishController()}};XN=u([I("esri.views.3d.state.controllers.AnimationController")],XN);let _v=class extends XN{constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new wyt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new jR}get isInteractive(){return this.mode==="interaction"}begin(e,t){this._hasTarget=!0;const r=this.animationSettings(t);bk.copyFrom(this.view.state.camera);const i=Of(this.view.state.viewingMode);this.intersectionHelper.intersectRay(bk.ray,i,M0e)&&(bk.center=M0e),this.animation.update(bk,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,t){this._hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?kgt[e.easing]:e.easing}}};u([h({constructOnly:!0})],_v.prototype,"mode",void 0),u([h({readOnly:!0})],_v.prototype,"isInteractive",null),_v=u([I("esri.views.3d.state.controllers.PointToPointAnimationController")],_v);const bk=new Li,M0e=$();function S7(e=Tyt){return[e[0],e[1],e[2],e[3]]}function YN(e,t){return xyt(e[0],e[1],e[2],t,Eae.get())}function xyt(e,t,r,i,s=S7()){return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function zle(e,t,r){return At(r,e,t),xe(r,r),r[3]=Aae(e,t),r}const Tyt=[0,0,1,0];function aLe(e,t,r){return Syt(e,e.screenToRender(t,Xe.get()),r)}function Syt(e,t,r){const i=Ho(Xe.get(),t);if(i[2]=0,!e.unprojectFromRenderScreen(i,r.origin))return null;const s=Ho(Xe.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,Xe.get());return C(n)?null:(ge(r.direction,n,r.origin),r)}function zI(e,t,r){return Vle(e,e.screenToRender(t,Xe.get()),r)}function Vle(e,t,r){le(r.origin,e.eye);const i=ue(Xe.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(i,Xe.get());return C(s)?null:(ge(r.direction,s,r.origin),r)}function jle(e,t,r,i){const s=zI(t,r,Eyt);return Qx(e,s,i)}const Eyt=ca();var iI;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(iI||(iI={}));const lLe=30,xV=[1,3e8],cLe=70;function j2(e,t,r){return r[0]=t[0]/(e.fullWidth/e.pixelRatio),r[1]=t[1]/(e.fullHeight/e.pixelRatio),r}function ore(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function Ux(e,t,r){const i=Kh(Cae.get(),r[3],r);C(i)||VRe(i,Hn)||(ge(Ai,e.eye,t),je(Ai,Ai,i),e.eye=ye(Ai,Ai,t),ge(Ai,e.center,t),je(Ai,Ai,i),e.center=ye(Ai,Ai,t),e.up=je(Ai,e.up,i))}function Cyt(e,t,r,i){return dC(e,aLe(t,r,qle),i)}function are(e,t,r,i){return dC(e,zI(t,r,qle),i)}function Gle(e,t,r,i){const s=Xe.get();let n=1-r;ge(s,t,e.eye);const o=Ie(s);let a=o*(1-n);n>=0&&a<i&&(a=i,n=-(a-o)/o),Math.abs(o-a)<1e-6||(de(s,s,n),e.eye=ye(Ai,e.eye,s),e.center=$n(Ai,e.center,t,n))}function uLe(e,t,r){t.getScreenCenter(R0e),jle(e,t,R0e,Ai)&&(t.center=Ai);const i=t.distance,s=i*r;if(Math.abs(i-s)<1e-6)return;const n=de(Xe.get(),t.viewForward,s);t.eye=ge(Ai,t.center,n)}const R0e=Vs();function UW(e,t){ue(t,0,0,0);for(const r of e)ye(t,t,r);de(t,t,1/e.length)}function zB(e,t,r,i){return Math.sin(e/Ie(t))*(r+i.radius)}function I0e(e,t,r,i){return zB(Math.PI/2,t,r,i)+(e-Math.PI/2)}var za;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(za||(za={}));const P0e={Elevation:3e4,Angle:Zt(6)},wk={Pole:.95,Angle:Zt(18),Tilt:45},dLe=Zt(80);function hLe(e,t,r,i,s,n){const o=$(),a=qo();let l=!0,c=!0;return e.intersectScreen(r,o,n)?a[3]=Ie(o):(c=!1,t.aboveGround&&s!==iI.Ellipsoid?a[3]=Math.max(Ie(t.center),.9*i.radius):a[3]=Ie(t.eye)-t.relativeElevation,s===iI.Silhouette?ZN(a,t,r,o):l=jle(a,t,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function E7(e,t,r,i){return Ie(e.eye)-i.radius>P0e.Elevation?za.Horizontal:r?(zI(e,t,B0e),-Math.sign(e.relativeElevation)*(.5*Math.PI+Aae(e.eye,B0e.direction))<P0e.Angle?za.Vertical:za.Horizontal):za.Vertical}function pLe(e,t,r){ge(BW,r,t),e.eye=ge(Ai,e.eye,BW),e.center=ge(Ai,e.center,BW)}const BW=$();function ZN(e,t,r,i){const s=zI(t,r,qle);return!C(s)&&(LI(e,s,xk),Qx(e,s,i)?!(jo(xk,s.origin)<jo(i,s.origin))||(le(i,xk),!1):(ge(BC,t.eye,t.center),xe(BC,BC),UPe(BC,-Te(xe(BC,BC),xk),$0e),dC($0e,s,i),!1))}const xk=$(),BC=$(),$0e=di();function fLe(e,t,r,i,s,n){let o=0;if(At(EV,e,t),ge(Ck,e,t),Ie(e)<=s||!i.aboveGround){At(r,Ck,i.eye);const a=Te(e,t)/(Ie(e)*Ie(t));if(a<.9999)o=Eo(a);else{const c=Ie(At($(),e,t))/(Ie(e)*Ie(t));o=vf(c)}const l=Math.cos(_e(Tx.normalize(Zt(n)),0,dLe));o=-o-Math.max(0,Ie(t)-s)/(l*s)}else ge(D0e,i.eye,i.center),At(r,Ck,D0e),o=-Ie(Ck)/s;return xe(r,r),de(r,r,Ie(EV)),o}const D0e=$();function L0e(e,t,r,i){let s,n;const o=Math.cos(_e(Tx.normalize(Zt(i)),0,dLe));return s=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):Eo(t/r),n=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):Eo(e/r),(n-s)*r}function Ayt(e,t,r,i,s,n,o,a,l,c){const d=L0e(e[2],t[2],n[3],a),p=l?L0e(e[0],t[0],n[3],180):t[0]-e[0],f=Math.sin(o)*p-Math.cos(o)*d,m=Math.cos(o)*p+Math.sin(o)*d;xe(Ai,s);const g=l?f/Math.sqrt(Math.abs(n[3]**2-Te(r,Ai)**2)):f/n[3],_=m/Math.sqrt(Math.abs(n[3]**2-Te(r,i)**2));mr(c,g,_)}function mLe(e,t,r,i,s,n,o,a,l,c){At(EV,e,t),gte(n.up,n.eye,Tk,Sk,Ek),gte([0,0,1],n.eye,Rv,dx,vLe),le(r,dx),le(i,Rv),xe(r,r),de(r,r,Ie(EV)),Yme(e,xe(Sk,Sk),xe(Ek,Ek),xe(Tk,Tk),N0e),Yme(t,Sk,Ek,Tk,F0e),Ayt(N0e,F0e,e,Rv,dx,o,a,l,c,s)}function Oyt(e,t,r,i,s,n,o){Kh(TV,s,i),Kh(SV,o,n),Hs(rM,TV,SV),ge(t,e,r),je(t,t,rM),ye(t,t,r)}function gLe(e,t,r,i,s,n){Kh(TV,i,r),Kh(SV,n,s),Hs(rM,TV,SV),ge(Ai,e.eye,t),je(Ai,Ai,rM),e.eye=ye(Ai,Ai,t),ge(Ai,e.center,t),je(Ai,Ai,rM),e.center=ye(Ai,Ai,t),ge(Ai,e.up,t),je(Ai,Ai,rM),e.up=ye(Ai,Ai,t)}function Hle(e,t,r,i,s,n){return(Math.abs(i)>Math.PI-wk.Angle||Math.abs(i)<wk.Angle)&&(Math.abs(e[2])<r*wk.Pole||Math.abs(t)>r)&&n.aboveGround&&s<wk.Tilt}function yLe(e,t,r,i,s,n){if(n)zle(r,i,k0e),Ux(t,e,k0e);else{const o=fLe(r,i,U0e,t,e[3],s);Ux(t,e,YN(U0e,o))}}function _Le(e,t,r,i,s,n,o){const a=o?20:1,l=1e-12;let c,d;le(_T,i),Ak.copyFrom(t);for(let p=0;p<a&&jo(r,_T)>l&&(c=jo(r,_T),mLe(r,_T,dx,Rv,LP,Ak,e,s,n,o),gLe(Ak,e,Rv,LP[1],dx,LP[0]),Oyt(_T,_T,e,Rv,LP[1],dx,LP[0]),d=jo(r,_T),d<c||p===0);p++)t.copyFrom(Ak)}function Myt(e,t,r,i,s,n,o){Hle(r,Te(t.up,r),e[3],-Tx.normalize(Zt(s)),n,t)?_Le(e,t,r,i,-Tx.normalize(Zt(s)),n,o):yLe(e,t,r,i,n,o)}function Ryt(e,t,r,i,s,n){const{eye:o}=e;gte([0,0,1],o,Rv,dx,vLe);const a=t.translation[0]*r.pan,l=s.mode==="zoom"?0:t.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-Te(e.center,Rv)**2/Ie(e.center)**2)),.5),d=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(Sd(i.pan.matrix,i.pan.matrix,d,Rv),i.pan.enabled=!0,s.mode){case"pan":Sd(i.pan.matrix,i.pan.matrix,p,dx),i.pan.enabled=!0;break;case"zoom":i.zoom=-t.translation[1]*r.zoom}}function Iyt(e,t,r,i,s){const{eye:n,viewRight:o}=e,a=At(Xe.get(),o,n),l=t.translation[0]*r.pan;switch(l!==0&&(Sd(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*r.pan;c!==0&&(Sd(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-t.translation[1]*r.zoom}}function Pyt(e,t,r,i,s,n,o,a,l){Hle(e.center,Te(e.up,e.center),Ie(e.center),-Tx.normalize(Zt(n)),o,t)?Ryt(t,r,i,a,l,-Tx.normalize(Zt(s))):Iyt(t,r,i,a,l)}const Rv=$(),dx=$(),vLe=$(),Tk=$(),Sk=$(),Ek=$(),N0e=$(),F0e=$(),LP=rt(),k0e=S7(),TV=$e(),SV=$e(),rM=$e(),_T=$(),Ai=$(),Ck=$(),Ak=new Li,EV=$(),U0e=$(),qle={origin:$(),direction:$()},B0e={origin:$(),direction:$()},z0e=.6,zW=4,$yt=12,Dyt=60,Lyt=200;let CV=class extends _v{constructor(){super(...arguments),this._zoomLocation=$(),this._tmpCamera=new Li,this._tmpViewDir=$(),this._tmpRayDir={origin:$(),direction:$()},this._targetOnSphere=$(),this._tmpCenter=$(),this._constraintOptions={selection:hs.ALL_EXCEPT_COLLISION,interactionType:fr.ZOOM,interactionFactor:null,interactionStartCamera:new Li,interactionDirection:null,tiltMode:pa.TUMBLE},this._sphere=qo()}initialize(){this._intersector=Of(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this._constraintOptions;this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i);let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this._zoomLocation,this.view.map.ground.opacity===0?Nyt:{})&&(s=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:le(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,t,n),this.begin(this._tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:h4}}_updateCamera(e,t,r,i,s){const n=Kr(this.view.spatialReference),o=E7(e,i,s,n);let a;this.view.camera.position.hasZ&&(a=Math.abs(this.view.camera.position.z)),xe(Mk,e.eye),de(Mk,Mk,-1),zI(e,i,this._tmpRayDir),xe(this._tmpRayDir.direction,this._tmpRayDir.direction);const l=Math.max(Math.min($yt,1/Math.abs(Te(Mk,this._tmpRayDir.direction)))*a,Lyt);if(o===za.Horizontal){let c=z0e**t;this._sphere[3]=Ie(r),ge(this._tmpViewDir,e.center,e.eye);const d=Math.min(Ie(this._tmpViewDir),l);let p=d*c;if(c<=1&&p<zW&&(p=zW,c=p/d),Math.abs(d-p)<1e-6)return;const f=Ie(e.center);if(this._sphere[3]!==f){const m=this._sphere[3]+c*(f-this._sphere[3]);e.center=de(Ok,e.center,m/f)}de(this._tmpViewDir,this._tmpViewDir,-c),e.eye=ye(Ok,e.center,this._tmpViewDir),On(this.view,e,this._constraintOptions),jo(r,e.center)>1e-12&&jle(this._sphere,e,i,this._targetOnSphere)&&Myt(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=z0e**Math.abs(t);const d=t>0?1:-1;ge(this._tmpViewDir,r,e.eye);const p=Ie(this._tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,i[0],i[1],this.view.state.camera,Dyt);let m=v(f)?Math.min(l,f):l;m=s?Math.min(m,p):m,de(this._tmpRayDir.direction,this._tmpRayDir.direction,m),ye(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let g=m*c;const _=Math.max(zW,1.01*e.nearFar[0]);if(t>0&&g<_&&(g=_,c=g/m),Math.abs(m-g)<1e-6)return;de(this._tmpRayDir.direction,this._tmpRayDir.direction,d*(1-c)),e.eye=ye(Ok,e.eye,this._tmpRayDir.direction),e.center=ye(Ok,e.center,this._tmpRayDir.direction)}BI(this.view,e)}};CV=u([I("esri.views.3d.state.controllers.global.ZoomStepController")],CV);const Ok=$(),Mk=$(),Nyt={exclude:new Set([Um])},Fyt=.6,kyt=4,Uyt=60,Byt=14,zyt=200;let AV=class extends _v{constructor(){super(...arguments),this._zoomLocation=$(),this._tmpCamera=new Li,this._tmpRayDir=$(),this._tmpCenter=$(),this._constraintOptions={selection:hs.ALL,interactionType:fr.ZOOM,interactionFactor:null,interactionStartCamera:new Li,interactionDirection:null,tiltMode:pa.TUMBLE}}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this._constraintOptions;this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i),this._tmpCamera.copyFrom(r.camera);const s=Of(this.view.state.viewingMode);e>0?(this.view.map.ground.opacity===0?this.intersectionHelper.intersectScreenFreePointFallback(t,this._zoomLocation,jyt):this.intersectionHelper.intersectScreenFreePointFallback(t,this._zoomLocation),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:le(this._zoomLocation,this._tmpCamera.center);const n=Fyt**e;let o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,Uyt);ge(Rk,this._tmpCamera.eye,this._zoomLocation),xe(Rk,Rk);const a=Math.max(Math.min(Byt,1/Math.abs(Te(Vyt,Rk)))*Math.abs(this.view.camera.position.z),zyt);if(o=v(o)?Math.min(o,a):a,o){const l=$();ge(l,this._zoomLocation,this._tmpCamera.eye),o<Ie(l)&&(xe(l,l),ye(this._zoomLocation,this._tmpCamera.eye,de(l,l,o)))}this._updateCamera(this._tmpCamera,n,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:h4}}_updateCamera(e,t,r){ge(this._tmpRayDir,r,e.eye);const i=Ie(this._tmpRayDir);let s=i*t;const n=t<=1,o=Math.max(kyt,1.01*e.nearFar[0]);s!==0&&(n&&s<o&&(s=o,t=s/i),Math.abs(i-s)<1e-6||(de(this._tmpRayDir,this._tmpRayDir,t),e.eye=ge(V0e,r,this._tmpRayDir),e.center=$n(V0e,e.center,r,1-t),On(this.view,e,this._constraintOptions)))}};AV=u([I("esri.views.3d.state.controllers.local.ZoomStepController")],AV);const V0e=$(),Vyt=Fe(0,0,1),Rk=$(),jyt={exclude:new Set([Um])};function Gyt(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function Wle(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class Hyt extends Xa{constructor(t,r){super(!0),this._view=t,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(t){const r=t.data;if(Gyt(r,"primary")){const i=this._view.state.isGlobal?new CV({view:this._view,mode:"animation"}):new AV({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Vs(r.x,r.y)),t.stopPropagation()}}}function qyt(e,t,r){return e===Ye.Global?new Xyt(r):new Wyt(t,r)}class Wyt{constructor(t,r){this._elevationProvider=t,this._referenceEllipsoid=Kr(r),this._unitInMeters=Fc(r,this._referenceEllipsoid.metersPerDegree)}compute(t,r,i,s,n){var T;n||(n={near:0,far:0});let o=t[2]*this._unitInMeters;const a=o,l=o-s,c=(T=this._elevationProvider)==null?void 0:T.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const d={x:(i=v(i)?i:new Sr({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},p=Math.max(d.x,d.y,d.z);ge(vT,r,t),zC[0]=vT[0]>0?i.xmax:i.xmin,zC[1]=vT[1]>0?i.ymax:i.ymin,zC[2]=vT[2]>0?p/2:-p/2,ge(zC,zC,t),xe(vT,vT);const f=1.1*Te(zC,vT)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=g*Jyt*this._unitInMeters,x=g*Kyt*this._unitInMeters;let b=_e((o-x)/(_-x),0,1);b*=b*b;let w=Math.min(Ft(m,f,b),m);return w*=Math.max(Math.log(Math.abs(l)),1),w=Math.min(w,Math.max(34064e4,p)),w/=this._unitInMeters,bLe(w,Yyt,this._unitInMeters,n)}}class Xyt{constructor(t){this._referenceEllipsoid=Kr(t)}compute(t,r,i,s,n){n||(n={near:0,far:0});const o=Ie(t)-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,s),l=Math.abs(o-s),c=Math.max(l,Math.abs(o));return bLe(1.2*Math.sqrt(c*(c+2*a)),_e(2e4-(Math.log(c)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function bLe(e,t,r,i){const s=Zyt/r;return e/t>s?(i.far=e,i.near=i.far/t):(i.near=s,i.far=i.near*t),i}const Yyt=2e4,Zyt=2,Jyt=.001,Kyt=1e-4,zC=$(),vT=$();let VB=class extends be{constructor(e){super(e),this._handles=new hr}initialize(){this._handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;v(e.spatialReference)&&GDe(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>BI(this.view,e,lf.EYE_AND_CENTER))}};u([h({constructOnly:!0})],VB.prototype,"view",void 0),VB=u([I("esri.views.3d.state.ElevationCollisionConstraint")],VB);let U$=class extends be{constructor(e){super(e),this._handles=new hr,this.nearFarHeuristic=qyt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([ie(()=>{var e,t,r,i;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(i=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:i.far]},()=>this._clipDistanceNearFarChanged()),ie(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),ie(()=>this.view.renderDataExtent,()=>this._updateNearFar(),bi),ie(()=>{var e,t,r,i;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(i=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:i.max]},()=>this._updateAltitude(),bi),ie(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),bi),ie(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),bi),ie(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),bi),ie(()=>{var e,t,r,i,s,n;return[(r=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:r.type,(n=(s=(i=this.view.state)==null?void 0:i.constraints)==null?void 0:s.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),bi)]),this.view.state.isLocal&&this._handles.add(ie(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),pt)),this._updateNearFar(),this.view.state.viewingMode!==Ye.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new VB({view:this.view}))}destroy(){this._handles=Qe(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,w7(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var i,s,n;const e=(n=(s=(i=this.view.map)==null?void 0:i.ground)==null?void 0:s.navigationConstraint)==null?void 0:n.type,t=!e||e==="stay-above",r=this.view.state.constraints.collision;if(t!==r.enabled){r.enabled=t,t&&this._reapplyConstraints(hs.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ye.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Zt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const r=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(Lc(r))}}_updateLocalSurfaceDistance(e){if(C(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const r=this.view.state,i=3*t/Math.atan(r.camera.fov/2);i!==r.constraints.distance&&(r.constraints.distance=i)}_reapplyConstraints(e=hs.ALL){this.view.state.updateCamera(t=>On(this.view,t,{selection:e,interactionType:fr.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:pa.TUMBLE}))}};u([h({constructOnly:!0})],U$.prototype,"view",void 0),u([h({readOnly:!0})],U$.prototype,"surfaceCollisionConstraint",void 0),U$=u([I("esri.views.3d.state.ConstraintsManager")],U$);class ww{constructor(t){this.renderCoordsHelper=t,this.frustum=WN(),this._points=tLe(),this.lines=new Array(12),this._origin=$(),this._direction=$(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:$(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(t){rLe(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),le(this._origin,t.eye),le(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let r=0;r<this._points.length;r++)le(this._points[r],t[r]);iLe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return Gw(this.frustum,t)}intersectsRay(t){return Wgt(this.frustum,t)}intersectsLineSegment(t,r){return Xgt(this.frustum,t,r)}intersectsPoint(t){return sLe(this.frustum,t)}_updateLines(){const t=this._points;for(let r=0;r<4;r++){const i=r+4;VW(this.lines[r],t[r],t[i]),VW(this.lines[r+4],t[r],r===3?t[0]:t[r+1]),VW(this.lines[r+8],t[i],r===3?t[4]:t[i+1])}}}function VW(e,t,r){e.origin=t,e.endpoint=r,n1(e.direction,t,r)}ww.planePointIndices=Ygt,ww.nearFarLineIndices=[[ot.NEAR_BOTTOM_LEFT,ot.FAR_BOTTOM_LEFT],[ot.NEAR_BOTTOM_RIGHT,ot.FAR_BOTTOM_RIGHT],[ot.NEAR_TOP_RIGHT,ot.FAR_TOP_RIGHT],[ot.NEAR_TOP_LEFT,ot.FAR_TOP_LEFT]];let QD=class extends sv{constructor(e){super(e),this._handles=new hr}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Bs.Running,this._handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this._handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){v(e.spatialReference)&&!GDe(this.view,this.desiredCamera,e.extent,e.spatialReference)||this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),BI(this.view,e,lf.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Bs.Stopped)})}};u([h({constructOnly:!0})],QD.prototype,"desiredCamera",null),QD=u([I("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],QD);const Qyt=$(),Ik=$();function Xle(){return{direction:$(),up:$()}}function wLe(e,t,r,i,s){let n=xe(Qyt,e),o=Te(n,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Te(t,i)),o<.99?(le(n,t),a&&de(n,n,-1)):n=null);let l=0;if(n){de(Ik,i,Te(i,n)),ge(n,n,Ik);const d=Te(n,s)/(Ie(n)*Ie(s));At(Ik,n,s),l=(Te(Ik,i)>0?1:-1)*Lc(Eo(d))}const c=Lc(Eo(-Te(i,e)/Ie(e)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const xLe=Fe(0,1,0),TLe=Fe(0,0,1),NP=$e(),t_=$(),r_=$();function SLe(e,t,r,i=Xle()){const{direction:s,up:n}=i;return NRe(NP,-Zt(t)),$R(NP,NP,Zt(r)),je(s,TLe,NP),de(s,s,-1),je(n,xLe,NP),i}function e0t(e,t,r,i){return wLe(t,r,i,TLe,xLe)}function t0t(e,t,r,i){const s=SLe(e,r,i),n=$();return de(n,s.direction,-t),ye(n,n,e),{up:s.up,eye:n,heading:r,tilt:i}}function r0t(e){return Lc(e)}function i0t(e){return Zt(e)}function ELe(e,t,r,i,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return fa(t,t_,n),fa(t,r_,n),t_[0]-=r/2,r_[0]+=r/2,t_[1]-=i/2,r_[1]+=i/2,So(t_,n,t_,o),So(r_,n,r_,o),s?(s.xmin=t_[0],s.ymin=t_[1],s.xmax=r_[0],s.ymax=r_[1],s.spatialReference=o):s=new Sr(t_[0],t_[1],r_[0],r_[1],o),s}const s0t=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:SLe,directionToHeadingTilt:e0t,eyeForCenterWithHeadingTilt:t0t,lookAtTiltToEyeTilt:r0t,eyeTiltToLookAtTilt:i0t,toExtent:ELe},Symbol.toStringTag,{value:"Module"})),CLe=Fe(0,0,1),ALe=xe($(),Fe(1,1,1)),n0t=new xx(-180,180),FP=$e(),lw=$(),VC=$();function OLe(e,t,r,i=Xle()){At(lw,e,CLe),Te(lw,lw)===0&&At(lw,e,ALe),Kh(FP,-Zt(t),e),Sd(FP,FP,-Zt(r),lw);const{up:s,direction:n}=i;return At(s,lw,e),xe(s,s),je(s,s,FP),xe(n,e),Fl(n,n),je(n,n,FP),i}function o0t(e,t,r,i){const s=lw,n=VC;return xe(s,e),At(VC,s,CLe),Te(VC,VC)===0&&At(VC,s,ALe),At(n,VC,s),wLe(t,r,i,s,n)}function a0t(e,t,r,i){const s={eye:$(),up:null,tilt:i,heading:r},n=lw;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=Zt(r),l=Zt(i),c=Math.sin(a),d=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Ie(n);let g;if(Math.abs(l)<1e-8)g=o+m;else{const X=m/p,F=vf(o/X),N=Math.PI-l-F;g=X*Math.sin(N)}const _=f*o,x=o*o*(p*p),b=d*d*x,w=g-_,T=w*w,E=b*(b+T-n[1]*n[1]);if(E<0)return de(s.eye,n,g/m),s.tilt=0,s;const O=Math.sqrt(E),A=n[1]*w,R=b+T;let D;if(D=d>0?-O+A:O+A,Math.abs(R)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):de(s.eye,n,g/m),s.tilt=0,jW(s.eye),GW(s,e);s.eye[1]=D/R;const k=c*c*x,L=p*o,q=d*L*s.eye[1],G=s.eye[1]*s.eye[1],J=1-G,ee=Math.sqrt(J),se=b*G+k-2*q*ee*w+J*T;return Math.abs(se)<1e-8?(de(s.eye,n,g/m),s.tilt=0,jW(s.eye),GW(s,e)):(s.eye[0]=(J*(g*n[0]-_*n[0])-L*ee*(n[0]*s.eye[1]*d+n[2]*c))/se,s.eye[2]=(J*(g*n[2]-_*n[2])-L*ee*(n[2]*s.eye[1]*d-n[0]*c))/se,de(s.eye,s.eye,g),jW(s.eye),GW(s,e))}function jW(e){const t=e[1];e[1]=-e[2],e[2]=t}function GW(e,t){const r=OLe(t,e.heading,e.tilt);return e.up=r.up,e}function l0t(e,t,r){const i=Ie(t),s=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-e)),n=vf(r/(s/Math.sin(e)));return Lc(e-n)}function c0t(e,t,r){const i=Zt(e),s=Ie(t);return vf(r/(s/Math.sin(i)))+i}function MLe(e,t,r,i,s){let n,o,a,l;const c=t.latitude,d=Kr(e.spatialReference).radius,p=t.longitude,f=amt(c,r,d)/2;n=p-f,o=p+f;const m=Zt(c),g=(1+Math.sin(m))/(1-Math.sin(m)),_=(g+1)*Math.tan(i/d/2),x=_*_;function b(T){const E=Math.PI/2;return(T=AHe.normalize(T,-E))>E&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*g+x))),l=a+i/d,a=b(a),l=b(l),l<a){const T=l;l=a,a=T}if(a=Math.max(Lc(a),-90),l=Math.min(Lc(l),90),o=n0t.monotonic(n,o),o-n>180){const T=(o-n-180)/2;n+=T,o-=T}const w=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:Ve.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=w):s=new Sr(n,a,o,l,w),e.spatialReference&&e.spatialReference.isWebMercator&&o0(s,!1,s),s}const u0t=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:OLe,directionToHeadingTilt:o0t,eyeForCenterWithHeadingTilt:a0t,lookAtTiltToEyeTilt:l0t,eyeTiltToLookAtTilt:c0t,toExtent:MLe},Symbol.toStringTag,{value:"Module"}));function OV(e){return e.type==="point"}class RLe{constructor(t,r=null,i=0){this.array=t,this.spatialReference=r,this.offset=i}}function ILe(e){return"array"in e}function Zy(e,t,r="ground"){if(OV(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(ILe(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,yt(t.spatialReference,e.spatialReference),r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}function MV(e,t){return e!=null&&(t==null||(t===Ye.Local?!e.isGeographic||e.isWGS84||e.wkid===tf.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===tf.CGCS2000||e.wkid===tf.GCSMARS2000||e.wkid===tf.GCSMARS2000_SPHERE||e.wkid===tf.GCSMOON2000))}const PLe=te.getLogger("esri.views.3d.support.cameraUtils"),$Le=39.37,DLe=96,lre=1,d0t=8,h0t=5,LLe=1,j0e=$(),Pk=$(),p0t={heading:0,tilt:0},nv=new lt,f0t=new xx(-20037508342788905e-9,20037508342788905e-9),m0t=new xx(-180,180);var dl;function p4(e){return e.spatialReference||Ve.WGS84}function VI(e){return e.viewingMode==="global"?u0t:s0t}function g0t(e,t,r,i,s){return VI(e).headingTiltToDirectionUp(t,r,i,s)}function K_(e,t){if(C(t))return null;const r=e.renderSpatialReference,i=VI(e).headingTiltToDirectionUp,s=$();if(!fa(t.position,s,r))return null;const n=i(s,t.heading,t.tilt);de(n.direction,n.direction,e.state.camera.distance),ye(n.direction,n.direction,s);const o=pC(e,s,n.direction,n.up);return o.fov=Zt(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(dl||(dl={}));const jC=$();function sI(e,t,r){const i=e.renderSpatialReference,s=C7(e,t.eye,t.viewForward,t.up,p0t);let n=p4(e);return So(t.eye,i,jC,n)||(n=Ve.WGS84,So(t.eye,i,jC,n)),C(r)?new Zh(new lt(jC,n),s.heading,s.tilt,Lc(t.fov)):(r.position.x=jC[0],r.position.y=jC[1],r.position.z=jC[2],r.position.spatialReference=n,r.heading=s.heading,r.tilt=s.tilt,r.fov=Lc(t.fov),r)}function Yle(e,t,r){const i=e.state.camera,s=i.width/2/i.pixelRatio;return e.renderCoordsHelper.viewingMode===Ye.Global&&r!=null&&(t*=Math.cos(Zt(r))),t/=e.renderCoordsHelper.unitInMeters,s/(DLe*$Le/t)/Math.tan(i.fovX/2)}function NE(e,t,r){const i=e.state.camera,s=t*Math.tan(i.fovX/2),n=i.width/2/i.pixelRatio;let o=DLe*$Le/(n/s);return e.renderCoordsHelper.viewingMode===Ye.Global&&(o/=Math.cos(Zt(r))),o*=e.renderCoordsHelper.unitInMeters,o}function NLe(e,t,r,i,s,n){return FLe(e,t,Yle(e,r,t.latitude),i,s,n)}function FLe(e,t,r,i,s,n){if(G2(n)){const a=new jI(n.signal);return JN(e,i.heading,i.tilt,t,r,s,a),void a.resolver.promise.then(l=>{const c=IV(e,l,i.fov);if(!C(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=JN(e,i.heading,i.tilt,t,r,s);return IV(e,o,i.fov,n)}function C7(e,t,r,i,s){return VI(e).directionToHeadingTilt(t,r,i,s)}function y0t(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,nv,e.spatialReference)&&yt(Zy(e.elevationProvider,nv),0)>nv.z-LLe)}async function _0t(e,t,r){if(!e.renderCoordsHelper.fromRenderCoords(t,nv,e.spatialReference))return!1;const i=await e.elevationProvider.queryElevation(nv.x,nv.y,nv.z,nv.spatialReference,"ground",r);return yt(i,0)>nv.z-LLe}async function v0t(e,t,r){const i=$();if(t)if(t instanceof lt){if(fa(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",r);return v(s)&&e.renderCoordsHelper.setAltitude(i,s),i}}else le(i,t);else le(i,e.state.camera.center);return i}function b0t(e,t){const r=$();if(t&&t instanceof lt){if(fa(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const i=Zy(e.elevationProvider,t);v(i)&&e.renderCoordsHelper.setAltitude(r,i)}}else le(r,t||e.state.camera.center);return r}function JN(e,t,r,i,s,n,o){const a=i&&i instanceof lt?i:null;if(G2(o))return v0t(e,i,o.signal).then(c=>{cre(e,t,r,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=b0t(e,i);return cre(e,t,r,a,l,s,n,o)}function cre(e,t,r,i,s,n,o,a){if(C(i)){const p=e.renderSpatialReference;if(i=Cx(s,p,p4(e)),C(i))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=T0t(e,t,r,s,n,o),c=(0,VI(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===dl.ADJUST&&e.viewingMode==="global"&&r>0){const p=()=>{const m=kLe(e,s,n,E0t(e,n,r,s));return o=r-m<1?dl.LOCKED:dl.ADJUST,cre(e,t,m,i,s,n,o,a)},f=e.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(y0t(e,c.eye))return p();if(G2(a))return _0t(e,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:ws(s),heading:c.heading,tilt:c.tilt}),null)),null}}const d=!a||G2(a)?{center:$(),eye:$(),up:$(),tilt:0,heading:0}:a;return d.eye=c.eye,d.up=c.up,d.center=ws(s),d.heading=c.heading,d.tilt=c.tilt,G2(a)&&a.resolver.resolve(d),d}function eL(e,t,r,i,s,n=null){const o=t.zmax!=null&&t.zmin!=null;let a,l,c;if(e.state.isGlobal){if(!MV(t.spatialReference,Ye.Global))return G2(n)&&n.resolver.reject(),null;const b=new lt(t.xmin,t.ymin,t.spatialReference),w=new lt(t.xmax,t.ymax,t.spatialReference),T=t.spatialReference.isGeographic?m0t:f0t;a=new lt({x:T.center(b.x,w.x),y:(w.y+b.y)/2,z:o?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const E=Kr(t.spatialReference),O=omt(a,b,w);l=O.lon,c=O.lat,T.diff(b.x,w.x)>T.range/2&&(l+=E.halfCircumference),l=Math.min(l,E.halfCircumference),c=Math.min(c,E.halfCircumference)}else{const b=yt(e.renderSpatialReference,t.spatialReference);b.equals(t.spatialReference)||(t=cC(t,b)),l=t.xmax-t.xmin,c=t.ymax-t.ymin;const w=o?(t.zmax+t.zmin)/2:null;a=new lt({x:t.xmin+.5*l,y:t.ymin+.5*c,z:w,spatialReference:b})}const d=o?t.zmax-t.zmin:0,p=e.state.camera,f=1/Math.tan(p.fovX/2),m=1/Math.tan(p.fovY/2),g=1/Math.tan(p.fov/2),_=Math.max(.5*l*f,.5*c*m,.5*d*g)/lre;if(G2(n)){const b=new jI(n.signal);return JN(e,r,i,a,_,s,b),void b.resolver.promise.then(w=>{const T=IV(e,w,e.camera.fov);if(!C(T))return n.resolver.resolve(T);n.resolver.reject()},w=>n.resolver.reject(w))}const x=JN(e,r,i,a,_,s);return IV(e,x,e.camera.fov,n)}function w0t(e,t,r){const i=e.renderSpatialReference,s=Cx(r,i,p4(e));if(C(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=J9(t.eye,r),l=2*a*n*lre,c=2*a*o*lre;return e.viewingMode==="global"?MLe(e,s,l,c):ELe(e,s,l,c)}function x0t(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>d0t)return!0;const s=e.renderSpatialReference,n=p4(e),o=Cx(t,s,n),a=Cx(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(C(o)||C(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*i;return a.distance(o)/l>h0t}function T0t(e,t,r,i,s,n){let o=0;return n===dl.ADJUST&&x0t(e,i,s)?(t=0,o=S0t(e,s,r,i)):o=Zle(e,i,s,r),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:r=kLe(e,i,s,o)}}const RV=.7;function S0t(e,t,r,i){const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const n=s.min*(1-RV)+s.max*RV,o=Zle(e,i,t,r);return Math.min(o,n)}function E0t(e,t,r,i){const s=e.state.constraints.tilt(t);let n=Zle(e,i,t,r);return n=Math.min(n,.5*Math.PI),s.min*(1-RV)+n*RV}function kLe(e,t,r,i){return VI(e).lookAtTiltToEyeTilt(i,t,r)}function Zle(e,t,r,i){return VI(e).eyeTiltToLookAtTilt(i,t,r)}function IV(e,t,r,i){if(C(t))return null;const s=e.renderSpatialReference,n=Cx(t.eye,s,p4(e));return C(n)?null:v(i)?(i.position=n,i.heading=t.heading,i.tilt=t.tilt,i.fov=r,i):new Zh(n,t.heading,t.tilt,r)}function C0t(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(t);PLe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function ULe(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(t);PLe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function BLe(e,t,r){const i=e.renderSpatialReference;let s,n;t||(t=e.state.camera);const o=Ve.WGS84;return t instanceof Zh?(s=t.position.latitude,fa(t.position,j0e,i),fa(r,Pk,i),n=Ni(j0e,Pk)):(So(t.center,i,Pk,o),s=Pk[1],n=t.distance),NE(e,n,s)}class jI{constructor(t){this.signal=t,this.resolver=_x()}}function G2(e){return e&&"resolver"in e}const A0t=.66;function zLe(e){return 360-Ine.normalize(e)}function A7(e){return Ine.normalize(360-e)}function $k(e){return v(e)&&e.resolver&&e.resolver.reject(),null}function O0t(e,t){return v(e)&&e.resolver&&e.resolver.resolve(t),t}function VLe(e,t,r,i=null){if(!t)return $k(i);const s=e.spatialReference||Ve.WGS84;if(v(t.camera)){const c=QE(t.camera.position,s);if(C(c))return $k(i);const d=t.camera.clone();return d.position=c,O0t(i,d)}if(C(t.targetGeometry))return $k(i);const n=t.get("targetGeometry.spatialReference");if(n&&!nx(n,s))return $k(i);const o=sI(e,e.state.camera);let a=dl.ADJUST;if(t.rotation!=null&&(o.heading=zLe(t.rotation),a=dl.LOCKED),r!=null&&(o.tilt=r),t.targetGeometry.type==="point"){const c=t.targetGeometry;let d;const p=t.targetGeometry.clone();return d=t.scale!=null?Yle(e,t.scale,c.latitude):e.state.camera.distance,FLe(e,p,d,o,a,i)}const l=t.targetGeometry.extent;return eL(e,l,o.heading,o.tilt,a,i)}function M0t(e,t,r=null){return C(r)&&(r=new Fd),Qle(e,null,t.clone(),r)}async function R0t(e,t,r){const i=B0t(e,t);if(!i)throw new z("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Zh({fov:e.camera.fov}),n=new Fd({camera:s});if(i.target instanceof Fd)return bT(await $0t(e,i.target,i,r,n));if(i.target instanceof Zh)return bT(GLe(e,i.target,n));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof Sr){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return bT(o||c?await ure(e,i,i.target.center,s,r,n):await F0t(e,i,i.target,s,r,n))}const a={boundingBox:es(),hasZ:!1,screenSpaceObjects:[]},l=o?I0t(e,i):void 0;if(await jLe(e,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(Gm(a.boundingBox,En),bh.x=En[0],bh.y=En[1],bh.z=En[2],bh.spatialReference=e.spatialReference,isFinite(bh.z)&&a.hasZ?c=voe(a.boundingBox):(bh.z=void 0,c=TZe(_oe(a.boundingBox,V0t))),o||c)return bT(await ure(e,i,bh,s,r,n));const d=z0t(e,a.screenSpaceObjects);return bT(await U0t(e,i,bh,a.boundingBox,d,s,r,n))}return i.position?bT(L0t(e,i,s,n)):bT(await N0t(e,i,s,r,n))}function Jle(e,t){return t.scale==null&&t.zoom!=null?ULe(e,t.zoom):t.scale}function I0t(e,t){return nat(Jle(e,t))}function Kle(e,t){let r=!1;return t.heading!=null?(e.heading=t.heading,r=!0):t.rotation!=null&&(e.heading=zLe(t.rotation),r=!0),t.tilt!=null&&(e.tilt=t.tilt,r=!0),t.fov!=null&&(e.fov=t.fov),r}function Qle(e,t,r,i){const s=e.spatialReference||Ve.WGS84;return t=v(t)?t:K_(e,r),C(t)||(i.targetGeometry=Cx(t.center,e.renderSpatialReference,s),i.scale=BLe(e,t),i.rotation=A7(r.heading),i.camera=r),i}function PV(e,t,r){var a;const i=()=>new z("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!t)throw i();if(!nx(t.spatialReference,e.spatialReference))throw new z("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const s=[];if(!t.hasZ&&e.basemapTerrain){let l;switch(t.type){case"point":l=t;break;case"multipoint":case"polyline":l=(a=t.extent)==null?void 0:a.center;break;case"mesh":l=t.origin;break;case"extent":l=t.center;break;case"polygon":l=t.centroid}l&&v(e.basemapTerrain.spatialReference)&&nx(l,e.basemapTerrain.spatialReference)?En[2]=yt(Zy(e.elevationProvider,l),0):En[2]=0}(0,j0t[t.type])(t,l=>{s.push(l[0],l[1],l[2])},En);const n=s.length/3;if(n===0)throw i();const o=new Array(s.length);if(Yi(s,t.spatialReference,0,o,e.spatialReference,0,n)){t.hasZ&&(r.hasZ=!0);for(let l=0;l<o.length;l+=3)t.hasZ?(En[0]=o[l+0],En[1]=o[l+1],En[2]=o[l+2]):(En[0]=o[l+0],En[1]=o[l+1]),x0(r.boundingBox,En)}}async function P0t(e,t,r,i){const s=await Jh(e.whenViewForGraphic(t));if(s.ok===!1||C(s.value)||!("whenGraphicBounds"in s.value))return void PV(e,t.geometry,i);const n=s.value,o=await Jh(n.whenGraphicBounds(t,{minDemResolution:r}));if(o.ok===!1)return void PV(e,t.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;CR(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function jLe(e,t,r,i){if(Array.isArray(t)&&t.length===2){const s=t[0],n=t[1];if(typeof s=="number"&&typeof n=="number")return bh.x=s,bh.y=n,bh.z=void 0,bh.spatialReference=e.spatialReference.isGeographic?e.spatialReference:Ve.WGS84,void PV(e,bh,i)}t&&typeof t.map=="function"?await zo(t.map(s=>jLe(e,s,r,i))):t instanceof Xx?PV(e,t,i):t instanceof _i&&await P0t(e,t,r,i)}async function $0t(e,t,r,i,s){if(v(t.camera))return GLe(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=v(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,r.heading!=null?s.rotation=A7(r.heading):r.rotation!=null&&(s.rotation=r.rotation);const n=Jle(e,r);n!=null&&(s.scale=n);const o=new jI(i);return VLe(e,s,r.tilt,o),s.camera=await o.resolver.promise,s}function GLe(e,t,r){const i=e.spatialReference,s=QE(t.position,i);return C(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,Qle(e,null,t,r))}function D0t(e,t,r,i,s,n){const o=e.renderSpatialReference;return fa(r.position,Lk,o),fa(t,HW,o),n.targetGeometry=new lt(t),s.position=new lt(r.position),ge($V,HW,Lk),C7(e,Lk,$V,i.up,s),n.scale=NE(e,Ni(Lk,HW),n.targetGeometry.latitude),n.rotation=A7(s.heading),n.camera=s,n}async function ure(e,t,r,i,s,n){if(C(r))throw new z("createfromcenter","invalid point");n.targetGeometry=r.clone();const o=pC(e);if(t.position)return D0t(e,n.targetGeometry,t,o,i,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=de(En,o.viewForward,-l);o.eye=ye(En,o.center,c),n.scale=NE(e,l,r.latitude)}sI(e,o,i);const a=Kle(i,t)?dl.LOCKED:dl.ADJUST;if(!t.zoomFactor){n.scale=Jle(e,t),n.scale==null&&(fa(r,En,e.renderSpatialReference),sLe(o.frustum,En)?n.scale=NE(e,Ni(o.eye,En),r.latitude):n.scale=BLe(e,o));const l=new jI(s);NLe(e,n.targetGeometry,n.scale,i,a,l),n.camera=await l.resolver.promise}return n}function L0t(e,t,r,i){const s=pC(e);return le($V,s.viewForward),C7(e,s.eye,$V,s.up,qW),r.position=new lt(t.position),r.heading=t.heading!=null?t.heading:qW.heading,r.tilt=t.tilt!=null?t.tilt:qW.tilt,Qle(e,null,r,i)}async function N0t(e,t,r,i,s){const n=pC(e);return ure(e,t,Cx(n.center,e.renderSpatialReference,e.spatialReference),r,i,s)}async function F0t(e,t,r,i,s,n){n.targetGeometry=r.clone();const o=pC(e);sI(e,o,i);const a=Kle(i,t)?dl.LOCKED:dl.ADJUST,l=new jI(s);return eL(e,r,i.heading,i.tilt,a,l),n.camera=await l.resolver.promise,n}function k0t(e,t,r,i,s){let n=0;r.hasZ?n=r.z:e.basemapTerrain&&(n=Zy(e.elevationProvider,r)),ue(En,r.x,r.y,n),Qh(e.spatialReference,En,G0e,e.renderSpatialReference),Tf(Dk,G0e),Sf(Dk,Dk),es(kP);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const _=o[g];let x=i[_[2]];isFinite(x)||(x=n),ue(En,i[_[0]],i[_[1]],x),So(En,e.spatialReference,En,e.renderSpatialReference),x0(kP,Td(En,En,Dk))}const a=tC(kP),l=Kx(kP),c=rC(kP),d=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,d)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function U0t(e,t,r,i,s,n,o,a){a.targetGeometry=r.clone();const l=pC(e),c=k0t(e,l,r,i,s);sI(e,l,n);const d=Kle(n,t)?dl.LOCKED:dl.ADJUST;a.scale=NE(e,c,a.targetGeometry.latitude);const p=new jI(o);return NLe(e,a.targetGeometry,a.scale,n,d,p),a.camera=await p.resolver.promise,a}function B0t(e,t){if(!t||!e.spatialReference)return null;const r={target:null};if("declaredClass"in t||Array.isArray(t))r.target=t;else{for(const i in t)r[i]=t[i];t.center&&!r.target&&(r.target=t.center)}return r}function bT(e){return e&&v(e.camera)&&(e.rotation=A7(e.camera.heading)),e}function z0t(e,t){const r=A0t;if(!t.length)return r;let i=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;i=Math.max(i,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return r-i/Math.min(e.width,e.height)*2}const En=$(),G0e=$e(),Dk=Ts(),kP=ao(),V0t=tr(),$V=$(),Lk=$(),HW=$(),qW={heading:0,tilt:0},bh=new lt,j0t={point(e,t,r){r[0]=e.x,r[1]=e.y,e.hasZ&&(r[2]=e.z),t(r)},polygon(e,t,r){const i=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),t(r)}},polyline(e,t,r){const i=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)r[0]=n[o][0],r[1]=n[o][1],i&&(r[2]=n[o][2]),t(r)}},multipoint(e,t,r){const i=e.points,s=e.hasZ;for(let n=0;n<i.length;n++)r[0]=i[n][0],r[1]=i[n][1],s&&(r[2]=i[n][2]),t(r)},extent(e,t,r){e.hasZ?(t(ue(r,e.xmin,e.ymin,e.zmin)),t(ue(r,e.xmax,e.ymin,e.zmin)),t(ue(r,e.xmin,e.ymax,e.zmin)),t(ue(r,e.xmax,e.ymax,e.zmin)),t(ue(r,e.xmin,e.ymin,e.zmax)),t(ue(r,e.xmax,e.ymin,e.zmax)),t(ue(r,e.xmin,e.ymax,e.zmax)),t(ue(r,e.xmax,e.ymax,e.zmax))):(t(ue(r,e.xmin,e.ymin,r[2])),t(ue(r,e.xmax,e.ymin,r[2])),t(ue(r,e.xmin,e.ymax,r[2])),t(ue(r,e.xmax,e.ymax,r[2])))},mesh(e,t,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(i)for(let s=0;s<i.length;s+=3)t(ue(r,i[s+0],i[s+1],i[s+2]))}};class G0t{constructor(t,r,i){this.target=t,this.options=r,this.view=i,this.state="pending",this._abortController=null,this._animationController=null,this._promise=new Promise((s,n)=>{this._resolveCallback=s,this._rejectCallback=n;const o=new AbortController;v(this.options.signal)&&jl(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(t,r){return this._promise.then(t,r)}catch(t){return this._promise.catch(t)}resolve(t){return this.state="finished",this._resolveCallback(t)}reject(t){return this.state="finished",this._rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(oi());break;case"wait-for-animation-finish":!t&&v(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(oi())}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await vx(()=>this.view.ready,this._abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,R0t(this.view,this.target,this._abortController.signal).then(t=>{if(this.state==="finished")return;const r=this._getCameraFromViewpoint(t);if(!C(r))if(this.options.animate){if(C(this._animationController))return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const r=!!(this.target instanceof Fd&&this.target.camera||this.target instanceof Zh),i=t.camera;if(C(i))return null;if(!this.view.stateManager.isCompatible(i)){const n=i.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference.wkid;return this.reject(new z("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:i})),null}const s=K_(this.view,i);return C(s)?(this.reject(new z("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:r}}startAnimation(t,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(C(i))return void this.reject(new z("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(t.viewpoint,"running"),!r.active||C(r.viewAnimation)||r.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==r)return this.abort();let s;t.isFullySpecified?(s=new QD({view:this.view,desiredCamera:t.camera}),BI(this.view,t.camera,lf.EYE_AND_CENTER)):On(this.view,t.camera),r.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof _v&&v(a.viewAnimation)&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):v(r.viewAnimation)&&r.viewAnimation.target===t.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!C(this.view.state))switch(r.state){case Bs.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Bs.Ready:case Bs.Rejected:case Bs.Running:case Bs.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(n,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t,r=null;const i=this.view.state.cameraController;return i instanceof _v&&(i.updateStateFromViewAnimation(),i.active&&(t=i,r=t.viewAnimation)),t!=null||(t=new _v({view:this.view,mode:"animation"}),r=t.viewAnimation,this.view.state.switchCameraController(t))?t:(v(r)&&r.stop(),this.reject(new z("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}let Ro=class extends be{constructor(e){super(e),this._propertiesPool=new Jv({frustum:ww},this),this._handles=new hr,this._cameraSetByUser=!1,this._gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this._cameraChangeTime=0,this.test={contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,setMaximumPixelRatio:t=>this._maximumPixelRatioOverride=t,renderState:null}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=sI(this.view,this.view.state.camera,WW);return t&&e&&t.equals(e)?e:t.clone()}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(K_(this.view,e),{applyConstraints:!1})||te.getLogger(this.declaredClass).error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=sI(this.view,this.view.state.contentCamera,WW);return t&&e&&t.equals(e)?e:t.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=K_(this.view,e);C(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this._handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,r=this.view.state.camera.distance**2,i=pu(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this._handles.add([ie(()=>this.contentCamera,()=>{e.sticky||(this._handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),ie(()=>this.zoom,n=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)}),ie(()=>this.view.state.camera,n=>{const o=jo(i,n.center);this.test.contentCameraResetState.set("camera.center",o/r),o>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():te.getLogger(this.declaredClass).error("#center=","Invalid center",e):te.getLogger(this.declaredClass).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):te.getLogger(this.declaredClass).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=w0t(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return v(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||te.getLogger(this.declaredClass).error("#extent=","Invalid extent",e):te.getLogger(this.declaredClass).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):te.getLogger(this.declaredClass).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return NE(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||te.getLogger(this.declaredClass).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,r=e.pixelRatio,i=this._get("padding"),s=Math.round(t[Vt.TOP]/r),n=Math.round(t[Vt.RIGHT]/r),o=Math.round(t[Vt.BOTTOM]/r),a=Math.round(t[Vt.LEFT]/r);return i!=null&&i.top===s&&i.right===n&&i.bottom===o&&i.left===a?i:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,Nk),this.view.state.updateCamera(t=>t.padding=Nk))}_paddingToArray(e,t,r){e?Oi(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Oi(r,0,0,0,0);for(let i=0;i<4;i++)r[i]=Math.round(r[i]*t)}get screenCenter(){const e=this.padding;return hg((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?M0t(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||te.getLogger(this.declaredClass).error("#viewpoint=","Invalid viewpoint",e);else{const t=v(e.camera)?e.camera.position:e.targetGeometry,r=v(t)&&t.spatialReference;te.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else te.getLogger(this.declaredClass).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?C0t(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||te.getLogger(this.declaredClass).error("#zoom=","Invalid zoom",e)}get maximumPixelRatio(){if(v(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:r}=this.view.qualitySettings;if(t!=null&&(e=Math.min(e,t)),r!=null){const i=r/Math.max(this.view.width,this.view.height);e=Math.min(e,i)}return e}get _devicePixelRatio(){return C(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this._cameraChangeTime=performance.now(),this._handles.add([ms(()=>this.view.state.events,"before-camera-change",e=>this._updateElevation(e.camera)),ie(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,t)=>this._cameraChangedHandler(e,t),bi)]),no(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this._handles.add([cR({prepare:()=>this._prepareFrame()}),ie(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this._handles.remove(Fk)}),ms(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._handles&&(this._handles.destroy(),this._handles=null),this._propertiesPool&&(this._propertiesPool.destroy(),this._propertiesPool=null)}init(){this.constraintsManager=new U$({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this._cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Ye.Local&&this._handles.add(no(()=>this.view.basemapTerrain.ready,()=>{this._handles.remove(Fk),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),Fk)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this._handles.remove(Fk),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const r={animate:!0,...t};return v(this._gotoOperation)&&this._gotoOperation.abort(r.animate),this._gotoOperation=new G0t(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(pC(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,r=t==null?void 0:t.cameraController;r&&(t.updateCamera(i=>r.stepController(e,i)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){v(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:r,overrides:i}of q0t){const s=e.has(r),n=this._isOverridden(r);!s&&n&&t.push({name:r,value:this._get(r)}),this._clearOverride(r),(s||n)&&i.forEach(o=>e.add(o))}return t}_setInitialView(e){if(C(e)||this._cameraSetByUser)return;if(e instanceof Zh)return void this.setStateCamera(K_(this.view,e),{applyConstraints:!1});if(e instanceof Fd){if(e.targetGeometry instanceof Sr){const s=eL(this.view,e.targetGeometry,0,.5,dl.LOCKED);return void(v(s)&&this.setStateCamera(K_(this.view,s),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},i=this._viewpointToCamera(e);return void this.setStateCamera(i,r)}const t=eL(this.view,e,0,.5,dl.LOCKED);v(t)&&this.setStateCamera(K_(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&H0t.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!C(e)&&(e instanceof Fd?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Zh?this.isCompatible(e.position):e.spatialReference&&nx(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=W0t){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,r=q1){const{heading:i,tilt:s}=this._getPreservingHeadingTilt(),n=JN(this.view,i,s,e,t,dl.ADJUST);return C(n)?null:(r.copyFrom(this.view.state.camera),r.eye=n.eye,r.center=n.center,r.up=n.up,r)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:t,tilt:r}=this._getPreservingHeadingTilt(),i=eL(this.view,e,t,r,dl.ADJUST,WW);return v(i)?K_(this.view,i):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.renderLocation,i=t.location.latitude,s=Yle(this.view,e,i);return this._centerPointAtDistanceToCamera(r,s)}_zoomToCamera(e){return this._scaleToCamera(ULe(this.view,e))}_viewpointToCamera(e){return K_(this.view,VLe(this.view,e))}setStateCamera(e,t){return!(C(e)||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{t.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),t.applyConstraints&&On(this.view,r)}),t.applyConstraints||(this.view.state.cameraController=new QD({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._devicePixelRatio,i=Math.round(e.clientWidth*r),s=Math.round(e.clientHeight*r);if(i!==0&&s!==0&&(t.width===i&&t.height===s||(t.width=i,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===i&&n.fullHeight===s&&n.pixelRatio===r||(q1.copyFrom(n),q1.pixelRatio!==r&&(this._paddingToArray(this.padding,r,Nk),q1.padding=Nk),q1.fullWidth=i,q1.fullHeight=s,q1.pixelRatio=r,this.view.state.camera=q1),this._updateRenderState()}}_updateElevation(e){var s,n;const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=(n=(s=this.view.renderCoordsHelper)==null?void 0:s.getAltitude(e.eye))!=null?n:0,i=t?w7(this.view,e.eye):0;e.relativeElevation=r-i}_updateRenderState(){v(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Kn.ANIMATING:this.view.interacting?this.view.state.mode=Kn.INTERACTING:(this.view.state.mode===Kn.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=X0t?this.view.state.mode=Kn.INTERACTING:this.view.state.mode=Kn.IDLE)}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateRenderState())}};u([h({type:Zh,dependsOn:["view.state.camera","ready"]})],Ro.prototype,"camera",null),u([h({type:Zh,dependsOn:["view.state.contentCamera","ready"]})],Ro.prototype,"contentCamera",null),u([h({type:lt})],Ro.prototype,"center",null),u([h({type:Sr})],Ro.prototype,"extent",null),u([h({readOnly:!0})],Ro.prototype,"frustum",null),u([h({readOnly:!0})],Ro.prototype,"hasInitialView",null),u([h({readOnly:!0,type:Boolean})],Ro.prototype,"ready",void 0),u([h({type:Number})],Ro.prototype,"scale",null),u([h()],Ro.prototype,"padding",null),u([h({readOnly:!0})],Ro.prototype,"screenCenter",null),u([h({constructOnly:!0})],Ro.prototype,"view",void 0),u([h({type:Fd})],Ro.prototype,"viewpoint",null),u([h({type:Number})],Ro.prototype,"zoom",null),u([h()],Ro.prototype,"maximumPixelRatio",null),u([h()],Ro.prototype,"_devicePixelRatio",null),u([h()],Ro.prototype,"_windowDevicePixelRatio",void 0),u([h()],Ro.prototype,"_devicePixelRatioOverride",void 0),u([h()],Ro.prototype,"_maximumPixelRatioOverride",void 0),Ro=u([I("esri.views.3d.state.ViewStateManager")],Ro);const H0t=["camera","viewpoint","extent","scale","center","zoom"],q0t=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],W0t={heading:0,tilt:0},WW=new Zh,q1=new Li,Nk=Lr(),Fk="pending-initial-view",X0t=300,H0e=100;let Jy=class extends sv{constructor(){super(...arguments),this.startCamera=new Li,this.currentCamera=new Li,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<H0e}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=Bs.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),H0e),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};u([h({readOnly:!0})],Jy.prototype,"isInteractive",null),u([h()],Jy.prototype,"_lastInteraction",void 0),Jy=u([I("esri.views.3d.state.controllers.InteractiveController")],Jy);var ud;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(ud||(ud={}));const Y0t=7,XW=90;let tL=class extends Jy{constructor(e){super(e),this.pivot=ud.CENTER,this._lastPoint=rt(),this._tmpWorldUp=$(),this._tmpViewDir=$(),this._tmpRotCurPoint=rt(),this._tmpTransf=$e(),this._tmpAxis=$(),this._tmpPivotPoint=$(),this._pivotPos=$(),this._constraintOptions={selection:hs.ALL,interactionType:fr.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:pa.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this._rotScale=this.pivot===ud.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case ud.EYE:le(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=fr.LOOK_AROUND,this._constraintOptions.tiltMode=pa.LOOK_AROUND,this._constraintOptions.selection=hs.NONE;break;case ud.CENTER:{const t=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos);t||le(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=fr.TUMBLE,this._constraintOptions.tiltMode=pa.TUMBLE,this._constraintOptions.selection=hs.ALL&~hs.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,j2(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,t){const r=this.startCamera,i=$();ge(i,this._pivotPos,r.eye);const s=Ie(i);let n=Math.min(s,Y0t*Math.abs(this.view.camera.position.z));const o=Kr(this.view.spatialReference),a=Vs(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),l=E7(this.startCamera,a,!0,o);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*XW,XW),d=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],r,XW);(v(c)||v(d))&&(c=yt(c,d),d=C(d)||l===za.Horizontal?c:d,n=c>d?d:c,n=t?Math.min(n,s):n),xe(i,i),le(this._pivotPos,ye(this._tmpPivotPoint,r.eye,de(this._tmpPivotPoint,i,n)))}update(e){if(this.active){switch(this.pivot){case ud.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case ud.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}On(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,t,r,i){this.view.renderCoordsHelper.worldUpAtPosition(i,this._tmpWorldUp),j2(e,t,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,n=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ge(this._tmpViewDir,r,i);const o=Ie(this._tmpViewDir),a=Eo(Te(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===ud.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=_e(s+a,al.min,al.max)-a,At(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===ud.CENTER&&(n=-n),Kh(this._tmpTransf,n,this._tmpWorldUp),Sd(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),je(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=je(YW,e.up,this._tmpTransf),ye(YW,i,this._tmpViewDir),Ho(this._lastPoint,this._tmpRotCurPoint),YW}};u([h()],tL.prototype,"pivot",void 0),tL=u([I("esri.views.3d.state.controllers.RotateController")],tL);const YW=$();class ZW extends Xa{constructor(t,r,i,s){super(!0),this._view=t,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const r=t.data;if(r.pointers.size>1||!Wle(t.data,this.pointerAction))return;const i=Vs(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new tL({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}t.stopPropagation()}}let dre=class extends Jy{constructor(){super(...arguments),this._pickPoint=$(),this._tmpP0=rt(),this._panAxisAngle=S7(),this._tmpRayDir=$(),this._tmpRayDirPick=$(),this._targetOnSphere=$(),this._tmpRay={origin:$(),direction:$()},this.dragBeginPoint=Vs(),this._normalizedAnchorPoint=rt(),this._constraintOptions={selection:hs.ALL_EXCEPT_COLLISION,interactionType:fr.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:pa.TUMBLE},this._sphere=qo(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Ho(this.dragBeginPoint,e),j2(this.startCamera,e,this._normalizedAnchorPoint);const t=Kr(this.view.spatialReference),r=hLe(this._intersectionHelper,this.startCamera,e,t,iI.Ellipsoid,this.view.map.ground.opacity===0?Z0t:{});if(this._navMode=E7(this.startCamera,e,r.hasGeometryIntersection,t),this._navMode===za.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=yt(r.scenePickPoint,this._pickPoint),this._sphere=r.sphere;else{let i,s;zI(this.startCamera,e,this._tmpRay),xe(this._tmpRay.direction,this._tmpRay.direction),v(r.scenePickPoint)&&(ge(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=Ie(this._tmpRayDirPick)),this.view.camera.position.hasZ&&(i=Math.abs(this.view.camera.position.z));let n=_e(lLe*i,xV[0],xV[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,cLe);n=v(o)?Math.min(n,o):n,n=r.scenePickPoint?Math.min(n,s):n,this._hasPickPoint=!0,de(this._tmpRay.direction,this._tmpRay.direction,n),ye(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===za.Horizontal){ge(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Ie(this._tmpRayDir);j2(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let i=t*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<s&&(i=s),Math.abs(t-i)<1e-6)return;if(this._hasPickPoint&&i<t){const n=1-(1-i/t)*(1-this._sphere[3]/Ie(this.currentCamera.center));this.currentCamera.center=de(kk,this.currentCamera.center,n)}de(this._tmpRayDir,this._tmpRayDir,-i/t),this.currentCamera.eye=ye(kk,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Fm(TE(this.dragBeginPoint,e)),On(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(ZN(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),zle(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Ux(this.currentCamera,this._sphere,this._panAxisAngle))}else{const t=Ie(this._tmpRay.direction);j2(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let i=t*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<s&&(i=s),Math.abs(t-i)<1e-6)return;de(this._tmpRayDir,this._tmpRay.direction,1-i/t),this.currentCamera.eye=ye(kk,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=ye(kk,this.currentCamera.center,this._tmpRayDir)}BI(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};dre=u([I("esri.views.3d.state.controllers.global.ZoomController")],dre);const kk=$(),Z0t={exclude:new Set([Um])};let hre=class extends Jy{constructor(){super(...arguments),this._tmpP=$(),this._tmpDir=$(),this._tmpN=$(),this._tmpP0=rt(),this._tmpPoi=$(),this._tmpRayDir=$(),this.dragBeginPoint=Vs(),this._normalizedAnchorPoint=rt(),this._constraintOptions={selection:hs.ALL,interactionType:fr.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:$(),tiltMode:pa.TUMBLE},this._plane=di()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Ho(this.dragBeginPoint,e),j2(this.startCamera,e,this._normalizedAnchorPoint);const t=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?J0t:{});ge(this._tmpDir,this._tmpP,this.startCamera.eye);const r=Ie(this._tmpDir);let i;xe(this._tmpDir,this._tmpDir),this.view.camera.position.hasZ&&(i=Math.abs(this.view.camera.position.z));let s=_e(lLe*i,xV[0],xV[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,cLe);s=v(n)?Math.min(s,n):s,s=t?Math.min(s,r):s,de(this._tmpDir,this._tmpDir,s),ye(this._tmpP,this.startCamera.eye,this._tmpDir),ge(this._tmpN,this.startCamera.eye,this.startCamera.center),xe(this._tmpN,this._tmpN),this._tmpN[1]<0&&Fl(this._tmpN,this._tmpN),BR(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;Cyt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||le(this._tmpPoi,this.currentCamera.center),j2(this.currentCamera,e,this._tmpP0);let t=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Ho(this._normalizedAnchorPoint,this._tmpP0),ge(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=Ie(this._tmpRayDir);let i=r*(1-t);le(this._constraintOptions.interactionDirection,this._tmpRayDir),de(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(t)/r);const s=this.view.state.constraints.minimumPoiDistance;t>=0&&i<s&&(i=s,t=-(i-r)/r),Math.abs(r-i)<1e-6||(de(this._tmpRayDir,this._tmpRayDir,t),this.currentCamera.eye=ye(wT,this.currentCamera.eye,this._tmpRayDir),$n(wT,this.currentCamera.center,this._tmpPoi,t),this._tmpPoi[2]>this.startCamera.center[2]?wT[2]=Math.max(this.startCamera.center[2],wT[2]):wT[2]=Math.min(this.startCamera.center[2],wT[2]),this.currentCamera.center=wT,this._constraintOptions.interactionFactor=Fm(TE(this.dragBeginPoint,e)),On(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};hre=u([I("esri.views.3d.state.controllers.local.ZoomController")],hre);const wT=$(),J0t={exclude:new Set([Um])};class K0t extends Xa{constructor(t,r,i){super(!0),this._view=t,this.pointerAction=r,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(t){const r=t.data;if(r.pointers.size>1||!Wle(t.data,this.pointerAction))return;const i=Vs(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new dre({view:this._view}):this._cameraController=new hre({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}t.stopPropagation()}}function jf(e){let t=e*e;return e<0&&(t*=-1),t}function q0e(e,t,r){const i=r,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(i.translation[0]=jf(s.axes[0]),i.translation[1]=jf(s.axes[1]),i.translation[2]=jf(s.buttons[7])-jf(s.buttons[6]),i.heading=jf(s.axes[2]),i.tilt=jf(s.axes[3])):n.deviceType==="spacemouse"&&(i.translation[0]=1.2*jf(s.axes[0]),i.translation[1]=1.2*jf(s.axes[1]),i.translation[2]=2*-jf(s.axes[2]),i.heading=1.2*jf(s.axes[5]),i.tilt=1.2*jf(s.axes[3])),i.tilt*=o,de(i.translation,i.translation,a),i}function W0e(e,t){const r=t;return r.translation[0]=e[1]-e[0],r.translation[1]=e[3]-e[2],r.translation[2]=e[4]-e[5],r.heading=e[7]-e[6],r.tilt=e[8]-e[9],r.zoom=e[10]-e[11],r}function JW(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let C2=class extends Jy{constructor(e){super(e),this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Li,this._constraintOptions={selection:hs.ALL,interactionType:fr.NONE,interactionStartCamera:new Li,interactionFactor:0,interactionDirection:null,tiltMode:pa.LOOK_AROUND}}handleEventGamepad(e){const t=q0e(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||JW(t))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,W0e(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const t=W0e(this._keysButtonState,this._transformation);JW(t)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(t-this._filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this._constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,xT),this._applyDisabledMovementTypes(xT),this._applyPan(xT.pan),this._applyRotate(xT.rotate),this._applyZoom(xT.zoom),this._applyAscend(xT.ascend),this._constraintOptions.interactionType=fr.NONE,this._constraintOptions.selection=hs.COLLISION,On(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,t)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;ge(jc,t.center,t.eye),je(jc,jc,e.matrix),t.center=ye(jc,jc,t.eye),t.up=je(jc,t.up,e.matrix),this._constraintOptions.interactionType=fr.LOOK_AROUND,this._constraintOptions.selection=hs.ALL_EXCEPT_COLLISION,On(this.view,t,this._constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=je(jc,t.eye,e.matrix),t.center=je(jc,t.center,e.matrix),this.view.state.isGlobal&&(t.up=je(jc,t.up,e.matrix)),this._constraintOptions.interactionType=fr.PAN,this._constraintOptions.selection=hs.ALL,On(this.view,t,this._constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=ye(jc,this.currentCamera.eye,de(Xe.get(),t,e)),le(UP,t),Fl(UP,UP),this._constraintOptions.interactionDirection=UP,this._constraintOptions.interactionType=fr.ZOOM,this._constraintOptions.selection=hs.ALL_EXCEPT_COLLISION,On(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Xe.get());if(this._constraintOptions.interactionDirection=le(UP,t),this.view.state.isGlobal){const r=Ie(this.currentCamera.eye),i=(r+e)/r;this.currentCamera.eye=de(jc,this.currentCamera.eye,i),this.currentCamera.center=de(jc,this.currentCamera.center,i)}else{const r=de(Xe.get(),t,e);this.currentCamera.eye=ye(jc,this.currentCamera.eye,r),this.currentCamera.center=ye(jc,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=fr.ASCEND,this._constraintOptions.selection=hs.COLLISION,On(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=hs.ALL_EXCEPT_COLLISION,On(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,r){n_t(r);const i=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(i,t,r):this._calculateControlTransformationGlobal(i,t,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(r,e,jc)}_calculateControlTransformationLocal(e,t,r){const{viewRight:i,viewForward:s}=t,n=this._transformation,o=this.view.navigation.gamepad,a=ue(Xe.get(),s[0],s[1],0);xe(a,a);const l=n.translation[0]*e.pan;if(l!==0){const g=de(Xe.get(),i,l);Pu(r.pan.matrix,r.pan.matrix,g),r.pan.enabled=!0}switch(o.mode){case"pan":{const g=-n.translation[1]*e.pan;if(g!==0){const _=de(Xe.get(),a,g);Pu(r.pan.matrix,r.pan.matrix,_),r.pan.enabled=!0}r.zoom=n.zoom*e.zoom;break}case"zoom":r.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;r.ascend=c;const d=-n.heading*e.rotate;d!==0&&(Sd(r.rotate.matrix,r.rotate.matrix,d,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Xe.get())),r.rotate.enabled=!0);const p=n.tilt*e.rotate,f=Fx(this.view.renderCoordsHelper,t.center,t.eye),m=_e(f+p,al.min,al.max)-f;m&&(Sd(r.rotate.matrix,r.rotate.matrix,m,i),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,r){const{eye:i,viewRight:s}=t,n=this._transformation,o=this.view.navigation.gamepad,a=At(Xe.get(),s,i);xe(a,a),Fl(a,a),Pyt(this.startCamera,t,n,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(xT.pan,this._tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;r.ascend=c;const d=-n.heading*e.rotate;d!==0&&(Sd(r.rotate.matrix,r.rotate.matrix,d,this._tmpCamera.eye),r.rotate.enabled=!0);const p=n.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);f!==0&&(Sd(r.rotate.matrix,r.rotate.matrix,f,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,r){const i=Kr(this.view.spatialReference),s=zB(al.min,t.origin,r,i);let n=0,o=0;const a=Xe.get();if(this.view.renderCoordsHelper.intersectManifold(t,r,a)){const l=Fx(this.view.renderCoordsHelper,a,t.origin);n=zB(l,t.origin,r,i),o=zB(al.max,t.origin,r,i)}else{LI(Hj(qj,r+i.radius),t,a);const l=Eo(-Te(t.direction,xe(a,a)));n=I0e(l,t.origin,r,i),o=I0e(al.max,t.origin,r,i)}return _e(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,r){const{renderCoordsHelper:i}=this.view,s=i.getAltitude(e),n=t+Math.abs(s-t);return i.setAltitude(r,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:r}=this.view,{camera:i}=this.view.state,{direction:s}=g0t(this.view,t,0,HLe,s_t),n=r.intersectManifoldClosestSilhouette(ep(t,s),e,Xe.get()),o=Ni(t,n),a=r.intersectManifoldClosestSilhouette(ep(t,n1(Xe.get(),t,i.center)),e,Xe.get()),l=Ni(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:r}=this.view,{camera:i,isGlobal:s}=r,n=t.intersectManifoldClosestSilhouette(i.ray,this._filteredSurfaceElevation,Xe.get());if(s){const o=ge(Xe.get(),e,n),a=Ie(o);de(o,o,1/a);const l=xe(Xe.get(),e),c=Eo(Te(l,o));return a*Math.sin(Math.min(e_t,c))}{const o=le(Xe.get(),e);return t.setAltitude(o,this._filteredSurfaceElevation),Ni(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:t_t}_computeVelocities(e){const t=this._filteredSurfaceElevation,r=t+Kr(this.view.spatialReference).radius,{camera:i,isGlobal:s}=this.view.state,n=Xe.get(),o=this._getPointAbsoluteSurfaceElevation(i.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=i.width/2,c=X0e*i.width,d=X0e*i.width,p=a*Math.tan(.5*i.fovX)/l,f=p/r,m=p/this._computeHeadingRotateRadius(n),g=o-t;return{pan:(s?f:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*g-g),zoom:2**(c*e/l)*a-a,rotate:_e(m*d,r_t,i_t)*e}}_applyDisabledMovementTypes(e){!v(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&fg(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&fg(e.rotate.matrix))}static activatesFor(e,t){const r=q0e(t,e.navigation.gamepad,Q0t);return!(t.action==="end"||JW(r))}};u([h({constructOnly:!0})],C2.prototype,"gamepadDevice",void 0),u([h({constructOnly:!0})],C2.prototype,"disableMovements",void 0),C2=u([I("esri.views.3d.state.controllers.GamepadKeyboardController")],C2);const Q0t={translation:[0,0,0],heading:0,tilt:0,zoom:0},HLe=80,e_t=Zt(HLe),X0e=.75,t_t=5,r_t=Zt(30),i_t=Zt(80),xT={zoom:0,ascend:0,pan:{enabled:!1,matrix:$e()},rotate:{enabled:!1,matrix:$e()}},jc=$(),UP=$(),s_t=Xle();function n_t(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,fg(e.pan.matrix),e.rotate.enabled=!1,fg(e.rotate.matrix)}class o_t extends Xa{constructor(t){super(!0),this._view=t,this._watchHandles=new hr,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(t){super.onInstall(t),this._watchHandles.add([ie(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},pt),ie(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const r=this._view.navigation.gamepad.device;if(r&&t.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||C2.activatesFor(this._view,t.data)){if(!i){const s=new C2({view:this._view,gamepadDevice:t.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===t.data.device&&this._cameraControllerGamepad.handleEventGamepad(t.data)}}}var nd;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(nd||(nd={}));class a_t extends Xa{constructor(t,r){super(!0),this._view=t,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ye.Local},this._keyToNumber={[r.left]:nd.LEFT,[r.right]:nd.RIGHT,[r.forward]:nd.FORWARD,[r.backward]:nd.BACKWARD,[r.up]:nd.UP,[r.down]:nd.DOWN,[r.headingLeft]:nd.HEADINGLEFT,[r.headingRight]:nd.HEADINGRIGHT,[r.tiltUp]:nd.TILTUP,[r.tiltDown]:nd.TILTDOWN,[r.zoomIn]:nd.ZOOMIN,[r.zoomOut]:nd.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const r=this._keyToNumber[t.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new C2({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),t.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const r=this._keyToNumber[t.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),t.stopPropagation())}}class l_t extends Xa{constructor(t,r){super(!0),this._view=t,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(t){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=t.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new CV({view:this._view,mode:"interaction"}):new AV({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Vs(r.x,r.y)),t.preventDefault(),t.stopPropagation()}}class DV{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let FE=class extends XN{constructor(){super(...arguments),this._beginCamera=new Li,this._elapsedTimeSec=0,this.constraintOptions={selection:hs.ALL,interactionType:fr.PAN,interactionFactor:0,interactionStartCamera:new Li,interactionDirection:null,tiltMode:pa.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new jR}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,t),On(this.view,t,this.constraintOptions)}};FE=u([I("esri.views.3d.state.controllers.momentum.MomentumController")],FE);let rL=class extends FE{constructor(e){super(e),this.interactionType=fr.PAN,this._tmpPan=$()}momentumStep(e,t){const r=this.momentum.value(e);de(this._tmpPan,this.momentum.direction,r),t.eye=ge(Y0e,t.eye,this._tmpPan),t.center=ge(Y0e,t.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};u([h({constructOnly:!0})],rL.prototype,"momentum",void 0),rL=u([I("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],rL);const Y0e=$(),c_t=$(),Uk=$();let jB=class extends FE{constructor(e){super(e),this.interactionType=fr.PAN}momentumStep(e,t){const r=this.momentum.value1(e),i=this.momentum.value2(e);le(Uk,t.eye),xe(Uk,Uk),At(this.momentum.axis2,Uk,this.momentum.axis1),gLe(t,c_t,this.momentum.axis1,r,this.momentum.axis2,i)}};u([h({constructOnly:!0})],jB.prototype,"momentum",void 0),jB=u([I("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],jB);let a2=class extends FE{constructor(e){super(e),this.interactionType=fr.TUMBLE}set center(e){this._set("center",ws(e))}set axis(e){this._set("axis",ws(e))}momentumStep(e,t){const r=this.momentum.value(e);Ux(t,this.center,YN(this.axis,r))}};u([h({constructOnly:!0})],a2.prototype,"momentum",void 0),u([h({constructOnly:!0})],a2.prototype,"center",null),u([h({constructOnly:!0})],a2.prototype,"axis",null),a2=u([I("esri.views.3d.state.controllers.momentum.MomentumController")],a2);let iM=class extends FE{constructor(e){super(e),this.interactionType=fr.ZOOM,this.constraintOptions.interactionDirection=$()}set zoomCenter(e){this._set("zoomCenter",ws(e))}momentumStep(e,t){le(this.constraintOptions.interactionDirection,t.eye);const r=this.momentum.valueDelta(0,e);Gle(t,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=n1(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};u([h({constructOnly:!0})],iM.prototype,"momentum",void 0),u([h({constructOnly:!0})],iM.prototype,"zoomCenter",null),iM=u([I("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],iM);let kS=class extends FE{constructor(e){super(e),this.interactionType=fr.ZOOM,this.radius=0,this._tmpSceneCenter=$(),this._tmpZoomAxisAngle=S7(),this._sphere=qo()}set screenCenter(e){this._set("screenCenter",Vs(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",ws(e))}initialize(){this._sphere[3]=this.radius}momentumStep(e,t){const r=this.momentum.valueDelta(0,e);uLe(this._sphere,t,r),this.constraintOptions.interactionType=fr.ZOOM,On(this.view,t,this.constraintOptions),ZN(this._sphere,t,this.screenCenter,this._tmpSceneCenter),zle(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Ux(t,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=fr.PAN}};u([h({constructOnly:!0})],kS.prototype,"momentum",void 0),u([h({constructOnly:!0})],kS.prototype,"screenCenter",null),u([h({constructOnly:!0})],kS.prototype,"sceneCenter",null),u([h({constructOnly:!0})],kS.prototype,"radius",void 0),kS=u([I("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],kS);class km{constructor(t){this._gain=t,this.lastValue=void 0,this.filteredDelta=void 0}update(t){if(this.hasLastValue()){const r=this.computeDelta(t);this._updateDelta(r)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return this.lastValue===void 0?NaN:t-this.lastValue}_updateDelta(t){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}}class O7{constructor(t,r,i){this._initialVelocity=t,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,r){const i=this.value(t);return this.value(t+r)-i}valueFromInitialVelocity(t,r){r=Math.min(r,this.duration);const i=1-this.friction;return t*(i**r-1)/Math.log(i)}}class u_t extends O7{constructor(t,r,i,s,n){super(t,r,i),this._sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this._sceneVelocity,t)}}class qLe{constructor(t=300,r=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new km(.6),this._screen=[new km(.4),new km(.4)],this._scene=[new km(.6),new km(.6),new km(.6)],this._tmpDirection=$()}add(t,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=t==null||r==null?0:Math.sqrt(t*t+r*r),s=this._time.filteredDelta,n=s==null||i==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,r,i){var o,a,l;ue(this._tmpDirection,(o=this._scene[0].filteredDelta)!=null?o:0,(a=this._scene[1].filteredDelta)!=null?a:0,(l=this._scene[2].filteredDelta)!=null?l:0);const s=Ie(this._tmpDirection);s>0&&de(this._tmpDirection,this._tmpDirection,1/s);const n=this._time.filteredDelta;return new u_t(t,r,i,n==null?0:s/n,this._tmpDirection)}}class Z0e{constructor(t){this._gain=t}update(t){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const J0e=1e-5;class d_t extends O7{constructor(t,r,i,s,n,o=0,a){super(t,r,i),this._angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this._angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class h_t{constructor(t=300,r=12,i=.84){this._minimumInitialVelocity=t,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=$(),this._tmpAxis2=$(),this._tmpAngles=rt(),this._time=new km(.3),this._screen=[new km(.4),new km(.4)],this._angle1=new Z0e(.6),this._angle2=new Z0e(.6),this._axis1=$(),this._axis2=$(),this._lastScene=$()}addMomentumDirectRotation(t,r,i,s,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=fLe(this._lastScene,r,this._tmpAxis2,s,n,o);this._angle2.update(0),Rc(this._tmpAxis2)<J0e?a=0:xe(this._axis1,this._tmpAxis2),this._angle1.update(a),le(this._lastScene,r)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(i)}}addMomentumPreserveHeading(t,r,i,s,n,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;mLe(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,n,o,a,!1),Rc(this._tmpAxis2)<J0e?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),xe(this._axis1,this._tmpAxis1),xe(this._axis2,this._tmpAxis2)),le(this._lastScene,r)}this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const t=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=t==null||r==null?null:Math.sqrt(t*t+r*r),s=this._time.filteredDelta,n=i==null||s==null?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(t,r,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,o=this._angle2.filteredValue,a=s==null||o==null?0:o/s;return new d_t(t,r,i,s==null||n==null?0:n/s,this._axis1,a,this._axis2)}}class WLe{constructor(t=2.5,r=.01,i=.95,s=12){this._minimumInitialVelocity=t,this._stopVelocity=r,this._friction=i,this._maxVelocity=s,this.enabled=!0,this.value=new km(.8),this.time=new km(.3)}add(t,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(t);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=_e(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}createMomentum(t,r,i){return new O7(t,r,i)}}class XLe extends WLe{constructor(t=3,r=.01,i=.95,s=12){super(t,r,i,s)}add(t,r){const i=this.value.lastValue;if(i!=null){let s=t-i;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=i+s}super.add(t,r)}}class p_t extends O7{constructor(t,r,i){super(t,r,i)}value(t){const r=super.value(t);return Math.exp(r)}valueDelta(t,r){const i=super.value(t),s=super.value(t+r)-i;return Math.exp(s)}}class YLe extends WLe{constructor(t=2.5,r=.01,i=.95,s=12){super(t,r,i,s)}add(t,r){super.add(Math.log(t),r)}createMomentum(t,r,i){return new p_t(t,r,i)}}let pre=class extends Jy{constructor(){super(...arguments),this._smoothRotation=new DV(.05),this._rotationAxis=$(),this._panningPlane=di(),this._smoothScaling=new DV(.05),this._zoomCenterScreen=Vs(),this._zoomMomentumEstimator=new YLe,this._rotationMomentumEstimator=new XLe,this._panSphericalMomentumEstimator=new h_t,this._panPlanarMomentumEstimator=new qLe,this._adjustedSphere=qo(),this._tmp3d=$(),this._tmpScreenPointArray=Vs(),this._beginScreenPoint=Vs(),this._beginScenePoint=$(),this._screenPickPoint=Vs(),this._mode=za.Horizontal,this._tmpInteractionDirection=$(),this._constraintOptions={selection:hs.ALL,interactionType:fr.NONE,interactionFactor:0,interactionStartCamera:new Li,interactionDirection:null,tiltMode:pa.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panPlanarMomentumEstimator.enabled=t,this._panSphericalMomentumEstimator.enabled=t,this._beginHeading=-Tx.normalize(Zt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Vy(e.center,this._screenPickPoint),Ho(this._beginScreenPoint,this._screenPickPoint);const r=Kr(this.view.spatialReference),i=hLe(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,iI.Silhouette);C(i.scenePickPoint)||(this._scenePickPoint=i.scenePickPoint,this._sphere=i.sphere,le(this._beginScenePoint,this._scenePickPoint),this._mode=E7(this.startCamera,this._screenPickPoint,i.hasGeometryIntersection,r),this._mode===za.Vertical&&this._preparePlanarPanMode(e),this._constraintOptions.interactionStartCamera.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this._mode===za.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return this._mode===za.Horizontal?new kS({view:this.view,momentum:t,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new iM({view:this.view,momentum:t,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new a2({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===za.Horizontal){const i=this._panSphericalMomentumEstimator.evaluateMomentum();if(i)return new jB({view:this.view,momentum:i})}else{const i=this._panPlanarMomentumEstimator.evaluateMomentum();if(i)return new rL({view:this.view,momentum:i})}return null}_preparePlanarPanMode(e){const t=Fl(this._tmp3d,this.startCamera.viewForward);BR(this._scenePickPoint,t,this._panningPlane);const r=Vs(this._screenPickPoint[0],0),i=$(),s=Ie(this.startCamera.eye);this._adjustedSphere[3]=s<this._sphere[3]?s-100:this._sphere[3],ZN(this._adjustedSphere,this.startCamera,r,i);const n=ul();this.startCamera.projectToRenderScreen(i,n);const o=.9*n[1];this._screenPickPoint[1]=Math.min(this._screenPickPoint[1],o);const a=this._intersectionHelper.intersectScreen(this._screenPickPoint,this._scenePickPoint);a&&BR(this._scenePickPoint,this._panningPlane,this._panningPlane);const l=$(),c=$(),d=$(),p=80,f=5,m=50;ge(l,this._scenePickPoint,this.currentCamera.eye);const g=Ie(l);xe(l,l);const _=f*Math.max(Math.abs(this.view.camera.position.z),m),x=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,p);let b=v(x)?Math.min(x,_):_;b=a?Math.min(b,g):b,le(d,ye(c,this.currentCamera.eye,de(c,l,b))),this._panningPlane[3]=-Te(this._panningPlane,d),this.startCamera.center=ye(c,this.startCamera.eye,de(c,this.startCamera.viewForward,b));const w=Vy(e.center,this._tmpScreenPointArray);are(this._panningPlane,this.startCamera,w,this._beginScenePoint)}_zoomSpherical(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),uLe(this._sphere,this.currentCamera,this._smoothScaling.value),Vy(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=fr.ZOOM,this._constraintOptions.interactionFactor=Fm(e.radius-this._beginRadius),On(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const t=Vy(e.center,this._tmpScreenPointArray);ZN(this._sphere,this.currentCamera,t,this._tmp3d),Hle(this._beginScenePoint,Te(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(_Le(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(yLe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=fr.PAN,this._constraintOptions.interactionFactor=Fm(TE(this._screenPickPoint,t)),On(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){xe(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Fl(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value,r=t+ore(e.angle-t),i=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=i,this._smoothRotation.update(r);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),Ux(this.currentCamera,this._sphere,YN(this._rotationAxis,s)),this._constraintOptions.interactionType=fr.TUMBLE,this._constraintOptions.interactionFactor=Fm(e.radius*r),On(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const t=Vy(e.center,this._tmpScreenPointArray);are(this._panningPlane,this.currentCamera,t,this._tmp3d)&&(pLe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(t,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=fr.PAN,this._constraintOptions.interactionFactor=Fm(TE(this._beginScreenPoint,t)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),On(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Gle(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=fr.ZOOM,this._constraintOptions.interactionFactor=Fm(e.radius-this._beginRadius),On(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){le(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Fl(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value;let r=e.angle-t;r=ore(r);const i=t+r,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(i);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),Ux(this.currentCamera,this._sphere,YN(this._rotationAxis,n)),this._constraintOptions.interactionType=fr.TUMBLE,this._constraintOptions.interactionFactor=Fm(e.radius*n),On(this.view,this.currentCamera,this._constraintOptions)}};pre=u([I("esri.views.3d.state.controllers.global.PinchAndPanController")],pre);const K0e=Fe(0,0,1),f_t={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},m_t=80;let fre=class extends Jy{constructor(){super(...arguments),this._rotationValueSmooth=new DV(.05),this._scalingValueSmooth=new DV(.05),this._planeHorizontal=di(),this._planeVertical=di(),this._rotationMomentumEstimator=new XLe,this._panMomentumEstimator=new qLe(300,12,.9),this._zoomMomentumEstimator=new YLe,this._beginCenter=$(),this._tmpPoints=[],this._beginCenterScreen=Vs(),this._tmpCentroid3d=$(),this._tmpCentroid2d=Vs(),this._tmp2d=Vs(),this._constraintOptions={selection:hs.ALL,interactionType:fr.NONE,interactionFactor:0,interactionStartCamera:new Li,interactionDirection:null,tiltMode:pa.TUMBLE}}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panMomentumEstimator.enabled=t,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Vy(e.center,this._beginCenterScreen),UPe(K0e,0,this._planeHorizontal);const r=$(),i=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r),s=$();Fl(s,this.startCamera.viewForward);const n=$();le(n,K0e);const o=Te(s,n),a=vf(o<0?-o:o);if(this._panMode=a>=f_t.ANGLE_THRESHOLD?za.Horizontal:za.Vertical,lte(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||cte(this._planeHorizontal,this._planeHorizontal),this._panMode===za.Vertical){de(n,n,o),ge(this._planeVertical,s,n),xe(this._planeVertical,this._planeVertical),lte(this._planeVertical,this._planeVertical,r);const l=$(),c=$(),d=$();ge(l,r,this.currentCamera.eye);const p=Ie(l);xe(l,l);const f=5*Math.max(Math.abs(this.view.camera.position.z),50),m=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,m_t);let g=v(m)?Math.min(m,f):f;g=i?Math.min(g,p):g,le(d,ye(c,this.currentCamera.eye,de(c,l,g))),this._planeVertical[3]=-Te(this._planeVertical,d),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),UW(this._tmpPoints,this._beginCenter)}else this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),UW(this._tmpPoints,this._beginCenter);this._constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,r=this._panMode===za.Horizontal?this._planeHorizontal:this._planeVertical,i=this._beginCenter;if(t){const s=this._beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=n,this._scalingValueSmooth.update(s),Gle(this.currentCamera,i,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=fr.ZOOM,this._constraintOptions.interactionFactor=Fm(Math.abs(e.radius-this._beginRadius)),On(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),UW(this._tmpPoints,this._tmpCentroid3d),Vy(e.center,this._tmpCentroid2d),pLe(this.currentCamera,i,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=fr.PAN,this._constraintOptions.interactionFactor=Fm(TE(this._beginCenterScreen,this._tmpCentroid2d)),On(this.view,this.currentCamera,this._constraintOptions),t){const s=this._planeHorizontal,n=i,o=this._rotationValueSmooth.value,a=o+ore(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp),Ux(this.currentCamera,n,YN(s,c)),this._constraintOptions.interactionType=fr.TUMBLE,this._constraintOptions.interactionFactor=Fm(Math.abs(e.radius*c)),On(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return new iM({view:this.view,momentum:t,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new a2({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const i=this._panMomentumEstimator.evaluateMomentum();return i?new rL({view:this.view,momentum:i}):null}_computePlanePoints(e,t,r,i){i.length=e.size;const s=this._tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,i[n]===void 0&&(i[n]=$()),are(t,r,s,i[n]),n+=1}),i}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};fre=u([I("esri.views.3d.state.controllers.local.PinchAndPanController")],fre);class Q0e extends Xa{constructor(t,r,i){super(!0),this._view=t,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!Wle(t.data,this.pointerAction))return;const r=t.timestamp-this._lastEndTimestamp,i=40,s=this._momentum&&this._momentum.active&&r<i;switch(t.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?t.data.timestamp-this._lastTimestamp>2&&(this._controller.update(t.data),this._lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=t.timestamp;const i=this._controller.end(t.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(t){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(t.data),this._lastTimestamp=t.timestamp}_createController(){return this._view.state.isGlobal?new pre({view:this._view}):new fre({view:this._view})}}class g_t extends Xa{constructor(t,r){super(!0),this.view=t,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}}class ZLe extends Xa{constructor(t,r){super(!0),this.key=t,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class y_t extends ZLe{constructor(t,r,i){super(r,i),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class __t extends ZLe{constructor(t,r,i){super(r,i),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class v_t extends Xa{constructor(t,r=!1){super(!0),this._view=t,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(t){var s,n,o;const r=this._invert?-1:1,i=Vs(0,t.data.delta*r);switch(t.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new tL({view:this._view,pivot:ud.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(n=this._cameraController)==null||n.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}}function e_e(e){const t=e.native;return t?{buttons:t.buttons.map(r=>r.pressed?r.value?r.value:1:0),axes:t.axes.map(r=>x_t(r,e.axisThreshold))}:{buttons:[],axes:[]}}function b_t(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let r=0;r<e.axes.length;r++)if(e.axes[r]!==t.axes[r])return!1;for(let r=0;r<e.buttons.length;r++)if(e.buttons[r]!==t.buttons[r])return!1;return!0}function w_t(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function x_t(e,t){const r=Math.abs(e);return r<t?0:Math.sign(e)*(r-t)/(1-t)}class T_t{constructor(t,r){this._element=t,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,e_e(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=i&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this._callback=t}_connectGamepad(t){const r=new nle(t);r.deviceType!=="unknown"&&(this._inputDevices[t.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=cR({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!t||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(s=>{const n=this._inputDevices[s.index];if(!n)return;const o=this._latestUpdate[s.index],a=e_e(n),l=i||w_t(a);o&&(o.timestamp===s.timestamp||!o.active&&l||b_t(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const s=r[i];this._validate(s)&&t(s)}}_emitGamepadEvent(t,r,i){const s=this._latestUpdate[t.index],n=s&&s.active;if(!n&&!i)return;const o=!n&&i?"start":n&&i?"update":"end";this._latestUpdate[t.index]={timestamp:t.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[t.index],state:r,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let r=0;r<t.axes.length;r++)if(isNaN(t.axes[r]))return!1;return!0}}const t_e=pe("trident"),r_e=pe("edge"),S_t=pe("chrome"),E_t=pe("ff"),C_t=pe("safari"),GC={touchNone:"esri-view-surface--touch-none",touchPan:"esri-view-surface--touch-pan"};class M7{constructor(t,r){this._input=r,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new T_t(t,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource=Qe(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const r in this._active)if(!t||!t.has(r)){const i=this._active[r];this._element.removeEventListener(KW[r],i),delete this._active[r]}t&&t.forEach(r=>{if(!this._active[r]&&KW[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(KW[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,r){r?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?GC.touchNone:GC.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?GC.touchPan:GC.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(GC.touchNone),this._element.classList.remove(GC.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,r){const i=x$e(this._element,t);return M7.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(t,r){const i=Put(r);i&&t==="key-up"&&this._keyDownState.delete(i);const s={native:r,key:i,repeat:i&&this._keyDownState.has(i)};i&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(t,i)}_handlePointerPreventDefault(t,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(t,i)}_handleMouseWheel(t,r){let i=r.deltaY;switch(r.deltaMode){case 0:(t_e||r_e)&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}t_e||r_e?i*=.7:S_t||C_t?i*=.6:E_t&&(i*=1.375);const s=100,n=Math.abs(i);n>s&&(i=i/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(t,o)}_handlePointerCaptureLost(t,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(t,r)}_handleDefault(t,r){const i={native:r};r.preventDefault(),this._callback(t,i)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}M7.test={disableSubpixelCoordinates:!1};const KW={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class A_t extends Xa{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function JLe(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function O_t(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}function M_t(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:hg()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[T,E]=e,[O,A]=[E.x-T.x,E.y-T.y];return t.radius=Math.sqrt(O*O+A*A)/2,t.center.x=(T.x+E.x)/2,t.center.y=(T.y+E.y)/2,t}let r=0,i=0;for(let T=0;T<e.length;T++)r+=e[T].x,i+=e[T].y;r/=e.length,i/=e.length;const s=e.map(T=>T.x-r),n=e.map(T=>T.y-i);let o=0,a=0,l=0,c=0,d=0,p=0,f=0;for(let T=0;T<s.length;T++){const E=s[T],O=n[T],A=E*E,R=O*O;o+=A,a+=R,l+=E*O,c+=A*E,d+=R*O,p+=E*R,f+=O*A}const m=.5*(c+p),g=.5*(d+f),_=o*a-l*l,x=(m*a-g*l)/_,b=(o*g-l*m)/_,w=hg(x+r,b+i);return{radius:Math.sqrt(x*x+b*b+(o+a)/e.length),center:w}}function iL(e){const{native:t}=e,{pointerId:r,button:i,pointerType:s}=t;return s==="mouse"?`${r}:${i}`:`${s}`}class R_t extends Xa{constructor(t){super(!1),this._navigationTouch=t,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,r,i,s){return{action:t,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:s,pointers:I_t(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(t){const r=t.native.pointerId,i=Bk(this._activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,s);const n=GB(s,KLe(this._activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(i)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const r=t.native.pointerId,i=this._activePointerMap.get(r);i?i.event=t:this._addPointer(t)}_removePointer(t){const r=Bk(this._activePointerMap).angle;this._activePointerMap.delete(t),this._updatePointerAngles(r)}_updatePointerAngles(t){const r=Bk(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=GB(i,r)-t,i.lastAngle=GB(i,r)-t})}_emitEvent(t,r,i){const s=Bk(this._activePointerMap);this._drag.emit(this._createPayload(t,r,s,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(t){const r=t.data.native.pointerId,i=t.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(t.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",t.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const r=t.data,i=r.currentEvent,s=t.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,s)):(this._addPointer(i),this._emitEvent("added",i,s),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=t.data.startEvent.pointerType,this._mouseButton=t.data.startEvent.button,this._startStateModifiers=t.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,s))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}}function KLe(e){const t=[];return e.forEach(r=>{t.push(hg(r.event.x,r.event.y))}),M_t(t)}function Bk(e){const t=KLe(e);let r=0;return e.forEach(i=>{let s=GB(i,t),n=s-i.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=i.lastAngle+n,i.lastAngle=s;const o=s-i.initialAngle;r+=o}),r/=e.size||1,{angle:r,radius:t.radius,center:t.center}}function I_t(e){const t=new Map;return e.forEach((r,i)=>t.set(i,r.event)),t}function GB(e,t){const r=e.event,i=r.x-t.center.x,s=r.y-t.center.y;return Math.atan2(s,i)}var i_e;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(i_e||(i_e={}));const Hw={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class P_t extends Xa{constructor(t=Hw.maximumDoubleClickDelay,r=Hw.maximumDoubleClickDistance,i=Hw.maximumDoubleTouchDelay,s=Hw.maximumDoubleTouchDistance,n=F9){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimer=Gs(t.doubleClickTimer))}get hasPendingInputs(){return wo(this._pointerState,t=>t.doubleClickTimer!=null)}_clearDoubleClickTimer(t,r){const i=this._pointerState.get(t);i&&(i.doubleClickTimer=Gs(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const r=this._pointerState.get(t);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}_getPointerId(t){const{pointerId:r,pointerType:i,button:s}=t.native;return i==="mouse"?`${r}:${s}`:`${i}`}_handleImmediateClick(t){const r=t.data,{pointerType:i}=r.native,s=this._getPointerId(r);if(!this._pointerState.has(s))return void this._startClick(t);const n=this._pointerState.get(s),{data:o,modifiers:a}=n.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;JLe(o,r)>l?(this._clearDoubleClickTimer(s,!0),this._startClick(t)):(this._clearDoubleClickTimer(s,!1),n.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(t){const r=iL(t.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(t){const{data:r}=t,{native:{pointerType:i}}=r,s=iL(r),n=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(s),n),a=1;this._pointerState.set(s,{event:t,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}}class $_t extends Xa{constructor(t=Hw.maximumDoubleClickDelay,r=Hw.maximumDoubleClickDistance,i=Hw.maximumDoubleTouchDelay,s=Hw.maximumDoubleTouchDistance,n=F9){super(!1),this._maximumDoubleClickDelay=t,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const r=t.data,i=iL(r);if(!this._pointerState.has(i)){const s={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,s),this.startCapturingPointer(r.native)}}_handlePointerUp(t){const r=t.data,i=iL(r),s=this._pointerState.get(i);if(s&&s.downButton===r.native.button){const n=s.immediateDoubleClick;if(n){n.timeoutHandle.remove();const o=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;JLe(n,t.data)>o?this._startImmediateDoubleClick(t,s):(this._immediateDoubleClick.emit(t.data,void 0,n.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(t,s)}}_startImmediateDoubleClick(t,r){const i=t.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),i)}}_removeState(t){const r=iL(t);this._pointerState.delete(r),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const BP={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class D_t extends Xa{constructor(t=BP.maximumClickDelay,r=BP.movementUntilMouseDrag,i=BP.movementUntilPenDrag,s=BP.movementUntilTouchDrag,n=BP.holdDelay,o=F9){super(!1),this._maximumClickDelay=t,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=s,this._holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout=Gs(t.holdTimeout)}),super.onUninstall()}_handlePointerDown(t){const r=t.data,i=r.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const n={startEvent:r,previousEvent:r,startTimestamp:t.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(i,n),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,r,i){return{action:t,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(t){const r=t.data,i=r.native.pointerId,s=this._pointerState.get(i);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,r),void 0,s.modifiers):O_t(r,s.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(t),s.previousEvent=r)}_getDragThreshold(t){switch(t){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(t){const r=t.data,i=r.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,i===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,r)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,r){const i=t.data,s=i.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,r==="pointer-up"?i:n.previousEvent),void 0,n.modifiers):r==="pointer-up"&&n.downButton===i.native.button&&t.timestamp-n.startTimestamp<=this._maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(s),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}}class L_t{constructor(t){this._callbacks=t,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(t){const r=t.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(t);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(t);break;case"end":this._emitEnd(t),this._currentCount=0}this._previousEvent=t}_emitStart(t){var r,i;this._startEvent=t,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,t)&&this._callbacks.start(this._currentCount,t,this._startEvent)}_emitUpdate(t){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,t)&&this._callbacks.update(this._currentCount,t,this._startEvent)}_emitEnd(t){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,t)&&this._callbacks.end(this._currentCount,t,this._startEvent),this._startEvent=null}}class N_t extends Xa{constructor(t=20,r=40){super(!1),this._threshold=t,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new L_t({start:(i,s)=>this._observeStart(i,s),update:(i,s,n)=>this._observeUpdate(i,s,n),end:(i,s)=>this._observeEnd(s)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(t,r){t===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=t===2?"ready":"failed"}_observeUpdate(t,r,i){if(this._state!=="failed"&&t===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(t){this._state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,r){let i=-1/0,s=1/0,n=-1/0,o=1/0;for(const{x:_,y:x}of r.pointers.values())i=Math.max(i,_),s=Math.min(s,_),n=Math.max(n,x),o=Math.min(o,x);let a=-1/0,l=1/0,c=-1/0,d=1/0;for(const{x:_,y:x}of t.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,x),d=Math.min(d,x);const p=i-s,f=n-o,m=a-l,g=c-d;return Math.abs(t.center.x-r.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(g-f)<=this._maxDelta}_checkVerticalThresholdReached(t,r){let i=Math.abs(t.center.y-r.center.y);return t.pointers.forEach((s,n)=>{const o=r.pointers.get(n);i=Math.min(i,Math.abs(s.y-o.y))}),i>=this._threshold}}let pm=class extends be{constructor(){super(...arguments),this._handles=new hr}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return(e=this._inputManager)==null?void 0:e.hasPendingInputs}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e,t;return(t=(e=this._inputManager)==null?void 0:e.multiTouchActive)!=null?t:!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Qe(this._inputManager)}connect(){const e=this.view;this._source=new M7(this.view.surface,e.input);const t=[new $_t,new D_t,new P_t,new R_t(this.view.navigation),new N_t],r=new py({eventSource:this._source,recognizers:t});this._inputManager=r,r.installHandlers("prevent-context-menu",[new A_t],lx.INTERNAL),this._modeDragPan=new Q0e(e,"primary"),this._modeDragRotate=new ZW(e,"secondary",ud.CENTER),this._modeDragZoom=new K0t(e,"tertiary");const i={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new g_t(e),new Hyt(e),new o_t(e),new a_t(e,i.pan),new l_t(e),new __t(e,i.resetTilt),new y_t(e,i.resetHeading),new ZW(e,"primary",ud.EYE,[i.lookAround]),new ZW(e,"secondary",ud.CENTER,[i.lookAround]),new Q0e(e,"tertiary",[i.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new v_t(e)],lx.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this._handles.add(ie(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},pt))}_updateMode(){const e=this.mode,t=this.primaryDragAction,r=mre.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([h()],pm.prototype,"view",void 0),u([h({value:"pan"})],pm.prototype,"primaryDragAction",null),u([h({value:"default"})],pm.prototype,"mode",null),u([h({readOnly:!0})],pm.prototype,"hasPendingInputs",null),u([h()],pm.prototype,"latestPointerType",null),u([h()],pm.prototype,"latestPointerLocation",null),u([h()],pm.prototype,"multiTouchActive",null),u([h()],pm.prototype,"_inputManager",void 0),pm=u([I("esri.views.3d.input.SceneInputManager")],pm);const mre=new Map,QW=new Map,eX=new Map;QW.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),QW.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),eX.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),eX.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),mre.set("default",QW),mre.set("pro",eX);const F_t=pm;let wh,qM,gre=!1,yre=!1,_re=!1,vre=!1,sL=null;function k_t(e,t){if(!yre||!qM)return;QLe();const r=qM;let i=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];i+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,d=(n+1)*e.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),eNe(a,l,c,d,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+t.size,70,50),r.fillText("total numTests: "+e.accNumTests,70,30)}function U_t(e){_re=hi.DECONFLICTOR_SHOW_VISIBLE,vre=hi.DECONFLICTOR_SHOW_INVISIBLE,gre=_re||vre,yre=hi.DECONFLICTOR_SHOW_GRID,sL=null,gre||yre?sL=()=>B_t(e):wh&&(wh.parentElement.removeChild(wh),wh=null)}function QLe(){sL&&(sL(),sL=null)}function B_t(e){wh==null&&(wh=document.createElement("canvas"),wh.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(wh));const{state:t}=e,{camera:r,pixelRatio:i}=t,{width:s,height:n}=r,o=s*i,a=n*i;wh.setAttribute("width",`${o}px`),wh.setAttribute("height",`${a}px`),wh.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),qM=wh.getContext("2d"),qM.clearRect(0,0,s,n),qM.font="12px Arial"}function eNe(e,t,r,i,s){QLe();const n=wh.height,o=qM;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-r),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.lineTo(e,n-r),o.stroke(),o.closePath()}function z_t(e,t){gre&&(t&&_re||!t&&vre)&&eNe(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var Ua,Dh;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(Ua||(Ua={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(Dh||(Dh={}));function tNe(e,t){return new R7(e,nNe,t)}function V_t(e,t){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:s}=nNe;return new R7(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:tX.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:tX.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:s,minPixelSize:tX.minPixelSize},t)}function j_t(e){return Math.abs(e*e*e)}function rNe(e,t,r){const i=r.parameters,s=r.paddingPixelsOverride;return zP.scale=Math.min(i.divisor/(t-i.offset),1),zP.factor=j_t(e),zP.minPixelSize=i.minPixelSize,zP.paddingPixels=s,zP}function iNe(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function ece(e,t){return Math.max(Ft(e*t.scale,e,t.factor),iNe(e,t))}function G_t(e,t,r){const i=rNe(e,t,r);return i.minPixelSize=0,i.paddingPixels=0,ece(1,i)}function s_e(e,t,r,i){i.scale=G_t(e,t,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function sNe(e,t,r=[0,0]){const i=Math.min(Math.max(t.scale,iNe(e[1],t)/Math.max(1e-5,e[1])),1);return r[0]=e[0]*i,r[1]=e[1]*i,r}function H_t(e,t,r,i){return ece(e,rNe(t,r,i))}class R7{constructor(t,r,i,s=q_t(),n){this._viewingMode=t,this._description=r,this._ellipsoidRadius=i,this.parameters=s,this._paddingPixelsOverride=n,this._viewingMode===Ye.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this._ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new R7(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,r,i){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this._description,{fovY:a,distance:l}=t,c=this._calculateCurvatureDependentParameters(t,r),d=this._coverageCompensation(t,r,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,g=.5*Math.PI-p-a*(.5-s*d),_=m/Math.cos(g),x=g+a*n*d,b=(_-f*(m/Math.cos(x)))/(1-f);return i.camera.fovY=t.fovY,i.camera.distance=t.distance,i.offset=b,i.divisor=_-b,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(t,r,i=n_e){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(t,r,i=n_e){const s=this._description.curvatureDependent,n=1+t.distance/r,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=_e((o-a)/(l-a),0,1),[d,p]=[s.min,s.max];return i.tiltAngle=Ft(d.tiltAngle,p.tiltAngle,c),i.scaleFallOffFactor=Ft(d.scaleFallOffFactor,p.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(t,r,i){return(t.fovY-i.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,r,i){const s=r*r,n=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*r,c=Math.sqrt(l),d=Math.sqrt(l-s);return(Math.acos(d/c)-Math.asin(r/(c/Math.sin(n)))+.5*o)/o}}const nNe={curvatureDependent:{min:{curvature:Zt(10),tiltAngle:Zt(12),scaleFallOffFactor:.5},max:{curvature:Zt(70),tiltAngle:Zt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},tX={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function q_t(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const zP={scale:0,factor:0,minPixelSize:0,paddingPixels:0},n_e={tiltAngle:0,scaleFallOffFactor:0};function W_t(e){return e instanceof Float32Array&&e.length>=16}function X_t(e){return Array.isArray(e)&&e.length>=16}function Y_t(e){return W_t(e)||X_t(e)}function tce(e){e.vertex.code.add(S`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(S`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(S`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(S`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(S`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(S`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(S`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function Z_t(e){e.uniforms.add(new Tr("screenSizePerspective",t=>oNe(t.screenSizePerspective)))}function I7(e){e.uniforms.add(new Tr("screenSizePerspectiveAlignment",t=>oNe(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function oNe(e){return Oi(J_t,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const J_t=Lr();class aNe extends tn{constructor(t,r){super(t,"mat4",Ri.Draw,(i,s,n)=>i.setUniformMatrix4fv(t,r(s,n)))}}function _g(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",Ic):e.uniforms.add(new Hh("cameraPosition",(r,i)=>ue(lNe,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Dd(e,t){if(!t.instancedDoublePrecision)return void e.uniforms.add([new xs("proj",(i,s)=>s.camera.projectionMatrix),new aNe("view",(i,s)=>Pu(o_e,s.camera.viewMatrix,i.origin)),new Hh("localOrigin",i=>i.origin)]);const r=i=>ue(lNe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);e.uniforms.add([new xs("proj",(i,s)=>s.camera.projectionMatrix),new xs("view",(i,s)=>Pu(o_e,s.camera.viewMatrix,r(s))),new er("localOrigin",(i,s)=>r(s))])}const o_e=JF(),lNe=$();function nI(e){e.uniforms.add(new xs("viewNormal",(t,r)=>r.camera.viewInverseTransposeMatrix))}function cNe(e,t){const r=e.vertex;t.hasVerticalOffset?(uNe(r),t.hasScreenSizePerspective&&(e.include(tce),I7(r),_g(e.vertex,t)),r.code.add(S`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?S`vec3 worldNormal = normalize(worldPos + localOrigin);`:S`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?S`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:S`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(S`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const K_t=Lr();function uNe(e){e.uniforms.add(new Tr("verticalOffset",(t,r)=>{const{minWorldLength:i,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return Oi(K_t,n*a,o,i,s)}))}var gh;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(gh||(gh={}));var gu;function dNe(e,t){e.include(tce),e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.NORMAL,"vec3"),e.attributes.add(M.AUXPOS1,"vec4");const r=e.vertex;Dd(r,t),_g(r,t),r.uniforms.add([new Tr("viewport",(i,s)=>s.camera.fullViewport),new De("polygonOffset",i=>i.shaderPolygonOffset),new De("cameraGroundRelative",(i,s)=>s.camera.aboveGround?1:-1),new De("renderTransparentlyOccludedHUD",(i,s)=>s.renderTransparentlyOccludedHUD===gh.Occluded?1:s.renderTransparentlyOccludedHUD===gh.NotOccluded?0:.75),new Rt("hudVisibilityTexture",(i,s)=>s.hudVisibilityTexture)]),t.hasVerticalOffset&&uNe(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(S`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(S`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||nI(r),t.isDraped||(r.uniforms.add(new De("perDistancePixelRatio",(i,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),r.code.add(S`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===gu.Screen&&r.uniforms.add(new De("pixelRatio",(i,s)=>s.camera.pixelRatio)),t.hasScreenSizePerspective&&I7(r),r.code.add(S`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===gu.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?S`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==gu.Screen?S`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===gu.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===gu.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.code.add(S`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(gu||(gu={}));const zk=ao();function P7(e,t,r,i,s,n,o){if(!d4(t))if(e.boundingInfo){Et(e.primitiveType===Bl.Triangle);const a=r.tolerance;hNe(e.boundingInfo,i,s,a,n,o)}else{const a=e.indices.get(M.POSITION),l=e.vertexAttributes.get(M.POSITION);f4(i,s,0,a.length/3,a,l,void 0,n,o)}}const Q_t=$();function hNe(e,t,r,i,s,n){if(C(e))return;const o=fNe(t,r,Q_t);if(AOe(zk,e.getBBMin()),OOe(zk,e.getBBMax()),v(s)&&s.applyToAabb(zk),ice(zk,t,o,i)){const{primitiveIndices:a,indices:l,position:c}=e,d=a?a.length:l.length/3;if(d>svt){const p=e.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&hNe(p[f],t,r,i,s,n);return}}f4(t,r,0,d,l,c,a,s,n)}}const pNe=$();function f4(e,t,r,i,s,n,o,a,l){if(o)return evt(e,t,r,i,s,n,o,a,l);const c=n.data,d=n.stride||n.size,p=e[0],f=e[1],m=e[2],g=t[0]-p,_=t[1]-f,x=t[2]-m;for(let b=r,w=3*r;b<i;++b){let T=d*s[w++],E=c[T++],O=c[T++],A=c[T];T=d*s[w++];let R=c[T++],D=c[T++],k=c[T];T=d*s[w++];let L=c[T++],q=c[T++],G=c[T];v(a)&&([E,O,A]=a.applyToVertex(E,O,A,b),[R,D,k]=a.applyToVertex(R,D,k,b),[L,q,G]=a.applyToVertex(L,q,G,b));const J=R-E,ee=D-O,se=k-A,X=L-E,F=q-O,N=G-A,B=_*N-F*x,H=x*X-N*g,W=g*F-X*_,K=J*B+ee*H+se*W;if(Math.abs(K)<=Number.EPSILON)continue;const Y=p-E,ce=f-O,we=m-A,Oe=Y*B+ce*H+we*W;if(K>0){if(Oe<0||Oe>K)continue}else if(Oe>0||Oe<K)continue;const Be=ce*se-ee*we,He=we*J-se*Y,Se=Y*ee-J*ce,he=g*Be+_*He+x*Se;if(K>0){if(he<0||Oe+he>K)continue}else if(he>0||Oe+he<K)continue;const Me=(X*Be+F*He+N*Se)/K;Me>=0&&l(Me,rce(J,ee,se,X,F,N,pNe),b,!1)}}function evt(e,t,r,i,s,n,o,a,l){const c=n.data,d=n.stride||n.size,p=e[0],f=e[1],m=e[2],g=t[0]-p,_=t[1]-f,x=t[2]-m;for(let b=r;b<i;++b){const w=o[b];let T=3*w,E=d*s[T++],O=c[E++],A=c[E++],R=c[E];E=d*s[T++];let D=c[E++],k=c[E++],L=c[E];E=d*s[T];let q=c[E++],G=c[E++],J=c[E];v(a)&&([O,A,R]=a.applyToVertex(O,A,R,b),[D,k,L]=a.applyToVertex(D,k,L,b),[q,G,J]=a.applyToVertex(q,G,J,b));const ee=D-O,se=k-A,X=L-R,F=q-O,N=G-A,B=J-R,H=_*B-N*x,W=x*F-B*g,K=g*N-F*_,Y=ee*H+se*W+X*K;if(Math.abs(Y)<=Number.EPSILON)continue;const ce=p-O,we=f-A,Oe=m-R,Be=ce*H+we*W+Oe*K;if(Y>0){if(Be<0||Be>Y)continue}else if(Be>0||Be<Y)continue;const He=we*X-se*Oe,Se=Oe*ee-X*ce,he=ce*se-ee*we,Me=g*He+_*Se+x*he;if(Y>0){if(Me<0||Be+Me>Y)continue}else if(Me>0||Be+Me<Y)continue;const Xt=(F*He+N*Se+B*he)/Y;Xt>=0&&l(Xt,rce(ee,se,X,F,N,B,pNe),w,!1)}}const a_e=$(),l_e=$();function rce(e,t,r,i,s,n,o){return ue(a_e,e,t,r),ue(l_e,i,s,n),At(o,a_e,l_e),xe(o,o),o}function fNe(e,t,r){return ue(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function ice(e,t,r,i){return sce(e,t,r,i,1/0)}function sce(e,t,r,i,s){const n=(e[0]-i-t[0])*r[0],o=(e[3]+i-t[0])*r[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-i-t[1])*r[1],d=(e[4]+i-t[1])*r[1];if(l=Math.min(l,Math.max(c,d)),l<0||(a=Math.max(a,Math.min(c,d)),a>l))return!1;const p=(e[2]-i-t[2])*r[2],f=(e[5]+i-t[2])*r[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function mNe(e,t,r,i,s){let n=(r.screenLength||0)*e.pixelRatio;v(s)&&(n=H_t(n,i,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return _e(o*t,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function gNe(e,t){const r=t?gNe(t):{};for(const i in e){let s=e[i];s&&s.forEach&&(s=ivt(s)),s==null&&i in r||(r[i]=s)}return r}function tvt(e,t){let r=!1;for(const i in t){const s=t[i];s!==void 0&&(Array.isArray(s)?e[i]===null?(e[i]=s.slice(),r=!0):Mse(e[i],s)&&(r=!0):e[i]!==s&&(r=!0,e[i]=s))}return r}function rvt(e,t,r,i,s,n){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(M.POSITION).data,a=e.vertexAttributes.get(M.SIZE),l=a&&a.data[0],c=i[0],d=i[1],p=((l+s)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let g=0;g<o.length-5;g+=3){const _=o[g],x=o[g+1],b=c-_,w=d-x,T=o[g+3]-_,E=o[g+4]-x,O=_e((T*b+E*w)/(T*T+E*E),0,1),A=T*O-b,R=E*O-w,D=A*A+R*R;D<f&&(f=D,m=g/3)}f<p*p&&n(r.dist,r.normal,m,!1)}function ivt(e){const t=[];return e.forEach(r=>t.push(r)),t}const yNe={multiply:1,ignore:2,replace:3,tint:4},svt=1e3;class z0 extends c4{constructor(t,r){super(),this.type=yg.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Yr,this._parameters=gNe(t,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,r=!0){tvt(this._parameters,t)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleForOutput(t.output)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleForOutput(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){v(this.repository)&&this.repository.materialChanged(this)}}var Rs;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(Rs||(Rs={}));class GI extends Zi{constructor(){super(...arguments),this.renderOccluded=Rs.Occlude}}function b8t(e,t,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s===1)for(let l=0;l<a;++l)n[i]=t[e[l]],i+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let d=0;d<s;d++)n[i]=c,i+=o}}function nvt(e,t,r,i){const s=r.typedBuffer,n=r.typedBufferStride,o=e.length;i*=n;for(let a=0;a<o;++a){const l=2*e[a];s[i]=t[l],s[i+1]=t[l+1],i+=n}}function _Ne(e,t,r,i,s){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let d=0;d<s;++d)n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],i+=o}}function oI(e,t,r,i,s=1){const n=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(i*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],n[i+3]=t[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let d=0;d<s;++d)n[i]=t[c],n[i+1]=t[c+1],n[i+2]=t[c+2],n[i+3]=t[c+3],i+=o}}function $7(e,t,r,i,s,n=1){if(!r)return void _Ne(e,t,i,s,n);const o=i.typedBuffer,a=i.typedBufferStride,l=e.length,c=r[0],d=r[1],p=r[2],f=r[4],m=r[5],g=r[6],_=r[8],x=r[9],b=r[10],w=r[12],T=r[13],E=r[14];s*=a;let O=0,A=0,R=0;const D=bNe(r)?k=>{O=t[k]+w,A=t[k+1]+T,R=t[k+2]+E}:k=>{const L=t[k],q=t[k+1],G=t[k+2];O=c*L+f*q+_*G+w,A=d*L+m*q+x*G+T,R=p*L+g*q+b*G+E};if(n===1)for(let k=0;k<l;++k)D(3*e[k]),o[s]=O,o[s+1]=A,o[s+2]=R,s+=a;else for(let k=0;k<l;++k){D(3*e[k]);for(let L=0;L<n;++L)o[s]=O,o[s+1]=A,o[s+2]=R,s+=a}}function nce(e,t,r,i,s,n=1){if(!r)return void _Ne(e,t,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=e.length,d=o[0],p=o[1],f=o[2],m=o[4],g=o[5],_=o[6],x=o[8],b=o[9],w=o[10],T=!Woe(o),E=1e-6,O=1-E;s*=l;let A=0,R=0,D=0;const k=bNe(o)?L=>{A=t[L],R=t[L+1],D=t[L+2]}:L=>{const q=t[L],G=t[L+1],J=t[L+2];A=d*q+m*G+x*J,R=p*q+g*G+b*J,D=f*q+_*G+w*J};if(n===1)if(T)for(let L=0;L<c;++L){k(3*e[L]);const q=A*A+R*R+D*D;if(q<O&&q>E){const G=1/Math.sqrt(q);a[s]=A*G,a[s+1]=R*G,a[s+2]=D*G}else a[s]=A,a[s+1]=R,a[s+2]=D;s+=l}else for(let L=0;L<c;++L)k(3*e[L]),a[s]=A,a[s+1]=R,a[s+2]=D,s+=l;else for(let L=0;L<c;++L){if(k(3*e[L]),T){const q=A*A+R*R+D*D;if(q<O&&q>E){const G=1/Math.sqrt(q);A*=G,R*=G,D*=G}}for(let q=0;q<n;++q)a[s]=A,a[s+1]=R,a[s+2]=D,s+=l}}function ovt(e,t,r,i,s,n=1){if(!r)return void oI(e,t,i,s,n);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=e.length,d=o[0],p=o[1],f=o[2],m=o[4],g=o[5],_=o[6],x=o[8],b=o[9],w=o[10],T=!Woe(o),E=1e-6,O=1-E;if(s*=l,n===1)for(let A=0;A<c;++A){const R=4*e[A],D=t[R],k=t[R+1],L=t[R+2],q=t[R+3];let G=d*D+m*k+x*L,J=p*D+g*k+b*L,ee=f*D+_*k+w*L;if(T){const se=G*G+J*J+ee*ee;if(se<O&&se>E){const X=1/Math.sqrt(se);G*=X,J*=X,ee*=X}}a[s]=G,a[s+1]=J,a[s+2]=ee,a[s+3]=q,s+=l}else for(let A=0;A<c;++A){const R=4*e[A],D=t[R],k=t[R+1],L=t[R+2],q=t[R+3];let G=d*D+m*k+x*L,J=p*D+g*k+b*L,ee=f*D+_*k+w*L;if(T){const se=G*G+J*J+ee*ee;if(se<O&&se>E){const X=1/Math.sqrt(se);G*=X,J*=X,ee*=X}}for(let se=0;se<n;++se)a[s]=G,a[s+1]=J,a[s+2]=ee,a[s+3]=q,s+=l}}function LV(e,t,r,i,s,n=1){const o=i.typedBuffer,a=i.typedBufferStride,l=e.length;if(s*=a,r!==t.length||r!==4)if(n!==1)if(r!==4)for(let c=0;c<l;++c){const d=3*e[c];for(let p=0;p<n;++p)o[s]=t[d],o[s+1]=t[d+1],o[s+2]=t[d+2],o[s+3]=255,s+=a}else for(let c=0;c<l;++c){const d=4*e[c];for(let p=0;p<n;++p)o[s]=t[d],o[s+1]=t[d+1],o[s+2]=t[d+2],o[s+3]=t[d+3],s+=a}else{if(r===4){for(let c=0;c<l;++c){const d=4*e[c];o[s]=t[d],o[s+1]=t[d+1],o[s+2]=t[d+2],o[s+3]=t[d+3],s+=a}return}for(let c=0;c<l;++c){const d=3*e[c];o[s]=t[d],o[s+1]=t[d+1],o[s+2]=t[d+2],o[s+3]=255,s+=a}}else{o[s]=t[0],o[s+1]=t[1],o[s+2]=t[2],o[s+3]=t[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),d=a/4,p=c[s/=4];s+=d;const f=l*n;for(let m=1;m<f;++m)c[s]=p,s+=d}}function vNe(e,t,r,i,s=1){const n=t.typedBuffer,o=t.typedBufferStride;if(i*=o,s===1)for(let a=0;a<r;++a)n[i]=e[0],n[i+1]=e[1],n[i+2]=e[2],n[i+3]=e[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<s;++l)n[i]=e[0],n[i+1]=e[1],n[i+2]=e[2],n[i+3]=e[3],i+=o}function D7(e,t,r,i,s,n){for(const o of t.fieldNames){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)switch(o){case M.POSITION:{Et(a.size===3);const c=s.getField(o,Ii);c&&$7(l,a.data,r,c,n);break}case M.NORMAL:{Et(a.size===3);const c=s.getField(o,Ii);c&&nce(l,a.data,i,c,n);break}case M.UV0:{Et(a.size===2);const c=s.getField(o,Af);c&&nvt(l,a.data,c,n);break}case M.COLOR:{Et(a.size===3||a.size===4);const c=s.getField(o,Go);c&&LV(l,a.data,a.size,c,n);break}case M.SYMBOLCOLOR:{Et(a.size===3||a.size===4);const c=s.getField(o,Go);c&&LV(l,a.data,a.size,c,n);break}case M.TANGENT:{Et(a.size===4);const c=s.getField(o,ga);c&&ovt(l,a.data,i,c,n);break}}else if(o===M.OBJECTANDLAYERIDCOLOR&&v(e.objectAndLayerIdColor)&&e.objectAndLayerIdColor.length===4){const c=e.indices.get(M.POSITION);if(c){const d=c.length,p=s.getField(o,Go);vNe(e.objectAndLayerIdColor,p,d,n)}}}}function bNe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[8]===0&&e[9]===0&&e[10]===1}function KN(e,t,r=0){const i=_e(e,0,cvt);for(let s=0;s<4;s++)t[r+s]=Math.floor(256*uvt(i*avt[s]))}function oce(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*lvt[i];return r}const avt=[1,256,65536,16777216],lvt=[1/256,1/65536,1/16777216,1/4294967296],cvt=oce(new Uint8ClampedArray([255,255,255,255]));function uvt(e){return e-Math.floor(e)}async function A0(e,t){const{data:r}=await lr(e,{responseType:"image",...t});return r}class ace extends Zi{constructor(){super(...arguments),this.color=ar(1,1,1,1)}}function dvt(){const e=new Qr;return e.include($f),e.fragment.uniforms.add([new Rt("tex",t=>t.texture),new Tr("uColor",t=>t.color)]),e.fragment.code.add(S`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const hvt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:ace,build:dvt},Symbol.toStringTag,{value:"Module"}));function pvt(){if(C(rX)){const e=t=>ui(`esri/libs/basisu/${t}`);rX=re(()=>import("./basis_transcoder.229eaac8.js"),["assets/basis_transcoder.229eaac8.js","assets/_commonjsHelpers.773c2c82.js"]).then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(r=>(r.initializeBasis(),delete r.then,r)))}return rX}let rX;var l2;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(l2||(l2={}));let ng=null,Vk=null;async function wNe(){return C(Vk)&&(Vk=pvt(),ng=await Vk),Vk}function fvt(e,t){if(C(ng))return e.byteLength;const r=new ng.BasisFile(new Uint8Array(e)),i=TNe(r)?xNe(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),i}function mvt(e,t){if(C(ng))return e.byteLength;const r=new ng.KTX2File(new Uint8Array(e)),i=SNe(r)?xNe(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),i}function xNe(e,t,r,i,s){const n=lDe(t?an.COMPRESSED_RGBA8_ETC2_EAC:an.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*i*n*o)}function TNe(e){return e.getNumImages()>=1&&!e.isUASTC()}function SNe(e){return e.getFaces()>=1&&e.isETC1S()}async function gvt(e,t,r){C(ng)&&(ng=await wNe());const i=new ng.BasisFile(new Uint8Array(r));if(!TNe(i))return null;i.startTranscoding();const s=ENe(e,t,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(n,o)=>i.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>i.transcodeImage(a,0,n,o,0,0));return i.close(),i.delete(),s}async function yvt(e,t,r){C(ng)&&(ng=await wNe());const i=new ng.KTX2File(new Uint8Array(r));if(!SNe(i))return null;i.startTranscoding();const s=ENe(e,t,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(n,o)=>i.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>i.transcodeImage(a,n,0,0,o,0,-1,-1));return i.close(),i.delete(),s}function ENe(e,t,r,i,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[d,p]=l?i?[l2.ETC2_RGBA,an.COMPRESSED_RGBA8_ETC2_EAC]:[l2.ETC1_RGB,an.COMPRESSED_RGB8_ETC2]:c?i?[l2.BC3_RGBA,an.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[l2.BC1_RGB,an.COMPRESSED_RGB_S3TC_DXT1_EXT]:[l2.RGBA32,qe.RGBA],f=t.hasMipmap?r:Math.min(1,r),m=[];for(let b=0;b<f;b++)m.push(new Uint8Array(o(b,d))),a(b,d,m[b]);const g=m.length>1,_=g?at.LINEAR_MIPMAP_LINEAR:at.LINEAR,x={...t,samplingMode:_,hasMipmap:g,internalFormat:p,width:s,height:n};return new dt(e,x,{type:"compressed",levels:m})}const VP=te.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),_vt=542327876,vvt=131072,bvt=4;function lce(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function wvt(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const xvt=lce("DXT1"),Tvt=lce("DXT3"),Svt=lce("DXT5"),Evt=31,Cvt=0,Avt=1,Ovt=2,Mvt=3,Rvt=4,Ivt=7,Pvt=20,$vt=21;function Dvt(e,t,r){var a;const{textureData:i,internalFormat:s,width:n,height:o}=gd(Lvt(r,(a=t.hasMipmap)!=null?a:!1));return t.samplingMode=i.levels.length>1?at.LINEAR_MIPMAP_LINEAR:at.LINEAR,t.hasMipmap=i.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new dt(e,t,i)}function Lvt(e,t){const r=new Int32Array(e,0,Evt);if(r[Cvt]!==_vt)return VP.error("Invalid magic number in DDS header"),null;if(!(r[Pvt]&bvt))return VP.error("Unsupported format, must contain a FourCC code"),null;const i=r[$vt];let s,n;switch(i){case xvt:s=8,n=an.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Tvt:s=16,n=an.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Svt:s=16,n=an.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return VP.error("Unsupported FourCC code:",wvt(i)),null}let o=1,a=r[Rvt],l=r[Mvt];(3&a)==0&&(3&l)==0||(VP.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,d=l;let p,f;r[Ovt]&vvt&&t!==!1&&(o=Math.max(1,r[Ivt])),o===1||dg(a)&&dg(l)||(VP.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=r[Avt]+4;const g=[];for(let _=0;_<o;++_)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(e,m,f),g.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:n,width:c,height:d}}class ka extends c4{constructor(t,r){super(),this._data=t,this.type=yg.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new $s,this._passParameters=new ace,this.params=r||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:It.REPEAT,t:It.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||cx.STRETCH,this.estimatedTexMemRequired=ka._estimateTexMemRequired(this._data,this.params),this._startPreload()}_startPreload(){const t=this._data;C(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(bx(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const r=!t.paused;if(t.src=t.src,r&&t.autoplay){const i=()=>{t.removeEventListener("canplay",i),t.play()};t.addEventListener("canplay",i)}}}_startPreloadImageElement(t){R0(t.src)||bx(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,r){if(C(t))return 0;if(nP(t)||XS(t))return r.encoding===ka.KTX2_ENCODING?mvt(t,r.mipmap):r.encoding===ka.BASIS_ENCODING?fvt(t,r.mipmap):t.byteLength;const{width:i,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?ka._getDataDimensions(t):r;return(r.mipmap?4/3:1)*i*s*(r.components||4)||0}dispose(){this._data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var r;return{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?at.LINEAR_MIPMAP_LINEAR:at.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(r=this.params.maxAnisotropy)!=null?r:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,r){if(v(this._glTexture))return this._glTexture;if(v(this._loadingPromise))return this._loadingPromise;const i=this._data;return C(i)?(this._glTexture=new dt(t,this._createDescriptor(t),null),this._glTexture):typeof i=="string"?this._loadFromURL(t,r,i):i instanceof Image?this._loadFromImageElement(t,r,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(t,r,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(t,i,r):(nP(i)||XS(i))&&this.params.encoding===ka.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(t,i)):(nP(i)||XS(i))&&this.params.encoding===ka.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(t,i)):(nP(i)||XS(i))&&this.params.encoding===ka.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(t,i)):XS(i)?this._loadFromPixelData(t,i):nP(i)?this._loadFromPixelData(t,new Uint8Array(i)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(t,r,i){if(!(this._data instanceof HTMLVideoElement)||C(this._glTexture)||this._data.readyState<nL.HAVE_CURRENT_DATA||i===this._data.currentTime)return i;if(v(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this._data),this._drawStretchedTexture(t,r,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this._data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this._data):this._glTexture.setData(this._data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this._data.currentTime}_loadFromDDSData(t,r){return this._glTexture=Dvt(t,this._createDescriptor(t),r),this._glTexture}_loadFromKTX2(t,r){return this._loadAsync(()=>yvt(t,this._createDescriptor(t),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(t,r){return this._loadAsync(()=>gvt(t,this._createDescriptor(t),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(t,r){Et(this.params.width>0&&this.params.height>0);const i=this._createDescriptor(t);return i.pixelFormat=this.params.components===1?qe.LUMINANCE:this.params.components===3?qe.RGB:qe.RGBA,i.width=this.params.width,i.height=this.params.height,this._glTexture=new dt(t,i,r),this._glTexture}_loadFromURL(t,r,i){return this._loadAsync(async s=>{const n=await A0(i,{signal:s});return Ir(s),this._loadFromImage(t,n,r)})}_loadFromImageElement(t,r,i){return i.complete?this._loadFromImage(t,i,r):this._loadAsync(async s=>{const n=await gEe(i,i.src,!1,s);return Ir(s),this._loadFromImage(t,n,r)})}_loadFromVideoElement(t,r,i){return i.readyState>=nL.HAVE_CURRENT_DATA?this._loadFromImage(t,i,r):this._loadFromVideoElementAsync(t,r,i)}_loadFromVideoElementAsync(t,r,i){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{i.removeEventListener("loadeddata",l),i.removeEventListener("error",c),Gs(d)},l=()=>{i.readyState>=nL.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(t,i,r)))},c=p=>{a(),o(p||new z("Failed to load video"))};i.addEventListener("loadeddata",l),i.addEventListener("error",c);const d=jl(s,()=>c(oi()))}))}_loadFromImage(t,r,i){const s=ka._getDataDimensions(r);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?qe.RGB:qe.RGBA,!this._requiresPowerOfTwo(t,n)||dg(s.width)&&dg(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new dt(t,n,r),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,r,s,n,i),this._glTexture)}_loadAsync(t){const r=new AbortController;this._loadingController=r;const i=t(r.signal);this._loadingPromise=i;const s=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(s,s),i}_requiresPowerOfTwo(t,r){const i=It.CLAMP_TO_EDGE,s=typeof r.wrapMode=="number"?r.wrapMode===i:r.wrapMode.s===i&&r.wrapMode.t===i;return!eo(t.gl)&&(r.hasMipmap||!s)}_makePowerOfTwoTexture(t,r,i,s,n){const{width:o,height:a}=i,l=dR(o),c=dR(a);let d;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case cx.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],d=new dt(t,s),d.updateData(0,0,0,o,a,r);break;case cx.STRETCH:case null:case void 0:d=this._stretchToPowerOfTwo(t,r,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&d.generateMipmap(),d}_stretchToPowerOfTwo(t,r,i,s){const n=new dt(t,i),o=new ps(t,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE},n),a=new dt(t,{target:xt.TEXTURE_2D,pixelFormat:i.pixelFormat,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.LINEAR,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},r),l=Zl(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),t.bindFramebuffer(c),n}_drawStretchedTexture(t,r,i,s,n,o){this._passParameters.texture=n,t.bindFramebuffer(i);const a=t.getViewport();t.setViewport(0,0,o.descriptor.width,o.descriptor.height),t.bindTechnique(r,this._passParameters,null),t.bindVAO(s),t.drawArrays(Ut.TRIANGLE_STRIP,0,da(s,"geometry")),t.bindFramebuffer(null),t.setViewport(a.x,a.y,a.width,a.height),this._passParameters.texture=null}unload(){if(v(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:r,sourceTexture:i}=this._powerOfTwoStretchInfo;r.dispose(!0),i.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(v(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),v(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var nL;ka.DDS_ENCODING="image/vnd-ms.dds",ka.KTX2_ENCODING="image/ktx2",ka.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(nL||(nL={}));const QN=128,cce=.5;function CNe(e,t=QN,r=t*cce,i=0){const s=Nvt(e,t,r,i);return new ka(s,{mipmap:!1,wrap:{s:It.CLAMP_TO_EDGE,t:It.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function Nvt(e,t=QN,r=t*cce,i=0){switch(e){case"circle":default:return Fvt(t,r);case"square":return kvt(t,r);case"cross":return Bvt(t,r,i);case"x":return zvt(t,r,i);case"kite":return Uvt(t,r);case"triangle":return Vvt(t,r);case"arrow":return jvt(t,r)}}function Fvt(e,t){const r=e/2-.5;return m4(e,MNe(r,r,t/2))}function kvt(e,t){return ANe(e,t,!1)}function Uvt(e,t){return ANe(e,t,!0)}function Bvt(e,t,r=0){return ONe(e,t,!1,r)}function zvt(e,t,r=0){return ONe(e,t,!0,r)}function Vvt(e,t){return m4(e,RNe(e/2,t,t/2))}function jvt(e,t){const r=t,i=t/2,s=e/2,n=.8*r,o=MNe(s,(e-t)/2-n,Math.sqrt(n*n+i*i)),a=RNe(s,r,i);return m4(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function ANe(e,t,r){return r&&(t/=Math.SQRT2),m4(e,(i,s)=>{let n=i-.5*e+.25,o=.5*e-s-.75;if(r){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function ONe(e,t,r,i=0){t-=i,r&&(t*=Math.SQRT2);const s=.5*t;return m4(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(r){const d=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=d}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=i/2,a})}function MNe(e,t,r){return(i,s)=>{const n=i-e,o=s-t;return Math.sqrt(n*n+o*o)-r}}function RNe(e,t,r){const i=Math.sqrt(t*t+r*r);return(s,n)=>{const o=Math.abs(s-e)-r,a=n-e+t/2+.75,l=(t*o+r*a)/i,c=-a;return Math.max(l,c)}}function m4(e,t){const r=new Uint8Array(4*e*e);for(let i=0;i<e;i++)for(let s=0;s<e;s++){const n=s+e*i;let o=t(s,i);o=o/e+.5,KN(o,r,4*n)}return r}class w8t extends Zi{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function Gvt(e,t){INe(e,t,[new er("slicePlaneOrigin",(r,i)=>LNe(t,r,i)),new er("slicePlaneBasis1",(r,i)=>{var s;return NV(t,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new er("slicePlaneBasis2",(r,i)=>{var s;return NV(t,r,i,(s=i.slicePlane)==null?void 0:s.basis2)})])}function Rn(e,t){INe(e,t,[new Hh("slicePlaneOrigin",(r,i)=>LNe(t,r,i)),new Hh("slicePlaneBasis1",(r,i)=>{var s;return NV(t,r,i,(s=i.slicePlane)==null?void 0:s.basis1)}),new Hh("slicePlaneBasis2",(r,i)=>{var s;return NV(t,r,i,(s=i.slicePlane)==null?void 0:s.basis2)})])}function INe(e,t,r){if(!t.hasSlicePlane){const o=S`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(r),e.fragment.uniforms.add(r);const i=S`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=S`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?S`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:S`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(n)}function PNe(e,t,r){return e.instancedDoublePrecision?ue(Hvt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function $Ne(e,t){return v(e)?ge(FV,t.origin,e):t.origin}function DNe(e,t,r){return e.hasSliceTranslatedView?v(t)?Pu(qvt,r.camera.viewMatrix,t):r.camera.viewMatrix:null}function LNe(e,t,r){if(C(r.slicePlane))return Ic;const i=PNe(e,t,r),s=$Ne(i,r.slicePlane),n=DNe(e,i,r);return v(n)?je(FV,s,n):s}function NV(e,t,r,i){if(C(i)||C(r.slicePlane))return Ic;const s=PNe(e,t,r),n=$Ne(s,r.slicePlane),o=DNe(e,s,r);return v(o)?(ye(jP,i,n),je(FV,n,o),je(jP,jP,o),ge(jP,jP,FV)):i}const Hvt=$(),FV=$(),jP=$(),qvt=$e();function L7(e,t){const r=t.output===V.ObjectAndLayerIdColor,i=t.objectAndLayerIdColorInstanced;r&&(e.varyings.add("objectAndLayerIdColorVarying","vec4"),i?e.attributes.add(M.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):e.attributes.add(M.OBJECTANDLAYERIDCOLOR,"vec4")),e.vertex.code.add(S`
     void forwardObjectAndLayerIdColor() {
      ${r?i?S`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:S`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:S``} }`),e.fragment.code.add(S`
      void outputObjectAndLayerIdColor() {
        ${r?S`gl_FragColor = objectAndLayerIdColorVarying;`:S``} }`)}function Wvt(e,t){const{vertex:r,fragment:i}=e;t.hasMultipassGeometry&&r.include(vDe),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(S`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?S`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&i.include(tp),t.hasMultipassTerrain&&i.uniforms.add([...sg("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture,t.hasWebGL2Context?vi.None:vi.InvSize),new ai("nearFar",(s,n)=>n.camera.nearFar)]),i.include(Vd),i.code.add(S`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?S`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${vu(t,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const Xvt=ar(1,1,0,1),NNe=ar(1,0,1,1);function _1(e,t){e.fragment.uniforms.add(sg("depthTex",(r,i)=>i.highlightDepthTexture,t.hasWebGL2Context?vi.None:vi.InvSize)),e.fragment.constants.add("occludedHighlightFlag","vec4",Xvt).add("unoccludedHighlightFlag","vec4",NNe),e.fragment.code.add(S`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${vu(t,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)}class N7 extends tn{constructor(t,r,i){super(t,"vec4",Ri.Pass,(s,n,o)=>s.setUniform4fv(t,r(n,o)),i)}}class $l extends tn{constructor(t,r,i){super(t,"float",Ri.Pass,(s,n,o)=>s.setUniform1fv(t,r(n,o)),i)}}class uce extends GI{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Fe(1,1,1),this.vvSizeMaxSize=Fe(100,100,100),this.vvSizeOffset=Fe(0,0,0),this.vvSizeFactor=Fe(1,1,1),this.vvSizeValue=Fe(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Ts()}}const og=8;function WM(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(M.INSTANCEFEATUREATTRIBUTE,"vec4");const r=e.vertex;t.vvSize?(r.uniforms.add(new er("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new er("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new er("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new er("vvSizeFactor",i=>i.vvSizeFactor)),r.uniforms.add(new U0("vvSymbolRotationMatrix",i=>i.vvSymbolRotationMatrix)),r.uniforms.add(new er("vvSymbolAnchor",i=>i.vvSymbolAnchor)),r.code.add(S`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(S`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?S`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(S`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(r.constants.add("vvColorNumber","int",og),t.hasVvInstancing&&r.uniforms.add([new $l("vvColorValues",i=>i.vvColorValues,og),new N7("vvColorColors",i=>i.vvColorColors,og)]),r.code.add(S`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?S`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):r.code.add(S`vec4 vvColor() { return vec4(1.0); }`)}const kV=.1,hl=.001;var Ct;(function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"})(Ct||(Ct={}));function Yvt(e){const t=new Qr,r=e.signedDistanceFieldEnabled;if(t.include(Ale),t.include(dNe,e),t.include(Rn,e),e.occlusionPass)return t.include(Wvt,e),t;const{vertex:i,fragment:s}=t;t.include(tce),s.include(Vd),s.include(k0),t.include(WM,e),t.include(L7,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),i.uniforms.add([new Tr("viewport",(c,d)=>d.camera.fullViewport),new ai("screenOffset",(c,d)=>mr(FNe,2*c.screenOffset[0]*d.camera.pixelRatio,2*c.screenOffset[1]*d.camera.pixelRatio)),new ai("anchorPosition",c=>UV(c)),new Tr("materialColor",c=>c.color),new De("pixelRatio",(c,d)=>d.camera.pixelRatio)]),r&&(i.uniforms.add(new Tr("outlineColor",c=>c.outlineColor)),s.uniforms.add([new Tr("outlineColor",c=>c_e(c)?c.outlineColor:u0),new De("outlineSize",c=>c_e(c)?c.outlineSize:0)])),e.hasScreenSizePerspective&&(Z_t(i),I7(i)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(M.UV0,"vec2"),t.attributes.add(M.COLOR,"vec4"),t.attributes.add(M.SIZE,"vec2"),t.attributes.add(M.AUXPOS2,"vec4"),i.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?S`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:S`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=S`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=e.pixelSnappingEnabled?r?S`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:S`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:S`posProj += quadOffset;`;e.vvColor&&i.uniforms.add([new N7("vvColorColors",c=>c.vvColorColors,og),new $l("vvColorValues",c=>c.vvColorValues,og)]),i.uniforms.add(new ai("textureCoordinateScaleFactor",c=>v(c.texture)&&v(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:OPe)),i.code.add(S`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${S.float(hl)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${S.float(hl)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?S`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new Rt("tex",c=>c.texture));const a=e.debugDrawLabelBorder?S`(isBorder > 0.0 ? 0.0 : ${S.float(kV)})`:S.float(kV),l=S`
    ${e.debugDrawLabelBorder?S`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?S`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${S.float(QN)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${S.float(hl)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:S`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?S`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===V.Alpha&&s.code.add(S`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===V.ObjectAndLayerIdColor&&s.code.add(S`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),e.output===V.Color&&s.code.add(S`
    void main() {
      ${l}
      ${e.transparencyPassType===Ct.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===V.Highlight&&(t.include(_1,e),s.code.add(S`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?S`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function c_e(e){return e.outlineColor[3]>0&&e.outlineSize>0}function UV(e,t=FNe){return e.textureIsSignedDistanceField?Zvt(e.anchorPosition,e.distanceFieldBoundingBox,t):Ho(t,e.anchorPosition),t}function Zvt(e,t,r){v(t)?mr(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):mr(r,0,0)}const FNe=rt(),Jvt=Object.freeze(Object.defineProperty({__proto__:null,build:Yvt,calculateAnchorPosForRendering:UV},Symbol.toStringTag,{value:"Module"})),qh=ma(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),Kvt=Pf(Ae.ONE,Ae.ONE),kNe=Pf(Ae.ZERO,Ae.ONE_MINUS_SRC_ALPHA);function v1(e){return e===Ct.FrontFace?null:e===Ct.Alpha?kNe:Kvt}function F7(e){return e===Ct.FrontFace?$u:null}const k7=5e5,U7={factor:-1,units:-2};function B7(e){return e?U7:null}function rT(e,t=rs.LESS){return e===Ct.NONE||e===Ct.FrontFace?t:rs.LEQUAL}class z7 extends li{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2,r.spherical=t.viewingMode===Ye.Global}initializeProgram(t){return new ti(t.rctx,z7.shader.get().build(this.configuration),Yr)}_setPipelineState(t){const r=this.configuration,i=t===Ct.NONE,s=t===Ct.FrontFace,n=this.configuration.hasPolygonOffset&&Qvt,o=(i||s)&&r.output!==V.Highlight?(r.depthEnabled||r.occlusionPass)&&$u:null;return Ht({blending:r.output===V.Color||r.output===V.Alpha||r.output===V.Highlight?i?e1t:v1(t):null,depthTest:{func:rs.LEQUAL},depthWrite:o,colorWrite:cr,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Ut.POINTS:Ut.TRIANGLES}}z7.shader=new ei(Jvt,()=>re(()=>import("./HUDMaterial.glsl.55006c75.js"),[]));const Qvt={factor:0,units:-4},e1t=Pf(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA);class xn extends aa{constructor(){super(...arguments),this.output=V.Color,this.screenCenterOffsetUnitsEnabled=gu.World,this.transparencyPassType=Ct.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}u([j({count:V.COUNT})],xn.prototype,"output",void 0),u([j({count:gu.COUNT})],xn.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j({count:Ct.COUNT})],xn.prototype,"transparencyPassType",void 0),u([j()],xn.prototype,"spherical",void 0),u([j()],xn.prototype,"occlusionTestEnabled",void 0),u([j()],xn.prototype,"signedDistanceFieldEnabled",void 0),u([j()],xn.prototype,"vvSize",void 0),u([j()],xn.prototype,"vvColor",void 0),u([j()],xn.prototype,"hasVerticalOffset",void 0),u([j()],xn.prototype,"hasScreenSizePerspective",void 0),u([j()],xn.prototype,"debugDrawLabelBorder",void 0),u([j()],xn.prototype,"binaryHighlightOcclusionEnabled",void 0),u([j()],xn.prototype,"hasSlicePlane",void 0),u([j()],xn.prototype,"hasPolygonOffset",void 0),u([j()],xn.prototype,"depthEnabled",void 0),u([j()],xn.prototype,"pixelSnappingEnabled",void 0),u([j()],xn.prototype,"isDraped",void 0),u([j()],xn.prototype,"hasMultipassGeometry",void 0),u([j()],xn.prototype,"hasMultipassTerrain",void 0),u([j()],xn.prototype,"cullAboveGround",void 0),u([j()],xn.prototype,"occlusionPass",void 0),u([j()],xn.prototype,"objectAndLayerIdColorInstanced",void 0),u([j({constValue:!0})],xn.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],xn.prototype,"hasVvInstancing",void 0);class aI extends z0{constructor(t){super(t,new u1t),this._configuration=new xn}getConfiguration(t,r){return this._configuration.output=t,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?gu.Screen:gu.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=r.slot===Ee.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(t===V.Color||t===V.Alpha),t===V.Color&&(this._configuration.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),t===V.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(t,r,i,s,n,o,a,l,c){v(c)?this._intersectDrapedHudGeometry(t,o,a,l,c):this._intersectHudGeometry(t,r,i,s,a,l)}_intersectDrapedHudGeometry(t,r,i,s,n){const o=t.vertexAttributes.get(M.POSITION),a=t.vertexAttributes.get(M.SIZE),l=this.parameters,c=UV(l);let d=1,p=1;if(v(s)){const m=s(h_e);d=m[0],p=m[5]}d*=t.screenToWorldRatio,p*=t.screenToWorldRatio;const f=l1t*t.screenToWorldRatio;for(let m=0;m<o.data.length/o.size;m++){const g=m*o.size,_=o.data[g],x=o.data[g+1],b=m*a.size;let w;W1[0]=a.data[b]*d,W1[1]=a.data[b+1]*p,l.textureIsSignedDistanceField&&(w=l.outlineSize*t.screenToWorldRatio/2),u_e(r,_,x,W1,f,w,l,c)&&i(n.dist,n.normal,-1,!1)}}_intersectHudGeometry(t,r,i,s,n,o){if(!s.options.selectionMode||!s.options.hud||d4(r))return;const a=this.parameters;let l=1,c=1;if(Tf(sX,i),v(o)){const w=o(h_e);l=w[0],c=w[5],i1t(sX)}const d=t.vertexAttributes.get(M.POSITION),p=t.vertexAttributes.get(M.SIZE),f=t.vertexAttributes.get(M.NORMAL),m=t.vertexAttributes.get(M.AUXPOS1);Et(d.size>=3);const g=s.point,_=s.camera,x=UV(a);l*=_.pixelRatio,c*=_.pixelRatio;const b=this.parameters.centerOffsetUnits==="screen";for(let w=0;w<d.data.length/d.size;w++){const T=w*d.size;ue(_l,d.data[T],d.data[T+1],d.data[T+2]),je(_l,_l,i);const E=w*p.size;W1[0]=p.data[E]*l,W1[1]=p.data[E+1]*c,je(_l,_l,_.viewMatrix);const O=w*m.size;if(ue(Yd,m.data[O+0],m.data[O+1],m.data[O+2]),!b&&(_l[0]+=Yd[0],_l[1]+=Yd[1],Yd[2]!==0)){const R=Yd[2];xe(Yd,_l),ge(_l,_l,de(Yd,Yd,R))}const A=w*f.size;if(ue(GP,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(GP,sX,_,nX),this._applyVerticalOffsetTransformationView(_l,nX,_,iX),_.applyProjection(_l,ac),ac[0]>-1){ac[0]=Math.floor(ac[0]),ac[1]=Math.floor(ac[1]),b&&(Yd[0]||Yd[1])&&(ac[0]+=Yd[0],Yd[1]!==0&&(ac[1]+=ece(Yd[1],iX.factorAlignment)),_.unapplyProjection(ac,_l)),ac[0]+=this.parameters.screenOffset[0],ac[1]+=this.parameters.screenOffset[1],sNe(W1,iX.factor,W1);const R=a1t*_.pixelRatio;let D;if(a.textureIsSignedDistanceField&&(D=a.outlineSize*_.pixelRatio/2),u_e(g,ac[0],ac[1],W1,R,D,a,x)){const k=s.ray;if(je(d_e,_l,Pn(o1t,_.viewMatrix)),ac[0]=g[0],ac[1]=g[1],_.unprojectFromRenderScreen(ac,_l)){const L=$();le(L,k.direction);const q=1/Ie(L);de(L,L,q),n(Ni(k.origin,_l)*q,L,-1,!0,1,d_e)}}}}}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return!1;const s=i.get(M.POSITION),n=t.indices.get(M.POSITION);return DDe(s,n,r)}createBufferWriter(){return new h1t(this)}_normalAndViewAngle(t,r,i,s){return Y_t(r)&&(r=Tf(n1t,r)),Td(s.normal,t,r),je(s.normal,s.normal,i.viewInverseTransposeMatrix),s.cosAngle=Te(UNe,c1t),s}_updateScaleInfo(t,r,i){const s=this.parameters;v(s.screenSizePerspective)?s_e(i,r,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),v(s.screenSizePerspectiveAlignment)?s_e(i,r,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,r,i,s,n,o,a){const l=this._normalAndViewAngle(r,i,n,nX);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,r,i,s,n){return this._applyCenterOffsetNDC(t,r,i,s),v(n)&&le(n,s),this._applyPolygonOffsetNDC(s,r,i,s),s}_applyPolygonOffsetView(t,r,i,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return le(n,t);const c=_e(Math.abs(r.cosAngle),.01,1),d=1-Math.sqrt(1-c*c)/c/s.viewport[2];return de(n,t,l>0?d:1/d),n}_applyVerticalGroundOffsetView(t,r,i,s){const n=Ie(t),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(n),l=de(_l,r.normal,o*a);return ye(s,t,l),s}_applyVerticalOffsetTransformationView(t,r,i,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Ie(t);this._updateScaleInfo(s,c,r.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=Ie(t),a=yt(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=mNe(i,o,n.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(s,o,r.cosAngle),de(r.normal,r.normal,l),ye(t,t,r.normal)}_applyCenterOffsetView(t,r,i){const s=this.parameters.centerOffsetUnits!=="screen";return i!==t&&le(i,t),s&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(xe(GP,i),ye(i,i,de(GP,GP,r[2])))),i}_applyCenterOffsetNDC(t,r,i,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&le(s,t),n||(s[0]+=r[0]/i.fullWidth*2,s[1]+=r[1]/i.fullHeight*2),s}_applyPolygonOffsetNDC(t,r,i,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&le(s,t),n){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);s[2]-=(a||o)*n}return s}requiresSlot(t,r){if(r===V.Color||r===V.Alpha||r===V.Highlight||r===V.ObjectAndLayerIdColor){if(t===Ee.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:s}=this.parameters;return t===(i?Ee.LABEL_MATERIAL:Ee.HUD_MATERIAL)||s&&t===Ee.OCCLUSION_PIXELS}return!1}createGLMaterial(t){return new t1t(t)}calculateRelativeScreenBounds(t,r,i=tr()){return r1t(this.parameters,t,r,i),i[2]=i[0]+t[0],i[3]=i[1]+t[1],i}}class t1t extends mle{constructor(t){super({...t,...t.material.parameters})}selectProgram(t){return this.ensureTechnique(z7,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}function r1t(e,t,r,i=s1t){return Ho(i,e.anchorPosition),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r,i}function i1t(e){const t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],d=1/Math.sqrt(t*t+r*r+i*i),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*d,e[1]=r*d,e[2]=i*d,e[3]=s*p,e[4]=n*p,e[5]=o*p,e[6]=a*f,e[7]=l*f,e[8]=c*f,e}function u_e(e,t,r,i,s,n,o,a){let l=t-s-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*s,d=r-s-(a[1]>0?i[1]*a[1]:0),p=d+i[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&v(f)&&(l+=i[0]*f[0],d+=i[1]*f[1],c-=i[0]*(1-f[2]),p-=i[1]*(1-f[3]),l-=n,c+=n,d-=n,p+=n),e[0]>l&&e[0]<c&&e[1]>d&&e[1]<p}const iX={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},s1t=rt(),_l=$(),GP=$(),ac=Lr(),UNe=$(),d_e=$(),sX=Ts(),n1t=Ts(),o1t=$e(),Yd=$(),nX={normal:UNe,cosAngle:0},h_e=$e(),a1t=1,l1t=2,W1=[0,0],c1t=Fe(0,0,1);class u1t extends fDe{constructor(){super(...arguments),this.renderOccluded=Rs.Occlude,this.color=ar(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=pi(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=ar(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const BNe=Ds().vec3f(M.POSITION).vec3f(M.NORMAL).vec2f(M.UV0).vec4u8(M.COLOR).vec2f(M.SIZE).vec4f(M.AUXPOS1).vec4f(M.AUXPOS2),d1t=BNe.clone().vec4u8(M.OBJECTANDLAYERIDCOLOR);class h1t{constructor(t){this._material=t,this.vertexBufferLayout=pe("enable-feature:objectAndLayerId-rendering")?d1t:BNe}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(M.POSITION).length}write(t,r,i,s,n){$7(i.indices.get(M.POSITION),i.vertexAttributes.get(M.POSITION).data,t,s.position,n,6),nce(i.indices.get(M.NORMAL),i.vertexAttributes.get(M.NORMAL).data,r,s.normal,n,6);{const o=i.vertexAttributes.get(M.UV0).data;let a,l,c,d;if(o==null||o.length<4){const g=this._material.parameters;a=0,l=0,c=g.texCoordScale[0],d=g.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],d=o[3];c=Math.min(1.99999,c+1),d=Math.min(1.99999,d+1);const p=i.indices.get(M.POSITION).length,f=s.uv0;let m=n;for(let g=0;g<p;++g)f.set(m,0,a),f.set(m,1,l),m+=1,f.set(m,0,c),f.set(m,1,l),m+=1,f.set(m,0,c),f.set(m,1,d),m+=1,f.set(m,0,c),f.set(m,1,d),m+=1,f.set(m,0,a),f.set(m,1,d),m+=1,f.set(m,0,a),f.set(m,1,l),m+=1}LV(i.indices.get(M.COLOR),i.vertexAttributes.get(M.COLOR).data,4,s.color,n,6);{const o=i.indices.get(M.SIZE),a=i.vertexAttributes.get(M.SIZE).data,l=o.length,c=s.size;let d=n;for(let p=0;p<l;++p){const f=a[2*o[p]],m=a[2*o[p]+1];for(let g=0;g<6;++g)c.set(d,0,f),c.set(d,1,m),d+=1}}if(i.indices.get(M.AUXPOS1)&&i.vertexAttributes.get(M.AUXPOS1)&&oI(i.indices.get(M.AUXPOS1),i.vertexAttributes.get(M.AUXPOS1).data,s.auxpos1,n,6),i.indices.get(M.AUXPOS2)&&i.vertexAttributes.get(M.AUXPOS2)&&oI(i.indices.get(M.AUXPOS2),i.vertexAttributes.get(M.AUXPOS2).data,s.auxpos2,n,6),v(i.objectAndLayerIdColor)&&i.objectAndLayerIdColor.length===4&&i.indices.get(M.POSITION)){const o=i.indices.get(M.POSITION).length,a=s.getField(M.OBJECTANDLAYERIDCOLOR,Go);vNe(i.objectAndLayerIdColor,a,o,n,6)}}}const Dg=$(),HC=Lr(),HP=Lr(),oX=$(),p1t=$e(),f1t=qo(),aX=ca(),m1t=$(),g1t=tr();class y1t{constructor(){this.aabr=tr(),this.distance=0,this.culled=!1,this.visible=!1}}class _1t{constructor(t,r,i={}){this.graphics3DGraphic=t,this.slicePlaneEnabled=r,this.info=i}}class v1t{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class b1t{}class w1t{constructor(){this.sortArray=new Qt({allocator:t=>t||new b1t})}}var ad;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(ad||(ad={}));class zNe{constructor(){this.camera=new Li,this.slicePlane=u1(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),hC(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let sM=class extends be{constructor(e){super(e),this._dirty=!1,this._runningViewState=new zNe,this._state=ad.Idle,this._graphics=new v1t,this._iterators=new w1t,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this._graphics.clear(),this._iterators=null}setDirty(){!this._dirty&&this._graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==ad.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/ad.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case ad.Idle:this._startUpdate(),e.madeProgress();case ad.Process:if(this._state=ad.Process,!this._processActiveGraphics(e))return;case ad.Sort:if(this._state=ad.Sort,!this._sortVisibleGraphics(e))return;case ad.Deconflict:if(this._state=ad.Deconflict,!this._deconflictVisibleGraphics(e))return;default:k_t(this,this._graphics.visible),this._state=ad.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(r=>this.addToActiveGraphics(r)):e.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(e){if(C(e)||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometryRecords.length:0)!==1?!1:t.geometryRecords[0].material instanceof aI}_startUpdate(){U_t(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new y1t,this._graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),x1t(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this._graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this._graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this._graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),r=Pn(p1t,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?f1t:null;let s=0;for(v(i)&&(je(i,Ic,this._runningViewState.camera.viewMatrix),i[3]=Kr(this.view.spatialReference).radius,s=LPe(i,Ic));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,s),a.culled?this._removeFromVisibleGraphics(o):this._addToVisibleGraphics(o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const r=t.next();if(e.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===Ua.LABEL;for(;!e.done;){e.madeProgress();const i=t.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=i.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!r||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),z_t(n,a)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=p_e(this._graphics.active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=p_e(this._graphics.visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=T1t(this._graphics.visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(e,t,r,i){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible(Ua.GRAPHIC,Dh.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);kd(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometryRecords[0].material;if(C(a)){if(a=this._getProjectionInfo(l,t,C1t),a.isOutsideScreen||this._isCulledBySlice(e,Dg)||v(r)&&this._isCulledByHorizon(a,r,i))return void(n.culled=!0);!hi.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}C(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,r){const i=this._runningViewState.camera,s=e.stageObject,n=s.geometryRecords[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;je(Dg,a,i.viewMatrix);const l=n.geometry.vertexAttributes,c=l.get(M.NORMAL).data,d=l.get(M.AUXPOS1).data;return o.applyShaderOffsetsView(Dg,c,s.transformation,d,i,r.scaleInfo,Dg),Oi(HC,Dg[0],Dg[1],Dg[2],1),kh(HP,HC,i.projectionMatrix),de(r.positionNDC,HP,1/HP[3]),o.applyShaderOffsetsNDC(r.positionNDC,d,i,r.positionNDC,oX),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(oX[2]),r.distance=oX[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),Oi(HP,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),kh(HC,HP,t),NF(HC,HC,1/HC[3]),ue(r.positionView,Dg[0],Dg[1],Dg[2]),r}_isCulledByHorizon(e,t,r){return le(aX.direction,e.positionView),ue(aX.origin,0,0,0),!!Qx(t,aX,m1t)&&e.distanceWithoutPolygonOffset>r}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&Dae(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,r,{positionNDC:i,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(S1t);sNe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=Nz(r.calculateRelativeScreenBounds(o,s.factorAlignment.scale,g1t),Ft(0,n.fullWidth,.5+.5*i[0]),Ft(0,n.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Ph(a),pg(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}ox(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,r=e.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;const n=this._accBins[i][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,HF(l.aabr,r.aabr)))return!0}}return!1}_initBins(e,t){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)i.push(new Qt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=e/this._accBinsNumX,this._accBinsSizeY=t/this._accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],r=Math.floor(t.aabr[0]/this._accBinsSizeX),i=Math.floor(t.aabr[2]/this._accBinsSizeX),s=Math.floor(t.aabr[1]/this._accBinsSizeY),n=Math.floor(t.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(e)}_setGraphicVisibility(e,t){const r=e.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(Dh.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===Ua.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,t))}};function x1t(e,t){const r=e.graphics3DGraphic;r.destroyed||r.clearVisibilityFlag(Dh.DECONFLICTION,t)}function*p_e(e){if(Map.prototype.entries){const t=e.entries();for(let r=t.next();!r.done;r=t.next())yield r.value[1]}else yield*e.values()}function*T1t(e,t,r){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.prio=s.info?-s.info[r].distance:Number.MAX_VALUE}),yield;const i=t.iterableSort((s,n)=>n.prio-s.prio);for(let s=i.next();!s.done;s=i.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}u([h({constructOnly:!0})],sM.prototype,"view",void 0),u([h({type:Boolean,readOnly:!0})],sM.prototype,"updating",null),sM=u([I("esri.views.3d.layers.graphics.Deconflictor")],sM);const S1t=rt();class E1t{constructor(){this.positionView=$(),this.positionNDC=$(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const C1t=new E1t,A1t=2e3;let HB=class extends sM{constructor(e){super(e),this.visibilityGroup=Ua.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===Kn.IDLE||t-this._lastDeconfliction>A1t)&&(super.runTask(e),this.state===ad.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};u([h({constructOnly:!0})],HB.prototype,"parent",void 0),HB=u([I("esri.views.3d.layers.graphics.LabelDeconflictor")],HB);let bre=class extends sM{constructor(){super(...arguments),this._handles=new hr,this._contexts=new Map,this._viewState=new zNe,this.visibilityGroup=Ua.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ie(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),ie(()=>{var e,t,r;return(r=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:r.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),ie(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},pt)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Ot.GRAPHICS_DECONFLICTOR,this),this._labels=new HB({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const r=!(this._graphicSupportsDeconfliction(t)&&lX(e));t.setVisibilityFlag(Dh.DECONFLICTION,r,Ua.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;v(e)&&c3e(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=v(e)}_slicePlaneChanged(){wo(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return t==null&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:r=>this._addGraphic(e,t,r),removeGraphic:r=>this._removeGraphic(t,r),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,r){const i=r.graphic.uid,s=new _1t(r,e.symbolCreationContext.slicePlaneEnabled);t.set(i,s),lX(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const r=t.graphic.uid,i=e.get(r);i&&(this.removeFromActiveGraphics(i),this._labels.removeFromActiveGraphics(i),e.delete(r),this.setDirty())}enabledChanged(e,t){const r=lX(e);r||O1t(e),this.modifyGraphics(t,r)}_slicePlaneEnabledChanged(e,t){const r=e.symbolCreationContext.slicePlaneEnabled;t.forEach(i=>i.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const r of t)if(this.layerSupportsDeconfliction(r))return!0;return!1}};function lX(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function O1t(e){const t=e.graphics3DGraphics;t&&t.forEach(r=>r.clearVisibilityFlag(Dh.DECONFLICTION))}bre=u([I("esri.views.3d.layers.graphics.GraphicsDeconflictor")],bre);const dce=(e,t,r)=>[t,r],lI=(e,t,r)=>[t,r,e[2]],hce=(e,t,r)=>[t,r,e[2],e[3]];function x8t(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:v(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function M1t({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function R1t({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function VNe({scale:e,translate:t},r){return r*e[0]+t[0]}function jNe({scale:e,translate:t},r){return t[1]-r*e[1]}function GNe(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[s,n]=e.scale;let o=VNe(e,r[0][0]),a=jNe(e,r[0][1]);i[0]=t(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*s,a-=c[1]*n,i[l]=t(c,o,a)}return i}function HNe(e,t,r){const i=new Array(r.length);for(let s=0;s<r.length;s++)i[s]=GNe(e,t,r[s]);return i}function I1t(e,t,r,i){return GNe(e,r?i?hce:lI:i?lI:dce,t)}function P1t(e,t,r,i){return HNe(e,r?i?hce:lI:i?lI:dce,t)}function $1t(e,t,r,i){return HNe(e,r?i?hce:lI:i?lI:dce,t)}function T8t(e,t,r,i,s){return t.x=M1t(e,r.x),t.y=R1t(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m)),t}function qNe(e,t,r,i,s){return v(r)&&(t.points=I1t(e,r.points,i,s)),t}function WNe(e,t,r,i,s){return C(r)||(t.x=VNe(e,r.x),t.y=jNe(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m))),t}function XNe(e,t,r,i,s){return v(r)&&(t.rings=$1t(e,r.rings,i,s)),t}function YNe(e,t,r,i,s){return v(r)&&(t.paths=P1t(e,r.paths,i,s)),t}class S8t{constructor(t,r,i){this.uid=t,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function E8t(e){return v(e.geometry)}class C8t{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function A8t(e){const t=oAe.fromJSON(e.geometryType),r=Ve.fromJSON(e.spatialReference),i=e.transform,s=e.features.map(n=>{const o=D1t(n,t,r,e.objectIdFieldName),a=o.geometry;if(v(a)&&i)switch(a.type){case"point":o.geometry=WNe(i,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=qNe(i,a,a,a.hasZ,a.hasM);break;case"polygon":o.geometry=XNe(i,a,a,a.hasZ,a.hasM);break;case"polyline":o.geometry=YNe(i,a,a,a.hasZ,a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:t,features:s,spatialReference:r,fields:e.fields?e.fields.map(n=>Aj.fromJSON(n)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function D1t(e,t,r,i){return{uid:Su(),objectId:i&&e.attributes?e.attributes[i]:null,attributes:e.attributes,geometry:L1t(e.geometry,t,r),visible:!0}}function L1t(e,t,r){if(C(e))return null;switch(t){case"point":{const i=e;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=e;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=e;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=e;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function b1(e,t,r,i){return{x:e,y:t,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function N1t(e){if(C(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)r+=n.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32*(s.length+1);break}case"multipoint":{const r=2+(e.hasZ?1:0)+(e.hasM?1:0),i=e.points.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=Q4(e.vertexAttributes.position),t+=Q4(e.vertexAttributes.normal),t+=Q4(e.vertexAttributes.uv),t+=Q4(e.vertexAttributes.tangent)}return t}function O8t(e){let t=32;return t+=yPe(e.attributes),t+=3,t+=8+N1t(e.geometry),t}function F1t(e){if(C(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const r of e.paths)t+=r.length;return t}case"polygon":{let t=0;for(const r of e.rings)t+=r.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function M8t(e){if(C(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function R8t(e,t){switch(es(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)hq(t,e.paths[r],e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)hq(t,e.rings[r],e.hasZ);break;case"multipoint":hq(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function k1t(e,t){switch(kd(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)dq(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)dq(t,e.rings[r]);break;case"multipoint":dq(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function I8t(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}ao();tr();function ZNe(e){return"declaredClass"in e}function f_e(e){return"declaredClass"in e}function U1t(e){return"declaredClass"in e}function B1t(e,t){if(!e)return null;if(U1t(e))return e;const r=new _i({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=ne(e.symbol),r.attributes=ne(e.attributes),r.geometry=JNe(e.geometry),r}function JNe(e){return C(e)?null:ZNe(e)?e:ql(z1t(e))}function z1t(e){const{wkid:t,wkt:r,latestWkid:i}=e.spatialReference,s={wkid:t,wkt:r,latestWkid:i};switch(e.type){case"point":{const{x:n,y:o,z:a,m:l}=e;return{x:n,y:o,z:a,m:l,spatialReference:s}}case"polygon":{const{rings:n,hasZ:o,hasM:a}=e;return{rings:m_e(n),hasZ:o,hasM:a,spatialReference:s}}case"polyline":{const{paths:n,hasZ:o,hasM:a}=e;return{paths:m_e(n),hasZ:o,hasM:a,spatialReference:s}}case"extent":{const{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:d,mmin:p,mmax:f,hasZ:m,hasM:g}=e;return{xmin:n,xmax:o,ymin:a,ymax:l,zmin:c,zmax:d,mmin:p,mmax:f,hasZ:m,hasM:g,spatialReference:s}}case"multipoint":{const{points:n,hasZ:o,hasM:a}=e;return{points:QNe(n)?KNe(n):n,hasZ:o,hasM:a,spatialReference:s}}default:return}}function m_e(e){return V1t(e)?e.map(t=>KNe(t)):e}function KNe(e){return e.map(t=>dze(t))}function V1t(e){for(const t of e)if(t.length!==0)return QNe(t);return!1}function QNe(e){return e.length&&(Lse(e[0])||Nse(e[0]))}function j1t(e,t){if(!e)return null;let r;if(f_e(e)){if(t==null)return e.clone();if(f_e(t))return t.copy(e)}return t!=null?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=b1(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}function P8t(e){const{wkid:t,wkt:r,latestWkid:i}=e,s={wkid:t,wkt:r,latestWkid:i};return Ve.fromJSON(s)}const cX=te.getLogger("esri.layers.support.labelFormatUtils"),uX={type:"simple",evaluate:()=>null},G1t={getAttribute:(e,t)=>e.field(t)};async function eFe(e,t,r){if(!e||!e.symbol)return uX;const i=e.where,s=kj(e),n=i?await re(()=>import("./WhereClause.b191b7a3.js"),[]):null;let o;if(s.type==="arcade"){const a=await mYe(s.expression,r,t);if(C(a))return uX;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{cX.error(new z("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>sae(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),d=t.get(c);if(!d)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[d.name]):p=a.field(d.name),p==null?"":tFe(p,d)})};if(i){let a;try{a=n.WhereClause.create(i,t)}catch(c){return cX.error(new z("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),uX}const l=o.evaluate;o.evaluate=c=>{const d="attributes"in c?void 0:G1t;try{if(a.testFeature(c,d))return l(c)}catch(p){cX.error(new z("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:p}))}return null}}return o}function tFe(e,t){if(e==null)return"";const r=t.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const s=e;for(const n of r.codedValues)if(n.code===s)return n.name}else if(r.type==="range"){const s=+e,n="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(n<=s&&s<=o)return r.name}}let i=e;return t.type==="date"||t.type==="esriFieldTypeDate"?i=_s(i,iE("short-date")):ij(t)&&(i=Yh(+i)),i||""}const $8t=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:eFe,formatField:tFe},Symbol.toStringTag,{value:"Module"}));function pce(e,t){if(e.type==="point")return X1(e,t,!1);if(ZNe(e))switch(e.type){case"extent":return X1(e.center,t,!1);case"polygon":return X1(e.centroid,t,!1);case"polyline":return X1(g_e(e),t,!0);case"mesh":return X1(e.origin,t,!1)}else switch(e.type){case"extent":return X1(H1t(e),t,!0);case"polygon":return X1(q1t(e),t,!0);case"polyline":return X1(g_e(e),t,!0)}}function g_e(e){const t=e.paths[0];if(!t||t.length===0)return null;const r=GCe(t,jCe(t)/2);return b1(r[0],r[1],r[2],e.spatialReference)}function H1t(e){const t=isFinite(e.zmin);return b1(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function q1t(e){const t=e.rings[0];if(!t||t.length===0)return null;const r=Fne(e.rings,e.hasZ);return b1(r[0],r[1],r[2],e.spatialReference)}function X1(e,t,r){const i=r?e:j1t(e);return t&&e?Sit(e,i,t)?i:null:i}function D8t(e,t,r,i=0){if(e){t||(t=tr());const s=e;let n=.5*s.width*(r-1),o=.5*s.height*(r-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Oi(t,s.xmin-n-i,s.ymin-o-i,s.xmax+n+i,s.ymax+o+i),t}return null}function rFe(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute(M.AUXPOS1);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[r]))}}function oL(e,t){const r=vj(rf);return v(e)&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),v(t)?r[3]=t:v(e)&&e.length>3&&(r[3]=e[3]),r}function L8t(e,t,r,i,s,n=[0,0,0,0]){for(let o=0;o<3;++o)v(e)&&e[o]!=null?n[o]=e[o]:v(r)&&r[o]!=null?n[o]=r[o]:n[o]=s[o];return v(t)?n[3]=t:v(i)?n[3]=i:n[3]=s[3],n}function y_e(e=Xy,t,r,i=1){const s=new Array(3);if(C(t)||C(r))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const d=l!=null,p=a===0&&!n&&!d,f=r[a];l==="symbol-value"||p?c=f!==0?t[a]/f:1:d&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=i;return pu(s)}function W1t(e){return e.isPrimitive!=null}function V7(e){return W1t(e)&&(e=[e.width,e.depth,e.height]),BV(e)?null:"Symbol sizes may not be negative values"}function BV(e){if(Array.isArray(e)){for(const t of e)if(!BV(t))return!1;return!0}return e==null||e>=0}function X1t(e,t,r,i=$e()){const s=e||0,n=t||0,o=r||0;return s!==0&&DR(i,i,-s/180*Math.PI),n!==0&&$R(i,i,n/180*Math.PI),o!==0&&Mj(i,i,o/180*Math.PI),i}function fce(e,t,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=Fc(t),s=tC(e)*i,n=rC(e)*i,o=Kx(e)*(t.isGeographic?1:i);return s===0&&n===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(s,n,o)}function iFe(e,t,r,i,s,n,o,a,l,c,d){const p=rbt[d.mode];let f,m,g=0;if(Yi(e,t,r,i,l.spatialReference,s,a))return p.requiresAlignment(d)?(g=p.applyElevationAlignmentBuffer(i,s,n,o,a,l,c,d),f=n,m=o):(f=i,m=s),Yi(f,l.spatialReference,m,n,c.spatialReference,o,a)?g:void 0}function t1(e,t,r,i,s){const n=(OV(e)?e.z:ILe(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const o=yt(Zy(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=yt(Zy(t,e,"ground"),0),a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=yt(Zy(t,e,"scene"),0),a=r.geometryZWithOffset(n,i);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(n,i),a=yt(Zy(t,e,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return r.mode,void(s.z=0)}}function Y1t(e,t,r,i){return t1(e,t,r,i,nM),nM.z}function g4(e,t,r){return t==null||r==null?e.definedChanged:t==="on-the-ground"&&r==="on-the-ground"?e.staysOnTheGround:t===r||t!=="on-the-ground"&&r!=="on-the-ground"?en.UPDATE:e.onTheGroundChanged}function Mf(e){return e==="relative-to-ground"||e==="relative-to-scene"}function Bx(e){return e!=="absolute-height"}function Z1t(e,t,r,i,s){t1(t,r,s,i,nM),rFe(e,nM.verticalDistanceToGround);const n=nM.sampledElevation,o=jn(ibt,e.transformation);return jk[0]=t.x,jk[1]=t.y,jk[2]=nM.z,Qh(t.spatialReference,jk,o,i.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function J1t(e,t,r,i,s,n){let o=0;const a=n.spatialReference;t*=3,i*=3;for(let l=0;l<s;++l){const c=e[t+0],d=e[t+1],p=e[t+2],f=yt(n.getElevation(c,d,p,a,"ground"),0);o+=f,r[i+0]=c,r[i+1]=d,r[i+2]=f,t+=3,i+=3}return o/s}function K1t(e,t,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),d=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,i*=3;for(let f=0;f<s;++f){const m=e[t+0],g=e[t+1],_=e[t+2],x=yt(n.getElevation(m,g,_,p,"ground"),0);l+=x,r[i+0]=m,r[i+1]=g,r[i+2]=d==null?_+x+c:x+c,t+=3,i+=3}return l/s}function Q1t(e,t,r,i,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),d=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,i*=3;for(let f=0;f<s;++f){const m=e[t+0],g=e[t+1],_=e[t+2],x=yt(n.getElevation(m,g,_,p,"scene"),0);l+=x,r[i+0]=m,r[i+1]=g,r[i+2]=d==null?_+x+c:x+c,t+=3,i+=3}return l/s}function ebt(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return t!==0||r!=null}function tbt(e,t,r,i,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,i*=3;for(let d=0;d<s;++d){const p=e[t+0],f=e[t+1],m=e[t+2];r[i+0]=p,r[i+1]=f,r[i+2]=c==null?m+l:l,t+=3,i+=3}return 0}class y4{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var en;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(en||(en={}));const rbt={"absolute-height":{applyElevationAlignmentBuffer:tbt,requiresAlignment:ebt},"on-the-ground":{applyElevationAlignmentBuffer:J1t,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:K1t,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Q1t,requiresAlignment:()=>!0}},ibt=$e(),nM=new y4,jk=$();function sFe(e,t,r,i){const s=e.stageObject,n=s.geometryRecords;let o=0;for(const a of n){const{update:l,averageGeometrySampledElevation:c}=oFe(a,t,r,i);o+=c,l&&s.geometryVertexAttrsUpdated(a)}return o/n.length}function eF(e,t,r,i){const s=e.stageObject,n=t.centerPointInElevationSR;let o=0;s.metadata.usesVerticalDistanceToGround?(t1(n,r,t,i,mu),rFe(s,mu.verticalDistanceToGround),o=mu.sampledElevation):(t1(n,r,t,i,mu),t.mode!=="absolute-height"&&(o=mu.sampledElevation));const a=jn(sbt,s.transformation),l=ue(nFe,a[12],a[13],a[14]);hi.TESTS_DISABLE_OPTIMIZATIONS?(fu[0]=n.x,fu[1]=n.y,fu[2]=mu.z,Qh(n.spatialReference,fu,a,i.spatialReference)&&(s.transformation=a)):i.setAltitudeOfTransformation(mu.z,a);const c=mce/i.unitInMeters;return(Math.abs(a[12]-l[0])>=c||Math.abs(a[13]-l[1])>=c||Math.abs(a[14]-l[2])>=c)&&(s.transformation=a),o}const sbt=$e();function nbt(e,t,r,i){const s=e.graphics3DSymbolLayer.lodRenderer;if(C(s))return 0;const n=t.centerPointInElevationSR;t1(n,r,t,i,mu);const o=t.mode!=="absolute-height"?mu.sampledElevation:0,a=s.instanceData,l=e.instanceIndex,c=abt;a.getGlobalTransform(l,c);const d=ue(nFe,c[12],c[13],c[14]);hi.TESTS_DISABLE_OPTIMIZATIONS?(fu[0]=n.x,fu[1]=n.y,fu[2]=mu.z,Qh(n.spatialReference,fu,c,i.spatialReference)&&a.setGlobalTransform(l,c)):i.setAltitudeOfTransformation(mu.z,c);const p=mce/i.unitInMeters;return(hi.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-d[0])>=p||Math.abs(c[13]-d[1])>=p||Math.abs(c[14]-d[2])>=p)&&a.setGlobalTransform(l,c),o}function obt(e,t,r,i){const s=e.stageObject,n=s.geometryRecords;if(n.length===0)return 0;let o=0,a=null,l=0,c=!1;for(const d of n){const p=d.geometry.vertexAttributes.get(M.POSITION);if(p!==a){const{update:f,averageGeometrySampledElevation:m}=oFe(d,t,r,i);l=m,a=p,c=f}c&&s.geometryVertexAttrsUpdated(d),o+=l}return o/n.length}const mce=.01,fu=$(),fp=$(),qC=$(),abt=$e(),nFe=$(),mu=new y4;function oFe(e,t,r,i){let s=!1;const n=r.spatialReference,o=e.geometry,a=e.getShaderTransformation(),l=t.requiresSampledElevationInfo;fp[0]=a[12],fp[1]=a[13],fp[2]=a[14],o.invalidateBoundingInfo();const c=o.getMutableAttribute(M.POSITION),d=c.data,p=o.vertexAttributes.get(M.MAPPOS).data,f=c.size,m=d.length/f,g=new RLe(p,n);let _=0,x=0;for(let b=0;b<m;b++){if(qC[0]=d[_],qC[1]=d[_+1],qC[2]=d[_+2],t1(g,r,t,i,mu),l&&(x+=mu.sampledElevation),hi.TESTS_DISABLE_OPTIMIZATIONS)d[_]=g.array[g.offset],d[_+1]=g.array[g.offset+1],d[_+2]=mu.z,Yi(d,n,_,d,i.spatialReference,_,1),d[_]-=fp[0],d[_+1]-=fp[1],d[_+2]-=fp[2],s=!0;else{fu[0]=d[_]+fp[0],fu[1]=d[_+1]+fp[1],fu[2]=d[_+2]+fp[2],i.setAltitude(fu,mu.z),d[_]=fu[0]-fp[0],d[_+1]=fu[1]-fp[1],d[_+2]=fu[2]-fp[2];const w=mce/i.unitInMeters;(Math.abs(qC[0]-d[_])>=w||Math.abs(qC[1]-d[_+1])>=w||Math.abs(qC[2]-d[_+2])>=w)&&(s=!0)}_+=f,g.offset+=3}return x/=m,{update:s,averageGeometrySampledElevation:x}}const lbt=te.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function cbt(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function N8t(e){const t=e&&e.expression;if(typeof t=="string"){const r=cFe(t);if(r!=null)return{cachedResult:r}}return null}async function F8t(e,t,r,i){const s=e&&e.expression;if(typeof s!="string")return null;const n=cFe(s);if(n!=null)return{cachedResult:n};const o=await b0();Ir(r);const a=o.arcadeUtils,l=a.createSyntaxTree(s);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:t}),modules:o}}}function aFe(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function gce(e,t){if(e!=null&&!lFe(e)){if(!t||!e.arcade)return void lbt.errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=JNe(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function ubt(e){if(e!=null){if(lFe(e))return e.cachedResult;const t=e.arcade;let r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof r!="number"&&(e.cachedResult=0,r=0),r}return 0}function k8t(e,t=!1){let r=e&&e.featureExpressionInfo;const i=r&&r.expression;return t||i==="0"||(r=null),r}const dbt={cachedResult:0};function lFe(e){return e.cachedResult!=null}function cFe(e){return e==="0"?0:null}class op{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=GKe(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:t+i}calculateOffsetRenderUnits(t){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=ubt(i)*this._metersPerElevationInfoUnit),r/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=jKe(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=yt(t.offset,0)}updateFeatureExpressionInfoContext(t,r,i){if(C(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&v(r)&&v(i)?(this._featureExpressionInfoContext=cbt(t),gce(this._featureExpressionInfoContext,aFe(s.modules,r,i))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const r=new op;return v(t)&&r.setFromElevationInfo(t),r}}class V0{constructor(t,r,i,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=r}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(t,r){this._stageLayer=r,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=this._stage.renderView.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),v(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,r){if(C(this._edgeState))return;const i=__e(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==i&&(n.objectTransparency=i,s=!0);s&&this._resetEdgeObject(r),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,r){C(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!r),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),v(this._edgeState))){const r=this._stage.renderView.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(t,r,i,s){this.elevationAligner!=null&&(v(i)&&gce(this.elevationContext.featureExpressionInfoContext,i),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,r),this._resetEdgeObject(s))}getCenterObjectSpace(t=$()){return le(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=ao()){const r=this.stageObject.boundingVolumeObjectSpace;return AOe(t,r.min),OOe(t,r.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.transformation;t.render.origin[0]+=r[12],t.render.origin[1]+=r[13],t.render.origin[2]+=r[14],t.render.num++}else for(const r of this.stageObject.geometryRecords)r.computeAttachmentOrigin(i_)&&(je(i_,i_,this.stageObject.transformation),ye(t.render.origin,t.render.origin,i_),t.render.num++)}async getProjectedBoundingBox(t,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=hbt,l=voe(o)?1:a.length;for(let d=0;d<l;d++){const p=a[d];Y1[0]=o[p[0]],Y1[1]=o[p[1]],Y1[2]=o[p[2]],je(Y1,Y1,this.stageObject.transformation),TT[3*d+0]=Y1[0],TT[3*d+1]=Y1[1],TT[3*d+2]=Y1[2]}if(!t(TT,0,l))return null;es(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let d=0;d<3*l;d+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],TT[d+p]),o[p+3]=Math.max(o[p+3],TT[d+p]);c&&i.push({location:TT.slice(d,d+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){Gm(o,i_);const d=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(r.useViewElevation)p=yt(r.service.getElevation(i_[0],i_[1],d),0);else try{const f=fce(o,r.service.spatialReference,r);p=yt(await r.service.queryElevation(i_[0],i_[1],s,f,d),0)}catch{}COe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(t,r){t===Kv.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),t===Kv.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(C(this._edgeState))return;const r=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,t):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,r){const i=this._edgeState;if(C(i))return;const s=__e(i.baseMaterial);for(const n of i.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function __e(e){return e.isVisible?e.parameters.transparent?dr.TRANSPARENT:dr.OPAQUE:dr.INVISIBLE}const TT=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Y1=$(),i_=$(),hbt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var To;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(To||(To={}));class yce{constructor(t){this.schedule=t,this._abortController=null,this._loadStatus=Eh.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,r){return this._loadStatus===Eh.LOADED?(t&&t(),yt(this._loader,Promise.resolve())):this._loadStatus===Eh.FAILED?(r&&r(this._loadError),yt(this._loader,Promise.resolve())):(C(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Eh.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=Eh.FAILED,!Ps(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(t,r).catch(()=>{}),this._loader)}abortLoad(){v(this._abortController)?this._abortController=lg(this._abortController):this._loadStatus===Eh.LOADING&&(this._loadStatus=Eh.FAILED),this._loader=null}}var Eh;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(Eh||(Eh={}));function pbt(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function uFe(e,t){const r=(i,s,n=!1)=>({levels:i.map(o=>{const a=s(o.tesselation);return n&&_ft(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>NDe(.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>pft(1));case"cone":return r(dX,i=>jye(1,.5,i,!1),!0);case"inverted-cone":return r(dX,i=>jye(1,.5,i,!0),!0);case"cylinder":return r(dX,i=>yft(1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>mft(1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>fft(1),!0);default:return}}const dX=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function Gk(e){const t=[];return e.levels.forEach(r=>{r.components.forEach(i=>{t.push(i.material)})}),OF(t)}function v_e(e){const t=new Array;return e.levels.forEach(r=>{r.components.forEach(i=>{i.textures&&t.push(...i.textures)})}),OF(t)}function _ce(e){const t=[];return e.components.forEach(r=>{t.push(r.geometry)}),OF(t)}function b_e(e){const t=[];return e.levels.forEach(r=>{r.components.forEach(i=>{t.push(i.geometry)})}),OF(t)}function fbt(e){return _ce(e).reduce((t,r)=>t+r.indexCount/3,0)}const vce={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function U8t(e){return e.type==="web-style"?vce:bce(e.symbolLayers.toArray().map(t=>dFe(e,t)))}function bce(e){let t=0,r=0,i=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)C(a)||(t+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:s,memory:o,numComplexities:n}}function B8t(e){const t=bce(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const w_e={};function dFe(e,t){const r=hFe(e,t),i=ent(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:v(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...mbt(t.resource&&t.resource.primitive||UOe),memory:r};case"path":{let a=0,l=0;switch(t.profile){case"circle":a=10;break;case"quad":a=4;break;default:return void(t.profile,void 0)}switch(t.join){case"round":l=3;break;case"miter":case"bevel":l=1;break;default:return void(t.join,void 0)}const c=2*a,d=a*l*2;let p=-2*d-c;switch(t.cap){case"none":break;case"butt":case"square":p+=2*(a-1);break;case"round":p+=2*(a*(3-1)*2+a);break;default:return}return{primitivesPerFeature:p,primitivesPerCoordinate:d+c,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function hFe(e,t){const r=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Gc.EXTRUDE_EDGES:Gc.EXTRUDE;case"fill":return v(t.outline)&&t.outline.size>0?Gc.FILL_OUTLINE:Gc.FILL;case"water":return Gc.FILL;case"line":return t.join==="round"?Gc.LINE_ROUND:Gc.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Gc.PATH_ROUND_CIRCLE;case"quad":return Gc.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return Gc.PATH_MITER_CIRCLE;case"quad":return Gc.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return void(t.join,void 0)}case"object":return r?Gc.OBJECT_POINT:Gc.OBJECT_POLYGON;case"icon":case"text":return r?Gc.ICON_POINT:Gc.ICON_POLYGON;default:return}}function mbt(e){let t=w_e[e];if(t)return t;const r=uFe(e,null);return t={primitivesPerFeature:_ce(r.levels[0]).reduce((i,s)=>i+s.indices.get(M.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},w_e[e]=t,t}const Gc={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,resourceBytes:0,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,resourceBytes:0,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,resourceBytes:0,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,resourceBytes:0,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,resourceBytes:0,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,resourceBytes:0,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,resourceBytes:0,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,resourceBytes:0,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,resourceBytes:0,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,resourceBytes:0,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,resourceBytes:0,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,resourceBytes:0,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},WC=te.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class j0 extends yce{constructor(t,r,i,s){super(i.schedule),this._context=i,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=WC,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=t,this.symbolLayer=r,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new op,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=x_e(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const r=this._drivenProperties,i=x_e(t);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,r,i,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!this._logGeometryValidationWarnings(r,i,s)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&WC.warnOncePerTick(l)}_logGeometryValidationWarnings(t,r,i){const s=`${i} geometry failed to be created`;return!t.length||t.length===1&&!t[0].length?(WC.warnOncePerTick(`${s} (no ${r} were defined)`),!0):(!Array.isArray(t)||!Array.isArray(t[0]))&&(WC.warnOncePerTick(`${s} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(t,r=null,i=null){if(v(r)&&!r.includes(t.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return WC.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return gbt}_defaultElevationInfoZ(){return ybt}_updateElevationContext(){v(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,r=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,r){const i=t.geometry,s=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,r.mode=this.getGeometryElevationMode(i,s),r.offsetMeters=yt(this._elevationContext.meterUnitOffset,yt(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";n&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=n?dbt:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,t,this._context.layer),r}prepareSymbolLayerPatch(t){}updateGeometry(t,r){return!1}onRemoveGraphic(t){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const t=this._context.layer.opacity;return t!=null?t:1}_getCombinedOpacity(t,r=T_e){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(v(t)?i*=t.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(t,r=T_e){const i=this._getCombinedOpacity(t,r);if(this._drivenProperties.color)return oL(null,i);const s=v(t)?Ze.toUnitRGB(t):Xy;return oL(s,i)}_getVertexOpacityAndColor(t,r=null){const i=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=oL(i,s);return v(r)&&(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return dFe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,r,i){switch(t){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,s)!==en.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,r,i){let s=en.UPDATE;return t.forEach(n=>{const o=r(n);if(v(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else s=en.RECREATE}),s}applyRendererDiff(t,r){return To.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const r=this._fastUpdates.visualVariables,i=r.size?Iv(r.size.field,t):0,s=r.color?Iv(r.color.field,t):0,n=r.opacity?Iv(r.opacity.field,t):0;return ar(i,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&WC.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var r,i,s,n,o,a,l,c,d,p,f,m,g,_,x,b;return{size:(n=(s=(i=(r=this._fastUpdates)==null?void 0:r.visualVariables)==null?void 0:i.size)==null?void 0:s.field)!=null?n:null,color:(c=(l=(a=(o=this._fastUpdates)==null?void 0:o.visualVariables)==null?void 0:a.color)==null?void 0:l.field)!=null?c:null,opacity:(m=(f=(p=(d=this._fastUpdates)==null?void 0:d.visualVariables)==null?void 0:p.opacity)==null?void 0:f.field)!=null?m:null,rotation:(b=(x=(_=(g=this._fastUpdates)==null?void 0:g.visualVariables)==null?void 0:_.rotation)==null?void 0:x.field)!=null?b:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function Iv(e,t){const r=e!=null?t.attributes[e]:0;return r!=null&&isFinite(r)?r:0}function x_e(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(r=>{switch(r.type){case"color":if(t.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const s=r.stops[i].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const gbt={mode:"on-the-ground",offset:0,unit:"meters"},ybt={mode:"absolute-height",offset:0,unit:"meters"},T_e={hasIntrinsicColor:!1};class kE{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,r,i,s,n,o){this.id=Su(),this.geometry=t,this.material=r,this.transformation=i,this.instanceParameters=s,this.origin=n,this._shaderTransformation=o,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return v(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(je(t,t,this.getStaticTransformation()),!0)}}kE.pool=new ro(kE);class zV{constructor(t){this.channel=t,this.id=Su()}}class w1 extends c4{constructor(t={}){super(),this.type=yg.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=$e(),this._bvObjectSpace=new S_e,this._bvWorldSpace=new S_e,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new pFe);const{geometries:r,materials:i,transformations:s,origins:n}=t;if(Array.isArray(r)){Et(i.length===r.length,"Object3D: materials don't match geometries"),Et(s.length===r.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=r.length,this._geometries.length=r.length;for(let o=0;o<r.length;o++)this._geometries[o]=r[o],this._geometryRecords[o]=kE.pool.acquire(r[o],i[o],U2(s[o]),{highlights:null,occludees:null,visible:this._visible},n&&n[o])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){jn(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){Et(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,r,i,s,n){i=i||Hn,this._geometries.push(t);const o=kE.pool.acquire(t,r,i,{highlights:null,occludees:null,visible:this._visible},s,n);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||v(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(t){const r=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=v(r.shaderTransformation)?this._geometryRecords.some(i=>v(i.shaderTransformation)):this._hasVolatileTransformation,r.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:r}),this._invalidateBoundingVolume(),r}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const r of this._geometryRecords)r.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new zV(Kv.MaskOccludee);for(const r of this._geometryRecords)r.instanceParameters.occludees=tre(r.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const r of this._geometryRecords)r.instanceParameters.occludees=rre(r.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new zV(Kv.Highlight);for(const r of this._geometryRecords)r.instanceParameters.highlights=tre(r.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const r of this._geometryRecords)r.instanceParameters.highlights=rre(r.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,r){return Hs(r,this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t){return Hs($e(),this.transformation,t.getShaderTransformation())}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s],o=this._geometryRecords[s],a=n.boundingInfo;v(a)&&(this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,o.getShaderTransformation()),this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this._getCombinedShaderTransformation(o)))}$n(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),$n(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=$(),r=$(),i=xE(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if(C(n))continue;const o=this._geometryRecords[s].getShaderTransformation(),a=xE(o);je(t,n.getCenter(),o);const l=Ni(t,this._bvObjectSpace.bounds),c=n.getBSRadius()*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),je(r,t,this.transformation);const d=Ni(r,this._bvWorldSpace.bounds),p=c*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],d+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,r,i){const s=t.getBBMin(),n=t.getBBMax(),o=ws(s),a=ws(n);je(o,o,i),je(a,a,i);for(let l=0;l<3;++l)r.min[l]=Math.min(r.min[l],o[l],a[l]),r.max[l]=Math.max(r.max[l],o[l],a[l]);for(let l=0;l<3;++l){le(o,s),le(a,n),o[l]=n[l],a[l]=s[l],je(o,o,i),je(a,a,i);for(let c=0;c<3;++c)r.min[c]=Math.min(r.min[c],o[c],a[c]),r.max[c]=Math.max(r.max[c],o[c],a[c])}}_invalidateBoundingVolume(){this._bvDirty=!0,v(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,r){v(this._parentLayer)&&this._parentLayer.events.emit(t,r)}get test(){const t=this;return{hasGeometry:r=>t._geometries.includes(r),getGeometryIndex:r=>t._geometries.indexOf(r)}}}class pFe{constructor(){this.min=Fe(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Fe(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class S_e extends pFe{constructor(){super(...arguments),this.bounds=qo()}init(){ue(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),ue(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),PPe(this.bounds)}}const qw=$();function wce(e,t,r,i,s,n,o,a){const l=r?r.length:0,c=e.clippingExtent;if(fa(t,qw,e.elevationProvider.spatialReference),v(c)&&!yoe(c,qw))return null;fa(t,qw,e.renderCoordsHelper.spatialReference);const d=e.localOriginFactory.getOrigin(qw),p=new w1({castShadow:!1,metadata:{layerUid:n,graphicUid:o,usesVerticalDistanceToGround:!0}});for(let f=0;f<l;f++){const m=Hn;p.addGeometry(r[f],i[f],m,d,a)}return{object:p,sampledElevation:Z1t(p,t,e.elevationProvider,e.renderCoordsHelper,s)}}function tF(e,t,r){const i=e.elevationContext,s=r.spatialReference;fa(t,qw,s),i.centerPointInElevationSR=b1(qw[0],qw[1],t.hasZ?qw[2]:0,v(s)?s:null)}function rF(e){switch(e.type){case"point":return e;case"polygon":case"extent":return pce(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const r=GCe(t,jCe(t)/2);return b1(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}function xce(){return new Float32Array(2)}function _bt(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function Jp(e,t){const r=new Float32Array(2);return r[0]=e,r[1]=t,r}function vbt(e,t){return new Float32Array(e,t,2)}function fFe(){return xce()}function mFe(){return Jp(1,1)}function gFe(){return Jp(1,0)}function yFe(){return Jp(0,1)}const _Fe=fFe(),vFe=mFe(),bbt=gFe(),wbt=yFe();Object.freeze(Object.defineProperty({__proto__:null,create:xce,clone:_bt,fromValues:Jp,createView:vbt,zeros:fFe,ones:mFe,unitX:gFe,unitY:yFe,ZEROS:_Fe,ONES:vFe,UNIT_X:bbt,UNIT_Y:wbt},Symbol.toStringTag,{value:"Module"}));function xbt(e){const t=new Qr;t.include(Ale),t.include(dNe,e),t.include(Rn,e),t.attributes.add(M.UV0,"vec2");const{vertex:r,fragment:i}=t;return r.uniforms.add([new Tr("viewport",(s,n)=>n.camera.fullViewport),new De("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new ai("pixelToNDC",(s,n)=>mr(C_e,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new De("borderSize",(s,n)=>v(s.borderColor)?n.camera.pixelRatio:0),new ai("screenOffset",(s,n)=>mr(C_e,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&I7(r),r.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?S`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?S`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:S`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?S`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:S`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?S`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:S`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add([new Tr("uColor",s=>E_e(s.color)),new Tr("borderColor",s=>E_e(s.borderColor))]),e.hasMultipassGeometry&&(i.include(vDe,e),i.uniforms.add(new ai("inverseViewport",(s,n)=>n.inverseViewport))),i.code.add(S`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?S`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:S`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function E_e(e){return v(e)?e:u0}const C_e=rt(),Tbt=Object.freeze(Object.defineProperty({__proto__:null,build:xbt},Symbol.toStringTag,{value:"Module"}));class j7 extends li{initializeConfiguration(t,r){r.spherical=t.viewingMode===Ye.Global}initializeProgram(t){return new ti(t.rctx,j7.shader.get().build(this.configuration),Yr)}setPipelineState(t){const r=t?rs.ALWAYS:rs.LESS;return this.configuration.depthHudEnabled?Ht({depthTest:{func:r},depthWrite:$u}):Ht({blending:ma(Ae.ONE,Ae.SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:cr})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}j7.shader=new ei(Tbt,()=>re(()=>import("./LineCallout.glsl.7388d269.js"),[]));class Pp extends aa{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=gu.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}u([j({count:gu.COUNT})],Pp.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([j()],Pp.prototype,"spherical",void 0),u([j()],Pp.prototype,"occlusionTestEnabled",void 0),u([j()],Pp.prototype,"hasVerticalOffset",void 0),u([j()],Pp.prototype,"hasScreenSizePerspective",void 0),u([j()],Pp.prototype,"depthHudEnabled",void 0),u([j()],Pp.prototype,"depthHudAlignStartEnabled",void 0),u([j()],Pp.prototype,"hasSlicePlane",void 0),u([j()],Pp.prototype,"hasMultipassGeometry",void 0),u([j({constValue:!0})],Pp.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],Pp.prototype,"isDraped",void 0);class A2 extends z0{constructor(t){super(t,new Ebt),this._configuration=new Pp,this._uniqueMaterialIdentifier=A2.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(t,r){const i=(r==null?void 0:r.slot)!==Ee.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?gu.Screen:gu.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(t,r){if(r===V.Color)switch(t){case Ee.LINE_CALLOUTS:case Ee.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return new Sbt(t)}createBufferWriter(){return new Abt}validateParameters(t){const r=A2.uniqueMaterialIdentifier(t);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class Sbt extends tT{beginSlot(t){return this.ensureTechnique(j7,t)}}class Ebt extends GI{constructor(){super(...arguments),this.screenOffset=Ud,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const Cbt=Ds().vec3f(M.POSITION).vec3f(M.NORMAL).vec2f(M.UV0).vec4f(M.AUXPOS1),A_e=[Jp(0,0),Jp(1,0),Jp(0,1),Jp(1,0),Jp(1,1),Jp(0,1)];class Abt{constructor(){this.vertexBufferLayout=Cbt}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(M.POSITION).length}write(t,r,i,s,n){$7(i.indices.get(M.POSITION),i.vertexAttributes.get(M.POSITION).data,t,s.position,n,6),nce(i.indices.get(M.NORMAL),i.vertexAttributes.get(M.NORMAL).data,r,s.normal,n,6),oI(i.indices.get(M.AUXPOS1),i.vertexAttributes.get(M.AUXPOS1).data,s.auxpos1,n,6);for(let o=0;o<A_e.length;++o)s.uv0.setVec(n+o,A_e[o])}}class G7 extends j0{constructor(t,r){super(t,null,r,Rbt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new A2(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const r=this._materialParameters;return r.screenOffset=t.screenOffset||Ud,r.centerOffsetUnits=t.centerOffsetUnits||"world",r}get _materialParameters(){const t=this.symbol,r=t.callout,i=v(r.color)?Ze.toUnitRGBA(r.color):[0,0,0,0];i[3]*=this._getLayerOpacity();const s=Ga(r.size||0);let n=null;if(t.verticalOffset){const{screenLength:p,minWorldLength:f,maxWorldLength:m}=t.verticalOffset;n={screenLength:Ga(p),minWorldLength:f||0,maxWorldLength:v(m)?m:1/0}}const o=v(r.border)&&v(r.border.color)?Ze.toUnitRGBA(r.border.color):null,a=t.symbolLayers.getItemAt(0).type==="object",l=!a,c=a?0:void 0,d=t.type==="label-3d";return{color:i,size:s,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:o,occlusionTest:l,shaderPolygonOffset:c,depthHUDAlignStart:d,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:Rs.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return Mbt}createGraphics3DGraphic(t){const r=t.renderingInfo,i=t.graphic,s=this.setGraphicElevationContext(i,new op,r.elevationOffset||0),n=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!HOe(l)))return null;const a=pce(i.geometry);return C(a)?null:this._createAs3DShape(a,s,r,i.uid)}layerOpacityChanged(){v(this._material)&&this._material.setParameters(this._materialParameters)}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=g4(G7.elevationModeChangeTypes,i,s);return n!==en.UPDATE||t.forEach(o=>{const a=r(o);v(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return C(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(t,r,i=0){const s=super.setGraphicElevationContext(t,r);return s.addOffsetRenderUnits(i),s}updateGraphicElevationContext(t,r){this.setGraphicElevationContext(t,r.elevationContext,r.metadata.elevationOffset),r.needsElevationUpdates=Mf(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:vce.memory}}_createVertexData(t){const{translation:r,centerOffset:i}=t,s=r?{size:3,data:[r[0],r[1],r[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},n=i?{size:4,data:[i[0],i[1],i[2],i[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[M.POSITION,s],[M.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[M.AUXPOS1,n]]}_getOrCreateMaterial(t){const r=this._perInstanceMaterialParameters(t),i=A2.uniqueMaterialIdentifier(r);if(v(this._material)&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection){let s=t.materialCollection.get(i);return C(s)&&(s=new A2(r),t.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new A2(r),isUnique:!0}}_createAs3DShape(t,r,i,s){const n=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),o=[new mn(this._createVertexData(i),Obt,Bl.Point,n)],a=this._getOrCreateMaterial(i),l=wce(this._context,t,o,[a.material],r,this._context.layer.uid,s);if(l===null)return null;const c=new V0(this,l.object,o,a.isUnique?[a.material]:null,null,eF,r);return c.metadata={elevationOffset:i.elevationOffset||0},c.alignedSampledElevation=l.sampledElevation,c.needsElevationUpdates=Mf(r.mode),tF(c,t,this._context.elevationProvider),c}}G7.elevationModeChangeTypes={definedChanged:en.UPDATE,staysOnTheGround:en.UPDATE,onTheGroundChanged:en.RECREATE};const hX=[0],Obt=[[M.POSITION,hX],[M.NORMAL,hX],[M.AUXPOS1,hX]],Mbt={mode:"relative-to-ground",offset:0},Rbt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},O_e=te.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Ibt(e,t){if(!Soe(e))return O_e.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const r=Pbt[e.callout.type];return r?new r(e,t):(O_e.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const Pbt={line:G7};class $bt{constructor(t,r,i){this.graphic=t,this.renderingInfo=r,this.layer=i}}const M_e=new ro(Array,e=>cj(e,MOe),null,10,5),Dbt=tr();class Lbt{constructor(t,r,i,s,n){this.graphic=t,this.graphics3DSymbol=r,this.graphics=i,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=Nbt(Ua._COUNT,Dh._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++r.referenced,this._featureExpressionFeature=n?aFe(n,t,s):null;for(const o of i)v(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(t,r){this._layer=r,this._stage=t,this._forEachSymbolLayerGraphic(i=>{i.initialize(t,r),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.graphics==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelGraphics.length=0}addLabelGraphic(t,r,i){this._labelGraphics.push(t),t.initialize(r,i),t.setVisibility(this.isVisible(Ua.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryGraphics.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(t=!0)}),t}isVisible(t=Ua.GRAPHIC,r){for(let i=0;i<=t;i++){const s=this._visibilityFlags[i];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==r)return!1}return!0}hasVisibilityFlag(t,r){return this._visibilityFlags[r][t]!=null}setVisibilityFlag(t,r,i){const s=this.isVisible(i);this._visibilityFlags[i][t]=r;const n=this.isVisible(i);if(s===n)return!1;if(i===Ua.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Ua.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(t,r=Ua.GRAPHIC){return this.setVisibilityFlag(t,void 0,r)}computeExtent(t){if(!this._extent){const r=this.graphic.geometry;if(C(r))return!1;this._extent=tr(),k1t(r,this._extent);const i=r.spatialReference;if(!ml(i,t)&&!Bj(this._extent,i,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,r){return v(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===r||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,r),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=r),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,r,i){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=kl.fromExtent(s.type==="mesh"?s.extent:s)),xct(s,r,i)}get usedMemory(){let t=yPe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(C(i))return;const s=r.type==="draped"?i.memory.draped:i.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=F1t(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:$(),num:0},draped:{origin:rt(),num:0}};for(const r of this.graphics)C(r)||r.computeAttachmentOrigin(t);return t.render.num&&de(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&wd(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,r,i,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?es(n.boundingBox):n.boundingBox=es(),n.requiresDrapedElevation=!1,await tj(this.graphics,async o=>{if(C(o))return;const a=o.type==="draped"?r:t,l=M_e.acquire(),c=await o.getProjectedBoundingBox(a,i,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&CR(n.boundingBox,l),M_e.release(l)}),CZe(n.boundingBox)||$K(_oe(n.boundingBox,Dbt))?n:null}needsElevationUpdates(){for(const t of this.graphics)if(v(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelGraphics)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,r,i){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,r,this._featureExpressionFeature,i)})}addObjectStateSet(t,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(t,r))}removeObjectState(t){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(t))}_forEachGraphicList(t,r){t.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.graphics,t),this._forEachGraphicList(this._auxiliaryGraphics,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelGraphics,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function Nbt(e,t){const r=new Array(e);for(let i=0;i<r.length;i++)r[i]=new Array(t);return r}var R_e,I_e,P_e,bFe={exports:{}};R_e=bFe,I_e=function(){function e(F,N,B){B=B||2;var H,W,K,Y,ce,we,Oe,Be=N&&N.length,He=Be?N[0]*B:F.length,Se=t(F,0,He,B,!0),he=[];if(!Se||Se.next===Se.prev)return he;if(Be&&(Se=l(F,N,Se,B)),F.length>80*B){H=K=F[0],W=Y=F[1];for(var Me=B;Me<He;Me+=B)(ce=F[Me])<H&&(H=ce),(we=F[Me+1])<W&&(W=we),ce>K&&(K=ce),we>Y&&(Y=we);Oe=(Oe=Math.max(K-H,Y-W))!==0?1/Oe:0}return i(Se,he,B,H,W,Oe),he}function t(F,N,B,H,W){var K,Y;if(W===X(F,N,B,H)>0)for(K=N;K<B;K+=H)Y=J(K,F[K],F[K+1],Y);else for(K=B-H;K>=N;K-=H)Y=J(K,F[K],F[K+1],Y);if(Y&&O(Y,Y.next)){var ce=Y.next;ee(Y),Y=ce}return Y}function r(F,N){if(!F)return F;N||(N=F);var B,H=F;do if(B=!1,H.steiner||!O(H,H.next)&&E(H.prev,H,H.next)!==0)H=H.next;else{var W=H.prev;if(ee(H),(H=N=W)===H.next)break;B=!0}while(B||H!==N);return N}function i(F,N,B,H,W,K,Y){if(F){!Y&&K&&g(F,H,W,K);for(var ce,we,Oe=F;F.prev!==F.next;)if(ce=F.prev,we=F.next,K?n(F,H,W,K):s(F))N.push(ce.i/B),N.push(F.i/B),N.push(we.i/B),ee(F),F=we.next,Oe=we.next;else if((F=we)===Oe){Y?Y===1?i(F=o(r(F),N,B),N,B,H,W,K,2):Y===2&&a(F,N,B,H,W,K):i(r(F),N,B,H,W,K,1);break}}}function s(F){var N=F.prev,B=F,H=F.next;if(E(N,B,H)>=0)return!1;for(var W=F.next.next;W!==F.prev;){if(w(N.x,N.y,B.x,B.y,H.x,H.y,W.x,W.y)&&E(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function n(F,N,B,H){var W=F.prev,K=F,Y=F.next;if(E(W,K,Y)>=0)return!1;for(var ce=W.x<K.x?W.x<Y.x?W.x:Y.x:K.x<Y.x?K.x:Y.x,we=W.y<K.y?W.y<Y.y?W.y:Y.y:K.y<Y.y?K.y:Y.y,Oe=W.x>K.x?W.x>Y.x?W.x:Y.x:K.x>Y.x?K.x:Y.x,Be=W.y>K.y?W.y>Y.y?W.y:Y.y:K.y>Y.y?K.y:Y.y,He=x(ce,we,N,B,H),Se=x(Oe,Be,N,B,H),he=F.prevZ,Me=F.nextZ;he&&he.z>=He&&Me&&Me.z<=Se;){if(he!==F.prev&&he!==F.next&&w(W.x,W.y,K.x,K.y,Y.x,Y.y,he.x,he.y)&&E(he.prev,he,he.next)>=0||(he=he.prevZ,Me!==F.prev&&Me!==F.next&&w(W.x,W.y,K.x,K.y,Y.x,Y.y,Me.x,Me.y)&&E(Me.prev,Me,Me.next)>=0))return!1;Me=Me.nextZ}for(;he&&he.z>=He;){if(he!==F.prev&&he!==F.next&&w(W.x,W.y,K.x,K.y,Y.x,Y.y,he.x,he.y)&&E(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;Me&&Me.z<=Se;){if(Me!==F.prev&&Me!==F.next&&w(W.x,W.y,K.x,K.y,Y.x,Y.y,Me.x,Me.y)&&E(Me.prev,Me,Me.next)>=0)return!1;Me=Me.nextZ}return!0}function o(F,N,B){var H=F;do{var W=H.prev,K=H.next.next;!O(W,K)&&A(W,H,H.next,K)&&L(W,K)&&L(K,W)&&(N.push(W.i/B),N.push(H.i/B),N.push(K.i/B),ee(H),ee(H.next),H=F=K),H=H.next}while(H!==F);return r(H)}function a(F,N,B,H,W,K){var Y=F;do{for(var ce=Y.next.next;ce!==Y.prev;){if(Y.i!==ce.i&&T(Y,ce)){var we=G(Y,ce);return Y=r(Y,Y.next),we=r(we,we.next),i(Y,N,B,H,W,K),void i(we,N,B,H,W,K)}ce=ce.next}Y=Y.next}while(Y!==F)}function l(F,N,B,H){var W,K,Y,ce=[];for(W=0,K=N.length;W<K;W++)(Y=t(F,N[W]*H,W<K-1?N[W+1]*H:F.length,H,!1))===Y.next&&(Y.steiner=!0),ce.push(b(Y));for(ce.sort(c),W=0;W<ce.length;W++)B=r(B=p(ce[W],B),B.next);return B}function c(F,N){return F.x-N.x}function d(F){if(F.next.prev===F)return F;let N=F;for(;;){const B=N.next;if(B.prev===N||B===N||B===F)break;N=B}return N}function p(F,N){var B=f(F,N);if(!B)return N;var H=G(B,F),W=r(B,B.next);let K=d(H);return r(K,K.next),W=d(W),d(N===B?W:N)}function f(F,N){var B,H=N,W=F.x,K=F.y,Y=-1/0;do{if(K<=H.y&&K>=H.next.y&&H.next.y!==H.y){var ce=H.x+(K-H.y)*(H.next.x-H.x)/(H.next.y-H.y);if(ce<=W&&ce>Y){if(Y=ce,ce===W){if(K===H.y)return H;if(K===H.next.y)return H.next}B=H.x<H.next.x?H:H.next}}H=H.next}while(H!==N);if(!B)return null;if(W===Y)return B;var we,Oe=B,Be=B.x,He=B.y,Se=1/0;H=B;do W>=H.x&&H.x>=Be&&W!==H.x&&w(K<He?W:Y,K,Be,He,K<He?Y:W,K,H.x,H.y)&&(we=Math.abs(K-H.y)/(W-H.x),L(H,F)&&(we<Se||we===Se&&(H.x>B.x||H.x===B.x&&m(B,H)))&&(B=H,Se=we)),H=H.next;while(H!==Oe);return B}function m(F,N){return E(F.prev,F,N.prev)<0&&E(N.next,F,F.next)<0}function g(F,N,B,H){var W=F;do W.z===null&&(W.z=x(W.x,W.y,N,B,H)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==F);W.prevZ.nextZ=null,W.prevZ=null,_(W)}function _(F){var N,B,H,W,K,Y,ce,we,Oe=1;do{for(B=F,F=null,K=null,Y=0;B;){for(Y++,H=B,ce=0,N=0;N<Oe&&(ce++,H=H.nextZ);N++);for(we=Oe;ce>0||we>0&&H;)ce!==0&&(we===0||!H||B.z<=H.z)?(W=B,B=B.nextZ,ce--):(W=H,H=H.nextZ,we--),K?K.nextZ=W:F=W,W.prevZ=K,K=W;B=H}K.nextZ=null,Oe*=2}while(Y>1);return F}function x(F,N,B,H,W){return(F=1431655765&((F=858993459&((F=252645135&((F=16711935&((F=32767*(F-B)*W)|F<<8))|F<<4))|F<<2))|F<<1))|(N=1431655765&((N=858993459&((N=252645135&((N=16711935&((N=32767*(N-H)*W)|N<<8))|N<<4))|N<<2))|N<<1))<<1}function b(F){var N=F,B=F;do(N.x<B.x||N.x===B.x&&N.y<B.y)&&(B=N),N=N.next;while(N!==F);return B}function w(F,N,B,H,W,K,Y,ce){return(W-Y)*(N-ce)-(F-Y)*(K-ce)>=0&&(F-Y)*(H-ce)-(B-Y)*(N-ce)>=0&&(B-Y)*(K-ce)-(W-Y)*(H-ce)>=0}function T(F,N){return F.next.i!==N.i&&F.prev.i!==N.i&&!k(F,N)&&(L(F,N)&&L(N,F)&&q(F,N)&&(E(F.prev,F,N.prev)||E(F,N.prev,N))||O(F,N)&&E(F.prev,F,F.next)>0&&E(N.prev,N,N.next)>0)}function E(F,N,B){return(N.y-F.y)*(B.x-N.x)-(N.x-F.x)*(B.y-N.y)}function O(F,N){return F.x===N.x&&F.y===N.y}function A(F,N,B,H){var W=D(E(F,N,B)),K=D(E(F,N,H)),Y=D(E(B,H,F)),ce=D(E(B,H,N));return W!==K&&Y!==ce||!(W!==0||!R(F,B,N))||!(K!==0||!R(F,H,N))||!(Y!==0||!R(B,F,H))||!(ce!==0||!R(B,N,H))}function R(F,N,B){return N.x<=Math.max(F.x,B.x)&&N.x>=Math.min(F.x,B.x)&&N.y<=Math.max(F.y,B.y)&&N.y>=Math.min(F.y,B.y)}function D(F){return F>0?1:F<0?-1:0}function k(F,N){var B=F;do{if(B.i!==F.i&&B.next.i!==F.i&&B.i!==N.i&&B.next.i!==N.i&&A(B,B.next,F,N))return!0;B=B.next}while(B!==F);return!1}function L(F,N){return E(F.prev,F,F.next)<0?E(F,N,F.next)>=0&&E(F,F.prev,N)>=0:E(F,N,F.prev)<0||E(F,F.next,N)<0}function q(F,N){var B=F,H=!1,W=(F.x+N.x)/2,K=(F.y+N.y)/2;do B.y>K!=B.next.y>K&&B.next.y!==B.y&&W<(B.next.x-B.x)*(K-B.y)/(B.next.y-B.y)+B.x&&(H=!H),B=B.next;while(B!==F);return H}function G(F,N){var B=new se(F.i,F.x,F.y),H=new se(N.i,N.x,N.y),W=F.next,K=N.prev;return F.next=N,N.prev=F,B.next=W,W.prev=B,H.next=B,B.prev=H,K.next=H,H.prev=K,H}function J(F,N,B,H){var W=new se(F,N,B);return H?(W.next=H.next,W.prev=H,H.next.prev=W,H.next=W):(W.prev=W,W.next=W),W}function ee(F){F.next.prev=F.prev,F.prev.next=F.next,F.prevZ&&(F.prevZ.nextZ=F.nextZ),F.nextZ&&(F.nextZ.prevZ=F.prevZ)}function se(F,N,B){this.i=F,this.x=N,this.y=B,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function X(F,N,B,H){for(var W=0,K=N,Y=B-H;K<B;K+=H)W+=(F[Y]-F[K])*(F[K+1]+F[Y+1]),Y=K;return W}return e.deviation=function(F,N,B,H){var W=N&&N.length,K=W?N[0]*B:F.length,Y=Math.abs(X(F,0,K,B));if(W)for(var ce=0,we=N.length;ce<we;ce++){var Oe=N[ce]*B,Be=ce<we-1?N[ce+1]*B:F.length;Y-=Math.abs(X(F,Oe,Be,B))}var He=0;for(ce=0;ce<H.length;ce+=3){var Se=H[ce]*B,he=H[ce+1]*B,Me=H[ce+2]*B;He+=Math.abs((F[Se]-F[Me])*(F[he+1]-F[Se+1])-(F[Se]-F[he])*(F[Me+1]-F[Se+1]))}return Y===0&&He===0?0:Math.abs((He-Y)/Y)},e.flatten=function(F){for(var N=F[0][0].length,B={vertices:[],holes:[],dimensions:N},H=0,W=0;W<F.length;W++){for(var K=0;K<F[W].length;K++)for(var Y=0;Y<N;Y++)B.vertices.push(F[W][K][Y]);W>0&&(H+=F[W-1].length,B.holes.push(H))}return B},e},(P_e=I_e())!==void 0&&(R_e.exports=P_e);const cI=bFe.exports,H7=te.getLogger("esri.views.3d.support.buffer.math");function _4(e,t,r){if(e.count!==t.count)return void H7.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[4],l=r[5],c=r[6],d=r[8],p=r[9],f=r[10],m=r[12],g=r[13],_=r[14],x=e.typedBuffer,b=e.typedBufferStride,w=t.typedBuffer,T=t.typedBufferStride;for(let E=0;E<i;E++){const O=E*b,A=E*T,R=w[A],D=w[A+1],k=w[A+2];x[O]=s*R+a*D+d*k+m,x[O+1]=n*R+l*D+p*k+g,x[O+2]=o*R+c*D+f*k+_}}function zx(e,t,r){if(e.count!==t.count)return void H7.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],d=r[6],p=r[7],f=r[8],m=e.typedBuffer,g=e.typedBufferStride,_=t.typedBuffer,x=t.typedBufferStride;for(let b=0;b<i;b++){const w=b*g,T=b*x,E=_[T],O=_[T+1],A=_[T+2];m[w]=s*E+a*O+d*A,m[w+1]=n*E+l*O+p*A,m[w+2]=o*E+c*O+f*A}}function wre(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,d=l*a;s[c]=r*o[d],s[c+1]=r*o[d+1],s[c+2]=r*o[d+2]}}function Tce(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,d=n[c],p=n[c+1],f=n[c+2],m=d*d+p*p+f*f;if(m>0){const g=1/Math.sqrt(m);i[l]=g*d,i[l+1]=g*p,i[l+2]=g*f}}}function Fbt(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,d=l*a;s[c]=o[d]>>r,s[c+1]=o[d+1]>>r,s[c+2]=o[d+2]>>r}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:_4,transformMat3:zx,scale:wre,normalize:Tce,shiftRight:Fbt},Symbol.toStringTag,{value:"Module"}));function kbt(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function $_e(e,t,r,i,s,n=!1){return{objectId:e,target:t,distance:r,type:"edge",start:i,end:s,draped:n}}function q7(e,t){if(!e||e.symbol)return null;const r=t&&t.renderer;return e&&v(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function Ubt(e,t){if(v(e.symbol))return e.symbol;const r=q7(e,t);return v(r)&&r.type!=="dot-density"?r.getSymbol(e,t):null}function z8t(e,t){var a;const r=q7(e,t),i=Ubt(e,t);if(C(i))return null;const s={renderer:r,symbol:i};if(C(r)||!("visualVariables"in r)||!r.visualVariables)return s;const n=(a=Ioe(r,e,t))!=null?a:[],o=["proportional","proportional","proportional"];for(const{variable:l,value:c}of n)switch(l.type){case"color":s.color=c.toRgba();break;case"size":if(l.target==="outline")s.outlineSize=c;else{const d=l.axis,p=l.useSymbolValue?"symbol-value":c;switch(d){case"width":o[0]=p;break;case"depth":o[1]=p;break;case"height":o[2]=p;break;case"width-and-depth":o[0]=o[1]=p;break;default:o[0]=o[1]=o[2]=p}}break;case"opacity":s.opacity=c;break;case"rotation":switch(l.axis){case"tilt":s.tilt=c;break;case"roll":s.roll=c;break;default:s.heading=c}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function Bbt(e,t){if(v(e.symbol))return e.symbol;const r=q7(e,t);return v(r)?r.getSymbolAsync(e,t):null}async function V8t(e,t){var a;const r=q7(e,t),i=await Bbt(e,t);if(!i)return null;const s={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return s;const n=(a=Ioe(r,e,t))!=null?a:[],o=["proportional","proportional","proportional"];for(const{variable:l,value:c}of n)if(l.type==="color")s.color=Ze.toUnitRGBA(c);else if(l.type==="size")if(l.target==="outline")s.outlineSize=c;else{const d=l.axis,p=l.useSymbolValue?"symbol-value":c;d==="width"?o[0]=p:d==="depth"?o[1]=p:d==="height"?o[2]=p:o[0]=o[1]=d==="width-and-depth"?p:o[2]=p}else l.type==="opacity"?s.opacity=c:l.type==="rotation"&&l.axis==="tilt"?s.tilt=c:l.type==="rotation"&&l.axis==="roll"?s.roll=c:l.type==="rotation"&&(s.heading=c);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function zbt(e,t=0){const r=e[t];return typeof r=="number"&&isFinite(r)?r:null}function Vbt(e){for(let t=0;t<3;t++){const r=e[t];if(typeof r=="number")return isFinite(r)?r:0}return 0}function D_e(e){const t=[[M.POSITION,e.indices]],r=[[M.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return v(e.attributeData.color)&&(r.push([M.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([M.COLOR,new Array(e.indices.length).fill(0)])),v(e.attributeData.uvMapSpace)&&(r.push([M.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([M.UVMAPSPACE,e.indices])),v(e.attributeData.boundingRect)&&(r.push([M.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([M.BOUNDINGRECT,e.indices])),v(e.attributeData.mapPosition)&&(r.push([M.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([M.MAPPOS,e.indices])),new mn(r,t,Bl.Triangle,e.attributeData.objectAndLayerIdColor)}function L_e(e){const t=[[M.POSITION,e.indices],[M.UV0,e.indices]],r=[[M.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[M.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return v(e.attributeData.mapPosition)&&(r.push([M.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([M.MAPPOS,e.indices])),new mn(r,t)}function iF(e){switch(e.type){case"extent":if(e instanceof Sr)return kl.fromExtent(e);break;case"polygon":return e}return null}class W7{constructor(t,r,i){this.renderData=t,this.layerUid=r,this.graphicsUid=i,this.outGeometries=new Array,this.outMaterials=new Array,this.outTransforms=new Array}}function wFe(e,t,r){var O;const i=e.byteLength/(4*t),s=new Uint32Array(e,0,i*t);let n=new Uint32Array(i);const o=(O=r==null?void 0:r.minReduction)!=null?O:0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let d=0;if(c)for(let A=0;A<c.length-1;A++){const R=c[A+1]-c[A];R>d&&(d=R)}else d=i;const p=Math.floor(1.1*d)+1;(Lg==null||Lg.length<2*p)&&(Lg=new Uint32Array(dR(2*p)));for(let A=0;A<2*p;A++)Lg[A]=0;let f=0;const m=!!c&&!!a,g=m?l:i,_=m?new Uint32Array(l):null,x=1.96;let b=o!==0?Math.ceil(4*x*x/(o*o)*o*(1-o)):g,w=1,T=c?c[1]:g;for(let A=0;A<g;A++){if(A===b){const G=1-f/A;if(G+x*Math.sqrt(G*(1-G)/A)<o)return null;b*=2}if(A===T){for(let G=0;G<2*p;G++)Lg[G]=0;if(a)for(let G=c[w-1];G<c[w];G++)_[G]=n[a[G]];T=c[++w]}const R=m?a[A]:A,D=R*t,k=Hbt(s,D,t);let L=k%p,q=f;for(;Lg[2*L+1]!==0;){if(Lg[2*L]===k){const G=Lg[2*L+1]-1;if(jbt(s,D,G*t,t)){q=n[G];break}}L++,L>=p&&(L-=p)}q===f&&(Lg[2*L]=k,Lg[2*L+1]=R+1,f++),n[R]=q}if(o!==0&&1-f/i<o)return null;if(m){for(let A=c[w-1];A<_.length;A++)_[A]=n[a[A]];n=_}const E=new Uint32Array(t*f);f=0;for(let A=0;A<g;A++)n[A]===f&&(Gbt(s,(m?a[A]:A)*t,E,f*t,t),f++);if(a&&!m){const A=new Uint32Array(l);for(let R=0;R<A.length;R++)A[R]=n[a[R]];n=A}return{buffer:E.buffer,indices:n,uniqueCount:f}}function jbt(e,t,r,i){for(let s=0;s<i;s++)if(e[t+s]!==e[r+s])return!1;return!0}function Gbt(e,t,r,i,s){for(let n=0;n<s;n++)r[i+n]=e[t+n]}function Hbt(e,t,r){let i=0;for(let s=0;s<r;s++)i=e[t+s]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Lg=null;function j8t(e){const t=v4(e.rings,e.hasZ,O0.CCW_IS_HOLE),r=new Array;let i=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,d=new Float64Array(t.position.buffer,3*c*t.position.BYTES_PER_ELEMENT,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array(cI(d,p,3));r.push({position:d,faces:f}),i+=d.length,s+=f.length}const n=qbt(r,i,s),o=wFe(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function qbt(e,t,r){if(e.length===1)return e[0];const i=new Float64Array(t),s=new Uint32Array(r);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)i[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:i,faces:s}}function v4(e,t,r){const i=e.length,s=new Array(i),n=new Array(i),o=new Array(i);let a=0,l=0,c=0,d=0;for(let m=0;m<i;++m)d+=e[m].length;const p=new Float64Array(3*d);let f=0;for(let m=i-1;m>=0;m--){const g=e[m],_=r===O0.CCW_IS_HOLE&&Wbt(g);if(_&&i!==1)s[a++]=g;else{let x=g.length;for(let w=0;w<a;++w)x+=s[w].length;const b={index:f,pathLengths:new Array(a+1),count:x,holeIndices:new Array(a)};b.pathLengths[0]=g.length,g.length>0&&(o[c++]={index:f,count:g.length}),f=_?Hk(g,g.length-1,-1,p,f,g.length,t):Hk(g,0,1,p,f,g.length,t);for(let w=0;w<a;++w){const T=s[w];b.holeIndices[w]=f,b.pathLengths[w+1]=T.length,T.length>0&&(o[c++]={index:f,count:T.length}),f=Hk(T,0,1,p,f,T.length,t)}a=0,b.count>0&&(n[l++]=b)}}for(let m=0;m<a;++m){const g=s[m];g.length>0&&(o[c++]={index:f,count:g.length}),f=Hk(g,0,1,p,f,g.length,t)}return n.length=l,o.length=c,{position:p,polygons:n,outlines:o}}function Hk(e,t,r,i,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];i[s++]=l[0],i[s++]=l[1],i[s++]=o?l[2]:0,t+=r}return s/3}function Wbt(e){return!HCe(e,!1,!1)}var O0;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(O0||(O0={}));var aL,xre;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(aL||(aL={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(xre||(xre={}));var Us,Kp,Mt,lL,ln,ua,Ol;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(Us||(Us={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Kp||(Kp={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(Mt||(Mt={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(lL||(lL={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(ln||(ln={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(ua||(ua={})),function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"}(Ol||(Ol={}));class Xbt{constructor(t,r){this.vec3=t,this.id=r}}function cL(e,t,r,i){return new Xbt(Fe(e,t,r),i)}var sl;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded",e[e.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(sl||(sl={}));class N_e{constructor(t,r){this.index=t,this.renderTargets=r,this._extent=tr(),this.resolution=0,this.renderLocalOrigin=cL(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new Zbt,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(r.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const r=t===sl.ColorAndWater?this.renderTargets.getTarget(ln.Color):t===sl.Highlight?this.renderTargets.getTarget(ln.Highlight):t===sl.ObjectAndLayerIdColor?this.renderTargets.getTarget(ln.ObjectAndLayerIdColor):this.renderTargets.getTarget(ln.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(ln.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(ln.Color):null}getNormalTexture(t){const r=t===sl.ColorAndWater?this.renderTargets.getTarget(ln.Water):null;return r?r.getTexture():null}draw(t,r){const i=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==ln.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=t.drawTarget(this,s,r):this.validTargets[s.type]=!1;return i^this.computeRenderTargetValidityBitfield()?WR.CHANGED:WR.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[ln.Color]|+t[ln.ColorNoRasterImage]<<1|+t[ln.Highlight]<<2|+t[ln.Water]<<3|+t[ln.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const r=.001*t.range;if(this._extent[0]-r<=t.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Nz(this._extent,t.range,0,i)}if(this._extent[2]+r>=t.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Nz(this._extent,-t.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,qv(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const r=this.canvasGeometries.extents[t];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===Us.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function Ybt(e,t,r){return Math.min(dR(Math.max(e,t)+256),r)}class Zbt{constructor(){this.extents=[tr(),tr(),tr()],this.numViews=0}}class xFe{constructor(t,r){this._size=xce(),this._fbo=null,this._fbo=new ps(t,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE},{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.LINEAR_MIPMAP_LINEAR,hasMipmap:r,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=tt(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,r){this._size[0]=t,this._size[1]=r,this._fbo.resize(this._size[0],this._size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){const t=this._fbo.colorTexture;t.descriptor.hasMipmap&&t.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,r;return(r=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?r:0}}class XC{constructor(t,r,i,s=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new xFe(t,s)}}class Jbt{constructor(t){this.renderTargets=[new XC(t,V.Color,ln.Color),new XC(t,V.Color,ln.ColorNoRasterImage),new XC(t,V.Highlight,ln.Highlight,!1),new XC(t,V.Normal,ln.Water),new XC(t,V.Color,ln.Occluded)],pe("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new XC(t,V.ObjectAndLayerIdColor,ln.ObjectAndLayerIdColor))}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,r,i){if(t)r.lastUsed=i;else if(i-r.lastUsed>Kbt)r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0;else if(r.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,r)=>t+r.fbo.gpuMemoryUsage,0)}}const Kbt=1e3;class Sce{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,r){var i;return(i=this._outer.get(t))==null?void 0:i.get(r)}set(t,r,i){const s=this._outer.get(t);s?s.set(r,i):this._outer.set(t,new Map([[r,i]]))}delete(t,r){const i=this._outer.get(t);i&&(i.delete(r),i.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((r,i)=>t(r,i))}}class TFe{constructor(t){this._context=t,this._perConstructorInstances=new Sce,this._frameCounter=0,this._keepAliveFrameCount=F_e}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(t=>t.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,r=ewt){const i=r.key;let s=this._perConstructorInstances.get(t,i);if(C(s)){const n=new t(this._context,r,()=>this.release(n));s=new Qbt(n),this._perConstructorInstances.set(t,i,s)}return++s.refCount,s.technique}releaseAndAcquire(t,r,i){if(v(i)){if(r.key===i.key)return i;this.release(i)}return this.acquire(t,r)}release(t){if(C(t)||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(t.constructor,t.key);C(r)||(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==F_e&&this._perConstructorInstances.forEach((t,r)=>{t.forEach((i,s)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((r,i)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>l.technique.reload(this._context)))};t.push(s(r,i))}),await Promise.all(t)}}class Qbt{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const F_e=-1,ewt=new Yl,X7=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){var i;for(const s of(i=this._managedDisposables)!=null?i:[]){const n=this[s];this[s]=null,n&&typeof n.dispose=="function"&&n.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class Y7 extends X7(class{}){}function nl(){return(e,t)=>{var r,i,s;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=(i=(r=e._managedDisposables)==null?void 0:r.slice())!=null?i:[]),(s=e._managedDisposables)==null||s.unshift(t)}}class SFe{constructor(t,r,i,s){this._textureRepository=t,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new Sce}dispose(){this._textureRepository.dispose()}acquire(t,r,i){if(this._ownMaterial(t),!t.requiresSlot(r,i))return null;let s=this._id2glMaterialRef.get(i,t.id);if(C(s)){const n=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});s=new twt(n),this._id2glMaterialRef.set(i,t.id,s)}return s.ref(),s.glMaterial}release(t,r){const i=this._id2glMaterialRef.get(r,t.id);v(i)&&(i.unref(),i.referenced||(tt(i.glMaterial),this._id2glMaterialRef.delete(r,t.id)))}_ownMaterial(t){v(t.repository)&&t.repository!==this&&te.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),t.repository=this}}class twt{constructor(t){this.glMaterial=t,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,Et(this._refCnt>=0)}get referenced(){return this._refCnt>0}}const rwt={orderedRepackingEnabled:!1},iwt={rootOrigin:null},swt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class uI{constructor(t,r){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new on,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),on.clearPool(),Tre[0]=null,ST.prune(),US.prune()}add(t,r=t.length){this._objectCount+=r,this._grow(t,r);const i=on.acquire();for(let s=0;s<r;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(i.init(this._root),this._add(n,i))}on.release(i)}remove(t,r=null){this._objectCount-=t.length;const i=on.acquire();for(const s of t){const n=v(r)?r:UR(this._objectToBoundingSphere(s),cwt);B$(n[3])?(i.init(this._root),this._remove(s,n,i)):this._degenerateObjects.delete(s)}on.release(i),this._shrink()}update(t,r){if(!B$(r[3])&&this._isDegenerate(t))return;const i=lwt(t);this.remove(i,r),this.add(i)}forEachAlongRay(t,r,i){const s=ep(t,r);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(t,r,i,s){const n=ep(t,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&i(l)}),!0})}forEach(t){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(t),i.residents!==null&&i.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,r,i,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=pX(t,r),d=p=>{if(--n,!s(p))return;const f=this._objectToBoundingSphere(p);if(!Gw(i,f))return;const m=cw(t,r,f),g=m-f[3],_=m+f[3];g<o&&(o=g,a=_,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!Gw(i,p.bounds)||(de(mp,c,p.halfSize),ye(mp,mp,p.bounds),cw(t,r,mp)>a))return!1;const f=p.node;return f.terminals.forAll(m=>d(m)),f.residents!==null&&f.residents.forAll(m=>d(m)),!0},t,r),l}forEachInDepthRange(t,r,i,s,n,o,a){let l=-1/0,c=1/0;const d={setRange:_=>{i===uI.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};d.setRange(s);const p=cw(r,i,t),f=pX(r,i),m=pX(r,-i),g=_=>{if(!a(_))return;const x=this._objectToBoundingSphere(_),b=x,w=cw(r,i,b)-p,T=w-x[3],E=w+x[3];T>c||E<l||!Gw(o,x)||n(_,d)};this._forEachNodeDepthOrdered(this._root,_=>{if(!Gw(o,_.bounds)||(de(mp,f,_.halfSize),ye(mp,mp,_.bounds),cw(r,i,mp)-p>c)||(de(mp,m,_.halfSize),ye(mp,mp,_.bounds),cw(r,i,mp)-p<l))return!1;const x=_.node;return x.terminals.forAll(b=>g(b)),x.residents!==null&&x.residents.forAll(b=>g(b)),!0},r,i)}forEachNode(t){this._forEachNode(this._root,r=>t(r.node,r.bounds,r.halfSize))}forEachNeighbor(t,r){const i=Cv(r),s=r,n=l=>{const c=this._objectToBoundingSphere(l),d=Cv(c),p=i+d;return!(jo(c,s)-p*p<=0)||t(l)};let o=!0;const a=l=>{o&&(o=n(l))};this._forEachNode(this._root,l=>{const c=Cv(l.bounds),d=i+c;if(jo(l.bounds,s)-d*d>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(t,r){return qk(r.bounds,2*-r.halfSize,xh),qk(r.bounds,2*r.halfSize,Th),Uye(t.origin,t.direction,xh,Th)}_intersectsNodeWithOffset(t,r,i){return qk(r.bounds,2*-r.halfSize,xh),qk(r.bounds,2*r.halfSize,Th),i.applyToMinMax(xh,Th),Uye(t.origin,t.direction,xh,Th)}_intersectsObject(t,r){const i=this._objectToBoundingSphere(r);return!(i[3]>0)||ote(i,t)}_intersectsObjectWithOffset(t,r,i){const s=this._objectToBoundingSphere(r);return!(s[3]>0)||ote(i.applyToBoundingSphere(s),t)}_forEachNode(t,r){let i=on.acquire().init(t);const s=[i];for(;s.length!==0;){if(i=s.pop(),r(i)&&!i.isLeaf())for(let n=0;n<i.node.children.length;n++)i.node.children[n]&&s.push(on.acquire().init(i).advance(n));on.release(i)}}_forEachNodeDepthOrdered(t,r,i,s=uI.DepthOrder.FRONT_TO_BACK){let n=on.acquire().init(t);const o=[n];for(awt(i,s,B_e);o.length!==0;){if(n=o.pop(),r(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=B_e[a];n.node.children[l]&&o.push(on.acquire().init(n).advance(l))}on.release(n)}}_remove(t,r,i){ST.clear();const s=i.advanceTo(r,(n,o)=>{ST.push(n.node),ST.push(o)})?i.node.terminals:i.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=ST.length-2;n>=0;n-=2){const o=ST.data[n],a=ST.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let r=0;r<t.children.length;r++)if(t.children[r])return!1;return!0}_purge(t,r){return r>=0&&(t.children[r]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new Qt({shrink:!0})),!0)}_add(t,r){r.advanceTo(this._objectToBoundingSphere(t))?r.node.terminals.push(t):(r.node.residents.push(t),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(t){const r=t.node.residents;t.node.residents=null;for(let i=0;i<r.length;i++){const s=on.acquire().init(t);this._add(r.getItemAt(i),s),on.release(s)}}_grow(t,r){if(r!==0&&(k_e(t,r,i=>this._objectToBoundingSphere(i),Ng),B$(Ng[3])&&!this._fitsInsideTree(Ng)))if(this._nodeIsEmpty(this._root.node))UR(Ng,this._root.bounds),this._root.halfSize=1.25*Ng[3];else{const i=this._rootBoundsForRootAsSubNode(Ng);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(Ng,i):this._growRootAsSubNode(i),on.release(i)}}_rebuildTree(t,r){le(mX,r.bounds),mX[3]=r.halfSize,k_e([t,mX],2,s=>s,gX);const i=on.acquire().init(this._root);this._root.initFrom(null,gX,1.25*gX[3]),this._forEachNode(i,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),on.release(i)}_placingRootViolatesMaxDepth(t){const r=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,s=>(i=Math.max(i,s.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const r=t[3],i=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let a=0;a<3;a++){const l=n[a]-o-(i[a]-r),c=i[a]+r-(n[a]+o),d=Math.max(0,Math.ceil(l/(2*o))),p=Math.max(0,Math.ceil(c/(2*o)))+1,f=2**Math.ceil(Math.log(d+p)*Math.LOG2E);s=Math.max(s,f),Wk[a].min=d,Wk[a].max=p}for(let a=0;a<3;a++){let l=Wk[a].min,c=Wk[a].max;const d=(s-(l+c))/2;l+=Math.ceil(d),c+=Math.floor(d);const p=n[a]-o-l*o*2;fX[a]=p+(c+l)*o}return fX[3]=s*o*CFe,on.acquire().initFrom(null,fX,s*o,0)}_growRootAsSubNode(t){const r=this._root.node;le(Ng,this._root.bounds),Ng[3]=this._root.halfSize,this._root.init(t),t.advanceTo(Ng,null,!0),t.node.children=r.children,t.node.residents=r.residents,t.node.terminals=r.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const r=this._root.node.children;let i=0,s=0;for(;s<r.length&&t==null;)i=s++,t=r[i];for(;s<r.length;)if(r[s++])return-1;return i}_isDegenerate(t){return!B$(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const r=this._root.bounds,i=this._root.halfSize;return t[3]<=i&&t[0]>=r[0]-i&&t[0]<=r[0]+i&&t[1]>=r[1]-i&&t[1]<=r[1]+i&&t[2]>=r[2]-i&&t[2]<=r[2]+i}}class on{constructor(){this.bounds=qo(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,r,i,s=this.depth){return this.node=v(t)?t:on.createEmptyNode(),v(r)&&UR(r,this.bounds),this.halfSize=i,this.depth=s,this}advance(t){let r=this.node.children[t];r||(r=on.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;const i=EFe[t];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*CFe,this}advanceTo(t,r,i=!1){for(;;){if(this.isTerminalFor(t))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);r&&r(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const r=this.bounds;return(r[0]<t[0]?1:0)+(r[1]<t[1]?2:0)+(r[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Qt({shrink:!0}),residents:new Qt({shrink:!0})}}static acquire(){return on._pool.acquire()}static release(t){on._pool.release(t)}static clearPool(){on._pool.prune()}}function nwt(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function owt(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function qk(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function k_e(e,t,r,i){if(t===1){const s=r(e[0]);UR(s,i)}else{xh[0]=1/0,xh[1]=1/0,xh[2]=1/0,Th[0]=-1/0,Th[1]=-1/0,Th[2]=-1/0;for(let s=0;s<t;s++){const n=r(e[s]);B$(n[3])&&(nwt(xh,n),owt(Th,n))}$n(i,xh,Th,.5),i[3]=Math.max(Th[0]-xh[0],Th[1]-xh[1],Th[2]-xh[2])/2}}function awt(e,t,r){if(!US.length)for(let i=0;i<8;++i)US.push({index:0,distance:0});for(let i=0;i<8;++i){const s=EFe[i];US.data[i].index=i,US.data[i].distance=cw(e,t,s)}US.sort((i,s)=>i.distance-s.distance);for(let i=0;i<8;++i)r[i]=US.data[i].index}function pX(e,t){let r,i=1/0;for(let s=0;s<8;++s){const n=cw(e,t,U_e[s]);n<i&&(i=n,r=U_e[s])}return r}function cw(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function B$(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}on._pool=new ro(on),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(uI||(uI={}));const EFe=[Fe(-1,-1,-1),Fe(1,-1,-1),Fe(-1,1,-1),Fe(1,1,-1),Fe(-1,-1,1),Fe(1,-1,1),Fe(-1,1,1),Fe(1,1,1)],U_e=[Fe(-1,-1,-1),Fe(-1,-1,1),Fe(-1,1,-1),Fe(-1,1,1),Fe(1,-1,-1),Fe(1,-1,1),Fe(1,1,-1),Fe(1,1,1)],CFe=Math.sqrt(3),Tre=[null];function lwt(e){return Tre[0]=e,Tre}const fX=qo(),mp=$(),xh=$(),Th=$(),ST=new Qt,cwt=qo(),Ng=qo(),mX=qo(),gX=qo(),Wk=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],US=new Qt,B_e=[0,0,0,0,0,0,0,0],Xm=uI;class AFe extends c4{constructor(t,r=""){var i,s,n;super(),this.apiLayerUid=r,this.type=yg.Layer,this.events=new $s,this.isSliceable=!1,this._objects=new Qt,this._stageHandles=new hr,this.apiLayerUid=r,this.isVisible=(i=t==null?void 0:t.isVisible)!=null?i:!0,this.isPickable=(s=t==null?void 0:t.isPickable)!=null?s:!0,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:qR.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const r of swt)this._stageHandles.add(this.events.on(r,i=>t.handleEvent(r,i)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),v(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),v(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const r of t)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),v(this._octree)&&this._octree.add(t)}removeMany(t){const r=new Array;if(this._objects.removeUnorderedMany(t,t.length,r),r.length!==0){for(const i of r)i.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),v(this._octree)&&this._octree.remove(r)}}sync(){v(this._stage)&&this.updatePolicy!==qR.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,r){v(this._octree)&&this._octree.update(t,r)}getSpatialQueryAccelerator(){return C(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Qe(this._octree)}_createOctree(){this._octree=new Xm(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function VV(e){return v(e)&&e.type===yg.Layer}var mf,UE;(function(e){e[e.Draped=0]="Draped",e[e.Screen=1]="Screen",e[e.World=2]="World",e[e.COUNT=3]="COUNT"})(mf||(mf={})),function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(UE||(UE={}));class Oa extends aa{constructor(){super(...arguments),this.output=V.Color,this.transparencyPassType=Ct.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=mf.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=UE.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:V.COUNT})],Oa.prototype,"output",void 0),u([j({count:Ct.COUNT})],Oa.prototype,"transparencyPassType",void 0),u([j()],Oa.prototype,"occluder",void 0),u([j()],Oa.prototype,"hasSlicePlane",void 0),u([j()],Oa.prototype,"writeDepth",void 0),u([j({count:mf.COUNT})],Oa.prototype,"space",void 0),u([j()],Oa.prototype,"hideOnShortSegments",void 0),u([j()],Oa.prototype,"hasCap",void 0),u([j({count:UE.COUNT})],Oa.prototype,"anchor",void 0),u([j()],Oa.prototype,"hasTip",void 0),u([j()],Oa.prototype,"vvSize",void 0),u([j()],Oa.prototype,"vvColor",void 0),u([j()],Oa.prototype,"vvOpacity",void 0),u([j()],Oa.prototype,"hasOccludees",void 0),u([j()],Oa.prototype,"hasMultipassTerrain",void 0),u([j()],Oa.prototype,"cullAboveGround",void 0),u([j({constValue:!0})],Oa.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],Oa.prototype,"hasSliceTranslatedView",void 0);const z_e=8;function OFe(e,t){const r=e.vertex;r.uniforms.add(new De("intrinsicWidth",i=>i.width)),t.vvSize?(e.attributes.add(M.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new er("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new er("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new er("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new er("vvSizeFactor",i=>i.vvSizeFactor)),r.code.add(S`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(M.SIZE,"float"),r.code.add(S`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(M.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add([new $l("vvOpacityValues",i=>i.vvOpacityValues,z_e),new $l("vvOpacityOpacities",i=>i.vvOpacityOpacities,z_e)]),r.code.add(S`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(S`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(M.COLORFEATUREATTRIBUTE,"float"),r.constants.add("vvColorNumber","int",og),r.uniforms.add(new $l("vvColorValues",i=>i.vvColorValues,og)),r.uniforms.add(new N7("vvColorColors",i=>i.vvColorColors,og)),r.code.add(S`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(M.COLOR,"vec4"),r.code.add(S`vec4 getColor(){
return applyOpacity(color);
}`))}function r1(e,t){switch(e.fragment.include(Vd),t.output){case V.Shadow:case V.ShadowHighlight:case V.ShadowExludeHighlight:e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(S`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case V.Depth:e.fragment.code.add(S`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}}class MFe{constructor(t){this._rctx=t,this._cache=new Map}dispose(){this._cache.forEach(t=>tt(t.stippleTexture)),this._cache.clear()}_acquire(t){if(C(t))return null;const r=this._patternId(t),i=this._cache.get(r);if(i)return i.refCount++,i;const{encodedData:s,paddedPixels:n}=dwt(t),o=new uwt(new dt(this._rctx,{width:n,height:1,internalFormat:qe.RGBA,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE},s));return this._cache.set(r,o),o}release(t){if(C(t))return;const r=this._patternId(t),i=this._cache.get(r);i&&(i.refCount--,i.refCount===0&&(v(i.stippleTexture)&&i.stippleTexture.dispose(),this._cache.delete(r)))}swap(t,r){const i=this._acquire(r);return this.release(t),i}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}class uwt extends Zi{constructor(t){super(),this.stippleTexture=t,this.refCount=1}}function dwt(e){const t=Ece(e),r=1/e.pixelRatio,i=RFe(e),s=IFe(e),n=(Math.floor(.5*(s-1))+.5)*r,o=[];let a=1;for(const m of t){for(let g=0;g<m;g++){const _=a*(Math.min(g,m-1-g)+.5)*r/n*.5+.5;o.push(_)}a=-a}const l=Math.round(t[0]/2),c=[...o.slice(l),...o.slice(0,l)],d=i+PFe,p=new Uint8Array(4*d);let f=4;for(const m of c)KN(m,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,paddedPixels:d}}function Ece(e){return e.pattern.map(t=>Math.round(t*e.pixelRatio))}function RFe(e){if(C(e))return 1;const t=Ece(e);return Math.floor(t.reduce((r,i)=>r+i))}function IFe(e){return Ece(e).reduce((t,r)=>Math.max(t,r))}const PFe=2;function hwt(e){return C(e)?u0:e.length===4?e:Oi(pwt,e[0],e[1],e[2],1)}const pwt=Lr();function $Fe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?fwt(e,t):mwt(e)}function fwt(e,t){const r=!(t.draped&&t.stipplePreferContinuous),{vertex:i,fragment:s}=e;s.include(Vd),t.draped||(_g(i,t),i.uniforms.add(new De("worldToScreenPerDistanceRatio",(o,a)=>1/a.camera.perScreenPixelRatio)),i.code.add(S`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),i.code.add(S`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${ywt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(S`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(S`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),i.uniforms.add(new De("pixelRatio",(o,a)=>a.camera.pixelRatio)),i.code.add(S`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?S`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.constants.add("stippleTexturePadding","float",PFe);const n=t.hasWebGL2Context?vi.None:vi.Size;s.uniforms.add(sg("stipplePatternTexture",o=>o.stippleTexture,n)),s.uniforms.add([new De("stipplePatternSDFNormalizer",o=>gwt(o.stipplePattern)),new De("stipplePatternPixelSizeInv",o=>1/Cce(o))]),s.code.add(S`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${ff(t,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `),s.code.add(S`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?S`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:S`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?S`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?S`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:S`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?S`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:S`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new Tr("stippleOffColor",o=>hwt(o.stippleOffColor))),s.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function mwt(e){e.fragment.code.add(S`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function gwt(e){return v(e)?(Math.floor(.5*(IFe(e)-1))+.5)/e.pixelRatio:1}function Cce(e){const t=e.stipplePattern;return v(t)?RFe(e.stipplePattern)/t.pixelRatio:1}const ywt=S.float(.4),sF=64,Ace=sF/2,DFe=Ace/5,_wt=sF/DFe,vwt=.25;function bwt(e,t){return e.fromData(`${t}-marker`,()=>CNe(t,sF,Ace,DFe))}function LFe(e,t){const r=e.vertex;e.constants.add("markerSizePerLineWidth","float",_wt),r.uniforms.add(new De("pixelRatio",(i,s)=>s.camera.pixelRatio)),C(r.uniforms.get("markerScale"))&&r.constants.add("markerScale","float",1),r.code.add(S`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),t.space===mf.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new De("perRenderPixelRatio",(i,s)=>s.camera.perRenderPixelRatio)),r.code.add(S`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}var gf;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(gf||(gf={}));class As extends aa{constructor(){super(...arguments),this.output=V.Color,this.capType=gf.BUTT,this.transparencyPassType=Ct.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}u([j({count:V.COUNT})],As.prototype,"output",void 0),u([j({count:gf.COUNT})],As.prototype,"capType",void 0),u([j({count:Ct.COUNT})],As.prototype,"transparencyPassType",void 0),u([j()],As.prototype,"occluder",void 0),u([j()],As.prototype,"hasSlicePlane",void 0),u([j()],As.prototype,"hasPolygonOffset",void 0),u([j()],As.prototype,"writeDepth",void 0),u([j()],As.prototype,"draped",void 0),u([j()],As.prototype,"stippleEnabled",void 0),u([j()],As.prototype,"stippleOffColorEnabled",void 0),u([j()],As.prototype,"stippleScaleWithLineWidth",void 0),u([j()],As.prototype,"stipplePreferContinuous",void 0),u([j()],As.prototype,"roundJoins",void 0),u([j()],As.prototype,"applyMarkerOffset",void 0),u([j()],As.prototype,"vvSize",void 0),u([j()],As.prototype,"vvColor",void 0),u([j()],As.prototype,"vvOpacity",void 0),u([j()],As.prototype,"falloffEnabled",void 0),u([j()],As.prototype,"innerColorEnabled",void 0),u([j()],As.prototype,"hasOccludees",void 0),u([j()],As.prototype,"hasMultipassTerrain",void 0),u([j()],As.prototype,"cullAboveGround",void 0),u([j()],As.prototype,"wireframe",void 0),u([j({constValue:!0})],As.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!0})],As.prototype,"stippleRequiresStretchMeasure",void 0),u([j({constValue:!0})],As.prototype,"hasVvInstancing",void 0),u([j({constValue:!0})],As.prototype,"hasSliceTranslatedView",void 0),u([j()],As.prototype,"objectAndLayerIdColorInstanced",void 0);const jV=1;function wwt(e){const t=new Qr,{vertex:r,fragment:i}=t,s=e.hasMultipassTerrain&&(e.output===V.Color||e.output===V.Alpha);t.include(c7),t.include(OFe,e),t.include($Fe,e);const n=e.applyMarkerOffset&&!e.draped;n&&(r.uniforms.add(new De("markerScale",m=>m.markerScale)),t.include(LFe,{space:mf.World})),e.output===V.Depth&&t.include(r1,e),t.include(L7,e),Dd(r,e),r.uniforms.add([new xs("inverseProjectionMatrix",(m,g)=>g.camera.inverseProjectionMatrix),new ai("nearFar",(m,g)=>g.camera.nearFar),new De("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new Tr("viewport",(m,g)=>g.camera.fullViewport)]),r.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.SUBDIVISIONFACTOR,"float"),t.attributes.add(M.UV0,"vec2"),t.attributes.add(M.AUXPOS1,"vec3"),t.attributes.add(M.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),Rx(t),s&&t.varyings.add("depth","float");const o=e.capType===gf.ROUND,a=e.stippleEnabled&&e.stippleScaleWithLineWidth||o;a&&t.varyings.add("vLineWidth","float");const l=e.stippleEnabled&&e.stippleScaleWithLineWidth;l&&t.varyings.add("vLineSizeInv","float");const c=e.innerColorEnabled||o;c&&t.varyings.add("vLineDistance","float");const d=e.stippleEnabled&&o,p=e.falloffEnabled||d;p&&t.varyings.add("vLineDistanceNorm","float"),o&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),r.code.add(S`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),f7(t),r.code.add(S`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${s?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new De("pixelRatio",(m,g)=>g.camera.pixelRatio)),r.code.add(S`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${a?S`vLineWidth = lineWidth;`:""}
      ${l?S`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),n&&r.code.add(S`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(S`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(e.stippleEnabled||o)&&r.code.add(S`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${o?S`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(S`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?r.code.add(S`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?S`min(1.0, subdivisionFactor * ${S.float((jV+2)/(jV+1))})`:S`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(S`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=e.capType!==gf.BUTT;return r.code.add(S`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?S`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(S`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${p||c?S`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?S`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${p?S`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),o&&r.code.add(S`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?r.uniforms.add(new De("worldToScreenRatio",(m,g)=>1/g.screenToPCSRatio)):r.code.add(S`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(S`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?r.code.add(S`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(S`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new De("stipplePatternPixelSize",m=>Cce(m))),r.code.add(S`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(S`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),s&&t.include(rp,e),t.include(Rn,e),i.include(k0),i.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${s?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?i.code.add(S`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(o&&i.code.add(S`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${S.float(hl)}) {
        discard;
      }
    `),d?i.code.add(S`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${S.float(hl)}, stippleCoverage);
      `):i.code.add(S`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new Tr("intrinsicColor",m=>m.color)),i.code.add(S`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(i.uniforms.add(new Tr("innerColor",m=>yt(m.innerColor,m.color))),i.uniforms.add(new De("innerWidth",(m,g)=>m.innerWidth*g.camera.pixelRatio)),i.code.add(S`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(S`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(i.uniforms.add(new De("falloff",m=>m.falloff)),i.code.add(S`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(S`
    if (finalColor.a < ${S.float(hl)}) {
      discard;
    }

    ${e.output===V.Alpha?S`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===V.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===V.Color&&e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===V.Highlight?S`gl_FragColor = vec4(1.0);`:""}
    ${e.output===V.Depth?S`outputDepth(linearDepth);`:""}
    ${e.output===V.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const xwt=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:jV,build:wwt},Symbol.toStringTag,{value:"Module"})),Oce={func:rs.LESS},GV={func:rs.ALWAYS},M0={mask:255},NFe={mask:0},Twt=e=>({function:{func:rs.NOTEQUAL,ref:e,mask:e},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.KEEP}}),Swt=e=>({function:{func:rs.ALWAYS,ref:e,mask:e},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.REPLACE}}),iT={function:{func:rs.ALWAYS,ref:Cu.OutlineVisualElementMask,mask:Cu.OutlineVisualElementMask},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.ZERO}},Vx={function:{func:rs.ALWAYS,ref:Cu.OutlineVisualElementMask,mask:Cu.OutlineVisualElementMask},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.REPLACE}},FFe={function:{func:rs.EQUAL,ref:Cu.OutlineVisualElementMask,mask:Cu.OutlineVisualElementMask},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.KEEP}},kFe={function:{func:rs.NOTEQUAL,ref:Cu.OutlineVisualElementMask,mask:Cu.OutlineVisualElementMask},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.KEEP}},UFe=new Map([[M.POSITION,0],[M.SUBDIVISIONFACTOR,1],[M.UV0,2],[M.AUXPOS1,3],[M.AUXPOS2,4],[M.COLOR,5],[M.COLORFEATUREATTRIBUTE,5],[M.SIZE,6],[M.SIZEFEATUREATTRIBUTE,6],[M.OPACITYFEATUREATTRIBUTE,7],[M.OBJECTANDLAYERIDCOLOR,8]]);class Z7 extends li{initializeProgram(t){return new ti(t.rctx,Z7.shader.get().build(this.configuration),UFe)}_makePipelineState(t,r){const i=this.configuration,s=t===Ct.NONE,n=t===Ct.FrontFace;return Ht({blending:i.output===V.Color||i.output===V.Alpha?s?qh:v1(t):null,depthTest:{func:rT(t)},depthWrite:s?i.writeDepth&&$u:F7(t),colorWrite:cr,stencilWrite:i.hasOccludees?M0:null,stencilTest:i.hasOccludees?r?Vx:iT:null,polygonOffset:s||n?i.hasPolygonOffset&&V_e:U7})}initializePipeline(){const t=this.configuration;if(t.occluder){const r=t.hasPolygonOffset&&V_e;this._occluderPipelineTransparent=Ht({blending:qh,polygonOffset:r,depthTest:GV,depthWrite:null,colorWrite:cr,stencilWrite:null,stencilTest:kFe}),this._occluderPipelineOpaque=Ht({blending:qh,polygonOffset:r,depthTest:GV,depthWrite:null,colorWrite:cr,stencilWrite:NFe,stencilTest:FFe}),this._occluderPipelineMaskWrite=Ht({blending:null,polygonOffset:r,depthTest:Oce,depthWrite:null,colorWrite:null,stencilWrite:M0,stencilTest:Vx})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Ut.LINES:Ut.TRIANGLE_STRIP}getPipelineState(t,r){return r?this._occludeePipelineState:this.configuration.occluder?t===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,r)}}Z7.shader=new ei(xwt,()=>re(()=>import("./RibbonLine.glsl.ba18bd82.js"),[]));const V_e={factor:0,units:-4};var od;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(od||(od={}));class oM extends z0{constructor(t){super(t,new Cwt),this._configuration=new As,this._vertexAttributeLocations=UFe,this._layout=this.createLayout()}isClosed(t,r){return BFe(this.parameters,t,r)}getConfiguration(t,r){this._configuration.output=t,this._configuration.draped=r.slot===Ee.DRAPED_MATERIAL;const i=v(this.parameters.stipplePattern)&&t!==V.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&v(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!v(this.parameters.markerParameters)&&Owt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&v(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Rs.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersect(t,r,i,s,n,o,a,l,c){v(c)?this._intersectDrapedLineGeometry(t,s,c,o,a):this._intersectLineGeometry(t,r,i,s,a)}_intersectDrapedLineGeometry(t,r,i,s,n){if(!r.options.selectionMode)return;const o=t.vertexAttributes.get(M.POSITION).data,a=t.vertexAttributes.get(M.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const g=t.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0];l*=_e(this.parameters.vvSizeOffset[0]+g*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a&&(l*=a.data[0]);const c=s[0],d=s[1],p=(l/2+4)*t.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let g=0;g<o.length-5;g+=3){const _=o[g],x=o[g+1],b=c-_,w=d-x,T=o[g+3]-_,E=o[g+4]-x,O=_e((T*b+E*w)/(T*T+E*E),0,1),A=T*O-b,R=E*O-w,D=A*A+R*R;D<f&&(f=D,m=g/3)}f<p*p&&n(i.dist,i.normal,m,!1)}_intersectLineGeometry(t,r,i,s,n){if(!s.options.selectionMode||d4(r))return;if(!PDe(i))return void te.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const o=t.vertexAttributes,a=o.get(M.POSITION).data;let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const b=o.get(M.SIZEFEATUREATTRIBUTE).data[0];l*=_e(this.parameters.vvSizeOffset[0]+b*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(M.SIZE)&&(l*=o.get(M.SIZE).data[0]);const c=s.camera,d=Mwt;Ho(d,s.point);const p=l*c.pixelRatio/2+4*c.pixelRatio;ue(qP[0],d[0]-p,d[1]+p,0),ue(qP[1],d[0]+p,d[1]+p,0),ue(qP[2],d[0]+p,d[1]-p,0),ue(qP[3],d[0]-p,d[1]-p,0);for(let b=0;b<4;b++)if(!c.unprojectFromRenderScreen(qP[b],s_[b]))return;Il(c.eye,s_[0],s_[1],_X),Il(c.eye,s_[1],s_[2],vX),Il(c.eye,s_[2],s_[3],bX),Il(c.eye,s_[3],s_[0],wX);let f=Number.MAX_VALUE,m=0;const g=Sre(this.parameters,o,t.indices)?a.length-2:a.length-5;for(let b=0;b<g;b+=3){Hc[0]=a[b]+i[12],Hc[1]=a[b+1]+i[13],Hc[2]=a[b+2]+i[14];const w=(b+3)%a.length;if(qc[0]=a[w]+i[12],qc[1]=a[w+1]+i[13],qc[2]=a[w+2]+i[14],Hi(_X,Hc)<0&&Hi(_X,qc)<0||Hi(vX,Hc)<0&&Hi(vX,qc)<0||Hi(bX,Hc)<0&&Hi(bX,qc)<0||Hi(wX,Hc)<0&&Hi(wX,qc)<0)continue;if(c.projectToRenderScreen(Hc,CT),c.projectToRenderScreen(qc,AT),CT[2]<0&&AT[2]>0){ge(Fg,Hc,qc);const E=c.frustum,O=-Hi(E[Gi.NEAR],Hc)/Te(Fg,E[Gi.NEAR]);de(Fg,Fg,O),ye(Hc,Hc,Fg),c.projectToRenderScreen(Hc,CT)}else if(CT[2]>0&&AT[2]<0){ge(Fg,qc,Hc);const E=c.frustum,O=-Hi(E[Gi.NEAR],qc)/Te(Fg,E[Gi.NEAR]);de(Fg,Fg,O),ye(qc,qc,Fg),c.projectToRenderScreen(qc,AT)}else if(CT[2]<0&&AT[2]<0)continue;CT[2]=0,AT[2]=0;const T=Rae(B2(CT,AT,H_e),d);T<f&&(f=T,le(j_e,Hc),le(G_e,qc),m=b/3)}const _=s.rayBegin,x=s.rayEnd;if(f<p*p){let b=Number.MAX_VALUE;if(QPe(B2(j_e,G_e,H_e),B2(_,x,Rwt),ET)){ge(ET,ET,_);const w=Ie(ET);de(ET,ET,1/w),b=w/Ni(_,x)}n(b,ET,m,!1)}}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return!1;const s=t.indices,n=i.get(M.POSITION);return Cle(n,s?s.get(M.POSITION):null,s&&Sre(this.parameters,i,s),r)}createLayout(){const t=Ds().vec3f(M.POSITION).f32(M.SUBDIVISIONFACTOR).vec2f(M.UV0).vec3f(M.AUXPOS1).vec3f(M.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(M.SIZEFEATUREATTRIBUTE):t.f32(M.SIZE),this.parameters.vvColorEnabled?t.f32(M.COLORFEATUREATTRIBUTE):t.vec4f(M.COLOR),this.parameters.vvOpacityEnabled&&t.f32(M.OPACITYFEATUREATTRIBUTE),pe("enable-feature:objectAndLayerId-rendering")&&t.vec4u8(M.OBJECTANDLAYERIDCOLOR),t}createBufferWriter(){return new Awt(this._layout,this.parameters)}requiresSlot(t,r){return r===V.Color||r===V.Alpha||r===V.Highlight||r===V.Depth||r===V.ObjectAndLayerIdColor?t===Ee.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Rs.OccludeAndTransparentStencil?t===Ee.OPAQUE_MATERIAL||t===Ee.OCCLUDER_MATERIAL||t===Ee.TRANSPARENT_OCCLUDER_MATERIAL:r===V.Color||r===V.Alpha?t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ee.OPAQUE_MATERIAL:!1}createGLMaterial(t){return new Ewt(t)}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0),v(t.markerParameters)&&(t.markerScale=t.markerParameters.width/t.width)}}class Ewt extends tT{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output!==V.Color&&this._output!==V.Alpha||this._updateOccludeeState(t);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(Z7,t)}}class Cwt extends uce{constructor(){super(...arguments),this.width=0,this.color=rf,this.join="miter",this.cap=gf.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class Awt{constructor(t,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=jV+i}}_isClosed(t){return Sre(this._parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const i=t.indices.get(M.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?i:i-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this._parameters.wireframe&&(n=2+4*(n-2)),n}write(t,r,i,s,n){var ee;const o=Iwt,a=Pwt,l=$wt,c=i.vertexAttributes.get(M.POSITION).data,d=i.indices&&i.indices.get(M.POSITION),p=(ee=i.vertexAttributes.get(M.DISTANCETOSTART))==null?void 0:ee.data;d&&d.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSizeEnabled?m=i.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(M.SIZE)&&(f=i.vertexAttributes.get(M.SIZE).data[0]);let g=[1,1,1,1],_=0;this._parameters.vvColorEnabled?_=i.vertexAttributes.get(M.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(M.COLOR)&&(g=i.vertexAttributes.get(M.COLOR).data);let x=null;pe("enable-feature:objectAndLayerId-rendering")&&(x=i.objectAndLayerIdColor);let b=0;this._parameters.vvOpacityEnabled&&(b=i.vertexAttributes.get(M.OPACITYFEATUREATTRIBUTE).data[0]);const w=c.length/3,T=new Float32Array(s.buffer),E=pe("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,O=this.vertexBufferLayout.stride/4;let A=n*O;const R=A;let D=0;const k=p?(se,X,F)=>D=p[F]:(se,X,F)=>D+=Ni(se,X),L=(se,X,F,N,B,H,W)=>{if(T[A++]=X[0],T[A++]=X[1],T[A++]=X[2],T[A++]=N,T[A++]=W,T[A++]=B,T[A++]=se[0],T[A++]=se[1],T[A++]=se[2],T[A++]=F[0],T[A++]=F[1],T[A++]=F[2],this._parameters.vvSizeEnabled?T[A++]=m:T[A++]=f,this._parameters.vvColorEnabled)T[A++]=_;else{const K=Math.min(4*H,g.length-4);T[A++]=g[K+0],T[A++]=g[K+1],T[A++]=g[K+2],T[A++]=g[K+3]}this._parameters.vvOpacityEnabled&&(T[A++]=b),pe("enable-feature:objectAndLayerId-rendering")&&(v(x)&&(E[4*A+0]=x[0],E[4*A+1]=x[1],E[4*A+2]=x[2],E[4*A+3]=x[3]),A++)};A+=O,ue(a,c[0],c[1],c[2]),t&&je(a,a,t);const q=this._isClosed(i);if(q){const se=c.length-3;ue(o,c[se],c[se+1],c[se+2]),t&&je(o,o,t)}else ue(l,c[3],c[4],c[5]),t&&je(l,l,t),L(a,a,l,1,od.LEFT_CAP_START,0,0),L(a,a,l,1,od.RIGHT_CAP_START,0,0),le(o,a),le(a,l);const G=q?0:1,J=q?w:w-1;for(let se=G;se<J;se++){const X=(se+1)%w*3;ue(l,c[X+0],c[X+1],c[X+2]),t&&je(l,l,t),k(o,a,se),L(o,a,l,0,od.LEFT_JOIN_END,se,D),L(o,a,l,0,od.RIGHT_JOIN_END,se,D);const F=this.numJoinSubdivisions;for(let N=0;N<F;++N){const B=(N+1)/(F+1);L(o,a,l,B,od.LEFT_JOIN_END,se,D),L(o,a,l,B,od.RIGHT_JOIN_END,se,D)}L(o,a,l,1,od.LEFT_JOIN_START,se,D),L(o,a,l,1,od.RIGHT_JOIN_START,se,D),le(o,a),le(a,l)}q?(ue(l,c[3],c[4],c[5]),t&&je(l,l,t),D=k(o,a,J),L(o,a,l,0,od.LEFT_JOIN_END,G,D),L(o,a,l,0,od.RIGHT_JOIN_END,G,D)):(D=k(o,a,J),L(o,a,a,0,od.LEFT_CAP_END,J,D),L(o,a,a,0,od.RIGHT_CAP_END,J,D)),yX(T,R+O,T,R,O),A=yX(T,A-O,T,A,O),this._parameters.wireframe&&this._addWireframeVertices(s,R,A,O)}_addWireframeVertices(t,r,i,s){const n=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=yX(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function yX(e,t,r,i,s){for(let n=0;n<s;n++)r[i++]=e[t++];return i}function Sre(e,t,r){return BFe(e,t.get(M.POSITION).data,r?r.get(M.POSITION):null)}function BFe(e,t,r){return!!e.isClosed&&(r?r.length>2:t.length>6)}function Owt(e){return e.anchor===UE.Tip&&e.hideOnShortSegments&&e.placement==="begin-end"&&e.worldSpace}const Hc=$(),qc=$(),Fg=$(),ET=$(),Mwt=$(),CT=ul(),AT=ul(),j_e=$(),G_e=$(),H_e=xg(),Rwt=xg(),Iwt=$(),Pwt=$(),$wt=$(),qP=[ul(),ul(),ul(),ul()],s_=[$(),$(),$(),$()],_X=di(),vX=di(),bX=di(),wX=di();class Mce{constructor(t){this._originSR=t,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+Su()}getOrigin(t){const r=this._origins.get(this._rootOriginId);if(r==null){const d=iwt.rootOrigin;if(v(d))return this._origins.set(this._rootOriginId,cL(d[0],d[1],d[2],this._rootOriginId)),this.getOrigin(t);const p=cL(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const i=this._gridSize,s=Math.round(t[0]/i),n=Math.round(t[1]/i),o=Math.round(t[2]/i),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*i;if(ge(_a,t,r.vec3),_a[0]=Math.abs(_a[0]),_a[1]=Math.abs(_a[1]),_a[2]=Math.abs(_a[2]),_a[0]<c&&_a[1]<c&&_a[2]<c){if(l){const d=Math.max(..._a);if(ge(_a,t,l.vec3),_a[0]=Math.abs(_a[0]),_a[1]=Math.abs(_a[1]),_a[2]=Math.abs(_a[2]),Math.max(..._a)<d)return l}return r}return l||(l=cL(s*i,n*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(t,r=ar(1,1,0,1)){const i=window.view,s=i._stage,n=r.toString();if(!this._objects.has(n)){this._material=new oM({width:2,color:r}),s.add(this._material);const m=new AFe({isPickable:!1}),g=new w1({castShadow:!1});s.add(g),m.add(g),s.add(m),this._objects.set(n,g)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),d=new Array,p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=t[0]+(1&a[m]?p:-p),c[3*m+1]=t[1]+(2&a[m]?p:-p),c[3*m+2]=t[2]+(4&a[m]?p:-p),m>0&&d.push(m-1,m);Yi(c,this._originSR,0,c,i.renderSpatialReference,0,l);const f=new mn([[M.POSITION,{size:3,data:c,exclusive:!0}]],[[M.POSITION,d]],Bl.Line);s.add(f),o.addGeometry(f,this._material,Hn)}get test(){const t=this;return{set gridSize(r){t._gridSize=r}}}}const _a=$();class zFe{constructor(t,r,i,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new Li,this.output=V.Color,this.renderOccludedMask=q_e,this.bindParameters=new h7(r,i,v(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=q_e}}class Dwt extends zFe{constructor(t,r,i,s,n){super(t,i,s,n),this.offscreenRenderingHelper=r,this.sliceHelper=n}}const q_e=Rs.Occlude|Rs.OccludeAndTransparent|Rs.OccludeAndTransparentStencil;var dI;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(dI||(dI={}));class Xk{constructor(){this.camera=new Li,this.lightMat=$e()}}class Rce{constructor(t,r){this._rctx=t,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._splitSchemeLambda=0,this._warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Lr(),this._cascades=[new Xk,new Xk,new Xk,new Xk],this._maxTextureSize=Math.min(pe("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return Oi(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this._maxNumCascades=_e(Math.floor(t),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&v(this._depthTexture)}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this._numCascades;++t)TX[t]=this._cascades[t];return TX.length=this._numCascades,TX}start(t,r,i){Et(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(i);this._computeCascadeDistances(n,s),this._setupMatrices(t,r);const o=t.viewMatrix,a=t.projectionMatrix;for(let l=0;l<this._numCascades;++l)this._constructCascade(l,a,o,r);this._lastOrigin=null,this.clear()}finish(t){Et(this.enabled),this._rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this._lastOrigin||!_u(t,this._lastOrigin)){this._lastOrigin=this._lastOrigin||$(),le(this._lastOrigin,t);for(let r=0;r<this._numCascades;++r){Pu(rve,this._cascades[r].lightMat,t);for(let i=0;i<16;++i)ive[16*r+i]=rve[i]}}return ive}takeCascadeSnapshotTo(t,r){Et(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const s=this._rctx,n=s.bindTexture(i,dt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(xt.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,dt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this._rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(ds.COLOR_BUFFER_BIT|ds.DEPTH_BUFFER_BIT)}_computeTextureSize(t,r){const i=.5*Math.log(t*t+r*r)*Math.LOG2E,s=.35,n=2**Math.round(i+s);return Math.min(this._maxTextureSize,2*n)}_ensureDepthTexture(){if(v(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new dt(this._rctx,t),this._fbo=new ps(this._rctx,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let r=this._snapshots[t];if(v(r)&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(t);const i={target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return r=new dt(this._rctx,i),this._snapshots[t]=r,r}_discardDepthTexture(){this._fbo=tt(this._fbo),this._depthTexture=tt(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=tt(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this._snapshots.length;++t)this._discardSnapshot(t);this._snapshots.length=0}_bindFbo(){const t=this._rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,r,i,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);Et(l<c);for(let p=0;p<8;++p){Oi(Z_e,p%4==0||p%4==3?-1:1,p%4==0||p%4==1?-1:1,p<4?l:c,1),kh(td[p],Z_e,Y_e);for(let f=0;f<3;++f)td[p][f]/=td[p][3]}Fl(xX,td[0]),Pu(W_e,tve,xX),n.camera.viewMatrix=W_e;for(let p=0;p<8;++p)je(td[p],td[p],n.camera.viewMatrix);le(kg,td[0]),le(Ug,td[0]);for(let p=1;p<8;++p)for(let f=0;f<3;++f)kg[f]=Math.min(kg[f],td[p][f]),Ug[f]=Math.max(Ug[f],td[p][f]);kg[2]-=200,Ug[2]+=200,n.camera.near=-Ug[2],n.camera.far=-kg[2],this._warp?this._constructTrapezoidalProjection(i,s,n):this._constructOrthogonalProjection(n),Hs(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const d=this._textureSize/2;n.camera.viewport[0]=t%2==0?0:d,n.camera.viewport[1]=Math.floor(t/2)===0?0:d,n.camera.viewport[2]=d,n.camera.viewport[3]=d}_constructOrthogonalProjection(t){qoe(t.camera.projectionMatrix,kg[0],Ug[0],kg[1],Ug[1],t.camera.near,t.camera.far)}_constructTrapezoidalProjection(t,r,i){const s=1/td[0][3],n=1/td[4][3];Et(s<n);let o=s+Math.sqrt(s*n);const a=Math.sin(Eo(t[2]*r[0]+t[6]*r[1]+t[10]*r[2]));o/=a,Nwt(td,o,a,J_e,K_e,Lwt,Q_e,eve),Fwt(J_e,K_e,Q_e,eve,i.camera.projectionMatrix),i.camera.projectionMatrix[10]=2/(kg[2]-Ug[2]),i.camera.projectionMatrix[14]=-(kg[2]+Ug[2])/(kg[2]-Ug[2])}_setupMatrices(t,r){Hs(X_e,t.projectionMatrix,t.viewMatrix),Pn(Y_e,X_e);const i=this._viewingMode===Ye.Global?t.eye:ue(xX,0,0,1);Ij(tve,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(t){let{near:r,far:i}=t;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(t,r){this._numCascades=Math.min(1+Math.floor(ift(t/r,4)),this._maxNumCascades);const i=(t-r)/this._numCascades,s=(t/r)**(1/this._numCascades);let n=r,o=r;for(let a=0;a<this._numCascades+1;++a)this._cascadeDistances[a]=Ft(n,o,this._splitSchemeLambda),n*=s,o+=i}get gpuMemoryUsage(){var t,r;return this._snapshots.reduce((i,s)=>i+CE(s),(r=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?r:0)}get test(){const t=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(r){t._splitSchemeLambda=r},get splitSchemeLambda(){return t._splitSchemeLambda},set warp(r){t._warp=r},get warp(){return t._warp}}}}const W_e=$e(),X_e=$e(),Y_e=$e(),Z_e=Lr(),td=[];for(let e=0;e<8;++e)td.push(Lr());const kg=$(),Ug=$(),J_e=rt(),K_e=rt(),Lwt=rt(),Q_e=rt(),eve=rt(),tve=$e(),xX=$(),TX=[],rve=$e(),ive=new Float32Array(64),Zd=rt(),YC=rt(),OT=[rt(),rt(),rt(),rt()],Mo=rt(),SX=rt(),Z1=rt(),WP=rt(),ZC=rt(),JC=rt(),Yk=rt();function Nwt(e,t,r,i,s,n,o,a){mr(Zd,0,0);for(let O=0;O<4;++O)Pm(Zd,Zd,e[O]);wd(Zd,Zd,.25),mr(YC,0,0);for(let O=4;O<8;++O)Pm(YC,YC,e[O]);wd(YC,YC,.25),dO(OT[0],e[4],e[5],.5),dO(OT[1],e[5],e[6],.5),dO(OT[2],e[6],e[7],.5),dO(OT[3],e[7],e[4],.5);let l=0,c=uV(OT[0],Zd);for(let O=1;O<4;++O){const A=uV(OT[O],Zd);A<c&&(c=A,l=O)}Gy(Mo,OT[l],e[l+4]);const d=Mo[0];let p,f;Mo[0]=-Mo[1],Mo[1]=d,Gy(SX,YC,Zd),go(SX,Mo)<0&&ale(Mo,Mo),dO(Mo,Mo,SX,r),AN(Mo,Mo),p=f=go(Gy(Z1,e[0],Zd),Mo);for(let O=1;O<8;++O){const A=go(Gy(Z1,e[O],Zd),Mo);A<p?p=A:A>f&&(f=A)}Ho(i,Zd),wd(Z1,Mo,p-t),Pm(i,i,Z1);let m=-1,g=1,_=0,x=0;for(let O=0;O<8;++O){Gy(WP,e[O],i),AN(WP,WP);const A=Mo[0]*WP[1]-Mo[1]*WP[0];A>0?A>m&&(m=A,_=O):A<g&&(g=A,x=O)}LC(m>0,"leftArea"),LC(g<0,"rightArea"),wd(ZC,Mo,p),Pm(ZC,ZC,Zd),wd(JC,Mo,f),Pm(JC,JC,Zd),Yk[0]=-Mo[1],Yk[1]=Mo[0];const b=ak(i,e[x],JC,Pm(Z1,JC,Yk),1,s),w=ak(i,e[_],JC,Z1,1,n),T=ak(i,e[_],ZC,Pm(Z1,ZC,Yk),1,o),E=ak(i,e[x],ZC,Z1,1,a);LC(b,"rayRay"),LC(w,"rayRay"),LC(T,"rayRay"),LC(E,"rayRay")}function qr(e,t){return 3*t+e}const sve=rt();function Bu(e,t){return mr(sve,e[t],e[t+3]),sve}const Wc=rt(),nt=Ts();function Fwt(e,t,r,i,s){Gy(Wc,r,i),wd(Wc,Wc,.5),nt[0]=Wc[0],nt[1]=Wc[1],nt[2]=0,nt[3]=Wc[1],nt[4]=-Wc[0],nt[5]=0,nt[6]=Wc[0]*Wc[0]+Wc[1]*Wc[1],nt[7]=Wc[0]*Wc[1]-Wc[1]*Wc[0],nt[8]=1,nt[qr(0,2)]=-go(Bu(nt,0),e),nt[qr(1,2)]=-go(Bu(nt,1),e);let n=go(Bu(nt,0),r)+nt[qr(0,2)],o=go(Bu(nt,1),r)+nt[qr(1,2)],a=go(Bu(nt,0),i)+nt[qr(0,2)],l=go(Bu(nt,1),i)+nt[qr(1,2)];n=-(n+a)/(o+l),nt[qr(0,0)]+=nt[qr(1,0)]*n,nt[qr(0,1)]+=nt[qr(1,1)]*n,nt[qr(0,2)]+=nt[qr(1,2)]*n,n=1/(go(Bu(nt,0),r)+nt[qr(0,2)]),o=1/(go(Bu(nt,1),r)+nt[qr(1,2)]),nt[qr(0,0)]*=n,nt[qr(0,1)]*=n,nt[qr(0,2)]*=n,nt[qr(1,0)]*=o,nt[qr(1,1)]*=o,nt[qr(1,2)]*=o,nt[qr(2,0)]=nt[qr(1,0)],nt[qr(2,1)]=nt[qr(1,1)],nt[qr(2,2)]=nt[qr(1,2)],nt[qr(1,2)]+=1,n=go(Bu(nt,1),t)+nt[qr(1,2)],o=go(Bu(nt,2),t)+nt[qr(2,2)],a=go(Bu(nt,1),r)+nt[qr(1,2)],l=go(Bu(nt,2),r)+nt[qr(2,2)],n=-.5*(n/o+a/l),nt[qr(1,0)]+=nt[qr(2,0)]*n,nt[qr(1,1)]+=nt[qr(2,1)]*n,nt[qr(1,2)]+=nt[qr(2,2)]*n,n=go(Bu(nt,1),t)+nt[qr(1,2)],o=go(Bu(nt,2),t)+nt[qr(2,2)],a=-o/n,nt[qr(1,0)]*=a,nt[qr(1,1)]*=a,nt[qr(1,2)]*=a,s[0]=nt[0],s[1]=nt[1],s[2]=0,s[3]=nt[2],s[4]=nt[3],s[5]=nt[4],s[6]=0,s[7]=nt[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=nt[6],s[13]=nt[7],s[14]=0,s[15]=nt[8]}class VFe{constructor(){this.adds=new Qt,this.removes=new Qt,this.updates=new Qt({allocator:t=>t||new kwt,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class kwt{}class Uwt{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var ks,bo;(function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"})(ks||(ks={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITIES=1]="VISIBILITIES",e[e.VERTEXATTRS=2]="VERTEXATTRS",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHTS=8]="HIGHLIGHTS",e[e.OCCLUDEES=16]="OCCLUDEES"}(bo||(bo={}));function jFe(e){const t=new Map,r=i=>{let s=t.get(i);return s||(s=new Uwt,t.set(i,s)),s};return e.removes.forAll(i=>{EX(i)&&r(i.material).removes.push(i)}),e.adds.forAll(i=>{EX(i)&&r(i.material).adds.push(i)}),e.updates.forAll(i=>{EX(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),t}function EX(e){return e.data.indexCount>=1}class GFe{constructor(t,r){this._material=t,this._repository=r,this._map=new Map}destroy(){this._map.forEach((t,r)=>{v(t)&&this._repository.release(this._material,r)})}load(t,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(v(s)){if(s.ensureResources(t)===Ov.LOADED)return s;this._repository.requestRender()}return null}}function Bwt(e){const t=S`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.vertex.code.add(t)}function b4(e,t){t.normalType===fs.Attribute&&(e.attributes.add(M.NORMAL,"vec3"),e.vertex.code.add(S`vec3 normalModel() {
return normal;
}`)),t.normalType===fs.CompressedAttribute&&(e.include(Bwt),e.attributes.add(M.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(S`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===fs.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(S`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}var fs;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(fs||(fs={}));function J7(e,t){t.normalType===fs.Attribute||t.normalType===fs.CompressedAttribute?(e.include(b4,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new IN("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new U0("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)]),e.vertex.code.add(S`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===fs.Ground?(e.include(VM,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(S`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?S`normalize(vPositionWorldCameraRelative);`:S`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(S`void forwardNormal() {}`)}class HFe extends CDe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Ts()}}class qFe extends ADe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Ts(),this.toMapSpace=Lr()}}class Ere extends qFe{constructor(t=$()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}function zwt(e){e.fragment.code.add(S`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Vwt(e){e.fragment.code.add(S`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function nve(e){e.fragment.uniforms.add(new Rt("texWaveNormal",t=>t.waveNormal)),e.fragment.uniforms.add(new Rt("texWavePerturbation",t=>t.wavePertubation)),e.fragment.uniforms.add([new Tr("waveParams",t=>Oi(jwt,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new ai("waveDirection",t=>mr(Gwt,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]),e.include(zwt),e.fragment.code.add(S`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const jwt=Lr(),Gwt=rt();function nF(e,t){t.spherical?e.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class w4 extends tn{constructor(t,r){super(t,"int",Ri.Pass,(i,s,n)=>i.setUniform1i(t,r(s,n)))}}class Hwt extends tn{constructor(t,r,i){super(t,"mat4",Ri.Draw,(s,n,o)=>s.setUniformMatrix4fv(t,r(n,o)),i)}}class qwt extends tn{constructor(t,r,i){super(t,"mat4",Ri.Pass,(s,n,o)=>s.setUniformMatrix4fv(t,r(n,o)),i)}}class WFe extends Zi{constructor(){super(...arguments),this.origin=$()}}function K7(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new qwt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),XFe(e,t))}function BE(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new Hwt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),XFe(e,t))}function XFe(e,t){const r=e.fragment;r.include(Vd),r.uniforms.add([...sg("shadowMapTex",(i,s)=>s.shadowMap.depthTexture,t.hasWebGL2Context?vi.None:vi.Size),new w4("numCascades",(i,s)=>s.shadowMap.numCascades),new Tr("cascadeDistances",(i,s)=>s.shadowMap.cascadeDistances)]),r.code.add(S`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${ff(t,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}function Wwt(e){const t=e.fragment.code;t.add(S`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(S`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(S`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function Q7(e,t){const r=e.fragment.code;e.include(c7),t.pbrMode===kt.Water||t.pbrMode===kt.WaterOnIntegratedMesh?(r.add(S`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),r.add(S`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(S`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(S`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(S`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==kt.Normal&&t.pbrMode!==kt.Schematic||(e.include(Wwt),r.add(S`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(S`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(S`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),r.add(S`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(S`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(S`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function YFe(e,t){e.include(Q7,t),e.include(o7),e.include(Vwt),t.hasCloudsReflections&&e.include(mDe,t),t.hasScreenSpaceReflections&&e.include(Mpt,t);const r=e.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(S`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add([new De("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new De("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)]),r.code.add(S`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&r.code.add(S`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?(r.uniforms.add(new xs("view",(i,s)=>s.ssr.camera.viewMatrix)),r.uniforms.add(new Rt("lastFrameColorMap",(i,s)=>s.ssr.lastFrameColorTexture)),r.code.add(S`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`)):r.code.add(S`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?r.code.add(S`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(S`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(S`return waterRenderedColor;
}`)}function Xwt(e){const t=new Qr,{vertex:r,fragment:i}=t;Dd(r,e),t.include(wu,e),t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.UV0,"vec2");const s=new Tr("waterColor",n=>n.color);if(e.output===V.Color&&e.isDraped)return t.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(hl)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(s),i.code.add(S`void main() {
gl_FragColor = waterColor;
}`),t;switch(e.output!==V.Color&&e.output!==V.Alpha||(t.include(nF,e),t.include(UI,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.uniforms.add(s),r.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(hl)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===V.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(rp,e),e.output){case V.Alpha:t.include(Rn,e),i.uniforms.add(s),i.code.add(S`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case V.Color:t.include(lle,e),t.include(yle,{pbrMode:kt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(nve),t.include(Rn,e),t.include(BE,e),t.include(YFe,e),i.uniforms.add([s,new De("timeElapsed",n=>n.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")]),_g(i,e),i.include(k0),d1(i),F0(i),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?S`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case V.Normal:t.include(nF,e),t.include(nve,e),t.include(Rn,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r.uniforms.add(s),r.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(hl)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new De("timeElapsed",n=>n.timeElapsed)),i.code.add(S`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case V.Highlight:t.include(_1,e),t.varyings.add("vpos","vec3"),r.uniforms.add(s),r.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(hl)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(Rn,e),i.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return t}const Ywt=Object.freeze(Object.defineProperty({__proto__:null,build:Xwt},Symbol.toStringTag,{value:"Module"}));class eG extends li{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2,r.spherical=t.viewingMode===Ye.Global,r.doublePrecisionRequiresObfuscation=a4(t.rctx)}initializeProgram(t){return new ti(t.rctx,eG.shader.get().build(this.configuration),Yr)}_setPipelineState(t){const r=this.configuration,i=t===Ct.NONE,s=t===Ct.FrontFace;return Ht({blending:r.output!==V.Normal&&r.output!==V.Highlight&&r.transparent?i?qh:v1(t):null,depthTest:{func:rT(t)},depthWrite:i?r.writeDepth&&$u:F7(t),colorWrite:cr,polygonOffset:i||s?null:B7(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}eG.shader=new ei(Ywt,()=>re(()=>import("./WaterSurface.glsl.ac80e7c7.js"),[]));class Ma extends aa{constructor(){super(...arguments),this.output=V.Color,this.transparencyPassType=Ct.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:V.COUNT})],Ma.prototype,"output",void 0),u([j({count:Ct.COUNT})],Ma.prototype,"transparencyPassType",void 0),u([j()],Ma.prototype,"spherical",void 0),u([j()],Ma.prototype,"receiveShadows",void 0),u([j()],Ma.prototype,"hasSlicePlane",void 0),u([j()],Ma.prototype,"transparent",void 0),u([j()],Ma.prototype,"enableOffset",void 0),u([j()],Ma.prototype,"writeDepth",void 0),u([j()],Ma.prototype,"hasScreenSpaceReflections",void 0),u([j()],Ma.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],Ma.prototype,"hasCloudsReflections",void 0),u([j()],Ma.prototype,"isDraped",void 0),u([j()],Ma.prototype,"hasMultipassTerrain",void 0),u([j()],Ma.prototype,"cullAboveGround",void 0),u([j({constValue:kt.Water})],Ma.prototype,"pbrMode",void 0),u([j({constValue:!0})],Ma.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!0})],Ma.prototype,"highStepCount",void 0),u([j({constValue:!1})],Ma.prototype,"useFillLights",void 0);class Zwt extends tT{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const r=v(t.cloudsFade.data);r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(t){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(t)}beginSlot(t){return this._output===V.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(eG,t)}}const Jwt=Ds().vec3f(M.POSITION),Kwt=Ds().vec3f(M.POSITION).vec2f(M.UV0),ZFe=Ds().vec3f(M.POSITION).vec4u8(M.COLOR);Ds().vec3f(M.POSITION).vec4u8(M.OBJECTANDLAYERIDCOLOR);Ds().vec3f(M.POSITION).vec2f(M.UV0).vec4u8(M.OBJECTANDLAYERIDCOLOR);const Qwt=Ds().vec3f(M.POSITION).vec4u8(M.COLOR).vec4u8(M.OBJECTANDLAYERIDCOLOR);class tG{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(M.POSITION).length}write(t,r,i,s,n){D7(i,this.vertexBufferLayout,t,r,s,n)}}class JFe extends z0{constructor(t){super(t,new KFe),this._configuration=new Ma,this.animation=new FDe}getConfiguration(t,r){return this._configuration.output=t,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<k7,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(t){const r=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<ext;const i=this.animation.advance(t);return this.setParameters({timeElapsed:zse(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}intersect(t,r,i,s,n,o,a){P7(t,r,s,n,o,void 0,a)}requiresSlot(t,r){switch(r){case V.Normal:return t===Ee.DRAPED_WATER;case V.Color:if(this.parameters.isDraped)return t===Ee.DRAPED_MATERIAL;break;case V.Alpha:break;case V.Highlight:return t===Ee.OPAQUE_MATERIAL||t===Ee.DRAPED_MATERIAL;default:return!1}let i=Ee.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===i}createGLMaterial(t){return new Zwt(t)}createBufferWriter(){return new tG(Kwt)}}class KFe extends GI{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=pi(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=ar(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const ext=35e3;class Zk{constructor(){this.first=0,this.count=0}}class fO{constructor(t=0,r=0){this.from=t,this.to=r}}class txt extends fO{constructor(t,r,i,s,n,o){super(r,i),this.id=t,this.isVisible=s,this.hasHighlights=n,this.hasOccludees=o}}function ove(e){return Array.from(e.values()).sort(rxt)}function rxt(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function Jk(e,t){const r=e.back();if(r==null){const i=e.pushNew();return i.first=t.from,void(i.count=t.to-t.from)}if(ixt(r,t)){const i=t.from-r.first+t.to-t.from;r.count=i}else{const i=e.pushNew();i.first=t.from,i.count=t.to-t.from}}function ixt(e,t){return e.first+e.count>=t.from}class sxt{constructor(t,r){this._pool=t,this._size=0,this._buffer=t.newBuffer(Are(r))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get buffer(){return this._buffer}get size(){return this._size}grow(t){this._resize(this._size+t,!0).dispose()}allocate(t){return this._resize(t,!1)}_resize(t,r){let i;const s=nxt(this._buffer.length,this._size,t);if(this._buffer.length!==s){const o=this._pool.newBuffer(s);r&&(o.array.set(this._buffer.array.subarray(0,Math.min(this._size,s))),o.vao.vertexBuffers.geometry.setSubData(o.array,0,0,o.array.length)),i=this._buffer,this._buffer=o}const n=this._size;return this._size=t,i?{dispose:()=>{i.array.fill(0,0,n),this._pool.deleteBuffer(i)},copy:(o,a,l)=>this._buffer.array.set(i.array.subarray(a,l),o),hasNewBuffer:!0}:{dispose:()=>{},copy:(o,a,l)=>{o!==a&&this._buffer.array.copyWithin(o,a,l)},hasNewBuffer:!1}}erase(t,r){this._buffer.array.fill(0,t,r)}}const Cre=65536;function Are(e){return Math.ceil(e/Cre)*Cre}function nxt(e,t,r){return t<=r?e>=r?e:Are(Math.max(2*e,r)):e<=2*r?e:Are(r)}class oxt{constructor(t,r,i,s){this.vao=new Cf(t,r,{geometry:i},{geometry:Ur.createVertex(t,ni.STATIC_DRAW)}),this.array=new Float32Array(s),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const axt=oB+1;class lxt{constructor(t,r,i){this._rctx=t,this._locations=r,this._layout=i,this._cache=t.newCache(`MergedRenderer pool ${Su()}`,cxt)}dispose(){this._cache.destroy()}newBuffer(t){const r=t.toString(),i=this._cache.pop(r);if(v(i)){const s=i.pop();return i.length>0&&this._cache.put(r,i,s.array.byteLength*i.length,axt),s}return new oxt(this._rctx,this._locations,this._layout,t)}deleteBuffer(t){const r=t.array.byteLength,i=t.array.length.toString(),s=this._cache.pop(i);return v(s)?(s.push(t),this._cache.put(i,s,r*s.length,-1)):this._cache.put(i,[t],r,-1),null}}function cxt(e,t){if(t===iv.ALL)return void e.forEach(s=>s.dispose());const r=e.pop(),i=e.length*r.array.byteLength;return r.dispose(),i}class QFe{constructor(t,r,i){this._rctx=t,this._materialRepository=r,this._material=i,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new Qt,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new GFe(this._material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._bufferPool=new lxt(t,i.vertexAttributeLocations,jd(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.geometry.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof JFe}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==Rs.Occlude}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateDrawCommands()}_addAndRemoveGeometries(t,r){const i=this._bufferWriter,s=i.vertexBufferLayout.stride/4,n=this._dataByOrigin,o=dxt(t,r);o.forEach((a,l)=>{o.delete(l);const c=a.add.reduce((b,w)=>b+i.elementCount(w.data),0);let d=n.get(l);if(d==null)Et(a.remove.length===0),d=new pxt(a.origin,new sxt(this._bufferPool,c*s)),n.set(l,d);else if(a.add.length===0&&d.instances.size===a.remove.length)return d.geometry.dispose(),void n.delete(l);let p=0;d.instances.forEach(b=>p+=b.to-b.from);const f=a.remove.reduce((b,w)=>b+i.elementCount(w.data),0),m=d.geometry.size,g=(p+c-f)*s,_=mxt;if(g>Cre&&(g<m/2||m-g>1048576)?this._removeAndRebuild(d,a.remove,s,g,_):a.remove.length>0&&this._remove(d,a.remove,s,_),a.add.length>0){const b=gxt;IDe(b,-a.origin[0],-a.origin[1],-a.origin[2]),this._add(d,a.add,s,b,_)}const x=d.geometry.buffer.vao.vertexBuffers.geometry;cve(_),_.forAll(({from:b,to:w})=>{if(b<w){const T=d.geometry.buffer.array;x.setSubData(T,b,b,w)}}),_.clear(),d.drawCommandsDirty=!0})}_updateGeometries(t){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const s of t){const n=s.renderGeometry,o=this._dataByOrigin.get(n.origin.id),a=o&&o.instances.get(n.id);if(!a)return;const l=s.updateType;if(l&bo.VISIBILITIES&&(a.isVisible=n.instanceParameters.visible),l&(bo.HIGHLIGHTS|bo.VISIBILITIES)){const c=n.instanceParameters.visible;a.hasHighlights=!!n.instanceParameters.highlights&&c}if(l&bo.OCCLUDEES&&(a.hasOccludees=!!n.instanceParameters.occludees),l&(bo.VERTEXATTRS|bo.TRANSFORMATION)){const{array:c,vao:d}=o.geometry.buffer;tgt(n,CX,XP),r.write(CX,XP,n.data,r.vertexBufferLayout.createView(c.buffer),a.from),Et(a.from+r.elementCount(n.data)===a.to,"material VBO layout has changed"),d.vertexBuffers.geometry.setSubData(c,a.from*i,a.from*i,a.to*i)}o.drawCommandsDirty=!0}}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(r=>{r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,wo(r.instances,i=>(i.isVisible?(i.hasHighlights&&(this._hasHighlights=!0,r.hasHighlights=!0),i.hasOccludees&&(this._hasOccludees=!0,r.hasOccludees=!0)):r.hasHiddenInstances=!0,r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees))});const t=r=>{if(r.drawCommandsDefault.clear(),r.drawCommandsHighlight.clear(),r.drawCommandsOccludees.clear(),r.drawCommandsShadowHighlightRest.clear(),r.instances.size===0)return;if(!lve(r)){const s=r.drawCommandsDefault.pushNew();return s.first=1/0,s.count=0,r.instances.forEach(n=>{s.first=Math.min(s.first,n.from),s.count=Math.max(s.count,n.to)}),void(s.count-=s.first)}const i=ove(r.instances);for(const s of i)s.isVisible&&(s.hasOccludees?Jk(r.drawCommandsOccludees,s):Jk(r.drawCommandsDefault,s),s.hasHighlights?Jk(r.drawCommandsHighlight,s):Jk(r.drawCommandsShadowHighlightRest,s))};this._dataByOrigin.forEach(r=>{r.drawCommandsDirty&&(t(r),r.drawCommandsDirty=!1)})}updateAnimation(t){return this._material.update(t)}requiresSlot(t,r){return this._material.requiresSlot(t,r)}render(t,r){if(!this.requiresSlot(r.slot,t))return!1;const i=t===V.Highlight||t===V.ShadowHighlight;if(i&&!this._hasHighlights)return!1;const s=t===V.ShadowExludeHighlight,n=!(i||s);if(this._dataByOrigin.forEach(d=>{if(i&&!d.hasHighlights)return;const p=(i?d.drawCommandsHighlight:s&&lve(d)?d.drawCommandsShadowHighlightRest:d.drawCommandsDefault)||null,f=n&&d.drawCommandsOccludees||null;((p==null?void 0:p.length)||(f==null?void 0:f.length))&&this._renderCommandData.push(new fxt(d.origin,d.geometry,p,f))}),this._renderCommandData.length===0)return!1;const o=this._rctx,a=this._glMaterials.load(o,r.slot,t);if(C(a))return this._renderCommandData.clear(),!1;const l=a.beginSlot(r),c=o.bindTechnique(l,this._material.parameters,r);return this._renderCommandData.forAll(d=>{c.bindDraw(d,r,this._material.parameters);const{geometry:p,renderCommands:f,occludeeCommands:m}=d;l.ensureAttributeLocations(p.buffer.vao),o.bindVAO(p.buffer.vao);const g=l.primitiveType;v(f)&&f.length>0&&(l.bindPipelineState(o,r.slot,!1),f.forAll(_=>o.drawArrays(g,_.first,_.count))),v(m)&&m.length>0&&(l.bindPipelineState(o,r.slot,!0),m.forAll(_=>o.drawArrays(g,_.first,_.count)))}),this._renderCommandData.clear(),!0}_removeAndRebuild(t,r,i,s,n){for(const d of r)t.instances.delete(d.id);const o=ove(t.instances);t.instances.clear();const a=t.geometry.size,l=t.geometry.allocate(s);let c=0;for(const d of o){const p=d.from*i,f=d.to*i;l.copy(c,p,f),d.from=c/i,c+=f-p,d.to=c/i,t.instances.set(d.id,d)}n.push(new fO(0,l.hasNewBuffer?t.geometry.buffer.array.length:a)),l.dispose(),t.geometry.erase(c,n.back().to),t.holes.clear()}_remove(t,r,i,s){for(const n of r){const o=n.id,a=t.instances.get(o),l=a.from*i,c=a.to*i;t.geometry.erase(l,c),t.holes.push(new fO(a.from,a.to)),t.instances.delete(o),s.push(new fO(l,c))}cve(t.holes)}_add(t,r,i,s,n){if(r.length===0)return;const o=this._bufferWriter;let a=o.vertexBufferLayout.createView(t.geometry.buffer.array.buffer);const l=t.holes.length>0;let c=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER;for(const p of r){const f=v(p.transformation)?Hs(CX,s,p.transformation):s;Pn(XP,f);const m=Iu(XP,XP),g=o.elementCount(p.data),_=g*i;let x=hxt(t.holes,g);C(x)&&(x=t.geometry.size/i,t.geometry.grow(_),a=o.vertexBufferLayout.createView(t.geometry.buffer.array.buffer)),o.write(f,m,p.data,a,x);const b=p.instanceParameters.visible,w=!!p.instanceParameters.highlights&&b,T=!!p.instanceParameters.occludees,E=new txt(p.id,x,x+g,b,w,T);Et(t.instances.get(p.id)==null),t.instances.set(p.id,E),l?n.push(new fO(E.from*i,E.to*i)):(c=Math.min(E.from,c),d=Math.max(E.to,d))}l||n.push(new fO(c*i,d*i))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class uxt{constructor(t){this.origin=t,this.add=new Array,this.remove=new Array}}function dxt(e,t){const r=new Map;for(const i of e)ave(r,i,!0);for(const i of t)ave(r,i,!1);return r}function ave(e,t,r){const i=t.origin;if(C(i))return;let s=e.get(i.id);s==null&&(s=new uxt(i.vec3),e.set(i.id,s)),r?s.add.push(t):s.remove.push(t)}function lve(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function hxt(e,t){let r;if(!e.some(s=>!(s.to-s.from<t)&&(r=s,!0)))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}function cve(e){const t=new Map;e.forAll(i=>t.set(i.from,i));let r=!0;for(;r;)r=!1,e.forEach(i=>{const s=t.get(i.to);s&&(i.to=s.to,t.delete(s.from),e.removeUnordered(s),r=!0)})}class pxt{constructor(t,r){this.origin=t,this.geometry=r,this.instances=new Map,this.holes=new Qt({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1,this.drawCommandsDefault=new Qt({allocator:i=>i||new Zk,deallocator:i=>i}),this.drawCommandsHighlight=new Qt({allocator:i=>i||new Zk,deallocator:i=>i}),this.drawCommandsOccludees=new Qt({allocator:i=>i||new Zk,deallocator:i=>i}),this.drawCommandsShadowHighlightRest=new Qt({allocator:i=>i||new Zk,deallocator:i=>i})}}class fxt extends Ere{constructor(t,r,i,s){super(t),this.geometry=r,this.renderCommands=i,this.occludeeCommands=s}}const mxt=new Qt({deallocator:null}),gxt=$e(),CX=$e(),XP=$e();let Py=class extends be{constructor(e){super(e),this._pending=new yxt,this._changes=new VFe,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Qt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return wo(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=jFe(this._changes);let t=!1,r=!1,i=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new QFe(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,r=!0,i=!0),!o)return;const a=r||o.hasHighlights,l=i||o.hasWater;o.modify(s),r=r||a!==o.hasHighlights,i=i||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=wo(this._materialRenderers,s=>s.hasHighlights)),i&&(this._hasWater=wo(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const i=this._pending.empty;for(const s of r)this._pending.adds.add(s);i&&this.notifyChange("updating"),t===ks.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const s of e)i.has(s)?(this._pending.removed.add(s),i.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===ks.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=this._changes.updates.length===0;for(const i of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(i),s.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case bo.TRANSFORMATION:case bo.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case bo.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:r})=>t=r.updateAnimation(e)||t),t}render(e,t){for(let r=0;r<this._sortedMaterialRenderers.length;r++){const i=this._sortedMaterialRenderers.data[r];i.material.shouldRender(e)&&i.materialRenderer.render(e.output,t)}}intersect(e,t,r,i,s){return this._geometries.forEach(n=>{if(i&&!i(n))return;this._intersectRenderGeometry(n,r,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,r,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,r,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push({material:r,materialRenderer:t})}),this._sortedMaterialRenderers.sort((t,r)=>{const i=r.material.renderPriority-t.material.renderPriority;return i!==0?i:t.material.insertOrder-r.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,i,s,n){if(!e.instanceParameters.visible)return;let o=0;v(e.transformation)&&(i+=e.transformation[12],o=e.transformation[13]),Kk[0]=r[0]-i,Kk[1]=r[1]-o,Kk[2]=1,Qk[0]=r[0]-i,Qk[1]=r[1]-o,Qk[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),s,Kk,Qk,(a,l,c)=>{_xt(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(C(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const r of e){const i=r.graphicUid;v(i)&&i!==t&&(this.drapeSource.notifyGraphicGeometryChanged(i),t=i)}}_notifyGraphicVisibilityChanged(e){if(C(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const r of e){const i=r.graphicUid;v(i)&&i!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(i),t=i)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return C(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([h()],Py.prototype,"drapeSource",void 0),u([h()],Py.prototype,"updating",null),u([h()],Py.prototype,"rctx",null),u([h()],Py.prototype,"rendererContext",void 0),u([h()],Py.prototype,"_materialRepository",null),u([h()],Py.prototype,"_localOriginFactory",null),Py=u([I("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Py);class yxt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function _xt(e,t,r,i,s,n,o){const a={layerUid:n,graphicUid:o,triangleNr:t},l=c=>{c.set(zs.OVERLAY,a,e.dist,e.normal,e.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==qa.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===qa.ALL){const c=Ile(s.ray);l(c),s.results.all.push(c)}}const Kk=$(),Qk=$(),AX=4;function vxt(){const e=new Qr,t=e.fragment;e.include($f);const r=(AX+1)/2,i=1/(2*r*r);return t.include(tp),t.uniforms.add([new Rt("depthMap",s=>s.depthTexture),new n4("tex",s=>s.colorTexture),new RN("blurSize",s=>s.blurSize),new De("projScale",(s,n)=>{const o=Ni(n.camera.eye,n.camera.center);return o>5e4?Math.max(0,s.projScale-(o-5e4)):s.projScale}),new ai("nearFar",(s,n)=>n.camera.nearFar)]),t.code.add(S`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${S.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.code.add(S`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${S.int(AX)}; r <= ${S.int(AX)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `),e}const bxt=Object.freeze(Object.defineProperty({__proto__:null,build:vxt},Symbol.toStringTag,{value:"Module"}));class rG extends li{initializeProgram(t){return new ti(t.rctx,rG.shader.get().build(),Yr)}initializePipeline(){return Ht({colorWrite:cr})}}rG.shader=new ei(bxt,()=>re(()=>import("./SSAOBlur.glsl.0c54261c.js"),[]));function iG(e){e.fragment.uniforms.add(new Tr("projInfo",(t,r)=>wxt(r))),e.fragment.uniforms.add(new ai("zScale",(t,r)=>e4e(r))),e.fragment.code.add(S`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function wxt(e){const t=e.camera.projectionMatrix;return t[11]===0?Oi(uve,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):Oi(uve,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const uve=Lr();function e4e(e){return e.camera.projectionMatrix[11]===0?mr(dve,0,1):mr(dve,1,0)}const dve=rt(),hve=16,xxt=.5;function Txt(){const e=new Qr,t=e.fragment;return e.include($f),t.include(tp),e.include(iG),t.uniforms.add(new De("radius",(r,i)=>pve(i))),t.code.add(S`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),t.code.add(S`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.uniforms.add([new ai("nearFar",(r,i)=>i.camera.nearFar),new Rt("normalMap",r=>r.normalTexture),new Rt("depthMap",r=>r.depthTexture),new ai("zScale",(r,i)=>e4e(i)),new De("projScale",r=>r.projScale),new Rt("rnm",r=>r.noiseTexture),new ai("rnmScale",(r,i)=>mr(fve,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new De("intensity",(r,i)=>4*xxt/pve(i)**6),new ai("screenSize",(r,i)=>mr(fve,i.camera.fullWidth,i.camera.fullHeight))]),t.code.add(S`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${S.int(hve)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${S.int(hve)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `),e}function pve(e){return Math.max(10,20*e.camera.computeRenderPixelSizeAtDist(Math.abs(4*e.camera.relativeElevation)))}const fve=rt(),Sxt=Object.freeze(Object.defineProperty({__proto__:null,build:Txt},Symbol.toStringTag,{value:"Module"}));class sG extends li{initializeProgram(t){return new ti(t.rctx,sG.shader.get().build(),Yr)}initializePipeline(){return Ht({colorWrite:cr})}}sG.shader=new ei(Sxt,()=>re(()=>import("./SSAO.glsl.3c7d73c5.js"),[]));class Ext extends Zi{constructor(){super(...arguments),this.projScale=1}}class Cxt extends Ext{}class Axt extends Zi{}class Oxt extends Axt{constructor(){super(...arguments),this.blurSize=rt()}}const z$=2;class t4e{constructor(t,r,i){this._techniqueRepository=t,this._rctx=r,this._requestRender=i,this._enabled=!1,this._quadVAO=null,this._passParameters=new Cxt,this._drawParameters=new Oxt}dispose(){this._quadVAO=tt(this._quadVAO)}disposeOffscreenBuffers(){qi(this._ssaoFBO,t=>t.resize(0,0)),qi(this._blur0FBO,t=>t.resize(0,0)),qi(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&v(this._passParameters.noiseTexture)&&v(this._ssaoFBO)&&v(this._blur0FBO)&&v(this._blur1FBO)}get loading(){return this.enabled&&!this.ready}get colorTexture(){return v(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return v(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return v(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(t,r,i){if(!this.enabled||C(r)||C(i)||C(this._passParameters.noiseTexture)||C(this._ssaoFBO)||C(this._blur0FBO)||C(this._blur1FBO))return;const s=this._rctx,n=t.camera;this._passParameters.normalTexture=i,this._passParameters.depthTexture=r,this._passParameters.projScale=1/n.computeRenderPixelSizeAtDist(1);const o=n.fullViewport,a=o[2],l=o[3],c=a/z$,d=l/z$;this._ssaoFBO.resize(a,l),this._blur0FBO.resize(c,d),this._blur1FBO.resize(c,d),C(this._quadVAO)&&(this._quadVAO=Zl(this._rctx)),s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,a,l),s.bindTechnique(this._ssaoTechnique,this._passParameters,t).bindDraw(this._drawParameters,t,this._passParameters),s.bindVAO(this._quadVAO),s.drawArrays(Ut.TRIANGLE_STRIP,0,da(this._quadVAO,"geometry"));const p=s.bindTechnique(this._blurTechnique,this._passParameters,t);s.setViewport(0,0,c,d),s.bindFramebuffer(this._blur0FBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,mr(this._drawParameters.blurSize,0,z$/l),p.bindDraw(this._drawParameters,t,this._passParameters),s.setViewport(0,0,c,d),s.drawArrays(Ut.TRIANGLE_STRIP,0,da(this._quadVAO,"geometry")),s.bindFramebuffer(this._blur1FBO),this._drawParameters.colorTexture=this._blur0FBO.colorTexture,mr(this._drawParameters.blurSize,z$/a,0),p.bindDraw(this._drawParameters,t,this._passParameters),s.drawArrays(Ut.TRIANGLE_STRIP,0,da(this._quadVAO,"geometry")),s.setViewport(o[0],o[1],o[2],o[3])}_selectPrograms(){C(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(sG)),C(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire(rG))}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(t){this._data?t():re(()=>import("./SSAOHelperData.9718cffe.js"),[]).then(r=>{this._data=r,t()})}_initialize(){const t={target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.LINEAR,wrapMode:It.CLAMP_TO_EDGE,width:0,height:0},r={colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE};A0(this._data.noiseTexture).then(i=>{this._enabled&&(this._ssaoFBO=new ps(this._rctx,r,t),this._blur0FBO=new ps(this._rctx,r,t),this._blur1FBO=new ps(this._rctx,r,t),this._passParameters.noiseTexture=new dt(this._rctx,{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,hasMipmap:!0,width:i.width,height:i.height},i),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._passParameters.noiseTexture=tt(this._passParameters.noiseTexture),this._blur1FBO=tt(this._blur1FBO),this._blur0FBO=tt(this._blur0FBO),this._ssaoFBO=tt(this._ssaoFBO)}get gpuMemoryUsage(){return(v(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(v(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(v(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}class x4 extends li{initializeProgram(t){return new ti(t.rctx,x4.shader.get().build(),Yr)}initializePipeline(){return this.configuration.hasAlpha?Ht({blending:ma(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:cr}):Ht({colorWrite:cr})}}x4.shader=new ei(hvt,()=>re(()=>import("./TextureOnly.glsl.2f97a8f7.js"),[]));class Ice extends Yl{constructor(){super(...arguments),this.hasAlpha=!1}}u([j()],Ice.prototype,"hasAlpha",void 0);let yy=class extends X7(be){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new hr,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Qt,this._passParameters=new ace,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new $s,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new MFe(e.renderingContext),this._shaderTechniqueRepository=new TFe({rctx:this._rctx,viewingMode:Ye.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new zFe(this._rctx,new Rce(this._rctx,this.view.state.viewingMode),new t4e(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ie(()=>t.updating,()=>this.events.emit("content-changed"),Qi),ie(()=>this.spatialReference,r=>this._localOriginFactory=new Mce(r),Qi),ms(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new SFe(e.textureRepository,this._shaderTechniqueRepository,r=>{(r.renderOccluded&HV)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Ee.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=hDe(this._rctx),this._bindParameters.camera=O2,this._bindParameters.transparencyPassType=Ct.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new vle(Fe(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(Ot.STAGE,this))}dispose(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=Di(this._debugTextureTechnique),this._passParameters.texture=tt(this._passParameters.texture),this._bindParameters.highlightDepthTexture=tt(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=tt(this._shaderTechniqueRepository),this._temporaryFBO=tt(this._temporaryFBO),this._quadVAO=tt(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||wo(this._renderers,e=>e.updating)}get hasOverlays(){return v(this._overlays)&&v(this._overlayRenderTarget)}get gpuMemoryUsage(){return v(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Py)}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);v(i)&&i.destroy();const s=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ie(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(C(e))return;const t=this._renderers.get(e);C(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(v(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const i=this.overlays[0].validTargets[r.type]||!this.overlays[1].validTargets[r.type];t=this._overlayRenderTarget.validateUsageForTarget(i,r,e)||t}return t}get overlays(){return yt(this._overlays,[])}ensureDrapeTargets(e){v(this._overlays)&&this._overlays.forEach(t=>t.hasTargetWithoutRasterImage=g6(e,r=>r.drapeTargetType===xre.WithoutRasterImage))}ensureDrapeSources(e){v(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=g6(e,r=>r.drapeSourceType===aL.Features),t.hasDrapedRasterSource=g6(e,r=>r.drapeSourceType===aL.RasterImage)})}ensureOverlays(e,t){C(this._overlays)&&(this._overlayRenderTarget=new Jbt(this._rctx),this._overlays=[new N_e(Us.INNER,this._overlayRenderTarget),new N_e(Us.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=tt(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,t){let r=!1;for(const[i,s]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(v(this._overlays)&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(FI,e=>e.updatePolicy===qR.SYNC)}isEmpty(){if(hi.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._renderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._renderers.forEach(r=>t=r.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,r){const i=e.canvasGeometries;if(i.numViews===0)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;const s=t.output;if(this.isEmpty()||s===V.Highlight&&!this.hasHighlights||s===V.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const l=this._rctx;O2.pixelRatio=e.pixelRatio*r,this._renderContext.output=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===V.Normal?Ee.DRAPED_WATER:Ee.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(l),e.index===Us.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(ds.COLOR_BUFFER_BIT));const c=t.type===ln.ColorNoRasterImage?uw.ExcludeRasterImage:t.type===ln.Occluded?uw.OccludedOnly:uw.Normal;if(c===uw.OccludedOnly&&(this._renderContext.renderOccludedMask=HV),hi.OVERLAY_DRAW_DEBUG_TEXTURE&&c!==uw.OccludedOnly)for(let d=0;d<i.numViews;d++)this._setViewParameters(i.extents[d],e,O2),this._drawDebugTexture(e.resolution,Rxt[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:d,renderer:p})=>{if(c===uw.ExcludeRasterImage&&d.drapeSourceType===aL.RasterImage)return;const{fullOpacity:f}=d,m=v(f)&&f<1&&s===V.Color;m&&(this.bindTemporaryFramebuffer(this._rctx,o,a),l.clearSafe(ds.COLOR_BUFFER_BIT));for(let g=0;g<i.numViews;g++)this._setViewParameters(i.extents[g],e,O2),p.render(this._renderContext,this._bindParameters);m&&v(this._temporaryFBO)&&(n.bind(l),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),f,e.index))}),l.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,r){C(this._temporaryFBO)&&(this._temporaryFBO=new xFe(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){var n,o;let s=0;for(const a of this._renderers.values())s=(o=(n=a.intersect)==null?void 0:n.call(a,e,t,r,i,s))!=null?o:s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((t,r)=>{const i=e.indexOf(r.layer);this._sortedRenderers.push(new Mxt(r,t,i<0?1/0:i))}),this._sortedRenderers.sort((t,r)=>t.index-r.index)}_setViewParameters(e,t,r){r.viewport[0]=r.viewport[1]=0,r.viewport[2]=r.viewport[3]=t.resolution,qoe(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),Rj(r.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=r}_updateHasWater(){const e=wo(this._renderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=wo(this._renderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=wo(this._renderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e,t);const r=this._rctx;r.bindTechnique(this._debugTextureTechnique,this._passParameters,null),r.bindVAO(this._quadVAO),r.drawArrays(Ut.TRIANGLE_STRIP,0,da(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t,r){if(ue(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*t*4);let s=0;for(let o=0;o<t;o++)for(let a=0;a<e;a++){const l=Math.floor(a/10),c=Math.floor(o/10);l<2||c<2||10*l>e-20||10*c>t-20?(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=255):(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=1&l&&1&c?1&a^1&o?0:255:1&l^1&c?0:128)}this._passParameters.texture=new dt(this._rctx,{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.NEAREST,width:e,height:t},i);const n=new Ice;n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(x4,n),this._quadVAO=Zl(this._rctx)}get test(){return{drapeSourceRenderers:this._renderers,getDrapeSourceRenderer:e=>this._renderers.get(e)}}};var uw;u([h()],yy.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([nl()],yy.prototype,"_shaderTechniqueRepository",void 0),u([nl()],yy.prototype,"_stippleTextureRepository",void 0),u([h({constructOnly:!0})],yy.prototype,"view",void 0),u([h()],yy.prototype,"worldToPCSRatio",void 0),u([h()],yy.prototype,"spatialReference",void 0),u([h({type:Boolean,readOnly:!0})],yy.prototype,"updating",null),yy=u([I("esri.views.3d.terrain.OverlayRenderer")],yy),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(uw||(uw={}));class Mxt{constructor(t,r,i){this.drapeSource=t,this.renderer=r,this.index=i}}const Rxt=[[1,.5,.5],[.5,.5,1]],O2=new Li;O2.near=1,O2.far=1e4,O2.relativeElevation=null;const Pce=-2,HV=Rs.OccludeAndTransparent;function $ce(e,t,r,i){const s=v4(e.rings,e.hasZ,O0.CCW_IS_HOLE),n=new Float64Array(s.position.length),o=iFe(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,r,i),a=o!=null;return new Pxt(s.position,n,s4e(s.polygons,s.position,n),i4e(s.outlines,s.position,n),a,o)}function r4e(e,t){const r=v4(e.rings,!1,O0.CCW_IS_HOLE),i=Yi(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3);for(let s=2;s<r.position.length;s+=3)r.position[s]=Pce;return{position:r.position,polygons:s4e(r.polygons,r.position),outlines:i4e(r.outlines,r.position),projectionSuccess:i}}function i4e(e,t,r){return e.filter(({count:i})=>i>1).map(({index:i,count:s})=>{const n=3*i,o=n+3*s;return r?new Ixt(i,s,t.subarray(n,o),r.subarray(n,o)):new n4e(i,s,t.subarray(n,o))})}function s4e(e,t,r){const i=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=l+3*n,d=o.map(p=>p-s);i.push({index:s,count:n,holeIndices:d,pathLengths:a,position:t.subarray(l,c),mapPosition:r?r.subarray(l,c):void 0})}return i}class n4e{constructor(t,r,i){this.index=t,this.count=r,this.position=i}}class Ixt extends n4e{constructor(t,r,i,s){super(t,r,i),this.mapPosition=s}}class Pxt{constructor(t,r,i,s,n,o){this.position=t,this.mapPosition=r,this.polygons=i,this.outlines=s,this.projectionSuccess=n,this.sampledElevation=o}}function o4e(e,t){const r=e.fragment;switch(r.code.add(S`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case js.None:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case js.View:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case js.WindingOrder:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case js.COUNT:}}var js;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(js||(js={}));function a4e(e){e.vertex.code.add(S`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}class $xt extends Yl{constructor(){super(...arguments),this.instancedDoublePrecision=!1}}function l4e(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(M.MODELORIGINHI,"vec3"),e.attributes.add(M.MODELORIGINLO,"vec3"),e.attributes.add(M.MODEL,"mat3"),e.attributes.add(M.MODELNORMAL,"mat3"));const r=e.vertex;t.instancedDoublePrecision&&(r.include(mV,t),r.uniforms.add(new Hh("viewOriginHi",(i,s)=>Qmt(ue(eU,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),eU))),r.uniforms.add(new Hh("viewOriginLo",(i,s)=>egt(ue(eU,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),eU)))),r.code.add(S`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(S`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?S`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(S`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===V.Normal&&(nI(r),r.code.add(S`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&r.code.add(S`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}u([j()],$xt.prototype,"instancedDoublePrecision",void 0);const eU=$();function c4e(e){e.vertex.code.add(S`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${S.int(Gn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${S.int(Gn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${S.int(Gn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${S.int(Gn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function u4e(e,t){t.hasSymbolColors?(e.include(c4e),e.attributes.add(M.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(S`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new w4("colorMixMode",r=>yNe[r.colorMixMode])),e.vertex.code.add(S`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function fC(e,t){t.hasVertexColors?(e.attributes.add(M.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(S`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(S`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(S`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Dxt(e){e.fragment.code.add(S`
    #define discardOrAdjustAlpha(color) { if (color.a < ${S.float(hl)}) { discard; } }
  `)}class H2 extends tn{constructor(t,r){super(t,"float",Ri.Draw,(i,s,n)=>i.setUniform1f(t,r(s,n)))}}function q2(e,t){d4e(e,t,new De("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function Lxt(e,t){d4e(e,t,new H2("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function d4e(e,t,r){const i=e.fragment;switch(t.alphaDiscardMode!==Mi.Mask&&t.alphaDiscardMode!==Mi.MaskBlend||i.uniforms.add(r),t.alphaDiscardMode){case Mi.Blend:return e.include(Dxt);case Mi.Opaque:i.code.add(S`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Mi.Mask:i.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Mi.MaskBlend:e.fragment.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function h4e(e,t){const{vertex:r,fragment:i}=e,s=t.hasModelTransformation;s&&r.uniforms.add(new xs("model",o=>v(o.modelTransformation)?o.modelTransformation:Hn));const n=t.hasColorTexture&&t.alphaDiscardMode!==Mi.Opaque;switch(t.output){case V.Depth:case V.Shadow:case V.ShadowHighlight:case V.ShadowExludeHighlight:case V.ObjectAndLayerIdColor:Dd(r,t),e.include(wu,t),e.include(h0,t),e.include(WM,t),e.include(r1,t),e.include(Rn,t),e.include(L7,t),OE(e),e.varyings.add("depth","float"),n&&i.uniforms.add(new Rt("tex",o=>o.texture)),r.code.add(S`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),e.include(q2,t),i.code.add(S`
          void main(void) {
            discardBySlice(vpos);
            ${n?S`
                    vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${t.output===V.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:S`outputDepth(depth);`}
          }
        `);break;case V.Normal:Dd(r,t),e.include(wu,t),e.include(b4,t),e.include(J7,t),e.include(h0,t),e.include(WM,t),n&&i.uniforms.add(new Rt("tex",o=>o.texture)),e.varyings.add("vPositionView","vec3"),r.code.add(S`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${t.normalType===fs.Attribute?S`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),e.include(Rn,t),e.include(q2,t),i.code.add(S`
          void main() {
            discardBySlice(vpos);
            ${n?S`
                    vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${t.normalType===fs.ScreenDerivative?S`
                vec3 normal = screenDerivativeNormal(vPositionView);`:S`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case V.Highlight:Dd(r,t),e.include(wu,t),e.include(h0,t),e.include(WM,t),n&&i.uniforms.add(new Rt("tex",o=>o.texture)),r.code.add(S`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),e.include(Rn,t),e.include(q2,t),e.include(_1,t),i.code.add(S`
          void main() {
            discardBySlice(vpos);
            ${n?S`
                    vec4 texColor = texture2D(tex, ${t.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function p4e(e,t){const r=e.fragment;if(t.hasVertexTangents?(e.attributes.add(M.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===js.WindingOrder?r.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),r.code.add(S`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==Mn.None){e.include(fle,t);const i=t.supportsTextureAtlas?t.hasWebGL2Context?vi.None:vi.Size:vi.None;r.uniforms.add(t.pbrTextureBindType===Ri.Pass?sg("normalTexture",s=>s.textureNormal,i):ux("normalTexture",s=>s.textureNormal,i)),r.code.add(S`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?S`vtc.size = ${ff(t,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function T4(e,t){const r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add(sg("ssaoTex",(i,s)=>s.ssaoHelper.colorTexture,t.hasWebGL2Context?vi.None:vi.InvSize)),r.constants.add("blurSizePixelsInverse","float",1/z$),r.code.add(S`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${ff(t,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):r.code.add(S`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function S4(e){e.constants.add("ambientBoostFactor","float",SDe)}function HI(e){e.uniforms.add(new De("lightingGlobalFactor",(t,r)=>r.lighting.globalFactor))}function zE(e,t){const r=e.fragment;switch(e.include(T4,t),t.pbrMode!==kt.Disabled&&e.include(Q7,t),e.include(yle,t),e.include(c7),r.code.add(S`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===kt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),S4(r),HI(r),d1(r),r.code.add(S`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?S`normalize(vPosWorld)`:S`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),F0(r),r.code.add(S`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),t.pbrMode){case kt.Disabled:case kt.WaterOnIntegratedMesh:case kt.Water:e.include(lle,t),r.code.add(S`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case kt.Normal:case kt.Schematic:r.code.add(S`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = mainLightDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(S`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?r.uniforms.add(new Mv("hasFillLights",(i,s)=>s.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(S`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add([new De("lightingSpecularStrength",(i,s)=>s.lighting.mainLight.specularStrength),new De("lightingEnvironmentStrength",(i,s)=>s.lighting.mainLight.environmentStrength)]),r.code.add(S`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(S`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===kt.Schematic?S`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:S`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;default:t.pbrMode;case kt.COUNT:}}function Au(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function f4e(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function qB(e,t,r,i,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function Nxt(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:Au,clone:f4e,fromValues:qB,createView:Nxt},Symbol.toStringTag,{value:"Module"}));function Fxt(e){e.vertex.uniforms.add(new U0("colorTextureTransformMatrix",t=>v(t.colorTextureTransformMatrix)?t.colorTextureTransformMatrix:Au())),e.varyings.add("colorUV","vec2"),e.vertex.code.add(S`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function kxt(e){e.vertex.uniforms.add(new U0("normalTextureTransformMatrix",t=>v(t.normalTextureTransformMatrix)?t.normalTextureTransformMatrix:Au())),e.varyings.add("normalUV","vec2"),e.vertex.code.add(S`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Uxt(e){e.vertex.uniforms.add(new U0("emissiveTextureTransformMatrix",t=>v(t.emissiveTextureTransformMatrix)?t.emissiveTextureTransformMatrix:Au())),e.varyings.add("emissiveUV","vec2"),e.vertex.code.add(S`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function Bxt(e){e.vertex.uniforms.add(new U0("occlusionTextureTransformMatrix",t=>v(t.occlusionTextureTransformMatrix)?t.occlusionTextureTransformMatrix:Au())),e.varyings.add("occlusionUV","vec2"),e.vertex.code.add(S`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function zxt(e){e.vertex.uniforms.add(new U0("metallicRoughnessTextureTransformMatrix",t=>v(t.metallicRoughnessTextureTransformMatrix)?t.metallicRoughnessTextureTransformMatrix:Au())),e.varyings.add("metallicRoughnessUV","vec2"),e.vertex.code.add(S`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function oF(e){e.include(k0),e.code.add(S`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${S.int(Gn.Multiply)}) {
        return allMixed;
      }
      if (mode == ${S.int(Gn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(Gn.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${S.int(Gn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(Gn.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Vxt(e){const t=new Qr,{vertex:r,fragment:i,varyings:s}=t;return Dd(r,e),t.include(o4),s.add("vpos","vec3"),t.include(WM,e),t.include(l4e,e),t.include(cNe,e),e.hasColorTextureTransform&&t.include(Fxt),e.output!==V.Color&&e.output!==V.Alpha||(e.hasNormalTextureTransform&&t.include(kxt),e.hasEmissionTextureTransform&&t.include(Uxt),e.hasOcclusionTextureTransform&&t.include(Bxt),e.hasMetallicRoughnessTextureTransform&&t.include(zxt),_g(r,e),t.include(b4,e),t.include(wu,e),e.normalType===fs.Attribute&&e.offsetBackfaces&&t.include(a4e),t.include(p4e,e),t.include(J7,e),e.instancedColor&&t.attributes.add(M.INSTANCECOLOR,"vec4"),s.add("localvpos","vec3"),t.include(h0,e),t.include(UI,e),t.include(u4e,e),t.include(fC,e),r.uniforms.add(new Tr("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),e.hasMultipassTerrain&&s.add("depth","float"),e.hasModelTransformation&&r.uniforms.add(new xs("model",n=>v(n.modelTransformation)?n.modelTransformation:Hn)),r.code.add(S`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${S.float(hl)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===fs.Attribute?S`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===fs.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${e.hasColorTextureTransform?S`forwardColorUV();`:""}
        ${e.hasNormalTextureTransform?S`forwardNormalUV();`:""}
        ${e.hasEmissionTextureTransform?S`forwardEmissiveUV();`:""}
        ${e.hasOcclusionTextureTransform?S`forwardOcclusionUV();`:""}
        ${e.hasMetallicRoughnessTextureTransform?S`forwardMetallicRoughnessUV();`:""}
      }
    `)),e.output===V.Alpha&&(t.include(Rn,e),t.include(q2,e),t.include(rp,e),i.uniforms.add([new De("opacity",n=>n.opacity),new De("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&i.uniforms.add(new Rt("tex",n=>n.texture)),i.include(oF),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?S`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===V.Color&&(t.include(Rn,e),t.include(zE,e),t.include(T4,e),t.include(q2,e),t.include(e.instancedDoublePrecision?K7:BE,e),t.include(rp,e),_g(i,e),i.uniforms.add([r.uniforms.get("localOrigin"),new er("ambient",n=>n.ambient),new er("diffuse",n=>n.diffuse),new De("opacity",n=>n.opacity),new De("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&i.uniforms.add(new Rt("tex",n=>n.texture)),t.include(gle,e),t.include(Q7,e),i.include(oF),t.include(o4e,e),S4(i),HI(i),F0(i),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===fs.ScreenDerivative?S`
                vec3 normal = screenDerivativeNormal(localvpos);`:S`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===kt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${e.receiveShadows?"readShadowMap(vpos, linearDepth)":e.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?S`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:S`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?S`normalize(posWorld);`:S`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?S`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===kt.Normal||e.pbrMode===kt.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?S`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===Ct.Color?S`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(h4e,e),t}const jxt=Object.freeze(Object.defineProperty({__proto__:null,build:Vxt},Symbol.toStringTag,{value:"Module"}));class Gxt extends HFe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Fe(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Xi.Back,this.emissiveFactor=Fe(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Fe(.2,.2,.2),this.diffuse=Fe(.8,.8,.8),this.externalColor=ar(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=$(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Ts(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=SE.Less,this.textureAlphaMode=Mi.Blend,this.textureAlphaCutoff=kV,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Rs.Occlude}}class Hxt extends qFe{constructor(){super(...arguments),this.origin=$(),this.slicePlaneLocalOrigin=this.origin}}class E4 extends li{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2,r.spherical=t.viewingMode===Ye.Global,r.doublePrecisionRequiresObfuscation=a4(t.rctx),r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?Mn.Default:Mn.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(t){return this._initializeProgram(t,E4.shader)}_initializeProgram(t,r){return new ti(t.rctx,r.get().build(this.configuration),Yr)}_convertDepthTestFunction(t){return t===SE.Lequal?rs.LEQUAL:rs.LESS}_makePipeline(t,r){const i=this.configuration,s=t===Ct.NONE,n=t===Ct.FrontFace;return Ht({blending:i.output!==V.Color&&i.output!==V.Alpha||!i.transparent?null:s?qh:v1(t),culling:qxt(i)&&l7(i.cullFace),depthTest:{func:rT(t,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:s||n?i.writeDepth&&$u:null,colorWrite:cr,stencilWrite:i.hasOccludees?M0:null,stencilTest:i.hasOccludees?r?Vx:iT:null,polygonOffset:s||n?null:B7(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}function qxt(e){return e.cullFace!==Xi.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}E4.shader=new ei(jxt,()=>re(()=>import("./DefaultMaterial.glsl.8f82074d.js"),[]));class nr extends aa{constructor(){super(...arguments),this.output=V.Color,this.alphaDiscardMode=Mi.Opaque,this.doubleSidedMode=js.None,this.pbrMode=kt.Disabled,this.cullFace=Xi.None,this.transparencyPassType=Ct.NONE,this.normalType=fs.Attribute,this.textureCoordinateType=Mn.None,this.customDepthTest=SE.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}}u([j({count:V.COUNT})],nr.prototype,"output",void 0),u([j({count:Mi.COUNT})],nr.prototype,"alphaDiscardMode",void 0),u([j({count:js.COUNT})],nr.prototype,"doubleSidedMode",void 0),u([j({count:kt.COUNT})],nr.prototype,"pbrMode",void 0),u([j({count:Xi.COUNT})],nr.prototype,"cullFace",void 0),u([j({count:Ct.COUNT})],nr.prototype,"transparencyPassType",void 0),u([j({count:fs.COUNT})],nr.prototype,"normalType",void 0),u([j({count:Mn.COUNT})],nr.prototype,"textureCoordinateType",void 0),u([j({count:SE.COUNT})],nr.prototype,"customDepthTest",void 0),u([j()],nr.prototype,"spherical",void 0),u([j()],nr.prototype,"hasVertexColors",void 0),u([j()],nr.prototype,"hasSymbolColors",void 0),u([j()],nr.prototype,"hasVerticalOffset",void 0),u([j()],nr.prototype,"hasSlicePlane",void 0),u([j()],nr.prototype,"hasSliceHighlight",void 0),u([j()],nr.prototype,"hasColorTexture",void 0),u([j()],nr.prototype,"hasMetallicRoughnessTexture",void 0),u([j()],nr.prototype,"hasEmissionTexture",void 0),u([j()],nr.prototype,"hasOcclusionTexture",void 0),u([j()],nr.prototype,"hasNormalTexture",void 0),u([j()],nr.prototype,"hasScreenSizePerspective",void 0),u([j()],nr.prototype,"hasVertexTangents",void 0),u([j()],nr.prototype,"hasOccludees",void 0),u([j()],nr.prototype,"hasMultipassTerrain",void 0),u([j()],nr.prototype,"hasModelTransformation",void 0),u([j()],nr.prototype,"offsetBackfaces",void 0),u([j()],nr.prototype,"vvSize",void 0),u([j()],nr.prototype,"vvColor",void 0),u([j()],nr.prototype,"receiveShadows",void 0),u([j()],nr.prototype,"receiveAmbientOcclusion",void 0),u([j()],nr.prototype,"textureAlphaPremultiplied",void 0),u([j()],nr.prototype,"instanced",void 0),u([j()],nr.prototype,"instancedColor",void 0),u([j()],nr.prototype,"objectAndLayerIdColorInstanced",void 0),u([j()],nr.prototype,"instancedDoublePrecision",void 0),u([j()],nr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],nr.prototype,"writeDepth",void 0),u([j()],nr.prototype,"transparent",void 0),u([j()],nr.prototype,"enableOffset",void 0),u([j()],nr.prototype,"cullAboveGround",void 0),u([j()],nr.prototype,"snowCover",void 0),u([j()],nr.prototype,"hasColorTextureTransform",void 0),u([j()],nr.prototype,"hasEmissionTextureTransform",void 0),u([j()],nr.prototype,"hasNormalTextureTransform",void 0),u([j()],nr.prototype,"hasOcclusionTextureTransform",void 0),u([j()],nr.prototype,"hasMetallicRoughnessTextureTransform",void 0),u([j({constValue:!0})],nr.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],nr.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],nr.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!0})],nr.prototype,"useFillLights",void 0);function Wxt(e){const t=new Qr,{vertex:r,fragment:i,varyings:s}=t;return Dd(r,e),t.include(o4),s.add("vpos","vec3"),t.include(WM,e),t.include(l4e,e),t.include(cNe,e),e.output!==V.Color&&e.output!==V.Alpha||(_g(t.vertex,e),t.include(b4,e),t.include(wu,e),e.offsetBackfaces&&t.include(a4e),e.instancedColor&&t.attributes.add(M.INSTANCECOLOR,"vec4"),s.add("vNormalWorld","vec3"),s.add("localvpos","vec3"),e.hasMultipassTerrain&&s.add("depth","float"),t.include(h0,e),t.include(UI,e),t.include(u4e,e),t.include(fC,e),r.uniforms.add(new Tr("externalColor",n=>n.externalColor)),s.add("vcolorExt","vec4"),r.code.add(S`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${S.float(hl)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?S`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===V.Alpha&&(t.include(Rn,e),t.include(q2,e),t.include(rp,e),i.uniforms.add([new De("opacity",n=>n.opacity),new De("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&i.uniforms.add(new Rt("tex",n=>n.texture)),i.include(oF),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?S`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===V.Color&&(t.include(Rn,e),t.include(zE,e),t.include(T4,e),t.include(q2,e),t.include(e.instancedDoublePrecision?K7:BE,e),t.include(rp,e),_g(t.fragment,e),d1(i),S4(i),HI(i),i.uniforms.add([r.uniforms.get("localOrigin"),r.uniforms.get("view"),new er("ambient",n=>n.ambient),new er("diffuse",n=>n.diffuse),new De("opacity",n=>n.opacity),new De("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&i.uniforms.add(new Rt("tex",n=>n.texture)),t.include(gle,e),t.include(Q7,e),i.include(oF),t.extensions.add("GL_OES_standard_derivatives"),F0(i),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, ${e.hasColorTextureTransform?S`colorUV`:S`vuv0`});
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===kt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?S`albedo = mix(albedo, vec3(1), 0.9);`:S``}
        ${S`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${e.pbrMode===kt.Normal||e.pbrMode===kt.Schematic?e.spherical?S`vec3 normalGround = normalize(vpos + localOrigin);`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:S``}
        ${e.pbrMode===kt.Normal||e.pbrMode===kt.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${e.snowCover?S`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===Ct.Color?S`gl_FragColor = premultiplyAlpha(gl_FragColor);`:S``}
      }
    `)),t.include(h4e,e),t}const Xxt=Object.freeze(Object.defineProperty({__proto__:null,build:Wxt},Symbol.toStringTag,{value:"Module"}));class nG extends E4{initializeConfiguration(t,r){super.initializeConfiguration(t,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=fs.Attribute,r.doubleSidedMode=js.WindingOrder,r.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,nG.shader)}}nG.shader=new ei(Xxt,()=>re(()=>import("./RealisticTree.glsl.1fb8ee60.js"),[]));class VE extends z0{constructor(t){super(t,Jxt),this.supportsEdges=!0,this._configuration=new nr,this._vertexBufferLayout=Qxt(this.parameters),this._instanceBufferLayout=t.instanced?m4e(this.parameters):null}isVisibleForOutput(t){return t!==V.Shadow&&t!==V.ShadowExludeHighlight&&t!==V.ShadowHighlight||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:r,hasVertexColors:i,hasSymbolColors:s,vvColorEnabled:n}=t,o=v(r)&&r.includes("color"),a=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return i&&(o||n||s)?!!a||l:i?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(t,r){return this._configuration.output=t,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=!!this.parameters.instanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.hasVerticalOffset=v(this.parameters.verticalOffset),this._configuration.hasScreenSizePerspective=v(this.parameters.screenSizePerspective),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normals==="screenDerivative"?fs.ScreenDerivative:fs.Attribute,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,v(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Xi.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=v(this.parameters.modelTransformation),t!==V.Color&&t!==V.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=js.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?js.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?js.WindingOrder:js.None,this._configuration.instancedColor=v(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.ready&&this.parameters.receiveSSAO,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?kt.Schematic:kt.Normal:kt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<k7,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(t){return v(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,r,i,s,n,o,a){if(v(this.parameters.verticalOffset)){const l=s.camera;ue(MX,i[12],i[13],i[14]);let c=null;switch(s.viewingMode){case Ye.Global:c=xe(mve,MX);break;case Ye.Local:c=le(mve,rTt)}let d=0;const p=ge(iTt,MX,l.eye),f=Ie(p),m=de(p,p,1/f);let g=null;this.parameters.screenSizePerspective&&(g=Te(c,m)),d+=mNe(l,f,this.parameters.verticalOffset,g,this.parameters.screenSizePerspective),de(c,c,d),Td(OX,c,s.transform.inverseRotation),n=ge(eTt,n,OX),o=ge(tTt,o,OX)}P7(t,r,s,n,o,Qte(s.verticalOffset),a)}requiresSlot(t,r){return r===V.Color||r===V.Alpha||r===V.Depth||r===V.Normal||r===V.Shadow||r===V.ShadowHighlight||r===V.ShadowExludeHighlight||r===V.Highlight||r===V.ObjectAndLayerIdColor?t===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL)||t===Ee.DRAPED_MATERIAL||r===V.ObjectAndLayerIdColor:!1}createGLMaterial(t){return new Yxt(t)}createBufferWriter(){return new Kxt(this._vertexBufferLayout,this._instanceBufferLayout)}}class Yxt extends mle{constructor(t){super({...t,...t.material.parameters})}_updateParameters(t){const r=this._material.parameters;this.updateTexture(r.textureId);const i=t.camera.viewInverseTransposeMatrix;return ue(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?nG:E4,t)}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==V.Color&&this._output!==V.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this._updateParameters(t)}}class Zxt extends Gxt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const Jxt=new Zxt;class Kxt{constructor(t,r){this.vertexBufferLayout=t,this.instanceBufferLayout=r}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(M.POSITION).length}write(t,r,i,s,n){D7(i,this.vertexBufferLayout,t,r,s,n)}}function Qxt(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,r=Ds().vec3f(M.POSITION).vec3f(M.NORMAL);return e.hasVertexTangents&&r.vec4f(M.TANGENT),t&&r.vec2f(M.UV0),e.hasVertexColors&&r.vec4u8(M.COLOR),e.hasSymbolColors&&r.vec4u8(M.SYMBOLCOLOR),pe("enable-feature:objectAndLayerId-rendering")&&r.vec4u8(M.OBJECTANDLAYERIDCOLOR),r}function m4e(e){let t=Ds();return t=e.instancedDoublePrecision?t.vec3f(M.MODELORIGINHI).vec3f(M.MODELORIGINLO).mat3f(M.MODEL).mat3f(M.MODELNORMAL):t.mat4f(M.MODEL).mat4f(M.MODELNORMAL),v(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(M.INSTANCECOLOR)),v(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(M.INSTANCEFEATUREATTRIBUTE)),v(e.instanced)&&e.instanced.includes("objectAndLayerIdColor")&&(t=t.vec4u8(M.OBJECTANDLAYERIDCOLOR_INSTANCED)),t}const eTt=$(),tTt=$(),rTt=Fe(0,0,1),mve=$(),OX=$(),MX=$(),iTt=$(),sTt=["polygon","extent"];class nTt extends j0{constructor(t,r,i,s){super(t,r,i,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=V7(this._getSymbolSize());if(a)throw new z("graphics3dextrudesymbollayer:invalid-size",a)}const t=Ks(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(t),i=pu(r),s=r[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:s,transparent:n,cullFace:n?Xi.None:Xi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new VE(o),this._bottomMaterial=new VE({...o,cullFace:Xi.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,sTt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(r,new op);return this._createAs3DShape(r,t.renderingInfo,i,s,r.uid)}layerOpacityChanged(t,r){const i=Ks(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(i),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();t.forEach(a=>{const l=r(a);v(l)&&l.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Bx)}slicePlaneEnabledChanged(t,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(i=>{const s=r(i);v(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(t){var i;let r;return r=t.size&&this._drivenProperties.size?(i=zbt(t.size,2))!=null?i:0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(t,r){return this._drivenPropertiesChanged(r)?To.Recreate_Symbol:To.Recreate_Graphics}async queryForSnapping(t,r,i,s){var c,d,p;const n=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/_E(r),{objectId:o,target:a}=t,l=ne(a);switch(l.z=((c=l.z)!=null?c:0)+n,t.type){case"edge":{const{start:f,end:m}=t,g=ne(f),_=ne(m);return g.z=((d=g.z)!=null?d:0)+n,_.z=((p=_.z)!=null?p:0)+n,[$_e(o,l,1/0,g,_)]}case"vertex":return[kbt(o,l,1/0),$_e(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,r,i,s,n){const o=iF(t.geometry);if(C(o))return null;if(o.rings.length===0||!o.rings.some(se=>se.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=$ce(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=pce(o);if(C(l))return null;const c=new Array,d=new Array,p=new Array,f=ao(),m=$e(),g=$(),_=this._context.renderCoordsHelper.viewingMode===Ye.Global;_||this._context.renderCoordsHelper.worldUpAtPosition(null,g),Qh(o.spatialReference,[l.x,l.y,0],m,this._context.renderCoordsHelper.spatialReference);const x=$e();Pn(x,m);const b=Ts();FR(b,x);const{polygons:w,mapPosition:T,position:E}=a,O=E.length/3,A=new Float64Array(3*O*6),R=new Float64Array(3*O*6),D=new Float64Array(3*O*6),k=new Float64Array(1*O*6);let L=0;for(let se=0;se<w.length;++se){const X=w[se],F=X.count;if(this._context.clippingExtent&&(es(f),Uh(f,X.mapPosition),!Hm(f,this._context.clippingExtent)))continue;const N=cI(X.mapPosition,X.holeIndices,3);if(N.length===0)continue;const B=3*F*2+N.length,H=new Array(B),W=new Array(N.length),K=6*F,Y=3*A.BYTES_PER_ELEMENT,ce=new qn(A.buffer,L*Y,Y,(L+K)*Y),we=3*R.BYTES_PER_ELEMENT,Oe=new qn(R.buffer,L*we,we,(L+K)*we),Be=new Float64Array(D.buffer,3*L*D.BYTES_PER_ELEMENT,3*K),He=new Float64Array(k.buffer,1*L*k.BYTES_PER_ELEMENT,1*K),Se=this._getExtrusionSize(r);oTt(E,T,N,X,ce.typedBuffer,Be,Oe.typedBuffer,He,H,W,Se,g,_),_4(ce,ce,x),zx(Oe,Oe,b),L+=6*F;const he=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),Me=gve(H,H.length-W.length,{positions:ce.typedBuffer,elevation:Be,normals:Oe.typedBuffer,heights:He},i,he);c.push(Me),d.push(this._material),p.push(Hn);const Xt=gve(W,0,{positions:ce.typedBuffer,elevation:Be,normals:Oe.typedBuffer,heights:He},i,he);c.push(Xt),d.push(this._bottomMaterial),p.push(Hn)}if(c.length===0)return null;const q=new w1({geometries:c,materials:d,transformations:p,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});q.transformation=m;const G=nPe(this.symbolLayer,{opacity:this._getLayerOpacity()}),J=v(G)?{baseMaterial:this._material,edgeMaterials:[G],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,ee=new V0(this,q,c,null,null,cTt,s,J);return ee.alignedSampledElevation=a.sampledElevation,ee.needsElevationUpdates=Bx(s.mode),ee}}function gve(e,t,r,i,s){const n=new Array(e.length).fill(0),o=[[M.POSITION,{size:3,data:r.positions,exclusive:!0}],[M.NORMAL,{size:3,data:r.normals,exclusive:!0}],[M.COLOR,{size:4,data:i,exclusive:!0}],[M.SIZE,{size:1,data:r.heights,exclusive:!0}]],a=[[M.POSITION,e],[M.NORMAL,e],[M.COLOR,n]];return r.elevation&&(o.push([M.MAPPOS,{size:3,data:r.elevation}]),a.push([M.MAPPOS,e])),new mn(o,a,Bl.Triangle,s,t)}function oTt(e,t,r,i,s,n,o,a,l,c,d,p,f){const m=r.length/3;let g=0,_=2*i.count;aTt(e,t,i.index,i.count,r,0,m,s,n,o,a,l,c,_,d,p,f);let x=2*i.count;_=0,yve(s,n,a,o,g,i.pathLengths[0],i.count,x,l,_,d),x+=4*i.pathLengths[0],_+=2*i.pathLengths[0],g+=i.pathLengths[0];for(let b=1;b<i.pathLengths.length;++b)yve(s,n,a,o,g,i.pathLengths[b],i.count,x,l,_,d),x+=4*i.pathLengths[b],_+=2*i.pathLengths[b],g+=i.pathLengths[b]}function aTt(e,t,r,i,s,n,o,a,l,c,d,p,f,m,g,_,x){le(Xc,_);const b=g>0?1:-1;let w=3*r,T=0,E=3*T,O=i,A=3*O;for(let k=0;k<i;++k)x&&(Xc[0]=e[w+0],Xc[1]=e[w+1],Xc[2]=e[w+2],xe(Xc,Xc)),a[E+0]=e[w+0],a[E+1]=e[w+1],a[E+2]=e[w+2],l[E+0]=t[w+0],l[E+1]=t[w+1],l[E+2]=t[w+2],c[E+0]=-b*Xc[0],c[E+1]=-b*Xc[1],c[E+2]=-b*Xc[2],d[T]=0,a[A+0]=e[w+0]+g*Xc[0],a[A+1]=e[w+1]+g*Xc[1],a[A+2]=e[w+2]+g*Xc[2],l[A+0]=t[w+0],l[A+1]=t[w+1],l[A+2]=t[w+2],c[A+0]=b*Xc[0],c[A+1]=b*Xc[1],c[A+2]=b*Xc[2],d[O]=g,E+=3,A+=3,w+=3,T+=1,O+=1;w=3*n,E=0,A=3*m;const R=g<0?Tve:xve,D=g<0?xve:Tve;for(let k=0;k<o;++k)f[E+0]=s[w+R[0]],f[E+1]=s[w+R[1]],f[E+2]=s[w+R[2]],p[A+0]=s[w+D[0]]+i,p[A+1]=s[w+D[1]]+i,p[A+2]=s[w+D[2]]+i,E+=3,A+=3,w+=3}function tU(e,t,r,i,s,n,o){i[n]=i[o],o*=3,e[(n*=3)+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],r[n+0]=s[0],r[n+1]=s[1],r[n+2]=s[2]}const YP=$();function yve(e,t,r,i,s,n,o,a,l,c,d){let p=s,f=s+1,m=s+o,g=s+o+1,_=a,x=a+1,b=a+2*n,w=a+2*n+1;d<0&&(p=s+o+1,g=s),c*=3;for(let T=0;T<n;++T)T===n-1&&(d>0?(f=s,g=s+o):(f=s,p=s+o)),lTt(e,p,f,m,YP),tU(e,t,i,r,YP,_,p),tU(e,t,i,r,YP,x,f),tU(e,t,i,r,YP,b,m),tU(e,t,i,r,YP,w,g),l[c++]=_,l[c++]=b,l[c++]=w,l[c++]=_,l[c++]=w,l[c++]=x,p++,f++,m++,g++,_+=2,x+=2,b+=2,w+=2}const RX=$(),_ve=$(),vve=$(),bve=$(),wve=$();function lTt(e,t,r,i,s){t*=3,r*=3,i*=3,ue(RX,e[t++],e[t++],e[t++]),ue(_ve,e[r++],e[r++],e[r++]),ue(vve,e[i++],e[i++],e[i++]),ge(bve,_ve,RX),ge(wve,vve,RX),At(s,wve,bve),xe(s,s)}const KC=$();function cTt(e,t,r,i){const s=e.stageObject,n=s.geometryRecords,o=n.length,a=t.mode!=="absolute-height";let l=0;const c=s.transformation,d=Pn($e(),c);for(let p=0;p<o;p+=2){const f=n[p].geometry,m=f.getMutableAttribute(M.POSITION).data,g=f.vertexAttributes.get(M.SIZE).data,_=f.vertexAttributes.get(M.MAPPOS).data,x=new RLe(_),b=m.length/3;let w=0,T=!1,E=0;const O=r.spatialReference;for(let A=0;A<b;A++){KC[0]=m[w],KC[1]=m[w+1],KC[2]=m[w+2],t1(x,r,t,i,rU),a&&(E+=rU.sampledElevation),hi.TESTS_DISABLE_OPTIMIZATIONS?(ue(zu,x.array[x.offset+0],x.array[x.offset+1],rU.z+g[w/3]),v(O)&&i.toRenderCoords(zu,O,zu),je(zu,zu,d)):(ue(zu,m[w+0],m[w+1],m[w+2]),je(zu,zu,c),i.setAltitude(zu,rU.z+g[w/3]),je(zu,zu,d)),m[w]=zu[0],m[w+1]=zu[1],m[w+2]=zu[2];const R=uTt/i.unitInMeters;(Math.abs(KC[0]-m[w])>=R||Math.abs(KC[1]-m[w+1])>=R||Math.abs(KC[2]-m[w+2])>=R)&&(T=!0),x.offset+=3,w+=3}T&&(f.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p]),n[p+1].geometry.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p+1])),l+=E/b}return l/o}const zu=$(),Xc=$(),rU=new y4,xve=[0,2,1],Tve=[0,1,2],uTt=.01;function dTt(e,t,r,i,s){if(C(e))return null;const n=e.referencesGeometry()&&s?hTt(t,i,s):t,o=e.repurposeFeature(n);try{return e.evaluate({...r,$feature:o})}catch(a){return te.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const IX=new Map;function hTt(e,t,r){const{transform:i,hasZ:s,hasM:n}=r;IX.has(t)||IX.set(t,pTt(t));const o=IX.get(t)(e.geometry,i,s,n);return{...e,geometry:o}}function pTt(e){const t={};switch(e){case"esriGeometryPoint":return(r,i,s,n)=>WNe(i,t,r,s,n);case"esriGeometryPolygon":return(r,i,s,n)=>XNe(i,t,r,s,n);case"esriGeometryPolyline":return(r,i,s,n)=>YNe(i,t,r,s,n);case"esriGeometryMultipoint":return(r,i,s,n)=>qNe(i,t,r,s,n);default:return te.getLogger("esri.views.2d.support.arcadeOnDemand").error(new z("mapview-arcade",`Unable to handle geometryType: ${e}`)),r=>r}}const G8t=1.2,fTt=u0;class oG{constructor(t,r,i,s){this.graphics3DSymbolLayer=t,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,ks.ADD);if(t||this._addedToStage){for(const r of this.renderGeometries)r.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,bo.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,ks.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=$()){return ue(t,0,0,0)}getBoundingBoxObjectSpace(t=ao()){return es(t)}addObjectState(t,r){t===Kv.Highlight&&(this.renderGeometries.forEach(i=>{const s=i.addHighlight();r.addRenderGeometry(i,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,bo.HIGHLIGHTS))}removeObjectState(t){this.renderGeometries.forEach(r=>{t.removeRenderGeometry(r)})}removeRenderGeometryObjectState(t,r){t.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,bo.HIGHLIGHTS)}computeAttachmentOrigin(t){for(const r of this.renderGeometries)r.computeAttachmentOrigin(QC)&&(t.draped.origin[0]+=QC[0],t.draped.origin[1]+=QC[1],t.draped.num++)}async getProjectedBoundingBox(t,r,i,s,n){es(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,Sve,i),EZe(n,Sve)}if(r){let o;Gm(n,QC);const a=fce(n,r.service.spatialReference,r);try{o=await r.service.queryElevation(QC[0],QC[1],s,a,"ground")}catch{}v(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,r,i,s){if(this.boundingBox)cj(Bg,this.boundingBox);else{const n=t.boundingSphere,o=n[3];Bg[0]=n[0]-o,Bg[1]=n[1]-o,Bg[2]=n[2]-o,Bg[3]=n[0]+o,Bg[4]=n[1]+o,Bg[5]=n[2]+o}return r(Bg,0,2),this.calculateRelativeScreenBounds&&s.push({location:Gm(Bg),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),_oe(Bg,i)}}const Sve=tr(),Bg=ao(),QC=$();class g4e{constructor(t,r,i,s=2048){this.text=t,this._alignment=r,this._parameters=i,this._maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this._backgroundHorizontalPadding)}get displayHeight(){const t=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(t+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _heightMetrics(){return this._ensureHeightMetrics()}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._heightMetrics.lineHeight}get _linePadding(){return this._lineHeight*mTt}get _baselinePosition(){return this._heightMetrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._heightMetrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._heightMetrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(C(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case hx.Left:return this._backgroundHorizontalPadding;case hx.Center:return(this.displayWidth-this._lineWidths[t])/2;case hx.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[t]}}render(t,r=0,i=0){t.save();const s=r/=this.renderPixelRatio,n=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const d=this._lines[c],p=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,d,r+p,i),this._renderLineDecoration(t,r+p,i,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,d,r+this._getLineXOffset(c),i),this._renderLineDecoration(t,r+p,i,this._textWidths[c]),i+=this._lineSpacing}if(hi.TEXT_SHOW_BASELINE){t.strokeStyle=Eve,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let d=0;d<this._lines.length;++d){const p=c+this._baselinePosition;this._drawLine(t,[s,p],[s+this.displayWidth,p]),c+=this._lineSpacing}}if(hi.TEXT_SHOW_BORDER&&(t.strokeStyle=Eve,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,r,i,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=n?this._haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),t.lineTo(this._toRenderUnit(r+s+l),this._toRenderUnit(i)),t.stroke()}_roundedRect(t,r,i,s){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=_e(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(r,i+s),t.arcTo(r,i,r+s,i,s),t.lineTo(r+n-s,i),t.arcTo(r+n,i,r+n,i+s,s),t.lineTo(r+n,i+o-s),t.arcTo(r+n,i+o,r+n-s,i+o,s),t.lineTo(r+s,i+o),t.arcTo(r,i+o,r,i+o-s,s),t.closePath()):t.rect(r,i,n,o)}_renderHalo(t,r,i,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=WB(PX,Math.max(o,eA),Math.max(a,eA)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const d=this._renderedHaloSize<3;c.lineJoin=d?"miter":"round",d?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this._lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),t.globalAlpha=1}_renderHaloEmulated(t,r,i){i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of y4e)this._fillText(t,n,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(t,r,i){const s=2*this._haloSize;i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let d=0;d<l;d++){const p=1-(l-1)*c+d*c;t.lineWidth=this._toRenderUnit(p*s),this._strokeText(t,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(t,r){t.font=this._parameters.fontString(r),t.textAlign="left",t.textBaseline="alphabetic"}_ensureTextWidth(){if(v(this._displayWidth))return this._displayWidth;const t=WB(PX,eA,eA).getContext("2d");this._setFontProperties(t,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0;for(const n of this._lines){const o=t.measureText(n).width,a=o+r;this._textWidths.push(o),this._lineWidths.push(a),s=Math.max(s,a)}return this._displayWidth=s,this._displayWidth}_ensureHeightMetrics(){if(C(this._heightMetricsCached)){const t=WB(PX,eA,eA).getContext("2d");this._setFontProperties(t,this._fontSize);const r=t.measureText(this.text+gTt),i=this._hasBackground?t.measureText(this._lines[0]):r,s=this._lines.length===1?i:this._hasBackground?t.measureText(this._lines[this._lines.length-1]):r,n=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent;this._heightMetricsCached={paddingTop:r.actualBoundingBoxAscent-i.actualBoundingBoxAscent,paddingBottom:r.actualBoundingBoxDescent-s.actualBoundingBoxDescent,lineHeight:n,baselinePosition:r.actualBoundingBoxAscent}}return this._heightMetricsCached}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,r,i,s){t.fillText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_strokeText(t,r,i,s){t.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(s))}_drawLine(t,r,i){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.stroke()}_drawBox(t,r,i){const s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,d=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,d),t.lineTo(c,d),t.lineTo(c,p),t.lineTo(l,p),t.lineTo(l,d),t.stroke()}}const y4e=[];for(let t=0;t<360;t+=360/16)y4e.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var hx;function WB(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(hx||(hx={}));const PX={canvas:null},mTt=.2,eA=512,Eve="rgb(255, 0, 255, 0.5)",gTt=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),yTt=Object.freeze({left:0,center:.5,right:1}),XB=Object.freeze({"bottom-left":pi(0,0),bottom:pi(.5,0),"bottom-right":pi(1,0),left:pi(0,.5),center:pi(.5,.5),right:pi(1,.5),"top-left":pi(0,1),top:pi(.5,1),"top-right":pi(1,1)});function _4e(e){switch(e){case"left":return hx.Left;case"right":return hx.Right;default:return hx.Center}}function Cve(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function _Tt(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function vTt(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function bTt(e){return e==="middle"?"center":e}var Pl,Ave,qV;function ZP(e){return e!=null}function tA(e){return typeof e=="number"}function aG(e){return typeof e=="string"}function wTt(e){return e==null||aG(e)}function xo(e,t){e&&e.push(t)}function xTt(e,t,r,i=$e()){const s=e||0,n=t||0,o=r||0;return s!==0&&DR(i,i,-s/180*Math.PI),n!==0&&$R(i,i,n/180*Math.PI),o!==0&&Mj(i,i,o/180*Math.PI),i}function J1(e,t,r,i,s){const n=e.minSize,o=e.maxSize;if(e.expression)return xo(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=i.symbolSize[r];return t.minSize[r]=a,t.maxSize[r]=a,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=Pl.DefinedSize,!0}if(ZP(e.field))return ZP(e.stops)?e.stops.length===2&&tA(e.stops[0].size)&&tA(e.stops[1].size)?(Ove(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=Pl.DefinedSize,!0):(xo(s,"Could not convert size info: stops only supported with 2 elements"),!1):tA(n)&&tA(o)&&ZP(e.minDataValue)&&ZP(e.maxDataValue)?(Ove(n,o,e.minDataValue,e.maxDataValue,t,r),t.type[r]=Pl.DefinedSize,!0):MR[e.valueUnit]!=null?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/MR[e.valueUnit],t.type[r]=Pl.DefinedSize,!0):e.valueUnit==="unknown"?(xo(s,"Could not convert size info: proportional size not supported"),!1):(xo(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!ZP(e.field)){if(e.stops&&e.stops[0]&&tA(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=Pl.DefinedSize,!0;if(tA(n))return t.minSize[r]=n,t.maxSize[r]=n,t.offset[r]=n,t.factor[r]=0,t.type[r]=Pl.DefinedSize,!0}return xo(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Ove(e,t,r,i,s,n){const o=Math.abs(i-r)>0?(t-e)/(i-r):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-r*o,s.factor[n]=o}function TTt(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return xo(i,"Could not convert size info: unsupported property"),null;if(!wTt(e.field))return xo(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return xo(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[Pl.Undefined,Pl.Undefined,Pl.Undefined]};let s;switch(e.axis){case"width":return s=J1(e,t.size,0,r,i),s?t:null;case"height":return s=J1(e,t.size,2,r,i),s?t:null;case"depth":return s=J1(e,t.size,1,r,i),s?t:null;case"width-and-depth":return s=J1(e,t.size,0,r,i),s&&J1(e,t.size,1,r,i),s?t:null;case null:case void 0:case"all":return s=J1(e,t.size,0,r,i),s=s&&J1(e,t.size,1,r,i),s=s&&J1(e,t.size,2,r,i),s?t:null;default:return xo(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}function STt(e,t,r){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===Pl.DefinedSize&&(n*=t.modelSize[s],e.type[s]=Pl.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let i;if(e.type[0]!==Pl.Undefined)i=0;else if(e.type[1]!==Pl.Undefined)i=1;else{if(e.type[2]===Pl.Undefined)return xo(r,"No size axis contains a valid size or scale"),!1;i=2}for(let s=0;s<3;++s)e.type[s]===Pl.Undefined&&(e.minSize[s]=e.minSize[i],e.maxSize[s]=e.maxSize[i],e.offset[s]=e.offset[i],e.factor[s]=e.factor[i],e.type[s]=e.type[i]);return!0}function Mve(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function ETt(e,t,r){if(e.normalizationField)return xo(r,"Could not convert color info: unsupported property"),null;if(aG(e.field)){if(!e.stops)return xo(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return xo(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=e.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];t.color.values[s]=n.value,Mve(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return xo(r,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,Mve(t.color.colors,s,i)}}return t}function CTt(e,t,r){if(e.normalizationField)return xo(r,"Could not convert opacity info: unsupported property"),null;if(aG(e.field)){if(!e.stops)return xo(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return xo(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=e.stops;for(let s=0;s<8;++s){const n=i[Math.min(s,i.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return xo(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=i}}return t}function $X(e,t,r){const i=r===2&&e.rotationType==="arithmetic";t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function ATt(e,t,r){if(!aG(e.field))return xo(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return xo(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return $X(e,t.rotation,0),t;case"roll":return $X(e,t.rotation,1),t;case null:case void 0:case"heading":return $X(e,t.rotation,2),t;default:return xo(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function v4e(e,t,r){if(!e)return null;const i=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return xo(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return i?TTt(c,l,t,r):l;case"color":return s?ETt(c,l,r):l;case"opacity":return o?CTt(c,l,r):null;case"rotation":return n?ATt(c,l,r):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!STt(a.size,t,r)?null:a:null}function Dce(e){return e&&e.size!=null}function aF(e,t){if(!e)return{enabled:!1};if(hi.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const r=v4e(e.visualVariables,t);return r?{enabled:!0,visualVariables:r,materialParameters:b4e(r,t),requiresShaderTransformation:Dce(r)}:{enabled:!1}}function lF(e,t,r){if(!t||!e.enabled)return!1;const i=e.visualVariables,s=v4e(t.visualVariables,r);return!!s&&!!(iU(i.size,s.size,"size")&&iU(i.color,s.color,"color")&&iU(i.rotation,s.rotation,"rotation")&&iU(i.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=b4e(s,r),e.requiresShaderTransformation=Dce(s),!0)}function iU(e,t,r){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&r==="rotation"){const i=e,s=t;for(let n=0;n<3;n++)if(i.type[n]!==s.type[n]||i.offset[n]!==s.offset[n]||i.factor[n]!==s.factor[n])return!1}return!0}function b4e(e,t){const r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},i=Dce(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&i&&(r.vvSizeValue=t.transformation.scale),e&&i&&(r.vvSymbolAnchor=t.transformation.anchor,r.vvSymbolRotationMatrix=Ts(),fg(uL),xTt(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],uL),Tf(r.vvSymbolRotationMatrix,uL)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(Pl||(Pl={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(Ave||(Ave={})),function(e){const t=$e(),r=$();function i(n,o,a){if(!n.vvSizeEnabled)return a;jn(t,a);const l=n.vvSymbolRotationMatrix;N0(uL,l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1),Hs(t,t,uL);for(let c=0;c<3;++c){const d=n.vvSizeOffset[c]+o[0]*n.vvSizeFactor[c];r[c]=_e(d,n.vvSizeMinSize[c],n.vvSizeMaxSize[c])}return Oj(t,t,r),Pu(t,t,n.vvSymbolAnchor),t}function s(n,o,a){if(!o.vvSizeEnabled)return ue(n,1,1,1);for(let l=0;l<3;++l){const c=o.vvSizeOffset[l]+a[0]*o.vvSizeFactor[l];n[l]=_e(c,o.vvSizeMinSize[l],o.vvSizeMaxSize[l])}return n}e.evaluateModelTransform=i,e.evaluateModelTransformScale=s}(qV||(qV={}));const uL=$e(),Ore=qV.evaluateModelTransform,OTt=qV.evaluateModelTransformScale;class MTt{constructor(){this.visible=!0}}class hI{constructor(t,r,i={}){this.data=t,this.material=r,this.boundingSphere=Lr(),this.instanceParameters=new MTt,this._transformation=$e(),this._shaderTransformationDirty=!0,this.layerUid=yt(i.layerUid,null),this.graphicUid=yt(i.graphicUid,null),this.id=i.id?i.id:Su(),this.boundingInfo=yt(i.boundingInfo,null),this.calculateShaderTransformation=yt(i.calculateShaderTransformation,null),this.castShadow=!!i.castShadow&&i.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,r,i=xE(t)){C(this.boundingInfo)||(je(r,this.boundingInfo.getCenter(),t),r[3]=this.boundingInfo.getBSRadius()*i)}get hasShaderTransformation(){return v(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return C(this.calculateShaderTransformation)?yt(this.transformation,Hn):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=$e()),jn(this._shaderTransformation,this.calculateShaderTransformation(yt(this.transformation,Hn))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(v(this._transformation)&&je(t,t,this._transformation),!0);const r=this.indices.get(M.POSITION),i=this.vertexAttributes.get(M.POSITION);return!!$De(i,r,t)&&(v(this._transformation)&&je(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new zV(Kv.Highlight),r=this.instanceParameters;return r.highlights=tre(r.highlights,t),t}removeHighlight(t){const r=this.instanceParameters;r.highlights=rre(r.highlights,t)}}const RTt=$e(),Rve=Fe(0,0,1),ITt=16,PTt=1.5,M2=cce,$Tt=[M2/2,M2/2,1-M2/2,1-M2/2],DTt=[QN*M2,QN*M2];class cF extends j0{constructor(t,r,i,s){super(t,r,i,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(t){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(v(i))this._prepareResourcesPrimitive(r,i);else{const s=slt(this.symbol,this.symbolLayer),n=j9(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(n.data),t):await this._prepareResourcesHref(r,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=V7(this._getIconSize());if(t)throw new z("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,r=Math.round(t.size!=null?Ga(t.size):ITt);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(t){const r=this._getGraphicHash(t);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,t,"esriGeometryPoint",s,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:cx.PAD};i=new ka(n.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_computeSize(t,r){const i=t.width/t.height;return i>1?[r,Math.round(r/i)]:[Math.round(r*i),r]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(LTt(r)){const{screenLength:i,minWorldLength:s,maxWorldLength:n}=r.verticalOffset;t.verticalOffset={screenLength:Ga(i),minWorldLength:s||0,maxWorldLength:v(n)?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,r){const i=this._getOutlineSize();if(DX(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,v(this._context.sharedResources.textures)){const n=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>CNe(r));this._texture=n.texture,this._releaseTexture=n,t.textureId=this._texture.id}t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=$Tt;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/M2,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,r,i){if(!pe("esri-canvas-svg-support")&&une(r))throw new z("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.pixelRatio;if(v(this._context.sharedResources.textures)){const o=await Jh(this._context.sharedResources.textures.fromUrl(r,n,{signal:i}));if(o.ok===!1)throw zh(o.error),new z("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),t.textureId=a.id}this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,r,i){const s=new MI({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const d=(await re(()=>import("./CIMSymbolRasterizer.61de1e4b.js"),["assets/CIMSymbolRasterizer.61de1e4b.js","assets/cimAnalyzer.07c3575e.js","assets/BidiEngine.d8bba3fc.js","assets/enums.6b5e3ac2.js","assets/number.30628ef2.js","assets/_commonjsHelpers.773c2c82.js","assets/imageutils.61267202.js","assets/rasterizingUtils.662fbc15.js"])).CIMSymbolRasterizer;Ir(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new d(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(d=>d.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const d=this._context.renderer;if(isNaN(d.scaleExpression)){const p=d.scaleExpression,f=await gYe(p,this._context.layer.spatialReference,n);a=(m,g,_)=>{const x=dTt(f,m,{$view:_},"esriGeometryPoint",g);return x!==null?x:1}}else o=Number(d.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Ir(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(d=>c.get(d).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||jZe}_getOutlineSize(){let t=0;const r=this.symbolLayer;return v(r.outline)&&r.outline.size!=null?Math.max(Ga(r.outline.size),0):(t=DX(this._getPrimitive())?PTt:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),r=this.symbolLayer,i=Ks(r,"outline","color");if(v(i)){const s=Ze.toUnitRGB(i),n=i.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(DX(this._getPrimitive()))return fTt;const t=C(this._getPrimitive()),r=Ks(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:t})}_getAnchorPos(t,r){return t==="relative"?pi((r.x||0)+.5,.5-(r.y||0)):t in XB?XB[t]:XB.center}_createMaterialAndAddToStage(t,r){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=aF(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let i=v(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return i||(i=new aI(t),this._cimSymbolMaterials.set(yt(t.textureId,0),i),r.add(i)),i}return this._material=new aI(t),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=Di(this._releaseTexture)}_getScaleFactor(t,r){if(this._drivenProperties.size&&t.size){for(let i=0;i<3;i++){const s=t.size[i];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[i]=Ga(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/r;if(isFinite(+t.size[2]))return+t.size[2]/r}return 1}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry))return null;let i,s;if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(r),f={textureId:p.id,...this._cimMaterialParametersInfo};s=this._createMaterialAndAddToStage(f,this._context.stage),i=[p.params.width,p.params.height]}else i=this._size,s=this._material;const n=rF(r.geometry);if(C(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=i[0]>i[1]?i[0]:i[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=[i[0]*l,i[1]*l],d=this.setGraphicElevationContext(r,new op);return this.ensureDrapedStatus(d.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,n,s,a,c,t.layer.uid):this._createAs3DShape(r,n,s,a,c,d,r.uid)}layerOpacityChanged(){const t=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:t}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=g4(cF.elevationModeChangeTypes,i,s);if(n!==en.UPDATE)return n;const o=Mf(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!lF(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return To.Recreate_Symbol;v(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return To.Fast_Update}_defaultElevationInfoNoZ(){return NTt}_createAs3DShape(t,r,i,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l?g=>Ore(this._fastUpdates.materialParameters,l,g):null,d=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),p=[Yte(Rve,null,s,n,FTt,null,l,d)],f=wce(this._context,r,p,[i],o,this._context.layer.uid,a,c);if(f===null)return null;const m=new V0(this,f.object,p,null,null,eF,o);return m.alignedSampledElevation=f.sampledElevation,m.needsElevationUpdates=Mf(o.mode)||o.mode==="absolute-height",m.getScreenSize=this._createScreenSizeGetter(n,c),m.calculateRelativeScreenBounds=g=>i.calculateRelativeScreenBounds(m.getScreenSize(),1,g),tF(m,r,this._context.elevationProvider),m}_createAsOverlay(t,r,i,s,n,o){i.renderPriority=this._renderPriority;const a=Lr();fa(r,a,this._context.overlaySR),a[2]=Pce;const l=this._context.clippingExtent;if(v(l)&&!yoe(l,a))return null;const c=this.getFastUpdateAttrValues(t),d=c?_=>Ore(this._fastUpdates.materialParameters,c,_):null,p=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:t.uid,layerUid:this._context.layer.uid}),f=Yte(Rve,a,s,n,null,null,c,p),m=new hI(f,i,{layerUid:o,graphicUid:t.uid,calculateShaderTransformation:d});a[3]=0,jm(m.boundingSphere,a);const g=new oG(this,[m],null,this._context.drapeSourceRenderer);return g.getScreenSize=this._createScreenSizeGetter(n,d),g.calculateRelativeScreenBounds=_=>i.calculateRelativeScreenBounds(g.getScreenSize(),1,_),g}_createScreenSizeGetter(t,r){const i=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=rt())=>{const a=r(RTt);return o[0]=a[0]*s+i,o[1]=a[5]*n+i,o}}{const s=t[0]/this._symbolTextureRatio+i,n=t[1]/this._symbolTextureRatio+i;return(o=rt())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],r=Fe(t,t,t),i=xf(1),s=t*i;return{modelSize:r,symbolSize:Fe(s,s,s),unitInMeters:i,transformation:{anchor:Ic,scale:Xy,rotation:Ic}}}_getGraphicHash(t){let r="";for(const i of this._cimRequiredFields)r+=i+t.attributes[i];return r}_forEachMaterial(t){v(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return{...super.test(),material:this._material}}}function LTt(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function DX(e){return!C(e)&&(e==="cross"||e==="x")}cF.PRIMITIVE_SIZE=DTt,cF.elevationModeChangeTypes={definedChanged:en.UPDATE,staysOnTheGround:en.NONE,onTheGroundChanged:en.RECREATE};const NTt={mode:"relative-to-ground",offset:0},FTt=ar(0,0,0,1);function Mre(e){switch(e){case"butt":return gf.BUTT;case"square":return gf.SQUARE;case"round":return gf.ROUND;default:return null}}function kTt(e){return e==="diamond"?"kite":e}function Rre(e,t=null){const r=[],i=[];UTt(e,i,r);const s=i[0][1].data,n=r[0][1].length,o=new Array(n).fill(0);return BTt(e,i,r),zTt(e,i,r,o),GTt(e,i,r,o),VTt(e,i,r,o),jTt(e,i,r,o),HTt(e,i,r,o),qTt(e,i,r,o),WTt(e,i,r,s),new mn(i,r,Bl.Line,t)}function UTt(e,t,r){const{attributeData:{position:i},removeDuplicateStartEnd:s}=e,n=XTt(i)&&s,o=i.length/3-(n?1:0),a=new Array(2*(o-1)),l=n?Pse(i,0,i.length-3):i;let c=0;for(let d=0;d<o-1;d++)a[c++]=d,a[c++]=d+1;t.push([M.POSITION,{size:3,data:l,exclusive:n}]),r.push([M.POSITION,a])}function BTt(e,t,r){const i=e.attributeData.mapPosition;C(i)||(r.push([M.MAPPOS,r[0][1]]),t.push([M.MAPPOS,{size:3,data:i}]))}function zTt(e,t,r,i){if(v(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([M.COLOR,{size:4,data:yt(s,rf)}]),r.push([M.COLOR,i])}function VTt(e,t,r,i){if(!v(e.attributeData.normal))return;const s=e.attributeData.normal;t.push([M.NORMAL,{size:3,data:s}]),r.push([M.NORMAL,i])}function jTt(e,t,r,i){const s=e.attributeData.colorFeature;C(s)||(t.push([M.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),r.push([M.COLOR,i]))}function GTt(e,t,r,i){if(v(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([M.SIZE,{size:1,data:[yt(s,1)]}]),r.push([M.SIZE,i])}function HTt(e,t,r,i){const s=e.attributeData.sizeFeature;C(s)||(t.push([M.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),r.push([M.SIZEFEATUREATTRIBUTE,i]))}function qTt(e,t,r,i){const s=e.attributeData.opacityFeature;C(s)||(t.push([M.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),r.push([M.OPACITYFEATUREATTRIBUTE,i]))}function WTt(e,t,r,i){if(C(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==Ye.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(i.length),n=Kr(e.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)cae(i,f,s,f,n);const o=i.length/3,a=new Float32Array(o+1);let l=YTt,c=ZTt,d=0,p=0;ue(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),ue(c,s[p++],s[p++],s[p++]),d+=W$e(l,c),a[f]=d,[l,c]=[c,l];t.push([M.DISTANCETOSTART,{size:1,data:a}]),r.push([M.DISTANCETOSTART,r[0][1]])}function XTt(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}var Ive;(function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"})(Ive||(Ive={}));const YTt=$(),ZTt=$();function H8t(e,t){if(C(e)||e.length===0)return[];const r=[];return e.forEach(i=>{const s=i.length,n=new Float64Array(3*s);i.forEach((a,l)=>{n[3*l+0]=a[0],n[3*l+1]=a[1],n[3*l+2]=a[2]});const o={attributeData:{position:n,normal:t},removeDuplicateStartEnd:!1};r.push(o)}),r}function JTt(e,t,r,i){const s=e.type==="polygon"?O0.CCW_IS_HOLE:O0.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=v4(n,e.hasZ,s),l=new Float64Array(o.length),c=iFe(o,e.spatialReference,0,l,0,o,0,o.length/3,t,r,i),d=c!=null;return{lines:d?w4e(a,o,l):[],projectionSuccess:d,sampledElevation:c}}function KTt(e,t){const r=e.type==="polygon"?O0.CCW_IS_HOLE:O0.NONE,i=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=v4(i,!1,r),o=Yi(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=Pce;return{lines:o?w4e(n,s):[],projectionSuccess:o}}function w4e(e,t,r){const i=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;i.push({position:t.subarray(o,a),mapPosition:r?r.subarray(o,a):void 0})}return i}function QTt(e){const t=new Qr,r=e.hasMultipassTerrain&&(e.output===V.Color||e.output===V.Alpha),i=e.space===mf.World;e.hasTip&&i&&t.extensions.add("GL_OES_standard_derivatives"),t.include(OFe,e),t.include(LFe,e),e.output===V.Depth&&t.include(r1,e);const{vertex:s,fragment:n}=t;return n.include(Vd),Dd(s,e),t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.UV0,"vec2"),t.attributes.add(M.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),Rx(t),r&&t.varyings.add("depth","float"),e.hasTip&&t.varyings.add("vLineWidth","float"),s.uniforms.add([new ai("nearFar",(o,a)=>a.camera.nearFar),new Tr("viewport",(o,a)=>a.camera.fullViewport)]),s.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),s.code.add(S`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(t.attributes.add(M.NORMAL,"vec3"),nI(s),s.constants.add("tiltThreshold","float",.7),s.code.add(S`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):s.code.add(S`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),s.code.add(S`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${e.anchor===UE.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),e.space===mf.Screen&&(s.uniforms.add(new xs("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),s.code.add(S`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),s.code.add(S`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),s.uniforms.add(new De("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),s.code.add(S`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),s.uniforms.add(new De("pixelRatio",(o,a)=>a.camera.pixelRatio)),f7(t),s.code.add(S`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(e.hideOnShortSegments&&s.code.add(S`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),s.code.add(S`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(s.code.add(S`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),e.space===mf.Screen&&s.code.add(S`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),s.code.add(S`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${e.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&t.include(rp,e),t.include(Rn,e),n.uniforms.add([new Tr("intrinsicColor",o=>o.color),new Rt("tex",o=>o.texture)]),n.include(k0),t.constants.add("texelSize","float",1/sF),n.code.add(S`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),e.hasTip&&(t.constants.add("relativeMarkerSize","float",Ace/sF),t.constants.add("relativeTipLineWidth","float",vwt),n.code.add(S`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),t.constants.add("symbolAlphaCutoff","float",hl),n.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${e.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${e.output===V.Alpha?S`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===V.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===V.Color&&e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===V.Highlight?S`gl_FragColor = vec4(1.0);`:""}
    ${e.output===V.Depth?S`outputDepth(linearDepth);`:""}
  }
  `),t}const eSt=Object.freeze(Object.defineProperty({__proto__:null,build:QTt},Symbol.toStringTag,{value:"Module"})),x4e=new Map([[M.POSITION,0],[M.UV0,2],[M.AUXPOS1,3],[M.NORMAL,4],[M.COLOR,5],[M.COLORFEATUREATTRIBUTE,5],[M.SIZE,6],[M.SIZEFEATUREATTRIBUTE,6],[M.OPACITYFEATUREATTRIBUTE,7]]);class lG extends li{initializeProgram(t){return new ti(t.rctx,lG.shader.get().build(this.configuration),x4e)}_makePipelineState(t,r){const i=this.configuration,s=t===Ct.NONE;return Ht({blending:i.output===V.Color||i.output===V.Alpha?s?qh:v1(t):null,depthTest:{func:rT(t)},depthWrite:s?i.writeDepth&&$u:F7(t),colorWrite:cr,stencilWrite:i.hasOccludees?M0:null,stencilTest:i.hasOccludees?r?Vx:iT:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ht({blending:qh,depthTest:GV,depthWrite:null,colorWrite:cr,stencilWrite:null,stencilTest:kFe}),this._occluderPipelineOpaque=Ht({blending:qh,depthTest:GV,depthWrite:null,colorWrite:cr,stencilWrite:NFe,stencilTest:FFe}),this._occluderPipelineMaskWrite=Ht({blending:null,depthTest:Oce,depthWrite:null,colorWrite:null,stencilWrite:M0,stencilTest:Vx})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:this.configuration.occluder?t===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,r)}}lG.shader=new ei(eSt,()=>re(()=>import("./LineMarker.glsl.61f8be0d.js"),[]));class tSt extends z0{constructor(t){super(t,new iSt),this._vertexAttributeLocations=x4e,this._configuration=new Oa,this._layout=this.createLayout()}dispose(){}getConfiguration(t,r){return this._configuration.output=t,this._configuration.space=r.slot===Ee.DRAPED_MATERIAL?mf.Draped:this.parameters.worldSpace?mf.World:mf.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==gf.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===Rs.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const t=Ds().vec3f(M.POSITION).vec2f(M.UV0).vec3f(M.AUXPOS1);return this.parameters.worldSpace&&t.vec3f(M.NORMAL),this.parameters.vvSizeEnabled?t.f32(M.SIZEFEATUREATTRIBUTE):t.f32(M.SIZE),this.parameters.vvColorEnabled?t.f32(M.COLORFEATUREATTRIBUTE):t.vec4f(M.COLOR),this.parameters.vvOpacityEnabled&&t.f32(M.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new sSt(this._layout,this.parameters)}requiresSlot(t,r){return r===V.Color||r===V.Alpha||r===V.Highlight||r===V.Depth?t===Ee.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Rs.OccludeAndTransparentStencil?t===Ee.OPAQUE_MATERIAL||t===Ee.OCCLUDER_MATERIAL||t===Ee.TRANSPARENT_OCCLUDER_MATERIAL:r===V.Color||r===V.Alpha?t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ee.OPAQUE_MATERIAL:!1}createGLMaterial(t){return new rSt(t)}}class rSt extends mle{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(lG,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==V.Color&&this._output!==V.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class iSt extends uce{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=gf.BUTT,this.anchor=UE.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class sSt{constructor(t,r){this.vertexBufferLayout=t,this._parameters=r}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(t,r,i,s,n){const o=i.vertexAttributes.get(M.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(M.NORMAL);this._parameters.worldSpace&&v(c)&&(l=c.data);let d=1,p=0;this._parameters.vvSizeEnabled?p=i.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(M.SIZE)&&(d=i.vertexAttributes.get(M.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColorEnabled?m=i.vertexAttributes.get(M.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(M.COLOR)&&(f=i.vertexAttributes.get(M.COLOR).data);let g=0;this._parameters.vvOpacityEnabled&&(g=i.vertexAttributes.get(M.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(s.buffer);let x=n*(this.vertexBufferLayout.stride/4);const b=(O,A,R,D)=>{if(_[x++]=O[0],_[x++]=O[1],_[x++]=O[2],_[x++]=R[0],_[x++]=R[1],_[x++]=A[0],_[x++]=A[1],_[x++]=A[2],this._parameters.worldSpace&&(_[x++]=l[0],_[x++]=l[1],_[x++]=l[2]),this._parameters.vvSizeEnabled?_[x++]=p:_[x++]=d,this._parameters.vvColorEnabled)_[x++]=m;else{const k=Math.min(4*D,f.length-4);_[x++]=f[k+0],_[x++]=f[k+1],_[x++]=f[k+2],_[x++]=f[k+3]}this._parameters.vvOpacityEnabled&&(_[x++]=g)};let w;(function(O){O[O.ASCENDING=1]="ASCENDING",O[O.DESCENDING=-1]="DESCENDING"})(w||(w={}));const T=(O,A)=>{const R=ue(nSt,o[3*O],o[3*O+1],o[3*O+2]),D=oSt;let k=O+A;do ue(D,o[3*k],o[3*k+1],o[3*k+2]),k+=A;while(wx(R,D)&&k>=0&&k<a);t&&(je(R,R,t),je(D,D,t)),b(R,D,[-1,-1],O),b(R,D,[1,-1],O),b(R,D,[1,1],O),b(R,D,[-1,-1],O),b(R,D,[1,1],O),b(R,D,[-1,1],O)},E=this._parameters.placement;E!=="begin"&&E!=="begin-end"||T(0,w.ASCENDING),E!=="end"&&E!=="begin-end"||T(a-1,w.DESCENDING)}}const nSt=$(),oSt=$(),vl={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},aSt={dash:vl.dash,"dash-dot":[...vl.dash,...vl.dot],dot:vl.dot,"long-dash":vl["long-dash"],"long-dash-dot":[...vl["long-dash"],...vl.dot],"long-dash-dot-dot":[...vl["long-dash"],...vl.dot,...vl.dot],none:null,"short-dash":vl["short-dash"],"short-dash-dot":[...vl["short-dash"],...vl["short-dot"]],"short-dash-dot-dot":[...vl["short-dash"],...vl["short-dot"],...vl["short-dot"]],"short-dot":vl["short-dot"],solid:null},lSt=8;function cSt(e,t=2){return C(e)?e:{pattern:e.slice(),pixelRatio:t}}function q8t(e,t=2){return{pattern:[e,e],pixelRatio:t}}function T4e(e){return v(e)&&e.type==="style"?uSt(e.style):null}function uSt(e){return v(e)?cSt(aSt[e],lSt):null}const dSt=["polyline","polygon","extent"];class cG extends j0{constructor(t,r,i,s){super(t,r,i,s)}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=aF(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:xf(1))<0)throw new z("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=v(this.symbolLayer.marker)&&v(this._context.sharedResources.textures)?bwt(this._context.sharedResources.textures,kTt(this.symbolLayer.marker.style)):null}_getMaterialParameters(t,r=!1){var n;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Mre(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:T4e(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return qi(this.symbolLayer.material,t=>t.color)}get _markerColor(){return qi(this.symbolLayer.marker,t=>t.color)}get _lineMaterial(){return C(this._lineMaterialCached)&&(this._lineMaterialCached=new oM(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return C(this._ringMaterialCached)&&(this._ringMaterialCached=new oM(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return C(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new oM({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return C(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new oM({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return C(this._markerMaterialCached)&&v(this.symbolLayer.marker)&&v(this._markerTexture)&&(this._markerMaterialCached=new tSt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null,this._markerTexture=Di(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?Ga(Vbt(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Iv(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const r=ar(1,1,1,1);return this._drivenProperties.color&&t.color&&(r[0]=t.color[0],r[1]=t.color[1],r[2]=t.color[2],t.color.length>0&&(r[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(r[3]=t.opacity),r}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Iv(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Iv(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,dSt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new op);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,i,r.uid)}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!lF(this._fastUpdates,r,this._vvConvertOptions))return To.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return To.Fast_Update}prepareSymbolLayerPatch(t){var n,o;if(t.diff.type!=="partial")return;const r=t.diff.diff,i={};((n=r.size)==null?void 0:n.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=Mre(yt(r.cap.newValue,"butt")),delete r.cap);const s=this._prepareMarkerPatch(t,r);this._prepareMaterialPatch(t,r,s),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((t,r)=>this._updateMaterialLayerOpacity(t,r))}_forEachMaterial(t){v(this._lineMaterialCached)&&t(this._lineMaterialCached),v(this._ringMaterialCached)&&t(this._ringMaterialCached),v(this._wireframeLineMaterialCached)&&t(this._wireframeLineMaterialCached),v(this._wireframeRingMaterialCached)&&t(this._wireframeRingMaterialCached),v(this._markerMaterialCached)&&t(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(t,r=!1){const i=t.parameters.color,s=Ks(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!r?0:this._getCombinedOpacity(s),o=ar(i[0],i[1],i[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=g4(cG.elevationModeChangeTypes,i,s);if(n!==en.UPDATE)return n;const o=Mf(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof Sr)return kl.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,r,i){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=new Array,c=new Array,d=ao(),p=JTt(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),f=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,o,f,"LineSymbol3DLayer");for(let _=0;_<p.lines.length;_++){const{position:x,mapPosition:b}=p.lines[_];if(v(this._context.clippingExtent)&&(es(d),Uh(d,b),!Hm(d,this._context.clippingExtent)))continue;const w=this._createGeometry(t,x,b,n.type,dL.ELEVATED,i);a.push(w),l.push(n.type==="polygon"?this._ringMaterial:this._lineMaterial),c.push(Hn),hi.LINE_WIREFRAMES&&(a.push(w.cloneShallow()),l.push(n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial),c.push(Hn));const T=this._markerMaterial;v(T)&&(a.push(w.cloneShallow()),l.push(T),c.push(Hn))}if(a.length===0)return null;const m=new w1({geometries:a,materials:l,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),g=new V0(this,m,a,null,null,obt,r);return g.alignedSampledElevation=p.sampledElevation,g.needsElevationUpdates=Mf(r.mode),g}_createGeometry(t,r,i,s,n,o){const a=s==="polygon",l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,c=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size,d=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:o,layerUid:this._context.layer.uid});return Rre({overlayInfo:n===dL.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:a,attributeData:{position:r,mapPosition:i,size:c?null:this._getDrivenSize(t.renderingInfo),color:l?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}},d)}_createAsOverlay(t,r){const i=t.graphic,s=this._getGeometryAsPolygonOrPolyline(i.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=hi.LINE_WIREFRAMES?s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;v(a)&&(a.renderPriority=this._renderPriority-.001),v(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,d=ao(),p=es(),f=KTt(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const g of f.lines){if(es(d),Uh(d,g.position),!Hm(d,this._context.clippingExtent))continue;CR(p,d);const _=this._createGeometry(t,g.position,null,s.type,dL.DRAPED,i.uid),x=w=>{const T=new hI(_,w,{layerUid:r,graphicUid:i.uid});return c.push(T),T};if(v(l)){const w=x(l),T=this.symbolLayer.marker.placement;T!=="begin"&&T!=="begin-end"||Uh(d,g.position,0,1),T!=="end"&&T!=="begin-end"||Uh(d,g.position,g.position.length-3,1),this._updateBoundingSphere(w,d)}const b=x(o);if(this._updateBoundingSphere(b,d),hi.LINE_WIREFRAMES){const w=x(a);this._updateBoundingSphere(w,d)}}return new oG(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,r){Oi(t.boundingSphere,.5*(r[0]+r[3]),.5*(r[1]+r[4]),0,.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return v(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=yt(t,xf(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Ga(1):1:Ga(t)}_prepareMaterialPatch(t,r,i){const s=r.material;if(C(s))return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,t));if(s.type==="collection")return;const n=s.type==="complete"?qi(s.newValue,a=>a.color):s.diff.color.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);i.useMaterialColor&&this._patchMaterialColor(vj(o),this._markerMaterialCached,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,t),delete r.material}_prepareMarkerPatch(t,r){const i=r.marker;if(C(i)||i.type!=="partial"||v(i.diff.style)||v(i.diff.placement)||v(i.diff.color)&&i.diff.color.type!=="complete")return{changed:!1,useMaterialColor:C(this._markerColor)};const s=i.diff.color;if(C(s))return delete r.marker,{changed:!1,useMaterialColor:C(this._markerColor)};const n=s.newValue;return C(n)?(delete r.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterialCached,t),delete r.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,r,i){C(r)||i.symbolLayerStatePatches.push(()=>r.setParameters({color:t}))}}var dL;cG.elevationModeChangeTypes={definedChanged:en.RECREATE,staysOnTheGround:en.NONE,onTheGroundChanged:en.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(dL||(dL={}));let JP=null,WV=!0;function LX(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(WV)try{return new ImageData(e,t)}catch{WV=!1}return S4e(e,t,r)}function hSt(e,t,r,i){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(WV)try{return new ImageData(e,t,r)}catch{WV=!1}const s=S4e(t,r,i);return s.data.set(e,0),s}function pSt(){return JP||(JP=document.createElement("canvas"),JP.width=1,JP.height=1),JP}function S4e(e,t,r){return r||(r=pSt()),r.getContext("2d").createImageData(e,t)}var mO;const NX=new WeakMap;let fSt=0,_y=mO=class extends fe{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,i){if(e instanceof HTMLImageElement){const s={type:"image-element",src:Wv(e.src,i),crossOrigin:e.crossOrigin};t[r]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[r]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:Wv(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=s}else{const s={type:"image-data",imageData:this._encodeImageData(e)};t[r]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const r=t.substr(t.length-4,4).toLowerCase(),i=t.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(e){this._overrideIfSome("transparent",e)}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(r="")=>`d:${r},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(NX.has(this.data)||NX.set(this.data,++fSt),t(NX.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new mO(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return hSt(r,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new mO({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new mO({data:e}):rE(mO,e)}};u([h({type:String,json:{write:Sx}})],_y.prototype,"url",null),u([h({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),h()],_y.prototype,"data",null),u([Le("data")],_y.prototype,"writeData",null),u([me("data")],_y.prototype,"readData",null),u([h({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],_y.prototype,"transparent",null),u([h({json:{write:!0}})],_y.prototype,"wrap",void 0),u([h({readOnly:!0})],_y.prototype,"contentHash",null),_y=mO=u([I("esri.geometry.support.MeshTexture")],_y);const hL=_y;var Ire;let fm=Ire=class extends fe{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=v(e)?e.get(this):null;if(r)return r;const i=new Ire(this.clonePropertiesWithDeduplication(t));return v(e)&&e.set(this,i),i}clonePropertiesWithDeduplication(e){return{color:v(this.color)?this.color.clone():null,colorTexture:v(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:v(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:v(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:v(this.normalTextureTransform)?this.normalTextureTransform:null}}};u([h({type:Ze,json:{write:!0}})],fm.prototype,"color",void 0),u([h({type:hL,json:{write:!0}})],fm.prototype,"colorTexture",void 0),u([h({type:hL,json:{write:!0}})],fm.prototype,"normalTexture",void 0),u([h({nonNullable:!0,json:{write:!0}})],fm.prototype,"alphaMode",void 0),u([h({nonNullable:!0,json:{write:!0}})],fm.prototype,"alphaCutoff",void 0),u([h({nonNullable:!0,json:{write:!0}})],fm.prototype,"doubleSided",void 0),u([h()],fm.prototype,"colorTextureTransform",void 0),u([h()],fm.prototype,"normalTextureTransform",void 0),fm=Ire=u([I("esri.geometry.support.MeshMaterial")],fm);const Lce=fm;var Pre;let $p=Pre=class extends Lce{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=v(e)?e.get(this):null;if(r)return r;const i=new Pre(this.clonePropertiesWithDeduplication(t));return v(e)&&e.set(this,i),i}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:v(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:v(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:v(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null,occlusionTextureTransform:v(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:v(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:v(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}}};u([h({type:Ze,json:{write:!0}})],$p.prototype,"emissiveColor",void 0),u([h({type:hL,json:{write:!0}})],$p.prototype,"emissiveTexture",void 0),u([h({type:hL,json:{write:!0}})],$p.prototype,"occlusionTexture",void 0),u([h({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],$p.prototype,"metallic",void 0),u([h({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],$p.prototype,"roughness",void 0),u([h({type:hL,json:{write:!0}})],$p.prototype,"metallicRoughnessTexture",void 0),u([h()],$p.prototype,"occlusionTextureTransform",void 0),u([h()],$p.prototype,"emissiveTextureTransform",void 0),u([h()],$p.prototype,"metallicRoughnessTextureTransform",void 0),$p=Pre=u([I("esri.geometry.support.MeshMaterialMetallicRoughness")],$p);const E4e=$p;var YB;const C4e="esri.geometry.support.MeshVertexAttributes",rA=te.getLogger(C4e);let gp=YB=class extends fe{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return gO(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},rA)}castPosition(e){return e&&e instanceof Float32Array&&rA.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),gO(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},rA)}castUv(e){return gO(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},rA)}castNormal(e){return gO(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},rA)}castTangent(e){return gO(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},rA)}clone(){const e={position:ne(this.position),uv:ne(this.uv),normal:ne(this.normal),tangent:ne(this.tangent),color:ne(this.color)};return new YB(e)}clonePositional(){const e={position:ne(this.position),normal:ne(this.normal),tangent:ne(this.tangent),uv:this.uv,color:this.color};return new YB(e)}};function FX(e,t,r,i){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(i.error(s,`Invalid array length, expected a multiple of ${n}`),new r([])):e}function gO(e,t,r,i,s){if(!e)return e;if(e instanceof t)return FX(e,i,t,s);for(const n of r)if(e instanceof n)return FX(new t(e),i,t,s);if(Array.isArray(e))return FX(new t(e),i,t,s);{const n=r.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function KP(e,t,r){t[r]=mSt(e)}function mSt(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}u([h({json:{write:KP}})],gp.prototype,"color",void 0),u([Gt("color")],gp.prototype,"castColor",null),u([h({nonNullable:!0,json:{write:KP}})],gp.prototype,"position",void 0),u([Gt("position")],gp.prototype,"castPosition",null),u([h({json:{write:KP}})],gp.prototype,"uv",void 0),u([Gt("uv")],gp.prototype,"castUv",null),u([h({json:{write:KP}})],gp.prototype,"normal",void 0),u([Gt("normal")],gp.prototype,"castNormal",null),u([h({json:{write:KP}})],gp.prototype,"tangent",void 0),u([Gt("tangent")],gp.prototype,"castTangent",null),gp=YB=u([I(C4e)],gp);var V$;const A4e="esri.geometry.support.MeshComponent",gSt=te.getLogger(A4e);let $_=V$=class extends fe{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return rE(V$,e)}castFaces(e){return gO(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},gSt)}castMaterial(e){return rE(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?E4e:Lce,e)}clone(){return new V$({faces:ne(this.faces),shading:this.shading,material:ne(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const r={faces:ne(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new V$(r)}};u([h({json:{write:!0}})],$_.prototype,"faces",void 0),u([Gt("faces")],$_.prototype,"castFaces",null),u([h({type:Lce,json:{write:!0}})],$_.prototype,"material",void 0),u([Gt("material")],$_.prototype,"castMaterial",null),u([h({type:String,json:{write:!0}})],$_.prototype,"shading",void 0),u([h({type:Boolean})],$_.prototype,"trustSourceNormals",void 0),$_=V$=u([I(A4e)],$_);const ySt=$_,uG=te.getLogger("esri.geometry.support.meshUtils.normalProjection");function _St(e,t,r,i,s){return hG(i)?(dG(Pv.TO_PCPF,Ii.fromTypedArray(e),qn.fromTypedArray(t),qn.fromTypedArray(r),i,Ii.fromTypedArray(s)),s):(uG.error("Cannot convert spatial reference to PCPF"),s)}function W8t(e,t,r,i,s){return hG(i)?(dG(Pv.FROM_PCPF,Ii.fromTypedArray(e),qn.fromTypedArray(t),qn.fromTypedArray(r),i,Ii.fromTypedArray(s)),s):(uG.error("Cannot convert to spatial reference from PCPF"),s)}function X8t(e,t,r){return Yi(e,t,0,r,T0(t),0,e.length/3),r}function Y8t(e,t,r){return Yi(e,T0(r),0,t,r,0,e.length/3),t}function vSt(e,t,r){if(C(e))return t;const i=qn.fromTypedArray(e),s=qn.fromTypedArray(t);return _4(s,i,r),t}function bSt(e,t,r){if(C(e))return t;FR(ia,r);const i=Ii.fromTypedArray(e),s=Ii.fromTypedArray(t);return zx(s,i,ia),vae(ia)||Tce(s,s),t}function wSt(e,t,r){if(C(e))return t;FR(ia,r);const i=Ii.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=Ii.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(zx(s,i,ia),vae(ia)||Tce(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function xSt(e,t,r,i,s){if(!hG(i))return uG.error("Cannot convert spatial reference to PCPF"),s;dG(Pv.TO_PCPF,Ii.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),qn.fromTypedArray(t),qn.fromTypedArray(r),i,Ii.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function Z8t(e,t,r,i,s){if(!hG(i))return uG.error("Cannot convert to spatial reference from PCPF"),s;dG(Pv.FROM_PCPF,Ii.fromTypedArray(e,16),qn.fromTypedArray(t),qn.fromTypedArray(r),i,Ii.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function dG(e,t,r,i,s,n){if(!t)return;const o=r.count,a=T0(s);if(O4e(s))for(let l=0;l<o;l++)i.getVec(l,sU),t.getVec(l,zg),Qh(a,sU,nU,a),Tf(ia,nU),e===Pv.FROM_PCPF&&Sf(ia,ia),Td(zg,zg,ia),n.setVec(l,zg);else for(let l=0;l<o;l++){i.getVec(l,sU),t.getVec(l,zg),Qh(a,sU,nU,a),Tf(ia,nU);const c=vz(r.get(l,1));let d=Math.cos(c);e===Pv.TO_PCPF&&(d=1/d),ia[0]*=d,ia[1]*=d,ia[2]*=d,ia[3]*=d,ia[4]*=d,ia[5]*=d,e===Pv.FROM_PCPF&&Sf(ia,ia),Td(zg,zg,ia),xe(zg,zg),n.setVec(l,zg)}return n}function hG(e){return O4e(e)||TSt(e)}function O4e(e){return e.isWGS84||kCe(e)||I0(e)||P0(e)}function TSt(e){return e.isWebMercator}var Pv;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(Pv||(Pv={}));const sU=$(),zg=$(),nU=$e(),ia=Ts();function qy(e){if(C(e))return null;const t=v(e.offset)?e.offset:_Fe,r=v(e.rotation)?e.rotation:0,i=v(e.scale)?e.scale:vFe,s=qB(1,0,0,0,1,0,t[0],t[1],1),n=qB(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=qB(i[0],0,0,0,i[1],0,0,0,1),a=Au();return NR(a,n,o),NR(a,s,a),a}function SSt(e){const t=new Qr,{vertex:r,fragment:i}=t;return t.include(wu,e),t.include(fC,e),t.include($Fe,e),Dd(r,e),e.stippleEnabled&&(t.attributes.add(M.UV0,"vec2"),t.attributes.add(M.AUXPOS1,"vec3"),r.uniforms.add(new Tr("viewport",(s,n)=>n.camera.fullViewport))),t.attributes.add(M.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r.code.add(S`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(r.code.add(S`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?r.uniforms.add(new De("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):r.code.add(S`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(S`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?r.code.add(S`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(S`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new De("stipplePatternPixelSize",s=>Cce(s))),r.code.add(S`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(S`}`),e.output===V.Highlight&&t.include(_1,e),t.include(Rn,e),i.uniforms.add(new De("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||i.uniforms.add(new Tr("constantColor",s=>s.color)),i.code.add(S`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${S.float(hl)}) {
      discard;
    }

    ${e.output===V.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===V.Highlight?S`outputHighlight();`:""}
  }
  `),t}const ESt=Object.freeze(Object.defineProperty({__proto__:null,build:SSt},Symbol.toStringTag,{value:"Module"}));class pG extends li{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==V.Highlight}initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2}initializeProgram(t){return new ti(t.rctx,pG.shader.get().build(this.configuration),Yr)}initializePipeline(){const t=this.configuration,r=ma(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),i=(s,n=null,o=null)=>Ht({blending:n,depthTest:Oce,depthWrite:o,colorWrite:cr,stencilWrite:t.hasOccludees?M0:null,stencilTest:t.hasOccludees?s?Vx:iT:null});return t.output===V.Color?(this._occludeePipelineState=i(!0,t.transparent||this._stippleEnabled?r:null,$u),i(!1,t.transparent||this._stippleEnabled?r:null,$u)):i(!1)}get primitiveType(){return Ut.LINES}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}pG.shader=new ei(ESt,()=>re(()=>import("./NativeLine.glsl.90061388.js"),[]));class nh extends aa{constructor(){super(...arguments),this.output=V.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}u([j({count:V.COUNT})],nh.prototype,"output",void 0),u([j()],nh.prototype,"hasSlicePlane",void 0),u([j()],nh.prototype,"hasVertexColors",void 0),u([j()],nh.prototype,"transparent",void 0),u([j()],nh.prototype,"draped",void 0),u([j()],nh.prototype,"stippleEnabled",void 0),u([j()],nh.prototype,"stippleOffColorEnabled",void 0),u([j()],nh.prototype,"stipplePreferContinuous",void 0),u([j()],nh.prototype,"hasOccludees",void 0),u([j({constValue:!1})],nh.prototype,"stippleRequiresClamp",void 0),u([j({constValue:!1})],nh.prototype,"stippleScaleWithLineWidth",void 0),u([j({constValue:!1})],nh.prototype,"stippleRequiresStretchMeasure",void 0);var XV;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(XV||(XV={}));class Pve extends z0{constructor(t){super(t,new OSt),this._configuration=new nh}getConfiguration(t,r){this._configuration.output=t,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===Ee.DRAPED_MATERIAL;const i=v(this.parameters.stipplePattern);return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&v(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(t,r,i,s,n,o,a,l,c){v(c)?rvt(t,s,c,o,1,a):this._intersectLineGeometry(t,r,i,s,a)}_intersectLineGeometry(t,r,i,s,n){if(!s.options.selectionMode||d4(r))return;if(!PDe(i))return void te.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const o=t.vertexAttributes.get(M.POSITION).data,a=s.camera,l=RSt;Ho(l,s.point);const c=2;ue(QP[0],l[0]-c,l[1]+c,0),ue(QP[1],l[0]+c,l[1]+c,0),ue(QP[2],l[0]+c,l[1]-c,0),ue(QP[3],l[0]-c,l[1]-c,0);for(let g=0;g<4;g++)if(!a.unprojectFromRenderScreen(QP[g],n_[g]))return;Il(a.eye,n_[0],n_[1],kX),Il(a.eye,n_[1],n_[2],UX),Il(a.eye,n_[2],n_[3],BX),Il(a.eye,n_[3],n_[0],zX);let d=Number.MAX_VALUE,p=0;for(let g=0;g<o.length-5;g+=3){if(mc[0]=o[g]+i[12],mc[1]=o[g+1]+i[13],mc[2]=o[g+2]+i[14],gc[0]=o[g+3]+i[12],gc[1]=o[g+4]+i[13],gc[2]=o[g+5]+i[14],Hi(kX,mc)<0&&Hi(kX,gc)<0||Hi(UX,mc)<0&&Hi(UX,gc)<0||Hi(BX,mc)<0&&Hi(BX,gc)<0||Hi(zX,mc)<0&&Hi(zX,gc)<0)continue;if(a.projectToRenderScreen(mc,RT),a.projectToRenderScreen(gc,IT),RT[2]<0&&IT[2]>0){ge(Vg,mc,gc);const x=a.frustum,b=-Hi(x[Gi.NEAR],mc)/Te(Vg,x[Gi.NEAR]);de(Vg,Vg,b),ye(mc,mc,Vg),a.projectToRenderScreen(mc,RT)}else if(RT[2]>0&&IT[2]<0){ge(Vg,gc,mc);const x=a.frustum,b=-Hi(x[Gi.NEAR],gc)/Te(Vg,x[Gi.NEAR]);de(Vg,Vg,b),ye(gc,gc,Vg),a.projectToRenderScreen(gc,IT)}else if(RT[2]<0&&IT[2]<0)continue;RT[2]=0,IT[2]=0;const _=Rae(B2(RT,IT,Lve),l);_<d&&(d=_,le($ve,mc),le(Dve,gc),p=g/3)}const f=s.rayBegin,m=s.rayEnd;if(d<c*c){let g=Number.MAX_VALUE;if(QPe(B2($ve,Dve,Lve),B2(f,m,MSt),MT)){ge(MT,MT,f);const _=Ie(MT);de(MT,MT,1/_),g=_/Ni(f,m)}n(g,MT,p,!1)}}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return!1;const s=i.get(M.POSITION);return Cle(s,null,!1,r)}requiresSlot(t,r){return!(r!==V.Color&&r!==V.Highlight&&r!==V.ObjectAndLayerIdColor||t!==Ee.OPAQUE_MATERIAL&&t!==Ee.DRAPED_MATERIAL)}createGLMaterial(t){return new CSt(t)}createBufferWriter(){const t=this.parameters.hasVertexColors?ZFe:Jwt;return C(this.parameters.stipplePattern)?new tG(t):new ASt(t.clone().vec3f(M.AUXPOS1).vec2f(M.UV0))}}class CSt extends tT{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){this._output===V.Color&&this._updateOccludeeState(t);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,r)),this._stipplePattern=r),this.ensureTechnique(pG,t)}}class ASt{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(M.POSITION).length}write(t,r,i,s,n){D7(i,this.vertexBufferLayout,t,r,s,n),this._writeAuxpos1(t,i,s,n),this._writeUV0(t,i,s,n)}_writeAuxpos1(t,r,i,s){const n=i.getField(M.AUXPOS1,Ii),o=r.indices.get(M.POSITION),a=r.vertexAttributes.get(M.POSITION).data,l=t,c=n.typedBufferStride,d=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],g=a[m],_=a[m+1],x=a[m+2],b=l[0]*g+l[4]*_+l[8]*x+l[12],w=l[1]*g+l[5]*_+l[9]*x+l[13],T=l[2]*g+l[6]*_+l[10]*x+l[14];d[s]=b,d[s+1]=w,d[s+2]=T,s+=c}}_writeUV0(t,r,i,s){var T;const n=i.getField(M.UV0,Af),o=r.indices.get(M.POSITION),a=r.vertexAttributes.get(M.POSITION).data,l=(T=r.vertexAttributes.get(M.DISTANCETOSTART))==null?void 0:T.data,c=n.typedBufferStride,d=n.typedBuffer;let p=0;d[s*=c]=XV.START,d[s+1]=p,s+=c;const f=3*o[0],m=ue(mc,a[f],a[f+1],a[f+2]);t&&je(m,m,t);const g=gc,_=o.length-1;let x=1;const b=l?(E,O,A)=>p=l[A]:(E,O,A)=>p+=Ni(E,O);for(let E=1;E<_;E+=2){const O=3*o[E];ue(g,a[O],a[O+1],a[O+2]),t&&je(g,g,t),b(m,g,x++);for(let A=0;A<2;++A)d[s]=1-A,d[s+1]=p,s+=c;le(m,g)}const w=3*o[_];ue(g,a[w],a[w+1],a[w+2]),t&&je(g,g,t),b(m,g,x),d[s]=XV.END,d[s+1]=p}}class OSt extends GI{constructor(){super(...arguments),this.color=rf,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}}const mc=$(),gc=$(),Vg=$(),MT=$(),RT=ul(),IT=ul(),$ve=$(),Dve=$(),Lve=xg(),MSt=xg(),RSt=$(),QP=[ul(),ul(),ul(),ul()],n_=[$(),$(),$(),$()],kX=di(),UX=di(),BX=di(),zX=di(),ISt=["mesh"];class PSt extends j0{constructor(t,r,i,s){super(t,r,i,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){hi.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Pve({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Pve({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,ISt,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new op),s=t.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(t,r){const i=this._getLayerOpacity();this._materials.forEach(s=>{s.material.setParameters({layerOpacity:i});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=r(s);v(n)&&n.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Bx)}slicePlaneEnabledChanged(t,r){return this._materials.forEach(i=>{i.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(i=>{const s=r(i);v(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(r=>r.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return C(t)?"-":t instanceof Ze?t.toHex():t.contentHash}_materialPropertiesDefault(t,r){const i=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${r},svc:${i}`}}_materialProperties(t,r,i){const s=this._materialPropertiesDefault(t,i);if(!r.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:d}=r.material,p=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${d}`,r.material instanceof E4e){const{metallic:g,roughness:_,metallicRoughnessTexture:x,emissiveColor:b,emissiveTexture:w,occlusionTexture:T}=r.material,E=this._colorOrTextureUid(x),O=this._colorOrTextureUid(b),A=this._colorOrTextureUid(w),R=this._colorOrTextureUid(T);s.metallic=g,s.roughness=_,s.metallicRoughnessTexture=x,s.emissiveColor=b,s.emissiveTexture=w,s.occlusionTexture=T,s.colorTextureTransform=r.material.colorTextureTransform,s.normalTextureTransform=r.material.normalTextureTransform,s.emissiveTextureTransform=r.material.emissiveTextureTransform,s.occlusionTextureTransform=r.material.occlusionTextureTransform,s.metallicRoughnessTextureTransform=r.material.metallicRoughnessTextureTransform,s.uid=`${s.uid},mrm:${g},mrr:${_},mrt:${E},emuid:${O},etmuid:${A},otmuid:${R}`}return s}_setInternalColorValueParameters(t,r){r.diffuse=Ze.toUnitRGB(t),r.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const r=this._getInternalTexture(t,Mi.Opaque);return v(r)?r.id:null}_getInternalTexture(t,r){const i=this._getLoadableTextureResource(t);if(!i)return null;const s=`${t.contentHash}/${r}`;let n=this._textures.get(s);return n||(n=new ka(i,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:r!==Mi.Opaque}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const r=this._castTextureWrapIndividual(t);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return It.CLAMP_TO_EDGE;case"mirror":return It.MIRRORED_REPEAT;default:return It.REPEAT}}_setInternalMaterialParameters(t,r){if(v(t.color)&&this._setInternalColorValueParameters(t.color,r),v(t.colorTexture)){const i=this._getInternalTexture(t.colorTexture,r.textureAlphaMode);v(i)?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.params.preMultiplyAlpha):r.textureId=void 0}v(t.normalTexture)&&(r.normalTextureId=this._getInternalTextureId(t.normalTexture)),v(t.emissiveColor)&&(r.emissiveFactor=Ze.toUnitRGB(t.emissiveColor)),v(t.emissiveTexture)&&(r.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),v(t.occlusionTexture)&&(r.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),v(t.metallicRoughnessTexture)&&(r.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture)),r.colorTextureTransformMatrix=qy(t.colorTextureTransform),r.normalTextureTransformMatrix=qy(t.normalTextureTransform),r.occlusionTextureTransformMatrix=qy(t.occlusionTextureTransform),r.emissiveTextureTransformMatrix=qy(t.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=qy(t.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(t){const r=this._drivenProperties.color;let i=v(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(r)t.externalColor=rf;else{const s=v(this.symbolLayer.material)?this.symbolLayer.material.color:null;v(s)?t.externalColor=Ze.toUnitRGBA(s):(i=null,t.externalColor=rf)}i&&(t.colorMixMode=i),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const r=t.vertexAttributes.color;if(C(r))return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(t,r){var g,_,x;const i=(g=r.material)==null?void 0:g.color,s=(_=r.material)==null?void 0:_.colorTexture,n=(x=r.material)==null?void 0:x.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(t)||v(i)&&i.a<1||v(s)&&s.transparent||o),l=this._materialProperties(t,r,a),c=this._materials.get(l.uid);if(c)return c.material;const d={material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Ic,diffuse:Xy,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Xi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),r.material&&(f.doubleSided=r.material.doubleSided,f.cullFace=r.material.doubleSided?Xi.None:Xi.Back,f.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,d),this._setInternalMaterialParameters(l,f);const m=new VE(f);return d.material=m,this._materials.set(l.uid,d),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,r){t.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,r.alphaMode==="auto"?t.textureAlphaMode=t.transparent?Mi.MaskBlend:Mi.Opaque:t.textureAlphaMode=r.alphaMode==="opaque"?Mi.Opaque:r.alphaMode==="mask"?Mi.Mask:Mi.Blend}_addDebugNormals(t,r,i,s){const n=r.length,o=t.spatialReference.isGeographic?20015077/180:1,a=.1*Math.max(t.extent.width*o,t.extent.height*o,t.extent.zmax-t.extent.zmin),l=[],c=[],d=[],p=[];for(let g=0;g<n;g++){const _=r[g],x=_.vertexAttributes.get(M.POSITION),b=_.vertexAttributes.get(M.NORMAL),w=_.indices.get(M.POSITION),T=_.indices.get(M.NORMAL),E=x.data,O=b.data;for(let A=0;A<w.length;A++){const R=3*w[A],D=3*T[A];for(let k=0;k<3;k++)l.push(E[R+k]);for(let k=0;k<3;k++)l.push(E[R+k]+O[D+k]*a);if(c.push(c.length),c.push(c.length),A%3==0){this._calculateFaceNormal(E,w,A,nA),this._getFaceVertices(E,w,A,Ka,iA,sA),ye(Ka,Ka,iA),ye(Ka,Ka,sA),de(Ka,Ka,1/3);for(let k=0;k<3;k++)d.push(Ka[k]);for(let k=0;k<3;k++)d.push(Ka[k]+nA[k]*a);p.push(p.length),p.push(p.length)}}}const f=new mn([[M.POSITION,{data:l,size:3,exclusive:!0}]],[[M.POSITION,c]],Bl.Line);r.push(f),i.push(this._debugVertexNormalMaterial),s.push(U2(s[0]));const m=new mn([[M.POSITION,{data:d,size:3,exclusive:!0}]],[[M.POSITION,p]],Bl.Line);r.push(m),i.push(this._debugFaceNormalMaterial),s.push(U2(s[0]))}_createAs3DShape(t,r,i,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,r,s);if(!o)return null;const{geometries:a,materials:l,transformations:c,objectTransformation:d}=o;hi.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a,l,c);const p=new w1({geometries:a,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});p.transformation=d;const f=this._createEdgeMaterial(),m=v(f)?{baseMaterial:l[0],edgeMaterials:[f],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,g=new V0(this,p,a,null,null,eF,i,m);return g.needsElevationUpdates=Bx(i.mode),g.useObjectOriginAsAttachmentOrigin=!0,g.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(p),g.alignedSampledElevation=eF(g,g.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),g}_getCenterPointInElevationSR(t){const r=b1(0,0,0,v(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);return PIe([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(t,r,i,s){switch(i.shading||"flat"){case"source":return this._createComponentNormalsSource(t,r,i,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s);default:return}}_createComponentNormalsSource(t,r,i,s){if(C(r))return this._createComponentNormalsFlat(t,s);let n=!1;if(!i.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,nA);for(let a=0;a<3;a++){const l=3*s[o+a];Ka[0]=r[l+0],Ka[1]=r[l+1],Ka[2]=r[l+2],Te(nA,Ka)<0&&(r[l+0]=-r[l+0],r[l+1]=-r[l+1],r[l+2]=-r[l+2],n=!0)}}return{normals:r,indices:s,didFlipNormals:n}}_createComponentNormalsFlat(t,r){const i=new Float32Array(r.length),s=new Array(3*r.length);for(let n=0;n<r.length;n+=3){const o=this._calculateFaceNormal(t,r,n,nA);for(let a=0;a<3;a++)i[n+a]=o[a],s[n+a]=n/3}return{normals:i,indices:s,didFlipNormals:!1}}_createComponentNormalsSmooth(t,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(t,r,o,nA);for(let l=0;l<3;l++){const c=r[o+l];let d=i[c];d||(d={normal:$(),count:0},i[c]=d),ye(d.normal,d.normal,a),d.count++}}const s=new Float32Array(3*r.length),n=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(xe(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return{normals:s,indices:n,didFlipNormals:!1}}_getFaceVertices(t,r,i,s,n,o){const a=3*r[i+0],l=3*r[i+1],c=3*r[i+2];s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l+0],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c+0],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,r,i,s){return this._getFaceVertices(t,r,i,Ka,iA,sA),ge(iA,iA,Ka),ge(sA,sA,Ka),At(Ka,iA,sA),xe(s,Ka),s}_getOrCreateComponents(t){return yt(t.components,$St)}_createPositionBuffer(t,r){let i=t.vertexAttributes.position;const s=r.reprojection===dh.ECEF?r.transformBeforeProject:null;if(v(s)&&(i=vSt(i,new Float64Array(i.length),s)),r.reprojection===dh.NONE)return r.needsBufferCopy?new Float64Array(i):i;const n=v(s)?i:new Float64Array(i.length);return Yi(i,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,i.length/3),n}_createNormalBuffer(t,r,i){let s=t.vertexAttributes.normal;if(C(s))return null;const n=i.reprojection===dh.ECEF?i.transformBeforeProject:null;if(v(n)&&(s=bSt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===dh.NONE)return i.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=v(n)?s:new Float32Array(s.length);return _St(s,o,r,t.spatialReference,a)}_createTangentBuffer(t,r,i){let s=t.vertexAttributes.tangent;if(C(s))return null;const n=i.reprojection===dh.ECEF?i.transformBeforeProject:null;if(v(n)&&(s=wSt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===dh.NONE)return i.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=v(n)?s:new Float32Array(s.length);return xSt(s,o,r,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const r=this._getVertexOpacityAndColor(t),i=lPe(Ks(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return cPe(r,i,s),s}return null}_createBuffers(t,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(v(s)&&s.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(v(o)&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(v(n)&&n.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),d=this._createSymbolColorBuffer(r),p=this._createNormalBuffer(t,l,a),f=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:d,objectTransformation:a.reprojection===dh.NONE&&v(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(t,l,p,f),geometryTransformation:a.reprojection===dh.NONE&&v(a.geometryTransformation)?a.geometryTransformation:$e()}}_computeReprojectionInfo(t){const r=v(t.transform),i=r&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===Ye.Local?dh.NONE:dh.ECEF;if(r){if(i===dh.NONE){const n=$e();return Qh(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:n,geometryTransformation:U2(t.transform.localMatrix),needsBufferCopy:!1}}const s=Rj($e(),t.transform.origin);return Hs(s,s,t.transform.localMatrix),{reprojection:i,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(t,r,i,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;oU[0]=o.x,oU[1]=o.y,oU[2]=o.z;const a=$e();Qh(t.spatialReference,oU,a,n);const l=qn.fromTypedArray(r);if(Pn(Nve,a),_4(l,l,Nve),v(i)||v(s)){if(Tf(e3,a),Sf(e3,e3),v(i)){const c=Ii.fromTypedArray(i);zx(c,c,e3)}if(v(s)){const c=Ii.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);zx(c,c,e3)}}return a}_validateFaces(t,r){const i=t.vertexAttributes.position.length/3,s=r.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(i<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,r){return r.faces?r.faces:tI(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let s;const n=r.length/3;return v(i)&&!t.spatialReference.equals(i)?(s=new Float64Array(r.length),Yi(t.vertexAttributes.position,t.spatialReference,0,s,i,0,n)):s=r,es(VX),Uh(VX,s,0,n),!Hm(VX,this._context.clippingExtent)}_createGeometryInfo(t,r,i){if(!Xv(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const s=this._createBuffers(t,r);if(C(s))return null;const{positionBuffer:n,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:d,objectTransformation:p,geometryTransformation:f}=s,m=this._getOrCreateComponents(t),g=[],_=[],x=[];let b=!1;for(const w of m){if(!this._validateFaces(t,w))return null;const T=this._getOrCreateFaces(t,w);if(T.length===0)continue;const E=this._createComponentNormals(n,c,w,T);E.didFlipNormals&&(b=!0);const O=[[M.POSITION,{size:3,data:n,exclusive:!0}],[M.NORMAL,{size:3,data:E.normals,exclusive:!0}]],A=[[M.POSITION,T],[M.NORMAL,E.indices]];v(a)&&(O.push([M.COLOR,{size:4,data:a,exclusive:!0}]),A.push([M.COLOR,T])),v(l)&&(O.push([M.SYMBOLCOLOR,{size:4,data:l,exclusive:!0}]),A.push([M.SYMBOLCOLOR,new Array(T.length).fill(0)])),v(o)&&(O.push([M.UV0,{size:2,data:o,exclusive:!0}]),A.push([M.UV0,T])),v(d)&&(O.push([M.TANGENT,{size:4,data:d,exclusive:!0}]),A.push([M.TANGENT,T]));const R=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),D=new mn(O,A,Bl.Triangle,R);g.push(D),_.push(f),x.push(this._getOrCreateMaterial(t,w))}return b&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,transformations:_,materials:x,objectTransformation:p}}_createEdgeMaterial(){const t={opacity:this._getLayerOpacity()};return nPe(this.symbolLayer,t)}}const oU=$(),Ka=$(),iA=$(),sA=$(),nA=$(),Nve=$e(),e3=Ts(),VX=ao(),$St=[new ySt];var dh;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(dh||(dh={}));class DSt{constructor(t,r,i,s){this.graphics3DSymbolLayer=t,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const r=this._lodRenderer.instanceData;t!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,r,i){if(this.elevationAligner){gce(this.elevationContext.featureExpressionInfoContext,i);const s=this.elevationAligner(this,this.elevationContext,t,r);v(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=$()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,jg),je(t,this._lodRenderer.baseBoundingSphere.center,jg)}getBoundingBoxObjectSpace(t=ao()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,jg);const r=this._lodRenderer.baseBoundingBox;es(t);for(let i=0;i<8;++i)ue(yp,(1&i)==0?r[0]:r[3],(2&i)==0?r[1]:r[4],(4&i)==0?r[2]:r[5]),je(yp,yp,jg),x0(t,yp);return t}computeAttachmentOrigin(t){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,jg),t.render.origin[0]+=jg[12],t.render.origin[1]+=jg[13],t.render.origin[2]+=jg[14],t.render.num++}async getProjectedBoundingBox(t,r,i,s,n){const o=this.getBoundingBoxObjectSpace(n),a=LSt,l=voe(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,jg);for(let d=0;d<l;d++){const p=a[d];yp[0]=o[p[0]],yp[1]=o[p[1]],yp[2]=o[p[2]],je(yp,yp,jg),PT[3*d+0]=yp[0],PT[3*d+1]=yp[1],PT[3*d+2]=yp[2]}if(!t(PT,0,l))return null;es(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let d=0;d<3*l;d+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],PT[d+p]),o[p+3]=Math.max(o[p+3],PT[d+p]);c&&i.push({location:PT.slice(d,d+3),screenSpaceBoundingRect:c})}if(r&&(Gm(o,jX),this.elevationContext.mode!=="absolute-height")){let d;const p=fce(o,r.service.spatialReference,r);try{d=await r.service.queryElevation(jX[0],jX[1],s,p,"ground")}catch{}v(d)&&COe(o,0,0,-this.alignedSampledElevation+d)}return o}addObjectState(t,r){if(t===Kv.Highlight){const i=new zV(t);this._addHighlightId(i),r.addExternal(s=>{this._removeHighlightId(s)},i)}}removeObjectState(t){this._highlights.forEach(r=>t.remove(r))}_addHighlightId(t){this._highlights.add(t),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const PT=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],yp=$(),jX=$(),LSt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],jg=$e();function NSt(e){const t=[];return e.stageResources.geometries.forEach((r,i)=>{const s=e.stageResources.materials[i],n=e.stageResources.textures;t.push({material:s,geometry:r,textures:n})}),{components:t,minScreenSpaceRadius:v(e.lodThreshold)?e.lodThreshold:0,pivotOffset:e.pivotOffset}}function FSt(e){return{levels:e.map(t=>NSt(t))}}function kSt(e,t=BSt){const r=fbt(e);return Math.sqrt(r/(t*Math.PI))}function USt(e){e.levels.forEach(t=>{t.minScreenSpaceRadius||(t.minScreenSpaceRadius=kSt(t))})}const BSt=.05;function J8t(e){return e=e||globalThis.location.hostname,VSt.some(t=>(e==null?void 0:e.match(t))!=null)}function zSt(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(M4e)!=null||t.match(I4e)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(R4e)!=null||t.match(P4e)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const M4e=/^devext.arcgis.com$/,R4e=/^qaext.arcgis.com$/,I4e=/^[\w-]*\.mapsdevext.arcgis.com$/,P4e=/^[\w-]*\.mapsqa.arcgis.com$/,VSt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,M4e,R4e,/^jsapps.esri.com$/,I4e,P4e];function jSt(e,t,r){if(e.count!==t.count)return void H7.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],d=r[6],p=r[7],f=r[8],m=r[9],g=r[10],_=r[11],x=r[12],b=r[13],w=r[14],T=r[15],E=e.typedBuffer,O=e.typedBufferStride,A=t.typedBuffer,R=t.typedBufferStride;for(let D=0;D<i;D++){const k=D*O,L=D*R,q=A[L],G=A[L+1],J=A[L+2],ee=A[L+3];E[k]=s*q+l*G+f*J+x*ee,E[k+1]=n*q+c*G+m*J+b*ee,E[k+2]=o*q+d*G+g*J+w*ee,E[k+3]=a*q+p*G+_*J+T*ee}}function $4e(e,t,r){if(e.count!==t.count)return void H7.error("source and destination buffers need to have the same number of elements");const i=e.count,s=r[0],n=r[1],o=r[2],a=r[3],l=r[4],c=r[5],d=r[6],p=r[7],f=r[8],m=e.typedBuffer,g=e.typedBufferStride,_=t.typedBuffer,x=t.typedBufferStride;for(let b=0;b<i;b++){const w=b*g,T=b*x,E=_[T],O=_[T+1],A=_[T+2],R=_[T+3];m[w]=s*E+a*O+d*A,m[w+1]=n*E+l*O+p*A,m[w+2]=o*E+c*O+f*A,m[w+3]=R}}function GSt(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<r;a++){const l=a*s,c=a*o,d=n[c],p=n[c+1],f=n[c+2],m=d*d+p*p+f*f;if(m>0){const g=1/Math.sqrt(m);i[l]=g*d,i[l+1]=g*p,i[l+2]=g*f}}}function $re(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,d=l*a;s[c]=r*o[d],s[c+1]=r*o[d+1],s[c+2]=r*o[d+2],s[c+3]=r*o[d+3]}}function HSt(e,t,r){const i=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*n,d=l*a;s[c]=o[d]>>r,s[c+1]=o[d+1]>>r,s[c+2]=o[d+2]>>r,s[c+3]=o[d+3]>>r}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:jSt,transformMat3:$4e,normalize:GSt,scale:$re,shiftRight:HSt},Symbol.toStringTag,{value:"Module"}));function qSt(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let d=0;d<a;++d){for(let p=0;p<9;++p)i[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:qSt},Symbol.toStringTag,{value:"Module"}));function WSt(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let d=0;d<a;++d){for(let p=0;p<16;++p)i[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:WSt},Symbol.toStringTag,{value:"Module"}));function XSt(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let d=0;d<a;++d)i[l]=n[c],l+=s,c+=o}function ZB(e,t){const r=e.count;t||(t=new e.TypedArrayConstructor(r));for(let i=0;i<r;i++)t[i]=e.get(i);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:XSt,makeDense:ZB},Symbol.toStringTag,{value:"Module"}));function D4e(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let d=0;d<a;++d)i[l]=n[c],i[l+1]=n[c+1],l+=s,c+=o}function L4e(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;if(eft(t.elementType)){const d=tft(t.elementType);if(Qpt(t.elementType))for(let p=0;p<a;++p)i[l]=Math.max(n[c]/d,-1),i[l+1]=Math.max(n[c+1]/d,-1),l+=s,c+=o;else for(let p=0;p<a;++p)i[l]=n[c]/d,i[l+1]=n[c+1]/d,l+=s,c+=o}else D4e(e,t,r);return e}function YSt(e,t,r,i){var l,c;const s=e.typedBuffer,n=e.typedBufferStride,o=(l=i==null?void 0:i.count)!=null?l:e.count;let a=((c=i==null?void 0:i.dstIndex)!=null?c:0)*n;for(let d=0;d<o;++d)s[a]=t,s[a+1]=r,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:D4e,normalizeIntegerBuffer:L4e,fill:YSt},Symbol.toStringTag,{value:"Module"}));function fG(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let d=0;d<a;++d)i[l]=n[c],i[l+1]=n[c+1],i[l+2]=n[c+2],l+=s,c+=o}function ZSt(e,t,r,i,s){var c,d;const n=e.typedBuffer,o=e.typedBufferStride,a=(c=s==null?void 0:s.count)!=null?c:e.count;let l=((d=s==null?void 0:s.dstIndex)!=null?d:0)*o;for(let p=0;p<a;++p)n[l]=t,n[l+1]=r,n[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:fG,fill:ZSt},Symbol.toStringTag,{value:"Module"}));function N4e(e,t,r){const i=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*s,c=(r&&r.srcIndex?r.srcIndex:0)*o;for(let d=0;d<a;++d)i[l]=n[c],i[l+1]=n[c+1],i[l+2]=n[c+2],i[l+3]=n[c+3],l+=s,c+=o}function F4e(e,t,r,i,s,n){var d,p;const o=e.typedBuffer,a=e.typedBufferStride,l=(d=n==null?void 0:n.count)!=null?d:e.count;let c=((p=n==null?void 0:n.dstIndex)!=null?p:0)*a;for(let f=0;f<l;++f)o[c]=t,o[c+1]=r,o[c+2]=i,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:N4e,fill:F4e},Symbol.toStringTag,{value:"Module"}));function c2(e,t){return new e(new ArrayBuffer(t*e.ElementCount*RDe(e.ElementType)))}class k4e{constructor(t){this._streamDataRequester=t}async loadJSON(t,r){return this._load("json",t,r)}async loadBinary(t,r){return R0(t)?(Ir(r),aEe(t)):this._load("binary",t,r)}async loadImage(t,r){return this._load("image",t,r)}async _load(t,r,i){if(C(this._streamDataRequester))return(await lr(r,{responseType:JSt[t]})).data;const s=await Jh(this._streamDataRequester.request(r,t,i));if(s.ok===!0)return s.value;throw zh(s.error),new z("",`Request for resource failed: ${s.error}`)}}const JSt={image:"image",binary:"array-buffer",json:"json"};class KSt{error(t){throw new z("gltf-loader-error",t)}errorUnsupported(t){throw new z("gltf-loader-unsupported-feature",t)}errorUnsupportedIf(t,r){t&&this.errorUnsupported(r)}assert(t,r){t||this.error(r)}warn(t){te.getLogger("esri.views.3d.glTF").warn(t)}warnUnsupported(t){this.warn("[Unsupported Feature] "+t)}warnUnsupportedIf(t,r){t&&this.warnUnsupported(r)}}function QSt(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}function e2t(e,t={}){return{data:e,parameters:{wrap:{s:It.REPEAT,t:It.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}class jE{constructor(t,r,i=""){this.major=t,this.minor=r,this._context=i}lessThan(t,r){return this.major<t||t===this.major&&this.minor<r}since(t,r){return!this.lessThan(t,r)}validate(t){if(this.major!==t.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new z(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t})}}clone(){return new jE(this.major,this.minor,this._context)}static parse(t,r=""){const[i,s]=t.split("."),n=/^\s*\d+\s*$/;if(!i||!i.match||!i.match(n))throw new z((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s||!s.match||!s.match(n))throw new z((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const o=parseInt(i,10),a=parseInt(s,10);return new jE(o,a,r)}}class Fve{constructor(t){this._data=t,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const t=this._offset4;return this._offset4+=1,this._dataUint32[t]}readUint8Array(t){const r=4*this._offset4;return this._offset4+=t/4,new Uint8Array(this._data,r,t)}remainingBytes(){return this._data.byteLength-4*this._offset4}}var pL,kve;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(pL||(pL={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(kve||(kve={}));const U4e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},t2t={pbrMetallicRoughness:U4e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},r2t={ESRI_externalColorMixMode:"tint"},Uve=(e={})=>{const t={...U4e,...e.pbrMetallicRoughness},r=i2t({...r2t,...e.extras});return{...t2t,...e,pbrMetallicRoughness:t,extras:r}};function i2t(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const s2t={magFilter:at.LINEAR,minFilter:at.LINEAR_MIPMAP_LINEAR,wrapS:It.REPEAT,wrapT:It.REPEAT},n2t=e=>({...s2t,...e});function o2t(e){let t,r;return e.replace(/^(.*\/)?([^/]*)$/,(i,s,n)=>(t=s||"",r=n||"","")),{dirPart:t,filePart:r}}const aU={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class Q_{constructor(t,r,i,s,n){this._context=t,this._errorContext=r,this.uri=i,this.json=s,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._baseUri=o2t(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.errorUnsupportedIf(s.scenes==null,"Scenes must be defined."),r.errorUnsupportedIf(s.meshes==null,"Meshes must be defined"),r.errorUnsupportedIf(s.nodes==null,"Nodes must be defined."),this._computeNodeParents()}static async load(t,r,i,s){if(R0(i)){const a=j9(i);if(a&&a.mediaType!=="model/gltf-binary")try{const c=JSON.parse(a.isBase64?atob(a.data):a.data);return new Q_(t,r,i,c)}catch{}const l=aEe(i);if(Q_._isGLBData(l))return this._fromGLBData(t,r,i,l)}if(i.endsWith(".gltf")){const a=await t.loadJSON(i,s);return new Q_(t,r,i,a)}const n=await t.loadBinary(i,s);if(Q_._isGLBData(n))return this._fromGLBData(t,r,i,n);const o=await t.loadJSON(i,s);return new Q_(t,r,i,o)}static _isGLBData(t){if(t==null)return!1;const r=new Fve(t);return r.remainingBytes()>=4&&r.readUint32()===aU.MAGIC}static async _fromGLBData(t,r,i,s){const n=await Q_._parseGLBData(r,s);return new Q_(t,r,i,n.json,n.binaryData)}static async _parseGLBData(t,r){const i=new Fve(r);t.assert(i.remainingBytes()>=12,"GLB binary data is insufficiently large.");const s=i.readUint32(),n=i.readUint32(),o=i.readUint32();t.assert(s===aU.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(r.byteLength>=o,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(n!==2,"An unsupported GLB container version was detected. Only version 2 is supported.");let a,l,c=0;for(;i.remainingBytes()>=8;){const d=i.readUint32(),p=i.readUint32();c===0?(t.assert(p===aU.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),t.assert(d>=0,"No JSON data found."),a=await h2t(i.readUint8Array(d))):c===1?(t.errorUnsupportedIf(p!==aU.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),l=i.readUint8Array(d)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return a||t.error("No GLB JSON chunk detected."),{json:a,binaryData:l}}async getBuffer(t,r){const i=this.json.buffers[t],s=this._errorContext;if(i.uri==null)return s.assert(this._glbBuffer!=null,"GLB buffer not present"),this._glbBuffer;const n=await this._getBufferLoader(t,r);return s.assert(n.byteLength===i.byteLength,"Buffer byte lengths should match."),n}async _getBufferLoader(t,r){const i=this._bufferLoaders.get(t);if(i)return i;const s=this.json.buffers[t].uri,n=this._context.loadBinary(this._resolveUri(s),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(t,n),n}async getAccessor(t,r){const i=this._errorContext;i.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const s=this.json.accessors[t];i.errorUnsupportedIf((s==null?void 0:s.bufferView)==null,"Some accessor does not specify a bufferView."),i.errorUnsupportedIf(s.type in[pL.MAT2,pL.MAT3,pL.MAT4],`AttributeType ${s.type} is not supported`);const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,r),a=c2t[s.type],l=u2t[s.componentType],c=a*l,d=n.byteStride||c;return{raw:o.buffer,byteStride:d,byteOffset:o.byteOffset+(n.byteOffset||0)+(s.byteOffset||0),entryCount:s.count,isDenselyPacked:d===c,componentCount:a,componentByteSize:l,componentType:s.componentType,min:s.min,max:s.max,normalized:!!s.normalized}}async getIndexData(t,r){if(t.indices==null)return;const i=await this.getAccessor(t.indices,r);if(i.isDenselyPacked)switch(i.componentType){case mt.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case mt.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case mt.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case mt.UNSIGNED_BYTE:return ZB(this._wrapAccessor(Qv,i));case mt.UNSIGNED_SHORT:return ZB(this._wrapAccessor(IE,i));case mt.UNSIGNED_INT:return ZB(this._wrapAccessor($E,i))}}async getPositionData(t,r){const i=this._errorContext;i.errorUnsupportedIf(t.attributes.POSITION==null,"No POSITION vertex data found.");const s=await this.getAccessor(t.attributes.POSITION,r);return i.errorUnsupportedIf(s.componentType!==mt.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+mt[s.componentType]),i.errorUnsupportedIf(s.componentCount!==3,"POSITION vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(Ii,s)}async getNormalData(t,r){const i=this._errorContext;i.assert(t.attributes.NORMAL!=null,"No NORMAL vertex data found.");const s=await this.getAccessor(t.attributes.NORMAL,r);return i.errorUnsupportedIf(s.componentType!==mt.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+mt[s.componentType]),i.errorUnsupportedIf(s.componentCount!==3,"NORMAL vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(Ii,s)}async getTangentData(t,r){const i=this._errorContext;i.assert(t.attributes.TANGENT!=null,"No TANGENT vertex data found.");const s=await this.getAccessor(t.attributes.TANGENT,r);return i.errorUnsupportedIf(s.componentType!==mt.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+mt[s.componentType]),i.errorUnsupportedIf(s.componentCount!==4,"TANGENT vertex attribute must have 4 components, but found "+s.componentCount.toFixed()),new ga(s.raw,s.byteOffset,s.byteStride,s.byteOffset+s.byteStride*s.entryCount)}async getTextureCoordinates(t,r){const i=this._errorContext;i.assert(t.attributes.TEXCOORD_0!=null,"No TEXCOORD_0 vertex data found.");const s=await this.getAccessor(t.attributes.TEXCOORD_0,r);return i.errorUnsupportedIf(s.componentCount!==2,"TEXCOORD_0 vertex attribute must have 2 components, but found "+s.componentCount.toFixed()),s.componentType===mt.FLOAT?this._wrapAccessor(Af,s):(i.errorUnsupportedIf(!s.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),d2t(s))}async getVertexColors(t,r){const i=this._errorContext;i.assert(t.attributes.COLOR_0!=null,"No COLOR_0 vertex data found.");const s=await this.getAccessor(t.attributes.COLOR_0,r);if(i.errorUnsupportedIf(s.componentCount!==4&&s.componentCount!==3,"COLOR_0 attribute must have 3 or 4 components, but found "+s.componentCount.toFixed()),s.componentCount===4){if(s.componentType===mt.FLOAT)return this._wrapAccessor(ga,s);if(s.componentType===mt.UNSIGNED_BYTE)return this._wrapAccessor(Go,s);if(s.componentType===mt.UNSIGNED_SHORT)return this._wrapAccessor(Dx,s)}else if(s.componentCount===3){if(s.componentType===mt.FLOAT)return this._wrapAccessor(Ii,s);if(s.componentType===mt.UNSIGNED_BYTE)return this._wrapAccessor($x,s);if(s.componentType===mt.UNSIGNED_SHORT)return this._wrapAccessor(PE,s)}i.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+mt[s.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,r,i){var n,o,a,l,c,d,p,f,m,g;let s=t.material?this._materialCache.get(t.material):void 0;if(!s){const _=t.material!=null?Uve(this.json.materials[t.material]):Uve(),x=_.pbrMetallicRoughness,b=this.hasVertexColors(t),w=this.getTexture(x.baseColorTexture,r),T=this.getTexture(_.normalTexture,r),E=i?this.getTexture(_.occlusionTexture,r):void 0,O=i?this.getTexture(_.emissiveTexture,r):void 0,A=i?this.getTexture(x.metallicRoughnessTexture,r):void 0,R=t.material!=null?t.material:-1;s={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:x.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await w,normalTexture:await T,name:_.name,id:R,occlusionTexture:await E,emissiveTexture:await O,emissiveFactor:_.emissiveFactor,metallicFactor:x.metallicFactor,roughnessFactor:x.roughnessFactor,metallicRoughnessTexture:await A,hasVertexColors:b,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(n=x==null?void 0:x.baseColorTexture)==null?void 0:n.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(d=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:d.KHR_texture_transform,emissiveTextureTransform:(f=(p=_.emissiveTexture)==null?void 0:p.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(g=(m=x==null?void 0:x.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:g.KHR_texture_transform}}return s}async getTexture(t,r){if(!t)return;this._errorContext.errorUnsupportedIf((t.texCoord||0)!==0,"Only TEXCOORD with index 0 is supported.");const i=t.index,s=this._errorContext,n=this.json.textures[i],o=n2t(n.sampler!=null?this.json.samplers[n.sampler]:{});s.errorUnsupportedIf(n.source==null,"Source is expected to be defined for a texture.");const a=this.json.images[n.source],l=await this._loadTextureImageData(i,n,r);return Hse(this._textureCache,i,()=>{const c=p=>p===33071||p===33648||p===10497,d=p=>(s.error(`Unexpected TextureSampler WrapMode: ${p}. Using default REPEAT(10497).`),10497);return{data:l,wrapS:c(o.wrapS)?o.wrapS:d(o.wrapS),wrapT:c(o.wrapT)?o.wrapT:d(o.wrapT),minFilter:o.minFilter,name:a.name,id:i}})}getNodeTransform(t){if(t===void 0)return l2t;let r=this._nodeTransformCache.get(t);if(!r){const i=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?r=Hs($e(),i,s.matrix):s.translation||s.rotation||s.scale?(r=U2(i),s.translation&&Pu(r,r,s.translation),s.rotation&&(lU[3]=wae(lU,s.rotation),Sd(r,r,lU[3],lU)),s.scale&&Oj(r,r,s.scale)):r=i,this._nodeTransformCache.set(t,r)}return r}_wrapAccessor(t,r){return new t(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(t){return Rh(t,this._baseUri)}_getNodeParent(t){return this._nodeParentMap.get(t)}_checkVersionSupported(){const t=jE.parse(this.json.asset.version,"glTF");a2t.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json,r=this._errorContext;t.extensionsRequired&&t.extensionsRequired.length!==0&&r.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,r)=>{t.children&&t.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(t,r,i){const s=this._textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(r,i);return this._textureLoaders.set(t,n),n}async _createTextureLoader(t,r){const i=this.json.images[t.source];if(i.uri)return this._context.loadImage(this._resolveUri(i.uri),r);const s=this._errorContext;s.errorUnsupportedIf(i.bufferView==null,"Image bufferView must be defined."),s.errorUnsupportedIf(i.mimeType==null,"Image mimeType must be defined.");const n=this.json.bufferViews[i.bufferView],o=await this.getBuffer(n.buffer,r);return s.errorUnsupportedIf(n.byteStride!=null,"byteStride not supported for image buffer"),p2t(new Uint8Array(o.buffer,o.byteOffset+(n.byteOffset||0),n.byteLength),i.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const t=await ZZ(Array.from(this._bufferLoaders.values())),r=await ZZ(Array.from(this._textureLoaders.values()));return t.reduce((i,s)=>{var n;return i+((n=s==null?void 0:s.byteLength)!=null?n:0)},0)+r.reduce((i,s)=>i+(s?s.width*s.height*4:0),0)}}const a2t=new jE(2,0,"glTF"),l2t=LRe($e(),Math.PI/2),lU=wg(),c2t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},u2t={[mt.BYTE]:1,[mt.UNSIGNED_BYTE]:1,[mt.SHORT]:2,[mt.UNSIGNED_SHORT]:2,[mt.FLOAT]:4,[mt.UNSIGNED_INT]:4};function d2t(e){switch(e.componentType){case mt.BYTE:return new DE(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case mt.UNSIGNED_BYTE:return new RE(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case mt.SHORT:return new LE(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case mt.UNSIGNED_SHORT:return new KR(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case mt.UNSIGNED_INT:return new QR(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case mt.FLOAT:return new Af(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount)}}async function h2t(e){return new Promise((t,r)=>{const i=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{r(n)},s.readAsText(i)})}async function p2t(e,t){return new Promise((r,i)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image,a=()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=d=>{URL.revokeObjectURL(n),i(d),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=n})}let f2t=0;async function B4e(e,t,r={},i=!0){const s=await Q_.load(e,JB,t,r),n="gltf_"+f2t++,o={lods:[],materials:new Map,textures:new Map,meta:m2t(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await g2t(s,async(d,p,f,m)=>{var L;const g=(L=l.get(f))!=null?L:0;l.set(f,g+1);const _=d.mode!==void 0?d.mode:Ut.TRIANGLES,x=_===Ut.TRIANGLES||_===Ut.TRIANGLE_STRIP||_===Ut.TRIANGLE_FAN?_:null;if(C(x))return void JB.warnUnsupported("Unsupported primitive mode ("+Ut[_]+"). Skipping primitive.");if(!s.hasPositions(d))return void JB.warn("Skipping primitive without POSITION vertex attribute.");const b=s.getPositionData(d,r),w=s.getMaterial(d,r,i),T=s.hasNormals(d)?s.getNormalData(d,r):null,E=s.hasTangents(d)?s.getTangentData(d,r):null,O=s.hasTextureCoordinates(d)?s.getTextureCoordinates(d,r):null,A=s.hasVertexColors(d)?s.getVertexColors(d,r):null,R=s.getIndexData(d,r),D={transform:U2(p),attributes:{position:await b,normal:T?await T:null,texCoord0:O?await O:null,color:A?await A:null,tangent:E?await E:null},indices:await R,primitiveType:x,material:_2t(o,await w,n)};let k=null;v(o.meta)&&v(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(k=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:k},o.lods[f].parts[g]=D});for(const d of o.lods)d.parts=d.parts.filter(p=>!!p);const c=await s.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{},size:c}}function m2t(e){const t=e.json;let r=null;return t.nodes.forEach(i=>{const s=i.extras;v(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(r=s)}),r}async function g2t(e,t){const r=e.json,i=r.scenes[r.scene||0].nodes,s=i.length>1,n=[];for(const a of i){const l=r.nodes[a];n.push(o(a,0)),y2t(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,d)=>o(c,d+1))}async function o(a,l){const c=r.nodes[a],d=e.getNodeTransform(a);if(JB.warnUnsupportedIf(c.weights!=null,"Morph targets are not supported."),c.mesh!=null){const p=r.meshes[c.mesh];for(const f of p.primitives)n.push(t(f,d,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function y2t(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function _2t(e,t,r){const i=n=>{const o=`${r}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=e2t(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:v2t.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${r}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=QSt({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?i(t.colorTexture):void 0,textureNormal:t.normalTexture?i(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?i(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?i(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?i(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],colorTextureTransform:t.colorTextureTransform,normalTextureTransform:t.normalTextureTransform,occlusionTextureTransform:t.occlusionTextureTransform,emissiveTextureTransform:t.emissiveTextureTransform,metallicRoughnessTextureTransform:t.metallicRoughnessTextureTransform,metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const JB=new KSt,v2t=[at.LINEAR_MIPMAP_LINEAR,at.LINEAR_MIPMAP_NEAREST];function b2t(e,t=tI){return typeof e=="number"?t(e):$se(e)||XS(e)?new Uint32Array(e):e}function w2t(e){const t=typeof e=="number"?e:e.length;if(t<3)return[];const r=t-2,i=dft(r);if(typeof e=="number"){let s=0;for(let n=0;n<r;n+=1)n%2==0?(i[s++]=n,i[s++]=n+1,i[s++]=n+2):(i[s++]=n+1,i[s++]=n,i[s++]=n+2)}else{let s=0;for(let n=0;n<r;n+=1)if(n%2==0){const o=e[n],a=e[n+1],l=e[n+2];i[s++]=o,i[s++]=a,i[s++]=l}else{const o=e[n+1],a=e[n],l=e[n+2];i[s++]=o,i[s++]=a,i[s++]=l}}return i}function x2t(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof e=="number"){let s=0;for(let n=0;n<r;++n)i[s++]=0,i[s++]=n+1,i[s++]=n+2;return i}{const s=e[0];let n=e[1],o=0;for(let a=0;a<r;++a){const l=e[a+2];i[o++]=s,i[o++]=n,i[o++]=l,n=l}return i}}class T2t{constructor(t,r,i,s,n){this.name=t,this.stageResources=r,this.lodThreshold=i,this.pivotOffset=s,this.numberOfVertices=n}}const D_=te.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function z4e(e,t){const r=await S2t(e,t),i=await M2t(r.textureDefinitions,t);let s=0;for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];s+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:s+_Pe(r)}}async function S2t(e,t){const r=v(t)&&t.streamDataRequester;if(r)return E2t(e,r,t);const i=await Jh(lr(e,t));if(i.ok===!0)return i.value.data;zh(i.error),V4e(i.error)}async function E2t(e,t,r){const i=await Jh(t.request(e,"json",r));if(i.ok===!0)return i.value;zh(i.error),V4e(i.error.details.url)}function V4e(e){throw new z("",`Request for object resource failed: ${e}`)}function C2t(e){const t=e.params,r=t.topology;let i=!0;switch(t.vertexAttributes||(D_.warn("Geometry must specify vertex attributes"),i=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(D_.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(D_.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(D_.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else D_.warn("Indexed geometries must specify faces"),i=!1;break}default:D_.warn(`Unsupported topology '${r}'`),i=!1}e.params.material||(D_.warn("Geometry requires material"),i=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(D_.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function A2t(e,t){const r=[],i=[],s=[],n=[],o=e.resource,a=jE.parse(o.version||"1.0","wosr");I2t.validate(a);const l=o.model.name,c=o.model.geometries,d=o.materialDefinitions,p=e.textures;let f=0;const m=new Map;for(let g=0;g<c.length;g++){const _=c[g];if(!C2t(_))continue;const x=R2t(_),b=_.params.vertexAttributes,w=[];for(const k in b){const L=b[k],q=L.values;w.push([k,{data:q,size:L.valuesPerElement,exclusive:!0}])}const T=[];if(_.params.topology!=="PerAttributeArray"){const k=_.params.faces;for(const L in k)T.push([L,k[L].values])}const E=p&&p[x.texture];if(E&&!m.has(x.texture)){const{image:k,params:L}=E,q=new ka(k,L);n.push(q),m.set(x.texture,q)}const O=m.get(x.texture),A=O?O.id:void 0;let R=s[x.material]?s[x.material][x.texture]:null;if(!R){const k=d[x.material.substring(x.material.lastIndexOf("/")+1)].params;k.transparency===1&&(k.transparency=0);const L=E&&E.alphaChannelUsage,q=k.transparency>0||L==="transparency"||L==="maskAndTransparency",G=E?j4e(E.alphaChannelUsage):void 0,J={ambient:pu(k.diffuse),diffuse:pu(k.diffuse),opacity:1-(k.transparency||0),transparent:q,textureAlphaMode:G,textureAlphaCutoff:.33,textureId:A,initTextureTransparent:!0,doubleSided:!0,cullFace:Xi.None,colorMixMode:k.externalColorMixMode||"tint",textureAlphaPremultiplied:!!E&&!!E.params.preMultiplyAlpha};v(t)&&t.materialParamsMixin&&Object.assign(J,t.materialParamsMixin),R=new VE(J),s[x.material]||(s[x.material]={}),s[x.material][x.texture]=R}i.push(R);const D=new mn(w,T);f+=T.position?T.position.length:0,r.push(D)}return{engineResources:[{name:l,stageResources:{textures:n,materials:i,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:O2t(r)}}function O2t(e){const t=es();return e.forEach(r=>{const i=r.boundingInfo;v(i)&&(x0(t,i.getBBMin()),x0(t,i.getBBMax()))}),t}async function M2t(e,t){const r=[];for(const n in e){const o=e[n],a=o.images[0].data;if(!a){D_.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,d=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:It.REPEAT,t:It.REPEAT},preMultiplyAlpha:j4e(d)!==Mi.Opaque},f=v(t)&&t.disableTextures?Promise.resolve(null):A0(l,t);r.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:d})))}const i=await Promise.all(r),s={};for(const n of i)s[n.refId]=n;return s}function j4e(e){switch(e){case"mask":return Mi.Mask;case"maskAndTransparency":return Mi.MaskBlend;case"none":return Mi.Opaque;default:return Mi.Blend}}function R2t(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const I2t=new jE(1,2,"wosr"),oA=2.1;async function G4e(e,t){const r=H4e(zSt(e));if(r.fileType==="wosr"){const d=await(t.cache?t.cache.loadWOSR(r.url,t):z4e(r.url,t)),{engineResources:p,referenceBoundingBox:f}=A2t(d,t);return{lods:p,referenceBoundingBox:f,isEsriSymbolResource:!1,isWosr:!0}}const i=await(t.cache?t.cache.loadGLTF(r.url,t,t.usePBR):B4e(new k4e(t.streamDataRequester),r.url,t,t.usePBR)),s=Ks(i.model.meta,"ESRI_proxyEllipsoid"),n=i.meta.isEsriSymbolResource&&v(s)&&i.meta.uri.includes("/RealisticTrees/");n&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,L2t(i,s));const o=i.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:n,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},a={...t.materialParamsMixin,treeRendering:n},{engineResources:l,referenceBoundingBox:c}=q4e(i,o,a,t.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:l,referenceBoundingBox:c,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function H4e(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function q4e(e,t,r,i){const s=e.model,n=new Array,o=new Map,a=new Map,l=s.lods.length,c=es();return s.lods.forEach((d,p)=>{const f=i.skipHighLods===!0&&(l>1&&p===0||l>3&&p===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&p!==i.singleLodIndex;if(f&&p!==0)return;const m=new Array;let g=0;if(d.parts.forEach(x=>{const{geometry:b,vertexCount:w}=P2t(x);m.push(b),g+=w;const T=b.boundingInfo;v(T)&&p===0&&(x0(c,T.getBBMin()),x0(c,T.getBBMax()))}),f)return;const _=new T2t(d.name,{textures:new Array,materials:new Array,geometries:m},d.lodThreshold,[0,0,0],g);n.push(_),d.parts.forEach(x=>{const b=x.material+(x.attributes.normal?"_normal":"")+(x.attributes.color?"_color":"")+(x.attributes.texCoord0?"_texCoord0":"")+(x.attributes.tangent?"_tangent":""),w=s.materials.get(x.material),T=v(x.attributes.texCoord0),E=v(x.attributes.normal);if(C(w))return;const O=$2t(w.alphaMode);if(!o.has(b)){if(T){const J=(ee,se=!1)=>{if(v(ee)&&!a.has(ee)){const X=s.textures.get(ee);v(X)&&a.set(ee,new ka(X.data,se?{...X.parameters,preMultiplyAlpha:se}:X.parameters))}};J(w.textureColor,O!==Mi.Opaque),J(w.textureNormal),J(w.textureOcclusion),J(w.textureEmissive),J(w.textureMetallicRoughness)}const A=w.color[0]**(1/oA),R=w.color[1]**(1/oA),D=w.color[2]**(1/oA),k=w.emissiveFactor[0]**(1/oA),L=w.emissiveFactor[1]**(1/oA),q=w.emissiveFactor[2]**(1/oA),G=v(w.textureColor)&&T?a.get(w.textureColor):null;o.set(b,new VE({...t,transparent:O===Mi.Blend,customDepthTest:SE.Lequal,textureAlphaMode:O,textureAlphaCutoff:w.alphaCutoff,diffuse:[A,R,D],ambient:[A,R,D],opacity:w.opacity,doubleSided:w.doubleSided,doubleSidedType:"winding-order",cullFace:w.doubleSided?Xi.None:Xi.Back,hasVertexColors:!!x.attributes.color,hasVertexTangents:!!x.attributes.tangent,normals:E?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:v(G)?G.id:void 0,colorMixMode:w.colorMixMode,normalTextureId:v(w.textureNormal)&&T?a.get(w.textureNormal).id:void 0,textureAlphaPremultiplied:v(G)&&!!G.params.preMultiplyAlpha,occlusionTextureId:v(w.textureOcclusion)&&T?a.get(w.textureOcclusion).id:void 0,emissiveTextureId:v(w.textureEmissive)&&T?a.get(w.textureEmissive).id:void 0,metallicRoughnessTextureId:v(w.textureMetallicRoughness)&&T?a.get(w.textureMetallicRoughness).id:void 0,emissiveFactor:[k,L,q],mrrFactors:[w.metallicFactor,w.roughnessFactor,t.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:qy(w.colorTextureTransform),normalTextureTransformMatrix:qy(w.normalTextureTransform),occlusionTextureTransformMatrix:qy(w.occlusionTextureTransform),emissiveTextureTransformMatrix:qy(w.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:qy(w.metallicRoughnessTextureTransform),...r}))}if(_.stageResources.materials.push(o.get(b)),T){const A=R=>{v(R)&&_.stageResources.textures.push(a.get(R))};A(w.textureColor),A(w.textureNormal),A(w.textureOcclusion),A(w.textureEmissive),A(w.textureMetallicRoughness)}})}),{engineResources:n,referenceBoundingBox:c}}function P2t(e){const t=D2t(e.indices||e.attributes.position.count,e.primitiveType),r=e.attributes.position.count,i=c2(Ii,r);_4(i,e.attributes.position,e.transform);const s=[[M.POSITION,{data:i.typedBuffer,size:i.elementCount,exclusive:!0}]],n=[[M.POSITION,t]];if(v(e.attributes.normal)){const o=c2(Ii,r);FR(cU,e.transform),zx(o,e.attributes.normal,cU),s.push([M.NORMAL,{data:o.typedBuffer,size:o.elementCount,exclusive:!0}]),n.push([M.NORMAL,t])}if(v(e.attributes.tangent)){const o=c2(ga,r);FR(cU,e.transform),$4e(o,e.attributes.tangent,cU),s.push([M.TANGENT,{data:o.typedBuffer,size:o.elementCount,exclusive:!0}]),n.push([M.TANGENT,t])}if(v(e.attributes.texCoord0)){const o=c2(Af,r);L4e(o,e.attributes.texCoord0),s.push([M.UV0,{data:o.typedBuffer,size:o.elementCount,exclusive:!0}]),n.push([M.UV0,t])}if(v(e.attributes.color)){const o=c2(Go,r);if(e.attributes.color.elementCount===4)e.attributes.color instanceof ga?$re(o,e.attributes.color,255):e.attributes.color instanceof Go?N4e(o,e.attributes.color):e.attributes.color instanceof Dx&&$re(o,e.attributes.color,1/256);else{F4e(o,255,255,255,255);const a=new $x(o.buffer,0,4);e.attributes.color instanceof Ii?wre(a,e.attributes.color,255):e.attributes.color instanceof $x?fG(a,e.attributes.color):e.attributes.color instanceof PE&&wre(a,e.attributes.color,1/256)}s.push([M.COLOR,{data:o.typedBuffer,size:o.elementCount,exclusive:!0}]),n.push([M.COLOR,t])}return{geometry:new mn(s,n),vertexCount:r}}const cU=Ts();function $2t(e){switch(e){case"BLEND":return Mi.Blend;case"MASK":return Mi.Mask;case"OPAQUE":case null:case void 0:return Mi.Opaque}}function D2t(e,t){switch(t){case Ut.TRIANGLES:return b2t(e);case Ut.TRIANGLE_STRIP:return w2t(e);case Ut.TRIANGLE_FAN:return x2t(e)}}function L2t(e,t){for(let r=0;r<e.model.lods.length;++r){const i=e.model.lods[r];for(const s of i.parts){const n=s.attributes.normal;if(C(n))return;const o=s.attributes.position,a=o.count,l=$(),c=$(),d=$(),p=c2(Go,a),f=c2(Ii,a),m=Pn($e(),s.transform);for(let g=0;g<a;g++){o.getVec(g,c),n.getVec(g,l),je(c,c,s.transform),ge(d,c,t.center),gz(d,d,t.radius);const _=d[2],x=Ie(d),b=Math.min(.45+.55*x*x,1);gz(d,d,t.radius),m!==null&&je(d,d,m),xe(d,d),r+1!==e.model.lods.length&&e.model.lods.length>1&&$n(d,d,l,_>-1?.2:Math.min(-4*_-3.8,1)),f.setVec(g,d),p.set(g,0,255*b),p.set(g,1,255*b),p.set(g,2,255*b),p.set(g,3,255)}s.attributes.normal=f,s.attributes.color=p}}}const K8t=Object.freeze(Object.defineProperty({__proto__:null,fetch:G4e,gltfToEngineResources:q4e,parseUrl:H4e},Symbol.toStringTag,{value:"Module"}));var ys;function N2t(e){let t=Ds().mat4f64(M.LOCALTRANSFORM).mat4f64(M.GLOBALTRANSFORM).vec4f64(M.BOUNDINGSPHERE).vec3f64(M.MODELORIGIN).mat3f(M.MODEL).mat3f(M.MODELNORMAL).vec2f(M.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(M.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(M.FEATUREATTRIBUTE)),t=t.u8(M.STATE).u8(M.LODLEVEL),e.includes(M.OBJECTANDLAYERIDCOLOR)&&(t=t.vec4u8(M.OBJECTANDLAYERIDCOLOR)),t.alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(ys||(ys={}));class F2t{constructor(t){this.localTransform=t.getField(M.LOCALTRANSFORM,Px),this.globalTransform=t.getField(M.GLOBALTRANSFORM,Px),this.modelOrigin=t.getField(M.MODELORIGIN,qn),this.model=t.getField(M.MODEL,gg),this.modelNormal=t.getField(M.MODELNORMAL,gg),this.modelScaleFactors=t.getField(M.MODELSCALEFACTORS,Af),this.boundingSphere=t.getField(M.BOUNDINGSPHERE,ME),this.color=t.getField(M.COLOR,ga),this.featureAttribute=t.getField(M.FEATUREATTRIBUTE,ga),this.state=t.getField(M.STATE,Qv),this.lodLevel=t.getField(M.LODLEVEL,Qv),this.objectAndLayerIdColor=t.getField(M.OBJECTANDLAYERIDCOLOR,Go)}}class k2t extends $s{constructor(t,r){super(),this._capacity=0,this._size=0,this._next=0,this._buffer=null,this._view=null,this._layout=N2t(t),this._shaderTransformation=r}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,ys.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const r=this._view.state;Et(t>=0&&t<this._capacity&&r.get(t)&ys.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,ys.ACTIVE)?this._setStateFlags(t,ys.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t})}freeInstance(t){const r=this._view.state;Et(t>=0&&t<this._capacity&&r.get(t)&ys.ALLOCATED,"invalid instance handle"),r.set(t,0),this._size--}setLocalTransform(t,r,i=!0){this._view.localTransform.setMat(t,r),i&&this.updateModelTransform(t)}getLocalTransform(t,r){this._view.localTransform.getMat(t,r)}setGlobalTransform(t,r,i=!0){this._view.globalTransform.setMat(t,r),i&&this.updateModelTransform(t)}getGlobalTransform(t,r){this._view.globalTransform.getMat(t,r)}updateModelTransform(t){const r=this._view,i=K1,s=Gf;r.localTransform.getMat(t,Bve),r.globalTransform.getMat(t,GX);const n=Hs(GX,GX,Bve);ue(i,n[12],n[13],n[14]),r.modelOrigin.setVec(t,i),Tf(s,n),r.model.setMat(t,s);const o=Mnt(K1,n);o.sort(),r.modelScaleFactors.set(t,0,o[1]),r.modelScaleFactors.set(t,1,o[2]),uC(s,s),Sf(s,s),r.modelNormal.setMat(t,s),this._setStateFlags(t,ys.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t})}getModelTransform(t,r){const i=this._view;i.model.getMat(t,Gf),i.modelOrigin.getVec(t,K1),r[0]=Gf[0],r[1]=Gf[1],r[2]=Gf[2],r[3]=0,r[4]=Gf[3],r[5]=Gf[4],r[6]=Gf[5],r[7]=0,r[8]=Gf[6],r[9]=Gf[7],r[10]=Gf[8],r[11]=0,r[12]=K1[0],r[13]=K1[1],r[14]=K1[2],r[15]=1}applyShaderTransformation(t,r){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,r)}getCombinedModelTransform(t,r){return this.getModelTransform(t,r),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,r),r}getCombinedLocalTransform(t,r){return this._view.localTransform.getMat(t,r),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,r),r}getCombinedMaxScaleFactor(t){let r=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(K1,this,t);r*=Math.max(i[0],i[1],i[2])}return r}getCombinedMedianScaleFactor(t){let r=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(K1,this,t);r*=U2t(i[0],i[1],i[2])}return r}getModel(t,r){this._view.model.getMat(t,r)}setFeatureAttribute(t,r){this._view.featureAttribute.setVec(t,r)}getFeatureAttribute(t,r){this._view.featureAttribute.getVec(t,r)}setColor(t,r){this._view.color.setVec(t,r)}setObjectAndLayerIdColor(t,r){this._view.objectAndLayerIdColor.setVec(t,r)}getColor(t,r){this._view.color.getVec(t,r)}setVisible(t,r){r!==this.getVisible(t)&&(this._setStateFlag(t,ys.VISIBLE,r),this.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,ys.VISIBLE)}setHighlight(t,r){r!==this.getHighlight(t)&&(this._setStateFlag(t,ys.HIGHLIGHT,r),this.emit("instance-highlight-changed",{index:t}))}getHighlight(t){return this._getStateFlag(t,ys.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&t&&++r;return r}_setStateFlags(t,r){const i=this._view.state;r=i.get(t)|r,i.set(t,r)}_clearStateFlags(t,r){const i=this._view.state;r=i.get(t)&~r,i.set(t,r)}_setStateFlag(t,r,i){i?this._setStateFlags(t,r):this._clearStateFlags(t,r)}_getStateFlag(t,r){return!!(this._view.state.get(t)&r)}_grow(){const t=Math.max(B2t,Math.floor(this._capacity*z2t)),r=this._layout.createBuffer(t);if(this._buffer){const i=new Uint8Array(this._buffer.buffer);new Uint8Array(r.buffer).set(i)}this._capacity=t,this._buffer=r,this._view=new F2t(this._buffer)}_findSlot(){const t=this._view.state;let r=this._next;for(;t.get(r)&ys.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}}function U2t(e,t,r){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),r))}const B2t=1024,z2t=2,K1=$(),Gf=Ts(),Bve=$e(),GX=$e();class V2t extends Xm{constructor(t,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=qo(),this._tmpMat4=$e(),this._instanceData=t,this._boundingSphere=r}addInstance(t){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);je(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*xE(i),r.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class j2t{constructor(t,r){this.thresholdScale=1,this._camera=new Li,this._worldSpaceRadius=t,this._thresholds=r.map(i=>i)}updateCamera(t){this._camera.copyFrom(t)}selectLevel(t,r){const i=this._camera.computeScreenPixelSizeAt(t),s=this._worldSpaceRadius*r/i,n=this._thresholds;let o=-1;for(let a=0;a<n.length;++a)s>=n[a]*this.thresholdScale&&(o=a);return o}}class G2t{constructor(t,r){const i=t.renderContext.rctx,{geometry:s,material:n}=r;this._materialRepository=t.materialRep,n.setParameters({instancedDoublePrecision:!0});const o=n.createBufferWriter(),a=o.vertexBufferLayout,l=o.elementCount(s),c=o.allocate(l);o.write(null,null,s,c,0),this.geometry=s,this.material=n,this.glMaterials=new GFe(n,this._materialRepository),this.vertexBufferLayout=a,this.vbo=Ur.createVertex(i,ni.STATIC_DRAW,c.buffer),this.vao=new Cf(i,Yr,{geometry:jd(a)},{geometry:this.vbo}),this.vertexCount=l}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,r,i,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,i,s,(d,p,f,m,g)=>{if(d>=0){if(r!=null&&!r(t.rayBegin,t.rayEnd,d))return;const _={layerUid:o.layerUid,graphicUid:o.graphicUid(n),geometryId:c,triangleNr:f,baseBoundingSphere:a,numLodLevels:l};if((t.results.min.drapedLayerOrder==null||g>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||d<t.results.min.dist)&&t.results.min.set(zs.LOD,_,d,p,t.transform.transform,g),t.options.store!==qa.MIN&&(t.results.max.drapedLayerOrder==null||g>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||d>t.results.max.dist)&&t.results.max.set(zs.LOD,_,d,p,t.transform.transform,g),t.options.store===qa.ALL){const x=Ile(t.results.min.ray);x.set(zs.LOD,_,d,p,t.transform.transform,g),t.results.all.push(x)}}})}}class Nce{constructor(t,r){this.minScreenSpaceRadius=t,this.components=r}static async create(t,r,i){const s=await Promise.allSettled(r.components.map(o=>t.schedule(()=>new G2t(t,o),i))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(Bo(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Ir(i);for(const o of s)if(o.status==="rejected")throw o.reason}return new Nce(r.minScreenSpaceRadius,n)}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,r,i,s,n,o,a){this.components.forEach(l=>l.intersect(t,r,i,s,n,o,this.boundingSphere,a))}get boundingBox(){if(C(this._boundingBox)){const t=es();this.components.forEach(r=>{v(r.boundingInfo)&&(x0(t,r.boundingInfo.bbMin),x0(t,r.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(C(this._boundingSphere)){const t=this.boundingBox,r=$();Gm(t,r),this._boundingSphere={center:r,radius:.5*EOe(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,r)=>t+r.triangleCount,0)}}class H2t{constructor(t,r,i){this._elementSize=r,this._buffer=Ur.createVertex(t,ni.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,r,i,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(r-t)*this.elementSize);new Uint8Array(i.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,r){const i=t*this._elementSize,s=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,s)}resize(t){const r=t*this._elementSize,i=new ArrayBuffer(r);this._array&&(t>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=t}}class q2t{constructor(t){this.modelOriginHi=t.getField(M.MODELORIGINHI,Ii),this.modelOriginLo=t.getField(M.MODELORIGINLO,Ii),this.model=t.getField(M.MODEL,gg),this.modelNormal=t.getField(M.MODELNORMAL,gg),this.color=t.getField(M.INSTANCECOLOR,ga),this.featureAttribute=t.getField(M.INSTANCEFEATUREATTRIBUTE,ga),this.objectAndLayerIdColor=t.getField(M.OBJECTANDLAYERIDCOLOR_INSTANCED,Go)}}class zve{constructor(t,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,r=this._tailIndex;return t>=r?t-r:t+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){Et(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){Et(this._updating,"not updating"),this.size<X2t*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){Et(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),Et(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){Et(this._updating,"not updating"),Et(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(Vve,Math.floor(this._capacity*W2t));this._resize(t)}_shrink(){const t=Math.max(Vve,Math.floor(this._capacity*Y2t));this._resize(t)}_resize(t){if(Et(this._updating,"not updating"),t===this._capacity)return;const r=new H2t(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,s=this._compactInstances(r);Et(s===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=r,this._view=new q2t(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,t),r-i):i>r?(this._buffer.copyRange(i,this._capacity,t),r>0&&this._buffer.copyRange(0,r,t,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,r){t<r?this._buffer.transferRange(t,r):t>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(t,this._capacity))}}const Vve=1024,W2t=2,X2t=.3,Y2t=.5,Z2t=e=>{const t=e.baseBoundingSphere.radius,r=e.levels.map(i=>i.minScreenSpaceRadius);return new j2t(t,r)};class J2t{constructor(t,r,i,s){this.type=zs.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._lastCamera=new Li,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=t,this._optionalFields=r,this._metadata=i,this._instanceBufferLayout=m4e({instancedDoublePrecision:!0,instanced:r}),this._glInstanceBufferLayout=jd(this._instanceBufferLayout,1),this._instanceData=new k2t(this._optionalFields,s),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",n=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(n.index)}),this._instanceData.on("instance-visibility-changed",n=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(n.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const t={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(r=>{const i=r.memoryUsage;t.cpu+=i.cpu,t.gpu+=i.gpu}),this._highlightRenderInstanceData.forEach(r=>{const i=r.memoryUsage;t.cpu+=i.cpu,t.gpu+=i.gpu}),t}get renderStats(){const t=this._instanceData.size,r=[];return this._levels.forEach((i,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=i.triangleCount;r.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:t,renderedInstances:r.reduce((i,s)=>i+s.renderedInstances,0),renderedTriangles:r.reduce((i,s)=>i+s.renderedTriangles,0),levels:r}}async initializeRenderContext(t,r){this._context=t;const i=t.renderContext.rctx,s=await Promise.allSettled(this._symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new zve(i,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new zve(i,this._instanceBufferLayout)),Nce.create(t,o,r)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(Bo(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Ir(r);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=Z2t(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(t=>t.destroy()),this._defaultRenderInstanceData.forEach(t=>t.destroy()),this._highlightRenderInstanceData.forEach(t=>t.destroy())}get needsTransparentPass(){return this._levels.some(t=>t.components.some(r=>r.material.requiresSlot(Ee.TRANSPARENT_MATERIAL,V.Color)))}get needsHighlight(){return this._highlightRenderInstanceData.some(t=>t.size>0)}prepareRender(t){if(hi.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const i=t.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(t.bindParameters.contentCamera),i||this._requestUpdateCycle()}const r=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(t.bindParameters.contentCamera,r),this._needsUpdates&&this._context.requestRender()}render(t){!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(t.output)||(t.rctx.bindVAO(),t.output!==V.Highlight&&t.output!==V.ShadowHighlight&&this._renderComponents(t,this._defaultRenderInstanceData),t.output!==V.ShadowExludeHighlight&&this._renderComponents(t,this._highlightRenderInstanceData))}intersect(t,r,i,s){if(!this.baseMaterial.isVisible())return;const n=$();ge(n,s,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,Hve),t.transform.set(Hve),je(qve,i,t.transform.inverse),je(Wve,s,t.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),d=this._levels.length;Et(l&ys.ACTIVE,"invalid instance state"),Et(c>=0&&c<d,"invaid lod level"),this._levels[c].intersect(t,r,qve,Wve,a,this._metadata,d)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,n,o)}queryDepthRange(t){return this._queryDepthRangeOctree(t)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,t&&(this._needFullCycle=!0),this._needsUpdates&&this._context.requestRender()}get _needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get _octree(){return C(this._octreeCached)&&(this._octreeCached=this._buildOctree()),this._octreeCached}_invalidateOctree(){this._octreeCached=Qe(this._octreeCached)}_buildOctree(){const t=new V2t(this._instanceData,this.baseBoundingSphere),r=this._instanceData,i=r.view?r.view.state:null;for(let s=0;s<this._instanceData.capacity;++s)i.get(s)&ys.ACTIVE&&t.addInstance(s);return t}_queryDepthRangeOctree(t){const r=t.eye,i=t.viewForward,s=this._octree.findClosest(i,Xm.DepthOrder.FRONT_TO_BACK,t.frustum),n=this._octree.findClosest(i,Xm.DepthOrder.BACK_TO_FRONT,t.frustum);if(s!=null&&n!=null){this._instanceData.view.boundingSphere.getVec(s,Gg),ge(Gg,Gg,r);const o=Te(Gg,i)-Gg[3];this._instanceData.view.boundingSphere.getVec(n,Gg),ge(Gg,Gg,r);const a=Te(Gg,i)+Gg[3];return{near:Math.max(t.near,o),far:Math.min(t.far,a)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._needsUpdates&&this._context.requestRender()}_updateInstances(t,r){const i=this._enableLevelSelection,s=this._levelSelector;s.updateCamera(t),this._defaultRenderInstanceData.forEach(d=>d.beginUpdate()),this._highlightRenderInstanceData.forEach(d=>d.beginUpdate());const n=this._instanceData,o=this._instanceData.view,a=n.size,l=n.capacity;let c=this._instanceIndex;r=Math.min(a,r);for(let d=0;d<r;++d){c===0&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&ys.ALLOCATED)){c=c+1===l?0:c+1,r++;continue}const m=o.lodLevel.get(c);if(p&ys.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),p&ys.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),p&ys.REMOVE)n.freeInstance(c);else if(p&ys.VISIBLE){let g=0;i&&(o.modelOrigin.getVec(c,Gve),g=s.selectLevel(Gve,n.getCombinedMedianScaleFactor(c))),f=p&~(ys.ACTIVE|ys.TRANSFORM_CHANGED),g>=0&&(p&ys.HIGHLIGHT?(jve(this._highlightRenderInstanceData[g],o,c),f|=ys.HIGHLIGHT_ACTIVE):(jve(this._defaultRenderInstanceData[g],o,c),f|=ys.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,g)}else f=p&~(ys.ACTIVE|ys.TRANSFORM_CHANGED),o.state.set(c,f);if(v(this._octreeCached)){const g=!!(p&ys.ACTIVE),_=!!(f&ys.ACTIVE);!g&&_?this._octreeCached.addInstance(c):g&&!_?this._octreeCached.removeInstance(c):g&&_&&p&ys.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(d=>d.endUpdate()),this._highlightRenderInstanceData.forEach(d=>d.endUpdate())}_renderComponents(t,r){this.levels.forEach((i,s)=>{i.components.forEach(n=>{this._renderComponent(t,r[s],n,s)})})}_renderComponent(t,r,i,s){const{bindParameters:n,rctx:o,output:a}=t;if(r.size===0||!i.material.requiresSlot(n.slot,t.output))return;const l=i.glMaterials.load(o,n.slot,a);if(C(l))return;const c=l.beginSlot(n),d=o.bindTechnique(c,i.material.parameters,n);o.bindVAO(i.vao),c.ensureAttributeLocations(i.vao),d.bindDraw(Q2t,n,i.material.parameters),hi.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.output===V.Color&&(d.setUniform4fv("externalColor",Xve[Math.min(s,Xve.length-1)]),d.setUniform1i("colorMixMode",yNe.replace));const p=o.capabilities.instancing,f=r.capacity,m=r.headIndex,g=r.tailIndex,_=r.firstIndex,x=this._glInstanceBufferLayout,b=(w,T)=>{hle(o,Yr,r.buffer,x,w),p.drawArraysInstanced(c.primitiveType,0,i.vertexCount,T-w),ple(o,Yr,r.buffer,x)};i.material.parameters.transparent&&_!=null?m>g?(Et(_>=g&&_<=m,"invalid firstIndex"),b(_,m),b(g,_)):m<g&&(_<=m?(Et(_>=0&&_<=m,"invalid firstIndex"),b(_,m),b(g,f),b(0,_)):(Et(_>=g&&_<=f,"invalid firstIndex"),b(_,f),b(0,m),b(g,_))):m>g?b(g,m):m<g&&(b(0,m),b(g,f)),o.bindVAO(null)}}function jve(e,t,r){const i=e.allocateHead();K2t(t,r,e.view,i)}function K2t(e,t,r,i){rgt(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,e.objectAndLayerIdColor,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}const Gve=$(),Gg=Lr(),Hve=$e(),qve=$(),Wve=$(),Xve=[ar(1,0,1,1),ar(0,0,1,1),ar(0,1,0,1),ar(1,1,0,1),ar(1,0,0,1)],Q2t=new Hxt;class eEt extends j0{constructor(t,r,i,s){super(t,r,i,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}getCachedSize(){const[t,r,i]=v(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:r,height:i}}async doLoad(t){if(!this._drivenProperties.size&&V7(this.symbolLayer))throw new Error;const r=this.symbolLayer;if(this._isPrimitive){const i=r.resource?r.resource.primitive:UOe;this._resources=await this._createResourcesForPrimitive(i,t)}else this._resources=await this._createResourcesForUrl(r.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return v(this._resources)?this._resources.extentPadding:0}get _isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return Ks(this._resources,"lodRenderer")}_setMaterialTransparencyParams(t,r=Ks(this.symbolLayer,"material","color")){const i=this._getCombinedOpacity(r),s=i<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=i,t.cullFace=s?Xi.None:Xi.Back,t}async _createResourcesForPrimitive(t,r){if(!pbt(t))throw new Error(`Unknown object symbol primitive: ${t}`);const i=this.symbolLayer,s=ao($Ze(t)),n=pu(w5(s)),o=pu(pq(n,i)),a=Ie(o),l=!1,c=!1,d={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:Xy,diffuse:Xy,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=d.usePBR;this._setMaterialTransparencyParams(d);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:b,minWorldLength:w,maxWorldLength:T}=f.verticalOffset;d.verticalOffset={screenLength:Ga(b),minWorldLength:w||0,maxWorldLength:v(T)?T:1/0},d.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)d.externalColor=rf;else{const b=v(i.material)&&i.material.color,w=v(b)?Ze.toUnitRGBA(b):rf;d.externalColor=w}this._fastUpdates=aF(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,YT)),d.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(d,this._fastUpdates.materialParameters),d.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(d.instanced.push("color"),this._optionalFields.push("color")),pe("enable-feature:objectAndLayerId-rendering")&&(d.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const m=new VE(d),g=uFe(t,m);if(!g)throw new Error(`Unknown object symbol primitive: ${t}`);const _=Gk(g).map(b=>({opacity:1,transparent:b.parameters.transparent})),x=await this._createStageResources(g,p);return{lodResources:g,lodRenderer:await this._createLodRenderer(g,r),stageResources:x,symbolSize:o,extentPadding:a,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:_,physicalBasedRenderingEnabled:p,resourceBoundingBox:s,resourceSize:n,pivotOffset:YT}}async _createResourcesForUrl(t,r){const i=["transformation"],s={materialParamsMixin:{instanced:i,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=aF(this._context.renderer,this._fastVisualVariableConvertOptions(YT,YT,YT,YT)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color")),pe("enable-feature:objectAndLayerId-rendering")&&(i.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:k,minWorldLength:L,maxWorldLength:q}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:Ga(k),minWorldLength:L||0,maxWorldLength:v(q)?q:1/0},s.materialParamsMixin.castShadows=!1}s.signal=r,s.usePBR=this._context.physicalBasedRenderingEnabled,s.skipHighLods=this._context.skipHighSymbolLods;const o=s.usePBR,a=await G4e(t,s),l=a.isEsriSymbolResource,c=a.isWosr,d=FSt(a.lods);USt(d),d.levels.sort((k,L)=>k.minScreenSpaceRadius-L.minScreenSpaceRadius),d.levels[0].minScreenSpaceRadius=Math.min(2,d.levels[0].minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),g=Ks(this.symbolLayer,"material","color"),_=this._getCombinedOpacity(g,{hasIntrinsicColor:!0}),x=this.needsDrivenTransparentPass,b=Gk(d),w=Gk(d).map(k=>({opacity:k.parameters.opacity||1,transparent:k.parameters.transparent}));b.forEach(k=>{const L=k.parameters;k.setParameters(m);const q=L.opacity*_,G=q<1||x||L.transparent;k.setParameters({opacity:q,transparent:G}),p.screenSizePerspectiveEnabled&&k.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const T=a.referenceBoundingBox,E=pu(w5(T)),O=pu(d.levels[0].pivotOffset),A=pu(pq(E,this.symbolLayer)),R=Ie(A);lF(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(T,A,E,O))&&b.forEach(k=>k.setParameters(this._fastUpdates.materialParameters));const D=await this._createStageResources(d,o);return{lodResources:d,lodRenderer:await this._createLodRenderer(d,r),stageResources:D,symbolSize:A,extentPadding:R,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:w,physicalBasedRenderingEnabled:o,resourceBoundingBox:T,resourceSize:E,pivotOffset:O}}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,r){const i=this._context.stage,s=Gk(t);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),i.addMany(s),this._addDisposeResource(()=>i.removeMany(s));const n=v_e(t);i.addMany(n),this._addDisposeResource(()=>i.removeMany(n)),await i.load(n);const o=b_e(t);return i.addMany(o),this._addDisposeResource(()=>i.removeMany(o)),{materials:s,textures:n,geometries:o}}async _createLodRenderer(t,r){const i=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,uU),jn(c,Ore(this._fastUpdates.materialParameters,uU,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,uU),OTt(a,this._fastUpdates.materialParameters,uU))}:null,o=new J2t(t,this._optionalFields,s,n);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(o)}),await i.addRenderPlugin(o.slots,o,r),o}_getExternalColorParameters(t){const r={};return this._drivenProperties.color?r.externalColor=rf:v(t)&&v(t.color)?r.externalColor=Ze.toUnitRGBA(t.color):(r.externalColor=rf,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry))return null;const i=rF(r.geometry);if(C(i))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const s=this.setGraphicElevationContext(r,new op),n=t.renderingInfo;return this._createAs3DShape(r,i,n,s,r.uid,t.layer.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(C(this._resources))return;const t=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<i.length;n++){const o=i[n],a=Ks(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:r})*l.opacity,d=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:d}),this._isPrimitive&&o.setParameters({cullFace:d?Xi.None:Xi.Back})}}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Bx)}slicePlaneEnabledChanged(){if(C(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(C(this._resources))return!0;const{stageResources:t,isWosr:r}=this._resources;for(const i of t.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(t,r){if(C(this._resources))return To.Recreate_Symbol;const{stageResources:{materials:i},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!lF(this._fastUpdates,r,this._fastVisualVariableConvertOptions(n,o,a,l)))return To.Recreate_Symbol;for(const d of i)d.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return To.Fast_Update}computeComplexity(){if(C(this._resources))return super.computeComplexity();const t=this._resources.lodResources,r=_ce(t.levels[0]).reduce((n,o)=>n+o.indices.get(M.POSITION).length,0)/3,i=n=>Array.from(n.vertexAttributes.values()).reduce((o,a)=>{var l,c;return o+((c=(l=a.data.buffer)==null?void 0:l.byteLength)!=null?c:0)},0)+Array.from(n.indices.values()).reduce((o,a)=>o+(Array.isArray(a)?12*a.length:a.buffer.byteLength),0),s=v_e(t).reduce((n,o)=>n+o.estimatedTexMemRequired,0)/4+b_e(t).reduce((n,o)=>n+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...hFe(this.symbol,this.symbolLayer),resourceBytes:s}}}_hasLodRenderer(){return v(this._resources)}_createAs3DShape(t,r,i,s,n,o){if(!this._hasLodRenderer()||C(this._resources))return null;const a=this.getFastUpdateAttrValues(t),l=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?oL(i.color,i.opacity):null,c=this._context.clippingExtent;if(fa(r,aA,this._context.elevationProvider.spatialReference),v(c)&&!yoe(c,aA))return null;const d=this._requiresTerrainElevation(s),p=this._computeGlobalTransform(r,s,HX,dU),f=this._computeLocalTransform(this._resources,this.symbolLayer,i,Yve),m=this._resources.lodRenderer.instanceData,g=m.addInstance();this._instanceIndexToGraphicUid.set(g,n),m.setLocalTransform(g,f,!1),m.setGlobalTransform(g,p),a&&m.setFeatureAttribute(g,a),l&&m.setColor(g,l),pe("enable-feature:objectAndLayerId-rendering")&&m.setObjectAndLayerIdColor(g,this._context.stage.renderView._objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:n,layerUid:o}));const _=new DSt(this,g,nbt,s);return d&&(_.alignedSampledElevation=dU.sampledElevation),_.needsElevationUpdates=Bx(s.mode),tF(_,r,this._context.elevationProvider),_}_computeGlobalTransform(t,r,i,s){return t1(t,this._context.elevationProvider,r,this._context.renderCoordsHelper,s),aA[0]=t.x,aA[1]=t.y,aA[2]=s.z,Qh(t.spatialReference,aA,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(t,r,i,s){return fg(s),this._applyObjectRotation(i,!1,s),this._applyObjectRotation(r,!0,s),this._applyObjectScale(t,i,s),this._applyAnchor(t,r,s),s}_applyObjectScale(t,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&r.size?r.size:t.symbolSize,n=y_e(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||Oj(i,i,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const r=t.diff.diff;this._preparePatchTransform(t,r),this._preparePatchColor(t,r)}updateGeometry(t,r){if(C(this._resources))return!0;const i=r&&rF(r);if(C(i))return!1;const s=this.getGeometryElevationMode(r);return t.elevationContext.mode===s&&(this._computeGlobalTransform(i,t.elevationContext,HX,dU),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=dU.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,HX,!0),tF(t,i,this._context.elevationProvider),!0)}_preparePatchTransform(t,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||C(this._resources))return;const i=(g,_,x)=>yt(g!=null&&g.type==="complete"?g.newValue:_,x),s=i(r.heading,this.symbolLayer.heading,0),n=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),d=i(r.anchor,this.symbolLayer.anchor,void 0),p=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:d,anchorPosition:p},m=this._resources;this.loadStatus===Eh.LOADED&&t.symbolLayerStatePatches.push(()=>{m.symbolSize=pu(pq(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((g,_)=>{const x=this._computeLocalTransform(m,f,_,Yve),b=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,x,!0)})}_preparePatchColor(t,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const s=i.color.newValue,n=v(s)?Ze.toUnitRGBA(s):rf;delete i.color;const o=this._resources;C(o)||t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,r,i){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&r))return X1t(t.heading,t.tilt,t.roll,i)}_computeAnchor(t,r,i){const s=$();switch(i.anchor){case"center":le(s,Gm(t)),Fl(s,s);break;case"top":{const n=Gm(t);ue(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=Gm(t);ue(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=Gm(t),o=w5(t),a=i.anchorPosition,l=a?Fe(a.x,a.y,a.z):Ic;Z9(s,o,l),ye(s,s,n),Fl(s,s);break}default:v(r)?Fl(s,r):le(s,Ic)}return s}_applyAnchor(t,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,r);s&&Pu(i,i,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,r,i,s){const n=v(t)?pu(w5(t)):Xy,o=v(t)?this._computeAnchor(t,s,this.symbolLayer):Ic,a=this._context.renderCoordsHelper.unitInMeters,l=y_e(v(r)?r:void 0,r,i,a),c=Fe(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:v(r)?r:Xy,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const aA=$(),Yve=$e(),HX=$e(),uU=Lr(),dU=new y4;function tEt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function rEt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function Fce(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}function iEt(e,t){if(e===t){const r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function sEt(e,t){const r=t[0],i=t[1],s=t[2],n=t[3];let o=r*n-s*i;return o?(o=1/o,e[0]=n*o,e[1]=-i*o,e[2]=-s*o,e[3]=r*o,e):null}function nEt(e,t){const r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function oEt(e){return e[0]*e[3]-e[2]*e[1]}function W4e(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1],c=r[2],d=r[3];return e[0]=i*a+n*l,e[1]=s*a+o*l,e[2]=i*c+n*d,e[3]=s*c+o*d,e}function aEt(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=s*l+o*a,e[2]=i*-a+n*l,e[3]=s*-a+o*l,e}function lEt(e,t,r){const i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1];return e[0]=i*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function cEt(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e}function uEt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function dEt(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function hEt(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function pEt(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]}function fEt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function X4e(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function mEt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function gEt(e,t){const r=e[0],i=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3],d=Xl();return Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=d*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=d*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=d*Math.max(1,Math.abs(n),Math.abs(c))}function yEt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function _Et(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}const vEt=W4e,bEt=X4e;Object.freeze(Object.defineProperty({__proto__:null,copy:tEt,identity:rEt,set:Fce,transpose:iEt,invert:sEt,adjoint:nEt,determinant:oEt,multiply:W4e,rotate:aEt,scale:lEt,fromRotation:cEt,fromScaling:uEt,str:dEt,frob:hEt,LDU:pEt,add:fEt,subtract:X4e,exactEquals:mEt,equals:gEt,multiplyScalar:yEt,multiplyScalarAndAdd:_Et,mul:vEt,sub:bEt},Symbol.toStringTag,{value:"Module"}));class wEt extends mn{constructor(t,r,i,s,n,o,a){super(t,r,Bl.Triangle,a),this.path=i,this.geometrySR=s,this.upVectorAlignment=n,this.stencilWidth=o}}function Y4e(e){return"upVectorAlignment"in e}function Z4e(){return[1,0,0,1]}function xEt(e){return[e[0],e[1],e[2],e[3]]}function TEt(e,t,r,i){return[e,t,r,i]}function SEt(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:Z4e,clone:xEt,fromValues:TEt,createView:SEt},Symbol.toStringTag,{value:"Module"}));function Dre(){return{up:$(),right:$()}}function EEt(e,t,r){je(e.up,t.up,r),je(e.right,t.right,r)}function CEt(e,t,r){mr(e,Te(r,t.right),Te(r,t.up))}class AEt{constructor(){this.pos=$(),this.posES=$(),this.posGS=$(),this.vRight=$(),this.vLeft=$(),this.frame=Dre(),this.rotationFrame=Dre(),this.rotationRight=rt(),this.rotationAngle=0,this.miterStretch=Z4e()}setFrameFromUpVector(t){le(this.frame.up,t),ye(Dp,this.vLeft,this.vRight),xe(Dp,Dp),de(mm,this.frame.up,Te(Dp,this.frame.up)),ge(pU,Dp,mm),xe(pU,pU),At(this.frame.right,pU,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){le(this.rotationFrame.up,this.frame.up),le(this.rotationFrame.right,this.frame.right),mr(this.rotationRight,1,0),de(mm,this.frame.up,Te(this.frame.up,this.vLeft)),ge(mm,this.vLeft,mm),Fl(mm,mm),xe(mm,mm),de(Dp,this.frame.up,Te(this.frame.up,this.vRight)),ge(Dp,this.vRight,Dp),xe(Dp,Dp),At(Lre,this.rotationFrame.up,this.vLeft);const t=Math.sign(Te(Lre,this.vRight));if(this.rotationAngle=t*(Math.PI-Eo(Te(mm,Dp))),Math.abs(this.rotationAngle)>0){const i=MJ(Math.cos(.5*this.rotationAngle));Fce(this.miterStretch,i-1+1,0,0,1)}const r=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*r))}}class uF{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(t,r){return this.vertices.push(w$(t)),this.vertexNormals.push(w$(r)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,r=null){return this.poles.push({position:w$(t),normal:r?w$(r):null}),this.poles.length-1}addSegment(t,r=null,i=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),r&&(this.uvIndices.push(r.v0),this.uvIndices.push(r.v1)),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return this.uvs!=null}translate(t,r){for(const i of this.vertices)i[0]+=t,i[1]+=r;for(const i of this.poles)i.position[0]+=t,i.position[1]+=r}static circle(t=20){const i=new uF,s={v0:0,v1:0};i.addPole(pi(0,0));for(let a=0;a<t;++a){const l=2*a*Math.PI/t,c=Math.cos(l),d=Math.sin(l),p=pi(c*.5,d*.5),f=pi(c,d);i.addVertex(p,f),i.addUV(a/t)}i.addUV(1);for(let a=0;a<t-1;++a){const l={v0:a,v1:a+1},c=l;i.addSegment(l,c,s)}const n={v0:t-1,v1:0},o={v0:t-1,v1:t};return i.addSegment(n,o,s),i}static rect(){const i=new uF,s=pi(.5*-1,.5*-1),n=pi(.5*1,.5*-1),o=pi(.5*1,.5*1),a=pi(.5*-1,.5*1),l=pi(0,-1),c=pi(1,0),d=pi(0,1),p=pi(-1,0);i.addUV(0),i.addUV(1),i.addPole(pi(0,.5*1),d),i.addPole(pi(0,.5*1)),i.addPole(pi(0,.5*-1)),i.addPole(pi(0,.5*-1),l);const f={v0:0,v1:1};return i.addVertex(s,l),i.addVertex(n,l),i.addSegment({v0:0,v1:1},f,{v0:3,v1:3}),i.addVertex(n,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},f,{v0:2,v1:1}),i.addVertex(o,d),i.addVertex(a,d),i.addSegment({v0:4,v1:5},f,{v0:0,v1:0}),i.addVertex(a,p),i.addVertex(s,p),i.addSegment({v0:6,v1:7},f,{v0:1,v1:2}),i}}class OEt{constructor(t){this.vertices=[],this.offset=$(),this.xform=$e(),this.vertices=t;const r=Math.floor((t.length-1)/2);le(this.offset,this.vertices[r].pos);for(const i of this.vertices)ge(i.pos,i.pos,this.offset);Pu(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length;let r=this.vertices[0];r.index=0,ue(r.vLeft,0,0,0),r.vLeftLength=0,ge(r.vRight,this.vertices[1].pos,r.pos),r.vRightLength=Ie(r.vRight),xe(r.vRight,r.vRight);let i=r;for(let s=1;s<t;++s)r=this.vertices[s],r.index=s,le(r.vLeft,i.vRight),r.vLeftLength=i.vRightLength,s<t-1?(ge(r.vRight,this.vertices[s+1].pos,r.pos),r.vRightLength=Ie(r.vRight),xe(r.vRight,r.vRight)):(le(r.vRight,r.vLeft),r.vRightLength=r.vLeftLength),i=r}}function MEt(e,t){let r=null;const i=e.vertices.length,s=.99619469809,n=$(),o=$(),a=$(),l=$(),c=$(),d=$(),p=di();let f=e.vertices[0];le(o,t),ue(n,0,1,0),yV(f.vRight,o,n,n,a,o,s),le(f.frame.up,o),le(f.frame.right,a),r=f;for(let m=1;m<i;++m){f=e.vertices[m],ye(c,f.vLeft,f.vRight);let g=Ie(c);g>0?(g=1/Math.sqrt(g),c[0]=c[0]*g,c[1]=c[1]*g,c[2]=c[2]*g):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),ye(d,r.pos,r.frame.up),BR(f.pos,c,p),dC(p,ep(d,f.vLeft),l)?(ge(l,l,f.pos),xe(o,l),At(a,c,o),xe(a,a)):yV(c,r.frame.up,r.frame.right,n,a,o,s),le(f.frame.up,o),le(f.frame.right,a),r=f}}class REt{numProfilesPerJoin(){return 1}extrude(t,r,i){for(let s=0;s<r.vertices.length;++s)i(t.index,t.frame,r.vertices[s],r.vertexNormals[s],!1)}}class qX{constructor(t=.8*Math.PI,r=1){this.cutoffAngle=t,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,r,i){const s=FEt;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){Kh(Kve,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),EEt(s,t.frame,Kve);for(let o=0;o<r.vertices.length;++o)go(r.vertices[o],t.rotationRight)*t.rotationAngle>=0?i(t.index,s,r.vertices[o],r.vertexNormals[o],!1):(Ute(R2,r.vertices[o],t.miterStretch),i(t.index,t.frame,R2,r.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<r.vertices.length;++o){const a=go(r.vertices[o],t.rotationRight)*t.rotationAngle>=0;Ute(R2,r.vertices[o],t.miterStretch),i(t.index,t.frame,R2,r.vertexNormals[o],!a)}}}const IEt={generateUV:!1};class kce{rebuildConnectingProfileGeometry(t,r,i){for(let s=0;s<r.vertices.length;++s)i(t.index,t.frame,r.vertices[s],r.vertexNormals[s],0,0)}}class Zve extends kce{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class hU extends kce{constructor(t,r=0,i=!1){super(),this.profile=t,this.profilePlaneOffset=r,this.flip=i}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,r,i){for(let s=0;s<r.vertices.length;++s)i(t.index,t.frame,r.vertices[s],r.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,r){const i=Uce;mr(i,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)r(t.index,t.frame,this.profile.vertices[n],i,this.profilePlaneOffset,s)}buildTopology(t,r){const i=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?r(l,a,i):r(i,a,l)}}}class Jve extends kce{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let r=0;r<this.profile.numSegments;++r){const i=this.profile.vertexIndices[2*r+0],s=this.profile.vertexIndices[2*r+1];this.profile.poleIndices[i]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,r){const i=t.frame,s=.5*this.sign,n=R2,o=Uce;mr(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?r(t.index,i,l.position,l.normal,s,0):r(t.index,i,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)r(t.index,i,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),d=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];Gy(n,this.profile.vertices[p],f.position),wd(n,n,c),f.normal?(Pm(n,n,f.position),r(t.index,i,n,f.normal,s*d,0)):(AN(o,n),wd(o,o,c),Pm(n,n,f.position),r(t.index,i,n,o,s*d,this.sign*d))}}}buildTopology(t,r){const i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let d=i+o,p=i+a;for(let f=0;f<this.numSegments-1;++f){const m=s+f*this.profile.vertices.length+o,g=s+f*this.profile.vertices.length+a;this.flip?(r(m,p,d),r(p,m,g)):(r(d,p,m),r(g,m,p)),d=m,p=g}this.flip?(r(l,p,d),l!==c&&r(l,c,p)):(r(d,p,l),l!==c&&r(p,c,l))}}}class PEt{constructor(t,r,i,s,n,o=IEt){this.options=o,this._extrusionVertexCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=r,this.path=t,this.extruder=i,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,r,i,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const o=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,r,i,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}emitTriangle(t,r,i){this.vertexIndices.push(t),this.vertexIndices.push(r),this.vertexIndices.push(i),this.pathVertexIndices.push(this.pathVertexData[t]),this.pathVertexIndices.push(this.pathVertexData[r]),this.pathVertexIndices.push(this.pathVertexData[i]),this.normalIndices.push(t),this.normalIndices.push(r),this.normalIndices.push(i)}_rebuildGeometry(){const t=(i,s,n,o,a)=>this.emitVertex(i,s,n,o,a),r=(i,s,n,o,a,l)=>this.emitCapVertex(i,s,n,o,a,l);this._extrusionVertexCount=0;for(const i of this.path.vertices)this.originData[3*i.index+0]=i.pos[0],this.originData[3*i.index+1]=i.pos[1],this.originData[3*i.index+2]=i.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,r);for(let i=1;i<this.path.vertices.length-1;++i)this.extruder.extrude(this.path.vertices[i],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,r),this.startCap.rebuildCapGeometry(this.path.vertices[0],r),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],r),this.profile.hasUV()&&this.options.generateUV)for(let i=0;i<this.profile.uvs.length;++i)this.uvData[2*i+0]=this.profile.uvs[i],this.uvData[2*i+1]=0}buildTopology(){const t=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let s=3*(2*(r*i));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1),this.vertexIndices=new Array,this.normalIndices=new Array,this.pathVertexIndices=new Array,this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Array);for(let o=0;o<r;++o){const a=this.profile.vertexIndices[2*o],l=this.profile.vertexIndices[2*o+1];for(let c=0;c<i;++c){const d=c*t+a,p=(c+1)*t+a,f=(c+1)*t+l,m=c*t+l;this.emitTriangle(d,p,f),this.emitTriangle(d,f,m)}}const n=(o,a,l)=>this.emitTriangle(o,a,l);this.startCap.buildTopology(this.path.vertices[0],n),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],n)}onPathChanged(){this._rebuildGeometry()}}class J4e{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class K4e extends J4e{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let r=0;r<this.builder.numVerticesTotal;++r){let i=this.builder.pathVertexData[r];const s=i===0||i===this.builder.path.vertices.length-1;i*=3;const n=DEt;ue(n,this.builder.originData[i++],this.builder.originData[i++],this.builder.originData[i]);const o=4*r,a=mm,l=R2,c=Dp,d=Lre,p=NEt;let f=0,m=0;if(ue(d,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),ue(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),mr(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)At(c,p,d),f=this.builder.profileRightAxisData[o+3]*t[0],m=this.builder.profileUpAxisData[o+3];else{const _=Uce,x=LEt;mr(_,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const b=ole(_);AN(_,_);const w=go(l,_);if(Math.abs(w)>b){mr(x,-_[1],_[0]);const T=go(l,x);wd(_,_,b*Math.sign(w)),wd(x,x,T),Pm(l,_,x)}ue(c,0,0,0)}ue(a,d[0]*l[0]+p[0]*l[1],d[1]*l[0]+p[1]*l[1],d[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*r+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*r+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*r+2]=n[2]+a[2]+c[2]*f;const g=R2;mr(g,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*r+0]=d[0]*g[0]+p[0]*g[1]+c[0]*m,this.vertexAttributeNormal[3*r+1]=d[1]*g[0]+p[1]*g[1]+c[1]*m,this.vertexAttributeNormal[3*r+2]=d[2]*g[0]+p[2]*g[1]+c[2]*m}}createGeometryData(){const t=[[M.POSITION,this.builder.vertexIndices],[M.NORMAL,this.builder.normalIndices]],r=[[M.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[M.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const i=this.builder.vertexIndices.length;t.push([M.COLOR,new Array(i).fill(0)]),r.push([M.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:r,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,r,i){const s=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},o=s.length/3;f4(t,r,0,o,s,n,void 0,void 0,i)}}class $Et extends J4e{constructor(t,r,i,s){super(t),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=s,this.vvData=null,this.baked=new K4e(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=r,this.vvData[4*n+1]=i,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[M.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[M.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[M.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[M.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[M.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[M.POSITION,this.builder.pathVertexIndices],[M.PROFILERIGHT,this.builder.vertexIndices],[M.PROFILEUP,this.builder.vertexIndices],[M.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[M.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const DEt=$(),R2=rt(),Uce=rt(),LEt=rt(),mm=$(),Dp=$(),Lre=$(),NEt=$(),pU=$(),FEt=Dre(),Kve=$e(),WX=8;function kEt(e,t){e.attributes.add(M.FEATUREVALUE,"vec4");const r=e.vertex;r.code.add(S`bool isCapVertex() {
return featureValue.w == 1.0;
}`),r.uniforms.add(new ai("size",i=>i.size)),t.vvSize?(r.uniforms.add(new er("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new er("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new er("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new er("vvSizeFactor",i=>i.vvSizeFactor)),r.code.add(S`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):r.code.add(S`vec2 getSize(){
return size;
}`),t.vvOpacity?(r.constants.add("vvOpacityNumber","int",WX),r.uniforms.add([new $l("vvOpacityValues",i=>i.vvOpacityValues,WX),new $l("vvOpacityOpacities",i=>i.vvOpacityOpacities,WX)]),r.code.add(S`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):r.code.add(S`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(r.constants.add("vvColorNumber","int",og),r.uniforms.add([new $l("vvColorValues",i=>i.vvColorValues,og),new N7("vvColorColors",i=>i.vvColorColors,og)]),r.code.add(S`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):r.code.add(S`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(o4),e.attributes.add(M.PROFILERIGHT,"vec4"),e.attributes.add(M.PROFILEUP,"vec4"),e.attributes.add(M.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(S`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(S`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(S`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(S`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class UEt extends uce{constructor(){super(...arguments),this.size=pi(1,1)}}function BEt(e){const t=new Qr,{vertex:r,fragment:i}=t;switch(Dd(r,e),t.varyings.add("vpos","vec3"),t.include(kEt,e),e.output!==V.Color&&e.output!==V.Alpha||(t.include(wu,e),t.include(BE,e),t.include(UI,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(S`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===V.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(rp,e),e.output){case V.Alpha:t.include(Rn,e),i.uniforms.add(new De("opacity",s=>s.opacity)),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case V.Color:t.include(Rn,e),t.include(zE,e),t.include(T4,e),t.include(BE,e),t.include(o4e,e),_g(i,e),S4(i),HI(i),i.uniforms.add([r.uniforms.get("localOrigin"),new er("ambient",s=>s.ambient),new er("diffuse",s=>s.diffuse),new er("specular",s=>s.specular),new De("opacity",s=>s.opacity)]),i.include(k0),F0(i),i.code.add(S`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case V.Depth:case V.Shadow:case V.ShadowHighlight:case V.ShadowExludeHighlight:t.include(wu,e),OE(t),t.varyings.add("depth","float"),r.code.add(S`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(Rn,e),t.include(r1,e),i.code.add(S`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case V.Normal:t.include(wu,e),t.include(nF,e),nI(r),t.varyings.add("vnormal","vec3"),r.code.add(S`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Rn,e),i.code.add(S`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case V.Highlight:t.include(wu,e),t.include(nF,e),t.varyings.add("vnormal","vec3"),r.code.add(S`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Rn,e),t.include(_1,e),i.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return t}const zEt=Object.freeze(Object.defineProperty({__proto__:null,build:BEt},Symbol.toStringTag,{value:"Module"})),Q4e=new Map([[M.POSITION,0],[M.PROFILERIGHT,1],[M.PROFILEUP,2],[M.PROFILEVERTEXANDNORMAL,3],[M.FEATUREVALUE,4]]);class VEt extends UEt{constructor(){super(...arguments),this.ambient=Fe(.2,.2,.2),this.diffuse=Fe(.8,.8,.8),this.specular=Fe(0,0,0),this.opacity=1}}class mG extends li{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2,r.spherical=t.viewingMode===Ye.Global,r.doublePrecisionRequiresObfuscation=a4(t.rctx)}initializeProgram(t){return new ti(t.rctx,mG.shader.get().build(this.configuration),Q4e)}initializePipeline(){const t=this.configuration.transparencyPassType,r=this.configuration,i=t===Ct.NONE,s=t===Ct.FrontFace;return Ht({blending:r.output!==V.Color&&r.output!==V.Alpha||!r.transparent?null:i?qh:v1(t),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==js.None&&K$e,depthTest:{func:rT(t)},depthWrite:i||s?$u:null,colorWrite:cr,stencilWrite:r.hasOccludees?M0:null,stencilTest:r.hasOccludees?iT:null,polygonOffset:i||s?null:U7})}}mG.shader=new ei(zEt,()=>re(()=>import("./Path.glsl.51e6694f.js"),[]));class Qo extends aa{constructor(){super(...arguments),this.output=V.Color,this.doubleSidedMode=js.None,this.transparencyPassType=Ct.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}u([j({count:V.COUNT})],Qo.prototype,"output",void 0),u([j({count:js.COUNT})],Qo.prototype,"doubleSidedMode",void 0),u([j({count:Ct.COUNT})],Qo.prototype,"transparencyPassType",void 0),u([j()],Qo.prototype,"spherical",void 0),u([j()],Qo.prototype,"receiveShadows",void 0),u([j()],Qo.prototype,"receiveAmbientOcclusion",void 0),u([j()],Qo.prototype,"vvSize",void 0),u([j()],Qo.prototype,"vvColor",void 0),u([j()],Qo.prototype,"vvOpacity",void 0),u([j()],Qo.prototype,"hasSlicePlane",void 0),u([j()],Qo.prototype,"transparent",void 0),u([j()],Qo.prototype,"hasOccludees",void 0),u([j()],Qo.prototype,"hasMultipassTerrain",void 0),u([j()],Qo.prototype,"cullAboveGround",void 0),u([j()],Qo.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j({constValue:kt.Disabled})],Qo.prototype,"pbrMode",void 0),u([j({constValue:!0})],Qo.prototype,"hasVvInstancing",void 0),u([j({constValue:!1})],Qo.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Qo.prototype,"useFillLights",void 0);class Bce extends z0{constructor(t){super(t,new GEt),this.supportsEdges=!0,this._vertexAttributeLocations=Q4e,this._configuration=new Qo,this._vertexBufferLayout=Bce.getVertexBufferLayout(this.parameters)}getConfiguration(t,r){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==V.Color&&t!==V.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?js.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?js.WindingOrder:js.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(t){return t!==V.Shadow&&t!==V.ShadowExludeHighlight&&t!==V.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(t,r,i,s,n,o,a){const l=t;if(!Y4e(l))return;const c=l.path,d=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const b=this.parameters.vvSizeOffset,w=this.parameters.vvSizeFactor,T=this.parameters.vvSizeMinSize,E=this.parameters.vvSizeMaxSize,O=c.sizeAttributeValue;d[0]*=_e(b[0]+O*w[0],T[0],E[0]),d[1]*=_e(b[2]+O*w[2],T[2],E[2])}const p=Math.max(d[0],d[1]),f=t.boundingInfo;if(C(f))return void this._intersectTriangles(c,d,n,o,a);const m=mE(f.bbMin[0]-p,f.bbMin[1]-p,f.bbMin[2]-p,f.bbMax[0]+p,f.bbMax[1]+p,f.bbMax[2]+p),g=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],_=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),x=[_/g[0],_/g[1],_/g[2]];ice(m,n,x,s.tolerance)&&this._intersectTriangles(c,d,n,o,a)}_intersectTriangles(t,r,i,s,n){t.baked.size&&t.baked.size[0]===r[0]&&t.baked.size[1]===r[1]||t.baked.bake(r),t.baked.intersect(i,s,n)}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return null;const s=i.get(M.POSITION);return Cle(s,null,!1,r)}createBufferWriter(){return new HEt(this._vertexBufferLayout)}requiresSlot(t,r){switch(r){case V.Shadow:case V.ShadowHighlight:case V.ShadowExludeHighlight:if(!this.parameters.castShadows)return!1;case V.Color:case V.Alpha:case V.Depth:case V.Normal:case V.Highlight:case V.ObjectAndLayerIdColor:return t===(this.parameters.transparent?Ee.TRANSPARENT_MATERIAL:Ee.OPAQUE_MATERIAL)||t===Ee.DRAPED_MATERIAL;default:return!1}}createGLMaterial(t){return new jEt(t)}static getVertexBufferLayout(t){const r=Ds().vec3f(M.POSITION).vec4f(M.PROFILERIGHT).vec4f(M.PROFILEUP).vec4f(M.PROFILEVERTEXANDNORMAL);return(t.vvColorEnabled||t.vvSizeEnabled||t.vvOpacityEnabled)&&r.vec4f(M.FEATUREVALUE),r}}class jEt extends tT{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(C(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==V.Color&&this._output!==V.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(mG,t)}}class GEt extends VEt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class HEt{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(M.POSITION).length}write(t,r,i,s,n){fU(M.PROFILERIGHT,i,s,n),fU(M.PROFILEUP,i,s,n),fU(M.PROFILEVERTEXANDNORMAL,i,s,n),this.vertexBufferLayout.hasField(M.FEATUREVALUE)&&fU(M.FEATUREVALUE,i,s,n),D7(i,this.vertexBufferLayout,t,r,s,n)}}function fU(e,t,r,i){if(t.vertexAttributes.has(e)){const s=t.vertexAttributes.get(e),n=t.indices.get(e);Et(s.size===4);const o=r.getField(e,ga);if(!o)throw new Error("unable to acquire view for "+e);oI(n,s.data,o,i)}}const qEt=["polyline"];class WEt extends j0{constructor(t,r,i,s){super(t,r,i,s),this._intrinsicSize=pi(1,1),this._upVectorAlignment="path",this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=v(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,r=v(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,r],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=aF(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const i=this.symbolLayer.anchor||"center";this._upVectorAlignment="path",this.symbolLayer.profileRotation==="heading"&&(this._upVectorAlignment="world");const s=this.symbolLayer.profile||"circle";switch(s){case"circle":default:this._profile=uF.circle(KEt);break;case"quad":this._profile=uF.rect()}let n=[0,0];switch(i!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new qX(0,JEt);break;case"bevel":this._extruder=new qX(0,1);break;case"miter":this._extruder=new qX(.8*Math.PI,1);break;default:this._extruder=new REt}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new Zve,this._endCap=new Zve;break;case"butt":default:this._startCap=new hU(this._profile,0),this._endCap=new hU(this._profile,0,!0);break;case"square":this._startCap=new hU(this._profile,-.5),this._endCap=new hU(this._profile,.5,!0);break;case"round":{const m=s==="quad";this._startCap=new Jve({profile:this._profile,flip:!1,breakNormals:m,subdivisions:t1e}),this._endCap=new Jve({profile:this._profile,flip:!0,breakNormals:m,subdivisions:t1e});break}}const a=Ks(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=pu(l),d=l[3],p=d<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:d,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?Xi.None:Xi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(mr(this._intrinsicSize,t,r),!BV(this._intrinsicSize[0])||!BV(this._intrinsicSize[1])))throw new z("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||wd(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m={...f,...this._fastUpdates.materialParameters,size:xPe(this._intrinsicSize)};this._material=new Bce(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new VE(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,qEt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new op),s=t.renderingInfo;return this._createAs3DShape(r,s,i,r.uid)}layerOpacityChanged(){const t=Ks(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,Bx)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!lF(this._fastUpdates,r,this._vvConvertOptions))return To.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return To.Fast_Update}getVertexData(t){let r=0;const i=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const m of i)r+=m.length;const l=new Float64Array(3*r),c=new Float64Array(3*r),d=new Float64Array(3*r);let p=0;for(const m of i){s.push({index:p,numVertices:m.length});for(const g of m)l[p++]=g[0],l[p++]=g[1],l[p++]=t.hasZ?g[2]:0}let f=!0;return v(o)&&!n.equals(o)?f=Yi(l,n,0,c,o,0,r):this._copyVertices(l,0,c,0,r),v(o)&&!o.equals(a)?Yi(c,o,0,d,a,0,r):this._copyVertices(c,0,d,0,r),{pathVertexDataInfos:s,vertexDataGS:l,vertexDataES:c,vertexDataRS:d,projectionSuccess:f,terrainElevation:0}}_copyVertices(t,r,i,s,n){r*=3,s*=3;for(let o=0;o<n;++o)i[s++]=t[r++],i[s++]=t[r++],i[s++]=t[r++]}_createAs3DShape(t,r,i,s){const n=t.geometry,o=new Array,a=new Array,l=new Array,c=n.spatialReference,d=ao(),p=this._context.renderCoordsHelper;t5e.spatialReference=c;const f=this.getVertexData(n);if(!f.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(f.pathVertexDataInfos.length>0){for(let m=0;m<f.pathVertexDataInfos.length;++m){const g=f.pathVertexDataInfos[m],_=g.index,x=g.numVertices;if(x<2||v(this._context.clippingExtent)&&(es(d),Uh(d,f.vertexDataES,3*_,x),!Hm(d,this._context.clippingExtent)))continue;const b=[];for(let k=_;k<_+3*x;){const L=k++,q=k++,G=k++,J=new AEt;ue(J.posGS,f.vertexDataGS[L],f.vertexDataGS[q],f.vertexDataGS[G]),ue(J.posES,f.vertexDataES[L],f.vertexDataES[q],f.vertexDataES[G]);const ee=Y1t(J.posES,this._context.elevationProvider,i,p);ue(sf,f.vertexDataRS[L],f.vertexDataRS[q],f.vertexDataRS[G]),p.setAltitude(sf,ee),ue(J.pos,sf[0],sf[1],sf[2]),b.push(J)}const w=new OEt(b);e5e(w,this._upVectorAlignment,this._context.renderCoordsHelper);const T=new PEt(w,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const k=this._fastUpdates.visualVariables,L=k.size?Iv(k.size.field,t):0,q=k.color?Iv(k.color.field,t):0,G=k.opacity?Iv(k.opacity.field,t):0;E=new $Et(T,L,q,G)}else{const k=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(k[0]*=Qve(r.size[0],r.size[2]==="symbol-value"?this.symbolLayer.height||0:r.size[2],this.symbolLayer.width||0),k[1]*=Qve(r.size[2],r.size[0]==="symbol-value"?this.symbolLayer.width||0:r.size[0],this.symbolLayer.height||0));let L=null;this._drivenProperties.color&&(L=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(L=L?[L[0],L[1],L[2],r.opacity]:[1,1,1,r.opacity]);const q=new K4e(T);q.bake(k),L&&q.bakeVertexColors(L),E=q}const{vertexAttributes:O,indices:A}=E.createGeometryData(),R=this._context.stage.renderView._getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),D=new wEt(O,A,E,c,this._upVectorAlignment,this._stencilWidth,R);o.push(D),a.push(this._material),l.push(E.xform)}if(o.length>0){const m={layerUid:this._context.layer.uid,graphicUid:s},g=new w1({geometries:o,materials:a,transformations:l,metadata:m}),_=new V0(this,g,o,null,null,YEt,i);return _.alignedSampledElevation=f.terrainElevation,_.needsElevationUpdates=Bx(i.mode),_}}else n.paths.length!==0&&n.paths.some(m=>m.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function e5e(e,t,r){switch(t){case"world":for(const i of e.vertices)ye(Hg,i.pos,e.offset),r.worldUpAtPosition(Hg,sf),i.setFrameFromUpVector(sf),i.computeRotationAxisAndAngleFromUpVector();break;case"path":ye(Hg,e.vertices[0].pos,e.offset),r.worldUpAtPosition(Hg,sf),MEt(e,sf);for(const i of e.vertices){const s=Math.sign(Te(i.frame.right,i.vRight));At(i.rotationFrame.up,i.vRight,i.vLeft),de(i.rotationFrame.up,i.rotationFrame.up,s),xe(i.rotationFrame.up,i.rotationFrame.up);const n=Te(i.rotationFrame.up,i.frame.up),o=Te(i.rotationFrame.up,i.frame.right);if(de(Hg,i.frame.up,-o),de(e1e,i.frame.right,n),ye(Hg,Hg,e1e),xe(i.rotationFrame.right,Hg),CEt(i.rotationRight,i.frame,i.rotationFrame.right),Fl(Hg,i.vLeft),i.rotationAngle=-s*(Math.PI-Eo(Te(Hg,i.vRight))),Math.abs(i.rotationAngle)>0){const l=MJ(Math.cos(.5*i.rotationAngle));Fce(i.miterStretch,1+(l-1)*i.rotationRight[0]*i.rotationRight[0],(l-1)*i.rotationRight[0]*i.rotationRight[1],(l-1)*i.rotationRight[0]*i.rotationRight[1],1+(l-1)*i.rotationRight[1]*i.rotationRight[1])}const a=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(Math.min(i.vLeftLength,i.vRightLength)*MJ(Math.cos(.5*a)))}}}function Qve(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function XEt(e,t,r,i){let s=0;for(const n of e.vertices)t1(n.posES,r,t,i,XX),s+=XX.sampledElevation,ye(sf,n.pos,e.offset),i.setAltitude(sf,XX.z),ge(n.pos,sf,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function YEt(e,t,r,i){const s=e.stageObject,n=s.geometryRecords;let o=0;ZEt.spatialReference=i.spatialReference;for(const a of n){const l=a.geometry;if(!Y4e(l))continue;const c=l.path,d=c.builder.path,p=l.geometrySR;t5e.spatialReference=p,o+=XEt(d,t,r,i),l.upVectorAlignment!=="world"&&e5e(d,l.upVectorAlignment,i),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(a)}return o/n.length}const ZEt=b1(0,0,0,null),t5e=b1(0,0,0,null),sf=$(),Hg=Ki(),e1e=Ki(),XX=new y4,JEt=3,t1e=3,KEt=10;function QEt(e,t,r,i,s=1){if(r.isGeographic&&i===Ye.Global){const a=new Float64Array(t.typedBuffer.length),l=3*t.count,c=Kr(r);for(let d=0;d<l;d+=3)cae(t.typedBuffer,d,a,d,c);t=qn.fromTypedArray(a)}mr(_o,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let a=0;a<t.count;a++)t.getVec(a,_d),_o[0]=Math.min(_o[0],_d[0]),_o[1]=Math.min(_o[1],_d[1]);const n=_o[0]%s,o=_o[1]%s;Qp[0]=_o[0]-n,Qp[1]=_o[1]-o;for(let a=0;a<t.count;a++)t.getVec(a,_d),e.setValues(a,(_d[0]-Qp[0])/s,(_d[1]-Qp[1])/s,Qp[0]/s,Qp[1]/s)}function r5e(e,t,r,i,s=1){ue($T,1,0,0),ue(DT,0,1,0),ue(lA,0,0,1),rCt(YX,t),eCt(t,r1e)&&tCt(r1e,$T,DT,lA,r,YX),mr(_o,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),mr(LT,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let l=0;l<t.count;l++){t.getVec(l,_d);const c=Te($T,_d),d=Te(DT,_d);_o[0]=Math.min(_o[0],c),_o[1]=Math.min(_o[1],d),LT[0]=Math.max(LT[0],c),LT[1]=Math.max(LT[1],d)}const n=Te(lA,YX);JX(Q1,_o[0],_o[1],n,$T,DT,lA),JX(NT,LT[0],_o[1],n,$T,DT,lA),JX(FT,_o[0],LT[1],n,$T,DT,lA),ge(NT,NT,Q1),de(NT,NT,.5),ge(FT,FT,Q1),de(FT,FT,.5),ye(Q1,Q1,NT),ye(Q1,Q1,FT);const o=_o[0]%s,a=_o[1]%s;Qp[0]=_o[0]-o,Qp[1]=_o[1]-a;for(let l=0;l<t.count;l++){t.getVec(l,_d),e.setValues(l,(Te($T,_d)-Qp[0])/s,(Te(DT,_d)-Qp[1])/s,Qp[0]/s,Qp[1]/s);for(let c=0;c<3;c++)i.set(l,c,Q1[c]),i.set(l,c+3,NT[c]),i.set(l,c+6,FT[c])}}const YX=$(),_d=$(),r1e=di(),$T=$(),DT=$(),lA=$(),_o=rt(),LT=rt(),Qp=rt(),Q1=$(),NT=$(),FT=$();function eCt(e,t){const r=e.count-1;return BPe(e,t,0,Math.floor(r/3),Math.floor(r*(2/3)))}function tCt(e,t,r,i,s,n){v(s)?(s.basisMatrixAtPosition(n,qg),ue(mU,qg[0],qg[1],qg[2]),ue(gU,qg[4],qg[5],qg[6]),ue(ZX,qg[8],qg[9],qg[10])):(ue(mU,1,0,0),ue(gU,0,1,0),ue(ZX,0,0,1));const o=e;Te(o,ZX)<0&&de(o,o,-1),le(i,o);const a=Te(o,gU),l=Te(o,mU);Math.abs(a)<Math.abs(l)?(p2(t,mU,o,-l),xe(t,t),At(r,t,o),xe(r,r),de(r,r,-1)):(p2(r,gU,o,-a),xe(r,r),At(t,r,o),xe(t,t))}const qg=$e(),mU=$(),gU=$(),ZX=$();function rCt(e,t){ue(yU,0,0,0);for(let r=0;r<t.count-1;r++)t.getVec(r,_d),ye(yU,yU,_d);de(e,yU,1/(t.count-1))}const yU=$();function JX(e,t,r,i,s,n,o){ue(e,t*s[0]+r*n[0]+i*o[0],t*s[1]+r*n[1]+i*o[1],t*s[2]+r*n[2]+i*o[2])}function iCt(e){const t=new Qr,{vertex:r,fragment:i}=t,s=e.output===V.Depth,n=e.hasMultipassTerrain&&(e.output===V.Color||e.output===V.Alpha);return Dd(r,e),t.include(wu,e),t.include(fC,e),t.include(L7,e),t.attributes.add(M.POSITION,"vec3"),t.varyings.add("vpos","vec3"),n&&t.varyings.add("depth","float"),s&&(t.include(r1,e),OE(t),Rx(t)),r.code.add(S`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${n?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${s?S`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:S`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Rn,e),n&&t.include(rp,e),i.include(k0),i.uniforms.add(new Tr("eColor",o=>o.color)),e.output===V.Highlight&&t.include(_1,e),i.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${S.float(hl)}) {
      discard;
    }

    ${e.output===V.Alpha?S`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===V.Color?S`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===V.Highlight?S`outputHighlight();`:""};
    ${e.output===V.Depth?S`outputDepth(linearDepth);`:""};
    ${e.output===V.ObjectAndLayerIdColor?S`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const sCt=Object.freeze(Object.defineProperty({__proto__:null,build:iCt},Symbol.toStringTag,{value:"Module"}));class gG extends li{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2}initializeProgram(t){return new ti(t.rctx,gG.shader.get().build(this.configuration),Yr)}_createPipeline(t,r){const i=this.configuration,s=t===Ct.NONE,n=t===Ct.FrontFace;return Ht({blending:i.output!==V.Color&&i.output!==V.Alpha||!i.transparent?null:s?qh:v1(t),culling:l7(i.cullFace),depthTest:{func:rT(t)},depthWrite:s||n?i.writeDepth&&$u:null,colorWrite:cr,stencilWrite:i.hasOccludees?M0:null,stencilTest:i.hasOccludees?r?Vx:iT:null,polygonOffset:s||n?i.polygonOffset&&nCt:B7(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}gG.shader=new ei(sCt,()=>re(()=>import("./ColorMaterial.glsl.ceea32b6.js"),[]));const nCt={factor:1,units:1};class rd extends aa{constructor(){super(...arguments),this.output=V.Color,this.cullFace=Xi.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=Ct.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}}u([j({count:V.COUNT})],rd.prototype,"output",void 0),u([j({count:Xi.COUNT})],rd.prototype,"cullFace",void 0),u([j()],rd.prototype,"hasSlicePlane",void 0),u([j()],rd.prototype,"hasVertexColors",void 0),u([j()],rd.prototype,"transparent",void 0),u([j()],rd.prototype,"polygonOffset",void 0),u([j()],rd.prototype,"enableOffset",void 0),u([j()],rd.prototype,"writeDepth",void 0),u([j()],rd.prototype,"hasOccludees",void 0),u([j({count:Ct.COUNT})],rd.prototype,"transparencyPassType",void 0),u([j()],rd.prototype,"hasMultipassTerrain",void 0),u([j()],rd.prototype,"cullAboveGround",void 0),u([j()],rd.prototype,"objectAndLayerIdColorInstanced",void 0);class i1e extends z0{constructor(t){super(t,new aCt),this.supportsEdges=!0,this._configuration=new rd}getConfiguration(t,r){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<k7,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(t,r,i,s,n,o,a){P7(t,r,s,n,o,void 0,a)}requiresSlot(t,r){return r===V.Color||r===V.Alpha||r===V.Highlight||r===V.Depth&&this.parameters.writeLinearDepth||r===V.ObjectAndLayerIdColor?t===Ee.DRAPED_MATERIAL?!0:r===V.Highlight?t===Ee.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL):!1}createGLMaterial(t){return new oCt(t)}createBufferWriter(){return new tG(pe("enable-feature:objectAndLayerId-rendering")?Qwt:ZFe)}}class oCt extends tT{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==V.Color&&this._output!==V.Alpha||this._updateOccludeeState(t),this.ensureTechnique(gG,t)}}class aCt extends GI{constructor(){super(...arguments),this.color=u0,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Xi.None,this.hasOccludees=!1}}var Ba;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(Ba||(Ba={}));const Nre=.70710678118,s1e=Nre,lCt=.08715574274;function cCt(e){const t=new Qr,r=e.hasMultipassTerrain&&(e.output===V.Color||e.output===V.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const{vertex:i,fragment:s}=t;Dd(i,e),t.include(wu,e),t.include(fC,e),e.draped?i.uniforms.add(new De("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):t.attributes.add(M.BOUNDINGRECT,"mat3"),t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r&&t.varyings.add("depth","float");const n=e.style===Ba.ForwardDiagonal||e.style===Ba.BackwardDiagonal||e.style===Ba.DiagonalCross;n&&i.code.add(S`
      const mat2 rotate45 = mat2(${S.float(Nre)}, ${S.float(-s1e)},
                                 ${S.float(s1e)}, ${S.float(Nre)});
    `),e.draped||(_g(i,e),i.uniforms.add(new De("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),i.code.add(S`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(S`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(S`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${S.float(lCt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(S`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${n?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${n?" * rotate45":""};

      ${e.draped?"":S`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${S.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const o=e.output===V.Depth;return o&&(t.include(r1,e),OE(t),Rx(t)),i.code.add(S`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${o?S`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:S`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Rn,e),s.include(k0),e.draped&&s.uniforms.add(new De("texelSize",(a,l)=>1/l.camera.pixelRatio)),e.output===V.Highlight&&t.include(_1,e),r&&t.include(rp,e),e.output!==V.Highlight&&(s.code.add(S`
      const float lineWidth = ${S.float(e.lineWidth)};
      const float spacing = ${S.float(e.patternSpacing)};
      const float spacingINV = ${S.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||s.code.add(S`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.uniforms.add(new Tr("uColor",a=>a.color)),s.code.add(S`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==V.Highlight?S`color.a *= ${uCt(e)};`:""}

      if (color.a < ${S.float(hl)}) {
        discard;
      }

      ${e.output===V.Alpha?S`gl_FragColor = vec4(color.a);`:""}

      ${e.output===V.Color?S`gl_FragColor = color; ${e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===V.Highlight?S`outputHighlight();`:""}
      ${e.output===V.Depth?S`outputDepth(linearDepth);`:""};
    }
  `),t}function uCt(e){function t(r){return e.draped?S`coverage(vuv.${r}, texelSize)`:S`sample(vuv.${r})`}switch(e.style){case Ba.ForwardDiagonal:case Ba.Horizontal:return t("y");case Ba.BackwardDiagonal:case Ba.Vertical:return t("x");case Ba.DiagonalCross:case Ba.Cross:return S`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const dCt=Object.freeze(Object.defineProperty({__proto__:null,build:cCt},Symbol.toStringTag,{value:"Module"}));class yG extends li{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2}initializeProgram(t){return new ti(t.rctx,yG.shader.get().build(this.configuration),i5e)}_setPipelineState(t,r){const i=this.configuration,s=t===Ct.NONE,n=t===Ct.FrontFace;return Ht({blending:i.output===V.Color||i.output===V.Alpha?s?qh:v1(t):null,culling:l7(i.cullFace),depthTest:{func:rT(t)},depthWrite:s?i.writeDepth&&$u:F7(t),colorWrite:cr,stencilWrite:i.hasOccludees?M0:null,stencilTest:i.hasOccludees?r?Vx:iT:null,polygonOffset:s||n?i.polygonOffset&&hCt:B7(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}yG.shader=new ei(dCt,()=>re(()=>import("./Pattern.glsl.90d16691.js"),[]));const hCt={factor:1,units:1};class yc extends aa{constructor(){super(...arguments),this.output=V.Color,this.cullFace=Xi.None,this.transparencyPassType=Ct.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([j({count:V.COUNT})],yc.prototype,"output",void 0),u([j({count:Xi.COUNT})],yc.prototype,"cullFace",void 0),u([j({count:Ba.COUNT})],yc.prototype,"style",void 0),u([j({count:Ct.COUNT})],yc.prototype,"transparencyPassType",void 0),u([j()],yc.prototype,"hasSlicePlane",void 0),u([j()],yc.prototype,"hasVertexColors",void 0),u([j()],yc.prototype,"polygonOffset",void 0),u([j()],yc.prototype,"writeDepth",void 0),u([j()],yc.prototype,"hasOccludees",void 0),u([j()],yc.prototype,"patternSpacing",void 0),u([j()],yc.prototype,"lineWidth",void 0),u([j()],yc.prototype,"enableOffset",void 0),u([j()],yc.prototype,"draped",void 0),u([j()],yc.prototype,"hasMultipassTerrain",void 0),u([j()],yc.prototype,"cullAboveGround",void 0);const i5e=new Map([[M.POSITION,0],[M.COLOR,3],[M.UVMAPSPACE,4],[M.BOUNDINGRECT,5]]);class zce extends z0{constructor(t){super(t,new mCt),this.supportsEdges=!0,this._vertexAttributeLocations=i5e,this._configuration=new yc}getConfiguration(t,r){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<k7,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(t,r,i,s,n,o,a){P7(t,r,s,n,o,void 0,a)}requiresSlot(t,r){return r===V.Color||r===V.Alpha||r===V.Highlight||r===V.Depth&&this.parameters.writeLinearDepth?t===Ee.DRAPED_MATERIAL?!0:r===V.Highlight?t===Ee.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(t){return new pCt(t)}createBufferWriter(){const t=Ds().vec3f(M.POSITION).vec4u8(M.COLOR).vec4f(M.UVMAPSPACE);return this.parameters.draped||t.mat3f(M.BOUNDINGRECT),new fCt(t)}}class pCt extends tT{_updateParameters(t){return this.ensureTechnique(yG,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==V.Color&&this._output!==V.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class fCt extends tG{write(t,r,i,s,n){for(const o of this.vertexBufferLayout.fieldNames){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case M.POSITION:{Et(a.size===3);const c=s.getField(o,Ii);c&&$7(l,a.data,t,c,n);break}case M.COLOR:{Et(a.size===3||a.size===4);const c=s.getField(o,Go);c&&LV(l,a.data,a.size,c,n);break}case M.UVMAPSPACE:{Et(a.size===4);const c=s.getField(o,ga);c&&oI(l,a.data,c,n);break}case M.BOUNDINGRECT:{Et(a.size===9);const c=s.getField(o,gg);c&&this.writeBoundingRect(l,a.data,t,c,n);break}}}}writeBoundingRect(t,r,i,s,n){const o=i,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let d=0;d<c;++d){const p=9*t[d],f=r[p],m=r[p+1],g=r[p+2];a[n]=o[0]*f+o[4]*m+o[8]*g+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*g+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*g+o[14];for(let _=3;_<9;++_)a[n+_]=r[p+_];n+=l}}}class mCt extends GI{constructor(){super(...arguments),this.color=ar(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Xi.None,this.hasOccludees=!1,this.style=Ba.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function gCt(e,t,r){return _Ct(yCt(e),t,r)}function yCt(e){return e&&e.pattern||null}function _Ct(e,t,r){return v(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=ar(0,0,0,0),t.transparent=!0),new i1e(t)):(t.style=vCt(e.style),t.draped=r.isDraped,new zce(t)):new i1e(t)}function vCt(e){switch(e){case"horizontal":return Ba.Horizontal;case"vertical":return Ba.Vertical;case"cross":return Ba.Cross;case"forward-diagonal":return Ba.ForwardDiagonal;case"backward-diagonal":return Ba.BackwardDiagonal;case"diagonal-cross":return Ba.DiagonalCross;default:return}}function bCt(e){return e.material instanceof zce&&!e.material.parameters.draped}function wCt(e,t){if(bCt(e)){const r=e.geometry.vertexAttributes,i=r.get(M.POSITION).data,s=r.get(M.UVMAPSPACE).data,n=r.get(M.BOUNDINGRECT).data;r5e(ga.fromTypedArray(s),qn.fromTypedArray(i),t,Ix.fromTypedArray(n))}}function xCt(e,t,r,i){const s=sFe(e,t,r,i),n=e.stageObject.geometryRecords;for(let o=0;o<n.length;o++)wCt(n[o],i);return s}const TCt=["polyline","polygon","extent"];class _G extends j0{constructor(t,r,i,s){super(t,r,i,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(v(this._material))return;const t=Ks(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(t);this._material=gCt(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof zce,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(v(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const r=i=>{const s=T4e(t.pattern);return new oM({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:Mre(t.patternCap||"butt")})};this._outlineMaterial=r(Ga(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return v(t)&&t.size&&t.size>0&&v(t.color)&&(C(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,TCt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(r,new op);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,s)}layerOpacityChanged(){if(v(this._material)){const t=this._material.parameters.color,r=Ks(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(r);this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(v(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=g4(_G.elevationModeChangeTypes,i,s);if(n!==en.UPDATE)return n;const o=Mf(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){if(v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),v(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,r,i){var d;const s=iF(t.geometry);if(C(s))return null;const n=$ce(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new SCt(n,r,this._context.layer.uid,t.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=new Float32Array(4*a),o.boundingRect=new Float64Array(9*a)),o.objectAndLayerIdColor=(d=this._context.stage.renderView)==null?void 0:d._getObjectAndLayerIdColor({graphicUid:o.graphicsUid,layerUid:o.layerUid}),this._createAs3DShapeFill(o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,s.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;this._needsUV&&r5e(ga.fromTypedArray(o.uvMapSpace),qn.fromTypedArray(o.renderData.position),this._context.renderCoordsHelper,Ix.fromTypedArray(o.boundingRect));const l=new w1({geometries:o.outGeometries,materials:o.outMaterials,transformations:o.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),c=new V0(this,l,o.outGeometries,null,null,xCt,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Mf(i.mode),c}_createAs3DShapeFill(t){const r=t.renderData.polygons;for(const{position:i,mapPosition:s,holeIndices:n,index:o,count:a}of r){if(v(this._context.clippingExtent)&&(es(lc),Uh(lc,s),!Hm(lc,this._context.clippingExtent)))continue;const l=cI(s,n,3);if(l.length===0)continue;const c=D_e({indices:l,attributeData:{position:i,color:t.color,mapPosition:s,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*o*t.uvMapSpace.BYTES_PER_ELEMENT,4*a):null,boundingRect:this._needsUV?new Float64Array(t.boundingRect.buffer,9*o*t.boundingRect.BYTES_PER_ELEMENT,9*a):null,objectAndLayerIdColor:t.objectAndLayerIdColor}});t.outGeometries.push(c),t.outMaterials.push(this._material),t.outTransforms.push(Hn)}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const r=t.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPosition:s,position:n}=r[i];if(v(this._context.clippingExtent)&&(es(lc),Uh(lc,s),!Hm(lc,this._context.clippingExtent)))continue;const o=Rre({overlayInfo:null,removeDuplicateStartEnd:!0,attributeData:{position:n,mapPosition:s}},t.objectAndLayerIdColor),a=o.vertexAttributes.get(M.POSITION);a.data===n&&(a.data=new Float64Array(n)),t.outGeometries.push(o),t.outMaterials.push(this._outlineMaterial),t.outTransforms.push(Hn)}}_createAsOverlay(t,r){var a;const i=iF(t.geometry);if(C(i))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,v(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const s=r4e(i,this._context.overlaySR),n=new ECt(s,r,this._context.layer.uid,t.uid),o=n.renderData.position.length/3;return this._needsUV&&(n.uvMapSpace=new Float32Array(4*o)),n.outBoundingBox=es(),n.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a._getObjectAndLayerIdColor({graphicUid:n.graphicsUid,layerUid:n.layerUid}),this._createAsOverlayFill(n),this._hasOutline&&this._createAsOverlayOutline(n),this._logGeometryCreationWarnings(n.renderData,i.rings,"rings","FillSymbol3DLayer"),n.outGeometries.length===0?null:(this._needsUV&&QEt(ga.fromTypedArray(n.uvMapSpace),qn.fromTypedArray(n.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),new oG(this,n.outGeometries,n.outBoundingBox,this._context.drapeSourceRenderer))}_createAsOverlayFill(t){const r=t.renderData.polygons;for(const{position:i,holeIndices:s,index:n,count:o}of r){if(es(lc),Uh(lc,i),!Hm(lc,this._context.clippingExtent))continue;const a=cI(i,s,3);if(a.length===0)continue;CR(t.outBoundingBox,lc);const l=D_e({indices:a,attributeData:{position:i,color:t.color,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*n*t.uvMapSpace.BYTES_PER_ELEMENT,4*o):null,objectAndLayerIdColor:t.objectAndLayerIdColor}}),c=new hI(l,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),d=lc;Oi(c.boundingSphere,.5*(d[0]+d[3]),.5*(d[1]+d[4]),0,.5*Math.sqrt((d[3]-d[0])*(d[3]-d[0])+(d[4]-d[1])*(d[4]-d[1]))),t.outGeometries.push(c)}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const r=t.renderData.outlines;for(let i=0;i<r.length;++i){const{position:s}=r[i];if(es(lc),Uh(lc,s),!Hm(lc,this._context.clippingExtent))continue;CR(t.outBoundingBox,lc);const n=Rre({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:s}},t.objectAndLayerIdColor),o=new hI(n,this._outlineMaterial,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),a=lc;Oi(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(o)}}_getOutlineOpacity(){const t=Ks(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(v(t)?t.a:0)}_getOutlineColor(){const t=Ks(this.symbolLayer,"outline","color"),r=this._getOutlineOpacity();return oL(v(t)?Ze.toUnitRGB(t):null,r)}test(){return{...super.test(),createAsOverlay:(t,r)=>this._createAsOverlay(t,r),createAs3DShape:(t,r,i)=>this._createAs3DShape(t,r,i)}}}_G.elevationModeChangeTypes={definedChanged:en.RECREATE,staysOnTheGround:en.NONE,onTheGroundChanged:en.RECREATE};const lc=ao();class SCt extends W7{constructor(t,r,i,s){super(t,i,s),this.color=r}}class ECt extends W7{constructor(t,r,i,s){super(t,i,s),this.color=r}}class vG{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const r=this.definition.font;return`${r.style} ${r.weight} ${t}px ${r.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(r=>Math.floor(255*r)).toString()},${t[3]})`}static async fromSymbol(t,r=1){const i=Ks(t,"material","color"),s=Ch(i,u0,Ze.toUnitRGBA),n=Ch(t.size,12,Ga),o=t.lineHeight,a=v(t.background)?Ze.toUnitRGBA(t.background.color):u0,l={family:Ch(t.font,"sans-serif",m=>m.family),decoration:Ch(t.font,"none",m=>m.decoration),weight:Ch(t.font,"normal",m=>m.weight),style:Ch(t.font,"normal",m=>m.style)},c=t.halo,d=v(c)&&v(c.color)&&c.size>0?{size:Ga(c.size),color:Ze.toUnitRGBA(c.color)}:{size:0,color:u0},p=new vG({color:s,size:n,background:{color:a,padding:v(t.background)?[.65*n,.5*n]:[0,0],borderRadius:v(t.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:d,pixelRatio:r}),f=p.fontString(n);try{await document.fonts.load(f)}catch{te.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}}class CCt{constructor(t,r,i){this._renderer=new g4e(t,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=WB(ACt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=t.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new ka(t,{wrap:{s:It.CLAMP_TO_EDGE,t:It.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:cx.PAD})}}const ACt={canvas:null},OCt=[0,0,1];class MCt extends j0{constructor(t,r,i,s){super(t,r,i,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=V7(this.symbolLayer.size);if(t)throw new z("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await vG.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const r=t.graphic,i=rF(r.geometry);if(C(i))return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const s=this.symbolLayer.text;if(C(s)||s==="")return null;const n=Soe(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(v(n)&&!HOe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o={...PCt,verticalOffset:n,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:bTt(this.symbolLayer.verticalAlignment)};return this._createAs3DShape(r,i,s,o)}createLabel(t,r,i,s){const n=t.graphic,o=rF(n.geometry);if(C(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,r,i,s)}setGraphicElevationContext(t,r,i=0){const s=super.setGraphicElevationContext(t,r);return s.addOffsetRenderUnits(i),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,r){return n1e(t,r,(i,s)=>{this.updateGraphicElevationContext(s,i)}),en.UPDATE}slicePlaneEnabledChanged(t,r){return n1e(t,r,i=>{for(const s of i.stageObject.geometryRecords)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(t,r){this.setGraphicElevationContext(t,r.elevationContext,r.metadata.elevationOffset),r.needsElevationUpdates=Mf(r.elevationContext.mode)||r.elevationContext.mode==="absolute-height"}_defaultElevationInfoNoZ(){return ICt}_createAs3DShape(t,r,i,s,n,o){const a=this.setGraphicElevationContext(t,new op,s.elevationOffset),l=Ks(t.geometry,"type")==="polyline",c=t.uid;let d=null,p=null;if(C(o)){const L=_4e(s.horizontalPlacement);d=new CCt(i,L,this._textRenderParameters);let q=null;if(v(this._context.sharedResources.textures)){p=this._context.sharedResources.textures.fromData(d.key,()=>d.create(),()=>{v(q)&&q.release()});const G=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(C(G)||np(G))return p.release(),null;q=G}}const f=RCt(d,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,debugDrawLabelBorder:s.debugDrawLabelBorder,drawInSecondSlot:!0};if(v(p)&&(m.textureId=p.texture.id),v(o)&&(m.textureId=o.id),v(s.verticalOffset)){const{screenLength:L,minWorldLength:q,maxWorldLength:G}=s.verticalOffset;m.verticalOffset={screenLength:Ga(L),minWorldLength:q||0,maxWorldLength:v(G)?G:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:L,screenSizePerspectiveSettingsLabels:q}=this._context.sharedResources;m.screenSizePerspective=q.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=L}let g;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,v(n)){const L=JSON.stringify(m);g=n.get(L),C(g)&&(g=new aI(m),n.add(L,g))}else g=new aI(m);const _=[g],x=s.translation,b=v(d)?[d.displayWidth,d.displayHeight]:[0,0],w=s.centerOffset,T=[Yte(OCt,x,null,b,w,[0,0],null)],E=this._context.layer.uid,O=wce(this._context,r,T,_,a,E,c);if(O===null)return null;const A=new V0(this,O.object,T,C(n)?_:null,p,eF,a);A.alignedSampledElevation=O.sampledElevation,A.needsElevationUpdates=Mf(a.mode)||a.mode==="absolute-height";const{displayWidth:R,displayHeight:D}=v(d)?d:s;A.getScreenSize=(L=rt())=>(L[0]=R,L[1]=D,L);const k={labelText:i,elevationOffset:s.elevationOffset};return A.metadata=k,tF(A,r,this._context.elevationProvider),A}}function n1e(e,t,r){e&&e.forEach(i=>{const s=t(i);v(s)&&r(s,i.graphic)})}function RCt(e,t){if(t.verticalPlacement==="baseline"){const i=yTt[t.horizontalPlacement],s=v(e)?e.baselineAnchorY:0;return pi(i,s)}const r=vTt(t.horizontalPlacement,t.verticalPlacement);return XB[r]}const ICt={mode:"relative-to-ground",offset:0},PCt={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0},$Ct={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},DCt=["polyline","polygon","extent"];class Uy extends j0{constructor(t,r,i,s){super(t,r,i,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,DCt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new op);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(v(this._material))return;const t=new KFe,r=this.symbolLayer.color;v(r)&&(t.color=Ze.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],i],t.transparent=i<1||this.needsDrivenTransparentPass,t.waveDirection=v(this.symbolLayer.waveDirection)?Uy.headingVectorFromAngle(this.symbolLayer.waveDirection):pi(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=$Ct[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new JFe(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(C(this._material))return;const t=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:i})}layerElevationInfoChanged(t,r,i){const s=this._elevationContext.mode,n=g4(Uy.elevationModeChangeTypes,i,s);if(n!==en.UPDATE)return n;const o=Mf(s);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>o)}slicePlaneEnabledChanged(){return v(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,r,i){const s=iF(t.geometry);if(C(s))return null;const n=$ce(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=n.position.length/3,a=new Float64Array(2*o),l=new LCt(n,a);if(this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,s.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;this._createUVCoordsFromVertices(l.uvCoords,l.renderData.mapPosition,o,this._context.elevationProvider.spatialReference);const c=new w1({geometries:l.outGeometries,materials:l.outMaterials,transformations:l.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),d=new V0(this,c,l.outGeometries,null,null,sFe,r);return d.alignedSampledElevation=l.renderData.sampledElevation,d.needsElevationUpdates=Mf(r.mode),d}_createUVCoordsFromVertices(t,r,i,s){const n=Fc(s);kd(eb);for(let l=0;l<i;l++)mr(o1e,r[3*l+0],r[3*l+1]),RM(eb,o1e);NF(eb,eb,n);const o=eb[0]%Uy.unitSizeOfTexture,a=eb[1]%Uy.unitSizeOfTexture;_U[0]=eb[0]-o,_U[1]=eb[1]-a;for(let l=0;l<i;l++)t[2*l+0]=(r[3*l+0]*n-_U[0])/Uy.unitSizeOfTexture,t[2*l+1]=(r[3*l+1]*n-_U[1])/Uy.unitSizeOfTexture}_create3DShapeGeometries(t){const r=t.renderData.polygons,i=t.uvCoords;for(const{count:s,index:n,position:o,mapPosition:a,holeIndices:l}of r){if(v(this._context.clippingExtent)&&(es(tb),Uh(tb,a),!Hm(tb,this._context.clippingExtent)))continue;const c=cI(a,l,3);if(c.length===0)continue;const d=new Float64Array(i.buffer,2*n*i.BYTES_PER_ELEMENT,2*s),p=L_e({indices:c,attributeData:{position:o,uv0:d,mapPosition:a}});t.outGeometries.push(p),t.outMaterials.push(this._material),t.outTransforms.push(Hn)}}_createAsOverlay(t){const r=iF(t.geometry);if(C(r))return null;this._material.renderPriority=this._renderPriority;const i=r4e(r,this._context.overlaySR),s=i.position.length/3,n=new Float64Array(2*s),o=new NCt(i,n,this._context.layer.uid,t.uid);return o.outBoundingBox=es(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:(this._createUVCoordsFromVertices(o.uvCoords,o.renderData.position,s,this._context.overlaySR),new oG(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer))}_createAsOverlayWater(t){const r=t.uvCoords,i=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of i){if(es(tb),Uh(tb,s),!Hm(tb,this._context.clippingExtent))continue;CR(t.outBoundingBox,tb);const l=cI(s,n,3);if(l.length===0)continue;const c=new Float64Array(r.buffer,2*o*r.BYTES_PER_ELEMENT,2*a),d=L_e({indices:l,attributeData:{position:s,uv0:c}}),p=new hI(d,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),f=tb;Oi(p.boundingSphere,.5*(f[0]+f[3]),.5*(f[1]+f[4]),0,.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1]))),t.outGeometries.push(p)}}static headingVectorFromAngle(t){const r=rt(),i=Y9(t);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}Uy.unitSizeOfTexture=100,Uy.elevationModeChangeTypes={definedChanged:en.RECREATE,staysOnTheGround:en.NONE,onTheGroundChanged:en.RECREATE};const _U=rt(),eb=tr(),o1e=rt(),tb=ao();class LCt extends W7{constructor(t,r){super(t,null,null),this.uvCoords=r}}class NCt extends W7{constructor(t,r,i,s){super(t,i,s),this.uvCoords=r}}function FCt(e,t,r,i){const s=a1e[e.type]&&a1e[e.type][t.type]||kCt[t.type];return s?new s(e,t,r,i):(te.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const kCt={icon:cF,object:eEt,line:cG,path:WEt,fill:_G,extrude:nTt,text:MCt,water:Uy},a1e={"mesh-3d":{fill:PSt}};class UCt extends yce{constructor(t,r,i){super(r.schedule),this._symbol=t,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(t){this._symbol=t;for(let r=0;r<t.symbolLayers.length;r++){const i=this.symbolLayers[r];C(i)||(i.symbol=t,i.symbolLayer=t.symbolLayers.items[r])}}get symbol(){return this._symbol}async doLoad(t){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const s=[];for(let n=0;n<i;n++){const o=r.getItemAt(n);if(o.enabled===!1)continue;vU.renderPriority=1-(1+n)/i,vU.renderPriorityStep=1/i,vU.ignoreDrivers=o._ignoreDrivers;const a=FCt(this.symbol,o,this._context,vU);s.push(Use(t,()=>{this.symbolLayers[n]=null,a.destroy()})),this.symbolLayers[n]=a}await tj(this.symbolLayers,async(n,o)=>{if(v(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}});for(const n of s)n==null||n.remove();if(s.length=0,Ir(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const r=this.symbolLayers[t];return v(r)?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(t=>v(t)&&t.queryForSnapping)}createGraphics3DGraphic(t,r){const i=t.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=v(a)?a.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new Lbt(i,r||this,s,t.layer,n)}get complexity(){return bce(this.symbolLayers.map(t=>Ks(t,"complexity")))}globalPropertyChanged(t,r){const i=this.symbolLayers.length;for(let s=0;s<i;s++){const n=this.symbolLayers[s],o=a=>{const l=a.graphics[s];return l instanceof V0?l:null};if(v(n)&&!n.globalPropertyChanged(t,r,o))return!1}return!0}applyRendererDiff(t,r){return this.loadStatus!==Eh.LOADED?To.Recreate_Symbol:this.symbolLayers.reduce((i,s)=>i!==To.Recreate_Symbol&&v(s)?Math.min(i,s.applyRendererDiff(t,r)):i,To.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===Eh.FAILED||t.diff.type!=="partial")return;const r=t.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(C(s))return;const o=i[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const d=l.graphics[n];v(d)&&a.graphics3DGraphicPatches.forEach(p=>p(d,c))})}})}updateGeometry(t,r){for(let i=0;i<this.symbolLayers.length;i++){const s=this.symbolLayers[i];if(C(s))continue;const n=t.graphics[i];if(C(n)||!s.updateGeometry(n,r))return!1}return!0}onRemoveGraphic(t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(C(i))continue;const s=t.graphics[r];v(s)&&i.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,r=0,i=0;return this.symbolLayers.forEach(s=>{C(s)||(s.loadStatus===Eh.LOADING?t++:s.isFastUpdatesEnabled()?i++:r++)}),{loading:t,slow:r,fast:i}}async queryForSnapping(t,r,i,s){const n=this.symbolLayers.filter(v).filter(a=>v(a.queryForSnapping)).map(a=>a.queryForSnapping(t,r,i,s)),o=await Promise.all(n);return Ir(s),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)v(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const vU={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class BCt extends yce{constructor(t,r,i){super(r),this.symbol=t,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const r=await this.symbol.fetchSymbol({signal:t});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),v(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return v(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:vce}globalPropertyChanged(t,r){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,r)}applyRendererDiff(t,r){return v(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,r):To.Recreate_Symbol}prepareSymbolPatch(t){v(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,r){return!!v(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,r)}onRemoveGraphic(){}getFastUpdateStatus(){return v(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){v(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function Vce(e){return e instanceof BCt?e.graphics3DSymbol:e instanceof UCt?e:null}const dF=te.getLogger("esri.views.3d.layers.graphics.labelPlacement");function zCt(e){const t=ZCt(e);if(C(t))return null;const r=VCt(e,t);if(C(r))return null;const i=r.anchor,s=!!t.hasLabelVerticalOffset;return GCt({anchor:i,verticalOffset:t.verticalOffset,screenOffset:rt(),centerOffset:ar(0,0,0,-1),centerOffsetUnits:"world",translation:$(),elevationOffset:0,hasLabelVerticalOffset:s},r,e)}function VCt(e,t){if(t.anchor)return t;const r=e.labelClass.labelPlacement,i=Ym[r],s=i||YV(e);return r&&!i&&dF.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),jCt(s,e)}function jce(e){const t=e.graphics3DGraphic.graphics3DSymbol,r=Vce(t);return v(r)?r.symbol.symbolLayers.getItemAt(0):null}function jCt(e,t){const r=t.graphics3DGraphic.graphic.geometry;if(C(r))return null;if(v(t.disablePlacement))return t.labelClass.labelPlacement?(dF.warnOncePerTick(l1e(e.placement,t.disablePlacement.logEntityDescription)),YV(t)):e;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return dF.warnOncePerTick(l1e(e.placement,`'${i}' geometries`)),YV(t);break;case"point":case"mesh":return e}return e}function l1e(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function YV(e){const t=e.graphics3DGraphic.graphic.geometry;if(C(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=jce(e);return v(r)&&r.type==="extrude"?Ym["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Ym["above-center"];default:return}}function GCt(e,t,r){const i=r.graphics3DGraphic.graphic.geometry;if(C(i))return null;switch(i.type){case"point":qCt(e,t,r);break;case"polygon":HCt(e,t,r);break;case"mesh":Gce(e,t,r.graphics3DGraphic.graphics[0])}return e}function HCt(e,t,r){const i=jce(r);if(!C(i))switch(i.type){case"extrude":{const s=r.graphics3DGraphic.graphics[0];v(s)?(s.getBoundingBoxObjectSpace(fL),Gm(fL,e.translation),e.translation[2]=Kx(fL)/2):ue(e.translation,0,0,0),Gce(e,t,s);break}}}function qCt(e,t,r){const i=jce(r);if(C(i))return;const s=r.graphics3DGraphic.graphics[0];switch(v(s)?s.getCenterObjectSpace(e.translation):ue(e.translation,0,0,0),i.type){case"icon":case"text":WCt(e,t,r,s);break;case"object":Gce(e,t,s)}}function WCt(e,t,r,i){const{graphics3DGraphic:s}=r,n=v(i)?i.getScreenSize():null;if(!s.isDraped&&v(n)){const o=XCt(r);t3[0]=n[0]/2*(t.normalizedOffset[0]-o[0]),t3[1]=n[1]/2*(t.normalizedOffset[1]-o[1]),e.screenOffset[0]=t3[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=t3[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=t3[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(Ym[r.labelClass.labelPlacement]&&dF.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function XCt(e,t=JCt){const{graphics3DGraphic:r}=e,i=r.graphics[0],s=v(i)?i.stageObject.geometryRecords[0].material:null;if(s&&s instanceof aI){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function Gce(e,t,r){const i=v(r)?r.getBoundingBoxObjectSpace(fL):fL,s=Fe(i[3]-i[0],i[4]-i[1],i[5]-i[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=Ie(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function YCt(e){return e==="above-center"}function ZCt(e){const t=e.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=e,s=Vce(i.graphics3DSymbol),n=qi(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Ym[t]||YV(e);return v(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:c1e(n.verticalOffset),anchor:null,normalizedOffset:null}:r&&r.hasVisibleVerticalOffset()&&(C(n)||!n.supportsCallout()||!n.verticalOffset||i.isDraped)?YCt(o.placement)?{placement:"above-center",verticalOffset:c1e(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(dF.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function c1e(e){const{screenLength:t,minWorldLength:r,maxWorldLength:i}=e;return{screenLength:t,minWorldLength:r,maxWorldLength:i}}const Ym={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},u1e={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in u1e){const t=u1e[e],r=Ym[e];t.forEach(i=>{Ym[i]=r})}Object.freeze&&(Object.freeze(Ym),Object.keys(Ym).forEach(e=>{Object.freeze(Ym[e]),Object.freeze(Ym[e].normalizedOffset)}));const t3=[0,0],JCt=[0,0],fL=ao();class d1e{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,r){this._materials.set(t,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const KX=512,QX=4096,KCt=.85,QCt=.95;let j$=class extends be{constructor(e){super(e),this.type=yg.Texture,this.id=Su(),this.events=new $s,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._stage=this.view._stage,this._canvas=this._create2DCanvas(),this._ctx=this._canvas.getContext("2d"),this._stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=tt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this._atlas.size.width}get height(){return this._atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,flipped:!0,samplingMode:at.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return v(this._glTexture)||(this._glTexture=new dt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Ot.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=Gs(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=tt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",KX.toString()),e.setAttribute("height",KX.toString()),e}_update2DCanvasSize(){this._canvas.setAttribute("width",this._atlas.size.width.toString()),this._canvas.setAttribute("height",this._atlas.size.height.toString())}_createAtlasRegion(e=KX){this._atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let r=Math.max(e,t);return r+=256,r=dR(r),r=Math.min(r,QX),r}_resizeAtlas(e,t){t=t||e;const r=this._atlas;r.size.width=e,r.size.height=t,v(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this._atlas;e.cursor.x=r3,e.cursor.y=r3+h1e,e.lineHeight=0,this._needsClear=!0}_getAtlasUsage(){const e=this._atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this._elementsToRemove.size,t=this._elementsToAddOrUpdate.size,r=this._elements.size;return this._getAtlasUsage()/r*(r+t-e)}_addAtlasElement(e,t,r,i){const s=this._atlas,{renderedWidth:n,renderedHeight:o,displayWidth:a,displayHeight:l}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,e.placement.size.width=n,e.placement.size.height=o,e.placement.size.displayWidth=a,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height],s.cursor.x+=r,s.lineHeight=Math.max(s.lineHeight,i),this._elements.set(t,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const t=e.placement.offset,r=e.placement.size;this._ctx.clearRect(t.x,t.y,r.width,r.height),this._elements.delete(e.textId)}}_ensureStageObjects(e){const t=this._stageObjects.get(e);if(t)return t;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const r=this._stageObjects.get(e);r&&r.delete(t)&&(t.geometries[0].vertexAttributes.get(M.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const r=this._atlas,i=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+r3,a=n+r3+h1e;if(r.cursor.x+o<r.size.width&&r.cursor.y+a<r.size.height)this._addAtlasElement(e,i,o,a),this._elementsToRender.set(i,e),this._elementsToAddOrUpdate.delete(i);else{if(!(r.cursor.y+a+r.lineHeight<r.size.height)){const l=this._getExpectedAtlasUsage(),c=l>KCt&&r.size.width<QX;return c&&this._resizeAtlas(2*r.size.width,2*r.size.height),!t||!c&&l>QCt&&r.size.width===QX?(this._processRemovals(),aM.OK):(this._repack(),aM.REPACK)}r.cursor.x=r3,r.cursor.y+=r.lineHeight,r.lineHeight=0,this._addAtlasElement(e,i,o,a),this._elementsToRender.set(i,e),this._elementsToAddOrUpdate.delete(i)}return aM.OK}_processRemovals(){this._elementsToRemove.forEach((e,t)=>{const r=this._stageObjects.get(t);r&&r.size!==0||this._removeAtlasElement(e),r&&r.size===0&&this._stageObjects.delete(t)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,t)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(t,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const t=this._stageObjects.get(e.textId);t&&t.forEach(r=>{r.geometries[0].vertexAttributes.get(M.UV0).data=new Float32Array(e.placement.uvMinMax),r.geometries[0].vertexAttributes.get(M.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],r.geometryVertexAttrsUpdated(r.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let r=!1;if(wo(this._elementsToAddOrUpdate,(s,n)=>{const o=this._elements.get(n);if(o&&o.rendered){const a=this._stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0].vertexAttributes,d=this._elements.get(n);c.get(M.UV0).data=new Float32Array(d.placement.uvMinMax),c.get(M.SIZE).data=new Float32Array([d.placement.size.displayWidth,d.placement.size.displayHeight]),l.geometryVertexAttrsUpdated(l.geometryRecords[0])}),this._elementsToAddOrUpdate.delete(n),!1}return this._processAddition(this._elementsToAddOrUpdate.get(n),t)===aM.REPACK&&(r=!0,!0)}),r)return void this.runTask(FI,!1);let i=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),wo(this._elementsToRender,(s,n)=>(this._processRenderingRequest(s),this._elementsToRender.delete(n),i=!0,e.madeProgress(),e.done)),i&&v(this._glTexture)&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&rwt.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const r=e.key;this._elementsToAddOrUpdate.has(r)||this._elementsToAddOrUpdate.set(r,{textId:r,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(r,t),this._elementsToRemove.delete(r),this.setDirty()}removeTextTexture(e,t){const r=e.key;this._elementsToRemove.set(r,this._elements.get(r)),this._removeStageObject(r,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((r,i)=>e.push({element:r,key:i}));let t=!0;for(let r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){t=!1;break}if(!t||this._elementsToRemove.size){e.sort((r,i)=>r.key.localeCompare(i.key)),this._elements.clear();for(const{element:r,key:i}of e)this._elements.set(i,r);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:t,_elementsToRemove:r,_atlas:i}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:r,atlas:i,_resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:(n,o)=>s.runTask(n,o)}}};u([h({constructOnly:!0})],j$.prototype,"view",void 0),u([h({type:Boolean})],j$.prototype,"updating",void 0),j$=u([I("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],j$);const r3=2,h1e=2;var aM;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(aM||(aM={}));let BS=class extends be{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new hr,this._handles.add([ie(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ie(()=>{var e;return(e=this.view.state)==null?void 0:e.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Ot.LABELER,this)]),this._textTextureAtlas=new j$({view:this.view}),this._hudMaterialCollection=new d1e(this.view._stage),this._calloutMaterialCollection=new d1e(this.view._stage)}dispose(){this._handles=Qe(this._handles),this._textTextureAtlas=tt(this._textTextureAtlas),this._hudMaterialCollection=tt(this._hudMaterialCollection),this._calloutMaterialCollection=tt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((t,r)=>{this._labels.set(r,t),t.graphics3DGraphic.setVisibilityFlag(Dh.USER_SETTING,!0,Ua.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((t,r)=>{t.graphics3DGraphic.setVisibilityFlag(Dh.USER_SETTING,!1,Ua.LABEL),this.setLabelGraphicVisibility(t.graphics3DGraphic,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const r=e.textTextureResources.textRenderers[t._labelIndex];v(r)&&this._textTextureAtlas.addTextTexture(r,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const r=e.textTextureResources.textRenderers[t._labelIndex];v(r)&&this._textTextureAtlas.removeTextTexture(r,t.stageObject)}e.rendered=!1}get running(){var e;return this.view.ready&&(this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(eAt(t)){if(!p1e(t)){if(tAt(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),eY(t)){this._dirty=!0;continue}if(!p1e(t))continue}wo(t.labelsToInitialize,(r,i)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(i,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textTextureResources.initialized||!r.visible&&r.hasGraphics3DResources)&&(t.labelsToInitialize.delete(i),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),Ir(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,i=r.layer,s=i.labelingInfo&&i.labelingInfo.filter(a=>!!a.symbol);if(!s||s.length===0)return;const n=new Array(s.length);let o=!1;await tj(s,async(a,l)=>{const c=a.symbol,d=Vce(r.getOrCreateGraphics3DSymbol(c));if(C(d))return void te.getLogger(this.declaredClass).error("Failed to create Graphics3DSymbol for label");await d.load(),Ir(t);let p=null;Soe(c)&&c.hasVisibleCallout()&&(p=Ibt(c,r.symbolCreationContext),await p.load(),Ir(t));const f=await Jh(eFe(a,e.layer.fieldsIndex,this.view.spatialReference));if(Ir(t),f.ok===!0){const m=await this._createTextRenderParameters(d.symbol);Ir(t),n[l]={labelClass:a,labelFunction:f.value,graphics3DSymbol:d,graphics3DCalloutSymbolLayer:p,calloutSymbolLayerIndex:0,textRenderParameters:m}}else te.getLogger(this.declaredClass).error(`Label expression failed to evaluate: ${f.error}`),o=!0}),Ir(t),o||(e.labelClassContexts=n)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(Ps(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?vG.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced,r.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,r,i,s){const n={text:e.text,centerOffset:r.centerOffset,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffsetUnits:r.centerOffsetUnits,horizontalPlacement:Cve(r.anchor),verticalPlacement:_Tt(r.anchor),verticalOffset:r.verticalOffset,debugDrawLabelBorder:hi.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return rb.graphic=t,rb.renderingInfo=null,rb.layer=i,s.createLabel(rb,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,r,i,s){const n={symbol:t,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffset:i.centerOffset,centerOffsetUnits:i.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return rb.graphic=e,rb.renderingInfo=n,rb.layer=s,r.createGraphics3DGraphic(rb)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:r}=e,i=e.labelingContext,s=i.labelClassContexts;if(!s||s.length===0||!i.emptySymbolLabelSupported&&t.graphics.length===0)return!1;let n=!1;const o=t.graphic,a=i.layer,l=XJ(i.layer),c=this.view._stage;for(let d=0;d<s.length;d++){const p=r.textRenderers[d],f=r.labelPlacements[d];if(C(p)||C(f))continue;const m=s[d],g=m.graphics3DSymbol,_=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,x=g.symbolLayers[0];if(!x)continue;x.setElevationInfoOverride(i.elevationInfoOverride);const b=this._createTextSymbolGraphic(p,o,f,a,x);if(!b)return!1;b._labelClass=m.labelClass,b._labelIndex=d,t.addLabelGraphic(b,c,i.stageLayer),t.setVisibilityFlag(Dh.USER_SETTING,l,Ua.LABEL),t.clearVisibilityFlag(Dh.SCALE_RANGE,Ua.LABEL),t.setVisibilityFlag(Dh.DECONFLICTION,!1,Ua.LABEL),n=!0;const w=m.graphics3DCalloutSymbolLayer;if(w&&f.hasLabelVerticalOffset){w.setElevationInfoOverride(i.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,_,w,f,a);v(T)&&(m.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(T,c,i.stageLayer))}break}return i.scaleVisibility&&n&&i.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelGraphics){if(r._labelClass==null)continue;const i=t[r._labelIndex].graphics3DSymbol.symbolLayers[0];i!=null&&i.onRemoveGraphic(r)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<i.length;n++){const o=i[n];if(t.textRenderers[n]=null,t.labelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const b=a.needsHydrationToEvaluate()?B1t(s,r.layer):s;l=a.evaluate(b)}catch{l=null}else l=a.evaluate(s);if(C(l)||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,d=c.symbol&&c.symbol.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,m=r.disablePlacement,g=zCt({graphics3DGraphic:p,labelSymbol:d,labelClass:f,disablePlacement:m});if(C(g))continue;const _=Cve(g.anchor),x=_4e(_);t.textRenderers[n]=new g4e(l,x,o.textRenderParameters),t.labelPlacements[n]=g}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const r={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},i=t.graphic.uid;e.labels.set(i,r),e.labelsToInitialize.set(i,r),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const r=t.graphic.uid,i=e.labels.get(r);i&&(this._destroyGraphic(i,r),e.labels.delete(r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of t){const i=e.labels.get(r);i&&(this._removeGraphic(e,i.graphics3DGraphic),this._addGraphic(e,i.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const r of t.labelClassContexts){const i=new Map;t.labels.forEach(n=>{const o=n.graphics3DGraphic;i.set(o.graphic.uid,o)});const s=n=>n.labelGraphics[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,i,s),r.graphics3DCalloutSymbolLayer){const n=o=>o.labelGraphics[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,i,n)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,r)=>{this._destroyGraphic(t,r),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(r,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,r){const i=r&&r.emptySymbolLabelSupported||!1,s=r&&r.elevationInfoOverride||null,n=r&&r.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a={graphics3DCore:e,layer:o,scaleVisibility:t,emptySymbolLabelSupported:i,elevationInfoOverride:s,disablePlacement:n,active:o.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new AFe({isPickable:!0},o.uid)};return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>XJ(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const r=this._labelingContexts.indexOf(t);this._labelingContexts.splice(r,1),t.labels.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const r=e.graphic.uid,i=this._labels.get(r);i&&i.visible!==t&&(t&&!i.rendered?(this._labelsToAdd.set(r,i),this._labelsToRemove.delete(r),i.textTextureResources.initialized||i.labelingContext.labelsToInitialize.set(r,i)):!t&&i.rendered&&(this._labelsToRemove.set(r,i),this._labelsToAdd.delete(r)),i.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>eY(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,r)=>t+(eY(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function eAt(e){return e.active&&XJ(e.layer)}function eY(e){return e.labelClassPromise&&!!e.labelClassAbortController}function p1e(e){return e.labelClassContexts&&e.labelClassContexts.length}function tAt(e){return e.labelClassContexts===null}u([h({constructOnly:!0})],BS.prototype,"view",void 0),u([h({constructOnly:!0})],BS.prototype,"deconflictor",void 0),u([h()],BS.prototype,"_textTextureAtlas",void 0),u([h({type:Boolean,readOnly:!0})],BS.prototype,"updating",null),BS=u([I("esri.views.3d.layers.graphics.Labeler")],BS);const rb=new $bt(null,null,null);class Bm{constructor(t,r,i,s=null){this.lij=[0,0,0],this.extent=tr(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Al.VISIBLE_ON_SURFACE,screenRect:tr(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,r,i,s)}acquire(t,r,i,s){this.tilingScheme=s,this.id=Bm.id(t,r,i),this.lij[0]=t,this.lij[1]=r,this.lij[2]=i,s.getExtent(t,r,i,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const r=this.lij[0]+1,i=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(r,i,s,this.tilingScheme),t[1].acquire(r,i+1,s,this.tilingScheme),t[2].acquire(r,i,s+1,this.tilingScheme),t[3].acquire(r,i+1,s+1,this.tilingScheme),t):[new Bm(r,i,s,this.tilingScheme),new Bm(r,i+1,s,this.tilingScheme),new Bm(r,i,s+1,this.tilingScheme),new Bm(r,i+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,qv(t.measures.screenRect,this.measures.screenRect)}static id(t,r,i){return`${t}/${r}/${i}`}}var Al;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Al||(Al={}));const s5e=.5*Math.PI,rAt=s5e/Math.PI*180;class iAt{constructor(t){this._renderCoordsHelper=t.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:$(),direction:$()};for(let r=0;r<4;r++)this._extent[r]={origin:$(),direction:$(),cap:{next:null,direction:$()}},this._planes[r]=di();this._planes[Gi.NEAR]=di(),this._planes[Gi.FAR]=di(),this._planesWithoutFar=this._planes.slice(0,5)}update(t,r,i,s=!0){const n=this._extent;this._toRenderBoundingExtent(t,r,i),ye(this._center.origin,n[0].origin,n[2].origin),de(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),s||de(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,n1(a.cap.direction,a.origin,l.origin),bN(a.direction,a.cap.direction,a.origin,this._planes[o]),s||de(a.direction,a.direction,-1)}bN(n[0].cap.direction,n[1].cap.direction,n[0].origin,this._planes[Gi.NEAR]),s?cte(this._planes[Gi.NEAR],this._planes[Gi.FAR]):(Wj(this._planes[Gi.FAR],this._planes[Gi.NEAR]),cte(this._planes[Gi.NEAR],this._planes[Gi.NEAR])),this._maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Kr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(t,r,i=!1){if(t==null)return!1;if(this._renderCoordsHelper.viewingMode===Ye.Global){const n=this._maxSpanSpatialReference.isGeographic?rAt:s5e*r;if(this._maxSpan>n)return!0;if(t.altitude!=null&&t.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this._maxSpan===0){const n=this._extent[0];return!(i||!t.intersectsRay(ep(n.origin,n.direction)))}for(let n=0;n<this._extent.length;n++){const o=this._extent[n];if(!i&&t.intersectsRay(ep(o.origin,o.direction))||t.intersectsLineSegment(B2(o.origin,o.cap.next,nAt),o.cap.direction))return!0}const s=i?this._planes:this._planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if(Smt(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,r,i){goe(t,Hf),Hf[2]=i,Qh(r,Hf,tY,this._renderCoordsHelper.spatialReference),Pn(f1e,tY),es(Vu);for(const{x0:n,x1:o,y0:a,y1:l}of sAt)for(let c=0;c<5;c++){const d=c/4;Hf[0]=Ft(t[n],t[o],d),Hf[1]=Ft(t[a],t[l],d),Hf[2]=i,So(Hf,r,Hf,this._renderCoordsHelper.spatialReference),je(Hf,Hf,f1e),x0(Vu,Hf)}ue(this._extent[0].origin,Vu[0],Vu[1],Vu[2]),ue(this._extent[1].origin,Vu[3],Vu[1],Vu[2]),ue(this._extent[2].origin,Vu[3],Vu[4],Vu[2]),ue(this._extent[3].origin,Vu[0],Vu[4],Vu[2]);for(let n=0;n<4;++n)je(this._extent[n].origin,this._extent[n].origin,tY)}_toRenderBoundingExtentLocal(t,r,i){Bj(t,r,o_,this._renderCoordsHelper.spatialReference),ue(this._extent[0].origin,o_[0],o_[1],i),ue(this._extent[1].origin,o_[2],o_[1],i),ue(this._extent[2].origin,o_[2],o_[3],i),ue(this._extent[3].origin,o_[0],o_[3],i)}_toRenderBoundingExtent(t,r,i){switch(this._renderCoordsHelper.viewingMode){case Ye.Global:this._toRenderBoundingExtentGlobal(t,r,i);break;case Ye.Local:this._toRenderBoundingExtentLocal(t,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(Hi(t.planes[Gi.NEAR],this._center.origin)<0&&Te(this._center.direction,t.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(Hi(t.planes[Gi.NEAR],i.origin)<0&&Te(i.direction,t.direction)<0)return!0}return!1}}const sAt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Hf=$(),tY=$e(),f1e=$e(),Vu=ao(),o_=tr(),nAt=xg();class oAt{constructor(t){this._renderCoordsHelper=t,this._surfaceElevation=0,this._cache=new Map,this._frustum=new ww(t),this._extendedFrustum=new ww(t),this._intersector=new iAt({renderCoordsHelper:t}),this._renderCoordsHelper=t}begin(t,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(t.eye)>r,this._frustum.update(t),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(t)}end(){this._cache.clear()}calculate(t){if(this._allTilesInvisible)return Al.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===Ye.Global&&t.lij[0]>=aAt&&t.lij[0]<lAt,i=this._getOrCalculateSingleTileVisibility(t,!r);return i!==Al.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(t):i}_shortenFrustumFarPlane(t){const r=ww.nearFarLineIndices,i=t.mutablePoints;for(const s of r){const[n,o]=s,a=i[n],l=i[o];ge(Jd,l,a),de(Jd,Jd,uAt),ye(i[o],a,Jd)}t.updatePoints(i)}_calculateAggregatedChildrenVisibility(t){let r=Al.INVISIBLE;const i=this._cache.get(t.id);if(i!=null)return i;const s=_1e.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Al.INVISIBLE&&(r=o,o===Al.VISIBLE_ON_SURFACE))break}return _1e.release(s),this._cache.set(t.id,r),r}_getOrCalculateSingleTileVisibility(t,r){const i=this._cache.get(t.id);if(i!=null)return i;const s=this._calculateSingleTileVisibility(t);return r&&this._cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Ye.Global&&t.lij[0]<cAt?this._calculateSingleTileVisibilitySided(t,!1)===Al.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this._aboveGround)}_calculateSingleTileVisibilitySided(t,r){this._intersector.update(t.extent,t.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Kr(t.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?Al.VISIBLE_ON_SURFACE:Al.VISIBLE_WHEN_EXTENDED:Al.INVISIBLE}_updateExtendedFrustum(t){this._extendedFrustum.update(t),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(t.eye,Jd);this._aboveGround||Fl(r,r);const i=Eo(-Te(r,t.viewForward));if(this._allTilesInvisible=i>(Math.PI+t.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>t.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Jd),a){case ot.FAR_BOTTOM_LEFT:case ot.FAR_TOP_LEFT:case ot.NEAR_BOTTOM_LEFT:case ot.NEAR_TOP_LEFT:ute(this._extendedFrustum.planes[Gi.LEFT],Jd,Jd);break;case ot.FAR_BOTTOM_RIGHT:case ot.FAR_TOP_RIGHT:case ot.NEAR_BOTTOM_RIGHT:case ot.NEAR_TOP_RIGHT:ute(this._extendedFrustum.planes[Gi.RIGHT],Jd,Jd)}de(Jd,Jd,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(ep(l,Jd),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(n),Il(n[ot.NEAR_BOTTOM_LEFT],n[ot.NEAR_BOTTOM_RIGHT],n[ot.NEAR_TOP_RIGHT],g1e),Il(n[ot.NEAR_BOTTOM_RIGHT],n[ot.NEAR_TOP_RIGHT],n[ot.NEAR_TOP_LEFT],y1e),Te(g1e,y1e)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[ot.NEAR_BOTTOM_LEFT],o[ot.NEAR_BOTTOM_RIGHT]]=[o[ot.NEAR_BOTTOM_RIGHT],o[ot.NEAR_BOTTOM_LEFT]]:[o[ot.NEAR_TOP_LEFT],o[ot.NEAR_TOP_RIGHT]]=[o[ot.NEAR_TOP_RIGHT],o[ot.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this._surfaceElevation-m1e;return{zWithMargin:t,pointIndices:ww.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>t}}_extendedFrustumParametersBelowSurface(){const t=this._surfaceElevation+m1e;return{zWithMargin:t,pointIndices:ww.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<t}}}const aAt=2,lAt=6,cAt=12,uAt=.95,m1e=1,Jd=$(),g1e=di(),y1e=di(),_1e=new ro(Array,e=>{e.length!==4&&(e[0]=new Bm,e[1]=new Bm,e[2]=new Bm,e[3]=new Bm)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class dAt{constructor(t){this._camera=new Li,this._focusOnMap=[0,0],this._screenRect=tr(),this._tileSize=t.tileSize,this._renderCoordsHelper=t.renderCoordsHelper,this._tilingScheme=t.tilingScheme,this._visibility=new oAt(t.renderCoordsHelper)}begin(t,r,i){this._camera.copyFrom(t),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,wOe(0,0,t.fullWidth,t.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(t){t.measures.visibility=this._visibility.calculate(t),t.measures.distance=xZe(t.extent,this._focusOnMap),t.measures.visibility!==Al.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const r=hAt,i=1<<r,s=t.measures.screenRect;kd(s);let n=0;const o=t.lij[0]+r,a=t.lij[1]<<r,l=t.lij[2]<<r,c=this._tileSizeWithBias(t),d=c*c;for(let p=0;p<i;p++)for(let f=0;f<i;f++)if(n+=this._computeScreenArea(t,o,a+p,l+f,s),n>d)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===Al.VISIBLE_WHEN_EXTENDED?this._tileSize*pAt:this._tileSize}_computeScreenArea(t,r,i,s,n){const o=t.measures.visibility===Al.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,s,o,ib),kd(rY);for(let a=0;a<4;a++)RM(rY,ib[a]);return ox(n,rY,n),zye(ib[0],ib[1],ib[2])+zye(ib[0],ib[2],ib[3])}_projectToScreen(t,r,i,s,n){this._tilingScheme.ensureMaxLod(t),this._tilingScheme.getExtent(t,r,i,i3),this._toRenderCoords(i3,0,3,sb[0]),this._toRenderCoords(i3,2,3,sb[1]),this._toRenderCoords(i3,2,1,sb[2]),this._toRenderCoords(i3,0,1,sb[3]),s&&(this._projectToPlane(sb,this._camera.frustum[Gi.NEAR]),this._projectToPlane(sb,this._camera.frustum[Gi.TOP]),this._projectToPlane(sb,this._camera.frustum[Gi.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(sb[o],v1e),this._camera.renderToScreen(v1e,n[o])}_projectToPlane(t,r){for(let s=0;s<4;s++)n3[s]=Hi(r,t[s]);const i=Math.max(n3[0],n3[1],n3[2],n3[3]);if(i>0){const s=de(s3,r,-i);for(let n=0;n<4;n++)ye(t[n],t[n],s)}}_toRenderCoords(t,r,i,s){return s3[0]=t[r],s3[1]=t[i],s3[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(s3,this._tilingScheme.spatialReference,s),s}}const rY=tr(),hAt=2,pAt=5,ib=[Vs(),Vs(),Vs(),Vs()],i3=tr(),s3=$(),sb=[$(),$(),$(),$()],n3=[0,0,0,0],v1e=ul();function Q8t(e,t,r){if(C(e)||C(r))return!1;let i=!0;return yo[0]=e.xmin!=null?e.xmin:0,yo[1]=e.ymin!=null?e.ymin:0,yo[2]=e.zmin!=null?e.zmin:0,i=i&&Yi(yo,e.spatialReference,0,t,r,0,1),yo[0]=e.xmax!=null?e.xmax:0,yo[1]=e.ymax!=null?e.ymax:0,yo[2]=e.zmax!=null?e.zmax:0,i=i&&Yi(yo,e.spatialReference,0,t,r,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),i}function n5e(e,t,r){if(C(e)||C(r))return!1;let i=!0;return yo[0]=e.xmin!=null?e.xmin:0,yo[1]=e.ymin!=null?e.ymin:0,yo[2]=e.zmin!=null?e.zmin:0,i=i&&Yi(yo,e.spatialReference,0,yo,r,0,1),t[0]=yo[0],t[1]=yo[1],yo[0]=e.xmax!=null?e.xmax:0,yo[1]=e.ymax!=null?e.ymax:0,yo[2]=e.zmax!=null?e.zmax:0,i=i&&Yi(yo,e.spatialReference,0,yo,r,0,1),t[2]=yo[0],t[3]=yo[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),i}const yo=$();let Pa=class extends be{constructor(e){super(e),this.tiles=new Ge,this.tileSize=512,this._idToTile=new Map,this._handles=new hr,this._clients=new Set,this._dirty=!1,this._newTiles=new Qt}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(v(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void te.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||v(t)&&e&&t.equals(e))return;const r=v(e)?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(C(this.filterExtent)||!this.tilingScheme)return null;const e=tr();return n5e(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){return this._filterExtentRect?this.tilingScheme.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([ie(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),bi),ie(()=>{var e,t,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),Qi)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Ot.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Gs(this._frameWorker),this._handles=Qe(this._handles)}addClient(){const e=mAt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(FI))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),v(this._frameWorker)&&(this._frameWorker.priority=Ot.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&v(this._frameWorker)&&(this._frameWorker.priority=Ot.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new dAt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this._rootTileIds.map(e=>new Bm(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((t,r)=>{const i=t.measures.screenRect,s=r.measures.screenRect;return i[1]+i[3]-(s[1]+s[3])}),kd(bU);for(let t=0;t<e.length;t++)if(ox(bU,e.data[t].measures.screenRect,bU),pg(bU)>gAt)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!HF(this._filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==Al.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const i of this.tiles.items)i.used=!1;const t=e.filter(i=>{const s=this._idToTile.get(i.id);return s?(s.copyMeasurementsFrom(i),s.used=!0):this._idToTile.set(i.id,i),!s}),r=this.tiles.items.filter(i=>!i.used&&(this._idToTile.delete(i.id),!0));this.tiles.removeMany(r),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===Al.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};u([h({constructOnly:!0})],Pa.prototype,"scheduler",void 0),u([h({constructOnly:!0})],Pa.prototype,"renderCoordsHelper",void 0),u([h({constructOnly:!0})],Pa.prototype,"tilingSchemeOwner",void 0),u([h({constructOnly:!0})],Pa.prototype,"cameraOnSurface",void 0),u([h({constructOnly:!0})],Pa.prototype,"focus",void 0),u([h({constructOnly:!0})],Pa.prototype,"viewState",void 0),u([h({constructOnly:!0})],Pa.prototype,"terrain",void 0),u([h()],Pa.prototype,"tiles",void 0),u([h()],Pa.prototype,"tileSize",void 0),u([h({readOnly:!0})],Pa.prototype,"tilingScheme",null),u([h()],Pa.prototype,"filterExtent",null),u([h({readOnly:!0})],Pa.prototype,"_filterExtentRect",null),u([h({readOnly:!0})],Pa.prototype,"_rootTileIds",null),u([h({value:!1})],Pa.prototype,"suspended",null),u([h({readOnly:!0})],Pa.prototype,"updating",null),Pa=u([I("esri.views.3d.layers.support.FeatureTileTree3D")],Pa);let fAt=0;function mAt(){return fAt++}const bU=tr(),gAt=10;let ea=class extends be{constructor(){super(...arguments),this._propertiesPool=new Jv({camera:Li},this),this._lastSeenCameraProjectionValues=new Li,this.events=new $s,this.viewingMode=Ye.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new I_({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Jv({camera:Li},this)}createInitialCamera(){if(this.viewingMode===Ye.Global){const e=Kr(this.spatialReference).radius;this.camera=new Li(Fe(4*e,0,0),Fe(e,0,0),Fe(0,0,1))}else this.camera=new Li(Fe(0,0,100),Fe(0,0,0),Fe(0,1,0))}get animation(){return this.cameraController instanceof XN&&v(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==_p&&_p.copyFrom(e),_p.computeUp(this.viewingMode),b1e.camera=_p,this.events.emit("before-camera-change",b1e);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,_p)&&(this._lastSeenCameraProjectionValues.copyFrom(_p),w1e.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",w1e)),(!t||!t.equals(_p))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(_p)),this._cameraChanged=!t||!t.almostEquals(_p),this._cameraChanged)){const r=T2e(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return v(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=v(e)?e.clone():null}get fixedContentCamera(){return v(this._contentCamera)}get isGlobal(){return this.viewingMode===Ye.Global}get isLocal(){return this.viewingMode===Ye.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.addHandles(no(()=>e.state===Bs.Finished||e.state===Bs.Stopped,()=>{this._set("cameraController",null),this.updateCamera(t=>e.onControllerEnd(t))},{sync:!0,once:!0})),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Bs.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Bs.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();_p.copyFrom(this._get("camera")),e(_p),this.camera=_p,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[Vt.TOP]!==t.padding[Vt.TOP]||e.padding[Vt.RIGHT]!==t.padding[Vt.RIGHT]||e.padding[Vt.BOTTOM]!==t.padding[Vt.BOTTOM]||e.padding[Vt.LEFT]!==t.padding[Vt.LEFT]}};u([h()],ea.prototype,"mode",void 0),u([h({readOnly:!0,type:jR})],ea.prototype,"animation",null),u([h({type:Li})],ea.prototype,"camera",null),u([h()],ea.prototype,"pixelRatio",null),u([h({})],ea.prototype,"_contentCamera",void 0),u([h({type:Li})],ea.prototype,"contentCamera",null),u([h({readOnly:!0})],ea.prototype,"fixedContentCamera",null),u([h({readOnly:!0})],ea.prototype,"constraints",void 0),u([h({readOnly:!0})],ea.prototype,"events",void 0),u([h({readOnly:!0})],ea.prototype,"isGlobal",null),u([h({readOnly:!0})],ea.prototype,"isLocal",null),u([h({readOnly:!0})],ea.prototype,"viewingMode",void 0),u([h({readOnly:!0})],ea.prototype,"spatialReference",void 0),u([h()],ea.prototype,"navigating",null),u([h()],ea.prototype,"stationary",null),u([h()],ea.prototype,"_cameraChanged",void 0),u([h()],ea.prototype,"cameraController",null),ea=u([I("esri.views.3d.state.ViewState")],ea);const yAt=ea,_p=new Li,b1e={camera:null},w1e={camera:null};class _At{constructor(t,r,i){this.viewingMode=t,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Qt,this._tolerance=rI,this._tmpRay=ca(),this._tmpRegion=tr(),this._validateHUDIntersector=Of(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(t,r,i){return this.intersectRay(this._getPickRay(t,this._tmpRay),x1e(this.viewingMode),r,i)}intersectScreenFreePointFallback(t,r,i){return this.intersectRayFreePointFallback(this._getPickRay(t,this._tmpRay),r,i)}intersectRayFreePointFallback(t,r,i){return this.intersectRay(t,x1e(this.viewingMode),r,i)||this._intersectRayFreePointLocal(t,r)}intersectRay(t,r,i,s){return r.options.selectionMode=!1,r.options.store=qa.MIN,this.computeIntersection(t,r,s),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(t,r,i=.5,s=.5){return t.getRenderCenter(TU,i,s),TU[0]+=.0466,TU[1]-=.0123,Vle(t,TU,r)}intersectIntersectorScreen(t,r,i){this.computeIntersection(this._getPickRay(t,this._tmpRay),r,i)}intersectToolIntersectorScreen(t,r,i){const s=this._getPickRay(t,this._tmpRay);this.intersectToolIntersectorRay(s,r,i)}intersectToolIntersectorRay(t,r,i){r.options.selectionMode=!0,this.computeIntersection(t,r,i);const s=r.results.min;!!this._view.basemapTerrain&&this._view.basemapTerrain.opaque||B0(s)&&s.intersector!==zs.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(t,r,i))}setTolerance(t=rI){this._tolerance=t}addIntersectionHandler(t){this._externalIntersectionHandlers.push(t),this._externalIntersectionHandlers.sort((r,i)=>r.type===zs.TERRAIN?1:i.type===zs.TERRAIN?-1:0)}removeIntersectionHandler(t){this._externalIntersectionHandlers.removeUnordered(t)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===zs.TERRAIN?1:i.type===zs.TERRAIN?-1:0)}_getPickRay(t,r){const i=this._view.state.camera;return aLe(i,t,r)}_intersectRayFreePointLocal(t,r){if(this.viewingMode!==Ye.Local||C(t))return!1;const i=this._view.renderDataExtent;if(C(i))return ye(r,t.origin,xe(Xe.get(),t.direction)),!0;const s={x:i.xmax-i.xmin,y:i.ymax-i.ymin,z:8*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},n=Math.max(s.x,s.y,s.z);if(n===0)return ye(r,t.origin,xe(Xe.get(),t.direction)),!0;const o=this._view.state.camera,a=Math.max(0,i.xmin-o.eye[0],o.eye[0]-i.xmax),l=Math.max(0,i.ymin-o.eye[1],o.eye[1]-i.ymax),c=Math.sqrt(a*a+l*l),d=Math.abs(o.relativeElevation)+Number.MIN_VALUE,p=Math.max(0,Math.log(n/d))**2;let f=n/Math.max(1,p);f=Math.max(f,Math.min(c,n));const m=Ie(t.direction),g=de(Xe.get(),t.direction,m===0?f:f/m);return ye(r,t.origin,g),!0}intersectElevationFromScreen(t,r,i=0,s=null){return this._intersectElevation(this._getPickRay(t,this._tmpRay),r,i,s)}_intersectElevation(t,r,i=0,s=null){if(C(t))return null;const n=v(r)?r.mode:"absolute-height",o=v(r)?yt(r.offset,0):0,a=n!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(t,a,xU)){const w=this._view.computeMapPointFromVec3d(xU);return w.z-=o,w}return null}const c=this._view.state.camera,d=Xe.get();c.projectToRenderScreen(t.origin,d);const p=new T1e(null,this._forEachLayer),f=this._view.slicePlane,m=v(f)?y0e(f):null,g=Of(this.viewingMode);g.options.store=qa.MIN,g.options.verticalOffset=l;const _=t.origin,x=ye(Xe.get(),_,t.direction);g.reset(_,x,c),g.point=d;const b=v(s)?"type"in s&&s.type==="graphics"?w=>w.metadata.layerUid!==s.uid:w=>w.metadata.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const w=T=>(C(b)||b(T))&&T.metadata&&T.metadata.isElevationSource;g.intersect(p.layers,d,this._tolerance,null,w),this._externalIntersectionHandlers.forAll(T=>{if(T.type===zs.I3S||T.type===zs.TERRAIN){const E=T.slicePlaneEnabled?m:null;T.intersect(g,E,g.rayBegin,g.rayEnd,d)}})}break;case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(w=>{if(w.isGround){const T=w.slicePlaneEnabled?m:null;w.intersect(g,T,g.rayBegin,g.rayEnd,d)}})}if(g.results.min.getIntersectionPoint(xU)){const w=this._view.computeMapPointFromVec3d(xU);return w.z=i,w}return null}computeIntersection(t,r,i){if(C(t))return;const s=this._view.state.camera,n=Xe.get();s.projectToRenderScreen(t.origin,n);const o=new T1e(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=t.origin,l=ye(Xe.get(),t.origin,t.direction);r.reset(a,l,s),r.intersect(o.layers,n,this._tolerance);const c=this._view.slicePlane,d=v(c)?y0e(c):null;r.intersect(o.sliceableLayers,n,this._tolerance,d);const p=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(g=>{if(r.options.isFiltered=!o.filterLayerUid(g.layerUid),g.isGround&&p||!r.options.isFiltered){const _=g.slicePlaneEnabled?d:null;g.intersect(r,_,a,l,n)}});const f=Xe.get(),m=this._view.basemapTerrain;if(i&&i.enableDraped&&v(m.spatialReference)&&r.results.ground.getIntersectionPoint(f)){const g=m.overlayManager.renderer,_=this._view.renderCoordsHelper.spatialReference,x=Xe.get();this._view.renderCoordsHelper.fromRenderCoords(f,x,m.spatialReference),x[2]=yt(this._view.elevationProvider.getElevation(f[0],f[1],f[2],_,"ground"),0),g.intersect(r,x,r.results.ground,b=>o.filterRenderGeometry(b))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(t){const r=t.results.hud;qv(this._tmpRegion,NK);const i=this._view.state.camera,s=[],n=this._tmpRegion,o=b=>{const w=new bAt(b);i.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),s.push(w),RM(n,w.screenPoint)};t.sortResults(r.all),v(r.min.dist)&&o(r.min);for(const b of r.all)r.min.target.object!==b.target.object&&r.max.target.object!==b.target.object&&o(b);if(v(r.max.dist)&&r.max.target.object!==r.min.target.object&&o(r.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,n[0]-G$),d=Math.max(0,n[1]-G$),p=Math.min(Ph(n)+2*G$,a-c),f=Math.min(pg(n)+2*G$,l-d),m=new Uint8Array(p*f*4);this._view._stage.renderView.readHUDVisibility(c,d,p,f,m);let g=!0;const _=C(t.results.max.dist);let x=0;for(const b of s)for(const w of vAt)if(m[4*(Math.min(b.screenPoint[0]+w[0],a)-n[0]+(Math.min(b.screenPoint[1]+w[1],l)-n[1])*p)]){g&&(t.results.min.copy(b.result),g=!1),_&&t.results.max.copy(b.result),t.options.store===qa.ALL&&t.results.all.splice(x++,0,b.result);break}}}const G$=1,vAt=(()=>{const e=[],t=G$;for(let r=-t;r<=t;r++)for(let i=-t;i<=t;i++)e.push([i+t,r+t]);return e})();class bAt{constructor(t){this.result=t,this.screenPoint=ul()}}let wU;function x1e(e){return wU&&wU.viewingMode===e||(wU=Of(e)),wU}class T1e{constructor(t,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,r(i=>{i.isPickable&&this.filterLayerUid(i.apiLayerUid)&&(i.isSliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(t){const{include:r,exclude:i}=this;return C(t)?r==null&&i==null:(r==null||r.has(t))&&(i==null||!i.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function S1e(e){return typeof e=="object"&&"intersect"in e}const xU=$(),TU=ul();class ezt{constructor(t,r){this.spatialReference=t,this._view=r}getElevation(t,r,i){return this._view.elevationProvider.getElevation(t,r,0,this.spatialReference,i)}async queryElevation(t,r,i,s,n){return this._view.elevationProvider.queryElevation(t,r,0,this.spatialReference,n,i,s)}}class wAt{constructor(t,r,i,s){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=t.registerTask(Ot.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,r,i,s=0){return new Promise((n,o)=>{const a={x:t,y:r,minDemResolution:s,result:{resolve:n,reject:o},signal:i};this._queries.push(a),jl(i,()=>{Ise(this._queries,a),o(oi())})})}get running(){return this._queries.length>0}runTask(){const t=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return void t.forEach(c=>c.result.reject());const i=t.map(c=>[c.x,c.y]),s=t.reduce((c,d)=>Math.min(c,d.minDemResolution),1/0),n=new CI({points:i,spatialReference:this.spatialReference}),o=t.length>1&&t.some(c=>!!c.signal)?new AbortController:null,a=v(o)?o.signal:t[0].signal;if(v(o)){let c=0;t.forEach(d=>jl(d.signal,()=>{c++,d.result.reject(oi()),c===t.length&&o.abort()}))}const l={...this._queryOptions,minDemResolution:s,signal:a};r.queryElevation(n,l).then(c=>{t.forEach((d,p)=>{v(d.signal)&&d.signal.aborted?d.result.reject(oi()):d.result.resolve(c.geometry.points[p][2])})}).catch(c=>{t.forEach(d=>d.result.reject(c))})}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask()}}}let H$=class extends $s.EventedMixin(be){constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}get spatialReference(){var e,t;return(t=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:t.spatialReference}destroy(){this._elevationQueryCached=Qe(this._elevationQueryCached)}get _elevationQuery(){return C(this._elevationQueryCached)&&(this._elevationQueryCached=new wAt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,r,i,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&r===o.z&&ml(i,o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=SU(n,this._im,e,t,r,i,s),C(n)&&(n=SU(n,this._ground,e,t,r,i,s)),s==="scene"&&(n=SU(n,this._scene,e,t,r,i,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:r,spatialReference:i,queryContext:s,result:n}),n}queryElevation(e,t,r,i,s,n=null,o=0){const a=_x();return this._elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=SU(l,this._scene,e,t,r,i,s)),a.resolve(l)}).catch(l=>{Ps(l)?a.reject(l):a.resolve(this.getElevation(e,t,r,i,s))}),a.promise}register(e,t){this._handles.set(t,t.on("elevation-change",r=>this.emit("elevation-change",r))),this._providersFromContext(e).push(t)}unregister(e){this._handles.has(e)&&(this._handles.get(e).remove(),this._handles.delete(e));for(const t of[this._im,this._ground,this._scene]){const r=t.indexOf(e);r>-1&&t.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function SU(e,t,r,i,s,n,o){for(const a of t){const l=a.getElevation(r,i,s,n,o);v(l)&&(e=v(e)?Math.max(l,e):l)}return e}u([h({constructOnly:!0})],H$.prototype,"view",void 0),u([h()],H$.prototype,"spatialReference",null),H$=u([I("esri.views.3d.support.CombinedElevationProvider")],H$);class Ww{static isValidProfile(t){return t in Ww.profiles}static getDefaultProfile(){return pe("trident")||pe("esri-iPhone")?"low":"medium"}static apply(t,r){const i=Ww.profiles[t];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;{const s=r.sceneService.object,n=i.sceneService.object;s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration}r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.weatherFadeDuration=i.weatherFadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumRenderResolution=i.maximumRenderResolution,r.maximumPixelRatio=i.maximumPixelRatio}}function E1e(){const e=!!pe("esri-mobile"),t=!!pe("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},weatherFadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:void 0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!pe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},weatherFadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:void 0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!pe("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},weatherFadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?void 0:4096,maximumPixelRatio:e?1:void 0}}}Ww.debug={reset(){const e=E1e();for(const t in e)Ww.profiles[t]=e[t]}},function(e){e.profiles=E1e()}(Ww||(Ww={}));const KB=Ww;function ZV(){return new Float32Array(4)}function xAt(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Rf(e,t,r,i){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s}function TAt(e,t){return new Float32Array(e,t,4)}function o5e(){return ZV()}function a5e(){return Rf(1,1,1,1)}function l5e(){return Rf(1,0,0,0)}function c5e(){return Rf(0,1,0,0)}function u5e(){return Rf(0,0,1,0)}function d5e(){return Rf(0,0,0,1)}const SAt=o5e(),EAt=a5e(),CAt=l5e(),AAt=c5e(),OAt=u5e(),MAt=d5e();Object.freeze(Object.defineProperty({__proto__:null,create:ZV,clone:xAt,fromValues:Rf,createView:TAt,zeros:o5e,ones:a5e,unitX:l5e,unitY:c5e,unitZ:u5e,unitW:d5e,ZEROS:SAt,ONES:EAt,UNIT_X:CAt,UNIT_Y:AAt,UNIT_Z:OAt,UNIT_W:MAt},Symbol.toStringTag,{value:"Module"}));let vy=class extends be{constructor(){super(...arguments),this.color=new Ze([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new Ze([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=Ze.toUnitRGBA(e.color),r=v(e.haloColor)?Ze.toUnitRGBA(e.haloColor):t,i=Ze.toUnitRGBA(e.shadowColor);return{color:Rf(t[0],t[1],t[2],t[3]),haloColor:Rf(r[0],r[1],r[2],r[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:ar(i[0],i[1],i[2],i[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};u([h({type:Ze})],vy.prototype,"color",void 0),u([h({type:Ze})],vy.prototype,"haloColor",void 0),u([h()],vy.prototype,"haloOpacity",void 0),u([h()],vy.prototype,"fillOpacity",void 0),u([h()],vy.prototype,"shadowOpacity",void 0),u([h({type:Ze})],vy.prototype,"shadowColor",void 0),u([h()],vy.prototype,"shadowDifference",void 0),vy=u([I("esri.views.3d.support.HighlightOptions")],vy);const Fre=vy;let zS=class extends fe{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(i=>i.toJSON()),t=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:AI(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};u([h()],zS.prototype,"geometries",void 0),u([h({json:{read:{source:"outSR"}}})],zS.prototype,"outSpatialReference",void 0),u([h()],zS.prototype,"transformation",void 0),u([h()],zS.prototype,"transformForward",void 0),zS=u([I("esri.rest.support.ProjectParameters")],zS);const bG=zS,RAt=ts(bG);async function Hce(e,t,r){t=RAt(t);const i=eT(e),s={...i.query,f:"json",...t.toJSON()},n=t.outSpatialReference,o=AI(t.geometries[0]),a=Ox(s,r);return lr(i.path+"/project",a).then(({data:{geometries:l}})=>P3e(l,o,n))}async function qce(e=null,t){var s,n;if(Gr.geometryServiceUrl)return Gr.geometryServiceUrl;if(!e)throw new z("internal:geometry-service-url-not-configured");let r;r="portal"in e?e.portal||oo.getDefault():e,await r.load({signal:t});const i=(n=(s=r.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!i)throw new z("internal:geometry-service-url-not-configured");return i}async function IAt(e,t,r=null,i){const s=await qce(r,i),n=new bG;n.geometries=[e],n.outSpatialReference=t;const o=await Hce(s,n,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new z("internal:geometry-service-projection-failed")}const PAt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:qce,projectGeometry:IAt},Symbol.toStringTag,{value:"Module"}));class $At{constructor(t,r){this.spatialReference=r,this.unitInMeters=Fc(this.spatialReference,Kr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=qce(t&&t.get("portalItem")).catch(()=>{throw new z("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const r=await this._geometryServiceURLPromise;let i,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?i=t:(i=[t],s=!1);const n=i.map(l=>l instanceof lt?l:new lt(l,this.spatialReference)),o=new bG({geometries:n,outSpatialReference:Ve.WGS84}),a=(await Hce(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0);return s?a:a[0]}}let wm=class extends be{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};u([h()],wm.prototype,"minTotalNumberOfFeatures",void 0),u([h()],wm.prototype,"maxTotalNumberOfFeatures",void 0),u([h()],wm.prototype,"maxTotalNumberOfPrimitives",void 0),u([h()],wm.prototype,"snapshotAvailable",void 0),u([h()],wm.prototype,"polygonLodFactor",void 0),u([h()],wm.prototype,"polylineLodFactor",void 0),u([h()],wm.prototype,"skipHighSymbolLods",void 0),wm=u([I("esri.views.3d.support.QualitySettings.Graphics3DSettings")],wm);let p0=class extends be{constructor(){super(...arguments),this.lodFactor=1}};u([h()],p0.prototype,"lodFactor",void 0),p0=u([I("esri.views.3d.support.QualitySettings.LoDFactorSettings")],p0);let JV=class extends p0{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};JV=u([I("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],JV);let ev=class extends be{constructor(){super(...arguments),this.object=new JV,this.point=new p0,this.integratedMesh=new p0,this.pointCloud=new p0,this.uncompressedTextureDownsamplingEnabled=!1}};u([h({type:JV})],ev.prototype,"object",void 0),u([h({type:p0})],ev.prototype,"point",void 0),u([h({type:p0})],ev.prototype,"integratedMesh",void 0),u([h({type:p0})],ev.prototype,"pointCloud",void 0),u([h()],ev.prototype,"uncompressedTextureDownsamplingEnabled",void 0),ev=u([I("esri.views.3d.support.QualitySettings.SceneServiceSettings")],ev);let dw=class extends be{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};u([h()],dw.prototype,"lodBias",void 0),u([h()],dw.prototype,"angledSplitBias",void 0),u([h()],dw.prototype,"reduceTileLevelDifferences",void 0),u([h()],dw.prototype,"textureFadeDuration",void 0),dw=u([I("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],dw);let lM=class extends be{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([h()],lM.prototype,"pixelRatio",void 0),u([h()],lM.prototype,"maxTotalNumberOfFeatures",void 0),lM=u([I("esri.views.3d.support.QualitySettings.HeatmapSettings")],lM);let _c=class extends be{constructor(){super(...arguments),this.graphics3D=new wm,this.sceneService=new ev,this.tiledSurface=new dw,this.heatmap=new lM,this.weatherFadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.memoryLimit=void 0,this.additionalCacheMemory=void 0,this.frameRate=void 0,this.maximumRenderResolution=void 0,this.maximumPixelRatio=void 0}};u([h({type:wm})],_c.prototype,"graphics3D",void 0),u([h({type:ev})],_c.prototype,"sceneService",void 0),u([h({type:dw})],_c.prototype,"tiledSurface",void 0),u([h({type:lM})],_c.prototype,"heatmap",void 0),u([h()],_c.prototype,"weatherFadeDuration",void 0),u([h()],_c.prototype,"antialiasingEnabled",void 0),u([h()],_c.prototype,"physicallyBasedRenderingEnabled",void 0),u([h()],_c.prototype,"highQualityTransparency",void 0),u([h()],_c.prototype,"memoryLimit",void 0),u([h()],_c.prototype,"additionalCacheMemory",void 0),u([h()],_c.prototype,"frameRate",void 0),u([h()],_c.prototype,"maximumRenderResolution",void 0),u([h()],_c.prototype,"maximumPixelRatio",void 0),_c=u([I("esri.views.3d.support.QualitySettings.QualitySettings")],_c);const C1e=_c;function DAt(e){return Lse(e)&&e.length>=3}function LAt(e){return(Nse(e)||Array.isArray(e))&&e.length>=3}function NAt(e){return DAt(e)||LAt(e)}class KV{constructor(t,r,i,s){this.viewingMode=t,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=s,this._tmpCoordinateSystem=Xot(s)}set extent(t){t&&Yot(this._coordinateSystem,t,this._coordinateSystem)}getAltitude(t){return iat(this._coordinateSystem,t)}setAltitude(t,r,i=t){return f3e(this._coordinateSystem,i,r,t)}setAltitudeOfTransformation(t,r){sat(this._coordinateSystem,r,t,r)}worldUpAtPosition(t,r){return Qot(this._coordinateSystem,t,r)}worldBasisAtPosition(t,r,i){return eat(this._coordinateSystem,t,r,i)}basisMatrixAtPosition(t,r){const i=this.worldBasisAtPosition(t,Ed.X,Xe.get()),s=this.worldBasisAtPosition(t,Ed.Y,Xe.get()),n=this.worldBasisAtPosition(t,Ed.Z,Xe.get());return N0(r,i[0],i[1],i[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),r}headingAtPosition(t,r){const i=this.worldUpAtPosition(t,Xe.get()),s=this.worldBasisAtPosition(t,Ed.Y,Xe.get()),n=RPe(r,s,i);return Lc(n)}intersectManifoldClosestSilhouette(t,r,i){return qq(this._coordinateSystem,r,this._tmpCoordinateSystem),rat(this._tmpCoordinateSystem,t,i),i}intersectManifold(t,r,i){qq(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=Xe.get();return tat(this._tmpCoordinateSystem,t,s)?le(i,s):null}intersectInfiniteManifold(t,r,i){if(this.viewingMode===Ye.Global)return this.intersectManifold(t,r,i);qq(this._coordinateSystem,r,this._tmpCoordinateSystem);const s=this._tmpCoordinateSystem.value,n=Xe.get();return dC(s.plane,t,n)?le(i,n):null}toRenderCoords(t,r,i){return OV(t)?fa(t,r,this.spatialReference):So(t,r,i,this.spatialReference)}fromRenderCoords(t,r,i=null){return OV(r)?(v(i)&&(r.spatialReference=i),PIe(t,this.spatialReference,r)):NAt(r)?So(t,this.spatialReference,r,i)?r:null:Cx(t,this.spatialReference,r)}static create(t,r){switch(t){case Ye.Local:return new KV(Ye.Local,r,Fc(r),Kot());case Ye.Global:return new KV(Ye.Global,r,1,Jot(r))}}static renderUnitScaleFactor(t,r){return A1e(t)/A1e(r)}}function A1e(e){if(MV(e,Ye.Global))return 1;const t=m3e(!1,e);return Fc(t)}var Wy;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(Wy||(Wy={}));const FAt=(()=>{const e=new Array;return e[Wy.ELEVATION]=10,e[Wy.BASEMAP]=10,e[Wy.I3S_INDEX]=10,e[Wy.I3S_DATA]=10,e[Wy.SYMBOLOGY]=5,e})(),kAt=30;function h5e(e){return typeof e.getUsedMemory=="function"}function UAt(e){return new ru({view:e})}const EU=1,iY=1,BAt=.75,zAt=.6,O1e=1.3;let ru=class extends be{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Doe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(EU),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new tKe(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<zAt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(EU);else if(e)(this._memoryPredicted>1.1*iY||this._memoryUsed>iY)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/O1e),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>iY)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/O1e),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<BAt&&this._quality<EU){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),EU))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const r=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;v(r)&&(e+=r.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(h5e(o)){const a=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*a,t+=o.getUnloadedMemory()*a}});const i=C(this._warnMemoryUsage)||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&i){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);te.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${a}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};u([h({constructOnly:!0})],ru.prototype,"view",void 0),u([h()],ru.prototype,"maxMemory",null),u([h()],ru.prototype,"additionalCacheMemory",null),u([h()],ru.prototype,"memoryFactor",null),u([h()],ru.prototype,"updating",null),u([h()],ru.prototype,"usedMemory",null),u([h()],ru.prototype,"_quality",void 0),u([h()],ru.prototype,"_memoryUsed",void 0),u([h()],ru.prototype,"_updating",void 0),u([h()],ru.prototype,"_stableQuality",void 0),u([h()],ru.prototype,"_maxMemory",void 0),u([h()],ru.prototype,"_additionalCacheMemory",void 0),ru=u([I("esri.views.3d.support.MemoryControllerImpl")],ru);class VAt{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class jAt{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new GAt}}class GAt{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class HAt{constructor(t,r,i,s){this._workerFunc=t,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=s.map(n=>new jAt(n))}destroy(){this._clients.length=0}hasQuota(t){const r=this._clients[t];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(t){const r=this._clients[t.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(i,s)=>this._taskCallback(i,s))):r.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}_taskFinished(t){const r=this._clients[t.client];this._totalNumWorkers--,r.numWorkers--,r.statistics.requests++,r.statistics.size+=t.size||0,r.statistics.duration+=t.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,Et(r.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,r){t._cancelled||(this._callbackFunc(t,r),this._taskFinished(t))}getStatsForType(t){const r=this._clients[t];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const t=this;return{set workerFunc(r){t._workerFunc=r}}}}let QB=class extends be{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,r){this._loadQueue=new HAt((i,s)=>this._startLoading(i,s),(i,s)=>this._doneLoadingCB(i,s),e,t),r&&(this._frameTask=r.registerTask(Ot.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Gs(this._frameTask),this._tasks.forEach(e=>lg(e.abortController)),this._loadQueue=Qe(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,r,i={}){const s=_x();s.__signal=v(i)?i.signal:null;const n=this._createOrUpdateTask(e,t,r,i,s);return jl(i,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,r,i,s,n){const o=new XAt(e,t,r,i,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){var r;Rse(e.resolvers,t),t.reject(oi()),e.resolvers.length===0&&(e.status===Up.DOWNLOADING&&(e.status=Up.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=Up.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,r,i,s){const n=YAt(v(i)&&i.uid||e,t,r),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,i,t,r,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(Et(e.status===Up.DOWNLOADING),e.status=Up.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();Ir(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==Up.DOWNLOADED&&(t.err=t.err||oi()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!Ps(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const i of e.resolvers)if(t)Ps(t)?i.reject(t):i.reject(new z("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--r;const s=r<=0?e.result:ne(e.result);i.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===Up.CANCELLED)return!1;let r,i;switch(e.startTime=performance.now(),e.status=Up.DOWNLOADING,e.docType){case"binary":i="array-buffer",r=0;break;case"image":i="image";break;case"image+type":i="array-buffer";break;default:i="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=lr(e.url,{...e.options,responseType:i,timeout:r,signal:s});let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===Up.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,d=WAt(c);if(i="image",e.size=c.byteLength,d==="unknown")return e.request=lr(e.url,{responseType:i,timeout:r,signal:s}),void e.request.then(m=>o(m.data),a);const p=new Blob([c],{type:d}),f=window.URL.createObjectURL(p);n=()=>window.URL.revokeObjectURL(f),e.request=lr(f,{responseType:i,timeout:r,signal:s}),e.request.then(m=>o(new wG(m.data,d,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};u([h({readOnly:!0})],QB.prototype,"updating",void 0),QB=u([I("esri.views.3d.support.StreamDataLoader")],QB);const qAt={numRetries:0};function WAt(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class wG{constructor(t,r,i){this.image=t,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}}class XAt extends VAt{constructor(t,r,i,s,n){super(s),this.url=t,this.options=r,this.docType=i,this.key=n,this.result=null,this.status=Up.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=qAt.numRetries}}function YAt(e,t,r){return`${e}:${t}:${r}`}var Up;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(Up||(Up={}));let e8=class extends be{constructor(){super(...arguments),this.updating=!1}};function ZAt(e){return new L_({view:e})}u([h({readOnly:!0})],e8.prototype,"updating",void 0),e8=u([I("esri.views.3d.support.ResourceControllerMain")],e8);let L_=class extends e8{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=SN,this._handles=new hr,this._frameTask=null}initialize(){this._scheduler=Tdt(),this._memoryController=UAt(this.view),this._streamDataLoader=new QB,this._streamDataLoader.setup(kAt,FAt,this._scheduler),this._handles.add([ie(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>this._scheduler.state=e,bi),ie(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=cR({update:e=>this._frame(e)}),this._scheduleTask=this._scheduler.registerTask(Ot.RESOURCE_CONTROLLER)}destroy(){this._handles=Qe(this._handles),this._scheduleTask.remove(),this._frameTask=Gs(this._frameTask),this._streamDataLoader=Qe(this._streamDataLoader),this._memoryController=Qe(this._memoryController),this._scheduler=Qe(this._scheduler)}get updating(){var e,t,r;return!!(((e=this._memoryController)==null?void 0:e.updating)||((t=this._streamDataLoader)==null?void 0:t.updating)||((r=this._scheduleTask)==null?void 0:r.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(e,t,r){return this._scheduleTask.schedule(e,t,r)}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(r,i,s)=>t.request(r,i,e,s),get busy(){return!t.hasDownloadSlots(e)}}}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(zse(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};u([h({constructOnly:!0})],L_.prototype,"view",void 0),u([h()],L_.prototype,"_scheduler",void 0),u([h()],L_.prototype,"_memoryController",void 0),u([h()],L_.prototype,"_streamDataLoader",void 0),u([h()],L_.prototype,"_scheduleTask",void 0),u([h({readOnly:!0})],L_.prototype,"updating",null),L_=u([I("esri.views.3d.support.ResourceControllerImpl")],L_);function JAt(e){return"performanceInfo"in e}const cA=$(),KAt=$(),a_=$(),l_=$();function QAt(e,t,r=0){const i=e.extent;if(C(i))return!1;if(r===0)return SOe(i,t);const s=Math.min(i[2]-i[0],i[3]-i[1]);return wZe(i,t,r*s)}function CU(e,t,r,i){le(cA,r),cA[i]=t[i];const s=ge(cA,cA,t),n=ge(KAt,e,t),o=Te(n,s),a=Te(s,s);let l;l=o<=0?t:a<=o?r:ye(cA,t,de(s,s,o/a));const c=ge(cA,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function eOt(e,t,r){const i=e.extent;if(C(i))return 0;a_[0]=i[0],a_[1]=i[1],a_[2]=r,l_[0]=i[2],l_[1]=i[3],l_[2]=r;let s=1/0,n=1/0;return t[0]<a_[0]?s=CU(t,a_,l_,0):t[0]>l_[0]&&(s=CU(t,l_,a_,0)),t[1]<a_[1]?n=CU(t,a_,l_,1):t[1]>l_[1]&&(n=CU(t,l_,a_,1)),Math.min(s,n)}function tOt(e,t,r){if(C(e))return sle();if(e.spatialReference.isGeographic&&!wE(e.spatialReference))return new z("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=Ms.checkUnsupported(e);if(v(i))return i;if(C(r))return new z("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=rOt(e,r);if(s)return s;const n=e.spatialReference;return v(t)&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function rOt(e,t){const r=e.lods,i=r[0].resolution*2**r[0].level,s=[i*e.size[0],i*e.size[1]],n=[e.origin.x,e.origin.y],o=xOe(t),a=tr();Ms.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>ZO){const c=r[0].scale*2**r[0].level;let d=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/i;const p=Math.floor(Math.log(d)/Math.log(10));return d=Math.ceil(d/10**p)*10**p,new z("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+d.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:d,requiredNumRootTiles:l,allowedNumRootTiles:ZO})}return null}const iOt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:QAt,tiltToExtentEdge:eOt,checkIfTileInfoSupportedForViewSR:tOt},Symbol.toStringTag,{value:"Module"}));function sOt(){return!0}function nOt(){return 0}function oOt(e,t){if(C(e))return sle();const r=e.lods.length-1,i=e.spatialReference,s=wE(i)||I0(i)||P0(i);if(i.isWebMercator){if(!Ms.makeWebMercatorAuxiliarySphere(r).compatibleWith(e))return new z("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new z("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Ms.makeGCSWithTileSize(e.spatialReference,e.size[0],r).compatibleWith(e))return e.spatialReference.isWGS84?new z("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new z("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return v(t)&&!e.spatialReference.equals(t)?new z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const aOt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:sOt,tiltToExtentEdge:nOt,checkIfTileInfoSupportedForViewSR:oOt},Symbol.toStringTag,{value:"Module"})),lOt={[Ye.Global]:aOt,[Ye.Local]:iOt};function ky(e,t){e||console.warn("Terrain: "+t)}let ha=!1,QV=!1;function cOt(e){QV=e,ha=ha||e}function uOt(e){ha=e}function Ne(e,t){if(ha&&!e){const r=new Error().stack.slice(5);throw console.warn("Terrain internal: "+(t||"")+" at "+r),new Error("Assertion failed"+(t?": "+t:""))}}function kre(e){return xG(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function e9(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function xG(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function Wce(e){return(e==null?void 0:e.type)==="tile-3d"}function hF(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function p5e(e){return(e==null?void 0:e.type)==="wmts-3d"}function Ure(e){return(e==null?void 0:e.type)==="elevation-3d"}function o3(e){return(e==null?void 0:e.type)==="group"}function pI(e){return(e==null?void 0:e.type)==="group"}function t9(e){return e&&(Wce(e)||p5e(e)||xG(e)||hF(e))}function Bre(e){return e&&(Wce(e)||xG(e)||hF(e)||p5e(e))}function pF(e){return Bre(e)||Ure(e)}function dOt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return v(t)&&"type"in t&&t.type==="raster-tile"}function hOt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return v(t)&&"type"in t&&t.type==="vector-tile"}function pOt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return v(t)&&"type"in t&&t.type==="tile-texture"}function fOt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return t instanceof HTMLImageElement||t instanceof wG||t instanceof HTMLCanvasElement||t instanceof ImageData}function XM(e){return v(e)&&"release"in e&&e.release(),null}function M1e(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function Xce(e,t,r,i){return lOt[i].checkIfTileInfoSupportedForViewSR(e,r,t)}function TG(e,t,r){let i=null,s=null;if((e==null?void 0:e.type)==="wmts"){const n=mOt(e,t,r);i=n.tileInfo,s=n.fullExtent}else{s=e9(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=r===Ye.Local;if(e9(e))i=e.getCompatibleTileInfo(t,s,n);else if((e==null?void 0:e.type)==="vector-tile"){const o=n&&!gOt(t)||yOt.force512VTL,a=e.tileInfo.spatialReference.isGeographic;i=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=e.tileInfo}return v(i)&&v(s)&&Xce(i,s,t,r)==null?{tileInfo:i,fullExtent:s}:null}function mOt(e,t,r){const i=GXe(e);if(v(i)){if(!Ge.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const s=i.find(n=>Xce(n.tileInfo,n.fullExtent,t,r)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function gOt(e){return e.isWGS84||e.isWebMercator||kCe(e)||!eN(e)}const yOt={force512VTL:!1};function R1e(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function c_(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function _Ot(e,t,r=wOt){return Math.abs(e-t)<r}function zre(e){return e===Mt.NORTH_EAST?Mt.SOUTH_WEST:e===Mt.NORTH_WEST?Mt.SOUTH_EAST:e===Mt.SOUTH_WEST?Mt.NORTH_EAST:Mt.NORTH_WEST}function r9(e){return e===Mt.NORTH?Mt.SOUTH:e===Mt.EAST?Mt.WEST:e===Mt.SOUTH?Mt.NORTH:Mt.EAST}function vOt(e){return e===Mt.NORTH_WEST||e===Mt.SOUTH_WEST}function bOt(e){return e===Mt.NORTH_WEST||e===Mt.NORTH_EAST}function I1e(e){return e===Mt.NORTH_WEST||e===Mt.WEST||e===Mt.SOUTH_WEST}function P1e(e){return e===Mt.NORTH_EAST||e===Mt.EAST||e===Mt.SOUTH_EAST}function $1e(e){return e===Mt.SOUTH_EAST||e===Mt.SOUTH||e===Mt.SOUTH_WEST}function D1e(e){return e===Mt.NORTH_EAST||e===Mt.NORTH||e===Mt.NORTH_WEST}const Ky=[Mt.NORTH,Mt.EAST,Mt.SOUTH,Mt.WEST],i9=[Mt.NORTH_EAST,Mt.SOUTH_EAST,Mt.SOUTH_WEST,Mt.NORTH_WEST],wOt=1e-5;class xOt{constructor(t,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=pF(t)?r.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),JAt(t)){const i=t.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}}class TOt{constructor(t){if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,v(t.resourceController)){const i=t.resourceController.memoryController;this.totalMemory=i.maxMemory*kR.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=t.resourceController.scheduler.load}this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;const r=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=v(r)?r.usedMemory:0,t.allLayerViews.items.forEach(i=>{(h5e(i)||pF(i))&&this.layerPerformanceInfos.push(new xOt(i,t))}),this.layerPerformanceInfos.sort((i,s)=>s.memory-i.memory)}}class SOt{constructor(t){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=t("gltf-resources",()=>{}),this._wosrMemCache=t("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(t=>t.abortController.abort()),this._wosrLoading.forEach(t=>t.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(t,r,i){const s=i?`gltfPBR:${t}`:`gltf:${t}`,n=this._gltfMemCache.get(s);return v(n)?Promise.resolve(n):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,o=>B4e(new k4e(o.streamDataRequester),t,o,i),r)}loadWOSR(t,r){const i=`wosr:${t}:${r.disableTextures}`,s=this._wosrMemCache.get(i);return v(s)?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,n=>z4e(t,n),r)}async _loadOnce(t,r,i,s,n){Ir(n);const o=jl(n,()=>this._abortLoad(t,i));let a=t.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:s({...n,signal:l.signal})},t.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),t.delete(i),Ir(n),l}finally{Gs(o)}}_abortLoad(t,r){const i=t.get(r);v(i)&&--i.refCount>0||(t.delete(r),v(i)&&i.abortController.abort())}}class EOt extends JO{constructor(t,r,i,s){super(r,s),this._streamDataRequester=t,this._parameters=i}async fromUrl(t,r,i){Ir(i);const s=v(i)&&i.signal,n=this.makeUid(t,r);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a},this._textureRequests.set(n,o),o.textureAsync=l.then(async c=>{const d=this._createTexture(t,c,r);return o.texture=d,o.abortController=null,this._stage.add(d),await this._stage.load(d),{uid:n,texture:d,release:()=>this._release(n)}},c=>{throw o.abortController=null,c})}return o.referenceCount++,new Promise((a,l)=>{jl(s,()=>{l(oi())}),o.textureAsync.then(a,l)}).catch(a=>{throw this._release(n),a})}_createTexture(t,r,i){const s={...this._parameters,powerOfTwoResizeMode:cx.PAD};if(une(t)){if(i||r.width===0&&r.height===0){const n=r.width?r.height/r.width:1;i=i||64,n>1?(r.width=Math.round(i/n),r.height=i):(r.width=i,r.height=Math.round(i*n))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(s.preMultiplyAlpha=!1)}return s.width=r.width,s.height=r.height,new ka(r,s)}}class COt{constructor(t){this.textures=null,this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=t.viewState,this._view=t.view,this._pointsOfInterest=t.pointsOfInterest,this.streamDataRequester=t.resourceController.createStreamDataRequester(Wy.SYMBOLOGY),this.objectResourceCache=new SOt((i,s)=>t.resourceController.memoryController.newCache(i,s)),this.textures=new EOt(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:It.CLAMP_TO_EDGE,t:It.CLAMP_TO_EDGE}},t.resourceController.scheduler);const r=Kr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=tNe(t.viewingMode,r),this.screenSizePerspectiveSettingsLabels=V_t(t.viewingMode,r)}destroy(){Qe(this.textures),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return cg();this._graphicsOwners.push(t);const r=ie(()=>{var i;return(i=t.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),cg(()=>{r.remove(),Rse(this._graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(t&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new hr;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([ie(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,bi),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else!t&&this._screenSizePerspectiveHandles&&(this._screenSizePerspectiveHandles.destroy(),this._screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const t=this._pointsOfInterest;AU.distance=t.centerOnSurfaceInfrequent.distance,AU.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(AU),this.screenSizePerspectiveSettingsLabels.update(AU),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}const AU={distance:0,fovY:0};class Gb{constructor(t,r,i=""){this.graphics=t,this._symbol=new Lw({symbolLayers:[new Dw({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new sC({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(t,r){if(C(r))return;this.hide();const i=new lt({x:t[0],y:t[1],z:t[2],spatialReference:r});this._graphic=new _i({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){v(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let xw=class extends be{constructor(e){super(e),this.handles=new hr}destroy(){this.handles.destroy()}};u([h({constructOnly:!0})],xw.prototype,"renderCoordsHelper",void 0),u([h({constructOnly:!0})],xw.prototype,"surface",void 0),u([h({constructOnly:!0})],xw.prototype,"state",void 0),xw=u([I("esri.views.3d.support.PointOfInterest")],xw);const AOt=Array;let hh=class extends xw{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Jv({location:lt,renderLocation:AOt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=$(),this._tmpPoint=new lt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(ms(()=>{var t,r;return(r=(t=this.map)==null?void 0:t.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=Ni(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return NE(r,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const t=this._tmpPoint.z>OOt&&this.renderCoordsHelper.viewingMode===Ye.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:t?MOt:0}).then(i=>this._updateSurfaceAltitude(i.geometry.z)).catch(i=>{Ps(i)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(sY,this._estimatedSurfaceAltitude,this._camera.eye),_u(this._get("renderLocation"),sY)||(this._set("renderLocation",le(this._propertiesPool.get("renderLocation"),sY)),this.notifyChange("renderLocation"))}};u([h({constructOnly:!0})],hh.prototype,"scheduler",void 0),u([h({constructOnly:!0})],hh.prototype,"cache",void 0),u([h({constructOnly:!0})],hh.prototype,"task",void 0),u([h({constructOnly:!0})],hh.prototype,"cameraName",void 0),u([h({readOnly:!0})],hh.prototype,"location",null),u([h({constructOnly:!0})],hh.prototype,"map",void 0),u([h({readOnly:!0})],hh.prototype,"renderLocation",void 0),u([h({readOnly:!0})],hh.prototype,"scale",null),u([h({readOnly:!0})],hh.prototype,"updating",null),hh=u([I("esri.views.3d.support.CameraOnSurface")],hh);const sY=$(),OOt=1e5,MOt=1e6,ROt=Array;let ld=class extends xw{constructor(e){super(e),this._propertiesPool=new Jv({location:lt,renderLocation:ROt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=$(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Gs(this._frameWorker),this._propertiesPool=Qe(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=POt;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&r&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const i=$Ot;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,i)&&(le(e,i),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=Ni(this._camera.eye,e):(de(e,this._camera.viewForward,this._get("distance")),ye(e,e,this._camera.eye)),_u(this._get("renderLocation"),e)||this._set("renderLocation",le(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const r=this._camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,t))return!1;if(this.state.isGlobal){const i=Kr(this.renderCoordsHelper.spatialReference).radius,s=i+e,n=Rc(r.eye),o=n<s*s,a=Ni(r.eye,t);if(o&&a>i/4){const l=s-Math.sqrt(n);return de(t,r.viewForward,l),ye(t,t,r.eye),!0}}else{const i=this.surface.ready?this.surface.extent:null;v(i)&&Bj(i,this.surface.spatialReference,a3,this.renderCoordsHelper.spatialReference)&&(t[0]=_e(t[0],a3[0],a3[2]),t[1]=_e(t[1],a3[1],a3[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(hi.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,i=Ni(r,e),s=Ni(r,t);if(Math.abs(s-i)/i>IOt)return!0}return!1}};u([h({constructOnly:!0})],ld.prototype,"scheduler",void 0),u([h({constructOnly:!0})],ld.prototype,"task",void 0),u([h({constructOnly:!0})],ld.prototype,"cameraName",void 0),u([h()],ld.prototype,"distance",void 0),u([h({constructOnly:!0})],ld.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([h({readOnly:!0})],ld.prototype,"location",null),u([h({readOnly:!0})],ld.prototype,"renderLocation",void 0),u([h()],ld.prototype,"updating",void 0),ld=u([I("esri.views.3d.support.CenterOnSurface")],ld);const IOt=.05,POt=$(),$Ot=$(),a3=tr();class DOt{constructor(t){this._handles=new hr,this.events=new $s,this._contentLayerViews=t.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}_layerViewsChanged(t){t.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),t.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",LOt)}}const LOt={},NOt=Array;let by=class extends xw{constructor(e){super(e),this._propertiesPool=new Jv({location:lt,renderLocation:NOt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ie(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ie(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(Ot.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,i=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(t,L1e);const s=Math.max(0,(Math.acos(Te(L1e,i.viewForward))-.5*Math.PI)*(i.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!wx(e,t)){const l=this._propertiesPool.get("renderLocation");le(l,t),this._set("renderLocation",l)}return}const n=1-_e(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(N1e);const a=this._propertiesPool.get("renderLocation");$n(a,t,N1e,o),e&&wx(e,a)||this._set("renderLocation",a)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,r=t.getRenderCenter(ul());if(r[1]=t.aboveGround?t.padding[Vt.BOTTOM]:t.fullHeight-t.padding[Vt.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const i=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(r,l3)){ge(l3,l3,t.eye);const s=xe(l3,l3);if(this.renderCoordsHelper.intersectManifold(ep(t.eye,s),i,e))return e}return this.renderCoordsHelper.setAltitude(e,i,t.eye)}updateRenderLocation(){this._dirty=!0}};u([h()],by.prototype,"_dirty",void 0),u([h({constructOnly:!0})],by.prototype,"scheduler",void 0),u([h({constructOnly:!0})],by.prototype,"centerOnSurface",void 0),u([h({constructOnly:!0})],by.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([h({readOnly:!0})],by.prototype,"updating",null),u([h({readOnly:!0})],by.prototype,"location",null),u([h({readOnly:!0})],by.prototype,"renderLocation",void 0),by=u([I("esri.views.3d.support.pointsOfInterest.Focus")],by);const L1e=$(),l3=$(),N1e=$();let N_=class extends be{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new hr}get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=$();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([ie(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),ms(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||C(this.surfaceView.extent)||C(this.surfaceView.spatialReference))return void this._set("location",null);const e=goe(this.surfaceView.extent),t=new lt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{Ps(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",t)}};u([h({constructOnly:!0})],N_.prototype,"view",void 0),u([h({constructOnly:!0})],N_.prototype,"cache",void 0),u([h()],N_.prototype,"surface",null),u([h()],N_.prototype,"surfaceView",null),u([h({readOnly:!0})],N_.prototype,"location",void 0),u([h({readOnly:!0})],N_.prototype,"renderLocation",null),N_=u([I("esri.views.3d.terrain.StableSurfaceCenter")],N_);let F_=class extends be{constructor(e){super(e),this._handles=new hr,this._tileGeometryUpdateExtent=kd(),this._tileGeometryUpdateSpatialReference=null,this.events=new $s,this.updating=!1}initialize(){this._handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Ot.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this._handles=Qe(this._handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",FOt),kd(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,ox(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,t){const r=this.state.camera.eye,i=kOt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,kT,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,UT,t),kT[0]<UT[0]?(i[0]=kT[0],i[2]=UT[0]):(i[0]=UT[0],i[2]=kT[0]),kT[1]<UT[1]?(i[1]=kT[1],i[3]=UT[1]):(i[1]=UT[1],i[3]=kT[1]),HF(i,e)}};u([h({constructOnly:!0})],F_.prototype,"state",void 0),u([h({constructOnly:!0})],F_.prototype,"centerOnSurfaces",void 0),u([h({constructOnly:!0})],F_.prototype,"renderCoordsHelper",void 0),u([h({constructOnly:!0})],F_.prototype,"scheduler",void 0),u([h({constructOnly:!0})],F_.prototype,"surface",void 0),u([h({readOnly:!0})],F_.prototype,"updating",void 0),F_=u([I("esri.views.3d.support.SurfaceGeometryUpdates")],F_);const FOt={},kT=$(),UT=$(),kOt=kd();let El=class extends be{constructor(e){super(e),this._handles=new hr,this._tmpRay=ca(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Jv({renderPointOfView:UOt},this),this.renderPointOfView=$(),this._pois=new Array,this._debugCenters=new Map}initialize(){var c;const{state:e,basemapTerrain:t,renderCoordsHelper:r,map:i}=this.view;this._surfaceIntersector=Of(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=qa.MIN,this._contentIntersector=Of(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new ld({...a,task:Ot.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new ld({...a,task:Ot.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("contentCenterOnSurface",new ld({...a,task:Ot.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s,cameraName:"contentCamera"})),this._set("centerOnContent",new ld({...a,task:Ot.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new hh({...a,cache:o,task:Ot.POINT_OF_INTEREST_INFREQUENT,map:i})),this._set("contentCameraOnSurface",new hh({...a,cache:o,task:Ot.POINT_OF_INTEREST_INFREQUENT,map:i,cameraName:"contentCamera"})),this._set("surfaceGeometryUpdates",new F_({...a,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new DOt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new N_({cache:o,view:this.view})),this._set("focus",new by({state:e,scheduler:n,surface:t,renderCoordsHelper:r,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(d,p)=>this._estimateSurfaceIntersectionAtRenderPoint(d,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new Gb(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new Gb(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new Gb(l,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new Gb(l,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new Gb(l,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new Gb(l,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new Gb(l,"green","Focus")),this._handles.add([ie(()=>e.camera,d=>this._cameraChanged(d),bi),ie(()=>t.extent,()=>this._updateCenterPointsOfInterest()),no(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),bi),ms(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),ms(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),no(()=>hi.SHOW_POI,d=>this._setDebug(d),pt)]),this._cameraChanged(this.view.state.camera);for(const d of this._pois)d.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(t=>t.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return C(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,uA,zOt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(uA):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(C(e))return this._surfaceAltitudeAtCenter;const t=e.origin,r=ye(uA,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,r),this._surfaceIntersector.results.min.getIntersectionPoint(uA)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(uA)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,r){const i=Vle(t,e,BOt);if(C(i))return null;const s=i.origin,n=ye(uA,i.origin,i.direction);return this._surfaceIntersector.resetWithRay(i,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;_u(this.renderPointOfView,t)||this._set("renderPointOfView",le(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(ie(()=>t.renderLocation,r=>this._debugCenters.get(t).show(r,t.renderCoordsHelper.spatialReference),pt),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([h({readOnly:!0})],El.prototype,"centerOnContent",void 0),u([h({readOnly:!0})],El.prototype,"centerOnSurfaceFrequent",void 0),u([h({readOnly:!0})],El.prototype,"centerOnSurfaceInfrequent",void 0),u([h({readOnly:!0})],El.prototype,"contentCenterOnSurface",void 0),u([h({readOnly:!0})],El.prototype,"cameraOnSurface",void 0),u([h({readOnly:!0})],El.prototype,"contentCameraOnSurface",void 0),u([h({readOnly:!0})],El.prototype,"focus",void 0),u([h({readOnly:!0})],El.prototype,"renderPointOfView",void 0),u([h({readOnly:!0})],El.prototype,"surfaceOrigin",void 0),u([h({readOnly:!0})],El.prototype,"contentGeometryUpdates",void 0),u([h({readOnly:!0})],El.prototype,"surfaceGeometryUpdates",void 0),u([h({constructOnly:!0})],El.prototype,"view",void 0),u([h({readOnly:!0})],El.prototype,"updating",null),El=u([I("esri.views.3d.support.PointsOfInterest")],El);const UOt=Array,uA=$(),BOt=ca(),zOt={exclude:new Set([Um])};class VOt{constructor(t){this._store=t}destroy(){this._store.destroy()}get(t){return this._store.get(t)}put(t,r){this._store.put(t,r,r.values.byteLength+256)}}class f5e{constructor(t,r,i,s,n={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=IRe(t,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>te.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${t} worker: ${o}`))}on(t,r){const i={removed:!1,eventName:t,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),cg(()=>{i.removed=!0,Ise(this._listeners,i),this._thread&&v(i.threadHandle)&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,r){return this.invokeMethod(this._mainMethod,t,r)}invokeMethod(t,r,i){if(this._thread){const s=this._transferLists[t],n=s?s(r):[];return this._thread.invoke(t,r,{transferList:n,signal:i})}return this._promise?this._promise.then(()=>(Ir(i),this.invokeMethod(t,r,i))):Promise.reject(null)}broadcast(t,r){return this._thread?Promise.all(this._thread.broadcast(r,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,r)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(r=>{t.removed||(t.threadHandle=r)})}}class F1e extends f5e{constructor(t=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,r,i){return t&&t.byteLength!==0?this.invoke({buffer:t,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(mL.forEach((t,r)=>{t===this&&mL.delete(r)}),this.destroy())}}const mL=new Map;function jOt(e=null){let t=mL.get(e);return t||(v(e)?(t=new F1e(r=>e.schedule(r)),mL.set(e,t)):(t=new F1e,mL.set(null,t))),++t.ref,t}var k1e,fd,U1e,B1e,z1e;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(k1e||(k1e={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(fd||(fd={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(U1e||(U1e={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(B1e||(B1e={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(z1e||(z1e={}));class GOt{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class tzt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function rzt(e,t,r,i,s,n){const o=r-s;if(o>=0)return(t>>o)+(i-(n<<o))*(e>>o);const a=-o;return t-(n-(i<<a))*(e>>a)<<a}class izt{constructor(t,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(t/i),this._cellSize=i,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][s]||null}getCellSpan(t,r,i,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function HOt(e,t,r,i,s,n){const o=t[i++];for(let a=0;a<o;a++){const l=new GOt(n);l.xTile=t[i++],l.yTile=t[i++],l.hash=t[i++],l.priority=t[i++];const c=t[i++];for(let f=0;f<c;f++){const m=t[i++],g=t[i++],_=t[i++],x=t[i++],b=!!t[i++],w=t[i++],T=r[i++],E=r[i++],O=t[i++],A=t[i++];l.colliders.push({xTile:m,yTile:g,dxPixels:_,dyPixels:x,hard:b,partIndex:w,width:O,height:A,minLod:T,maxLod:E})}const d=e[i++];for(let f=0;f<d;f++)l.textVertexRanges.push([e[i++],e[i++]]);const p=e[i++];for(let f=0;f<p;f++)l.iconVertexRanges.push([e[i++],e[i++]]);s.push(l)}return i}function szt(e,t,r){for(const[i,s]of e.symbols)qOt(e,t,r,s,i)}function qOt(e,t,r,i,s){const n=e.layerData.get(s);if(n.type===fd.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],d=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*d)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,d]of o.iconVertexRanges)for(let p=c;p<c+d;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],d=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=r?Math.floor(127*d)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,d]of o.textVertexRanges)for(let p=c;p<c+d;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class SG{constructor(t,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=t,this.memoryUsed=t.byteLength;let i=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[i++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return C(this._data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){C(this._data)||(this.doPrepareForRendering(t,this._data,this.bufferDataOffset),this._data=null)}}class WOt extends SG{constructor(t,r){super(t,r),this.type=fd.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=i[s++],this.lineIndexCount=i[s++];const n=i[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=i[s++],c=i[s++],d=i[s++];o.set(l,[c,d])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){v(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),v(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),v(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.lineVertexBuffer=Ur.createVertex(t,ni.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.lineIndexBuffer=Ur.createIndex(t,ni.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new Ef(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class XOt extends SG{constructor(t,r){super(t,r),this.type=fd.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=i[s++],this.fillIndexCount=i[s++],this.outlineIndexStart=i[s++],this.outlineIndexCount=i[s++];const n=i[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=i[s++],c=i[s++],d=i[s++];o.set(l,[c,d])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){v(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),v(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),v(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,v(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),v(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),v(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.fillVertexBuffer=Ur.createVertex(t,ni.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.fillIndexBuffer=Ur.createIndex(t,ni.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=s[i++];this.outlineVertexBuffer=Ur.createVertex(t,ni.STATIC_DRAW,new Int32Array(n.buffer,4*i,l)),i+=l;const c=s[i++];this.outlineIndexBuffer=Ur.createIndex(t,ni.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c)),i+=c;const d=this.layer,p=d.fillMaterial,f=d.outlineMaterial;this.fillVertexArrayObject=new Ef(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new Ef(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class YOt extends SG{constructor(t,r,i){super(t,r),this.type=fd.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],g=s[a++],_=s[a++];this.iconPerPageElementsMap.set(m,[g,_])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],g=s[a++],_=s[a++];this.glyphPerPageElementsMap.set(m,[g,_])}const d=s[a++],p=s[a++];this.iconOpacity=new Int32Array(d),this.textOpacity=new Int32Array(p),a=HOt(s,n,o,a,this.symbols,i),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[r,i]of this.iconPerPageElementsMap)t+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)t+=i[1];return t/3}doDestroy(){v(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),v(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),v(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),v(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,v(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),v(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),v(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),v(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,r=this.iconOpacityBuffer;t.length>0&&t.byteLength===r.size&&r.setSubData(t,0,0,t.length);const i=this.textOpacity,s=this.textOpacityBuffer;i.length>0&&i.byteLength===s.size&&s.setSubData(i,0,0,i.length)}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.iconVertexBuffer=Ur.createVertex(t,ni.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.iconIndexBuffer=Ur.createIndex(t,ni.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=s[i++];this.textVertexBuffer=Ur.createVertex(t,ni.STATIC_DRAW,new Int32Array(n.buffer,4*i,l)),i+=l;const c=s[i++];this.textIndexBuffer=Ur.createIndex(t,ni.STATIC_DRAW,new Uint32Array(s.buffer,4*i,c)),i+=c,this.iconOpacityBuffer=Ur.createVertex(t,ni.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=Ur.createVertex(t,ni.STATIC_DRAW,this.textOpacity.buffer);const d=this.layer,p=d.iconMaterial,f=d.textMaterial;this.iconVertexArrayObject=new Ef(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new Ef(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class ZOt extends SG{constructor(t,r){super(t,r),this.type=fd.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=i[s++],this.circleIndexCount=i[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){v(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),v(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),v(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const s=new Uint32Array(r),n=new Int32Array(s.buffer),o=s[i++];this.circleVertexBuffer=Ur.createVertex(t,ni.STATIC_DRAW,new Int32Array(n.buffer,4*i,o)),i+=o;const a=s[i++];this.circleIndexBuffer=Ur.createIndex(t,ni.STATIC_DRAW,new Uint32Array(s.buffer,4*i,a)),i+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new Ef(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const nzt=!0,ozt=32,V1e=200,JOt=1/pe("mapview-transitions-duration");class KOt extends $s{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const r=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return C(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=_x(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=_x(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var t,r;(t=this._fadeInResolver)==null||t.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===i)this.computedVisible=this.visible;else{const n=t*JOt;this.computedOpacity=s>i?Math.max(i,s-n):Math.min(i,s+n),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class By{constructor(t,r,i,s){this.set(t,r,i,s)}static getId(t,r,i,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${r}/${i}/${s}`}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|t<<8|i}acquire(t,r,i,s){this.set(t,r,i,s)}contains(t){const r=t.level-this.level;return r>=0&&this.row===t.row>>r&&this.col===t.col>>r&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new By(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,r,i,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+r,this.col=+i,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new By(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new By(t,r,i,s),new By(t,r,i+1,s),new By(t,r+1,i,s),new By(t,r+1,i+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}By.pool=new ro(By,null,null,25,50);class QOt extends KOt{constructor(t,r,i,s,n,o,a=n,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new By(t),this.resolution=r,this.x=i,this.y=s,this.width=n,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t){const r=this.resolution/(t.resolution*t.pixelRatio),i=this.transforms.tileMat3,[s,n]=t.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;mae(i,o,0,0,0,a,0,s,n,1),NR(this.transforms.dvs,t.displayViewMat3,i)}}class gL extends QOt{constructor(t,r,i,s,n,o,a,l=null){super(t,r,i,s,n,o,4096,4096),this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<V1e}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<V1e)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let r=!1;for(const i of t)if(this.layerData.has(i)){const s=this.layerData.get(i);this._memoryUsedByLayerData-=s.memoryUsed,s.type===fd.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),s.destroy(),this.layerData.delete(i),this.layerCount--}v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(m5e.delete(this),gL._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let r=!1;if(t){const{bucketsWithData:i,emptyBuckets:s}=t,n=this._createRenderBuckets(i);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===fd.SYMBOL&&(this.symbols.set(o,a.symbols),r=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;v(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[i,s]of this.layerData)s.type===fd.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t){super.setTransform(t);const r=this.resolution/(t.resolution*t.pixelRatio),i=this.width/this.rangeX*r,s=this.height/this.rangeY*r,n=[0,0];t.toScreen(n,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;gae(o),Zz(o,o,n),yae(o,o,Math.PI*t.rotation/180),_ae(o,o,[i,s,1])}_createTransforms(){return{dvs:Au(),tileMat3:Au(),tileUnitsToPixels:Au()}}static _destroyRenderBuckets(t){if(!t)return;const r=new Set;t.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),t.clear()}_createRenderBuckets(t){const r=new Map,i=new Map;for(const s of t){const n=this._deserializeBucket(s,i);for(const o of n.layerUIDs)r.set(o,n)}return r}_deserializeBucket(t,r){let i=r.get(t);if(i)return i;switch(new Uint32Array(t)[0]){case fd.FILL:i=new XOt(t,this.styleRepository);break;case fd.LINE:i=new WOt(t,this.styleRepository);break;case fd.SYMBOL:i=new YOt(t,this.styleRepository,this);break;case fd.CIRCLE:i=new ZOt(t,this.styleRepository)}return r.set(t,i),i}_deleteLayerData(t){if(!this.layerData.has(t))return;const r=this.layerData.get(t);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(t),this.layerCount--}}const m5e=new Map;function eMt(){m5e.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(r=>console.log(r)),console.log("========"),e[1].forEach(r=>console.log(r))})}const azt={value:.5,readOnly:!0},tMt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class cM{constructor(t=0,r=0){this.min=t,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class rMt{constructor({values:t,width:r,height:i,noDataValue:s},n){this.pixelData=t,this.width=r,this.height=i,this.safeWidth=.99999999*(r-1),this.noDataValue=s,this.dx=(r-1)/(n[2]-n[0]),this.dy=(r-1)/(n[3]-n[1]),this.x0=n[0],this.y1=n[3]}}class iMt{constructor(t,r,i){this.type="elevation",this.level=t[0],this.i=t[1],this.j=t[2],this.extent=r;const s=i.noDataValue,n=i.values;let o=1/0,a=-1/0,l=!0,c=!1;for(let d=0;d<n.length;d++){const p=n[d];p!==s?(o=p<o?p:o,a=p>a?p:a,l=!1):c=!0}l&&(o=0,a=0),a=a>-3e38?a:0,this.samplerData=new rMt(i,r),this.bounds=[o,a],this.hasNoDataValues=c}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,r,i,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.width,d=this.samplerData.pixelData,p=.5*TN;let f=(c-1)/o,m=(i-this.j*o)*f,g=(r-this.i*o)*f;if(f<1){const _=Math.floor(m),x=Math.floor(g),b=_+x*c,w=d[b],T=d[b+1],E=d[b+c],O=d[b+c+1];if(w+T+E+O<p){const A=m-_,R=g-x,D=q5(w,T,E,O,A,R),k=q5(w,T,E,O,A+f,R),L=q5(w,T,E,O,A,R+f),q=q5(w,T,E,O,A+f,R+f);return s.min=Math.min(D,k,L,q),s.max=Math.max(D,k,L,q),s}m=_,g=x,f=1}else m=Math.floor(m),g=Math.floor(g),f=Math.ceil(f);for(let _=m;_<=m+f;_++)for(let x=g;x<=g+f;x++){const b=d[_+x*c];b<p?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}const sMt=.5*TN;function vs(e,t,r){if(C(r))return null;for(const i of r){if(!i)continue;const s=i.safeWidth;let n=_e(i.dy*(i.y1-t),0,s),o=_e(i.dx*(e-i.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=i.width,d=a*c+l,p=i.pixelData,f=p[d],m=p[d+1],g=d+c,_=p[g],x=p[g+1];if(f+_+m+x<sMt){n-=a,o-=l;const b=f+(m-f)*o;return b+(_+(x-_)*o-b)*n}}return null}let Fp=class extends be{constructor(e){super(e),this._handles=new hr}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const r=t.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const i=g5e(r.fullExtent,this.viewSpatialReference);v(i)&&e.push(xOe(i))}}),e}};function nMt(e,t){return e===Ye.Global?new Vre(t):new jre(t)}u([h({readOnly:!0})],Fp.prototype,"layerViewsExtent",null),u([h({readOnly:!0})],Fp.prototype,"tiledLayersExtent",null),u([h({readOnly:!0})],Fp.prototype,"stencilEnabledExtents",null),u([h()],Fp.prototype,"viewSpatialReference",void 0),u([h()],Fp.prototype,"tilingScheme",void 0),u([h()],Fp.prototype,"defaultTiledLayersExtent",void 0),u([h({constructOnly:!0})],Fp.prototype,"layers",void 0),u([h({constructOnly:!0})],Fp.prototype,"layerViews",void 0),Fp=u([I("esri.views.3d.terrain.ExtentHelper")],Fp);let Vre=class extends Fp{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?y$e:hdt}};Vre=u([I("esri.views.3d.terrain.ExtentHelperGlobal")],Vre);let jre=class extends Fp{_computeLayerViewsExtent(){const e=kd(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=g5e("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);ox(e,o,e)}});const r=$K(e)?e:null,i=this._get("layerViewsExtent");return N2(r,i)?i:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=kd();this.layers.forEach(n=>{if(n.loaded&&ID(n)){const o=TG(n,t,Ye.Local);if(C(o))return;const{tileInfo:a,fullExtent:l}=o;v(a)&&v(l)&&(e9(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&ox(r,l,r)}}),ox(r,this.defaultTiledLayersExtent,r);const i=$K(r)?r:null,s=this._get("tiledLayersExtent");return N2(i,s)?s:i}};function g5e(e,t){return v(e)&&!e.spatialReference.equals(t)?MIe(e,e.spatialReference,t):e}jre=u([I("esri.views.3d.terrain.ExtentHelperLocal")],jre);var xr;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(xr||(xr={}));const VS=[xr.ELEVATION,xr.MAP];function y5e(){var t;const e=(t=globalThis.require)==null?void 0:t.modules;if(e){const r=Object.keys(e);for(const i of r)i.search(".glsl")!==-1&&delete e[i]}}const oMt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let nb,iu=class extends be{constructor(e){super(e),this._handles=new hr,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=pe("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this._view.graphics.length>0||hi.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this._view.state.isGlobal}get _worldToPCSRatio(){return v(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?Kr(this._spatialReference).metersPerDegree:1}get _view(){return this.surface.view}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){var t;const e=this._view;this.renderer=new yy({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=Of(this._view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",r=>{var i;return(i=e._stage)==null?void 0:i.renderView.setRenderParameters({hasOverlayWater:r})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ie(()=>{var r,i,s;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(s=(i=e.pointsOfInterest)==null?void 0:i.centerOnSurfaceFrequent)==null?void 0:s.location]},()=>this.setPlacementDirty()),ie(()=>{var r;return(r=e.state)==null?void 0:r.pixelRatio},()=>this.setPlacementDirty(),bi),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(Ot.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(r,cn.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,cn.BACKGROUND,r)})]),(t=e._stage)==null||t.renderView.setRenderParameters({renderOverlay:r=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(r),this._drawOverlayTextures(this.renderer.overlays,cn.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),v(nb)&&(nb.hide(),nb=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this._view.renderSpatialReference;v(e)&&v(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new xx(-20037508342787e-6,20037508342787e-6):new xx(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const i=this.renderer.createDrapeSourceRenderer(e,t,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),i}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Py)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&v(e.setDrapingExtent)&&v(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this._view._stage)==null||e.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this._view.state.camera,cn.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;const r=Ybt(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,r,u_);const i=Ph(u_.inner)/Ph(u_.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(Us.INNER,u_.inner,r,1*u_.pixelRatioAdjustment,u_.mapUnitsPerPixel),n=this._updateOverlay(Us.OUTER,u_.outer,r,i*u_.pixelRatioAdjustment,u_.mapUnitsPerPixel);s!==$y.EXTENT&&n!==$y.EXTENT||(this._drapeSources.forEach(o=>this._updateDrapeSourceExtent(o)),this.surface.updateTileOverlayParams(t)),s===$y.NONE&&n===$y.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,r,i,s){if(this.renderer.overlays.length===0)return $y.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=i,aMt(t,n.extent)&&r===n.resolution)return o===s?$y.NONE:$y.RERENDER_ONLY;qv(n.extent,t),n.resolution=r;const a=goe(n.extent);return n.renderLocalOrigin=cL(a[0],a[1],0,"OV_"+this._latestOriginId++),$y.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[Us.INNER],i=this.renderer.overlays[Us.OUTER],s=e.extent;this._rectInsideRect(r.extent,s)||this._rectanglesOverlap(s,r.extent)||this._rectanglesOverlap(s,i.extent)?(this._setTileOverlayData(s,Us.INNER,t),this._setTileOverlayData(s,Us.OUTER,t)):(this._clearTileOverlayData(Us.INNER,t),this._clearTileOverlayData(Us.OUTER,t))}else this._clearTileOverlayData(Us.INNER,t),this._clearTileOverlayData(Us.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[Us.INNER],r=this.renderer.overlays[Us.OUTER],i=this._pointIsInExtent(e,t.extent)?t:r;return(i.extent[2]-i.extent[0])/i.resolution}_setTileOverlayData(e,t,r){if(this.renderer.overlays.length===0)return;const i=this.renderer.overlays[t].extent,s=Ph(i),n=pg(i);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(i[0],o);const a=this._longitudeCyclical.minimalMonotonic(i[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}r.setScale(t,Ph(e)/s,pg(e)/n),r.setOffset(t,(o-i[0])/s,(e[1]-i[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){y5e(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=e-this._animationTimeLast;e=yt(this._view.state.forcedAnimationTime,e),(t>=this.surface.view._stage.renderView.animationTimestep||v(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({time:e,camera:this._view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,t,r,i){const s=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,uMt,t,r);if(C(s))return!1;const n=s.origin,o=ye(OU,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([],null),this._view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(i)}_findHorizonBasedPointOfInterest(e,t){let r=.5;const i=.55,s=this._view.renderCoordsHelper.getAltitude(e.eye),n=this._view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=_e(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this._view.viewingMode==="global"){const c=OU;LI(Hj(qj,Kr(this._view.spatialReference).radius+a),ep(e.eye,e.viewForward),c),ge(c,c,e.eye);const d=Tx.normalize(RPe(e.viewForward,c,e.viewRight))/e.fovY+.5,p=d<=0||d>=1?.5:i;r=l?p*d:d+p*(1-d)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),d=Math.tan(c),p=ar(0,d,1,0),f=kh(p,p,e.projectionMatrix)[1],m=_e(.5+.5*f,0,1);r=m===1||m===0?.5:l?m*i:1-(1-m)*i}return!!this._intersectGroundFromView(e,.5,r,t)&&Cne(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,r){const i=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=$();this._findHorizonBasedPointOfInterest(e,s)||le(s,i);const n=Math.max(.1,Ni(e.eye,s)),o=Fx(this._view.renderCoordsHelper,i,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);hi.OVERLAY_SHOW_CENTER?(C(nb)&&(nb=new Gb(this._view.graphics,"red")),nb.show(s,this._renderSR)):v(nb)&&nb.hide(),this._overlaySREqualsRenderSR||So(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&v(this._spatialReference)&&this._spatialReference.isGeographic,d=c&&v(this._spatialReference)?1/Kr(this._spatialReference).metersPerDegree:1,p=e.perRenderPixelRatio*n*d;r.mapUnitsPerPixel=p/this._worldToPCSRatio;let f=t*p/2,m=!1,g=c?90:1/0;this._isSpherical&&v(l)&&v(this._spatialReference)&&(this._spatialReference.isWebMercator?(f/=Math.cos(vz(s[1])),g=l[3]):(m=!0,f/=Kr(this._spatialReference).metersPerDegree,g=90),f>=g&&(f=g,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let _=1;m&&(_=1/Math.max(.2,Math.cos(Math.abs(Zt(s[1])))),f*_>180&&(_=180/f),r.mapUnitsPerPixel*=_);const x=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/x)*x);const b=f*_,w=32,T=.5*t/(w*b),E=.5*t/(w*f);s[0]=Math.round(s[0]*T)/T,s[1]=Math.round(s[1]*E)/E;const O=r.inner;O[0]=s[0]-b,O[1]=s[1]-f,O[2]=s[0]+b,O[3]=s[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(O,1/0,g);const A=r.outer;if(6*b>Ph(l))qv(A,l);else if(a<=.25*Math.PI)A[0]=O[0]-b,A[1]=O[1]-f,A[2]=O[2]+b,A[3]=O[3]+f;else{So(e.eye,this._renderSR,OU,this._spatialReference),Gy(BT,s,OU);let D=-Math.atan2(BT[1],BT[0])+.125*Math.PI;D<0&&(D+=2*Math.PI);const k=Math.floor(D/(.25*Math.PI));NF(BT,oMt[k],2*f),BT[0]*=_,BT[2]*=_,Ane(A,O,BT)}if(this._isSpherical)A[0]=this._longitudeCyclical.clamp(A[0]),A[2]=this._longitudeCyclical.clamp(A[2]),A[1]=Math.max(A[1],-g),A[3]=Math.min(A[3],g);else{const D=DK(O,l,lMt),k=DK(A,l,cMt);Jpe(D,k)&&(A[2]=A[0],A[3]=A[1])}const R=Math.abs(O[2]-O[0])/t;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,R),r.pixelRatioAdjustment=r.mapUnitsPerPixel/R}_drawOverlayTextures(e,t,r=this._view.state.camera){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const i=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[Us.INNER],r),n=this._drawOverlay(e[Us.OUTER],r);s!==WR.CHANGED&&n!==WR.CHANGED||this.surface.updateTileOverlayParams(cn.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),i?(this.surface.requestRender(t),t===cn.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(cn.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!C(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):HF(e,t))}_rectInsideRect(e,t){return!C(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:Jpe(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const r=e.x,i=e.y;return r>t[0]&&r<t[2]&&i>t[1]&&i<t[3]}_shiftExtentToFitBounds(e,t,r){let i=0,s=0;e[0]<-t?i=e[0]+t:e[2]>t&&(i=t-e[2]),e[1]<-r?s=e[1]+r:e[3]>r&&(s=r-e[3]),Nz(e,i,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function aMt(e,t){const i=hi.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=i&&Math.abs(t[1]-e[1])<=i&&Math.abs(t[2]-e[2])<=i&&Math.abs(t[3]-e[3])<=i}u([h()],iu.prototype,"_spatialReference",void 0),u([h({readOnly:!0})],iu.prototype,"running",null),u([h()],iu.prototype,"_placementDirty",void 0),u([h()],iu.prototype,"_contentUpdated",void 0),u([h()],iu.prototype,"_isSpherical",null),u([h()],iu.prototype,"_worldToPCSRatio",null),u([h()],iu.prototype,"renderer",void 0),u([h({constructOnly:!0})],iu.prototype,"surface",void 0),u([h()],iu.prototype,"suspended",null),u([h()],iu.prototype,"updating",null),u([h({type:Boolean})],iu.prototype,"hasHighlights",null),u([h({type:Boolean})],iu.prototype,"rendersOccluded",null),iu=u([I("esri.views.3d.terrain.OverlayManager")],iu);const BT=Lr(),OU=$(),u_={inner:tr(),outer:tr(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},lMt=tr(),cMt=tr(),uMt=ca();var $y;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})($y||($y={}));class fF{constructor(t,r){this._factoryCallback=t,this._lengthCallback=r,this._pool=new Map}acquire(t){if(!fF.test.disabled){const r=this._pool.get(t);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(t)}catch(r){const i=window.performance&&window.performance.memory;let s="";throw i&&(s=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+r+s),r}}release(t){if(fF.test.disabled)return;const r=this._lengthCallback(t);let i=this._pool.get(r);i||(i=new Qt({shrink:!0}),this._pool.set(r,i)),i.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}fF.test={disabled:!1};class dMt{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=es(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class j1e{constructor(t,r,i,s,n){this.attributes=t,this.localOrigin=r,this.index0=i,this.stride=s,this.count=n}getVertexIndex(t){return this.getAttributeIndex(t)}getAttributeIndex(t){return Ne(0<=t&&t<this.count),this.index0+this.stride*t}_getVertexRaw(t,r){this.attributes.position.getVec(t,r)}_getNormalRaw(t,r){this.attributes.normalCompressed.getVec(t,r)}getVertexPos(t,r){this._getVertexRaw(this.getAttributeIndex(r),t),ye(t,t,this.localOrigin)}getNormal(t,r){const i=rt();this._getNormalRaw(this.getAttributeIndex(r),i),mMt(t,i)}_setNormal(t,r,i,s){mF(this.attributes.normalCompressed,t,r,i,s)}_setUV(t,r,i){Ld(this.attributes.uv0,t,r,i)}setNormalFromValues(t,r,i,s){this._setNormal(this.getAttributeIndex(t),r,i,s)}setVertexFromValuesRawPositionUV(t,r,i,s,n,o){const a=this.getAttributeIndex(t);this.attributes.position.setValues(a,r,i,s),this._setUV(a,n,o)}setVertexFromValuesRawPositionUVNormal(t,r,i,s,n,o,a,l,c){const d=this.getAttributeIndex(t);this.attributes.position.setValues(d,r,i,s),this._setUV(d,n,o),this._setNormal(d,a,l,c)}}const hMt=Ds().vec3f(M.POSITION).vec2i16(M.UV0).vec2i16(M.NORMALCOMPRESSED,{glNormalized:!0}),Yce=new fF(e=>hMt.createBuffer(e),e=>e.count);function pMt(){Yce.clear()}function _5e(e){return Yce.acquire(e)}function fMt(e){Yce.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}function mF(e,t,r,i,s){const n=1/(Math.abs(r)+Math.abs(i)+Math.abs(s)),o=r*n,a=i*n,l=s<=0?(o>=0?1:-1)*(1-Math.abs(a)):o,c=s<=0?(a>=0?1:-1)*(1-Math.abs(o)):a;e.setValues(t,H1e(l),H1e(c))}function mMt(e,t){const r=q1e(t[0]),i=q1e(t[1]),s=1-Math.abs(r)-Math.abs(i);e[2]=s,s<0?(e[0]=(r>=0?1:-1)*(1-Math.abs(i)),e[1]=(i>=0?1:-1)*(1-Math.abs(r))):(e[0]=r,e[1]=i),xe(e,e)}const G1e=16384;function Ld(e,t,r,i){e.setValues(t,r*G1e,i*G1e)}function H1e(e){return _e(Math.round(32767*e),-32767,32767)}function q1e(e){return _e(e/32767,-1,1)}function $c(e,t,r,i){e<i[0]?i[0]=e:e>i[3]&&(i[3]=e),t<i[1]?i[1]=t:t>i[4]&&(i[4]=t),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}class gMt{constructor(){this.sinLonLUT=new Array(E$+1),this.cosLonLUT=new Array(E$+1),this.sinLatLUT=new Array(E$+1),this.cosLatLUT=new Array(E$+1)}update(t,r,i){const s=r[0],n=r[2];for(let o=0;o<=t;o++){const a=o/t,l=s*(1-a)+n*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}}class MU{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}}class yMt{constructor(){this.cornerNeighborData=[new MU,new MU,new MU,new MU],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}}class _Mt{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.shading=!1,this.samplerDataVersion=0,this.neighborData=new yMt}}class YM{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Qe(this._current),this._next=Qe(this._next),this._waiting=Qe(this._waiting),this._delayed=Qe(this._delayed)}get current(){if(C(this._current))return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let t=YM.test.fadeMoment;if(v(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,$v.Immediate),this._delayed=null)),v(this._next)){t=t||performance.now();const r=this._fadeDuration,i=v(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==ua.FADING,n=t-this._fadeStart>=r;(i||s||n)&&(Qe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(C(this._next))return 1;const t=YM.test.fadeMoment||performance.now(),r=Math.max(0,t-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return v(this._next)||v(this._delayed)}push(t,r=$v.Immediate){this._delayed=Qe(this._delayed),this._push(t,r)}_push(t,r){if(this._isFadingEnabled||this.clear(),C(this._current))return void(this._current=t);const i=YM.test.fadeMoment||performance.now();return r!==$v.Immediate?(this._delayed=t,void(this._delayedTime=i+r)):C(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(i))):void(C(t)||(Qe(this._waiting),this._waiting=t))}get _fadeDuration(){return C(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const r=this._getFadeDuration();return t+r-t%r}get _isFadingEnabled(){return this._getFadeDuration()>0}}var $v;YM.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}($v||($v={}));class v5e{constructor(){this._queue=new Qt,this._last=null,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null}reset(t=null){this._queue.clear(),v(t)&&this._queue.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class vMt{constructor(){this._q=new Qt}get done(){return this._q.length===0}reset(t){if(this._q.clear(),!C(t)){this._q.pushArray(t);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}}function yL(e,t,r){if(C(t)||C(t.fullExtent))return!1;const i=t.fullExtent,s=e.extent;if(r){if(s[0]<i.xmin||s[1]<i.ymin||s[2]>i.xmax||s[3]>i.ymax)return!1}else if(i.xmin>s[2]||i.ymin>s[3]||i.xmax<s[0]||i.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&n>1.00000001*t.minScale)&&!(t.maxScale>0&&n<.99999999*t.maxScale)}function Dv(e,t){return e.lij[0]-t.lij[0]||e.lij[1]-t.lij[1]||e.lij[2]-t.lij[2]}function b5e(e,t,r=null){C(r)||r.length===0?t.sort((i,s)=>Zce(i,s,e)):t.sort((i,s)=>bMt(i,s,e,r))}function Zce(e,t,r){const i=e.screenDepth,s=t.screenDepth;return i<s?-r:i>s?r:Dv(e,t)}function bMt(e,t,r,i){return W1e(e,i)===W1e(t,i)?Zce(e,t,r):e?r:-r}function W1e(e,t){for(const r of t)if(e.intersectsExtent(r))return!0;return!1}function wMt(e,t){const r=new Map;e.forAll(i=>r.set(i.lij,i.distanceToSquared(t))),e.sort((i,s)=>r.get(i.lij)-r.get(s.lij)||Dv(i,s))}function xMt(e,t,r){let i=1,s=0,n=0;for(;e!==t;)if(i*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(t,s,n,i)}function TMt(e){for(let t=0;t<e.length;t++){const r=e[t],i=r.parent;if(i)for(let s=0;s<4;s++){const n=i.children[s];if(n&&n!==r)return!0}}return!1}function lzt(e,t){if(!e||!t||e[0]===t[0])return!1;const r=e[0]<t[0],i=r?e:t,s=r?t:e,n=1<<s[0]-i[0];return Math.floor(s[1]/n)===i[1]&&Math.floor(s[2]/n)===i[2]}class Jce{get updating(){return!!this._tileRequested}init(t,r,i,s){this.tile=t,this._layerIdx=r,this._layerClass=i,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(r,i),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,ua.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return v(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(t,r),s=kre(i),{minLevel:n,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?yL:()=>!0;let d=this.tile;const p=d.level;let f;const m=this._tileLayerInfo.upsampleInfo,g=v(m)?m.tile.level:-1,_=!!v(m)&&g-p>=a,x=Ks(s,"tilemapCache");for(;d&&c(d,s,!1)&&d.level>=n;){const b=d.level,w=p-b,T=d.layerInfo[r][t];if(T.data&&w>=a){(!_||b>g)&&this._setUpsampleTile(d),T.dataInvalidated&&(f=d);break}if((C(x)||x.getAvailability(d.lij[0],d.lij[1],d.lij[2])!=="unavailable")&&b<=o&&!T.data&&!T.dataMissing&&((C(f)||d.level===n||b%g$e==0||p-f.level<a)&&(f=d),w>=l))break;d=d.parent}return v(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const t=this.tile.vlevel,r=this._desiredMinLevelDelta;let i;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=r)return s;i=s}return i}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,ua.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class SMt extends Jce{get _desiredMinLevelDelta(){throw X1e}get _progressiveLevelModulo(){throw X1e}dispose(){}}const X1e=new Error("Abstract method called on TileAgent"),ju=new SMt;class w5e extends Jce{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return PB(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class x5e extends Jce{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return g$e}}var W2,GE;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(W2||(W2={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(GE||(GE={}));function EMt(e,t){e.fragment.uniforms.add([new Rt("u_colormap",r=>r.u_colormap),new De("u_colormapOffset",r=>r.colormap.u_colormapOffset),new De("u_colormapMaxIndex",r=>r.colormap.u_colormapMaxIndex),new De("u_opacity",r=>r.common.u_opacity)]),e.fragment.code.add(S`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${vu(t,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)}function CMt(e,t){e.fragment.uniforms.add(sg("u_transformGrid",r=>r.u_transformGrid,t.hasWebGL2Context?vi.None:vi.InvSize)),e.fragment.uniforms.add(new ai("u_transformSpacing",r=>r.common.u_transformSpacing)),e.fragment.uniforms.add(new ai("u_targetImageSize",r=>r.common.u_targetImageSize)),e.fragment.code.add(S`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${vu(t,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${vu(t,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${vu(t,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${vu(t,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)}class T5e extends Zi{constructor(){super(...arguments),this.scale=1,this.offset=Ud}}function S5e(e){e.attributes.add(M.POSITION,"vec2"),e.attributes.add(M.UV0,"vec2"),e.vertex.uniforms.add(new De("scale",t=>t.scale)),e.vertex.uniforms.add(new ai("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(S`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class AMt extends T5e{constructor(t,r,i){super(),this.common=t,this.u_image=r,this.u_transformGrid=i}}function OMt(e,t){e.include(CMt,t),e.fragment.uniforms.add([new Rt("u_image",r=>r.u_image),new Mv("u_flipY",r=>r.common.u_flipY),new Mv("u_applyTransform",r=>r.common.u_applyTransform)]),e.fragment.code.add(S`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}var ke;(function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"})(ke||(ke={}));const Gre={normal:ke.Normal,average:ke.Average,lighten:ke.Lighten,lighter:ke.Lighter,screen:ke.Screen,plus:ke.Plus,"color-dodge":ke.ColorDodge,darken:ke.Darken,multiply:ke.Multiply,"color-burn":ke.ColorBurn,overlay:ke.Overlay,"soft-light":ke.SoftLight,"hard-light":ke.HardLight,"vivid-light":ke.VividLight,hue:ke.Hue,saturation:ke.Saturation,luminosity:ke.Luminosity,color:ke.Color,difference:ke.Difference,exclusion:ke.Exclusion,minus:ke.Minus,invert:ke.Invert,reflect:ke.Reflect,"destination-over":ke.DestinationOver,"destination-atop":ke.DestinationAtop,"destination-in":ke.DestinationIn,"destination-out":ke.DestinationOut,"source-atop":ke.SourceAtop,"source-in":ke.SourceIn,"source-out":ke.SourceOut,xor:ke.Xor};function MMt(e){return e===ke.DestinationOver||e===ke.DestinationAtop||e===ke.DestinationIn||e===ke.DestinationOut||e===ke.SourceAtop||e===ke.SourceIn||e===ke.SourceOut||e===ke.Xor}function Kce(e){e.code.add(S`
    float lineFactorAtPosition(float value) {
      float pos = value * ${S.float(257)};
      if(pos < 0.5 || pos > ${S.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}function RMt(e,t){const r=t.blendMode;r!==ke.Normal&&(r===ke.Reflect&&e.code.add(S`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==ke.ColorDodge&&r!==ke.VividLight||e.code.add(S`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==ke.ColorBurn&&r!==ke.VividLight||e.code.add(S`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===ke.Overlay&&e.code.add(S`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===ke.HardLight&&e.code.add(S`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===ke.SoftLight&&e.code.add(S`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===ke.VividLight&&e.code.add(S`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==ke.Hue&&r!==ke.Saturation&&r!==ke.Color&&r!==ke.Luminosity||(e.code.add(S`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==ke.Hue&&r!==ke.Saturation||e.code.add(S`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(S`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===ke.Multiply?S`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Average?S`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Lighten?S`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Darken?S`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Lighter?S`return vec4(cl * ol + cb * ob, ol + ob);`:r===ke.Plus?S`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===ke.Minus?S`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===ke.Screen?S`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Difference?S`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Invert?S`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===ke.DestinationOver?S`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===ke.DestinationAtop?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===ke.DestinationOut?S`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===ke.SourceAtop?S`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===ke.SourceOut?S`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===ke.Xor?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===ke.DestinationIn?S`return vec4(cb * ob * ol, ol * ob);`:r===ke.SourceIn?S`return vec4(cl * ol * ob, ol * ob);`:r===ke.Hue?S`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Saturation?S`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Color?S`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Luminosity?S`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Exclusion?S`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Reflect?S`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.ColorDodge?S`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.ColorBurn?S`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.Overlay?S`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.SoftLight?S`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.HardLight?S`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===ke.VividLight?S`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:S``}
    }
  `))}var Lo,Zm,$m;(function(e){e[e.Composite=0]="Composite",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.GroupBackgroundComposite=3]="GroupBackgroundComposite",e[e.COUNT=4]="COUNT"})(Lo||(Lo={})),function(e){e[e.NotRequired=0]="NotRequired",e[e.Required=1]="Required",e[e.COUNT=2]="COUNT"}(Zm||(Zm={})),function(e){e[e.Off=0]="Off",e[e.On=1]="On",e[e.COUNT=2]="COUNT"}($m||($m={}));function E5e(e,t){const r=t.output===Lo.GridComposite,i=t.output===Lo.ColorComposite,s=t.output===Lo.GroupBackgroundComposite,n=t.output===Lo.Composite;r&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(Kce)),i&&e.fragment.uniforms.add(new er("backgroundColor",c=>c.backgroundColor));const o=t.baseOpacityMode===Zm.Required;if(o&&e.fragment.uniforms.add(new De("baseOpacity",c=>c.baseOpacity)),n){const c=t.hasWebGL2Context?vi.None:vi.InvSize;e.fragment.uniforms.add(sg("fboColor",d=>d.fboTexture,c))}const a=t.blendMode!==ke.Normal,l=t.premultipliedSource===$m.On;e.fragment.include(RMt,t),e.fragment.code.add(S`
    vec4 getBackground(vec2 uv) {
      return ${o?S`baseOpacity *`:""} ${s?S`vec4(0.0, 0.0, 0.0, 0.0)`:i?S`vec4(backgroundColor, 1.0)`:r?S`gridColor(uv)`:S`${vu(t,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?S`
          vec3 Cb = bgColor.a == 0.0 ? bgColor.rgb : vec3(bgColor.rgb * bgColor.a);
          return applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, bgColor.a);`:S`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          return ${l?S`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:n&&!o||s?S`pmColorLayer * composeAlpha;`:S`mix(bgColor, pmColorLayer, composeAlpha);`}`}
    }`)}class EG extends AMt{constructor(t,r,i,s,n,o){super(t,s,n),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=Ic,this.fboTexture=null,this.baseOpacity=1}}class IMt extends EG{}class PMt extends EG{}function $Mt(e){const t=new Qr;return t.include(S5e),t.include(OMt,e),t.include(EMt,e),t.include(E5e,e),t.fragment.code.add(S`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),e.colorizerType===W2.Stretch?LMt(t,e):e.colorizerType===W2.Lut?DMt(t):e.colorizerType===W2.Hillshade&&NMt(t,e),t}function DMt(e){e.fragment.code.add(S`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function LMt(e,t){e.fragment.uniforms.add([new w4("u_bandCount",i=>i.symbolizer.u_bandCount),new $l("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new $l("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new $l("u_factor",i=>i.symbolizer.u_factor,3),new De("u_minOutput",i=>i.symbolizer.u_minOutput),new De("u_maxOutput",i=>i.symbolizer.u_maxOutput),new Mv("u_useGamma",i=>i.symbolizer.u_useGamma),new $l("u_gamma",i=>i.symbolizer.u_gamma,3),new $l("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new De("u_opacity",i=>i.common.u_opacity)]),e.fragment.code.add(S`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=t.applyColormap?S`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:S`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(S`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===GE.Noop?S`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:S`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function NMt(e,t){const r=e.fragment;r.uniforms.add([new Rt("u_image",s=>s.u_image),new w4("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new $l("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new $l("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new $l("u_cosZs",s=>s.symbolizer.u_cosZs,6),new $l("u_weights",s=>s.symbolizer.u_weights,6),new ai("u_factor",s=>s.symbolizer.u_factor),new De("u_minValue",s=>s.symbolizer.u_minValue),new De("u_maxValue",s=>s.symbolizer.u_maxValue),new ai("u_srcImageSize",s=>s.common.u_srcImageSize)]),r.include(k0),r.code.add(S`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),r.code.add(S`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=t.applyColormap?S`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:S`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(S`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const FMt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:EG,ColorizerStretchUniforms:IMt,ColorizerHillshadeUniforms:PMt,build:$Mt},Symbol.toStringTag,{value:"Module"}));function kMt(e,t,r="nearest",i=!1){var c;const s=!(i&&t.pixelType==="u8"),n=s?Nt.FLOAT:Nt.UNSIGNED_BYTE,o=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),a=(c=e.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:t.width,height:t.height,target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,internalFormat:e.type===jt.WEBGL2&&s?Tt.RGBA32F:qe.RGBA,samplingMode:!a||r!=="bilinear"&&r!=="cubic"?at.NEAREST:at.LINEAR,dataType:n,wrapMode:It.CLAMP_TO_EDGE,flipped:!1};return new dt(e,l,o)}function UMt(e,t){const{spacing:r,offsets:i,coefficients:s,size:[n,o]}=t,a=r[0]>1,l={width:a?4*n:n,height:o,target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,internalFormat:e.type===jt.WEBGL2?Tt.RGBA32F:qe.RGBA,dataType:Nt.FLOAT,samplingMode:at.NEAREST,wrapMode:It.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*i.length);if(a)for(let d=0,p=0;d<s.length;d++)c[p++]=s[d],d%3==2&&(c[p++]=1);else for(let d=0;d<o;d++)for(let p=0;p<n;p++){const f=4*(d*n+p),m=2*(p*o+d);c[f]=i[m],c[f+1]=i[m+1],c[f+3]=i[m]===-1?0:1}return new dt(e,l,c)}function Y1e(e,t){const r={width:t.length/4,height:1,target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,internalFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.NEAREST,wrapMode:It.CLAMP_TO_EDGE,flipped:!1};return new dt(e,r,t)}function BMt(e,t,r,i=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:i,u_transformSpacing:e?e.spacing:Ud,u_transformGridSize:e?e.size:Ud,u_targetImageSize:t,u_srcImageSize:r}}function zMt(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function VMt(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function jMt(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const Z1e={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class GMt{constructor(t,r,i=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=r,this.width=i||r.width,this.height=s||r.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=tt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...Z1e,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||Z1e}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){v(t)&&t.length>0?this._bandIds&&t.every((r,i)=>!!this._bandIds[i]&&r===this._bandIds[i])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,v(this._rasterTexture)){const r=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(r==="bilinear"?at.LINEAR:at.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=tt(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((C(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),v(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&C(this._transformGridTexture)&&(this._transformGridTexture=UMt(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:r,width:i,height:s,opacity:n}=this,o=BMt(r,[i,s],[this.source.width,this.source.height],n),a=zMt(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?VMt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?jMt(this.symbolizerParameters):null;return new EG(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(C(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(r=>v(r)?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=tt(this._rasterTexture),this._transformGridTexture=tt(this._transformGridTexture),this._colormapTexture=tt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=tt(this._rasterTexture));const s=C(r)&&C(this.bandIds)||v(r)&&v(this.bandIds)&&r.join("")===this.bandIds.join("");if(v(this._rasterTexture)&&s)return;this._rasterTexture=tt(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=kMt(t,i,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((s,n)=>s!==r[n])?(this._colormapTexture=tt(this._colormapTexture),this._colormapTexture=Y1e(t,i),void(this._colormap=i)):void 0:(this._colormapTexture=Y1e(t,i),void(this._colormap=i)):(this._colormapTexture=tt(this._colormapTexture),void(this._colormap=null))}}class t8{constructor(){this.waitingAgents=new Qt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const r=nY.acquire();return r._init(t),r}release(){this.dispose(),r8.delete(this),nY.release(this)}dispose(){this.loadingAgent=tt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=XM(this._data)}static prune(){nY.prune(0)}_init(t){this.waitingAgents.clear(),this._data=XM(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=lg(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){v(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,r){if(t===r||C(r))this._unsetUpsampleInfo();else{if(C(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),xMt(t,r,this._upsampleInfo)}}get data(){return this._data}set data(t){XM(this._data),this._data=t}}const nY=new ro(t8,null,()=>{}),r8=new Map;function HMt(){r8.size>0&&(console.log(`${r8.size} live TilePerLayerInfo allocations:`),r8.forEach(e=>console.log(e,`
`)))}class yO{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var St;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(St||(St={}));const oY=$(),dA=$(),va=$(),qMt=.1;class WMt{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class Qce{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=tr(),this._elevationBounds=rt(),this.layerInfo=[[],[]],this.extentInRadians=tr(),this.centerAtSeaLevel=$(),this._center=[$(),qo(),$()],this.up=Sne(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0}static prune(){eue.prune(0),tue.prune(0),t8.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Ec.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){var i,s;this._dirty=!1;const t=(s=(i=this.parent)==null?void 0:i.frustumVisibility)!=null?s:Ol.INTERSECTS;this._frustumVisibility=t===Ol.INSIDE?Ol.INSIDE:t===Ol.OUTSIDE?Ol.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==Ol.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setDirty()),t}get shouldLoad(){const t=this._surface.snapLevel;if(v(t)){const r=this.level-t;if(r===0)return!0;if(r===1)return!1}return this.isLeaf}init(t,r,i){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=Kr(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Ec.MIDDLE][3]=0,this.vlevel=t?t[0]:0,r&&r.elevationBounds?Ho(this._elevationBounds,r.elevationBounds):mr(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const s of VS){const n=i.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=t8.acquire(this._surface.upsampleInfoPool),s===xr.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,E$)}release(){ky(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of VS){for(const r of this.layerInfo[t])r.release();this.layerInfo[t].length=0}this._parent=null;for(let t=0;t<4;++t)this._children[t]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const t=this._cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[xr.MAP].reduce((t,r)=>t+(r instanceof gL?r.memoryUsage:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(v(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let t=0;for(const{data:i}of this.layerInfo[xr.MAP])i instanceof gL?t+=this._getTerrainDataMemory(i):this._mapTileMemoryInternal+=this._getTerrainDataMemory(i);const r=this._cpuImageMemorySize;for(const i of this.layerInfo[xr.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=CE(this.renderData.textureDescriptor)),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+t),this._usedMemory}getUsedMemoryForLayer(t,r){const i=this.layerInfo[t][r];return i!=null&&i.data?t===xr.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):t===xr.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof yO?CE(t.texture):t instanceof HTMLImageElement||t instanceof wG?this._cpuImageMemorySize:t instanceof gL||t instanceof GMt?t.memoryUsage:0}updateScreenDepth(t){const r=this._center[Ec.MIDDLE],i=t,s=r[0],n=r[1],o=r[2],a=i[2]*s+i[6]*n+i[10]*o+i[14];this._screenDepth=a<0?0:a/(i[3]*s+i[7]*n+i[11]*o+i[15])}shouldSplit(t,r,i){if(!this.visible||v(t.frustum)&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(t.frustum)===Ol.OUTSIDE))return St.NONE;const s=this.level;ge(oY,this._center[Ec.MIDDLE],r);let n=Rc(oY),o=Ec.MIDDLE;ge(dA,this._center[Ec.TOP],r);const a=Rc(dA);a<n&&(n=a,o=Ec.TOP),ge(dA,this._center[Ec.BOTTOM],r);const l=Rc(dA);if(l<n&&(n=l,o=Ec.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return St.SPLIT;const c=Math.sqrt(n),d=t.fovX*c*2,p=this._edgeLen/d,f=()=>{const x=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return x!==this.vlevel?(this.vlevel=x,St.VSPLITMERGE):St.NONE_HIT_MAXLOD};if(v(i)&&i-s===1)return s>=t.maxLod?f():St.SPLIT;const m=Te(this.up,oY),g=this._elevationBounds[1]-this._elevationBounds[0],_=g/this.edgeLen;if(t.aboveGround&&m>0&&_<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-_>0)return St.NONE;if(p<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,St.VSPLITMERGE):St.NONE;if(s>=t.maxLod)return f();if(s>6){ge(dA,this._center[o],r),de(va,this.up,m),ge(va,va,dA);const x=Rc(va);if(x>this.radius*this.radius){de(va,va,this.radius/Math.sqrt(x)),ye(va,va,this._center[o]),ge(va,r,va);const b=Math.min(1,(Math.abs(Te(va,this.up))+.5*g+this._curvatureHeight)/Ie(va)),w=qMt/t.angledSplitBias,T=t.fovY*c*2;if(b*(this._edgeLen/T)<w*t.relativeHeightLimit)return St.NONE}}return St.SPLIT}setChildren(t,r,i,s){ky(!!(t&&r&&i&&s),"Null child passed"),this._children[0]=t,this._children[1]=r,this._children[2]=i,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,r;return(r=(t=this.renderData)==null?void 0:t.hasGeometry)!=null?r:!1}load(){this.refMapData();for(const t of VS)this._createOrUpdateAgents(0,t);this.surface.renderer.loadTile(this)}unload(t){t.unloadTile(this);for(const r of VS){const i=this.layerInfo[r];for(const s of i)s.loadingAgent&&s.loadingAgent!==ju&&(RU(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(St.GEOMETRY),this.resetPendingUpdate(St.TEXTURE_NOFADING),this.resetPendingUpdate(St.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[xr.MAP];for(const r of t)r.loadingAgent&&r.loadingAgent!==ju&&(RU(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(N2(t,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;v(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=i&&this._isWithinClippingArea,n=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(St.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,r){return this.layerInfo[r][t]}hasLayerData(t,r){const i=this.layerInfo[r][t];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of VS){const r=this.layerInfo[t];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==ju&&i.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(St.SPLIT)||t!==xr.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===St.SPLIT||t===St.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,r,i){const s=this.layerInfo[r][t];if(s.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,t),!0;if(s.waitingAgents.push(i),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,t),i.dataArrived(this),!0;if(s.requestPromise)return!0;lg(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,r,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){return this.hasLij(t)?this:this.isLeaf?null:this._children[0].findByLij(t)||this._children[1].findByLij(t)||this._children[2].findByLij(t)||this._children[3].findByLij(t)||null}distanceToSquared(t){return Rc(ge(va,this._center[Ec.MIDDLE],t))}containsPoint(t){const r=this.extent;return t[0]>=r[0]&&t[1]>=r[1]&&t[0]<=r[2]&&t[1]<=r[3]}containsPointXY(t,r){const i=this.extent;return t>=i[0]&&r>=i[1]&&t<=i[2]&&r<=i[3]}unrequestLayerData(t,r,i){const s=this.layerInfo[r][t],n=s.waitingAgents,o=n.removeUnordered(i)!=null;ky(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,r,i){const s=this.layerInfo[r][t];s.data=i,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${t} error ${i}`);const s=this.layerInfo[r][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,r){switch(t){case xr.MAP:return this._updateTexture(r);case xr.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===ua.FADING?St.TEXTURE_NOFADING:St.TEXTURE_FADING),this.setPendingUpdate(t===ua.FADING?St.TEXTURE_FADING:St.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(St.GEOMETRY);for(const t of this.layerInfo[xr.ELEVATION])t.pendingUpdates|=St.GEOMETRY}invalidateLayerData(t,r){this.layerInfo[r][t].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const t=this._elevationBounds;mr(t,1/0,-1/0);const r=this.layerInfo[xr.ELEVATION];let i=!0;for(const s of r)v(s.elevationBounds)&&(t[0]=Math.min(t[0],s.elevationBounds.min),t[1]=Math.max(t[1],s.elevationBounds.max),s.elevationBounds.hasNoDataValues||(i=!1));i&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const t=this._elevationBounds,r=.5*(t[0]+t[1]);de(va,this.up,r),ye(this._center[Ec.MIDDLE],this.centerAtSeaLevel,va),de(va,this.up,t[0]),ye(this._center[Ec.TOP],this.centerAtSeaLevel,va),de(va,this.up,t[1]),ye(this._center[Ec.BOTTOM],this.centerAtSeaLevel,va)}findElevationBoundsForLayer(t,r){const i=this.layerInfo[xr.ELEVATION][t];if(v(i.elevationBounds)&&i.elevationBounds.level>=r)return;const s=this._surface.layerViewByIndex(t,xr.ELEVATION),n=kre(s);if(!yL(this,n,!1))return;const o=YMt;let a=!1;if(i.data){const l=i.data;o.min=l.bounds[0],o.max=l.bounds[1],o.hasNoDataValues=l.hasNoDataValues,o.level=this.level,a=!0}else{let l,c,d=0;for(let p=this._parent;p&&(!c||d<PB(this.level))&&(d=this.vlevel-p.level,l=c||l,c=p.layerInfo[xr.ELEVATION][t].data,!(!c&&l&&d>=PB(this.level)));p=p.parent);c=c||l,c&&(c.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=c.level,a=!0))}a&&(C(i.elevationBounds)&&(i.elevationBounds=new cM),i.elevationBounds.copyFrom(o))}modifyLayers(t,r,i){const s=this.layerInfo[i];for(const a of s)a.loadingAgent&&a.loadingAgent!==ju&&(RU(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=r.length;s.length=o;for(let a=0;a<o;a++){const l=r[a];s[a]=l>-1?n[l]:t8.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,ua.FADING))}updateAgents(t){if(this.renderData){const r=this.layerInfo[t];for(const i of r)i.loadingAgent===ju&&(i.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of VS){const r=this._isSuspended(t);for(const i of this.layerInfo[t])i.loadingAgent&&i.loadingAgent!==ju&&(i.loadingAgent.setSuspension(r),i.loadingAgent===ju&&this.updateRenderData(t,ua.FADING))}}removeLayerAgent(t,r){const i=this.layerInfo[r][t];i.loadingAgent&&i.loadingAgent!==ju&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(t,r){const i=this.layerInfo[r][t];i.loadingAgent=ju,!i.data&&C(i.upsampleInfo)&&this._createOrUpdateAgents(t+1,r)}_hasBlendableAncestor(t){return t.blendMode!=="normal"||pI(t.parent)&&this._hasBlendableAncestor(t.parent)}_hasBlendModes(t,r,i){var s,n,o;for(let a=t;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(t9(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||pI((n=l==null?void 0:l.layer)==null?void 0:n.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(t,r){const i=this.layerInfo[r];if(i.length===0)return;const s=this._isSuspended(r);for(let n=t;n<i.length;++n){const o=i[n];let a=!1;const l=this._surface.layerViewByIndex(n,r),c=kre(l);if(o.loadingAgent?yL(this,c,!1)?(o.loadingAgent!==ju&&o.loadingAgent.setSuspension(s),o.loadingAgent!==ju&&(a=o.loadingAgent.update())):o.dispose():yL(this,c,!1)&&(o.loadingAgent=XMt(this,n,r,s),a=o.loadingAgent.startLoading(),a?o.loadingAgent===ju&&this.setPendingUpdate(St.GEOMETRY):(RU(o.loadingAgent),o.loadingAgent=ju)),o.loadingAgent===ju&&this.updateRenderData(r,ua.FADING),!this._hasBlendModes(t,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(t){const r=this.extent;return r[0]>=t[0]&&t[2]>=r[2]&&r[1]>=t[1]&&t[3]>=r[3]}intersectsExtent(t){const r=this.extent;return r[2]>=t[0]&&t[2]>=r[0]&&r[3]>=t[1]&&t[3]>=r[1]}getElevationBasedVerticesPerSide(t){const r=this.vlevel-this.level,i=Math.max(this.level-t,PB(this.level)-r);return _e(1+(this.maxTesselation>>i),2,this.maxTesselation+1)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(t,r){if(!t)return null;const i=this.surface.rootTiles;if(v(i)){for(const s of i)if(ZMt(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!r(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return r(n)?n:null}}return null}findNeighborTile(t,r){const i=this.lij,s=this.getNeighborLIJ(i,t);return s?JMt(i,s)?r(this)?this:null:this._findLIJ(s,r):null}findCorner(t,r){const i=t===Mt.NORTH_EAST?1:t===Mt.NORTH_WEST?0:t===Mt.SOUTH_WEST?2:3;let s=this;for(;!(s.isLeaf||r&&r(s));)s=s.children[i];return s}findNeighborCornerTileExact(t,r){var i;return(i=this.findNeighborTile(t,s=>r(s)||s.level===this.level))==null?void 0:i.findCorner(zre(t),r)}forAllSubtreeOnSide(t,r){const i=t===Mt.NORTH?[0,1]:t===Mt.NORTH_EAST?[1]:t===Mt.EAST?[1,3]:t===Mt.SOUTH_EAST?[3]:t===Mt.SOUTH?[2,3]:t===Mt.SOUTH_WEST?[2]:t===Mt.WEST?[0,2]:[0],s=n=>{r(n)||n.isLeaf||i.forEach(o=>s(n.children[o]))};s(this)}forallNeighbors(t){i9.forEach(r=>this.findNeighborCornerTileExact(r,t)),Ky.forEach(r=>{var i;return(i=this.findNeighborTile(r,s=>s.level===this.level||t(s)))==null?void 0:i.forAllSubtreeOnSide(r9(r),t)})}getNeighborEdgeStartVertexIndex(t,r){if(!r)return 0;const i=this.level-r.level;if(Ne(!ha||i>=0),i===0)return 0;const s=2**i,n=(1&t)==1,o=n?0:1,a=r.lij[o+1]*s,l=this.lij[o+1],c=l-a,d=n?s-1-c:c;return ha&&(Ne(a<=l&&l<a+s),Ne(0<=d&&d<s)),d}forEachLoadedNeighbor(t){const r=this.level,i=s=>s.level===r||s.isLoaded;Ky.forEach(s=>{const n=this.findNeighborTile(s,i);n!=null&&n!==this&&n.forAllSubtreeOnSide(r9(s),o=>!!o.isLoaded&&(t(o,s),!0))}),i9.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,i))==null?void 0:o.findCorner(zre(s),a=>a.isLoaded);Ne(!n||Hre(this,n,s)),n!=null&&n.isLoaded&&t(n,s)})}getNeighborLIJ(t,r){const i=D1e(r)?-1:$1e(r)?1:0,s=I1e(r)?-1:P1e(r)?1:0,n=[t[0],t[1]+i,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Xl()>=this.surface.extent[1]}compareLIJs(t){const r=this.lij,i=r[0],s=t[0];if(i===s)return[r,t];const n=i-s;if(n<0){const o=2**-n;return[[s,r[1]*o,r[2]*o],t]}{const o=2**n;return[r,[i,t[1]*o,t[2]*o]]}}checkGeometryWaterproofness(){QV&&(Ne(this.isLoaded),this.renderData.checkGeometryWaterproofness())}shouldHaveNeighbor(t){const r=this.extent,i=this.surface.rootTilesExtent,s=.25*(r[2]-r[0]);if(D1e(t)&&r[3]+s>=i[3]||$1e(t)&&r[1]-s<=i[1])return!1;const n=this.surface.isGlobal;return!(!n&&I1e(t)&&r[0]-s<=i[0])&&!(!n&&P1e(t)&&r[2]+s>=i[2])}}function XMt(e,t,r,i){const s=r===xr.ELEVATION?tue.acquire():eue.acquire();return s.init(e,t,r,i),s}function RU(e){e.dispose(),e instanceof w5e?tue.release(e):e instanceof x5e&&eue.release(e)}const eue=new ro(x5e),tue=new ro(w5e),YMt=new cM;var Ec;function ZMt(e,t){const r=e.level,i=t[0];if(r>i)return!1;const s=i-r,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function JMt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function ov(e,t,r){return Math.abs(e-t)<=r}function KMt(e,t,r){if(C(e)||C(t))return!1;if(e.level===0&&t.level===0&&(e.isEastEnd&&t.isWestEnd&&r===Mt.EAST||e.isWestEnd&&t.isEastEnd&&r===Mt.WEST))return!0;const i=Math.max(1e-6*(e.extent[2]-e.extent[0]),1);switch(r){case Mt.NORTH:return ov(e.extent[3],t.extent[1],i);case Mt.SOUTH:return ov(e.extent[1],t.extent[3],i);case Mt.EAST:return ov(e.extent[2],t.extent[0],i)||ov(e.extent[2],-t.extent[0],i);case Mt.WEST:return ov(e.extent[0],t.extent[2],i)||ov(e.extent[0],-t.extent[2],i)}}function Hre(e,t,r){return!C(e)&&!C(t)&&t!==e&&(e.level>=t.level?J1e(e,t,r):J1e(t,e,zre(r)))}function J1e(e,t,r){Ne(e.level>=t.level);const i=vOt(r),s=bOt(r),n=e.extent,o=t.extent,a=[i?n[0]:n[2],s?n[3]:n[1]],l=[i?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),d=ov(a[0],l[0],c)||e.surface.isGlobal&&ov(a[0],-l[0],c),p=ov(a[1],l[1],c);if(d&&p)return!0;if(e.level===t.level||!d&&!p)return Ne(!1),!1;const f=d?K1e(o[1],o[3],n[1],n[3],c):K1e(o[0],o[2],n[0],n[2],c);return Ne(f),f}function K1e(e,t,r,i,s=Xl()){return e-s<=r&&r<=i&&i<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Ec||(Ec={}));class QMt{constructor(){this._scales=ar(-1,-1,-1,-1),this._offsets=ar(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,r,i){this._scales[2*t]=r,this._scales[2*t+1]=i}setOffset(t,r,i){this._offsets[2*t]=r,this._offsets[2*t+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}}function eRt(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(S`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}class rue extends HFe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=$(),this.origin=this.slicePlaneLocalOrigin}}var Lh,Bn;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(Lh||(Lh={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal",e[e.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"}(Bn||(Bn={}));class tRt extends rue{constructor(){super(...arguments),this.identifier=Lh.Material,this.transparent=!1,this.integratedMesh=!1}}class rRt extends rue{constructor(){super(...arguments),this.identifier=Lh.ShadowMap}}class iRt extends rue{constructor(){super(...arguments),this.identifier=Lh.Highlight}}class s9 extends tn{constructor(t,r){super(t,"vec4",Ri.Draw,(i,s,n)=>i.setUniform4fv(t,r(s,n)))}}var Lv;function sRt(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add([new s9("overlayTexOffset",(s,n)=>nRt(s,n)),new s9("overlayTexScale",(s,n)=>oRt(s,n))]),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new Rt("ovColorTex",(s,n)=>qre(s,n))),C5e(e,t)}function C5e(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==kt.Water&&t.pbrMode!==kt.WaterOnIntegratedMesh||e.include(YFe,t);const{vertex:r,fragment:i}=e;e.varyings.add("vtcOverlay","vec4"),r.code.add(S`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(S`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(S`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==kt.Water&&t.pbrMode!==kt.WaterOnIntegratedMesh||(d1(i),F0(i),i.code.add(S`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function qre(e,t){return t.overlays.length===0?null:e.identifier===Lh.Material&&e.subPass===Bn.Color?t.overlays[Us.INNER].getColorTextureNoRasterImage():e.identifier===Lh.Highlight?t.overlays[Us.INNER].getValidTexture(ln.Highlight):null}function nRt(e,t){for(const r of t.overlays){const{index:i,extent:s}=r;TOe(s)>0&&(ZM[2*i]=e.toMapSpace[0]/Ph(s)-s[0]/Ph(s),ZM[2*i+1]=e.toMapSpace[1]/pg(s)-s[1]/pg(s))}return ZM}function oRt(e,t){for(const r of t.overlays){const{index:i,extent:s}=r;TOe(s)>0&&(ZM[2*i]=e.toMapSpace[2]/Ph(s),ZM[2*i+1]=e.toMapSpace[3]/pg(s))}return ZM}(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(Lv||(Lv={}));const ZM=Lr();var Qy;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(Qy||(Qy={}));class aRt extends Zi{constructor(){super(...arguments),this.overlayOpacity=1}}function IU(e,t){e.vertex.uniforms.add([new n9("overlayTexOffset"),new n9("overlayTexScale")]),e.fragment.uniforms.add([new De("overlayOpacity",r=>r.overlayOpacity),new Rt("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[Us.INNER].getColorTexture(r.overlaySource))]),C5e(e,t)}function lRt(e,t){const{vertex:r,fragment:i,varyings:s}=e;s.add("vtc","vec2"),r.uniforms.add(new n9("texOffsetAndScale")),i.uniforms.add(new Q1e("tex")),i.uniforms.add(new aY("textureOpacities"));const n=t.textureFadingEnabled&&!t.renderOccluded;n&&(r.uniforms.add(new n9("nextTexOffsetAndScale")),s.add("nvtc","vec2"),i.uniforms.add(new Q1e("texNext")),i.uniforms.add(new aY("nextTexOpacities")),i.uniforms.add(new cRt("fadeFactor")));const o=t.tileBlendInput===Qy.ColorComposite,a=t.tileBlendInput===Qy.GridComposite;a&&i.include(Kce),o&&i.uniforms.add(new aY("backgroundColor")),r.code.add(S`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${n?S`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:S``}
  }`),i.code.add(S`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?S`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${o?S`vec4(backgroundColor, 1.0)`:S`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:S`return color;`}
    }`),n?i.code.add(S`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(S`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class cRt extends tn{constructor(t){super(t,"float")}}class aY extends tn{constructor(t){super(t,"vec3")}}class n9 extends tn{constructor(t){super(t,"vec4")}}class Q1e extends tn{constructor(t){super(t,"sampler2D")}}class A5e extends aRt{}function uRt(e){const t=new Qr,{vertex:r,fragment:i,varyings:s}=t;t.include(o4),t.include(b4,e),t.include(h0,e);const n=()=>{t.include(nF,e),r.code.add(S`
  vec3 decodeNormalTerrain(vec2 e) {
    float z = 1.0 - abs(e.x) - abs(e.y);
    vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
    return normalize(n);
  }

  vec3 getNormal() {
    return  ${e.shading?S`normalize(decodeNormalTerrain(normalCompressed))`:S`getLocalUp(position, localOrigin)`};
  }
  `)};Dd(r,e),t.include(wu,e);const o=e.overlayMode!==Lv.Disabled;switch(e.output){case V.Color:{t.include(lRt,e),t.include(zE,e);const a=e.overlayMode===Lv.EnabledWithWater;o&&t.include(IU,{...e,pbrMode:kt.Water}),a&&t.include(eRt,e),s.add("vnormal","vec3"),s.add("vpos","vec3"),n(),(e.atmosphere||e.screenSizePerspective)&&nI(r);const l=e.receiveShadows&&!e.renderOccluded;l&&t.include(UI,e),e.atmosphere&&s.add("wnormal","vec3"),e.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),r.code.add(S`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          ${a?S`forwardVertexTangent(vnormal);`:S``}

          ${e.atmosphere?S`
          wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?S`setOverlayVTC(uv);`:""}
          ${e.tileBorders?S`forwardTextureCoordinates();`:""}

          ${e.screenSizePerspective?S`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${l?S`forwardLinearDepth();`:""}

        }
      `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(Rn,e),t.include(zE,e),t.include(T4,e),t.include(BE,e),a&&_g(i,e),S4(i),HI(i),i.uniforms.add([r.uniforms.get("localOrigin"),new er("viewDirection",(c,d)=>xe(ebe,ue(ebe,d.camera.viewMatrix[12],d.camera.viewMatrix[13],d.camera.viewMatrix[14])))]),a&&i.uniforms.add([new Rt("ovWaterTex",(c,d)=>d.overlays.length===0?null:d.overlays[Us.INNER].getNormalTexture(c.overlaySource)),new aNe("view",(c,d)=>Pu(dRt,d.camera.viewMatrix,c.origin))]),i.code.add(S`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),d1(i),F0(i),i.code.add(S`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${e.receiveShadows&&!e.renderOccluded?"readShadowMap(vpos, linearDepth)":e.spherical&&e.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?S`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${e.transparent?S`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
          if (rejectBySlice(vpos)) {
            tileColor *= sliceOpacity;
          }
          ${e.atmosphere?S`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${e.atmosphere?S`atm + tileColor.rgb;`:S`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
          ${a?S`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
          ${e.screenSizePerspective?S`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${e.visualizeNormals?e.spherical?S`
              vec3 localUp = normalize(vpos + localOrigin);
              vec3 right = normalize(cross(vec3(0.0,0.0,1.0),localUp));
              vec3 forward = normalize(cross(localUp,right));
              mat3 tbn = mat3(right, forward, localUp);
              vec3 tNormal = normalize(normal* tbn);
              gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
          `:S`
          vec3 tNormal = normalize(normal);
          gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
      `:""}
          ${e.tileBorders?S`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `)}break;case V.Depth:t.include(IU,e),t.include(r1,e),Rx(t),OE(t),r.code.add(S`
              void main(void) {
                ${o?S`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(S`
              void main() {
                ${o?S`
                  vec4 overlayColor = getCombinedOverlayColor();
                  ${e.transparent?S`if (overlayColor.a == 0.0) { discard; }`:""}`:""}
                outputDepth(linearDepth);
              }
          `);break;case V.Shadow:case V.ShadowHighlight:case V.ShadowExludeHighlight:t.include(r1,e),Rx(t),OE(t),r.code.add(S`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(S`void main() {
outputDepth(linearDepth);
}`);break;case V.Normal:s.add("vnormal","vec3"),nI(r),n(),r.code.add(S`void main(void) {
vec3 normal = getNormal();
gl_Position = transformPosition(proj, view, position);
vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
}`),i.code.add(S`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`);break;case V.Highlight:t.include(IU,e),r.code.add(S`void main() {
setOverlayVTC(getUV0());
gl_Position = transformPosition(proj, view, position);
}`),t.include(_1,e),i.code.add(S`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
discard;
}
outputHighlight();
}`)}return e.output===V.ObjectAndLayerIdColor&&(t.include(IU,{...e,pbrMode:kt.Disabled}),r.code.add(S`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(S`
        void main() {
          vec2 texDim =  ${ff(e,"ovColorTex")};
          gl_FragColor =  ${vu(e,"ovColorTex","vec2(vtcOverlay.x * 0.5, vtcOverlay.y)*texDim")};
        }
    `)),t}const dRt=$e(),ebe=$(),hRt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:A5e,build:uRt},Symbol.toStringTag,{value:"Module"}));class CG extends li{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2,r.spherical=t.viewingMode===Ye.Global}initializeProgram(t){return new ti(t.rctx,CG.shader.get().build(this.configuration),O5e)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Ht({blending:r.renderOccluded?Pf(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA):null,culling:i&&ule,depthTest:!r.renderOccluded&&{func:rs.LESS},depthWrite:!r.renderOccluded&&$u,colorWrite:cr,stencilTest:t?Twt(Cu.IntegratedMeshMaskExcluded):null})}getPipelineState(t,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,r)}}CG.shader=new ei(hRt,()=>re(()=>import("./Terrain.glsl.50978ac6.js"),[]));const O5e=new Map([[M.POSITION,0],[M.UV0,1],[M.NORMALCOMPRESSED,2]]);class pRt{constructor(){this.geometryInfo=new dMt,this.intersectionData=null,this.geometryState=null,this._textureRef=new YM(()=>this.tile.surface.textureFadeDuration),this.overlay=new QMt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._shadingChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(t){this.clear(),this._tile=t;const r=this.geometryInfo;r.indices=null,r.vertexAttributes=null,es(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new _Mt,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(t){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(t),this._geometryStateChangedSinceLastUpdate=!1),ha&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)Ne(this.geometryInfo.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(t,r){var l;const i=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(v(c)&&(t===0&&i.extent[3]>c[3]||t===1&&i.extent[2]>c[2]||t===2&&i.extent[1]<c[1]||t===3&&i.extent[0]<c[0]))return s}const n=i.level,o=Ky[t];if(!r)return Ne(C((l=i.surface)==null?void 0:l.rootTiles)||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),s;if(r.isLoaded){const c=r,d=c.renderData.geometryState,p=n-c.level;if(Ne(p>=0),p===0){const g=d.numVerticesPerSide-1;return Math.max(g,s)}const f=2**p,m=d.neighborData.edgeResolutions[(t+2)%4]/f;return Math.max(1,m)}Ne(!r.isLeaf);let a=s;return r.forAllSubtreeOnSide(r9(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-n)),!0):(Ne(!c.isLeaf),!1))),a}updateNeighborData(){var a,l,c;const t=this.tile;if(!t.intersectsClippingArea)return;const r=t.renderData.geometryState.neighborData,i=d=>(d.isLoaded||d.level===t.level)&&(d==null?void 0:d.intersectsClippingArea),s=r.edgePeerNeighbors,n=r.edgePeerNeighborSamplerVersions;for(let d=0;d<4;++d){const p=t.findNeighborTile(Ky[d],i),f=Tw(t,p),m=(l=(a=f==null?void 0:f.renderData)==null?void 0:a.geometryState.samplerDataVersion)!=null?l:-1,g=s[d],_=f!==Tw(t,g),x=n[d]!==m;s[d]=p,(_||x)&&(n[d]=m,this._markEdgeDirty(d));const b=r.edgeResolutions[d],w=this._calculateEdgeResolution(d,p);Ne(dg(w)),Ne(w>=1),r.edgeResolutions[d]=w,b!==w&&this._markEdgeResolutionDirty(d)}const o=r.cornerPeerNeighbors;for(let d=0;d<4;++d){const p=t.findNeighborTile(i9[d],i);o[d]=p;const f=Tw(t,s[d]),m=Tw(t,s[(d+1)%4]),g=Tw(t,p);qf[d]=g,qf[(d+1)%4]=m,qf[(d+2)%4]=t,qf[(d+3)%4]=f,Ne(qf.some(w=>(w==null?void 0:w.isLoaded)||w===t));const _=qf.reduce((w,T)=>{var E;return Math.min(w,(E=T==null?void 0:T.level)!=null?E:1/0)},1/0);qf.forEach((w,T)=>{(w==null?void 0:w.level)>_&&(qf[T]=null)}),Ne(qf.some(w=>(w==null?void 0:w.isLoaded)||w===t));const x=r.cornerNeighborData[d].cornerTiles,b=r.cornerNeighborData[d].cornerTileSamplerVersions;for(let w=0;w<4;++w){const T=qf[w],E=(c=T==null?void 0:T.renderData.geometryState.samplerDataVersion)!=null?c:-1,O=x[w]!==T,A=!O&&b[w]!==E;(O||A)&&(x[w]=T,b[w]=E,this._markCornerDirty(d))}Ne(x.some(w=>(w==null?void 0:w.isLoaded)||w===t))}ha&&Ne(this.geometryState.neighborData.edgeResolutions.every(d=>d>0));for(let d=0;d<4;++d)qf[d]=null}_updateGeometry(t){if(!this.tile.intersectsClippingArea)return;ha&&Ne(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,s=this.geometryInfo.vertexAttributes,n=!i||!s||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!n&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;n?(this._releaseGeometry(),this._createGeometry(t)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(t,r){return v(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),C(this._texture)&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){v(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(t){const r=1<<t;this._dirtyCorners|=r}_markEdgeDirty(t){const r=1<<t;this._dirtyEdges|=r}_markEdgeResolutionDirty(t){const r=1<<t;this._dirtyEdgeResolutions|=r,this._dirtyEdges|=r}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const t=this._getElevationInfo(),r=this.tile,i=t.samplerData?r.getElevationBasedVerticesPerSide(t.maxTileLevel):r.getDefaultVerticesPerRowOnLevel(),s=Math.max(i,5);let n=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),t.changed&&(this._samplerDataChanged=!0,o.samplerData=t.samplerData,o.samplerDataVersion++,a=!0),Bv(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0);const l=r.surface,c=l.wireframe;o.wireframe!==c&&(this._wireframeChanged=!0,o.wireframe=c,a=!0);const d=l.shading;return o.shading!==d&&(this._shadingChanged=d,o.shading=d,a=d),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(t){this.tile.createGeometry();const r=this.geometryInfo.vertexAttributes,i=this.geometryInfo.indices,s=t.gl;this._vao=new Cf(t,O5e,{geometry:jd(r.layout)},{geometry:Ur.createVertex(t,s.STATIC_DRAW,r.buffer)},Ur.createIndex(t,s.STATIC_DRAW,i)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,fMt(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(t,r=$v.Immediate){v(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,r=this.tile.layerInfo[xr.ELEVATION],i=r.length;let s=new Array(i),n=0,o=0,a=!1;for(let l=0;l<i;l++){const c=r[l];if(v(c.upsampleInfo)){const d=c.upsampleInfo.tile,p=d.layerInfo[xr.ELEVATION][l].data,f=p&&p.samplerData;t&&t[n]===f||(a=!0),s[n++]=f,o=Math.max(o,d.lij[0])}else if(c.data){const d=this.tile.surface.layerViewByIndex(l,xr.ELEVATION);if(yL(this.tile,d.layer,!1)){const p=c.data;t&&t[n]===p.samplerData||(a=!0),s[n++]=p.samplerData,o=this.tile.level}}}return v(t)&&t.length!==n&&(a=!0),n>0?s.length=n:s=null,{changed:a,samplerData:s,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i,s,n;const t=Ch(this.intersectionData,0,o=>o.estimatedMemoryUsage);return((i=(r=this.geometryInfo.indices)==null?void 0:r.byteLength)!=null?i:0)+((n=(s=this.geometryInfo.vertexAttributes)==null?void 0:s.byteLength)!=null?n:0)+t}get textureDescriptor(){return v(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!ha)return;const t=this.tile;if(Ne(t==null?void 0:t.isLoaded),!t.isLoaded||!t.intersectsClippingArea||t.level===0)return;const r=t.surface.extent;if(v(r)&&!t.intersectsExtent(r))return;const i=Ky.map((a,l)=>!!v(r)&&(l<2?-1:1)*(t.extent[3-l]-r[3-l])<0),s=t.level;Ne(this._dirtyCorners===0),Ne(this._dirtyEdges===0),Ne(this._dirtyEdgeResolutions===0),Ne(!this._numVerticesPerSideChanged),Ne(!this._samplerDataChanged),Ne(!this._clippingAreaChanged),Ne(!this._wireframeChanged);const n=i9.map(a=>{var l;return(l=t.findNeighborCornerTileExact(a,c=>!c.intersectsClippingArea||c.isLoaded||c.level===t.level))!=null?l:null}).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=n[a];Ne(c===l,`Tile[${t.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}Ky.forEach((a,l)=>{if(i[l])return;const c=t.findNeighborTile(a,X=>(X.level===s||(X==null?void 0:X.isLoaded))&&(X==null?void 0:X.intersectsClippingArea));if(!c){const X=!t.surface.updatingRootTiles&&v(t.surface.rootTiles)&&t.surface.rootTiles.length>0&&t.shouldHaveNeighbor(a);return void Ne(!X)}Ne(c.isLoaded||c.level===t.level),Ne(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const d=s-c.level;if(!c.isLoaded)return Ne(!c.isLeaf),void Ne(d===0);Ne(KMt(t,c,a)),Ne(d>=0);const p=2**d;if(d<0)return void Ne(!1);const f=t.renderData.geometryInfo,m=f.outerEdges[l],g=f.numVerticesPerSide-1,_=c.renderData.geometryInfo;if(!_)return void Ne(!1);{const X=this.geometryState.neighborData.edgePeerNeighbors[l];((X==null?void 0:X.isLoaded)||X.isLoaded)&&(Ne(X==X),Ne(t.renderData.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===X.renderData.geometryState.samplerDataVersion),Ne(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===X.renderData.geometryState.samplerDataVersion))}const x=(l+2)%4,b=_.outerEdges[x],w=m.count-1,T=b.count-1;Ne(w*p===T,`Tile[${t.lij}]:e${l},res=${w} edgeRes mismatch with Neighbor[${c.lij}]:e${x},res=${T} (expected:${w*p})`);const E=t.extent,O=a===Mt.NORTH||a===Mt.SOUTH,A=b.count-1,R=A/2**d,D=m.count-1;if(R<1)return void Ne(D===1);Ne(R===D),Ne(dg(R));const k=_.numVerticesPerSide-1;Ne(d>0||R===Math.max(k,g));const L=t.getNeighborEdgeStartVertexIndex(l,c);Ne(0<=L&&L<p);const q=L*R;Ne(0<=q&&q<=A-R);let G=0,J=q;m.getVertexPos(Wg,0),m.getVertexPos(Xg,m.count-1);const ee=Ni(Wg,Xg),se=Math.max(fRt,1e-4*ee);for(let X=0;X<=R;++X){m.getVertexPos(Wg,G),b.getVertexPos(Xg,J);const F=X/R,N=O?E[0]+F*(E[2]-E[0]):a===Mt.WEST?E[0]:E[2],B=O?a===Mt.SOUTH?E[1]:E[3]:E[1]+F*(E[3]-E[1]),H=t.surface.extent;if(C(H)||lj(H,N,B)){const W=J9(Wg,Xg),K=Em(Wg)-Pr.radius,Y=Em(Xg)-Pr.radius,ce=W<se;if(!ce){console.warn(`Tile edge vertex position mismatch: between [${t.lij}].edge${l}[${G}/${m.count}] and [${c.lij}].edge${x}[${J}/${b.count}]`),v(H)&&console.warn("  surface extent= ",H," x,y=",N,",",B);const we=$();ge(we,t.renderData.localOrigin,c.renderData.localOrigin),Em(we)>0&&console.warn(`   localOrigins: ${t.renderData.localOrigin} vs ${c.renderData.localOrigin} d=${Em(we)} [${we}]`),(()=>{const Oe=ws(Wg),Be=ws(Xg);t.updateEdgeElevations(),c.updateEdgeElevations(),m.getVertexPos(Wg,G),b.getVertexPos(Xg,J);const He=$();Pc(He,Wg,Oe),Em(He)>0&&console.warn(`  XXX Tile[${t.lij}] edge out of date: ${Oe} vs ${Wg} d=${Em(He)} [${He}]`),Pc(He,Xg,Be),Em(He)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${Be} vs ${Xg} d=${Em(He)} [${He}]`)})(),Ne(ce,`Mismatch in tile [${t.lij}].edge[${l}][${G}/${m.count}] vs neighbor [${c.lij}].edge[${x}][${J}/${b.count}] ${c_(Wg)} vs ${c_(Xg)}  dist=${W} h(t|n|d)=${K}|${Y}|${Y-K}`)}if(t.surface.shading){m.getNormal(hA,G),b.getNormal(pA,J),xe(tbe,hA),xe(rbe,pA);const we=Te(tbe,rbe),Oe=!1,Be=1-we<.01||Oe||t===c;if(!Be){const He=$();Pc(He,hA,pA);const Se=()=>`Mismatch in tile edge normal ${R1e(t.lij)} (${G}/${m.count-1}) edge ${l} vs neighbor ${R1e(c.lij)}  (${J}/${b.count-1}) nedge ${x} :${c_(hA)} vs ${c_(pA)}  dot = ${we} : ${c_(He)}`;console.warn("Mismatch in tile edge normal: ",Se());{t.updateEdgeElevations(),c.updateEdgeElevations();const he=$(),Me=$();m.getNormal(he,G),b.getNormal(Me,J),wx(hA,he)||console.warn("Missing update in tile normal: ",c_(hA)," => ",c_(he)),wx(pA,Me)||console.warn("Missing update in neighbor normal: ",c_(pA)," => ",c_(Me))}Ne(Be,Se())}}}G+=1,J+=1}})}}const Wg=$(),Xg=$(),hA=$(),pA=$(),tbe=$(),rbe=$(),fRt=1,qf=[null,null,null,null];function Tw(e,t){return(t==null?void 0:t.isLoaded)||t===e?t:null}const mRt=65536;function gRt(e,t){const r=e.tile,{extent:i,extentInRadians:s,surface:n}=r,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=n.shading||HE,d=a.numVerticesPerSide,p=d-1,f=(d-2)**2,m=l&&(t===Kp.HAS_SOUTH_POLE||t===Kp.HAS_BOTH_POLES),g=l&&(t===Kp.HAS_NORTH_POLE||t===Kp.HAS_BOTH_POLES),_=6,x=((m?1:0)+(g?1:0))*_*(p+1),b=a.neighborData,w=b.edgeResolutions.reduce((D,k)=>D+k+1,0),T=_5e(f+x+w),E=e.geometryInfo;E.numVerticesPerSide=a.numVerticesPerSide,E.vertexAttributes=T;const O=E.boundingBox;es(O);const A=iue(e);Jn.update(p,s,A),yRt(e),F5e(e,f),M5e(e);const R=[];if((()=>{let D=f+w;const k=o[0],L=o[1],q=o[2],G=r.ellipsoid.radius,J=i[1],ee=i[3],se=(X,F)=>{const N=F*d;$c(-k,-L,X*G-q,O),R.push({connectedRowOffset:N,connectedOuterEdgeOffset:X===1?0:2,rowOffset:D,latitudeResolution:_});const B=P5e(X===-1?J:ee,G),H=X*Math.PI/2-B,W=.99*(X===1?1:-1),K=G+0,Y=T.position,ce=T.uv0,we=T.normalCompressed;for(let Oe=1;Oe<=_;++Oe){const Be=B+H*(Oe/_),He=Math.cos(Be),Se=Math.sin(Be);for(let he=0;he<=p;he++){const Me=he/p,Xt=Jn.sinLonLUT[he],Er=Jn.cosLonLUT[he]*He,Cr=Xt*He,bt=Se,ht=Er*K-k,rr=Cr*K-L,yr=bt*K-q;$c(ht,rr,yr,O),Y.setValues(D,ht,rr,yr),Ld(ce,D,Me,W),c&&mF(we,D,Er,Cr,bt),++D}}};m&&se(-1,0),g&&se(1,p)})(),N5e(E,a.numVerticesPerSide,R,[0,d-1],[0,d-1],a.wireframe),e.intersectionData=null,ha)for(let D=0;D<4;++D)Ne(E.outerEdges[D].count===b.edgeResolutions[D]+1)}function yRt(e){const t=e.tile;t.intersectsClippingArea&&(t.surface.shading||HE?vRt(e):_Rt(e))}function _Rt(e){const t=e.geometryState,r=t.numVerticesPerSide,i=r-2,s=r-1,n=e.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=e.tile,d=c.extent,p=d[0],f=d[2],m=d[1],g=d[3],_=c.ellipsoid.radius,x=t.samplerData,b=e.localOrigin,w=b[0],T=b[1],E=b[2],O=n.boundingBox,A=a.typedBuffer,R=a.typedBufferStride;let D=0;for(let k=1;k<=i;k++){const L=k/s,q=m*(1-L)+g*L,G=Jn.sinLatLUT[k],J=Jn.cosLatLUT[k];for(let ee=1;ee<=i;ee++){const se=ee/s,X=p*(1-se)+f*se,F=Jn.sinLonLUT[ee],N=Jn.cosLonLUT[ee],B=_+vs(X,q,x),H=N*J*B-w,W=F*J*B-T,K=G*B-E;$c(H,W,K,O);const Y=D*R;A[Y+0]=H,A[Y+1]=W,A[Y+2]=K,Ld(l,D,se,L),++D}}}function vRt(e){const t=e.geometryState,r=t.numVerticesPerSide,i=r-2,s=r-1,n=e.geometryInfo,o=n.vertexAttributes,a=o.position,l=o.uv0,c=o.normalCompressed,d=e.tile,p=d.extent,f=p[0],m=p[2],g=p[1],_=p[3],x=d.ellipsoid.radius,b=t.samplerData,w=e.localOrigin,T=w[0],E=w[1],O=w[2],A=a.typedBuffer,R=a.typedBufferStride,D=1/s,k=n.boundingBox;let L=0;if(1<=i){const q=D,G=g*(1-q)+_*q,J=Jn.sinLatLUT[1],ee=Jn.cosLatLUT[1];for(let se=1;se<=i;se++){const X=se*D,F=f*(1-X)+m*X,N=Jn.sinLonLUT[se],B=Jn.cosLonLUT[se],H=x+vs(F,G,b),W=H*B*ee-T,K=H*N*ee-E,Y=H*J-O;$c(W,K,Y,k);const ce=(se-1)*R;A[ce+0]=W,A[ce+1]=K,A[ce+2]=Y,Ld(l,se-1,X,q)}}for(let q=1;q<=i;q++){const G=q*D,J=g*(1-G)+_*G,ee=Jn.sinLatLUT[q],se=Jn.cosLatLUT[q],X=q+1,F=X*D,N=g*(1-F)+_*F,B=Jn.sinLatLUT[X],H=Jn.cosLatLUT[X],W=Jn.sinLonLUT[0],K=Jn.cosLonLUT[0],Y=x+vs(f,J,b);let ce=K*se*Y-T,we=W*se*Y-E,Oe=ee*Y-O;const Be=L*R;let He=A[Be+0],Se=A[Be+1],he=A[Be+2];for(let Me=1;Me<=i;Me++){const Xt=Me*D,Er=f*(1-Xt)+m*Xt,Cr=Jn.sinLonLUT[Me],bt=Jn.cosLonLUT[Me],ht=bt*se,rr=Cr*se,yr=ee;let Ui=0,it=0,ur=0;{let zr=0,ir=0,Nr=0;if(Me<i){const Hr=(L+1)*R;zr=A[Hr+0],ir=A[Hr+1],Nr=A[Hr+2]}else{const Hr=Jn.sinLonLUT[s],is=Jn.cosLonLUT[s],Es=x+vs(m,J,b);zr=is*se*Es-T,ir=Hr*se*Es-E,Nr=ee*Es-O}const _t=ce,ft=we,Bt=Oe;ce=He,we=Se,Oe=he,He=zr,Se=ir,he=Nr;const Ar=zr-_t,Fr=ir-ft,_r=Nr-Bt,Or=Fr*yr-_r*rr,sr=_r*ht-Ar*yr,gi=Ar*rr-Fr*ht;Ui=sr*_r-gi*Fr,it=gi*Ar-Or*_r,ur=Or*Fr-sr*Ar}{let zr=0,ir=0,Nr=0;if(q>1){const _t=(L-i)*R;zr=A[_t+0],ir=A[_t+1],Nr=A[_t+2]}else{const _t=Jn.sinLatLUT[0],ft=Jn.cosLatLUT[0],Bt=x+vs(Er,g,b);zr=bt*ft*Bt-T,ir=Cr*ft*Bt-E,Nr=_t*Bt-O}{const _t=x+vs(Er,N,b),ft=bt*H*_t-T,Bt=Cr*H*_t-E,Ar=B*_t-O;if(q<i){const is=L+i,Es=is*R;A[Es+0]=ft,A[Es+1]=Bt,A[Es+2]=Ar,$c(ft,Bt,Ar,k),Ld(l,is,Xt,F)}const Fr=zr-ft,_r=ir-Bt,Or=Nr-Ar,sr=_r*yr-Or*rr,gi=Or*ht-Fr*yr,Hr=Fr*rr-_r*ht;Ui+=gi*Or-Hr*_r,it+=Hr*Fr-sr*Or,ur+=sr*_r-gi*Fr}}const mi=1/Math.sqrt(Ui*Ui+it*it+ur*ur);mF(c,L,Ui*mi,it*mi,ur*mi),++L}}}function bRt(e){e.tile.intersectsClippingArea&&(M5e(e),AG(e))}function wRt(e){e.tile.intersectsClippingArea&&(I5e(e),R5e(e,!0),AG(e))}function M5e(e){e.tile.intersectsClippingArea&&(I5e(e),R5e(e))}function R5e(e,t=!1){const r=e.geometryState,i=e.geometryInfo,s=r.neighborData,n=e.tile,o=n.level,a=n.extent,l=n.ellipsoid.radius,c=n.extentInRadians,d=c[0],p=c[2],f=c[1],m=c[3],g=r.samplerData,_=a[0],x=a[2],b=a[1],w=a[3],T=iue(e),E=i.boundingBox,O=e.localOrigin,A=O[0],R=O[1],D=O[2],k=n.surface.shading||HE,L=i.vertexAttributes,q=L.position,G=q.typedBuffer,J=q.typedBufferStride,ee=L.uv0;for(let se=0;se<4;++se){const X=se===1||se===3,F=s.edgeResolutions[se];Ne(dg(F));const N=F+1,B=Tw(n,s.edgePeerNeighbors[se]);if(B5e(n,B,se)){k5e(e,se);continue}const H=v(B);Ne(!H||B.level===n.level),Ne(!H||Dv(n,B)<=0);const W=B==null?void 0:B.renderData,K=W==null?void 0:W.geometryState;if(ha){const _t=n.surface;if(!B&&_t&&!_t.updatingRootTiles){const ft=Ky[se],Bt=n.findNeighborTile(ft,Ar=>Ar.isLoaded||Ar.isLeaf||Ar.level===n.level);Bt?Bt.intersectsClippingArea&&(Ne(!Bt.isLoaded),Ne(!Bt.isLeaf),Ne(Bt.level===o)):Ne(C(_t==null?void 0:_t.rootTiles)||!n.shouldHaveNeighbor(ft))}}const Y=se===1?a[2]:a[0],ce=B==null?void 0:B.extent,we=H&&X?se===1?ce[0]:ce[2]:Y,Oe=se===0?a[3]:a[1],Be=se===1?1:0,He=se===0?1:0,Se=se===1?p:d,he=se===0?m:f,Me=Math.sin(Se),Xt=Math.cos(Se),Er=Math.sin(he),Cr=Math.cos(he),bt=K==null?void 0:K.samplerData,ht=(_t,ft,Bt)=>vs(_t,ft,g),rr=(_t,ft,Bt)=>.5*(vs(_t,ft,g)+vs(Bt,ft,bt)),yr=H?rr:ht,Ui=i.outerEdges[se],it=t&&N>3?N-3:1,ur=v(g)&&g.some(_t=>_t!=null),mi=v(bt)&&bt.some(_t=>_t!=null),zr=ur||mi,ir=1/F,Nr=Ui.index0;k?(Ne(!H||_Ot(ce[2]-ce[0],a[2]-a[0])),(()=>{const _t=se===1?-1:se===3?1:0,ft=se===0?-1:se===2?1:0,Bt=(a[2]-a[0])*ir,Ar=_t*Bt,Fr=ft*Bt,_r=X?_t*((p-d)*ir):0,Or=X?0:ft*ir,sr=He,gi=X?Se+_r:Se,Hr=X?Math.sin(gi):Me,is=X?Math.cos(gi):Xt,Es=X?Se-_r:Se,Co=X?Math.sin(Es):Me,Wo=X?Math.cos(Es):Xt,co=X?he:T(sr+Or),Nu=X?Er:Math.sin(co),kc=X?Cr:Math.cos(co),Xo=X?he:T(sr-Or),Ao=X?Er:Math.sin(Xo),Ls=X?Cr:Math.cos(Xo),qs=(Nr+0)*J;let Vr=G[qs+0]+A,Bi=G[qs+1]+R,Dn=G[qs+2]+D,Ws=0,uo=0,Uc=0;{const oe=1*ir,ss=X?Y:_*(1-oe)+x*oe,Tg=X?we:ss,Jl=X?b*(1-oe)+w*oe:Oe,G0=X?Se:d*(1-oe)+p*oe,gt=X?Me:Math.sin(G0),H0=X?Xt:Math.cos(G0),gn=X?T(oe):he,Nf=X?Math.sin(gn):Er,x1=X?Math.cos(gn):Cr,Bc=l+yr(ss,Jl,Tg);Ws=H0*x1*Bc,uo=gt*x1*Bc,Uc=Nf*Bc}for(let oe=1;oe<N-1;oe+=it){let ss=0,Tg=0,Jl=0;{const Fu=(Nr+oe+1)*J;if(oe<N-2){const Si=(oe+1)*ir,ap=X?Y:_*(1-Si)+x*Si,lp=X?we:ap,ya=X?b*(1-Si)+w*Si:Oe,zc=X?Se:d*(1-Si)+p*Si,Eg=X?Me:Math.sin(zc),W0=X?Xt:Math.cos(zc),Cg=X?T(Si):he,Yo=X?Math.sin(Cg):Er,sT=X?Math.cos(Cg):Cr,C1=l+yr(ap,ya,lp);ss=W0*sT*C1,Tg=Eg*sT*C1,Jl=Yo*C1}else ss=G[Fu+0]+A,Tg=G[Fu+1]+R,Jl=G[Fu+2]+D}const G0=ss,gt=Tg,H0=Jl,gn=Ws,Nf=uo,x1=Uc;Ws=G0,uo=gt,Uc=H0;{const Fu=Nr+oe,Si=Fu*J,ap=gn-A,lp=Nf-R,ya=x1-D;G[Si+0]=ap,G[Si+1]=lp,G[Si+2]=ya,$c(ap,lp,ya,E);const zc=oe*ir;Ld(ee,Fu,X?Be:zc,X?zc:He)}const Bc=Vr,I4=Bi,P4=Dn;Vr=gn,Bi=Nf,Dn=x1;const Jt=gn,T1=Nf,q0=x1;let S1=0,E1=0,Sg=0;if(zr){const Fu=1/Math.sqrt(Jt*Jt+T1*T1+q0*q0),Si=Jt*Fu,ap=T1*Fu,lp=q0*Fu;{const ya=G0-Bc,zc=gt-I4,Eg=H0-P4,W0=zc*lp-Eg*ap,Cg=Eg*Si-ya*lp,Yo=ya*ap-zc*Si;S1+=Cg*Eg-Yo*zc,E1+=Yo*ya-W0*Eg,Sg+=W0*zc-Cg*ya}{const ya=oe*ir,zc=X?Y:_*(1-ya)+x*ya,Eg=X?we:zc,W0=X?b*(1-ya)+w*ya:Oe,Cg=X?Se:d*(1-ya)+p*ya,Yo=X?Me:Math.sin(Cg),sT=X?Xt:Math.cos(Cg),C1=X?T(ya):he,Z=X?Math.sin(C1):Er,ve=X?Math.cos(C1):Cr;let Pe=Jt,$r=T1,Oo=q0;if(H){const ns=l+vs(Eg-Ar,W0-Fr,bt),Ya=X?ve:Ls;Pe=(X?Wo:sT)*Ya*ns,$r=(X?Co:Yo)*Ya*ns,Oo=(X?Z:Ao)*ns}{const ns=l+vs(zc+Ar,W0+Fr,g),Ya=X?ve:kc,nT=(X?is:sT)*Ya*ns,$ue=(X?Hr:Yo)*Ya*ns,Due=(X?Z:Nu)*ns;H||(Pe=2*Jt-nT,$r=2*T1-$ue,Oo=2*q0-Due);const $4=Pe-nT,D4=$r-$ue,L4=Oo-Due,Lue=D4*lp-L4*ap,Nue=L4*Si-$4*lp,Fue=$4*ap-D4*Si;S1+=Nue*L4-Fue*D4,E1+=Fue*$4-Lue*L4,Sg+=Lue*D4-Nue*$4}}}else S1=Jt,E1=T1,Sg=q0;const ZI=1/Math.sqrt(S1*S1+E1*E1+Sg*Sg);Ui.setNormalFromValues(oe,S1*ZI,E1*ZI,Sg*ZI)}})()):(()=>{for(let _t=1;_t<N-1;_t+=it){const ft=_t*ir,Bt=X?Be:ft,Ar=X?ft:He,Fr=X?Y:_*(1-ft)+x*ft,_r=X?b*(1-ft)+w*ft:Oe,Or=X?we:Fr,sr=X?Se:d*(1-ft)+p*ft,gi=X?Me:Math.sin(sr),Hr=X?Xt:Math.cos(sr),is=X?T(ft):he,Es=X?Math.sin(is):Er,Co=X?Math.cos(is):Cr,Wo=yr(Fr,_r,Or),co=l+Wo,Nu=Hr*Co*co-A,kc=gi*Co*co-R,Xo=Es*co-D;$c(Nu,kc,Xo,E);const Ao=Nr+_t,Ls=Ao*J;G[Ls+0]=Nu,G[Ls+1]=kc,G[Ls+2]=Xo,Ld(ee,Ao,Bt,Ar)}})()}}function I5e(e){U5e(e)}function P5e(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function xRt(e,t,r,i){return P5e(e*(1-i)+t*i,r)}function TRt(e,t,r){return e*(1-r)+t*r}function iue(e){const t=e.tile;if(t.surface.isWebMercator){const i=t.extent,s=t.ellipsoid.radius;return n=>xRt(i[1],i[3],s,n)}const r=t.extentInRadians;return i=>TRt(r[1],r[3],i)}function SRt(e,t){const r=e.tile.extent,i=e.geometryState,s=r[0],n=r[1],o=r[2]-s,a=r[3]-n,l=i.clippingArea,c=v(l)?Math.max(0,(l[0]-s)/o):0,d=v(l)?Math.max(0,(l[1]-n)/a):0,p=v(l)?Math.min(1,(l[2]-s)/o):1,f=v(l)?Math.min(1,(l[3]-n)/a):1,m=i.numVerticesPerSide,g=(m-2)**2,_=i.neighborData.edgeResolutions.reduce((T,E)=>T+E+1,0),x=_5e(g+_),b=e.geometryInfo,w=b.boundingBox;es(w),b.numVerticesPerSide=i.numVerticesPerSide,b.vertexAttributes=x,Oi(b.uvRange,c,d,p,f),ERt(e),F5e(e,g),$5e(e),N5e(b,i.numVerticesPerSide,[],[0,m-1],[0,m-1],i.wireframe),e.intersectionData=null}function ERt(e){const t=e.tile;t.intersectsClippingArea&&(t.surface.shading?ARt(e):CRt(e))}function CRt(e){const t=e.geometryState,r=t.samplerData,i=e.tile,s=i.surface,n=e.localOrigin,o=s.isWebMercatorOnPlateeCarree,a=t.clippingArea,l=v(a)?a:OG,c=i.extent,d=c[0],p=c[1],f=c[2],m=c[3],g=Math.max(d,l[0]),_=Math.min(f,l[2]),x=Math.max(p,l[1]),b=Math.min(m,l[3]),w=n[0],T=n[1],E=n[2],O=i.ellipsoid.radius,A=i.horizontalScale,R=sue(o,O,A),D=t.numVerticesPerSide,k=D-1,L=D-2,q=e.geometryInfo,G=q.uvRange,J=G[0],ee=G[1],se=G[2],X=G[3],F=q.boundingBox,N=q.vertexAttributes,B=N.position,H=N.uv0;let W=0;for(let K=1;K<=L;K++){const Y=K/k,ce=_e(p*(1-Y)+m*Y,x,b),we=_e(Y,ee,X),Oe=R(ce)-T;for(let Be=1;Be<=L;Be++){const He=Be/k,Se=_e(d*(1-He)+f*He,g,_),he=_e(He,J,se),Me=Se*A-w,Xt=vs(Se,ce,r)-E;$c(Me,Oe,Xt,F),B.setValues(W,Me,Oe,Xt),Ld(H,W,he,we),++W}}}function ARt(e){const t=e.tile,r=t.surface;if(!(r.shading||HE))return;const i=e.geometryState,s=i.samplerData,n=e.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=v(a)?a:OG,c=t.extent,d=c[0],p=c[1],f=c[2],m=c[3],g=Math.max(d,l[0]),_=Math.min(f,l[2]),x=Math.max(p,l[1]),b=Math.min(m,l[3]),w=t.ellipsoid.radius,T=t.horizontalScale,E=i.numVerticesPerSide,O=E-1,A=E-2,R=e.geometryInfo,D=R.vertexAttributes,k=D.position,L=D.uv0,q=D.normalCompressed,G=R.uvRange,J=G[0],ee=G[1],se=G[2],X=G[3],F=R.boundingBox,N=n[0],B=n[1],H=n[2],W=k.typedBuffer,K=k.typedBufferStride;let Y=0;const ce=_e(p,x,b),we=o?(Math.PI/2-2*Math.atan(Math.exp(-ce/w)))*w:ce*T,Oe=1/O,Be=_e(p*(1-Oe)+m*Oe,x,b);let He=we,Se=o?(Math.PI/2-2*Math.atan(Math.exp(-Be/w)))*w:Be*T;for(let he=1;he<=A;he++){const Me=he/O,Xt=_e(p*(1-Me)+m*Me,x,b),Er=_e(Me,ee,X),Cr=Se,bt=(he-1)/O,ht=_e(p*(1-bt)+m*bt,x,b),rr=He,yr=(he+1)/O,Ui=_e(p*(1-yr)+m*yr,x,b),it=o?(Math.PI/2-2*Math.atan(Math.exp(-Ui/w)))*w:Ui*T,ur=_e(yr,ee,X);He=Se,Se=it;const mi=_e(d,g,_);let zr=mi*T,ir=vs(mi,Xt,s);const Nr=1/O,_t=_e(Nr,J,se),ft=_e(d*(1-_t)+f*_t,g,_);let Bt=_t,Ar=ft,Fr=ft*T,_r=vs(ft,Xt,s);if(he===1){const Or=Fr-N,sr=He-B,gi=_r-H,Hr=0*K;W[Hr+0]=Or,W[Hr+1]=sr,W[Hr+2]=gi,$c(Or,sr,gi,F);const is=_e(Nr,J,se);Ld(L,Y,is,Er)}for(let Or=1;Or<=A;Or++){const sr=Fr,gi=_r,Hr=(Or+1)/O,is=_e(Hr,J,se),Es=_e(d*(1-Hr)+f*Hr,g,_),Co=Ar;Ar=Es;{const qs=Y+1,Vr=qs*K;if(he===1||Or===A){const Bi=Es*T,Dn=Cr,Ws=vs(Es,Xt,s);if(he===1&&Or<A){const uo=Bi-N,Uc=Dn-B,oe=Ws-H;W[Vr+0]=uo,W[Vr+1]=Uc,W[Vr+2]=oe,$c(uo,Uc,oe,F),Ld(L,qs,is,Er)}Fr=Bi,_r=Ws}else Fr=W[Vr+0]+N,_r=W[Vr+2]+H}const Wo=Fr,co=_r,Nu=zr,kc=ir;zr=sr,ir=gi;const Xo=(Y-A)*K,Ao=he===1?vs(Co,ht,s):W[Xo+2]+H,Ls=vs(Co,Ui,s);if(he<A){const qs=Y+A,Vr=qs*K,Bi=sr-N,Dn=it-B,Ws=Ls-H;W[Vr+0]=Bi,W[Vr+1]=Dn,W[Vr+2]=Ws,$c(Bi,Dn,Ws,F);const uo=Bt;Bt=is,Ld(L,qs,uo,ur)}{const qs=Wo-Nu,Vr=-qs*(co-kc),Bi=rr-it,Dn=-Bi*(Ao-Ls),Ws=qs*qs+Bi*Bi,uo=Vr*Vr+Dn*Dn+Ws*Ws;if(uo===0)mF(q,Y,0,0,1);else{const Uc=1/Math.sqrt(uo);mF(q,Y,Vr*Uc,Dn*Uc,Ws*Uc)}}++Y}}}function ORt(e,t){e.tile.intersectsClippingArea&&(L5e(e),D5e(e,!0),AG(e))}function MRt(e,t){e.tile.intersectsClippingArea&&($5e(e),AG(e))}function $5e(e,t){e.tile.intersectsClippingArea&&(L5e(e),D5e(e,!1))}function D5e(e,t){const r=e.geometryState,i=r.neighborData,s=e.tile,n=s.surface,o=n.shading||HE,a=s.extent,l=r.clippingArea,c=v(l)?l:OG,d=a[0],p=a[2],f=a[1],m=a[3],g=[m>c[3],p>c[2],f<c[1],d<c[0]],_=e.geometryInfo,x=s.horizontalScale,b=sue(n.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,x),w=_.boundingBox,T=_.uvRange[0],E=_.uvRange[1],O=_.uvRange[2],A=_.uvRange[3],R=Math.max(d,c[0]),D=Math.min(p,c[2]),k=Math.max(f,c[1]),L=Math.min(m,c[3]),q=e.localOrigin,G=q[0],J=q[1],ee=q[2],se=r.samplerData;for(let X=0;X<4;++X){const F=X===1||X===3,N=i.edgeResolutions[X];Ne(dg(N));const B=N+1,H=g[X],W=Tw(s,i.edgePeerNeighbors[X]);if(!H&&B5e(s,W,X)){k5e(e,X);continue}const K=v(W)&&!H,Y=W==null?void 0:W.renderData,ce=Y==null?void 0:Y.geometryState;if(ha&&(Ne(!K||W.level===s.level),Ne(!K||Dv(s,W)<=0),s&&!W&&!n.updatingRootTiles)){const bt=Ky[X],ht=s.findNeighborTile(bt,rr=>rr.isLoaded||rr.isLeaf||rr.level===s.level);n.updatingRootTiles||(ht?ht.intersectsClippingArea&&(Ne(!ht.isLoaded),Ne(!ht.isLeaf),Ne(ht.level===s.level)):Ne(C(n==null?void 0:n.rootTiles)||!s.shouldHaveNeighbor(bt)))}const we=_e(X===1?p:d,R,D),Oe=_e(X===0?m:f,k,L),Be=ce==null?void 0:ce.samplerData,He=_.outerEdges[X],Se=t&&B>3?B-3:1,he=_e(X===1?1:0,T,O),Me=_e(X===0?1:0,E,A),Xt=(bt,ht)=>vs(bt,ht,se),Er=(bt,ht)=>.5*(vs(bt,ht,Be)+vs(bt,ht,se)),Cr=K?Er:Xt;if(o){const bt=(p-d)/N,ht=F?X===1?bt:-bt:0,rr=F?0:X===0?bt:-bt,yr=-ht,Ui=-rr,it=He.attributes.position.typedBuffer,ur=He.attributes.position.typedBufferStride,mi=He.index0,zr=He.stride,ir=mi*ur;let Nr=it[ir+0]+G,_t=it[ir+1]+J,ft=it[ir+2]+ee,Bt=0,Ar=0,Fr=0;{const _r=1/N,Or=F?we:_e(d*(1-_r)+p*_r,R,D),sr=F?_e(f*(1-_r)+m*_r,k,L):Oe,gi=Cr(Or,sr),Hr=Or*x,is=b(sr);Bt=Hr,Ar=is,Fr=gi}for(let _r=1;_r<B-1;_r+=Se){const Or=_r/N,sr=Bt,gi=Ar,Hr=Fr;{const Vr=F?he:_e(Or,T,O),Bi=F?_e(Or,E,A):Me,Dn=sr-G,Ws=gi-J,uo=Hr-ee;$c(sr,Ws,uo,w),He.setVertexFromValuesRawPositionUV(_r,Dn,Ws,uo,Vr,Bi)}const is=_r+1;if(_r===B-1){const Vr=(mi+is*zr)*ur;Bt=it[Vr+0]+G,Ar=it[Vr+1]+J,Fr=it[Vr+2]+ee}else{const Vr=is/N,Bi=F?we:_e(d*(1-Vr)+p*Vr,R,D),Dn=F?_e(f*(1-Vr)+m*Vr,k,L):Oe,Ws=Cr(Bi,Dn);Bt=Bi*x,Ar=b(Dn),Fr=Ws}const Es=Bt,Co=Ar,Wo=Fr,co=Nr,Nu=_t,kc=ft;Nr=sr,_t=gi,ft=Hr;let Xo=0,Ao=0,Ls=0;if(F){{const Vr=Co-gi,Bi=Nu-gi;Ao-=Bi*(kc-Hr)+Vr*(Wo-Hr),Ls+=Bi*Bi+Vr*Vr}{const Vr=_e(f*(1-Or)+m*Or,k,L),Bi=we+yr,Dn=Bi*x-sr;if(Xo-=Dn*(vs(Bi,Vr,se)-Hr),Ls+=Dn*Dn,K){const Ws=we+ht,uo=Ws*x-sr;Xo-=uo*(vs(Ws,Vr,Be)-Hr),Ls+=uo*uo}}}else{{const Vr=Es-sr,Bi=co-sr;Xo-=Vr*(Wo-Hr)+Bi*(kc-Hr),Ls+=Vr*Vr+Bi*Bi}{const Vr=_e(d*(1-Or)+p*Or,R,D),Bi=Oe+Ui,Dn=vs(Vr,Bi,se)-Hr,Ws=b(Bi)-gi;if(Ao-=Ws*Dn,Ls+=Ws*Ws,K){const uo=Vr,Uc=Oe+rr,oe=b(Uc)-gi;Ao-=oe*(vs(uo,Uc,Be)-Hr),Ls+=oe*oe}}}const qs=1/Math.sqrt(Xo*Xo+Ao*Ao+Ls*Ls);He.setNormalFromValues(_r,Xo*qs,Ao*qs,Ls*qs)}}else for(let bt=1;bt<B-1;bt+=Se){const ht=bt/N,rr=F?we:_e(d*(1-ht)+p*ht,R,D),yr=F?_e(f*(1-ht)+m*ht,k,L):Oe,Ui=F?he:_e(ht,T,O),it=F?_e(ht,E,A):Me,ur=Cr(rr,yr),mi=rr*x-G,zr=b(yr)-J,ir=ur-ee;$c(mi,zr,ir,w),He.setVertexFromValuesRawPositionUV(bt,mi,zr,ir,Ui,it)}}}function L5e(e,t){U5e(e)}function RRt(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function IRt(e,t){return e*t}function sue(e,t,r){return e?i=>RRt(i,t):i=>IRt(i,r)}function N5e(e,t,r,i,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,i[1])-Math.max(1,i[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=Ky.map((w,T)=>T===0&&s[1]<t-2||T===1&&i[1]<t-2||T===2&&s[0]>1||T===3&&i[0]>1),d=e.outerEdges.reduce((w,T,E)=>w+(c[E]?0:o-2+T.count-1),0),p=r.reduce((w,T)=>w+o*(2*(T.latitudeResolution-1)+1),0),f=n?2:1,m=3*(l+d+p)*f,g=a>=mRt?new Uint32Array(m):new Uint16Array(m);let _=0;const x=t-2,b=o-2;if(Ne(b>=0),n){const w=(E,O,A)=>{g[_++]=E,g[_++]=O,g[_++]=O,g[_++]=A,g[_++]=A,g[_++]=E,ha&&(Ne(E<a),Ne(O<a),Ne(A<a),Ne(_<=m))};(()=>{for(let E=Math.max(s[0],1)-1;E<Math.min(s[1],t-2)-1;++E)for(let O=Math.max(i[0],1)-1;O<Math.min(i[1],t-2)-1;++O){const A=E*x+O,R=A+1,D=R+x,k=D-1;w(A,R,D),w(D,k,A)}})(),Ne(_===3*l*f),(()=>{for(let E=0;E<4;++E){const O=_;if(c[E])continue;const A=e.outerEdges[E],R=e.innerEdges[E];let D=0,k=0;const L=A.count,q=R.count;Ne(q===o-1);let G=0;const J=E===1||E===2?(ee,se,X)=>w(ee,se,X):(ee,se,X)=>w(ee,X,se);for(;D<L-1||k<q-1;){const ee=R.getVertexIndex(k),se=A.getVertexIndex(D),X=D<L-1,F=k<q-1,N=X?0+o*(D+.5)/(L-1):0,B=F?1+b*(k+.5)/(q-1):0;X&&(!F||N<=B)?(++D,ha&&Ne(D<L),J(ee,se,A.getVertexIndex(D)),G++):(++k,ha&&Ne(k<q),J(ee,se,R.getVertexIndex(k)),G++)}ha&&(Ne(D===L-1),Ne(k===q-1),Ne(G===L+q-2),Ne(G===o-2+A.count-1),Ne(_===O+3*G*f))}})(),Ne(_===3*(l+d)*f);const T=E=>{const O=e.outerEdges[E.connectedOuterEdgeOffset];let A=O.getVertexIndex(0),R=O.stride;for(let D=0;D<E.latitudeResolution;++D){const k=D===0?E.rowOffset:A+t;for(let L=0;L<o;L++)w(A,A+1,k+L),D<E.latitudeResolution-1&&w(A+1,k+L+1,k+L),A+=R;A=k,R=1}};r.forEach(T)}else{(()=>{const T=Math.max(s[0],1)-1,E=Math.min(s[1],t-2)-1,O=Math.max(i[0],1)-1,A=Math.min(i[1],t-2)-1;for(let R=T;R<E;++R){const D=R*x;for(let k=O;k<A;++k){const L=D+k,q=L+1,G=q+x,J=G-1;g[_+0]=L,g[_+1]=q,g[_+2]=G,g[_+3]=G,g[_+4]=J,g[_+5]=L,_+=6}}})(),Ne(_===3*l*f),(()=>{for(let T=0;T<4;++T){if(c[T])continue;const E=e.outerEdges[T],O=e.innerEdges[T];let A=0,R=0;const D=E.count,k=O.count;Ne(k===o-1);const L=T===1||T===2,q=L?1:2,G=L?2:1,J=E.index0,ee=E.stride,se=O.index0,X=O.stride;for(;A<D-1||R<k-1;){const F=se+R*X,N=J+A*ee,B=A<D-1,H=R<k-1,W=B?0+o*(A+.5)/(D-1):0,K=H?1+b*(R+.5)/(k-1):0,Y=B&&(!H||W<=K);Y?++A:++R;const ce=Y?N+ee:F+X;g[_+0]=F,g[_+q]=N,g[_+G]=ce,_+=3}}})(),Ne(_===3*(l+d)*f);const w=T=>{const E=e.outerEdges[T.connectedOuterEdgeOffset];let O=E.getVertexIndex(0),A=E.stride;for(let R=0;R<T.latitudeResolution;++R){const D=R===0?T.rowOffset:O+t;for(let k=0;k<o;k++){const L=D+k;g[_+0]=O,g[_+1]=O+1,g[_+2]=L,R<T.latitudeResolution-1?(g[_+3]=O+1,g[_+4]=L+1,g[_+5]=L,_+=6):_+=3,O+=A}O=D,A=1}};r.forEach(w)}Ne(_===m),e.indices=g,e.indexCount=m}function F5e(e,t){const r=e.localOrigin,i=e.geometryInfo,s=e.geometryState.neighborData.edgeResolutions,n=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=t;for(let l=0;l<4;++l){{const c=l===0||l===2,d=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);i.innerEdges[l]=new j1e(o,r,d,p,n)}{const c=a,d=s[l]+1;i.outerEdges[l]=new j1e(o,r,c,1,d),a+=d}}}function k5e(e,t){const r=(t+2)%4,i=e.geometryState,s=e.tile,n=i.neighborData,o=Tw(s,n.edgePeerNeighbors[t]),a=s.level-o.level,l=t===1||t===3,c=n.edgeResolutions[t];Ne(dg(c));const d=c+1,p=e.geometryInfo,f=p.boundingBox,m=p.outerEdges[t],g=p.uvRange[0],_=p.uvRange[1],x=p.uvRange[2],b=p.uvRange[3],w=_e(t===1?1:0,g,x),T=_e(t===0?1:0,_,b),E=o.renderData,O=E.geometryState,A=E.geometryInfo.outerEdges[r],R=s.getNeighborEdgeStartVertexIndex(t,o)*c,D=c*2**a;Ne(O.neighborData.edgeResolutions[r]===D),Ne(A.count-1===D);const k=E.localOrigin[0]-e.localOrigin[0],L=E.localOrigin[1]-e.localOrigin[1],q=E.localOrigin[2]-e.localOrigin[2],G=m.attributes,J=m.index0,ee=m.stride,se=G.position.typedBuffer,X=G.position.typedBufferStride,F=G.normalCompressed.typedBuffer,N=G.normalCompressed.typedBufferStride,B=G.uv0,H=A.attributes,W=A.index0,K=A.stride,Y=H.position.typedBuffer,ce=H.position.typedBufferStride,we=H.normalCompressed.typedBuffer,Oe=H.normalCompressed.typedBufferStride;for(let Be=1;Be<d-1;++Be){const He=J+ee*Be,Se=W+K*(R+Be),he=He*X,Me=Se*ce,Xt=Y[Me+0]+k,Er=Y[Me+1]+L,Cr=Y[Me+2]+q;se[he+0]=Xt,se[he+1]=Er,se[he+2]=Cr,$c(Xt,Er,Cr,f);const bt=He*N,ht=Se*Oe;F[bt+0]=we[ht+0],F[bt+1]=we[ht+1];const rr=Be/c,yr=l?w:_e(rr,g,x),Ui=l?_e(rr,_,b):T;Ld(B,He,yr,Ui)}}function U5e(e){var He;const t=e.geometryState,r=t.neighborData,i=e.localOrigin,s=r.cornerNeighborData,n=e.geometryInfo,o=n.outerEdges,a=n.boundingBox,l=e.tile,c=((He=e.tile.surface.view)==null?void 0:He.viewingMode)==="local",d=l.ellipsoid.radius,p=l.extentInRadians,f=l.horizontalScale;let m=0,g=0,_=0,x=0,b=0,w=0;const T=(Se,he,Me)=>{const Xt=p[he===0?1:3],Er=p[Se===0?0:2],Cr=Math.cos(Xt),bt=Math.sin(Xt),ht=Math.sin(Er),rr=Math.cos(Er),yr=d+Me;m=rr*Cr*yr,g=ht*Cr*yr,_=bt*yr},E=c?(()=>{const Se=e.geometryState.clippingArea,he=l.extent,Me=v(Se)&&(he[3]>Se[3]||he[2]>Se[2]||he[1]<Se[1]||he[0]<Se[0]),Xt=sue(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(Er,Cr,bt)=>{const ht=Er===0?L[0]:L[2],rr=Cr===0?L[1]:L[3],yr=Me?_e(ht,Se[0],Se[2]):ht,Ui=Me?_e(rr,Se[1],Se[3]):rr,it=bt;m=yr*f,g=Xt(Ui),_=it}})():T;let O=0,A=0,R=0;const D=c&&e.tile.surface.isWebMercatorOnPlateeCarree,k=(Se,he,Me,Xt)=>{if(c){const Er=he*f,Cr=D?(Math.PI/2-2*Math.atan(Math.exp(-Me/d)))*d:Me*f,bt=Er-m,ht=Cr-g,rr=Xt-_;O+=-bt*rr,A+=-ht*rr,R+=bt*bt+ht*ht}else{const Er=iue(Se),Cr=Se.tile,bt=Cr.extent,ht=Cr.extentInRadians,rr=(he-bt[0])/(bt[2]-bt[0]),yr=(Me-bt[1])/(bt[3]-bt[1]),Ui=ht[0]*(1-rr)+ht[2]*rr,it=Er(yr),ur=Math.cos(it),mi=Math.sin(it),zr=Math.sin(Ui),ir=Math.cos(Ui),Nr=d+Xt,_t=ir*ur*Nr-m,ft=zr*ur*Nr-g,Bt=mi*Nr-_,Ar=ft*w-Bt*b,Fr=Bt*x-_t*w,_r=_t*b-ft*x;O+=Fr*Bt-_r*ft,A+=_r*_t-Ar*Bt,R+=Ar*ft-Fr*_t}},L=l.extent,q=t.clippingArea,G=v(q)?q:OG,J=L[0],ee=L[2],se=L[1],X=L[3],F=[X>G[3],ee>G[2],se<G[1],J<G[0]],N=Math.max(J,G[0]),B=Math.min(ee,G[2]),H=Math.max(se,G[1]),W=Math.min(X,G[3]),K=n.uvRange[0],Y=n.uvRange[1],ce=n.uvRange[2],we=n.uvRange[3],Oe=l.surface.shading||HE,Be=Se=>{var yr,Ui;if(!c){const it=1/Math.sqrt(m*m+g*g+_*_);x=m*it,b=g*it,w=_*it}const he=s[Se].cornerTiles;O=0,A=0,R=0;let Me=1/0;for(let it=0;it<4;++it)Me=Math.min(Me,(Ui=(yr=he[it])==null?void 0:yr.level)!=null?Ui:1/0);for(let it=0;it<4;++it){const ur=he[it];c3[it]=(ur==null?void 0:ur.level)===Me?ur:null}let Xt=1,Er=0;for(let it=0;it<4;++it){const ur=c3[it];ur&&(Xt=Math.max(Xt,ur==null?void 0:ur.renderData.geometryState.numVerticesPerSide),Er=ur.extent[2]-ur.extent[0])}const Cr=Er,bt=Xt;Ne(bt>1);const ht=Cr/bt;for(let it=0;it<4;++it){const ur=c3[(it+3)%4],mi=c3[(it+0)%4];if(!ur&&!mi)continue;const zr=it===0?1:it===1?2:it===2?3:0,ir=it===0?2:it===1?3:it===2?0:1;if(ur&&mi){const Nr=lY[it][0]*ht,_t=lY[it][1]*ht,ft=ur.extent,Bt=ft[zr===0||zr===1?2:0]+Nr,Ar=ft[zr===0||zr===3?3:1]+_t,Fr=mi.extent,_r=Fr[ir===0||ir===1?2:0]+Nr,Or=Fr[ir===0||ir===3?3:1]+_t,sr=ur.renderData,gi=mi.renderData,Hr=vs(Bt,Ar,sr.geometryState.samplerData),is=vs(_r,Or,gi.geometryState.samplerData);k(sr,Bt,Ar,.5*(Hr+is))}else{const Nr=ur!=null?ur:mi,_t=ur?zr:ir,ft=Nr.extent,Bt=lY[it],Ar=ft[_t===0||_t===1?2:0]+Bt[0]*ht,Fr=ft[_t===0||_t===3?3:1]+Bt[1]*ht,_r=Nr.renderData,Or=vs(Ar,Fr,_r.geometryState.samplerData);k(_r,Ar,Fr,Or)}}const rr=1/Math.sqrt(O*O+A*A+R*R);O*=rr,A*=rr,R*=rr};for(let Se=0;Se<4;++Se){const he=Se,Me=(Se+1)%4,Xt=Se===0||Se===1?1:0,Er=Se===0||Se===3?1:0,Cr=_e(Xt,K,ce),bt=_e(Er,Y,we),ht=o[he],rr=Se===0||Se===3?ht.count-1:0,yr=o[Me],Ui=Se===0||Se===1?yr.count-1:0,it=s[Se].cornerTiles;let ur=-1;for(let ir=0;ir<4;++ir){const Nr=it[ir];Nr&&(ur===-1||Dv(it[ur],Nr)>0)&&(ur=ir)}const mi=ur,zr=it[mi];if(O=0,A=0,R=1,zr!==l){const ir=l.level-zr.level,Nr=2**ir,_t=[zr.lij[0]+ir,zr.lij[1]*Nr,zr.lij[2]*Nr],ft=[_t[1]+Nr===l.lij[1],Se===0&&(mi===1||mi===0&&zr!==it[3])||Se===1&&(mi===0||mi===1&&zr!==it[2]),_t[1]===l.lij[1]+1,Se===2&&(mi===3||mi===2&&zr!==it[1])||Se===3&&(mi===2||mi===3&&zr!==it[0])],Bt=ft.reduce((sr,gi)=>sr+(gi?1:0),0);Ne(Bt===1||Bt===2);let Ar=-1,Fr=-1;const _r=zr.renderData;if(Bt===1){const sr=ft.findIndex(Hr=>Hr);Ne(0<=sr&&sr<=3),Ar=(sr+2)%4;const gi=e.geometryState.neighborData.edgeResolutions[sr];Fr=l.getNeighborEdgeStartVertexIndex(sr,zr)*gi+gi*(sr===0&&Se===0||sr===1&&Se===0||sr===2&&Se===1||sr===3&&Se===3?1:0)}else{Ne(ft[1]||ft[3]),Ar=ft[1]?3:1;const sr=_r.geometryState.neighborData.edgeResolutions[Ar];Fr=Se===0||Se===3?0:sr}const Or=_r.geometryInfo.outerEdges[Ar];{const sr=ht.index0+rr*ht.stride,gi=yr.index0+Ui*yr.stride,Hr=Or.index0+Fr*Or.stride;{const is=Or.attributes.position,Es=is.typedBuffer,Co=Hr*is.typedBufferStride,Wo=e.localOrigin,co=Or.localOrigin,Nu=Es[Co+0]+co[0]-Wo[0],kc=Es[Co+1]+co[1]-Wo[1],Xo=Es[Co+2]+co[2]-Wo[2];$c(Nu,kc,Xo,a);{const Ao=ht.attributes.position,Ls=Ao.typedBuffer,qs=sr*Ao.typedBufferStride;Ls[qs+0]=Nu,Ls[qs+1]=kc,Ls[qs+2]=Xo}{const Ao=yr.attributes.position,Ls=Ao.typedBuffer,qs=gi*Ao.typedBufferStride;Ls[qs+0]=Nu,Ls[qs+1]=kc,Ls[qs+2]=Xo}}Ld(ht.attributes.uv0,sr,Cr,bt),Ld(yr.attributes.uv0,gi,Cr,bt);{const is=Or.attributes.normalCompressed.typedBuffer,Es=Hr*Or.attributes.normalCompressed.typedBufferStride;{const Co=ht.attributes.normalCompressed,Wo=Co.typedBuffer,co=sr*Co.typedBufferStride;Wo[co+0]=is[Es+0],Wo[co+1]=is[Es+1]}{const Co=yr.attributes.normalCompressed,Wo=Co.typedBuffer,co=gi*Co.typedBufferStride;Wo[co+0]=is[Es+0],Wo[co+1]=is[Es+1]}}}}else{const ir=F[he],Nr=F[Me];let _t;if(ir||Nr){const Fr=_e(J*(1-Xt)+ee*Xt,N,B),_r=_e(se*(1-Er)+X*Er,H,W),Or=t.samplerData;_t=vs(Fr,_r,Or)}else _t=PRt(it);E(Xt,Er,_t),(Oe||HE)&&Be(Se);const ft=m-i[0],Bt=g-i[1],Ar=_-i[2];$c(ft,Bt,Ar,a),ht.setVertexFromValuesRawPositionUVNormal(rr,ft,Bt,Ar,Cr,bt,O,A,R),yr.setVertexFromValuesRawPositionUVNormal(Ui,ft,Bt,Ar,Cr,bt,O,A,R)}}for(let Se=0;Se<4;++Se)c3[Se]=null}function PRt(e){var n,o;const t=e.reduce((a,l)=>{var c;return Math.min(a,(c=l==null?void 0:l.level)!=null?c:1/0)},1/0);ha&&(Ne(!e[0]||!e[2]||Hre(e[0],e[2],Mt.SOUTH_WEST)),Ne(!e[1]||!e[3]||Hre(e[1],e[3],Mt.NORTH_WEST)));let r=0,i=0;for(let a=0;a<4;++a){const l=e[a];if(l&&l.level===t){const c=a===0||a===1,d=a===0||a===3,p=l.extent,f=p[c?0:2],m=p[d?1:3],g=(o=(n=l.renderData)==null?void 0:n.geometryState)==null?void 0:o.samplerData;i+=vs(f,m,g),r++}}const s=r?i/r:0;return Ne(s!=null),s}function AG(e){const t=e.vao,r=e.geometryInfo.vertexAttributes.position.typedBuffer;t.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const lY=[[0,1],[1,0],[0,-1],[-1,0]],Jn=new gMt,OG=wOe(-1/0,-1/0,1/0,1/0),c3=[null,null,null,null];function B5e(e,t,r){if(!t)return!1;const i=Dv(e,t);return i>0||i===0&&r<2}const HE=!0;class $Rt extends Qce{constructor(t,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=tr(),t!==void 0&&this.init(t,r,i)}get horizontalScale(){return this._horizontalScaleFactor}init(t,r,i){super.init(t,r,i);const s=i.view.renderSpatialReference,n=i.spatialReference,o=v(s)&&rN(s)&&v(n)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const d=Fe(c[0],c[1],0);So(d,Ve.WebMercator,d,Ve.PlateCarree);const p=Fe(c[2],c[3],0);So(p,Ve.WebMercator,p,Ve.PlateCarree),l[0]=d[0],l[1]=d[1],l[2]=p[0],l[3]=p[1]}else for(let d=0;d<4;++d)l[d]=c[d]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this._extentInRenderSR,r=.5*(t[2]-t[0]),i=.5*(t[3]-t[1]),s=Math.sqrt(r*r+i*i),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Ec.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(t){const r=this._aabb(),i=r[0],s=r[1],n=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let d=0;d<6;d++){const p=t[d],f=p[0],m=p[1],g=p[2],_=p[3];if(f*(f>0?i:o)+m*(m>0?s:a)+g*(g>0?n:l)+_>=0)return Ol.OUTSIDE;c=c&&f*(f<0?i:o)+m*(m<0?s:a)+g*(g<0?n:l)+_<=0}return c?Ol.INSIDE:Ol.INTERSECTS}_aabb(){const t=this._extentInRenderSR;return OZe(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,r,i,s){return PU[0]=1/r[0],PU[1]=1/r[1],PU[2]=1/r[2],sce(this._aabb(),t,PU,i,s)}createGeometry(){SRt(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){ORt(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){MRt(this.renderData,this._horizontalScaleFactor)}}const PU=$();var gF;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(gF||(gF={}));class DRt extends Qce{constructor(t,r,i){super(),this._obb=new Array(8);for(let s=0;s<8;s++)this._obb[s]=$();t!==void 0&&this.init(t,r,i)}init(t,r,i){super.init(t,r,i);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],d=Ft(o,l,.5),p=Ft(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),bP(this.centerAtSeaLevel,p,d,this.ellipsoid.radius);const m=pu(this.centerAtSeaLevel);xe(m,m),this.up=m,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(this.lij[0]===0)ue(this._center[xm.MIDDLE],0,0,0),ue(this._center[xm.TOP],0,0,0),ue(this._center[xm.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=Kr(this.surface.spatialReference)),this._center[xm.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=Math.max(jo(this._center[xm.MIDDLE],this._obb[0]),jo(this._center[xm.MIDDLE],this._obb[1]));this._center[xm.MIDDLE][3]=Math.sqrt(t)}}_calculateFrustumVisibilityStatus(t){if(!Gw(t,this._center[xm.MIDDLE]))return Ol.OUTSIDE;if(this.lij[0]<10)return Ol.INTERSECTS;const r=this._obb,i=this.surface.view.state.camera.near;let s=!0;for(let n=0;n<kx.NUM;n++){const o=n===Gi.NEAR,a=t[n],l=a[0],c=a[1],d=a[2],p=a[3]-(o?i:0);let f=!1;for(let m=0;m<8;++m){const g=r[m];if(l*g[0]+c*g[1]+d*g[2]+p<0){if(f=!0,!s)break}else s=!1}if(!f)return Ol.OUTSIDE}return s?Ol.INSIDE:Ol.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const t=this._getPatchType(this.lij[1],this.lij[0]);gRt(this.renderData,t),this.setMemoryDirty()}_updateOBB(){const t=this.extentInRadians,r=this._obb;for(let i=0;i<2;i++){const s=this.elevationBounds[i];let n=4*i;bP(r[n++],t[0],t[1],this.ellipsoid.radius+s),bP(r[n++],t[0],t[3],this.ellipsoid.radius+s),bP(r[n++],t[2],t[3],this.ellipsoid.radius+s),bP(r[n++],t[2],t[1],this.ellipsoid.radius+s)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case Kp.HAS_NORTH_POLE:ue(r[1],0,0,this.ellipsoid.radius),ue(r[2],0,0,this.ellipsoid.radius),ue(r[5],0,0,this.ellipsoid.radius),ue(r[6],0,0,this.ellipsoid.radius);break;case Kp.HAS_SOUTH_POLE:ue(r[0],0,0,-this.ellipsoid.radius),ue(r[3],0,0,-this.ellipsoid.radius),ue(r[4],0,0,-this.ellipsoid.radius),ue(r[7],0,0,-this.ellipsoid.radius)}}_getPatchType(t,r){return t===(1<<r)-1?t===0?Kp.HAS_BOTH_POLES:Kp.HAS_SOUTH_POLE:t===0?Kp.HAS_NORTH_POLE:Kp.REGULAR}intersectsRay(t,r,i,s){const n=this._center[xm.MIDDLE],o=n[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=n[0]-t[0],c=n[1]-t[1],d=n[2]-t[2],p=(l*r[0]+c*r[1]+d*r[2])/a,f=r[0]*p-l,m=r[1]*p-c,g=r[2]*p-d;return f*f+m*m+g*g<o*o}getDefaultVerticesPerRowOnLevel(){return this.level<ibe.length?ibe[this.level]+1:2}updateCornerElevations(){wRt(this.renderData)}updateEdgeElevations(){bRt(this.renderData)}}const ibe=[128,64,32,16,16,8,8,4];var xm;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(xm||(xm={}));class LRt{constructor(){this.extent=Lr(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class NRt{constructor(){this._queries=new Qt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Qt({initialSize:30}),this._queryPool=new ro(LRt)}queryVisibleLevelRange(t,r,i,s){const n=this._queryPool.acquire();jm(n.extent,t),n.minLevel=r||-Number.MAX_VALUE,n.maxLevel=i!=null?i:Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n)}hasPendingQueries(){return this._queryQueue.length!==0}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length}processQueries(){for(let t=0;t<this._queries.length;t++){const r=this._queries.data[t];this._queryPool.release(r),r.callback(t>=this._queriesInvPtr),r.callback=null}this._queries.clear()}scaleQueriesForTile(t){const r=t.level;let i=0;for(;i<this._queriesInvPtr;){const s=this._queries.data[i],n=s.extent;r>=s.minLevel&&r<=s.maxLevel&&n[0]<=t.extent[2]&&n[2]>=t.extent[0]&&n[1]<=t.extent[3]&&n[3]>=t.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}}class z5e extends Yl{constructor(){super(...arguments),this.blendMode=ke.Normal}}u([j({count:ke.COUNT})],z5e.prototype,"blendMode",void 0);class uM extends z5e{constructor(){super(...arguments),this.output=Lo.Composite,this.baseOpacityMode=Zm.NotRequired,this.premultipliedSource=$m.Off,this.hasWebGL2Context=!1}}u([j({count:Lo.COUNT})],uM.prototype,"output",void 0),u([j({count:Zm.COUNT})],uM.prototype,"baseOpacityMode",void 0),u([j()],uM.prototype,"premultipliedSource",void 0),u([j()],uM.prototype,"hasWebGL2Context",void 0);var qE;function FRt(e){const t=new Qr;if(t.include(S5e),e.background===qE.Only){const r=e.output===Lo.ColorComposite;return r?t.fragment.uniforms.add(new er("backgroundColor",i=>i.backgroundColor)):(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(Kce)),t.fragment.code.add(S`
    void main() {
      gl_FragColor = ${r?S`vec4(backgroundColor, 1.0)`:S`gridColor(uv)`};
    }
  `),t}return t.include(E5e,e),t.fragment.uniforms.add(new Rt("tex",r=>r.texture)),t.fragment.uniforms.add(new De("opacity",r=>r.opacity)),t.fragment.code.add(S`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`),t}(function(e){e[e.BelowLayer=0]="BelowLayer",e[e.Only=1]="Only",e[e.COUNT=2]="COUNT"})(qE||(qE={}));const kRt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return qE},build:FRt},Symbol.toStringTag,{value:"Module"}));class URt extends T5e{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Ic}}class MG extends li{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2}initializeProgram(t){return new ti(t.rctx,MG.shader.get().build(this.configuration),Yr)}initializePipeline(){return Ht({blending:Pf(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:cr})}}MG.shader=new ei(kRt,()=>re(()=>import("./BlendLayers.glsl.853ca360.js"),[]));class V5e extends uM{constructor(){super(...arguments),this.background=qE.BelowLayer}}u([j()],V5e.prototype,"background",void 0);class cY{constructor(t,r,i,s,n,o){this.texture=t,this.type=r,t.retain(),this.offsetAndScale=ar(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Fe(s,n,o)}destroy(){this.texture.release()}}function i8(){return[1,0,0,1,0,0]}function BRt(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function zRt(e,t,r,i,s,n){return[e,t,r,i,s,n]}function VRt(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,create:i8,clone:BRt,fromValues:zRt,createView:VRt},Symbol.toStringTag,{value:"Module"}));function jRt(e){return e instanceof Float32Array&&e.length>=2}function GRt(e){return Array.isArray(e)&&e.length>=2}function uY(e){return jRt(e)||GRt(e)}const HRt=96,qRt=39.37;function nue(e,t){return t.type?mr(e,t.x,t.y):Ho(e,t)}function WRt(e){return Fc(e)}function XRt(e,t){const r=e.targetGeometry,i=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const YRt=function(){const e=rt();return function(t,r,i){const s=r.targetGeometry;nue(e,s);const n=.5*RG(r);return t.xmin=e[0]-n*i[0],t.ymin=e[1]-n*i[1],t.xmax=e[0]+n*i[0],t.ymax=e[1]+n*i[1],t.spatialReference=s.spatialReference,t}}();function RG(e){return e.scale*ZRt(e.targetGeometry)}function ZRt(e){return v(e)&&Ll(e.spatialReference)?1/(WRt(e.spatialReference)*qRt*HRt):1}function JRt(e){return Y9(e.rotation)||0}const oue=function(){const e=rt(),t=rt(),r=rt();return function(i,s,n,o,a,l){return ale(e,s),wd(t,n,.5*l),mr(r,1/o*l,-1/o*l),rle(i,t),a&&ele(i,i,a),a$e(i,i,r),tle(i,i,e),i}}(),KRt=function(){const e=rt();return function(t,r,i,s){const n=RG(r),o=JRt(r);return nue(e,r.targetGeometry),oue(t,e,i,n,o,s)}}(),QRt=function(){const e=rt();return function(t,r,i,s){const n=RG(r);return nue(e,r.targetGeometry),oue(t,e,i,n,0,s)}}();function eIt(e){const t=sx(e);return t?t.valid[1]-t.valid[0]:0}function tIt(e,t){return Math.round(eIt(e)/t)}var Wre;const d_=[0,0];let Hb=Wre=class extends fe{constructor(e){super(e),this._viewpoint2D={center:rt(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new Sr,this.id=0,this.inverseTransform=i8(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=i8(),this.transformNoRotation=i8(),this.displayMat3=Au(),this.displayViewMat3=Au(),this.viewMat3=Au(),this.viewMat2d=i$e(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,r=e.targetGeometry;t.center[0]=r.x,t.center[1]=r.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=r.spatialReference}this._update()}copy(e){const t=this.size,r=this.viewpoint;return r&&t?(this.viewpoint=XRt(r,e.viewpoint),this._set("size",Ho(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new Wre({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,r){return uY(t)?LS(e,t,this.inverseTransform):(d_[0]=t,d_[1]=r,LS(e,d_,this.inverseTransform))}toScreen(e,t,r){return uY(t)?LS(e,t,this.transform):(d_[0]=t,d_[1]=r,LS(e,d_,this.transform))}toScreenNoRotation(e,t,r){return uY(t)?LS(e,t,this.transformNoRotation):(d_[0]=t,d_[1]=r,LS(e,d_,this.transformNoRotation))}getScreenTransform(e,t){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,s=this._get("size");return oue(e,r,s,t,0,i),e}_update(){const{center:e,spatialReference:t,scale:r,rotation:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Fd({targetGeometry:new lt(e[0],e[1],t),scale:r,rotation:i});if(this._set("viewpoint",o),!n||!t||!r)return;this.resolution=RG(o),this.rotation=i,this.scale=r,this.spatialReference=t,Ho(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;mae(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=gae(this.viewMat3),d=Jp(n[0]/2,n[1]/2),p=Jp(-n[0]/2,-n[1]/2),f=Y9(i);Zz(c,c,d),yae(c,c,f),Zz(c,c,p),NR(this.displayViewMat3,this.displayMat3,c);const m=rle(this.viewMat2d,d);return ele(m,m,f),tle(m,m,p),YRt(this.extent,o,n),KRt(this.transform,o,n,s),n$e(this.inverseTransform,this.transform),QRt(this.transformNoRotation,o,n,s),this.worldScreenWidth=tIt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([h({readOnly:!0})],Hb.prototype,"id",void 0),u([h({value:1,json:{write:!0}})],Hb.prototype,"pixelRatio",null),u([h({json:{write:!0}})],Hb.prototype,"size",null),u([h()],Hb.prototype,"spatialReference",void 0),u([h({type:Fd,json:{write:!0}})],Hb.prototype,"viewpoint",null),Hb=Wre=u([I("esri.views.2d.ViewState")],Hb);const rIt=Hb,iIt=.125;class sIt{constructor(){this._renderParams={context:null,drawPhase:1,state:new rIt({viewpoint:new Fd({targetGeometry:new lt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(t,r,i,s,n,o,a,l,c,d){const p=o.adjustLevel(r[0]),f=this._renderParams;f.context=t,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=d,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(r[0]),[g,_]=o.getShift(r,a*m),x=iIt*a*m/c,b=i.transforms.dvs;b[0]=x,b[4]=-x,b[6]=-1-g-l[0]*a*2,b[7]=1+_+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,i.stage||i.attachWithContext(t),i.triangleCount=0,s.drawTile(f,i,n)}}class IG extends li{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2}initializeProgram(t){return new ti(t.rctx,IG.shader.get().build(this.configuration),Yr)}initializePipeline(){return Ht({blending:Pf(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:cr})}}IG.shader=new ei(FMt,()=>re(()=>import("./RasterColorizer.glsl.7529a954.js"),[]));class s8 extends uM{constructor(){super(...arguments),this.colorizerType=W2.Stretch,this.stretchType=GE.Noop,this.applyColormap=!0}}u([j({count:W2.COUNT})],s8.prototype,"colorizerType",void 0),u([j({count:GE.COUNT})],s8.prototype,"stretchType",void 0),u([j()],s8.prototype,"applyColormap",void 0);class sbe{constructor(t){this._rctx=t,this._fbos=new Map}get(t){return this._getPool(t)}dispose(){this._fbos.forEach(t=>t.dispose()),this._fbos.clear()}_getPool(t){const r=this._fbos.get(t);if(r)return r;const i=new ps(this._rctx,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.DEPTH_RENDER_BUFFER,width:t,height:t});return this._fbos.set(t,i),i}}const nIt=te.getLogger("esri.views.3d.terrain");class oIt{constructor(t,r){this._rctx=t,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new sIt,this._bindParameters=new h7(null,null,null),this._blendLayersTechniqueConfig=new V5e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Zl(this._rctx,kI)}dispose(){this._fbos.forEach(t=>{t.dispose(),t=null}),this._fbos=null,this._vtFBO=tt(this._vtFBO),this._vaoQuad=tt(this._vaoQuad),this._vectorTileHelper=tt(this._vectorTileHelper),this._backgroundTechnique=Di(this._backgroundTechnique),this._applyOpacityTechnique=Di(this._applyOpacityTechnique),this._blendLayersTechnique=Di(this._blendLayersTechnique)}_getBlendLayersTechnique(t,r,i,s=$m.Off,n=qE.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(MG,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,r){const i=this._getBlendLayersTechnique(ke.Normal,r?Lo.ColorComposite:Lo.GridComposite,Zm.NotRequired,$m.Off,qE.Only),s=this._rctx.bindTechnique(i,t,this._bindParameters);this._render(s)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Ut.TRIANGLE_STRIP,0,da(this._vaoQuad,"geometry"))}drawGroup(t,r,i,s,n,o=$m.On){r===Lo.Composite&&(t.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),t.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,t,this._bindParameters);this._render(l)}drawRasterData(t,r,i,s,n,o=$m.Off){if(C(t.texture))return;t.fboTexture=r===Lo.GroupBackgroundComposite||s===ke.Normal&&n===Zm.NotRequired&&o===$m.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(s,r,n,o),l=this._rctx.bindTechnique(a,t,this._bindParameters);this._render(l)}drawImageryTileData(t,r,i,s,n,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,xr.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;t.fboTexture=s===ke.Normal&&n===Zm.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,s,n);a.opacity=t.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=t.backgroundColor,c.fboTexture=t.fboTexture,c.baseOpacity=t.baseOpacity;const d=this._rctx.bindTechnique(l,c,null);this._render(d)}_getRasterColorizerTechnique(t,r,i,s){const n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return C(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new s8,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?GE.Noop:GE.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(IG,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,r,i,s,n,o,a,l,c){const d=this._rctx,p=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,xr.MAP),m=n===Zm.Required||t.opacity<1||s!==ke.Normal||r!==Lo.Composite,g=m?$m.On:$m.Off;this._getBlendLayersTechnique(s,r,n,g).bindPipelineState(d);let _=null,x=null;m?(x=this.currentFBO(i),C(this._vtFBO)&&(this._vtFBO=new sbe(this._rctx)),_=this._vtFBO.get(i),d.bindFramebuffer(_),this._clearCurrentFBO()):c&&d.clearSafe(ds.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(d,o.sourceLod,p,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a)}catch(b){nIt.warnOnce("A render call containing vector tiles did not resolve correctly.",b)}return!v(_)||(d.bindFramebuffer(x),t.texture=_.colorTexture,t.offset=Ud,t.scale=1,this.drawRasterData(t,r,i,s,n,g),c)}copyFBOToTexture(t){const r=this._rctx,i=r.bindTexture(t.texture,dt.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;r.gl.copyTexImage2D(xt.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),r.bindTexture(i,dt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(ds.COLOR_BUFFER_BIT|ds.DEPTH_BUFFER_BIT)}_initFBO(t,r,i){this._rctx.bindFramebuffer(t),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(t){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(t)}bind(t,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let s=this._fbos.length;s<=r;s++)this._fbos.push(new sbe(this._rctx));this._initFBO(this._fbos[r].get(t),t,i)}_bindNextFreeBuffer(t){this._lastUsedIds.length>0?this.bind(t,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(t,this._lastCreatedBufferId))}openGroup(t){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(t)}switch(t){const r=this.currentFBO(t),i=this._current;return this._bindNextFreeBuffer(t),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(t){const r=this._current;this._bindNextFreeBuffer(t),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(t){return this._fbos[this._current].get(t)}}class aIt{constructor(t,r,i,s){this.start=t,this.end=r,this.blendMode=i,this.opacity=s}}class lIt{constructor(t,r,i){this._rctx=t,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new URt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new oIt(this._rctx,this._techniqueRepository),this._blackTex=new yO(upt(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=tt(this._composition),this._backgroundTexture=Di(this._backgroundTexture),this._blackTex=Di(this._blackTex)}get backgroundIsGrid(){return C(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,r){if(!t.renderData)return;const i=t.surface,s=i.baseOpacity;let n=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.pixelRatio;let d=!1;_L.clear(),fA.length=0;const p=t.layerInfo[xr.MAP];let f=p.length,m=0;for(;m<p.length;m++){const x=i.layerViewByIndex(m,xr.MAP),b=x.layer.opacity;nbe[m]=b;const w=x.fullOpacity;if(obe[m]=w,jAe(x.layer)&&f>=p.length&&(f=m),t9(x)){abe[m]=x.layer.blendMode;let E=x.layer.blendMode!=="normal";if(pI(x.layer.parent)){const O=Xre(x.layer.parent);v(O)&&O!==""&&(E=j5e(x.layer.parent)||E)}E&&(d=E,l=!1)}if(b===0&&!d){p[m].pendingUpdates&=~(St.TEXTURE_NOFADING&St.TEXTURE_FADING);continue}++o;const T=dY(t,m);if(T){if(p[m].pendingUpdates&=~(St.TEXTURE_NOFADING&St.TEXTURE_FADING),pI(x.layer.parent)){const E=Xre(x.layer.parent);v(E)&&E!==""&&G5e(x.layer.parent,m)}hF(x)?a=Math.max(a,this.tileSize*c):s===1&&w===1&&(x.isOpaque||this._dataToTexture(T)&&T.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++n}}a=cIt(a);const g=a/this.tileSize,_=m-1;this._ensureBackgroundTexture(this.tileSize),n!==0?n===1&&!d&&this._useLayerTexture(t,_,f,obe[_])||this._composeMapLayers(t,r,_,f,nbe,abe,a,g,!l||d,_L,d):this._useBackgroundTexture(t,o)}_ensureBackgroundTexture(t){C(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(t),this._passParameters.offset=Ud,this._passParameters.scale=1,this._passParameters.opacity=1,v(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,v(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(t,r){let i=$v.Immediate;(t.surface.view.layerViewManager.updating||r>0)&&(i=$v.Delayed),this._backgroundTexture&&C(t.renderData.textureReference)&&(i=$v.Immediate),t.renderData.setTextureReference(v(this._backgroundTexture)?new cY(this._backgroundTexture,ua.FADING,lbe,t.surface.baseOpacity,0,1):null,i)}_useLayerTexture(t,r,i,s){const n=r<i,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=dY(t,r);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new cY(l.sourceLayerInfo.data,ua.FADING,l,o,a,s)),!0)}_composeMapLayers(t,r,i,s,n,o,a,l,c,d,p){this._composition.ensureBuffer(a);const f=t.surface.baseOpacity;let m=!1,g=at.LINEAR_MIPMAP_LINEAR,_=!1,x=0;for(let w=i;w>=0;w--){const T=dY(t,w);if(!T||n[w]===0&&!p)continue;const E=w<s&&f<1&&!m;this._passParameters.baseOpacity=E?f:1;const O=this._passParameters.baseOpacity<1?Zm.Required:Zm.NotRequired;E&&(m=!0);let A=!1;d.forEach(L=>{L.start===w&&(fA.push(L),this._composition.openGroup(a),A=!0)});const R=x===0,D=A?Lo.GroupBackgroundComposite:c&&R?this.backgroundIsGrid?Lo.GridComposite:Lo.ColorComposite:Lo.Composite,k=Gre[o[w]];for(hOt(T)?(this._passParameters.opacity=n[w],_=this._composition.drawVectorData(this._passParameters,D,a,k,O,T,l,this.tileSize,_)):dOt(T)?(this._passParameters.opacity=n[w],this._composition.drawImageryTileData(this._passParameters,D,a,k,O,T),this._hasNearestInterpolation(T)&&(g=at.NEAREST)):this._dataToTexture(T)&&(this._passParameters.texture=T.sourceLayerInfo.data.texture,this._passParameters.offset=T.offset,this._passParameters.scale=T.scale,this._passParameters.opacity=n[w],this._composition.drawRasterData(this._passParameters,D,a,k,O));fA.length>0&&fA[fA.length-1].end===w;){const L=fA.pop();this._passParameters.opacity=L.opacity,this._passParameters.offset=Ud,this._passParameters.scale=1;const q=c&&R?this.backgroundIsGrid?Lo.GridComposite:Lo.ColorComposite:Lo.Composite;this._composition.drawGroup(this._passParameters,q,a,Gre[L.blendMode],O)}x++}const b=t.renderData.ensureTexture(a,()=>this._buildTexture(a,g));this._composition.copyFBOToTexture(b),this._composition.unbind(),t.renderData.setTextureReference(new cY(b,r,lbe,m?1:f,0,1))}_hasNearestInterpolation(t){const r=t.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(t){if(fOt(t)){const r=t.sourceLayerInfo;r.data=this._buildTexture(r.data),t.tile.setMemoryDirty()}return pOt(t)}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,r=at.LINEAR_MIPMAP_LINEAR){if(C(t))return null;const i={target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:r,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")i.width=i.height=t,n=new yO(new dt(s,i));else if(t instanceof wG)i.isOpaque=t.isOpaque,n=new yO(new dt(s,i,t.image)),t.release();else try{i.width=t.width,i.height=t.height,n=new yO(new dt(s,i,t))}catch{n=new yO(dDe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,dt.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,dt.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function cIt(e){const t=dR(e),r=t*t,i=e*e;if(r===i)return e;const s=t/2;return r-i<i-s*s?t:s}function dY(e,t){Kd.layerIndex=t;const r=e.layerInfo[xr.MAP][t];if(v(r.data))return mr(Kd.offset,0,0),Kd.tile=e,Kd.scale=1,Kd.sourceLod=e.lij,Kd.sourceLayerInfo=r,Kd;const i=r.upsampleInfo;if(v(i)){const s=i.tile.layerInfo[xr.MAP][t];return Kd.tile=i.tile,Ho(Kd.offset,i.offset),Kd.scale=i.scale,Kd.sourceLod=i.tile.lij,Kd.sourceLayerInfo=s,Kd}return null}function Xre(e){return e.get("uid")}function j5e(e){let t=e.blendMode!=="normal";return pI(e.parent)&&(t=j5e(e.parent)||t),t}function G5e(e,t){pI(e.parent)&&G5e(e.parent,t);const r=Xre(e);v(r)&&r!==""&&(_L.has(r)?_L.get(r).start=t:_L.set(r,new aIt(t,t,e.blendMode,e.opacity)))}const nbe=new Array,obe=new Array,abe=new Array,_L=new Map,fA=new Array,Kd={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},lbe={offset:[0,0],scale:1},H5e=200,hY=40,uIt=.8,dIt=10,q$=1e-6;function hIt(e,t,r){const i=t,s=r;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(i[a]<l){if(s[a]<=q$)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-q$){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(i[a]>l){if(s[a]>=-q$)return!1;const c=(l-i[a])/s[a];n=Math.max(n,c)}else if(s[a]>=q$){const c=(l-i[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class cbe{constructor(t,r,i,s,n){this.aabb=t,this.axis=r,this.d=i,this.midStartIndex=s,this.rightStartIndex=n}}class fI{constructor(t,r,i,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=r,this.positionAttribute=s,this._rayDirection=$(),this.bspNodeTree=new Array,this.vertexPositionBuffer=s.data,this.vertexPositionStride=s.stride;const n=i-r,o=n<=q5e?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=yIt(t,r,i,s.data,s.stride),l=_e(Math.log2(n/hY),2,dIt),c=(d,p,f)=>{const m=mIt(o,a,d,p),g=p-d;if(g<=hY){const E=new cbe(m,void 0,0,d,p);return this.bspNodeTree.push(E),E}const{axis:_,midValue:x}=gIt(m),b=fIt(o,a,d,p,_,x),w=(E,O)=>{if(f>l)return;const A=O-E;return A<hY||A>=uIt*g?void 0:c(E,O,f+1)},T=new cbe(m,_,x,b.next,b.mid);return this.bspNodeTree.push(T),T.leftNode=w(d,b.next),T.rightNode=w(b.mid,p),T};c(0,n,0),this.triangleVertexIndices=_It(o,t,r,i)}}intersectRayTriangleRange(t,r){{if(t>=r)return;const i=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],d=this._rayDirection,p=d[0],f=d[1],m=d[2];for(let g=t,_=3*t;g<r;++g){let x=i[_++]*n;const b=s[x++],w=s[x++],T=s[x];x=i[_++]*n;const E=s[x++],O=s[x++],A=s[x];x=i[_++]*n;const R=E-b,D=O-w,k=A-T,L=s[x++]-b,q=s[x++]-w,G=s[x]-T,J=f*G-q*m,ee=m*L-G*p,se=p*q-L*f,X=R*J+D*ee+k*se;if(Math.abs(X)<=Number.EPSILON)continue;const F=a-b,N=l-w,B=c-T,H=F*J+N*ee+B*se;if(X>0){if(H<0||H>X)continue}else if(H>0||H<X)continue;const W=N*k-D*B,K=B*R-k*F,Y=F*D-R*N,ce=p*W+f*K+m*Y;if(X>0){if(ce<0||H+ce>X)continue}else if(ce>0||H+ce<X)continue;const we=(L*W+q*K+G*Y)/X;if(we>=0){const Oe=this.indices[g]+this.firstTriangleIndex,Be=rce(R,D,k,L,q,G,pIt);this._callback(we,Be,Oe,!1)}}}fI.numFacesTested+=r-t}intersectRay(t,r){fI.numFacesTested=0;const i=Fe(t.r0[0],t.r0[1],t.r0[2]),s=Fe(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-i[0],o=s[1]-i[1],a=s[2]-i[2];if(n*n+o*o+a*a<q$)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const d=this.bspNodeTree[0];this.intersectRayBSP(d,0,c)}intersectRayBSP(t,r,i){const s=this._rayOrigin,n=this._rayDirection;if(!hIt(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=r,c=t.midStartIndex;if(l<c){const d=t.leftNode;d!==void 0?this.intersectRayBSP(d,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=i;if(l<c){const d=t.rightNode;d!==void 0?this.intersectRayBSP(d,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}fI.numFacesTested=0;const pIt=$(),mA=[1/0,1/0,1/0],gA=[-1/0,-1/0,-1/0];function fIt(e,t,r,i,s,n){let o=r,a=i;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=i;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function mIt(e,t,r,i){if(i<=r)return mE(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[r];for(let n=0;n<3;++n)mA[n]=t[s+0+n],gA[n]=t[s+3+n]}for(let s=r+1;s<i;++s){const n=6*e[s];for(let o=0;o<3;++o)mA[o]=Math.min(mA[o],t[n+0+o]),gA[o]=Math.max(gA[o],t[n+3+o])}return mE(mA[0],mA[1],mA[2],gA[0],gA[1],gA[2])}function gIt(e){const t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2],s=t>r?t>i?0:r>i?1:2:r>i?1:i>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function yIt(e,t,r,i,s){const n=r-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l+0]*s,d=e[l+1]*s,p=e[l+2]*s;for(let f=0;f<3;++f){const m=i[c+f],g=i[d+f],_=i[p+f];o[6*a+f]=Math.min(m,g,_),o[6*a+3+f]=Math.max(m,g,_)}}return o}function _It(e,t,r,i){const s=i-r;let n=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=q5e?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+r);for(let c=0;c<3;++c){const d=t[l+c];o[3*a+c]=d}}return o}const q5e=65535;class Ns extends aa{constructor(){super(...arguments),this.output=V.Color,this.overlayMode=Lv.Disabled,this.tileBlendInput=Qy.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.shading=!hi.TERRAIN_USE_LEGACY_SHADING,this.useLegacyTerrainShading=hi.TERRAIN_USE_LEGACY_SHADING,this.transparent=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1}}u([j({count:V.COUNT})],Ns.prototype,"output",void 0),u([j({count:Lv.COUNT})],Ns.prototype,"overlayMode",void 0),u([j({count:Qy.COUNT})],Ns.prototype,"tileBlendInput",void 0),u([j()],Ns.prototype,"spherical",void 0),u([j()],Ns.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],Ns.prototype,"atmosphere",void 0),u([j()],Ns.prototype,"receiveShadows",void 0),u([j()],Ns.prototype,"hasSlicePlane",void 0),u([j()],Ns.prototype,"backfaceCullingEnabled",void 0),u([j()],Ns.prototype,"stencilEnabled",void 0),u([j()],Ns.prototype,"textureFadingEnabled",void 0),u([j()],Ns.prototype,"renderOccluded",void 0),u([j()],Ns.prototype,"hasScreenSpaceReflections",void 0),u([j()],Ns.prototype,"hasCloudsReflections",void 0),u([j()],Ns.prototype,"shading",void 0),u([j()],Ns.prototype,"useLegacyTerrainShading",void 0),u([j()],Ns.prototype,"transparent",void 0),u([j()],Ns.prototype,"tileBorders",void 0),u([j()],Ns.prototype,"visualizeNormals",void 0),u([j()],Ns.prototype,"screenSizePerspective",void 0),u([j()],Ns.prototype,"receiveAmbientOcclusion",void 0),u([j({constValue:kt.Disabled})],Ns.prototype,"pbrMode",void 0),u([j({constValue:fs.CompressedAttribute})],Ns.prototype,"normalType",void 0),u([j({constValue:Mn.Compressed})],Ns.prototype,"textureCoordinateType",void 0),u([j({constValue:!1})],Ns.prototype,"highStepCount",void 0),u([j({constValue:!1})],Ns.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Ns.prototype,"useFillLights",void 0);const pY=7,vIt=10,fY=ao();var Ml;(function(e){e[e.Opaque=0]="Opaque",e[e.Semitransparent=1]="Semitransparent",e[e.Invisible=2]="Invisible"})(Ml||(Ml={}));let id=class extends be{constructor(e){super(e),this.type=zs.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Ns,this._passParameters=new A5e,this._rctx=null,this._scaleRangeQueries=new NRt,this._renderDataPool=new ro(pRt),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new v5e,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=Ml.Opaque,this._velvetOverground=!0,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Rs.Occlude}get _isGlobal(){return this._stage.viewingMode===Ye.Global}get shading(){return this._techniqueConfiguration.shading}set shading(e){this._techniqueConfiguration.shading=e}initialize(){const e=[Ee.OPAQUE_TERRAIN,Ee.TRANSPARENT_TERRAIN,Ee.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),pMt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.transparent=e===Ml.Invisible,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return Um}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?HV:Rs.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,v(this._tileRenderer)&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,St.TEXTURE_FADING)}queryVisibleLevelRange(e,t,r,i){this._scaleRangeQueries.queryVisibleLevelRange(e,t,r,i),this.setNeedsRender()}updateTileTexture(e,t){v(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(e,t===St.TEXTURE_FADING?ua.FADING:ua.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){for(const r of e.layerInfo[xr.ELEVATION])r.pendingUpdates&=~St.GEOMETRY;e.resetPendingUpdate(St.GEOMETRY);const t=e.renderData.updateGeometryState();return t&&this.setDirty(),t}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this._renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const t=vIt-pY,r=Math.max(0,Math.floor((e.level-t)/pY)*pY);if(this._isGlobal&&r===0)return Ic;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=cn.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=cn.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=cn.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this._tileRenderer=new lIt(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=dDe(this._rctx)}uninitializeRenderContext(){this._emptyTex=tt(this._emptyTex),this._tileRenderer=tt(this._tileRenderer)}intersect(e,t,r,i){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==Ml.Opaque)return;const s=bIt,n=wIt;ge(s,i,r),ue(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===qa.MIN,d=!!e.results.ground.target,p=Kmt(e.verticalOffset),f=e.tolerance;let m,g=c&&v(o.dist)?o.dist:1/0;const _=b=>{const w=b.renderData;if(!(w!=null&&w.vao))return;const T=w.geometryInfo;cj(fY,T.boundingBox);const E=w.localOrigin;v(p)&&(p.localOrigin=E,p.applyToAabb(fY));const O=fY;if(yA[0]=r[0]-E[0],yA[1]=r[1]-E[1],yA[2]=r[2]-E[2],!sce(O,yA,n,f,g))return;const A=(J,ee,se)=>{J.set(this.type,b,ee,se,Hn),g=c&&v(o.dist)?o.dist:1/0},R=(J,ee)=>{if(v(ee)&&J>=0&&(e.options.backfacesTerrain||Te(ee,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(r,i,J))){if((l.dist==null||J<l.dist)&&A(l,J,ee),e.options.isFiltered)return;e.options.store===qa.ALL&&(C(m)?(m=Ile(e.ray),A(m,J,ee),e.results.all.push(m)):J<m.dist&&A(m,J,ee)),(o.dist==null||J<o.dist)&&A(o,J,ee),e.options.store!==qa.MIN&&(a.dist==null||J>a.dist)&&A(a,J,ee)}},D=xIt;ge(D,i,E);const k=T.indices,L=T.vertexAttributes,q={data:L.getField(M.POSITION,Ii).typedBuffer,size:3,stride:L.stride/4},G=T.indexCount/3;if(C(p)&&G>H5e){const J=b.renderData;C(J.intersectionData)&&(J.intersectionData=new fI(k,0,G,q)),J.intersectionData.intersectRay({r0:yA,r1:D},R)}else f4(yA,D,0,G,k,q,null,p,R)},x=this._rootTiles;v(x)&&(()=>{const b=this._tileIterator;b.reset(x);const w=e.options.invisibleTerrain;for(;!b.done;){const T=b.next();!(T.visible||w&&T.intersectsClippingArea)||!v(p)&&!T.intersectsRay(r,s,f,g)||d&&this._useStencilForTile(T)?b.skipSubtree():_(T)}})()}prepareTechnique(e){if(e.bindParameters.slot===Ee.OCCLUDED_TERRAIN){if((e.renderOccludedMask&HV)==0)return null}else{const t=this.transparency===Ml.Opaque?Ee.OPAQUE_TERRAIN:Ee.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.output){case V.Color:{this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=v(e.bindParameters.cloudsFade.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty()?Lv.Disabled:this._overlayRenderer.hasWater?Lv.EnabledWithWater:Lv.Enabled;const t=e.bindParameters.slot===Ee.OCCLUDED_TERRAIN?sl.Occluded:sl.ColorAndWater;return this._updateTechnique(V.Color,t===sl.Occluded)}case V.Shadow:case V.ShadowExludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Shadow,!1)):null;case V.Depth:return this.transparency===Ml.Invisible&&this._overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Depth,!1));case V.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Normal,!1);case V.ObjectAndLayerIdColor:return this._updateTechnique(V.ObjectAndLayerIdColor,!1);case V.Highlight:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(V.Highlight,!1)):null}return null}render(e,t){const r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,e.output){case V.Color:{const i=e.bindParameters.slot===Ee.OCCLUDED_TERRAIN?sl.Occluded:sl.ColorAndWater;this.transparency===Ml.Opaque?this._renderMaterialPass(e,t,i):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,t,i),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case V.Shadow:case V.ShadowExludeHighlight:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,sl.None);break;case V.Depth:this.transparency===Ml.Invisible&&this._overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,sl.None);break;case V.Normal:this._renderAuxiliaryPass(e,t,sl.None);break;case V.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,t,sl.ObjectAndLayerIdColor);break;case V.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,t,sl.Highlight)}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,r){const{rctx:i}=e;this._passParameters.overlaySource=r,i.bindTechnique(t,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this._renderPatchGroups(e,t,r),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,r){const i=e.rctx;this._passParameters.overlaySource=r,i.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,r)}updateTileBackground(e=null){if(C(this._tileRenderer))return;const t=this._tileRenderer;let r=null;if(v(e)){const i=Ze.toUnitRGBA(e);r=Fe(i[0]||0,i[1]||0,i[2]||0)}t.setBackground(r),this._allTiles.forAll(i=>t.updateTileTexture(i,ua.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?Qy.GridComposite:v(t.backgroundColor)?Qy.ColorComposite:Qy.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==gF.NONE){const e=Array.from(this._patchGroups.values());e.forEach(t=>b5e(this.renderOrder,t,this._stencilEnabledLayerExtents)),e.sort((t,r)=>Zce(t[0],r[0],this.renderOrder)),this._patchGroups=new Map(e.map(t=>[t[0].renderData.localOrigin,t])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!C(e)){(t=e[0])==null||t.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const t=this._tileIterator;for(t.resetOne(e);!t.done;){const r=t.next(),i=r.renderData;if(!i||r.visible)if(r.rendered){if(i){const s=this._patchGroups.get(i.localOrigin)||new Array;this._patchGroups.set(i.localOrigin,s),s.push(r),(!this._highestVisibleLODTile||r.vlevel>this._highestVisibleLODTile.vlevel)&&(this._highestVisibleLODTile=r),t.skipSubtree()}}else this._numTilesCulled++;else this._numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this._stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,r){const i=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new Ere(n),e.bindParameters,this._passParameters);for(let o=0;o<s.length;o++)this._renderPatch(e,t,s[o],Ut.TRIANGLES,i,r)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,r){const i=e.bindParameters.camera,s=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const c=tNe(this._stage.viewingMode,this._ellipsoidRadius),d=this.pointsOfInterest.centerOnSurfaceFrequent.distance;c.update({distance:d,fovY:i.fovY})}const n=this._stencilEnabledLayerExtents.length>0,o=r===sl.Occluded;o&&(s.bindTexture("tex",this._emptyTex),s.setUniform1f("blend",1),s.setUniform4fv("texOffsetAndScale",u0));const a=v(this._tileRenderer)&&v(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:Ic;this._techniqueConfiguration.tileBlendInput===Qy.ColorComposite&&s.setUniform3fv("backgroundColor",a);const l=this.wireframe?Ut.LINES:Ut.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex),this._patchGroups.forEach(c=>{const d=c[0].renderData.localOrigin;t.program.bindDraw(new Ere(d),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(let p=0;p<c.length;p++){const f=c[p],m=f.renderData.textureReference;if(!C(m)){if(!o){this._scaleRangeQueries.scaleQueriesForTile(f),s.setUniform4fv("texOffsetAndScale",m.offsetAndScale),s.bindTexture("tex",m.texture.texture);const g=f.renderData.textureFadeFactor,_=g<1?f.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&v(_)&&g<1?(s.setUniform1f("fadeFactor",g),s.setUniform4fv("nextTexOffsetAndScale",_.offsetAndScale),s.setUniform3fv("nextTexOpacities",_.opacities),s.bindTexture("texNext",_.texture.texture)):s.setUniform1f("fadeFactor",1),f.renderData.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",m.opacities)}this._renderPatch(e,t,f,l,n,r),f.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}),e.rctx.bindVAO(null)}_renderPatch(e,t,r,i,s,n){const o=r.renderData,a=o.vao,l=a.indexBuffer;if(C(l))return void(ha&&console.error("Rendered tile with no indices: ",r.lij," : ",o));const c=t.program;n!==sl.None&&this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(r),t.bindPipelineState(e.rctx,e.bindParameters.slot));const d=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(i,d,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===V.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(CG,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};u([h({constructOnly:!0})],id.prototype,"_overlayRenderer",void 0),u([h({constructOnly:!0})],id.prototype,"_stage",void 0),u([h({readOnly:!0})],id.prototype,"_isGlobal",null),u([h({constructOnly:!0})],id.prototype,"_allTiles",void 0),u([h({constructOnly:!0})],id.prototype,"_ellipsoidRadius",void 0),u([h({value:!1})],id.prototype,"renderingDisabled",null),u([h()],id.prototype,"renderPatchBorders",null),u([h()],id.prototype,"visualizeNormals",null),u([h()],id.prototype,"cullBackFaces",null),u([h({value:gF.FRONT_TO_BACK})],id.prototype,"renderOrder",null),u([h()],id.prototype,"wireframe",null),id=u([I("esri.views.3d.terrain.TerrainRenderer")],id);const bIt=$(),wIt=$(),yA=$(),xIt=$();class TIt{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let wy=class extends be{constructor(e){super(e),this._handles=new hr}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ie(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Qe(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!ID(t)||t.isRejected())&&!(t.isFulfilled()&&!SIt(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||e9(t)))),e)if(e.isResolved()){const t=TG(e,this.viewSpatialReference,this.viewingMode);if(v(t)){const r=new Ms(t.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Ye.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=Ms.makeWebMercatorAuxiliarySphere(t):wE(e.spatialReference)&&(e=Ms.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ie(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ye.Global){const e=this.extentHelper.viewSpatialReference,t=wE(e)||I0(e)||P0(e);e.isWebMercator?this.tilingScheme=Ms.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=Ms.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;v(e)&&!N2(e,this.extent)&&(this.tilingScheme=Ms.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function SIt(e,t,r){return v(TG(e,t,r))}u([h()],wy.prototype,"tilingScheme",void 0),u([h({readOnly:!0})],wy.prototype,"extent",void 0),u([h({value:!1})],wy.prototype,"tilingSchemeLocked",void 0),u([h({constructOnly:!0})],wy.prototype,"viewSpatialReference",void 0),u([h({constructOnly:!0})],wy.prototype,"layers",void 0),u([h({constructOnly:!0})],wy.prototype,"extentHelper",void 0),u([h({constructOnly:!0})],wy.prototype,"viewingMode",void 0),wy=u([I("esri.views.3d.terrain.TilingSchemeLogic")],wy);class EIt{constructor(){this.offset=rt(),this.scale=0,this.tile=null}init(t,r,i,s){this.tile=t,this.offset[0]=r,this.offset[1]=i,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}let br=class extends $s.EventedMixin(be){constructor(e){var t,r;super(e),this._iteratorPool=new ro(v5e,i=>i.remove=()=>this._iteratorPool.release(i)),this._postorderIterator=new vMt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new TIt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=$(),this._eyePosSurfaceSR=$(),this._splitLimits=new WMt,this._frustum=WN(),this._viewProjectionMatrix=$e(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new hr,this._watchUpdatingTracking=new a0,this._frameTask=SN,this._allTiles=new Qt,this._upsampleInfoPool=new ro(EIt),this._rootTilesExtent=tr(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=Ve.WebMercator,this.visibleElevationBounds=new cM(1/0,-1/0),this.rootTileElevationBounds=new cM(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this._shading=!0,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this._isGlobal=!((r=(t=e.view)==null?void 0:t.state)!=null&&r.isLocal)}initialize(){this._lercDecoder=jOt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new ro($Rt):new ro(DRt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",s=>s.unloadMapData()),this._elevationQueryCache=new VOt(e.newCache("elevation-query")),this._set("overlayManager",new iu({surface:this})),this._handles.add([ie(()=>this.overlayManager.hasHighlights,s=>this._renderer.setNeedsHighlight(s)),ie(()=>this.overlayManager.rendersOccluded,s=>this._renderer.setRenderOccludedOverlay(s))],"overlayManager"),this._renderer=new id({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:Kr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([ie(()=>this.baseOpacity,s=>{this._handleLayerViewChanges(),this._updateBaseOpacity(s)},Qi),ie(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},Qi),ie(()=>this.renderingDisabled,()=>{var s,n;return(n=(s=this.view)==null?void 0:s._stage)==null?void 0:n.renderView.setRenderParameters({terrainRenderingEnabled:!this.renderingDisabled})},bi),ie(()=>this.backgroundColor,s=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(s)},Qi),ie(()=>this.snapLevel,()=>this._viewChanged=!0,bi),ie(()=>this.view.pointsOfInterest,s=>{this._renderer.pointsOfInterest=s,this._watchUpdatingTracking.removeAll(),s&&this._watchUpdatingTracking.add(()=>s.focus.renderLocation,()=>this._allTilesSorted=!1)}),ie(()=>hi.TERRAIN_TILE_TREE_SHOW_TILES,s=>{s&&!this._treeDebugger?re(()=>import("./TerrainTileTree3DDebugger.db6a6344.js"),["assets/TerrainTileTree3DDebugger.db6a6344.js","assets/TileTreeDebugger.5cb7178a.js"]).then(({TerrainTileTree3DDebugger:n})=>{!this._treeDebugger&&hi.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new n({view:this.view}))}):s||(this._treeDebugger=Qe(this._treeDebugger))},pt)]),this._extentHelper=nMt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=new nN({getCollections:()=>{var s,n,o;return(o=(n=(s=this.view)==null?void 0:s.defaultsFromMap)==null?void 0:n.mapCollections)==null?void 0:o.map(({layers:a})=>a)},getChildrenFunction:s=>s&&"layers"in s?s.layers:null}),r=new wy({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",r),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Wy.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Wy.BASEMAP);const i=this.view.resourceController.scheduler;this._frameTask=i.registerTask(Ot.TERRAIN_SURFACE,this),this._handles.add([ie(()=>this._extentHelper.stencilEnabledExtents,s=>this._renderer.setStencilEnabledLayerExtents(s),pt),ie(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),bi),ie(()=>this.extent,()=>this._updateRootTiles(),pt),this.view.on("resize",()=>this._viewChangeUpdate()),ie(()=>{var o,a;const s=this.view,n=s.state;return[this._lodBias,this.lodSnapping,(a=(o=s.resourceController)==null?void 0:o.memoryController)==null?void 0:a.memoryFactor,n.camera,n.contentCamera,n.fixedContentCamera]},()=>this._viewChangeUpdate(),Qi),ie(()=>{var s,n;return(n=(s=this.view.qualitySettings)==null?void 0:s.tiledSurface)==null?void 0:n.textureFadeDuration},s=>this._renderer.textureFadingEnabled=s>0,pt),ie(()=>this._userClippingExtent,()=>this._updateClippingExtent(),bi)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._handles.add([ie(()=>{var s;return(s=this.view)==null?void 0:s.map.ground.shading},()=>{this._updateShadingIfChanged()})]),this._updateShading(),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Di(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Qe(this._upsampleMapCache),this._elevationQueryCache=Qe(this._elevationQueryCache);const e=this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",Qe(this.tilingSchemeLogic)),e.destroy(),this._basemapLayerViewHandles.forEach((t,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Qe(this.overlayManager)),this._tilePool=Qe(this._tilePool),Qce.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=Qe(this._renderer),this._iteratorPool=Qe(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=Qe(this._upsampleInfoPool),eMt(),HMt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,t;if(this.lodSnapping===lL.ON){const r=this.view,i=this.tilingScheme,s=(t=(e=r.pointsOfInterest)==null?void 0:e.contentCameraOnSurface)==null?void 0:t.scale;if(s&&i){const n=r.state.contentCamera;let o=C7(r,n.eye,n.viewForward,n.up).tilt;o>90&&(o=180-o);const a=2*(o/90)**2,l=i.levelAtScale(s)-a;return Math.round(l)}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?lL.ON:lL.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(C(t)||C(e))return null;const r=tr(),i=n5e(t,r,e)?r:null,s=this._get("extent");return N2(i,s)?s:i}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=DK(this.groundExtent,this._userClippingExtent,tr()),t=this._get("extent");return N2(e,t)?t:e}get groundExtent(){return v(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||this._watchUpdatingTracking.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||this.overlayManager.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view.map.ground.opacity}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return v(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get spatialReference(){var e,t;return(t=(e=this.tilingScheme)==null?void 0:e.spatialReference)!=null?t:null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency(this.baseOpacity)}get tilingSchemeLocked(){var e,t;return(t=(e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)!=null?t:!1}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}get wireframe(){return this._renderer.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===Ml.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){var e;return(e=this.view.qualitySettings.tiledSurface.textureFadeDuration)!=null?e:0}intersect(e,t,r,i){this._renderer.intersect(e,t,r,i)}getElevation(e,t,r,i){const s=this.rootTiles;if(C(s)||!s.length||s[0].layerInfo[xr.ELEVATION].length===0)return null;const n=Yc;return n[0]=e,n[1]=t,n[2]=r,So(n,i,n,this._spatialReference)?dbe(s,n[0],n[1]):(te.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,t,r){const i=this.rootTiles,s=i?i[0].layerInfo[xr.ELEVATION].length:0;if(!C(i)&&i.length&&s!==0)for(let n=0;n<t;++n){const o=3*n;r(n,dbe(i,e[o+0],e[o+1]))}else for(let n=0;n<t;++n)r(n,null)}getScale(e){if(this.tilingScheme){if(!fa(e,Yc,this.spatialReference))return te.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(v(t)){for(let r of t)if(r!=null&&r.containsPoint(Yc)){for(;!r.isLeaf&&!r.rendered;){let i=0;Yc[0]>r.children[0].extent[2]&&(i+=1),Yc[1]<r.children[0].extent[1]&&(i+=2),r=r.children[i]}return this._getLodBiasCorrectedScale(r.level)}}}return 1e100}getSphereElevationBounds(e,t,r,i,s){var c;if(Yc[0]=e,Yc[1]=t,Yc[2]=r,Yc[3]=i,!So(Yc,s,Yc,(c=this.tilingScheme)==null?void 0:c.spatialReference))return te.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,o=-1/0;const a=d=>{if(d&&Zpe(d.extent,Yc))if(d.isLeaf||d.rendered)n=Math.min(n,d.elevationBounds[0]),o=Math.max(o,d.elevationBounds[1]);else for(const p of d.children)a(p)},l=this.rootTiles;if(v(l))for(const d of l)a(d);return{min:n,max:o}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!fa(e,Yc,this.spatialReference))return te.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Yc[3]=t;let r=null;const i=n=>{if(n&&Zpe(n.extent,Yc))if(n.isLeaf||n.rendered){const o=this._getLodBiasCorrectedScale(n.level);r=r==null?o:Math.min(r,o)}else for(const o of n.children)i(o)},s=this.rootTiles;if(v(s))for(const n of s)i(n);return r}queryVisibleScaleRange(e,t,r,i){const s=t?this.tilingScheme.levelAtScale(t):0,n=r?this.tilingScheme.levelAtScale(r):1/0,o=this._lodBias;this._renderer.queryVisibleLevelRange(e,s+o,n+o,i)}_evaluateTransparency(e){var s,n;const t=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?Ml.Invisible:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?Ml.Opaque:Ml.Semitransparent,i=t!==r;return i&&(this._renderer.transparency=r,(n=(s=this.view)==null?void 0:s._stage)==null||n.renderView.setRenderParameters({terrainTransparency:this._renderer.transparency})),i}_updateBaseOpacity(e){const t=this._evaluateTransparency(e);this._updateTileTextures(t?ua.UNFADED:ua.IMMEDIATE)}_updateTilingScheme(){var t,r,i,s,n;const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(ky(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((r=(t=this.view)==null?void 0:t.state)!=null&&r.isLocal),this.tilingScheme&&this._removeAllTiles(),this._spatialReference=(i=e==null?void 0:e.spatialReference)!=null?i:Ve.WebMercator,this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()),this._isWebMercator=!!((s=this.tilingScheme)!=null&&s.spatialReference.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&rN((n=this.view)==null?void 0:n.renderSpatialReference))}_acquireTile(e,t,r,i){const s=this._tilePool.acquire();return $U[0]=e,$U[1]=t,$U[2]=r,s.init($U,i,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const r=OIt;let i=t.rootTilesInExtent(e,r,5*ZO);if(v(this.rootTiles)){if(i.length>ZO)return void te.getLogger(this.declaredClass).warn(pdt);const s=this.rootTiles.map(o=>o.lij),n=tze(s,i,ube);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this.rootTiles.filter(a=>!(n.removed.findIndex(l=>ube(l,a.lij))>-1)||(this._purgeTile(a),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,i.length>ZO&&(te.getLogger(this.declaredClass).warn(fdt),i=t.rootTilesInExtent(e,r,ZO)),this._setRootTiles(i.map(s=>this._newRootTile(s)));N2(r,this._rootTilesExtent)||(this._rootTilesExtent=tr(r)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(t=>t.isLoaded&&t.intersectsClippingArea);e.forEach(t=>this._renderer.updateTileGeometryState(t)),e.forEach(t=>t.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(Dv);const t=this.renderer;e.forEach(r=>t.updateGeometryIfNeeded(r)),e.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===St.SPLIT}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(t)&&t.setPendingUpdate(St.SPLIT),this._loadTile(t),this._markTileToUpdate(t),this._updateRootTileElevationBounds(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),v(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(St.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(C(e))return;const t=TMt(e),r=this.visibleElevationBounds;let i=t?r.min:1/0,s=t?r.max:-1/0;const n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(St.GEOMETRY)&&this._updateTileGeometryState(l),l.setPendingUpdate(St.RENDERDATA),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBounds[0],i),s=Math.max(l.elevationBounds[1],s))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(i)&&isFinite(s)&&(r.min!==i||r.max!==s)&&(this.visibleElevationBounds=new cM(i,s))}_updateRootTileElevationBounds(){let e=1/0,t=-1/0;const r=this.rootTiles;v(r)&&r.forEach(({elevationBounds:s})=>{e=Math.min(e,s[0]),t=Math.max(t,s[1])});const i=this.rootTileElevationBounds;i.min===e&&i.max===t||(this.rootTileElevationBounds=new cM(e,t))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,r=Math.tan(.5*t.fovX),i=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=i,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(C(this._splitLimits.frustum)&&(this._splitLimits.frustum=WN()),bV(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,bV(this._frustum,e.frustum),Hs(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),le(this._eyePosRenderSR,t.eye),So(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(W5e(e)?this._loadChildren(e):AIt(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const t=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(r=>{t.add(r)})}_updateTileTexture(e,t){const r=e.resetPendingUpdate(St.TEXTURE_FADING)?St.TEXTURE_FADING:!!e.resetPendingUpdate(St.TEXTURE_NOFADING)&&St.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,t.madeProgress())}_emitElevationUpdateEventForTiles(){const e=gY.extent;kd(e),this._pendingTilesForElevationUpdateEvent.forEach(t=>ox(e,t.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),gY.spatialReference=this.spatialReference,this.emit("elevation-change",gY)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),this._updateElevation(e),this._updateTextures(e),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done?this.requestUpdate():this.getUsedMemory(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();t.reset(this.rootTiles);const r=this.snapLevel,i=this._splitLimits,s=this._eyePosRenderSR;for(;!t.done;){const n=t.next(),o=n.shouldSplit(i,s,r);if(o!==St.SPLIT){if(n.resetPendingUpdate(St.SPLIT)&&n.updateAgentSuspension(),o===St.VSPLITMERGE&&n.updateAgents(xr.ELEVATION),t.skipSubtree(),!n.isLeaf){n.setPendingUpdate(St.MERGE),n.resetPendingUpdate(St.SPLIT);const a=this._iteratorPool.acquire();a.resetOne(n);const l=this._viewProjectionMatrix;for(let c=a.next();!a.done;c=a.next())this._updateClippingStatus(c),c.updateVisibility(),c.updateScreenDepth(l);a.remove()}}else n.resetPendingUpdate(St.MERGE),n.isLeaf&&(n.setPendingUpdate(St.SPLIT),t.skipSubtree()),n.rendered&&n.setPendingUpdate(St.RENDERDATA)}t.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(wMt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){Ne(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const t=Array.from(this._pendingTilesToUpdate.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea),r=(s,n)=>{!(n!=null&&n.isLoaded)||!n.intersectsClippingArea||n.level<s.level||e.has(n)||(e.add(n),t.push(n),n.renderData.updateNeighborData())};t.sort(Dv);const i=t.length;for(let s=0;s<i;++s){const n=t[s];Ne(n.isLoaded),Ne(n.intersectsClippingArea);const o=n.renderData;o.updateNeighborData();const a=o._dirtyEdgeResolutions,l=o.geometryState.neighborData;for(let c=0;c<4;++c)if(a&1<<c){const d=n.renderData.geometryState.neighborData.edgePeerNeighbors[c];d&&(d==null?void 0:d.level)>=n.level&&d.forAllSubtreeOnSide(r9(Ky[c]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&(Ne(e.has(p)||Dv(n,p)<0),r(n,p),!0)),r(n,l.cornerPeerNeighbors[c]),r(n,l.cornerPeerNeighbors[(c+1)%4])}}e.clear(),this._updateTilesGeometries(t),ha&&QV&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1,i=!1;for(;!e.done;){i=!0;let s=!1;const n=!this._allTiles.some(o=>{var l;if(!r&&!o.loadable)return e.done;let a=o;if(o.resetPendingUpdate(St.MERGE)){if(!t)return o.setPendingUpdate(St.MERGE),e.done;for(;(l=a.parent)!=null&&l.resetPendingUpdate(St.MERGE);)a=a.parent;this._mergeTile(a),s=!0,e.madeProgress()}else o.resetPendingUpdate(St.SPLIT)&&(this._splitTile(o),s=!0,e.madeProgress());return!e.done&&a===o&&o.resetPendingUpdate(St.RENDERDATA)&&(this._updateRenderData(o),e.madeProgress()),e.done});if(s&&(this._allTilesSorted=!1,this._allTilesDirty=!0),n){if(!r){r=!0;continue}if(!s)break}else this._allTilesDirty=!0}i||(this._allTilesDirty=!0),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(t=>(t.resetPendingUpdate(St.GEOMETRY)&&(this._updateTileGeometryState(t),this._updateTileTexture(t,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(cn.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*ddt}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,r=_e(e-this._lodBias,0,t.length-1),i=r-Math.floor(r);return t[Math.floor(r)].scale*(1-i)+t[Math.ceil(r)].scale*i}_removeAllTiles(){v(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(e.isLeaf)return!1;let t=!1;for(let r=0;r<4;++r)t=this._purgeTile(e.children[r])||t;return e.unsetChildren(),t}_purgeTile(e){const t=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),t}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){ky(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,r=2*e.lij[1],i=2*e.lij[2];e.setChildren(this._createTile(t,r,i,e),this._createTile(t,r,i+1,e),this._createTile(t,r+1,i,e),this._createTile(t,r+1,i+1,e)),e.setPendingUpdate(St.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){DU.spatialReference=this.spatialReference,DU.extent=e.extent,DU.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",DU)}_createTile(e,t,r,i){ky(!!i,"_createTile sanity check");const s=this._acquireTile(e,t,r,i);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(St.SPLIT),s}get shortBatches(){return this.view.state.mode!==Kn.IDLE}_mergeTile(e){ky(!e.hasPendingUpdate(St.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(ky(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){ky(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(r=>this._loadTile(r)),t.forEach(r=>this._pendingTilesToUpdate.add(r)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t,t.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const r=e.children[t];this._unloadChildren(r),this._unloadTile(r)}}_loadTile(e){e.load(),e.setPendingUpdate(St.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,t,r){const i=new iMt(e.lij,e.extent,r);e.dataArrived(t,xr.ELEVATION,i);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}n===0&&this._updateRootTileElevationBounds(),o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=FI){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const r=new Set;let i=-1;for(const s of this.view.allLayerViews.items)if(r.add(s.uid),pF(s)||o3(s))if(this._basemapLayerViewHandles.has(s.uid)&&!o3(s)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);v(o)&&((o<i||C(i))&&(t=!0),i=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{r.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this._renderer.transparency=this._allSurfaceLayersTransparent()?Ml.Invisible:this._renderer.transparency,this.hasCompositeBlendMode=this._hasCompositeBlendMode(),e.madeProgress()}_allSurfaceLayersTransparent(){var t,r;let e=((r=(t=this.view.map)==null?void 0:t.ground)==null?void 0:r.opacity)===0;for(const i of this.view.allLayerViews.items)if(Bre(i)&&!jAe(i.layer)&&i.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((t9(e)||o3(e))&&MMt(Gre[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return Ure(e)?xr.ELEVATION:xr.MAP}_registerTiledLayerView(e){const t=[];if((t9(e)||o3(e))&&t.push(ie(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(ua.UNFADED)})),o3(e))return;const r=this._layerClassFromLayerView(e);t.push(ie(()=>e.suspended,()=>this._updateTiledLayers())),t.push(ie(()=>e.fullOpacity,()=>this._updateTileTextures(ua.UNFADED))),t.push(ie(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),e.on("data-changed",()=>{const i=this._getLayerIdxByUID(r,e.uid);v(i)&&this._invalidateLayerData(i,r)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let r=0;r<t.length;r++)t[r].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let r=null;e.forEach(i=>{if(!i.layer||i.suspended||!pF(i)||!i.fullExtent)return;const s=this._layerClassFromLayerView(i);if(s===xr.MAP){const n=i.displayLevelRange.maxLevel;n!==1/0&&(r===null||n>r)&&(r=n)}t[s].push(i)});for(const i of VS){const s=this._layerViews[i],n=t[i];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[i].clear();for(let d=0;d<o;d++){const p=n[d].uid;this._layerIndexByUid[i].set(p,d);const f=s.indexOf(n[d]);l[d]=f,d!==f&&(a=!0),f>-1&&(c[f]=d)}if(a){const d=this._postorderIterator;for(d.reset(this.rootTiles);!d.done;)d.next().modifyLayers(c,l,i);this._layerViews[i]=n,this._restartAllAgents(i),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const r=t.next();r.restartAgents(e),e===xr.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(xr.MAP),e===ua.IMMEDIATE?this.renderer.updateTileTexture(t,St.TEXTURE_NOFADING):t.updateRenderData(xr.MAP,e)}),this._renderer.transparency=this._allSurfaceLayersTransparent()?Ml.Invisible:this._renderer.transparency}_invalidateLayerData(e,t){this._allTiles.forAll(r=>r.removeLayerAgent(e,t)),this._allTiles.forAll(r=>r.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=cn.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,r,i){const s=this.layerViewByIndex(t,r),n=s.layer;return!n.tilemapCache||hF(s)?this._requestTileData(e,r,s,i):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...i,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Ir(i),Ps(o)||this._dataMissing(e,r,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,r,s,i),i.signal)))}_requestTileData(e,t,r,i){return t===xr.ELEVATION?Ure(r)?this._requestElevationTileData(e,r,i):Promise.reject():Bre(r)?this._requestMapTileData(e,r,i):Promise.reject()}_requestElevationTileData(e,t,r){++this._asyncWorkItems;const i=o=>{if(Bo(r))return;const a=this._layerIndexByUid[xr.ELEVATION].get(t.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,a,o)):te.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",xr.ELEVATION,e.lij.toString())},s=o=>{Ps(o)||(this._dataMissing(e,xr.ELEVATION,t,o),this.requestUpdate())};if(M1e(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:TN,signal:r.signal}).then(o=>{if(!Bo(r))return this._frameTask.schedule(()=>i(o),r.signal,s);te.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",r).then(o=>this._lercDecoder.decode(o,{noDataValue:TN},r.signal)).then(o=>{o?i({values:o.pixelData,width:o.width,height:o.height,noDataValue:o.noDataValue,minValue:o.minValue,maxValue:o.maxValue}):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,r){++this._asyncWorkItems;const i=(c,d)=>{--this._asyncWorkItems,XM(d),Bo(r)||(this._dataMissing(e,xr.MAP,t,c),this.requestUpdate())},s=c=>d=>i(d,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Bo(r)?XM(c):this._mapTileDataArrived(e,t,c)},r.signal,s(c)).catch(s(c)),o=(c,d=null)=>this._frameTask.schedule(()=>i(c,d));if(hF(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],r).then(n,o)}if(xG(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(n,o);if(Wce(t)&&M1e(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(c=>{if(Bo(r))return te.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(oi());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);Nrt(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,r).then(n,o)}_mapTileDataArrived(e,t,r){const i=this._getLayerIdxByUID(xr.MAP,t.uid);v(i)?e.dataArrived(i,xr.MAP,r):(XM(r),te.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,r,i){const s=this._getLayerIdxByUID(t,r.uid);v(s)?e.dataMissing(s,t,i):te.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const r=t.level;t.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(C(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),v(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=0;const r=this._layerClassFromLayerView(e),i=this._getLayerIdxByUID(r,e.uid);return v(i)&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(r,i)),t}getTile(e){if(C(e)||C(this.rootTiles))return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this.rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const r=2**t[0],i=Math.floor(t[1]/r),s=Math.floor(t[2]/r);let n;if(this.rootTiles.some(o=>o.lij[1]===i&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return ky(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{v(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){mY.clear(),e._allTiles.forAll(r=>{r.visible&&r.rendered&&mY.push(r)});const t=mY.toArray();return b5e(e.renderOrder,t),t},lockTilingScheme(t,r){e._extentHelper.defaultTiledLayersExtent=r,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTilesWaterproofness(){if(!QV)return;const e=this.rootTiles;if(C(e))return;const t=n=>{var o,a,l;return((l=(a=(o=n==null?void 0:n.renderData)==null?void 0:o.geometryInfo)==null?void 0:a.indices)==null?void 0:l.length)>0},r=(n,o)=>{t(n)&&console.error("Tile[",n.lij,"] has geometry although parent[",o.lij,"] has geom")},i=n=>{var o,a,l;if(n.intersectsClippingArea)if(n.renderData&&!n.renderData.geometryState&&console.error("Tile[",n.lij,"] has renderData but not geometryState"),n.renderData&&!n.renderData.geometryInfo&&console.error("Tile[",n.lij,"] has renderData but not geometryInfo"),!((o=n.renderData)!=null&&o.geometryInfo)||((l=(a=n.renderData.geometryInfo.indices)==null?void 0:a.length)!=null?l:0)>0||console.error("Tile[",n.lij,"] has renderData but no indices - geometryInfo: ",n.renderData.geometryInfo),t(n)){n.checkGeometryWaterproofness();for(const c of n.children)r(c,n)}else if(n.isLeaf)console.error("Tile[",n.lij,"] has no geometry and no children, from root to leaf");else for(const c of n.children)i(c)},s=n=>{var c,d;const o=(d=(c=n.parent)==null?void 0:c.visible)!=null?d:!0,a=n.visible;n.computeVisibility();const l=n.visible;if(a!==l&&o&&console.error(" Tile[",n.lij,"] has out of date visibility: ",a," instead of ",l),!n.isLeaf)for(const p of n.children)s(p)};for(const n of e)i(n),s(n)}get isGlobal(){return this._isGlobal}get shading(){return this._shading}_updateShadingIfChanged(){var t,r,i;((i=(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.ground)==null?void 0:i.shading)!==this._shading&&this._updateShading()}_updateShading(){var t,r,i;const e=(i=(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.ground)==null?void 0:i.shading;this._shading=e,this.renderer&&(this.renderer.shading=e,this.renderer.setNeedsRender()),this._updateAllTileGeometries()}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(v(this.spatialReference)&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<t)return e;if(!this.isGlobal)return null;const i=(r+(r<0?t:0))%t;return[e[0],e[1],i]}enableInternalChecks(e){uOt(e)}enableWaterproofnessChecks(e){cOt(e)}};u([h()],br.prototype,"_renderer",void 0),u([h()],br.prototype,"_hasPendingUpdates",void 0),u([h()],br.prototype,"_asyncWorkItems",void 0),u([h()],br.prototype,"_allTilesDirty",void 0),u([h()],br.prototype,"_allTilesSorted",void 0),u([h()],br.prototype,"_viewChanged",void 0),u([h({readOnly:!0})],br.prototype,"_watchUpdatingTracking",void 0),u([h()],br.prototype,"_frameTask",void 0),u([h({readOnly:!0})],br.prototype,"snapLevel",null),u([h({readOnly:!0})],br.prototype,"lodSnapping",null),u([h({constructOnly:!0})],br.prototype,"view",void 0),u([h()],br.prototype,"_userClippingExtent",null),u([h()],br.prototype,"_rootTilesExtent",void 0),u([h({readOnly:!0})],br.prototype,"extent",null),u([h({readOnly:!0})],br.prototype,"groundExtent",null),u([h({readOnly:!0})],br.prototype,"_tilingSchemeExtent",null),u([h({readOnly:!0})],br.prototype,"updating",null),u([h({readOnly:!0})],br.prototype,"running",null),u([h(tMt)],br.prototype,"updatingProgress",void 0),u([h({readOnly:!0})],br.prototype,"updatingProgressValue",null),u([h()],br.prototype,"_maxNumUpdating",void 0),u([h()],br.prototype,"baseOpacity",null),u([h()],br.prototype,"hasCompositeBlendMode",void 0),u([h({readOnly:!0})],br.prototype,"overlayManager",void 0),u([h({readOnly:!0})],br.prototype,"viewingMode",null),u([h()],br.prototype,"maxTextureScale",void 0),u([h({readOnly:!0})],br.prototype,"ready",null),u([h({value:gF.FRONT_TO_BACK})],br.prototype,"renderOrder",null),u([h({readOnly:!0})],br.prototype,"rootTiles",void 0),u([h({readOnly:!0})],br.prototype,"spatialReference",null),u([h({type:Ze})],br.prototype,"backgroundColor",null),u([h({value:!1})],br.prototype,"slicePlaneEnabled",null),u([h({readOnly:!0})],br.prototype,"tilingScheme",void 0),u([h({readOnly:!0})],br.prototype,"tilingSchemeLocked",null),u([h({readOnly:!0})],br.prototype,"tilingSchemeLogic",void 0),u([h({value:!0})],br.prototype,"velvetOverground",null),u([h()],br.prototype,"wireframe",null),u([h({value:!1})],br.prototype,"suspended",null),u([h()],br.prototype,"textureFadeDuration",null),u([h()],br.prototype,"visibleElevationBounds",void 0),u([h()],br.prototype,"rootTileElevationBounds",void 0),u([h()],br.prototype,"_layerViewsDirty",void 0),u([h()],br.prototype,"renderPatchBorders",null),u([h()],br.prototype,"visualizeNormals",null),u([h()],br.prototype,"renderingDisabled",null),br=u([I("esri.views.3d.terrain.TerrainSurface")],br);const CIt=br;function ube(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function W5e(e){return!e.isLeaf&&(e.children.some(t=>t.shouldLoad)||e.children.some(t=>W5e(t)))}function AIt(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const Yc=Lr(),OIt=tr(),$U=[0,0,0],mY=new Qt,gY={spatialReference:null,extent:tr(),context:"ground"},DU={spatialReference:null,extent:null,scale:0};function dbe(e,t,r){var i,s;for(const n of e){if(!n.containsPointXY(t,r))continue;let o=n;for(;o&&!o.renderData;){const l=(t>o.extentMidX?1:0)+(r<o.extentMidY?2:0);o=o.children[l]}const a=(s=(i=o==null?void 0:o.renderData)==null?void 0:i.geometryState.samplerData)!=null?s:null;return vs(t,r,a)}return null}class MIt{constructor(t,r){this.geometryRecord=t,this.renderGeometry=r}}class RIt{constructor(t,r,i){this.operation=t,this.geometryRecord=r,this.states=i}}let W$=class extends be{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,r)=>this.commitLayer(r,e))}commitLayer(e,t){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((i,s)=>{const n=this._ensureGeomRecord(e,s);i.forEach(({geometryRecord:o,operation:a,states:l},c)=>{let d=!1;if(a===ks.UPDATE){const p=n.get(c);if(p){const f=p.renderGeometry;if(l&bo.TRANSFORMATION){const m=this.model.getObject(s);this.model.updateRenderGeometryTransformation(m,o,f)&&(d=!0)}d||t.updates.push({renderGeometry:f,updateType:l})}else Et(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(a===ks.REMOVE||d){const p=n.get(c);p?(t.removes.push(p.renderGeometry),n.delete(c),p.geometryRecord.disposed&&kE.pool.release(p.geometryRecord)):a===ks.REMOVE&&Et(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(a===ks.ADD||d){const p=this.model.getObject(s);if(v(p)){const f=this.model.getRenderGeometry(p,o),m=new MIt(o,f);t.adds.push(f),n.set(c,m)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const r=this._residentGeomRecords.get(e);r&&r.forEach(i=>i.forEach(s=>t.push(s.renderGeometry)))}_objectStateChanged(e,t){for(const r of t.geometryRecords)this._updateOrCreateDirtyRecord(t,r,null,ks.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(bo.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(bo.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(bo.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,ks.UPDATE,bo.VERTEXATTRS)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const r=e.id;for(const i of t.geometryRecords)this._objectGeometryAdded(t,i,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const r=e.id;for(const i of t.geometryRecords)this._objectGeometryRemoved(t,i,r)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((r,i)=>{const s=this.model.getObject(i);s&&s.hasVolativeTransformation()&&r.forEach(n=>{n.renderGeometry.shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach(i=>{this._updateOrCreateDirtyRecord(e,i.geometryRecord,t,ks.UPDATE,bo.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,ks.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,ks.REMOVE)}_updateOrCreateDirtyRecord(e,t,r,i,s=bo.NONE){r=yt(r,this._getParentLayerId(e));const n=e.id,o=t.id,a=this._ensureDirtyRecord(r,n),l=a.get(o);if(l){const c=l.operation;c===ks.REMOVE&&i===ks.ADD&&l.states!==bo.NONE?l.operation=ks.UPDATE:c===ks.REMOVE&&i===ks.ADD||c===ks.ADD&&i===ks.REMOVE?(a.delete(o),l.geometryRecord.disposed&&kE.pool.release(l.geometryRecord)):c!==ks.UPDATE||i!==ks.REMOVE&&i!==ks.UPDATE?(Et((c===ks.REMOVE||c===ks.ADD)&&i===ks.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),l.states|=s):(l.operation=i,l.states|=s)}else a.set(o,new RIt(i,t,s));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}get _hasDirtyGeometryRecords(){return wo(this._dirtyGeomRecords,e=>wo(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}_getParentLayerId(e){return v(e.parentLayer)?e.parentLayer.id:Dze}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((r,i)=>{r.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=i+"."+n;const o=[];s.forEach(a=>{const l=a.operation;o[l]||(o[l]=[]),o[l].push(a.geometryRecord.geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,r)=>t+r.size,0)}}}};u([h({constructOnly:!0})],W$.prototype,"model",void 0),u([h()],W$.prototype,"dirty",void 0),W$=u([I("esri.views.3d.webgl-engine.lib.ModelDirtySet")],W$);const IIt=W$;let n8=class extends be{constructor(){super(...arguments),this.dirtySet=new IIt({model:this}),this._content=new Map,this._originFactory=new Mce(null)}getObject(e){return this._content.get(e)}add(e){const t=e.id;Et(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),VV(e)&&this.dirtySet.layerAdded(e)}remove(e){Et(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),VV(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)v(t)&&(Et(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)Et(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(r=>{r.type===e&&t(r)})}getRenderGeometry(e,t){const{geometry:r,material:i,id:s,shaderTransformation:n,origin:o,instanceParameters:a}=t,l=new hI(r,i,{id:s,boundingInfo:r.boundingInfo,calculateShaderTransformation:n,castShadow:e.castShadow});return l.updateTransformation(c=>e.getCombinedStaticTransformation(t,c)),l.origin=v(o)?o:this._originFactory.getOrigin(l.boundingSphere),l.instanceParameters=a,l}updateRenderGeometryTransformation(e,t,r){if(C(e))return!1;r.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const i=this._originFactory.getOrigin(r.boundingSphere);return r.origin!==i}getStats(){const e={},t=Array.from(this._content.values());for(let r=0;r<yg.COUNT;++r)e[r]=t.filter(i=>i.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([h({constructOnly:!0})],n8.prototype,"dirtySet",void 0),n8=u([I("esri.views.3d.webgl-engine.parts.Model")],n8);class PIt{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let r=0;for(let i=0;i<t.length;i+=2)r+=t[i+1];return r}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=$It(t)}forEachComponent(t){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i],n=s+r[i+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const s=r[i];if(!t(s,s+r[i+1]))return!1}return!0}computeOffsetRanges(t){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let s=0;s<i.length;s+=2){const n=i[s],o=n+i[s+1],a=t[n],l=t[o];r[s]=a,r[s+1]=l-a}return r}}function $It(e){const t=new Array;if(e.length===0)return t;let r=e[0],i=1;for(let s=1;s<e.length;s++){const n=e[s];r+i===n?i+=1:(t.push(r),t.push(i),r=n,i=1)}return t.push(r),t.push(i),t}class DIt extends Y7{constructor(t,r){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=Pse(r);const i=this.count;this.visibility=new PIt(i),this.materialDataBuffer=t.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let s=0;s<i;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return C(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return C(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return C(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((C(this.cachedHighlightRanges)||C(this.cachedDefaultRanges))&&v(this.highlightCounts)){const{highlightRanges:t,defaultRanges:r}=LIt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=r}}}function LIt(e,t,r){const i=[],s=[];let n=r.length,o=r.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(i.length&&i.push(r[n+1]-i[i.length-1]),i.push(r[a])),n=a):(o!==a-1&&(s.length&&s.push(r[o+1]-s[s.length-1]),s.push(r[a])),o=a),!0)),i.length&&i.push(r[n+1]-i[i.length-1]),s.length&&s.push(r[o+1]-s[s.length-1]),{highlightRanges:i,defaultRanges:s}}class Yre extends Y7{constructor(){super(...arguments),this.visible=JM.Hidden}}var JM;u([nl()],Yre.prototype,"renderable",void 0),u([nl()],Yre.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(JM||(JM={}));function NIt(e,t,r,i){if(r>=t)return e;e==null&&(e=FIt());const s=e.isVisibleBit;let n=e.data;const o=Y5e(n),a=r/o|0,l=r-o*a,c=(t-1)/o|0,d=n,p=i===s;if(!(r<d.length*o)&&p){const m=a+1,g=Math.ceil(d.length*1.5),_=c+1;let x=Math.max(m,g);x=Math.min(x,_),n=new Uint32Array(x),n.set(d)}return a<n.length&&(n[a]=UIt(n[a],l,p)),e.data=n,e}function X5e(e,t){if(e==null)return!0;const{isVisibleBit:r,data:i}=e,s=Y5e(i);return t<i.length*s?kIt(r,i,t,s):!e.isVisibleBit}function FIt(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function kIt(e,t,r,i){const s=r/i|0,n=r-s*i;return BIt(t[s],n)===e}function Y5e(e){return e.BYTES_PER_ELEMENT*8}function UIt(e,t,r){return e&~(1<<t)|(r?1:0)<<t}function BIt(e,t){return(e&1<<t)!=0}class zIt{constructor(t,r){this._indices=v(t.indices)?t.indices:tI(t.positions.length/3),this._positions=new Ii(t.positions),this._components=r,this._componentIntersectionData=new Array(r.count)}getComponentAabb(t,r){if(v(this._perComponentAabbs)){for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*t+i];return r}return this._computePerComponentAabbs(),this.getComponentAabb(t,r)}getComponentPositions(t,r){r.indices=this._indices,r.data=this._positions.typedBuffer,r.stride=this._positions.typedBufferStride,r.startIndex=this._components.offsets[t],r.endIndex=this._components.offsets[t+1]}intersect(t,r,i,s,n,o,a){const l={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},c=this._indices,d=this._components.offsets,p=fNe(t,r,VIt),f=t[2],m=r[2];this._components.visibility.forEachComponent(g=>{if(!X5e(this._components.pickability,g))return!0;const _=this.getComponentAabb(g,jIt);if(v(o)){const E=o[g];v(n)?n.componentOffset=E:(t[2]=f-E,r[2]=m-E)}if(v(n)&&n.applyToAabb(_),!ice(_,t,p,i))return!0;const x=d[g]/3,b=d[g+1]/3,w=(E,O,A)=>{a(g,E,Td(O,O,s),A)},T=b-x;return C(n)&&T>H5e?(this._componentIntersectionData[g]==null&&(this._componentIntersectionData[g]=new fI(this._indices,x,b,l)),this._componentIntersectionData[g].intersectRay({r0:t,r1:r},w)):f4(t,r,x,b,c,l,void 0,n,w),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const r=this._indices,i=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<t;a++){const l=n[a],c=n[a+1];let d=1/0,p=1/0,f=1/0,m=-1/0,g=-1/0,_=-1/0;for(let x=l;x<c;x++){const b=r[x]*s,w=i[b],T=i[b+1],E=i[b+2];d=Math.min(d,w),p=Math.min(p,T),f=Math.min(f,E),m=Math.max(m,w),g=Math.max(g,T),_=Math.max(_,E)}this._perComponentAabbs[o++]=d,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=g,this._perComponentAabbs[o++]=_}}get positions(){return this._positions}get indices(){return this._indices}}const VIt=$(),jIt=ao();class GIt{constructor(t,r,i){this.material=t,this.geometry=r,this.meta=i}dispose(){this.material.dispose(),this.geometry.dispose()}}class Z5e extends Y7{constructor(t,r,i,s){super(),this.primitiveType=r,this.parameters=i,this.indexed=s,this.vao=t}}u([nl()],Z5e.prototype,"vao",void 0);function HIt(e,t){return{near:e,far:t}}function C4(e){return e?yF(e,1/0,-1/0):HIt(1/0,-1/0)}function yF(e,t,r){return e.near=t,e.far=r,e}function mI(e,t,r=e){return r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far),r}function LU(e,t){return e.near<=t&&t<=e.far}const Zre={near:0,far:0};function qIt(e,t){const r=C4(),{eye:i,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=v(o.offsetObb)?o.offsetObb:o.obb,l=Te(Pc(oh,a.center,i),n),c=Yj(a,n);if(LU(r,l-c)&&LU(r,l+c))return;const d=JIt(a,s);if(d===-1)return;if(d===0)return h_.far=l+c,h_.near=l-c,void mI(r,h_);const p=NU.pushNew();p.near=l-c,p.far=l+c,p.mask=d,p.object=o});for(let o=0;o<NU.length;o++){const a=NU.data[o];if(LU(r,a.near)&&LU(r,a.far))continue;h_.far=a.far,h_.near=1/0,ZIt(v(a.object.offsetObb)?a.object.offsetObb:a.object.obb,i,WIt,c=>{let d=XIt;for(let p=0;p<J5e&&c.length>0;p++){if((a.mask&1<<p)==0)continue;YIt(s[p],c,d);const f=c;c=d,d=f}for(let p=0;p<c.length;p+=3){ue(lu,c.data[p+0],c.data[p+1],c.data[p+2]);const f=Te(Pc(lu,lu,i),n);h_.near=Math.min(h_.near,f)}})===0&&(h_.near=0),mI(r,h_)}return NU.length=0,r}const NU=new Qt({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=eE(e.object),e)}),h_=C4(),lu=$(),zT=$(),WIt=new Qt({deallocator:null}),XIt=new Qt({deallocator:null});function YIt(e,t,r){r.length=0;const i=t.length-3;yY(lu,t,i);const s=Hi(e,lu);s<=0&&(r.push(lu[0]),r.push(lu[1]),r.push(lu[2]));let n=0,o=s;for(;n<i;n+=3){yY(zT,t,n);const a=Hi(e,zT);o*a<0&&($n(lu,zT,lu,a/(a-o)),cu(r,lu)),a<=0&&cu(r,zT),o=a,le(lu,zT)}o*s<0&&(yY(zT,t,i),$n(lu,zT,lu,s/(s-o)),cu(r,lu))}function yY(e,t,r){return ue(e,t.data[r+0],t.data[r+1],t.data[r+2])}function cu(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function ZIt(e,t,r,i){Yv(pbe,e.quaternion),Pc(oh,t,e.center),Vh(oh,oh,pbe);const s=8*((oh[0]<-e.halfSize[0]?-1:oh[0]>e.halfSize[0]?1:0)+3*(oh[1]<-e.halfSize[1]?-1:oh[1]>e.halfSize[1]?1:0)+9*(oh[2]<-e.halfSize[2]?-1:oh[2]>e.halfSize[2]?1:0)+13),n=hbe[s];if(n===0)return n;Vj(FU,e.quaternion),_ae(FU,FU,e.halfSize);const o=(a,l)=>{const c=hbe[s+l+1];return ue(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),Td(a,a,FU),ye(a,e.center,a)};return r.length=0,cu(r,o(_Y,0)),cu(r,o(fbe,1)),cu(r,o(oh,2)),cu(r,o(mbe,3)),i(r),n===1||(r.length=0,cu(r,_Y),cu(r,mbe),cu(r,o(oh,4)),cu(r,o(gbe,5)),i(r),n===2||(r.length=0,cu(r,_Y),cu(r,gbe),cu(r,o(oh,6)),cu(r,fbe),i(r))),n}const hbe=(()=>{const e=new Int8Array(216);let t=0;const r=i=>{for(let s=0;s<i.length;s++)e[t+s]=i[s];t+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),e})(),J5e=4;function JIt(e,t){let r=0;for(let i=0;i<J5e;i++){const s=MS(e,t[i]);if(s>0)return-1;s===0&&(r|=1<<i)}return r}const FU=Ts(),pbe=wg(),oh=$(),_Y=$(),fbe=$(),mbe=$(),gbe=$();class KIt{constructor(t){this._objects=t}submit(t,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(t,r,i))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?qIt(t,this._objects.visibleObjects):null}}function QIt(e){const t=Ds().vec3f(M.POSITION);return e.normals&&t.vec2i16(M.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===Mn.Default?t.vec2f(M.UV0):e.textureCoordinates===Mn.Atlas&&(t.vec2f(M.UV0),t.vec4u16(M.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(M.COLOR,{glNormalized:!0}),t.alignTo(4)}class ePt extends tn{constructor(t,r){super(t,"int",Ri.Draw,(i,s,n)=>i.setUniform1i(t,r(s,n)))}}var f0;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(f0||(f0={}));const aue=429496.7296;function K5e(e,t){KN(e/aue*.5+.5,t)}function tPt(e,t){switch(t.componentData){case f0.Varying:return rPt(e,t);case f0.Uniform:return iPt(e);case f0.COUNT:return;default:t.componentData}}function rPt(e,t){const{vertex:r,fragment:i}=e;r.include(Vd),r.uniforms.add(ux("componentColorTex",n=>n.componentParameters.texture.texture,t.hasWebGL2Context?vi.None:vi.Size)),e.attributes.add(M.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4");const s=t.output===V.ObjectAndLayerIdColor;s&&e.varyings.add("vObjectAndLayerIdColor","vec4"),e.include(c4e),r.constants.add("elevationScale","float",2*aue),r.constants.add("stride","float",pe("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(S`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${ff(t,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `),r.code.add(S`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${vu(t,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${vu(t,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?S`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${vu(t,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:S`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(S`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?S`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function iPt(e){const{vertex:t,fragment:r}=e;t.uniforms.add(new s9("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new ePt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(S`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(S`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var nf;function sPt(e,t){const r=e.vertex;switch(r.code.add(S`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case nf.None:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) {}`);break;case nf.Opaque:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case nf.Transparent:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(nf||(nf={}));var m0;function czt(e){return e&&I0(e)?m0.Mars:e&&P0(e)?m0.Moon:m0.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(m0||(m0={}));var Mh;(function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"})(Mh||(Mh={}));class Mr extends Yl{constructor(){super(...arguments),this.output=V.Color,this.textureCoordinateType=Mn.None,this.componentData=f0.Uniform,this.cullFace=Xi.Back,this.vertexDiscardMode=nf.None,this.doubleSidedMode=js.WindingOrder,this.alphaDiscardMode=Mi.Opaque,this.integratedMeshMode=Mh.None,this.transparencyPassType=Ct.NONE,this.ellipsoidMode=m0.Earth,this.pbrMode=kt.Disabled,this.normalType=fs.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.useLegacyTerrainShading=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1,this.hasWebGL2Context=!1}}u([j({count:V.COUNT})],Mr.prototype,"output",void 0),u([j({count:Mn.COUNT})],Mr.prototype,"textureCoordinateType",void 0),u([j({count:f0.COUNT})],Mr.prototype,"componentData",void 0),u([j({count:Xi.COUNT})],Mr.prototype,"cullFace",void 0),u([j({count:nf.COUNT})],Mr.prototype,"vertexDiscardMode",void 0),u([j({count:js.COUNT})],Mr.prototype,"doubleSidedMode",void 0),u([j({count:Mi.COUNT})],Mr.prototype,"alphaDiscardMode",void 0),u([j({count:Mh.COUNT})],Mr.prototype,"integratedMeshMode",void 0),u([j({count:Ct.COUNT})],Mr.prototype,"transparencyPassType",void 0),u([j({count:m0.COUNT})],Mr.prototype,"ellipsoidMode",void 0),u([j({count:kt.COUNT})],Mr.prototype,"pbrMode",void 0),u([j({count:fs.COUNT})],Mr.prototype,"normalType",void 0),u([j()],Mr.prototype,"spherical",void 0),u([j()],Mr.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],Mr.prototype,"hasVertexColors",void 0),u([j()],Mr.prototype,"hasNormals",void 0),u([j()],Mr.prototype,"hasSlicePlane",void 0),u([j()],Mr.prototype,"hasBaseColorTexture",void 0),u([j()],Mr.prototype,"receiveAmbientOcclusion",void 0),u([j()],Mr.prototype,"receiveShadows",void 0),u([j()],Mr.prototype,"blendingEnabled",void 0),u([j()],Mr.prototype,"hasScreenSpaceReflections",void 0),u([j()],Mr.prototype,"hasPolygonOffset",void 0),u([j()],Mr.prototype,"hasMetallicRoughnessTexture",void 0),u([j()],Mr.prototype,"hasEmissionTexture",void 0),u([j()],Mr.prototype,"hasOcclusionTexture",void 0),u([j()],Mr.prototype,"hasNormalTexture",void 0),u([j()],Mr.prototype,"hasOccludees",void 0),u([j()],Mr.prototype,"hasMultipassTerrain",void 0),u([j()],Mr.prototype,"cullAboveGround",void 0),u([j()],Mr.prototype,"useLegacyTerrainShading",void 0),u([j()],Mr.prototype,"hasCloudsReflections",void 0),u([j()],Mr.prototype,"snowCover",void 0),u([j()],Mr.prototype,"objectAndLayerIdColor",void 0),u([j()],Mr.prototype,"hasWebGL2Context",void 0),u([j({constValue:Ri.Draw})],Mr.prototype,"pbrTextureBindType",void 0),u([j({constValue:!0})],Mr.prototype,"hasSliceHighlight",void 0),u([j({constValue:!1})],Mr.prototype,"hasSliceInVertexProgram",void 0),u([j({constValue:!1})],Mr.prototype,"useCustomDTRExponentForWater",void 0),u([j({constValue:!1})],Mr.prototype,"hasVertexTangents",void 0),u([j({constValue:!0})],Mr.prototype,"supportsTextureAtlas",void 0),u([j({constValue:!1})],Mr.prototype,"highStepCount",void 0),u([j({constValue:!1})],Mr.prototype,"instancedDoublePrecision",void 0),u([j({constValue:!0})],Mr.prototype,"useFillLights",void 0),u([j({constValue:!1})],Mr.prototype,"objectAndLayerIdColorInstanced",void 0);function ybe(e,t){e.include(fC,t),e.fragment.include(oF);const r=e.fragment;r.uniforms.add(new s9("baseColor",i=>i.baseColor)),r.uniforms.add(new H2("objectOpacity",i=>i.objectOpacity)),t.hasVertexColors?r.code.add(S`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(S`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(S`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function _be(e,t){const r=e.fragment;switch(t.doubleSidedMode){case js.None:r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case js.View:e.include(VM,t),r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case js.WindingOrder:r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case js.COUNT:}switch(t.normalType){case fs.Attribute:case fs.CompressedAttribute:e.include(J7,t),r.code.add(S`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case fs.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(VM,t),r.code.add(S`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case fs.Ground:t.spherical?(e.include(VM,t),r.code.add(S`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(S`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),r.code.add(S`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case fs.COUNT:}}function nPt(e,t){const r=e.fragment;if(t.hasBaseColorTexture&&(t.output===V.Color||t.alphaDiscardMode!==Mi.Opaque)){e.include(fle,t);const i=t.textureCoordinateType===Mn.Atlas;r.uniforms.add(ux("baseColorTexture",s=>s.texture,i?t.hasWebGL2Context?vi.None:vi.Size:vi.None)),i?(e.include(pDe),r.code.add(S`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${ff(t,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):r.code.add(S`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else r.code.add(S`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function oPt(e){const t=new Qr;t.include(VM,e),t.include(J7,e),t.include(fC,e),t.include(h0,e),t.include(UI,e),t.include(tPt,e),t.include(Lxt,e),t.include(Gvt,e),t.include(nPt,e),t.include(sPt,e);const{vertex:r,fragment:i}=t;e.pbrMode!==kt.Normal&&e.pbrMode!==kt.Schematic||(t.include(gle,e),e.hasNormalTexture&&t.include(p4e,e));const s=e.output===V.Shadow||e.output===V.ShadowHighlight||e.output===V.ShadowExludeHighlight;s&&e.componentData===f0.Varying?r.code.add(S`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(S`#define discardShadows(castShadows) {}`);const n=e.integratedMeshMode===Mh.ColorOverlay||e.integratedMeshMode===Mh.ColorOverlayWithWater,o=n&&e.output===V.Color&&e.pbrMode===kt.WaterOnIntegratedMesh;return n&&(t.include(zE,e),t.include(sRt,e),e.spherical?r.code.add(S`
      const float invEllipsoidRadius = ${S.float(1/(e.ellipsoidMode===m0.Earth?Pr.radius:e.ellipsoidMode===m0.Mars?n0.radius:Vv.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(S`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),r.code.add(S`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${S.float(hl)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${e.output===V.ObjectAndLayerIdColor?S`forwardObjectAndLayerIdColor();`:""}
      ${o?e.spherical?S`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:S`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?S`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===V.Alpha&&(i.include(tp),t.include(rp,e),t.include(ybe,e),n&&i.uniforms.add(new Rt("ovColorTex",(a,l)=>qre(a,l))),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?S`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===V.Color&&(i.include(tp),t.include(rp,e),t.include(ybe,e),t.include(_be,e),t.include(zE,e),e.receiveShadows?(t.include(K7,e),i.code.add(S`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(S`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new Rt("ovColorTex",(a,l)=>qre(a,l))),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?S`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===kt.Normal||e.pbrMode===kt.Schematic?(F0(i),i.code.add(S`
        ${e.pbrMode===kt.Normal?S`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),e.hasNormalTexture?i.code.add(S`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(S`vec3 shadingNormal = normalVertex;`),i.code.add(S`${e.spherical?S`vec3 normalGround = normalize(positionWorld());`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(S`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?S`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?i.code.add(S`float shadow = evaluateShadow();`):e.spherical?(HI(i),i.code.add(S`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(S`float shadow = 0.0;`),o&&i.uniforms.add(new Rt("ovNormalTex",(a,l)=>lue(l))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),i.code.add(S`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),i.code.add(S`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?S`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(S`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===Ct.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),(e.output===V.Depth||s)&&(t.include(r1,e),i.code.add(S`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===V.Normal&&(t.include(_be,e),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===fs.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===V.ObjectAndLayerIdColor&&t.fragment.code.add(S`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputObjectAndLayerIdColor();
}`),e.output===V.Highlight&&(t.include(_1,e),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?S`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function lue(e){return e.overlays.length===0?null:e.overlays[Us.INNER].getValidTexture(ln.Water)}const aPt=Object.freeze(Object.defineProperty({__proto__:null,build:oPt,getOverlayNormalTexture:lue},Symbol.toStringTag,{value:"Module"}));class PG extends li{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2,r.spherical=t.viewingMode===Ye.Global,r.doublePrecisionRequiresObfuscation=a4(t.rctx)}initializeProgram(t){return new ti(t.rctx,PG.shader.get().build(this.configuration),Q5e)}_setPipelineState(t){const r=this.configuration,i=r.integratedMeshMode!==Mh.None,s=t===Ct.NONE,n=t===Ct.FrontFace;return Ht({blending:r.output!==V.Color&&r.output!==V.Alpha||!r.blendingEnabled?null:s?qh:v1(t),culling:l7(r.cullFace),depthTest:{func:rT(t)},depthWrite:s||n?$u:null,colorWrite:cr,stencilWrite:i||r.hasOccludees?M0:null,stencilTest:i?Swt(Cu.IntegratedMeshMaskExcluded):r.hasOccludees?iT:null,polygonOffset:s||n?r.hasPolygonOffset?{factor:2,units:2}:null:U7})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}PG.shader=new ei(aPt,()=>re(()=>import("./ComponentShader.glsl.2a00543c.js"),[]));const Q5e=new Map([[M.POSITION,0],[M.NORMAL,1],[M.NORMALCOMPRESSED,1],[M.COLOR,2],[M.UV0,3],[M.UVREGION,4],[M.COMPONENTINDEX,5]]);class lPt extends Zi{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class cue{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function Zs(e={}){return(t,r)=>{var s;const i=(s=t._parameterCount)!=null?s:0;if(t._parameterCount=i+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,r,{get(){return this[i]},set(o){const a=this[i];if(a==null)this[i]=o;else{if(n.equals(a,o))return;n.copy(a,o)}this._setDirty()}})}else Object.defineProperty(t,r,{get(){return this[i]},set(n){this[i]!==n&&(e.dispose&&this[i]&&this[i].dispose(),this[i]=n,this._setDirty())}})}}function vbe(){return(e,t)=>{var i;const r=(i=e._parameterCount)!=null?i:0;e._parameterCount=r+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(r),Object.defineProperty(e,t,{get(){return this[r]},set(s){this[r]!==s&&(this[r]=s,this._setDirty())}})}}class $G{constructor(t){this._low=Ki(),this._high=Ki(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const r=this._low,i=this._high;le(r,t),Pc(i,t,r)}setElements(t,r,i){ue(bbe,t,r,i),this.set(bbe)}get(t){return ye(t,this._low,this._high)}getLowScaled(t){return de(t,this._low,1)}}const bbe=$();class ta extends lPt{constructor(t,r){super(),this.toMapSpace=r,this.baseColor=Rf(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=fi(1,1,.5),this.emissiveFactor=fi(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new o8,this.componentParameters=new vL,this.textureAlphaCutoff=kV,this.alphaDiscardMode=Mi.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=m0.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Mr;const i=new $G(t.position),s=f4e(t.rotationScale);uC(s,s),this.transformNormalGlobalFromModel=Sf(s,s),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=Di(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return v(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return v(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return v(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return v(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,r,i,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetallicRoughnessTexture=v(this.metallicRoughnessTexture),n.hasEmissionTexture=v(this.emissionTexture),n.hasOcclusionTexture=v(this.occlusionTexture),n.hasNormalTexture=v(this.normalTexture),n.transparencyPassType=r.identifier===Lh.Material&&i.transparencyPassType!=null?i.transparencyPassType:Ct.NONE,n.hasMultipassTerrain=r.identifier===Lh.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,n.cullAboveGround=r.identifier===Lh.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?js.View:js.None,n.hasBaseColorTexture=v(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Tc.Transparent||o===Tc.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?dPt(i)?lue(i)?Mh.ColorOverlayWithWater:Mh.ColorOverlay:Mh.NoOverlay:Mh.None,n.useLegacyTerrainShading=this.isIntegratedMesh&&hi.TERRAIN_USE_LEGACY_SHADING,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&C(this.baseColorTexture);return n.pbrMode=n.integratedMeshMode===Mh.ColorOverlayWithWater?kt.WaterOnIntegratedMesh:this.usePBR?a?kt.Schematic:kt.Normal:kt.Disabled,n.normalType=n.integratedMeshMode===Mh.None?n.hasNormals?fs.CompressedAttribute:fs.ScreenDerivative:fs.Ground,n.hasSlicePlane=v(i.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,r.identifier===Lh.ShadowMap?(n.output=V.Shadow,n.vertexDiscardMode=nf.None):r.identifier===Lh.Highlight?(n.output=V.Highlight,n.vertexDiscardMode=nf.None):(this._computeWhichMaterialPass()===Tc.OpaqueAndTransparent?n.vertexDiscardMode=r.transparent?nf.Opaque:nf.Transparent:n.vertexDiscardMode=nf.None,n.output=cPt(r.subPass),r.subPass===Bn.Alpha&&(n.hasOccludees=i.hasOccludees),r.subPass===Bn.Color?(n.receiveAmbientOcclusion=i.ssaoHelper.ready,n.hasOccludees=i.hasOccludees,n.receiveShadows=i.shadowMap.ready,n.hasScreenSpaceReflections=i.ssr.enabled,n.hasCloudsReflections=v(i.cloudsFade.data)):(n.receiveAmbientOcclusion=!1,n.receiveShadows=!1),n.snowCover=this.hasSnowCover(i),r.subPass===Bn.ObjectAndLayerIdColor&&(n.objectAndLayerIdColor=!0)),this._technique=t.releaseAndAcquire(PG,n,this._technique),this._setClean(),this._technique}hasSnowCover(t){return v(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,r,i){if(this.objectOpacity===0)return;const s=i.renderable.geometry,n=i.components,o=i.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Tc.Opaque:t.materialOpaque.submitDraw(this,s,a,o);break;case Tc.Transparent:t.materialTransparent.submitDraw(this,s,a,o);break;case Tc.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,s,a,o),t.materialTransparent.submitDraw(this,s,a,o);break;case Tc.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,s,a,o),uPt(r)&&t.highlightIntegratedMesh.submitDraw(this,s,a,o)}const d=this.componentParameters.castShadows!==No.None;d&&t.shadowMap.submitDraw(this,s,a,o),v(l)&&(t.highlight.submitDraw(this,s,l,o),d&&t.highlightShadowMap.submitDraw(this,s,l,o)),d&&v(c)&&t.defaultShadowMap.submitDraw(this,s,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Tc.IntegratedMesh:this.objectOpacity<1?Tc.Transparent:this.componentParameters.opaqueOverride===No.All?Tc.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Mi.Blend||this.alphaDiscardMode===Mi.MaskBlend?Tc.Transparent:this.componentParameters.transparent===No.None?Tc.Opaque:this.componentParameters.transparent===No.All?Tc.Transparent:Tc.OpaqueAndTransparent}}var Tc,No;u([Zs({vectorOps:DCe})],ta.prototype,"baseColor",void 0),u([Zs()],ta.prototype,"usePBR",void 0),u([Zs()],ta.prototype,"hasParametersFromSource",void 0),u([Zs({vectorOps:rpe})],ta.prototype,"mrrFactors",void 0),u([Zs({vectorOps:rpe})],ta.prototype,"emissiveFactor",void 0),u([Zs({dispose:!0})],ta.prototype,"baseColorTexture",void 0),u([Zs({dispose:!0})],ta.prototype,"metallicRoughnessTexture",void 0),u([Zs({dispose:!0})],ta.prototype,"emissionTexture",void 0),u([Zs({dispose:!0})],ta.prototype,"occlusionTexture",void 0),u([Zs({dispose:!0})],ta.prototype,"normalTexture",void 0),u([Zs()],ta.prototype,"objectOpacity",void 0),u([vbe()],ta.prototype,"commonMaterialParameters",void 0),u([vbe()],ta.prototype,"componentParameters",void 0),u([Zs()],ta.prototype,"textureAlphaCutoff",void 0),u([Zs()],ta.prototype,"alphaDiscardMode",void 0),u([Zs()],ta.prototype,"isIntegratedMesh",void 0),u([Zs()],ta.prototype,"polygonOffsetEnabled",void 0),u([Zs()],ta.prototype,"ellipsoidMode",void 0),u([Zs()],ta.prototype,"hasOccludees",void 0),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(Tc||(Tc={}));class o8 extends cue{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Xi.Back,this.hasSlicePlane=!0}}u([Zs()],o8.prototype,"doubleSided",void 0),u([Zs()],o8.prototype,"cullFace",void 0),u([Zs()],o8.prototype,"hasSlicePlane",void 0);class vL extends cue{constructor(){super(...arguments),this.externalColor=Rf(1,1,1,1),this.externalColorMixMode=Gn.Multiply,this.castShadows=No.All}get transparent(){return this.externalColor[3]<1?No.All:No.None}get opaqueOverride(){return this.externalColorMixMode===Gn.Replace&&this.externalColor[3]===1?No.All:No.None}get visible(){return this.externalColor[3]>0?No.All:No.None}get type(){return f0.Uniform}}u([Zs({vectorOps:DCe})],vL.prototype,"externalColor",void 0),u([Zs()],vL.prototype,"externalColorMixMode",void 0),u([Zs()],vL.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(No||(No={}));class X$ extends cue{constructor(){super(...arguments),this.texture=null,this.transparent=No.None,this.opaqueOverride=No.None,this.castShadows=No.None}get type(){return f0.Varying}}function cPt(e){switch(e){case Bn.Color:return V.Color;case Bn.Alpha:return V.Alpha;case Bn.Depth:return V.Depth;case Bn.Normal:return V.Normal;case Bn.ObjectAndLayerIdColor:return V.ObjectAndLayerIdColor}}function uPt(e){return e.overlays.length!==0&&v(e.overlays[Us.INNER].getValidTexture(ln.Highlight))}function dPt(e){return e.overlays.length!==0&&v(e.overlays[Us.INNER].getColorTextureNoRasterImage())}u([Zs()],X$.prototype,"texture",void 0),u([Zs()],X$.prototype,"transparent",void 0),u([Zs()],X$.prototype,"opaqueOverride",void 0),u([Zs()],X$.prototype,"castShadows",void 0);const o9=Ds().vec3f(M.POSITION).u16(M.COMPONENTINDEX).u16(M.U16PADDING),eke=Ds().vec2u8(M.SIDENESS),wbe=jd(eke),tke=Ds().vec3f(M.POSITION0).vec3f(M.POSITION1).u16(M.COMPONENTINDEX).u8(M.VARIANTOFFSET,{glNormalized:!0}).u8(M.VARIANTSTROKE).u8(M.VARIANTEXTENSION,{glNormalized:!0}).u8(M.U8PADDING,{glPadding:!0}).u16(M.U16PADDING,{glPadding:!0}),Jre=tke.clone().vec3f(M.NORMAL),Kre=tke.clone().vec3f(M.NORMALA).vec3f(M.NORMALB),Qre=new Map([[M.POSITION0,0],[M.POSITION1,1],[M.COMPONENTINDEX,2],[M.VARIANTOFFSET,3],[M.VARIANTSTROKE,4],[M.VARIANTEXTENSION,5],[M.NORMAL,6],[M.NORMALA,6],[M.NORMALB,7],[M.SIDENESS,8]]);function xbe(e,t,r){const i=t/3,s=new Uint32Array(r+1),n=new Uint32Array(r+1),o=(b,w)=>{b<w?s[b+1]++:n[w+1]++};for(let b=0;b<i;b++){const w=e[3*b],T=e[3*b+1],E=e[3*b+2];o(w,T),o(T,E),o(E,w)}let a=0,l=0;for(let b=0;b<r;b++){const w=s[b+1],T=n[b+1];s[b+1]=a,n[b+1]=l,a+=w,l+=T}const c=new Uint32Array(6*i),d=s[r],p=(b,w,T)=>{if(b<w){const E=s[b+1]++;c[2*E]=w,c[2*E+1]=T}else{const E=n[w+1]++;c[2*d+2*E]=b,c[2*d+2*E+1]=T}};for(let b=0;b<i;b++){const w=e[3*b],T=e[3*b+1],E=e[3*b+2];p(w,T,b),p(T,E,b),p(E,w,b)}const f=(b,w)=>{const T=2*b,E=w-b;for(let O=1;O<E;O++){const A=c[T+2*O],R=c[T+2*O+1];let D=O-1;for(;D>=0&&c[T+2*D]>A;D--)c[T+2*D+2]=c[T+2*D],c[T+2*D+3]=c[T+2*D+1];c[T+2*D+2]=A,c[T+2*D+3]=R}};for(let b=0;b<r;b++)f(s[b],s[b+1]),f(d+n[b],d+n[b+1]);const m=new Int32Array(3*i),g=(b,w)=>b===e[3*w]?0:b===e[3*w+1]?1:b===e[3*w+2]?2:-1,_=(b,w)=>{const T=g(b,w);m[3*w+T]=-1},x=(b,w,T,E)=>{const O=g(b,w);m[3*w+O]=E;const A=g(T,E);m[3*E+A]=w};for(let b=0;b<r;b++){let w=s[b];const T=s[b+1];let E=n[b];const O=n[b+1];for(;w<T&&E<O;){const A=c[2*w],R=c[2*d+2*E];A===R?(x(b,c[2*w+1],R,c[2*d+2*E+1]),w++,E++):A<R?(_(b,c[2*w+1]),w++):(_(R,c[2*d+2*E+1]),E++)}for(;w<T;)_(b,c[2*w+1]),w++;for(;E<O;)_(c[2*d+2*E],c[2*d+2*E+1]),E++}return m}class rke{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?pPt:hPt}write(t,r,i){const s=this._edgeHashFunction(i);UU.seed=s;const n=UU.getIntRange(0,255),o=UU.getIntRange(0,this.settings.variants-1),a=.7,l=UU.getFloat(),c=255*(.5*fPt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(r,i.position0),t.position1.setVec(r,i.position1),t.componentIndex.set(r,i.componentIndex),t.variantOffset.set(r,n),t.variantStroke.set(r,o),t.variantExtension.set(r,c)}trim(t,r){return t.slice(0,r)}}const uue=new Float32Array(6),a9=new Uint32Array(uue.buffer),Xw=new Uint32Array(1);function hPt(e){const t=uue;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],Xw[0]=5381;for(let r=0;r<a9.length;r++)Xw[0]=31*Xw[0]+a9[r];return Xw[0]}function pPt(e){const t=uue;t[0]=_A(e.position0[0]),t[1]=_A(e.position0[1]),t[2]=_A(e.position0[2]),t[3]=_A(e.position1[0]),t[4]=_A(e.position1[1]),t[5]=_A(e.position1[2]),Xw[0]=5381;for(let r=0;r<a9.length;r++)Xw[0]=31*Xw[0]+a9[r];return Xw[0]}const Tbe=1e4;function _A(e){return Math.round(e*Tbe)/Tbe}function fPt(e,t){const r=e<0?-1:1;return Math.abs(e)**t*r}class l9{constructor(){this._commonWriter=new rke}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return Jre.createBuffer(t)}write(t,r,i){this._commonWriter.write(t,r,i),ye(kU,i.faceNormal0,i.faceNormal1),xe(kU,kU),t.normal.setVec(r,kU)}trim(t,r){return this._commonWriter.trim(t,r)}}l9.Layout=Jre,l9.glLayout=jd(Jre,1);class c9{constructor(){this._commonWriter=new rke}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return Kre.createBuffer(t)}write(t,r,i){this._commonWriter.write(t,r,i),t.normalA.setVec(r,i.faceNormal0),t.normalB.setVec(r,i.faceNormal1)}trim(t,r){return this._commonWriter.trim(t,r)}}c9.Layout=Kre,c9.glLayout=jd(Kre,1);const kU=$(),UU=new Wp,jS=-1;var u9;function mPt(e,t,r,i=wPt){const s=e.vertices.position,n=e.vertices.componentIndex,o=Zt(i.anglePlanar),a=Zt(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),d=eie.edge,p=d.position0,f=d.position1,m=d.faceNormal0,g=d.faceNormal1,_=bPt(e),x=vPt(e),b=x.length/4,w=t.allocate(b);let T=0;const E=b,O=r.allocate(E);let A=0,R=0,D=0;const k=nze(0,b),L=new Float32Array(b);lze(L,(se,X,F)=>{s.getVec(x[4*X+0],p),s.getVec(x[4*X+1],f),F[X]=Ni(p,f)}),k.sort((se,X)=>L[X]-L[se]);const q=new Array,G=new Array;for(let se=0;se<b;se++){const X=k[se],F=L[X],N=x[4*X+0],B=x[4*X+1],H=x[4*X+2],W=x[4*X+3],K=W===jS;if(s.getVec(N,p),s.getVec(B,f),K)ue(m,_[3*H+0],_[3*H+1],_[3*H+2]),le(g,m),d.componentIndex=n.get(N),d.cosAngle=Te(m,g);else{if(ue(m,_[3*H+0],_[3*H+1],_[3*H+2]),ue(g,_[3*W+0],_[3*W+1],_[3*W+2]),d.componentIndex=n.get(N),d.cosAngle=Te(m,g),yPt(d,c))continue;d.cosAngle<-.9999&&le(g,m)}R+=F,D++,K||gPt(d,l)?(t.write(w,T++,d),q.push(F)):_Pt(d,o)&&(r.write(O,A++,d),G.push(F))}const J=new Float32Array(q.reverse()),ee=new Float32Array(G.reverse());return{regular:{instancesData:t.trim(w,T),lodInfo:{lengths:J}},silhouette:{instancesData:r.trim(O,A),lodInfo:{lengths:ee}},averageEdgeLength:R/D}}function gPt(e,t){return e.cosAngle<t}function yPt(e,t){return e.cosAngle>t}function _Pt(e,t){const r=Eo(e.cosAngle),i=eie.fwd,s=eie.ortho;return n1(i,e.position1,e.position0),r*(Te(At(s,e.faceNormal0,e.faceNormal1),i)>0?-1:1)>t}function vPt(e){const t=e.faces.length/3,r=e.faces,i=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=i[3*a+0],c=i[3*a+1],d=i[3*a+2],p=r[3*a+0],f=r[3*a+1],m=r[3*a+2];s+=l===jS||p<f?1:0,s+=c===jS||f<m?1:0,s+=d===jS||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=i[3*a+0],c=i[3*a+1],d=i[3*a+2],p=r[3*a+0],f=r[3*a+1],m=r[3*a+2];(l===jS||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===jS||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(d===jS||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=d)}return n}function bPt(e){const t=e.faces.length/3,r=e.vertices.position,i=e.faces,s=vY.v0,n=vY.v1,o=vY.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=i[3*l+0],d=i[3*l+1],p=i[3*l+2];r.getVec(c,s),r.getVec(d,n),r.getVec(p,o),ge(n,n,s),ge(o,o,s),At(s,n,o),xe(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(u9||(u9={}));const eie={edge:{position0:$(),position1:$(),faceNormal0:$(),faceNormal1:$(),componentIndex:0,cosAngle:0},ortho:$(),fwd:$()},vY={v0:$(),v1:$(),v2:$()},wPt={anglePlanar:4,angleSignificantEdge:35};function xPt(e){const t=TPt(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return Sbe.updateSettings(e.writerSettings),Ebe.updateSettings(e.writerSettings),mPt(t,Sbe,Ebe)}function TPt(e,t,r,i){if(t){const o=xbe(r,i,e.count);return new SPt(r,i,o,e)}const s=wFe(e.buffer,e.stride/4,{originalIndices:r,originalIndicesLength:i}),n=xbe(s.indices,i,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:o9.createView(s.buffer)}}class SPt{constructor(t,r,i,s){this.faces=t,this.facesLength=r,this.neighbors=i,this.vertices=s}}const Sbe=new l9,Ebe=new c9,uzt=Ds().vec3f(M.POSITION0).vec3f(M.POSITION1),EPt=Ds().vec3f(M.POSITION0).vec3f(M.POSITION1).u16(M.COMPONENTINDEX).u16(M.U16PADDING,{glPadding:!0});class CPt{constructor(t){this._maxCount=t,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this._recycledIndices.push(t)}}class APt{constructor(t,r=1){this._rctx=t,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0,this._texture=new dt(this._rctx,{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.NEAREST,wrapMode:It.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this._data=new Go(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(t,r,i,s,n,o){const a=t*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,s),this._data.set(a,2,n),this._data.set(a,3,o)}setDataElement(t,r,i,s){const n=t*this._fieldCount+r;this._dirty=!0,this._data.set(n,i,s)}resizeToFit(t){const r=t*this._fieldCount;if(r>=this._data.count){const i=Math.ceil((r+1)/this.textureWidth)*this.textureWidth,s=new Go(new ArrayBuffer(4*i));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const t=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>t*r&&this._texture.resize(t,this._data.count/t),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}}const ike=65536;class OPt{constructor(t,r=1){this.textureBuffer=new APt(t,r),this._indexManager=new CPt(ike)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const t=this._indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this._indexManager.release(t)}}class ske{constructor(t,r=1){this._rctx=t,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this._buffers.forEach(t=>t.dispose()),this._buffers=[]}getBuffer(t){for(const i of this._buffers)if(i.availableCount>=t)return i;if(t>ike)return null;const r=new OPt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const t of this._buffers)t.textureBuffer.updateTexture()}}const Cbe=te.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class MPt{constructor(t,r){this._renderManager=t,this._viewingMode=r,this._objects=[new Qt,new Qt],this._renderSubmit=new KIt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=pe("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new ske(t.rctx,2+(this._hasObjectAndLayerId?1:0))}dispose(){Et(this._objects[JM.Hidden].length===0&&this._objects[JM.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const r=new Yre;return r.toMapSpace=t.toMapSpace,r.transform=t.transform,r.obb=zme(t.obb),r.components=new DIt(this._componentBufferManager,t.geometry.componentOffsets),r.renderable=this._createRenderable(t,r.components),r.intersectionGeometry=new zIt(t.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(t){const r=t;this._objects[r.visible].removeUnordered(r),r.dispose(),this._notifyDirty()}setObjectVisibility(t,r){const i=t;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(t){const r=t.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=jo(r,i.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,r){const i=t.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,r){const i=t;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,r){return t.components.visibility.forEachComponent(r)}getComponentCount(t){const r=t,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(t,r){const i=t,s=i.renderable.material,n=i.components,o=n.materialDataBuffer,a=n.materialDataIndices,l={castShadows:!0,pickable:!0,externalColor:ZV(),externalColorMixMode:Gn.Multiply,elevationOffset:0,objectAndLayerIdColor:this._hasObjectAndLayerId?ZV():null},c=o.textureBuffer,d=new Uint8Array(4),p=new Uint32Array(d.buffer);let f=0,m=0,g=0,_=n.verticalOffsets,x=1/0,b=-1/0,w=!1,T=!1,E=0;for(let O=0;O<n.count;O++){if(r(O,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Gn.Replace&&l.externalColor[3]===1),g+=+l.castShadows,cPe(l.externalColor,l.externalColorMixMode,d),d[2]=254&d[2]|+l.castShadows,c.setData(a[O],0,d[0],d[1],d[2],d[3]),w||(w=O>0&&E!==p[0]),E=p[0],T||(T=l.elevationOffset!==0),T&&C(_)&&(_=new Array(O).fill(0)),v(_)&&(_[O]=l.elevationOffset),x=Math.min(x,l.elevationOffset),b=Math.max(b,l.elevationOffset),K5e(l.elevationOffset,d),c.setData(a[O],1,d[0],d[1],d[2],d[3]),this._hasObjectAndLayerId){const A=l.objectAndLayerIdColor;c.setData(a[O],2,A[0],A[1],A[2],A[3])}l.pickable!==X5e(n.pickability,O)&&(n.pickability=NIt(n.pickability,n.count,O,l.pickable))}n.verticalOffsets=T?_:null,i.offsetObb=T?bot(i.obb,x,b,this._viewingMode,v(i.offsetObb)?i.offsetObb:zme(i.obb)):null,w||T||this._hasObjectAndLayerId?(s.componentParameters=new X$,s.componentParameters.castShadows=bY(g,n.count),s.componentParameters.transparent=bY(f,n.count),s.componentParameters.opaqueOverride=bY(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new vL,s.componentParameters.castShadows=l.castShadows?No.All:No.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,r,i,s=!1){t.intersectionGeometry.getComponentAabb(r,i);const n=t,o=n.components.verticalOffsets;if(s||C(o))return i;const a=o[r];if(this._viewingMode===Ye.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=Jmt(a);return l.localOrigin=n.transform.position,l.applyToAabb(i)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,r,i){return t.intersectionGeometry.getComponentPositions(r,i)}intersect(t,r,i,s,n,o){const a=t;v(n)&&(n.localOrigin=a.transform.position);const l=uC(Abe,a.transform.rotationScale);Pc(BU,r,a.transform.position),Pc(zU,i,a.transform.position),Td(BU,BU,l),Td(zU,zU,l);const c=Sf(Abe,l);return a.intersectionGeometry.intersect(BU,zU,s,c,n,a.components.verticalOffsets,o)}addEdges(t,r,i,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return r.addComponentObject(t,n.transform,{center:n.obb.center,radius:tot(n.obb)},a,o,l,i,s)}async extractEdgeInformation(t,r,i){const s=t,n=s.components.visibility;if(n.allInvisible())return{buffer:EPt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=o9.createBuffer(a.count);fG(c.position,a),zx(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const d=c.count,p=this._computeVisibilityIndices(o,n,l,d);return{origin:ws(s.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(t,r,i){let s=0;for(let n=0;n<i.length-1;n++){const o=i[n],a=i[n+1];for(let l=o;l<a;l++){const c=r?r[l]:l;t.set(c,s)}s++}}_computeVisibilityIndices(t,r,i,s){if(t&&r.allVisible())return t;let n=0;r.forEachComponentRange((l,c)=>(n+=i[c]-i[l],!0));const o=Array.isArray(t)?new Array(n):(t==null?void 0:t.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return r.forEachComponentRange((l,c)=>{const d=i[l],p=i[c];for(let f=d;f<p;f++)o[a++]=t?t[f]:f;return!0}),o}addComponentHighlight(t,r){const i=t.components;C(i.highlightCounts)&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(t,r){const i=t.components;if(C(i.highlightCounts))return void Cbe.warn("Removing non-existing highlight.");const s=i.highlightCounts[r],n=i.highlightCounts[i.count];if(s!==0){if(s>1)return i.highlightCounts[r]=s-1,void(i.highlightCounts[i.count]=n-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),n===1?i.highlightCounts=null:i.highlightCounts[i.count]=n-1}else Cbe.warn("Removing non-existing highlight.")}clearHighlights(t){const r=t.components;v(r.highlightCounts)&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[JM.Visible]}_createRenderable(t,r){const i=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=Ur.createVertex(i,ni.STATIC_DRAW,s.vertices.data),a=qi(s.indices,_=>Ur.createIndex(i,ni.STATIC_DRAW,_)),l=jd(QIt(n)),c=new Uint16Array(s.vertices.count);for(let _=0;_<r.count;_++){const x=r.offsets[_],b=r.offsets[_+1],w=r.materialDataIndices[_];if(v(s.indices))for(let T=x;T<b;T++)c[s.indices[T]]=w;else for(let T=x;T<b;T++)c[T]=w}const d=Ur.createVertex(i,ni.STATIC_DRAW,c.buffer),p=new ta(t.transform,t.toMapSpace),f=new Ef(i,Q5e,{data:l,componentIndices:RPt},{data:o,componentIndices:d},a),m=new Z5e(f,Ut.TRIANGLES,n,v(a)),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+d.byteSize+(v(a)?a.byteSize:0)};return new GIt(p,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}}const RPt=jd(Ds().u16(M.COMPONENTINDEX));function bY(e,t){return e===t?No.All:e===0?No.None:No.Some}const Abe=Au(),BU=$(),zU=$();class nke extends Zi{constructor(){super(...arguments),this.opacity=1}}function IPt(e){const t=new Qr;return t.include($f),t.fragment.uniforms.add(new Rt("tex",r=>r.texture)),e.hasOpacityFactor&&t.fragment.uniforms.add(new De("opacity",r=>r.opacity)),t.fragment.code.add(S`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${e.hasOpacityFactor?"* opacity":""};
    }`),t}const PPt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:nke,build:IPt},Symbol.toStringTag,{value:"Module"}));var Dl;(function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"})(Dl||(Dl={}));class tie extends Yl{constructor(){super(...arguments),this.alphaMode=Dl.None,this.hasOpacityFactor=!1}}u([j({count:Dl.COUNT})],tie.prototype,"alphaMode",void 0),u([j()],tie.prototype,"hasOpacityFactor",void 0);class DG extends li{initializeProgram(t){return new ti(t.rctx,DG.shader.get().build(this.configuration),Yr)}initializePipeline(){switch(this.configuration.alphaMode){case Dl.None:return Ht({colorWrite:cr});case Dl.Alpha:return Ht({blending:ma(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:cr});case Dl.PremultipliedAlpha:case Dl.COUNT:return Ht({blending:Pf(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:cr})}}}DG.shader=new ei(PPt,()=>re(()=>import("./Compositing.glsl.1c826441.js"),[]));class oke extends Zi{}function $Pt(){const e=new Qr;return e.include($f),e.fragment.uniforms.add(new Rt("tex",t=>t.texture)),e.fragment.code.add(S`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),e}const DPt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:oke,build:$Pt},Symbol.toStringTag,{value:"Module"}));class LG extends li{initializeProgram(t){return new ti(t.rctx,LG.shader.get().build(),Yr)}initializePipeline(){return Ht({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}LG.shader=new ei(DPt,()=>re(()=>import("./HUDCompositing.glsl.978677c6.js"),[]));class ake extends Zi{}function LPt(){const e=new Qr;return e.include($f),e.fragment.uniforms.add([new Rt("colorTexture",t=>t.colorTexture),new Rt("alphaTexture",t=>t.alphaTexture),new Rt("frontFaceTexture",t=>t.frontFaceTexture)]),e.fragment.code.add(S`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),e}const NPt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:ake,build:LPt},Symbol.toStringTag,{value:"Module"}));class NG extends li{initializeProgram(t){return new ti(t.rctx,NG.shader.get().build(),Yr)}initializePipeline(){return Ht({blending:ma(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:cr})}}NG.shader=new ei(NPt,()=>re(()=>import("./OITCompositing.glsl.aba1869e.js"),[]));class lke extends Zi{constructor(){super(...arguments),this.overlayIndex=Us.INNER,this.opacity=1}}function FPt(){const e=new Qr;return e.include($f),e.fragment.uniforms.add(new Rt("tex",t=>t.texture)),e.fragment.uniforms.add(new w4("overlayIdx",t=>t.overlayIndex)),e.fragment.uniforms.add(new De("opacity",t=>t.opacity)),e.fragment.code.add(S`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`),e}const kPt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:lke,build:FPt},Symbol.toStringTag,{value:"Module"}));class FG extends li{initializeProgram(t){return new ti(t.rctx,FG.shader.get().build(),Yr)}initializePipeline(){return Ht({blending:Pf(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:cr})}}FG.shader=new ei(kPt,()=>re(()=>import("./OverlayCompositing.glsl.6459c921.js"),[]));class UPt{constructor(t,r){this._rctx=t,this._techniqueRepository=r,this._configuration=new tie,this._passParameters=new nke,this._oitParameters=new ake,this._hudParameters=new oke,this._overlayParameters=new lke}dispose(){this._vao=tt(this._vao)}compositeOIT(t,r,i,s){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=s;const n=this._rctx,o=this._techniqueRepository.acquire(NG);n.bindTechnique(o,this._oitParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Ut.TRIANGLE_STRIP,0,da(a,"geometry")),o.release()}compositeHUD(t,r){this._hudParameters.texture=r;const i=this._rctx,s=this._techniqueRepository.acquire(LG);i.bindTechnique(s,this._hudParameters,t);const n=this._ensureVAO();i.bindVAO(n),i.drawArrays(Ut.TRIANGLE_STRIP,0,da(n,"geometry")),s.release()}compositeOverlay(t,r,i,s){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=s;const n=this._rctx,o=this._techniqueRepository.acquire(FG);n.bindTechnique(o,this._overlayParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Ut.TRIANGLE_STRIP,0,da(a,"geometry")),o.release()}composite(t,r,i=Dl.None,s=1){const n=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=r,this._passParameters.opacity=s;const o=this._techniqueRepository.acquire(DG,this._configuration);n.bindTechnique(o,this._passParameters,t);const a=this._ensureVAO();n.bindVAO(a),n.drawArrays(Ut.TRIANGLE_STRIP,0,da(a,"geometry")),o.release()}_ensureVAO(){return C(this._vao)&&(this._vao=Zl(this._rctx)),this._vao}}const BPt=1e4,rie=100,zPt=500,VPt=500,jPt=.1;function GPt(e,t,r){return oce(t,e)*(r[1]-r[0])+r[0]}function HPt(e,t,r){if(t.size<BPt)return QPt.compute(e,t);const i=C4();return r.forAll(s=>{s.isVisible&&mI(i,qPt(e,s))}),i}function qPt(e,t){if(!t.isVisible)return;const r=C4(),i=t.getSpatialQueryAccelerator();return v(i)?WPt(r,e,i):XPt(r,e,t.objects),r}function WPt(e,t,r){const i=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.isVisible,a=r.objectCount;if(a<zPt)yF(zp,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,s,Xm.DepthOrder.FRONT_TO_BACK,zp,(l,c)=>{iie(e,t,l),zp.far=e.near,c.setRange(zp)},n,o),yF(zp,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,s,Xm.DepthOrder.BACK_TO_FRONT,zp,(l,c)=>{iie(e,t,l),zp.near=e.far,c.setRange(zp)},n,o);else{const l=Math.max(Math.min(a,VPt),Math.ceil(a*jPt)),c=r.findClosest(s,Xm.DepthOrder.FRONT_TO_BACK,n,o,l),d=r.findClosest(s,Xm.DepthOrder.BACK_TO_FRONT,n,o,l);c&&d&&(Obe(e,t,c.boundingVolumeWorldSpace.bounds),Obe(e,t,d.boundingVolumeWorldSpace.bounds))}}function XPt(e,t,r){vA.clear(),r.forAll(i=>{i.isVisible&&i.geometryRecords.length!==0&&vA.add(i)}),vA.empty||(vA.sort(t),yF(zp,t.near,Math.min(e.near,t.far)),vA.forEachInDepthRange(zp,Xm.DepthOrder.FRONT_TO_BACK,(i,s)=>{s<e.near&&iie(e,t,i)}),yF(zp,Math.max(e.far,t.near),t.far),vA.forEachInDepthRange(zp,Xm.DepthOrder.BACK_TO_FRONT,(i,s,n)=>{e.far=Math.max(e.far,n)}))}function iie(e,t,r){if(!r.isVisible||!Gw(t.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,s=KPt;r.geometryRecords.forEach(n=>{Hs(s,i,n.getShaderTransformation());const o=xE(s);cke(e,t,n.geometry.boundingInfo,s,o)})}function cke(e,t,r,i,s){if(C(r))return;je(ol,r.center,i);const{eye:n,viewForward:o}=t,a=o[0]*(ol[0]-n[0])+o[1]*(ol[1]-n[1])+o[2]*(ol[2]-n[2]);if(ol[3]=r.radius*s,!(a-ol[3]>e.near&&a+ol[3]<e.far)&&Gw(t.frustum,ol))if(r.radius>rie&&r.getChildren()){const l=r.getChildren();for(let c=0;c<8;++c)l[c]&&cke(e,t,l[c],i,s)}else sie.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function Obe(e,t,r){const i=t.eye,s=t.viewForward,n=(r[0]-i[0])*s[0]+(r[1]-i[1])*s[1]+(r[2]-i[2])*s[2];e.near=Math.min(e.near,n-r[3]),e.far=Math.max(e.far,n+r[3])}class YPt{constructor(){this._items=new Qt({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const r=t.eye,i=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-r[0])*i[0]+(n[1]-r[1])*i[1]+(n[2]-r[2])*i[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,r,i){if(r===Xm.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||i(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||i(n.obj,n.near,n.far)}}}class ZPt{constructor(){this._view=$e(),this._viewProj=$e(),this._frustum=WN(),this._geometries=[],this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._range={near:0,far:0},this._looseRange={near:0,far:0}}compute(t,r){this._reset(),jn(this._view,t.viewMatrix),Hs(this._viewProj,t.projectionMatrix,this._view),bV(this._frustum,t.frustum);const i=this._view,s=i[2],n=i[6],o=i[10],a=i[14],l=this._range;let c=0;if(r.forEach(m=>{if(!m.instanceParameters.visible||!m.castShadow)return;let g;m.hasShaderTransformation?(m.computeBoundingSphere(m.getShaderTransformation(),ol,1),g=ol):g=m.boundingSphere;const _=s*g[0]+n*g[1]+o*g[2]+a,x=_-g[3],b=_+g[3];this._geometries[c]=m,this._near[c]=-b,this._far[c]=-x,++c}),this._geometries.length===0)return l;for(let m=0;m<this._geometries.length;++m)this._near[m]>l.far&&(l.far=this._near[m]),this._near[m]>2&&this._far[m]<l.near&&(l.near=this._far[m]);const d=this._looseRange;d.near=Math.max(.5*l.near,2),d.far=2*l.far;let p=0,f=0;for(let m=0;m<this._geometries.length;++m)this._near[m]<l.near&&(this._near[m]>=d.near?l.near=this._near[m]:this._nearCandidates[p++]=m),this._far[m]>l.far&&(this._far[m]<=d.far?l.far=this._far[m]:this._farCandidates[f++]=m);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((m,g)=>this._near[m]<this._near[g]?-1:this._near[m]>this._near[g]?1:0),this._farCandidates.sort((m,g)=>this._far[m]<this._far[g]?1:this._far[m]>this._far[g]?-1:0);for(let m=0;m<this._nearCandidates.length;++m){const g=this._nearCandidates[m];if(this._near[g]<l.near){const _=this._geometries[g],x=_.boundingInfo;this._includeNearBoundingInfoRec(x,_.getShaderTransformation())}}for(let m=0;m<this._farCandidates.length;++m){const g=this._farCandidates[m];if(this._far[g]>l.far){const _=this._geometries[g],x=_.boundingInfo;this._includeFarBoundingInfoRec(x,_.getShaderTransformation())}}return l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0,this._range.near=Number.MAX_VALUE,this._range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(t,r){if(C(t))return;const i=t.getCenter();je(ol,i,r);const s=xE(r),n=ol[0],o=ol[1],a=ol[2],l=t.getBSRadius()*s,c=this._frustum;if(c[0][0]*n+c[0][1]*o+c[0][2]*a+c[0][3]>l||c[1][0]*n+c[1][1]*o+c[1][2]*a+c[1][3]>l||c[2][0]*n+c[2][1]*o+c[2][2]*a+c[2][3]>l||c[3][0]*n+c[3][1]*o+c[3][2]*a+c[3][3]>l)return;const d=this._view[2]*n+this._view[6]*o+this._view[10]*a+this._view[14],p=d+l;if(!(-(d-l)<2||-p>=this._range.near))if(-p>this._looseRange.near)this._range.near=-p;else{if(l>rie){const f=t.getChildren();if(f!==void 0){for(let m=0;m<8;++m)f[m]!==void 0&&this._includeNearBoundingInfoRec(f[m],r);return}}sie.unionDepthRangeWithAABB(this._range,this._viewProj,r,t.getBBMin(),t.getBBMax())}}_includeFarBoundingInfoRec(t,r){if(C(t))return;let i=t.getBSRadius();const s=t.getCenter();je(ol,s,r);const n=xE(r),o=ol[0],a=ol[1],l=ol[2];i*=n;const c=this._frustum;if(c[0][0]*o+c[0][1]*a+c[0][2]*l+c[0][3]>i||c[1][0]*o+c[1][1]*a+c[1][2]*l+c[1][3]>i||c[2][0]*o+c[2][1]*a+c[2][2]*l+c[2][3]>i||c[3][0]*o+c[3][1]*a+c[3][2]*l+c[3][3]>i)return;const d=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14]-i;if(!(-d<=this._range.far))if(-d<this._looseRange.far)this._range.far=-d;else{if(i>rie){const p=t.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&this._includeFarBoundingInfoRec(p[f],r);return}}sie.unionDepthRangeWithAABB(this._range,this._viewProj,r,t.getBBMin(),t.getBBMax())}}}class JPt{constructor(){this._modelViewProj=$e(),this._clipPosition=[Lr(),Lr(),Lr(),Lr(),Lr(),Lr(),Lr(),Lr()]}unionDepthRangeWithAABB(t,r,i,s,n){const o=this._modelViewProj;Hs(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],d=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*d+o[4]*p+o[8]*f+o[12],c[1]=o[1]*d+o[5]*p+o[9]*f+o[13],c[2]=o[2]*d+o[6]*p+o[10]*f+o[14],c[3]=o[3]*d+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[wY[l][0]],d=this._clipPosition[wY[l][1]],p=this._clipPosition[wY[l][2]],f=this._clipTriangle(c,d,p);let m=!0;for(let g=0;g<f.length;++g)if(f[g][3]>=2){m=!1;break}if(!m){a=!0;for(let g=0;g<f.length;++g){const _=f[g][3];Number.isFinite(_)&&(t.near=Math.min(_,t.near),t.far=Math.max(_,t.far))}}}return a}_inside(t,r){return r===0?t[0]>=-t[3]:r===1?t[1]>=-t[3]:r===2?t[0]<=t[3]:r===3?t[1]<=t[3]:void Et(!1)}_intersect(t,r,i){let s=0;return i===0?s=(-t[3]-t[0])/(r[0]-t[0]+r[3]-t[3]):i===1?s=(-t[3]-t[1])/(r[1]-t[1]+r[3]-t[3]):i===2?s=(t[3]-t[0])/(r[0]-t[0]-r[3]+t[3]):i===3&&(s=(t[3]-t[1])/(r[1]-t[1]-r[3]+t[3])),K9(Lr(),t,r,s)}_clipTriangle(t,r,i){let s=[t,r,i];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const wY=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],ol=qo(),KPt=$e(),zp=C4(),vA=new YPt,QPt=new ZPt,sie=new JPt;class e3t{}class t3t extends Zi{constructor(){super(...arguments),this.textures=new e3t}}function r3t(){const e=new Qr;return e.attributes.add(M.POSITION,"vec2"),e.vertex.uniforms.add(new Tr("drawPosition",(t,r)=>i3t(t,r))),e.varyings.add("vUV","vec2"),e.vertex.code.add(S`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new Rt("textureInput",t=>t.textures.input)),e.fragment.uniforms.add(new Rt("textureMask",t=>t.textures.mask)),e.fragment.uniforms.add(new Rt("textureOverlay",t=>t.textures.overlay)),e.fragment.uniforms.add(new Mv("maskEnabled",t=>t.magnifier.maskEnabled)),e.fragment.uniforms.add(new Mv("overlayEnabled",t=>t.magnifier.overlayEnabled)),e.fragment.code.add(S`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}function i3t(e,t){const r=t.camera.pixelRatio,i=e.magnifier.offset.x*r,s=e.magnifier.offset.y*r;Vy(e.magnifier.position,Mbe);const n=t.camera.screenToRender(Mbe,s3t),o=Math.ceil(r*e.magnifier.size),a=t.camera.fullWidth,l=t.camera.fullHeight;return Oi(n3t,(n[0]+i)/a*2-1,(n[1]-s)/l*2-1,o/a*2,o/l*2)}const Mbe=Vs(),s3t=hOe(),n3t=Lr();async function o3t(e){const t=re(()=>import("./mask-svg.517894a6.js"),[]),r=re(()=>import("./overlay-svg.94683938.js"),[]),i=A0((await t).default,{signal:e}),s=A0((await r).default,{signal:e}),n={mask:await i,overlay:await s};return Ir(e),n}let _O=class extends be{constructor(){super(...arguments),this._handles=new hr,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new t3t,this.events=new $s,this.attributeLocations=new Map([[M.POSITION,0]]),this._tmpScreenPoint=Vs(),this._tmpRenderPoint=hOe()}get updating(){return C(this._imageSources)&&v(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};v(this._magnifier)&&this._handles.add(ie(()=>qi(this._magnifier,r=>r.version),t)),t()}get enabled(){return v(this._validMagnifier)}get _validMagnifier(){return v(this._magnifier)&&this._magnifier.visible&&v(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get _factor(){return v(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),v(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const r=this._validMagnifier;if(C(r))return;const i=t.camera.pixelRatio,s=Math.ceil(i*r.size);if(this._updateResources(e,s),C(this._resources))return;const n=this._passParameters.textures,o=Math.ceil(1/this._factor*s);n.input.resize(o,o),Vy(r.position,this._tmpScreenPoint);const a=t.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),l=t.camera.fullWidth,c=t.camera.fullHeight,d=.5*o,p=.5*o;a[0]=_e(a[0],d,l-d-1),a[1]=_e(a[1],p,c-p-1);const f=Math.floor(a[0]-d),m=Math.floor(a[1]-p),g=this._resources.program;g.bindTexture("textureInput",n.input),e.gl.copyTexImage2D(n.input.descriptor.target,0,n.input.descriptor.pixelFormat,f,m,o,o,0),this._passParameters.magnifier=r,e.useProgram(g),g.bindPass(this._passParameters,t),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Ut.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(C(e))return;const t=e.maskUrl,r=e.overlayUrl;!v(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),v(this._imageSources)||v(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:r,task:VF(async i=>{const s=C(t)||C(r)?o3t(i):null,n=v(t)?A0(t,{signal:i}):s.then(a=>a.mask),o=v(r)?A0(r,{signal:i}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(v(this._resources)){if(this._passParameters.textures.size!==t){const i=this._createTextureResources(e,t);if(C(i))return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=i}return}const r=this._createTextureResources(e,t);C(r)||(this._resources={program:this._createProgram(e),vao:Zl(e,dle,this.attributeLocations,0,1),pipelineState:Ht({blending:Pf(Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:cr})},this._passParameters.textures=r)}_disposeResources(){C(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(C(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const r=new dt(e,{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,internalFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.LINEAR,flipped:!0,preMultiplyAlpha:!une(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),i=new dt(e,{target:xt.TEXTURE_2D,pixelFormat:qe.ALPHA,internalFormat:qe.ALPHA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.LINEAR,flipped:!0},this._imageSources.mask);return{input:new dt(e,{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,internalFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.LINEAR,flipped:!1}),mask:i,overlay:r,size:t}}_createProgram(e){return new ti(e,r3t(),this.attributeLocations)}};u([h()],_O.prototype,"_imageSources",void 0),u([h()],_O.prototype,"_imageLoadTask",void 0),u([h({readOnly:!0})],_O.prototype,"updating",null),_O=u([I("esri/views/3d/webgl-engine/lib/MagnifierHelper")],_O);class a3t{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Go(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(t,r,i,s,n,o=null,a=null,l=null){if(!(t&&r&&i&&s)||(this._layerUidToId.set(s,i),this._layerUidToPopupEnabled.set(s,n),!n))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(r,{objectId:t,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(t){const r=this.getObjectAndLayerIdColorArray(t);return ar(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(t){if(!t.layerUid||!t.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(t.layerUid);if(r===void 0)return te.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+t.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(t.layerUid);i||(i=new Map,this._uidToRenderColor.set(t.layerUid,i));let s=i.get(t.graphicUid);if(!s){for(;!s;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(s=o)}if(s>16777215)throw new Error("Object ID Overflow");i.set(t.graphicUid,s),this._colorToUID.set(s,t)}const n=new ArrayBuffer(4);return new DataView(n).setUint32(0,s,!1),new Go(n)}getColorToObjectAndLayerIdMapping(){const t=new Map;for(const[r,i]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let n=null;s?(n=s.get(i.graphicUid),n||te.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):te.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||te.getLogger(this.declaredClass).warn("no layerId found for uid "+i.layerUid),n&&o&&t.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:o,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:o})}return t}}const l3t=.5,c3t=30,Rbe=1e3/1,u3t=1e3/c3t;var _F;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(_F||(_F={}));class ob{constructor(t,r,i=_F.FrontToBack){this._rctx=t,this._techniqueRepository=r,this._sorting=i,this._draws=new Qt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,r,i,s){const n=this._draws.pushNew();n.geometry=r,n.geometryRanges=i,n.material=t,n.depthSquaredHint=s,n.indexType=r.indexed?r.vao.indexBuffer.indexType:0}dispatch(t,r){const i=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,r,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===Ct.NONE||(i.bindTechnique(l,t,r),s=l);const c=this._draws.data[a],d=c.geometry;i.bindVAO(d.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,t),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=a8.get(c.indexType);for(let g=0;g<f;g+=2){const _=p[g],x=p[g+1];i.drawElements(d.primitiveType,x,c.indexType,_*m)}}else for(let m=0;m<f;m+=2){const g=p[m],_=p[m+1];i.drawArrays(d.primitiveType,g,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===_F.FrontToBack?1:-1;this._draws.sort((r,i)=>{const s=t*(r.depthSquaredHint-i.depthSquaredHint);return s!==0?s:r.geometry.vao.size-i.geometry.vao.size})}get count(){return this._draws.length}}const a8=new Map;a8.set(mt.UNSIGNED_BYTE,1),a8.set(mt.UNSIGNED_SHORT,2),a8.set(mt.UNSIGNED_INT,4);class d3t{constructor(t,r){this.rctx=t,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new tRt,this._shadowPassParameters=new rRt,this._highlightPassParameters=new iRt,this._systems=new Set,this._passes={materialOpaque:new ob(t,r),materialTransparent:new ob(t,r,_F.BackToFront),materialIntegratedMesh:new ob(t,r),shadowMap:new ob(t,r),highlight:new ob(t,r),highlightIntegratedMesh:new ob(t,r),highlightShadowMap:new ob(t,r),defaultShadowMap:new ob(t,r)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,t.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),t.bindParameters.slot){case Ee.OPAQUE_MATERIAL:switch(t.output){case V.Color:return this._materialPassParameters.subPass=Bn.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case V.Depth:return this._materialPassParameters.subPass=Bn.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case V.Normal:return this._materialPassParameters.subPass=Bn.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case V.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case V.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case V.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case V.ShadowExludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case V.ObjectAndLayerIdColor:return this._materialPassParameters.subPass=Bn.ObjectAndLayerIdColor,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters)}return;case Ee.TRANSPARENT_MATERIAL:switch(t.output){case V.Color:return this._materialPassParameters.subPass=Bn.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case V.Alpha:return this._materialPassParameters.subPass=Bn.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case V.Depth:return this._materialPassParameters.subPass=Bn.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case V.Normal:return this._materialPassParameters.subPass=Bn.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case V.ObjectAndLayerIdColor:return this._materialPassParameters.subPass=Bn.ObjectAndLayerIdColor,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case Ee.INTEGRATED_MESH:switch(t.output){case V.Color:return this._materialPassParameters.subPass=Bn.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case V.Depth:return this._materialPassParameters.subPass=Bn.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case V.Normal:return this._materialPassParameters.subPass=Bn.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case V.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters);case V.ObjectAndLayerIdColor:return this._materialPassParameters.subPass=Bn.ObjectAndLayerIdColor,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL,Ee.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const s=i.queryShadowCasterDepthRange(t);v(s)&&mI(r,s,r)}),r}_configure(t){const r=t.output===V.Shadow||t.output===V.ShadowHighlight||t.output===V.ShadowExludeHighlight?this._shadowPassParameters:t.output===V.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,r)}_updateParameters(t,r){const i=t.bindParameters.camera,s=i.viewInverseTransposeMatrix;ue(xY,s[3],s[7],s[11]),TY.set(xY),le(r.transformWorldFromViewTH,TY.high),le(r.transformWorldFromViewTL,TY.low),le(r.slicePlaneLocalOrigin,xY),Tf(r.transformViewFromCameraRelativeRS,i.viewMatrix),jn(r.transformProjFromView,i.projectionMatrix),r.identifier===Lh.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===Ee.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===Ee.INTEGRATED_MESH,Sf(Ibe,r.transformViewFromCameraRelativeRS),uC(r.transformNormalViewFromGlobal,Ibe))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const xY=$(),Ibe=Ts(),TY=new $G,h3t=8.6,p3t=.4;function f3t(){const e=new Qr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(M.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(M.UV0,"vec2"),t.uniforms.add(new Rt("coverageTex",n=>n.coverageTexture)),i.add(S`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new Rt("tex",n=>n.blurColorTexture)),r.uniforms.add(new Rt("origin",n=>n.highlightColorTexture)),r.uniforms.add(new Tr("uColor",n=>n.color)),r.uniforms.add(new Tr("haloColor",n=>n.haloColor)),r.uniforms.add(new Tr("opacities",n=>Oi(m3t,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),r.constants.add("outlineSize","float",h3t),r.constants.add("blurSize","float",p3t),s.add(S`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const m3t=Lr(),g3t=Object.freeze(Object.defineProperty({__proto__:null,build:f3t},Symbol.toStringTag,{value:"Module"}));class kG extends li{initializeProgram(t){return new ti(t.rctx,kG.shader.get().build(),Yr)}initializePipeline(){return Ht({blending:ma(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:cr})}}kG.shader=new ei(g3t,()=>re(()=>import("./HighlightApply.glsl.73d39da9.js"),[]));class uke extends Zi{constructor(){super(...arguments),this.blurSize=rt()}}function y3t(){const e=new Qr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(M.POSITION,"vec2"),e.attributes.add(M.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new Rt("coverageTex",n=>n.coverageTexture)),r.uniforms.add(new RN("blurSize",n=>n.blurSize)),i.add(S`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new n4("tex",n=>n.blurInputTexture)),s.add(S`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const _3t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:uke,build:y3t},Symbol.toStringTag,{value:"Module"}));class UG extends li{initializeProgram(t){return new ti(t.rctx,UG.shader.get().build(),Yr)}initializePipeline(){return Ht({colorWrite:cr})}}UG.shader=new ei(_3t,()=>re(()=>import("./HighlightBlur.glsl.ba1a6ded.js"),[]));class dke extends Zi{constructor(){super(...arguments),this.invFramebufferDim=rt()}}function v3t(){const e=new Qr,{vertex:t,fragment:r}=e,i=t.code,s=r.code;return e.attributes.add(M.POSITION,"vec2"),i.add(S`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new n4("tex",n=>n.inputTexture)),r.uniforms.add(new RN("invFramebufferDim",n=>n.invFramebufferDim)),s.add(S`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const b3t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:dke,build:v3t},Symbol.toStringTag,{value:"Module"}));class BG extends li{initializeProgram(t){return new ti(t.rctx,BG.shader.get().build(),Yr)}initializePipeline(){return Ht({colorWrite:cr})}}BG.shader=new ei(b3t,()=>re(()=>import("./HighlightDownsample.glsl.dd4757ab.js"),[]));class Pbe extends Zi{constructor(){super(...arguments),this.color=Rf(1,0,1,1),this.haloColor=Rf(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=ar(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const w3t=32;class x3t{constructor(t,r){this._techniqueRep=t,this._rctx=r,this._viewportToRestore=Lr(),this._passParameters=new Pbe,this._downsampleDrawParameters=new dke,this._blurDrawParameters=new uke,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=Zl(this._rctx);const t={colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE,width:0,height:0},r={target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.LINEAR,wrapMode:It.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new ps(this._rctx,t,r),this._blur1Fbo=new ps(this._rctx,t,r),this._blurTechnique=this._techniqueRep.acquire(UG),this._downsampleTechnique=this._techniqueRep.acquire(BG),this._applyTechnique=this._techniqueRep.acquire(kG)}dispose(){if(this._blurTechnique=Di(this._blurTechnique),this._downsampleTechnique=Di(this._downsampleTechnique),this._applyTechnique=Di(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._blur0Fbo=tt(this._blur0Fbo),this._blur1Fbo=tt(this._blur1Fbo)}setDefaultOptions(t){this._passParameters={...new Pbe,...t}}render(t,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const s=t.camera;jm(this._viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const d=this._rctx;d.bindVAO(this._quadVAO);let p=null;this._gridUpdateResources(r,w3t),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=d.bindTechnique(this._blurTechnique,this._passParameters,t);d.bindVAO(p),d.bindFramebuffer(this._blur0Fbo),d.setViewport(0,0,l,c),d.setClearColor(0,0,0,0),d.clear(ds.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,mr(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,t,this._passParameters),d.drawArrays(this._blurTechnique.primitiveType,0,da(p,"geometry")),d.bindFramebuffer(this._blur1Fbo),d.clear(ds.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,mr(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,t,this._passParameters),d.drawArrays(this._blurTechnique.primitiveType,0,da(p,"geometry")),d.bindFramebuffer(i),d.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,d.bindTechnique(this._applyTechnique,this._passParameters,t),d.drawArrays(this._applyTechnique.primitiveType,0,da(p,"geometry")),d.bindVAO(null)}_gridUpdateResources(t,r){const i=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==r&&(s.cellPixelSize=r,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],d={target:xt.TEXTURE_2D,pixelFormat:qe.RGB,dataType:Nt.UNSIGNED_SHORT_5_6_5,samplingMode:at.LINEAR,wrapMode:It.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new ps(i,p,d)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,d=1/o,p=1/a,f=6,m=4,g=new Float32Array(f*m*l*c);let _=0;for(let x=0;x<l;x++)for(let b=0;b<c;b++)g[_+0]=(b-.5)*p*2-1,g[_+1]=(x-.5)*d*2-1,g[_+2]=b*p,g[_+3]=x*d,g[_+4]=(b+.5)*p*2-1,g[_+5]=(x-.5)*d*2-1,g[_+6]=b*p,g[_+7]=x*d,g[_+8]=(b-.5)*p*2-1,g[_+9]=(x+.5)*d*2-1,g[_+10]=b*p,g[_+11]=x*d,g[_+12]=(b-.5)*p*2-1,g[_+13]=(x+.5)*d*2-1,g[_+14]=b*p,g[_+15]=x*d,g[_+16]=(b+.5)*p*2-1,g[_+17]=(x-.5)*d*2-1,g[_+18]=b*p,g[_+19]=x*d,g[_+20]=(b+.5)*p*2-1,g[_+21]=(x+.5)*d*2-1,g[_+22]=b*p,g[_+23]=x*d,_+=f*m;s.vao&&s.vao.dispose(!0),s.vao=new Cf(i,Yr,{geometry:kI},{geometry:Ur.createVertex(i,ni.STATIC_DRAW,g)})}}_gridComputeMipmap(t){const r=this._rctx,i=this._grid,s=r.bindTechnique(this._downsampleTechnique,this._passParameters,t);r.bindVAO(this._quadVAO);for(let n=0;n<i.mipmapLevels;n++){r.bindFramebuffer(i.coverageMipmap[n+1]);const o=i.coverageMipmap[n+1].width,a=i.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[n].colorTexture,mr(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(Ut.TRIANGLE_STRIP,0,da(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(v(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(v(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)t+=r.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}}const T3t={dataType:Nt.UNSIGNED_BYTE,internalFormat:qe.RGBA},S3t={};class E3t{constructor(t){this._rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const r=t.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._depthBuffers,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(t,r){const i=t.get(r);i&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==i&&s.depthStencilAttachment!==i||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),i.dispose(),t.delete(r))}getDepthTexture(t,r){if(!this.depthTextureSupported)return null;let i=this._depthTextures.get(t.id);return!i||i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=eE()),i||(i=new dt(this._rctx,{target:xt.TEXTURE_2D,pixelFormat:qe.DEPTH_STENCIL,dataType:Nt.UNSIGNED_INT_24_8,samplingMode:at.NEAREST,wrapMode:It.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._depthTextures.set(t.id,i),this._activeTargets.add(t.id)),i}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,r){if(this.depthTextureSupported)return null;let i=this._depthBuffers.get(t.id);return i?i.descriptor.width===r.width&&i.descriptor.height===r.height||i.resize(r.width,r.height):(i=new hO(this._rctx,{internalFormat:Ac.DEPTH_STENCIL,...r}),this._depthBuffers.set(t.id,i),this._activeTargets.add(t.id)),i}getColorTexture(t,r){let i=this._colorTextures.get(t.id);return i&&(i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=eE())),i||(i=new dt(this._rctx,{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:at.LINEAR,wrapMode:It.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._colorTextures.set(t.id,i),this._activeTargets.add(t.id)),i}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return{id:Su(),...S3t,...t}}registerColorTarget(t={}){return{id:Su(),...T3t,...t}}getFramebuffer(t,r,i){const s=this._getKey(r,i);let n=this._framebuffers.get(s);const o=this.getColorTexture(r,t);if(this.depthTextureSupported){const l=i?this.getDepthTexture(i,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=v(i)?new ps(this._rctx,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.DEPTH_STENCIL_TEXTURE},o,l):new ps(this._rctx,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE},o),this._framebuffers.set(s,n),n)}const a=i?this.getDepthBuffer(i,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new ps(this._rctx,{colorTarget:Qs.TEXTURE,depthStencilTarget:i?si.DEPTH_STENCIL_RENDER_BUFFER:si.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(t,r){return`${t.id}_${r?r.id:"X"}_${t.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let t=0;const r=new Set,i=s=>{r.has(s)||(r.add(s),t+=CE(s))};return this._depthTextures.forEach(i),this._colorTextures.forEach(i),this._depthBuffers.forEach(i),t}}class C3t{constructor(t,r){this._rctx=t,this._compositingHelper=r,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._background={type:"color",color:[0,0,0,1]};const i=t.type===jt.WEBGL2;this._renderTargetHelper=new E3t(t);const s=this._renderTargetHelper;this._mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:Nt.FLOAT,internalFormat:i?Tt.RGBA32F:qe.RGBA,samplingMode:at.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:at.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:i?Tt.RGBA4:qe.RGBA,dataType:Nt.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:i?Tt.RGBA4:qe.RGBA,dataType:Nt.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,r){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(t){t||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1])),this._mainColorTarget=this._mainColorTarget===0&&t?1:0}initializeFrame(t){const r=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(ds.COLOR_BUFFER_BIT|ds.DEPTH_BUFFER_BIT|ds.STENCIL_BUFFER_BIT)}composite(t){v(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,Dl.None)}renderTmpAndCompositeToMain(t,r,i,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,A3t),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}renderHUDVisibility(t,r=!1){this.renderToTargets(t,this.hudVisibility,r?this.tmpDepth:this.mainDepth,O3t)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.compositeHUD(t,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(t,r,i){let s,n;switch(r){case Ct.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case Ct.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case Ct.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}i?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Dl.PremultipliedAlpha)}compositeOccludedOntoMain(t,r){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),Dl.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(t,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(ds.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}renderToFBO(t,r,i=!1,s=!1){const n=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);n.setClearColor(r[0],r[1],r[2],l),o|=ds.COLOR_BUFFER_BIT}i&&(o|=ds.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),o|=ds.STENCIL_BUFFER_BIT),o&&n.clearSafe(o,s),t(),n.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(t,r,i,s,n=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(t,s,n,o),a}bindTarget(t,r){const i=this._renderTargetHelper.getFramebuffer(this._dimensions,t,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const A3t=[0,0,0,0],O3t=[0,1,0,1];class M3t{constructor(t){this._context=t,this._renderPlugins=new Qt,this._slots=[];for(let r=0;r<Ee.MAX_SLOTS;++r)this._slots[r]=[]}add(t,r,i){const s=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),oi();this._renderPlugins.push(r);for(const o of t)this._slots[o].push(r);this._context.requestRender()},n=r.initializeRenderContext(this._context,i);if(np(n))return n.then(s);s()}remove(t){if(this._renderPlugins.removeUnordered(t)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==t);t.uninitializeRenderContext(),this._context.requestRender()}}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this._context.renderContext)})}updateAnimation(t){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(t)||r)}),r}render(){const t=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;t.filter(i=>{if(!i.canRender)return!1;if(R3t(i)){const s=i.prepareTechnique(this._context.renderContext);return!!s&&(r.push(s),!0)}return r.push(null),!0}).forEach((i,s)=>i.render(this._context.renderContext,r[s]))}queryDepthRange(t){const r=I3t;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const s=i.queryDepthRange(t);s&&mI(r,s,r)}}),r}get needsTransparentPass(){return this._renderPlugins.some(t=>t.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(t=>t.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(t=>t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this._slots[Ee.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((t,r)=>t|r.renderOccludedFlags,0)}}function R3t(e){return"prepareTechnique"in e}const I3t={near:0,far:0};class hke extends WFe{}const zG=255,P3t=1/zG;function $3t(e){const t=new Qr,r=t.fragment;return r.include(Vd),r.include(tp),t.include(iG),t.include($f),t.include(K7,e),r.uniforms.add([new Rt("depthMap",i=>i.linearDepthTexture),new xs("inverseViewMatrix",(i,s)=>Pn($be,Pu($be,s.camera.viewMatrix,s.camera.center))),new ai("nearFar",(i,s)=>s.camera.nearFar)]),r.constants.add("sampleValue","float",P3t),r.code.add(S`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),t}const $be=$e(),D3t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:hke,shadowCastMaxSamples:zG,build:$3t},Symbol.toStringTag,{value:"Module"}));var WE;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(WE||(WE={}));class nie extends Yl{constructor(){super(...arguments),this.visualization=WE.Gradient,this.bandsEnabled=!1}}u([j({count:WE.COUNT})],nie.prototype,"visualization",void 0),u([j()],nie.prototype,"bandsEnabled",void 0);function L3t(e){const t=new Qr,r=t.fragment;r.include(Vd),r.include(tp),t.include(iG),t.include($f);const{visualization:i,bandsEnabled:s}=e;r.constants.add("inverseSampleValue","float",zG),r.uniforms.add([new Rt("shadowCastMap",a=>a.shadowCastMap),new De("sampleScale",a=>a.sampleScale),new De("opacityFromElevation",a=>a.opacityFromElevation),new Tr("uColor",a=>a.color)]);const n=i===WE.Gradient,o=i===WE.Threshold;return n&&s?r.uniforms.add(new De("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new De("threshold",a=>a.threshold)),r.code.add(S`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?S`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?S`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?S`* strength`:""});
      }
    `),t}const N3t=Object.freeze(Object.defineProperty({__proto__:null,build:L3t},Symbol.toStringTag,{value:"Module"}));class VG extends li{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){return new ti(t.rctx,VG.shader.get().build(this.configuration),Yr)}initializePipeline(){return Ht({blending:qh,colorWrite:cr,depthTest:null,depthWrite:null})}get primitiveType(){return Ut.TRIANGLE_STRIP}}VG.shader=new ei(N3t,()=>re(()=>import("./ShadowCastVisualize.glsl.a74e017c.js"),[]));const F3t=ar(.01,0,.25,1),k3t=4e4,U3t=5e4,pke=1/512;let l8=class extends be{constructor(e,t,r,i){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=r,this._requestRender=i,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:F3t,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new nie,this._enabled=!1,this._vao=Zl(t),this._techniqueConfig.visualization=WE.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=tt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(VG,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,da(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>pke}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;QL(e,t)||(jm(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([h()],l8.prototype,"opacityFromElevation",null),l8=u([I("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],l8);class d9 extends Yl{constructor(){super(...arguments),this.receiveShadows=!0,this.hasWebGL2Context=!1}}u([j()],d9.prototype,"receiveShadows",void 0),u([j()],d9.prototype,"hasWebGL2Context",void 0);class jG extends li{constructor(t){super(t,new d9,()=>this.destroy())}initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2}initializeProgram(t){return new ti(t.rctx,jG.shader.get().build(this.configuration),Yr)}initializePipeline(){return Ht({blending:ma(Ae.ONE,Ae.ONE,Ae.ONE,Ae.ONE),colorWrite:cr,depthTest:null,depthWrite:null})}get primitiveType(){return Ut.TRIANGLE_STRIP}}jG.shader=new ei(D3t,()=>re(()=>import("./ShadowCastAccumulate.glsl.67d27034.js"),[]));var Y$;let wl=Y$=class extends be{constructor(e,t,r,i,s,n){super({}),this._rctx=e,this._stage=r,this._prepareForShadowMapPass=i,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new hke,this._enabledInternal=!1,this._cachedLightDirections=[],this._depthRange=Zre,this._previewingCached=!1,this._handles=new hr,this._cameraForcedForScreenshot=!1,this._bindParameters=new h7(new Rce(e,r.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new Li,this._vao=Zl(e);const o={colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE,width:0,height:0},a={target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.LINEAR,wrapMode:It.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new ps(e,o,a),this._accumulationRenderer=new l8(t,e,this,n);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(Ot.SHADOW_ACCUMULATOR,this)),this._handles.add(ie(()=>r.renderView,c=>{this._handles.remove(Y$.renderViewHandleKey),C(c)||this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Y$.renderViewHandleKey)},Qi))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(C(this._accumulationTechniqueCached)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new jG(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewingCached}get _isPreviewing(){return this._isActive&&this._previewingCached}get _isActive(){return this._enabledInternal&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==Zre&&this._opacityFromElevation>pke}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirectionsInternal(){return this._cachedLightDirections}set _lightDirectionsInternal(e){const t=this._cachedLightDirections;if(Bv(t,e,wx))return;const r=e.length;t.length=r,this._sampleCount=Math.min(zG,r);for(let i=0;i<r;++i){const s=e[i],n=t[i]||$();le(n,s),t[i]=n}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,r,i){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(r),this._bindParameters.contentCamera=i,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewingCached||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(Y$.previewSamples,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=tt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=tt(this._fbo),this._vao=tt(this._vao),this._accumulationTechniqueCached=Di(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this._enabled=e.enabled),e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}set _previewing(e){this._previewingCached!==e&&(this._previewingCached=e,this._requestRenderIfEnabled())}set _lightDirections(e){this._lightDirectionsInternal=e}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const r=B3t;return this._fbo.readPixels(e,t,1,1,qe.RGBA,Nt.UNSIGNED_BYTE,r),r[0]/this._progress}_start(){this._progress=0,this._enabledInternal=!0}_stop(){this._enabledInternal=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ds.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirectionsInternal[this._progress];this._renderToShadowMap(this._bindParameters,e,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this._accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,da(this._vao,"geometry")),this._progress++}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-hR(k3t,U3t,e.relativeElevation))}set _enabled(e){e!==this._enabledInternal&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabledInternal&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirectionsInternal,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};wl.previewSamples=6,wl.renderViewHandleKey="renderView",u([h()],wl.prototype,"_progress",void 0),u([h()],wl.prototype,"_sampleCount",void 0),u([h()],wl.prototype,"_enabledInternal",void 0),u([h()],wl.prototype,"_depthRange",void 0),u([h()],wl.prototype,"_previewingCached",void 0),u([h()],wl.prototype,"_accumulationRenderer",void 0),u([h()],wl.prototype,"_isRefining",null),u([h()],wl.prototype,"_isActive",null),u([h()],wl.prototype,"canAccumulate",null),u([h()],wl.prototype,"_isDoneAccumulating",null),u([h()],wl.prototype,"_opacityFromElevation",null),u([h()],wl.prototype,"running",null),wl=Y$=u([I("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],wl);const B3t=new Uint8Array(4),Dbe={highlightedThreshold:.99999,selfShadowThreshold:.025};function z3t(e){const t=new Qr;t.include(BE,e);const r=t.fragment;return r.include(Vd),r.include(tp),t.include(iG),t.include($f),r.uniforms.add([new Rt("defaultDepthTex",(i,s)=>s.shadowMap.getSnapshot(dI.Default)),new Rt("highlightDepthTex",(i,s)=>s.shadowMap.getSnapshot(dI.Highlight)),new Rt("depthMap",(i,s)=>s.linearDepthTexture),new Rt("highlightMap",(i,s)=>s.highlightColorTexture),new Tr("uColor",i=>i.shadowColor),new ai("nearFar",(i,s)=>s.camera.nearFar),new De("opacity",i=>i.shadowOpacity),new De("occludedOpacity",i=>i.occludedShadowOpacity),new De("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new er("lightingMainDirectionView",(i,s)=>xe(Nbe,je(Nbe,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new ai("texelSize",(i,s)=>v(s.linearDepthTexture)?mr(V3t,1/s.linearDepthTexture.descriptor.width,1/s.linearDepthTexture.descriptor.height):Ud),new xs("inverseViewMatrix",(i,s)=>Pn(Lbe,Pu(Lbe,s.camera.viewMatrix,s.camera.center)))]),r.constants.add("unoccludedHighlightFlag","vec4",NNe).add("highlightedThreshold","float",Dbe.highlightedThreshold).add("selfShadowThreshold","float",Dbe.selfShadowThreshold),r.code.add(S`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(S`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),t}const Lbe=$e(),Nbe=$(),V3t=rt(),j3t=Object.freeze(Object.defineProperty({__proto__:null,build:z3t},Symbol.toStringTag,{value:"Module"}));class G3t extends Zi{constructor(){super(...arguments),this.shadowColor=ar(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class GG extends li{constructor(t){super(t,new d9,()=>this.destroy())}initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2}initializeProgram(t){return new ti(t.rctx,GG.shader.get().build(this.configuration),Yr)}initializePipeline(){return Ht({blending:ma(Ae.SRC_ALPHA,Ae.ONE,Ae.ONE_MINUS_SRC_ALPHA,Ae.ONE_MINUS_SRC_ALPHA),colorWrite:cr,depthTest:null,depthWrite:null})}get primitiveType(){return Ut.TRIANGLE_STRIP}}GG.shader=new ei(j3t,()=>re(()=>import("./ShadowHighlight.glsl.11f3113c.js"),[]));const H3t=.001953125,q3t=4e4,W3t=5e4;class X3t{constructor(t,r){this._rctx=t,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new G3t,this._drawParameters=new WFe,this._vao=Zl(this._rctx)}get _technique(){return C(this._techniqueCached)&&(this._techniqueCached=new GG({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(t,r){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,t).bindDraw(this._drawParameters,t,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,da(this._vao,"geometry"))}get gpuMemoryUsage(){var t,r;return(r=(t=this._vao)==null?void 0:t.size)!=null?r:0}setDefaultOptions(t){this._passParameters={...this._passParameters,...t},this._updateMaxOpacity()}updateParameters(t,r){this._passParameters.opacityElevation=1-hR(q3t,W3t,t.relativeElevation);const i=this._viewingMode===Ye.Global?xe(Fbe,t.center):ue(Fbe,0,0,1),s=Te(i,r);this._passParameters.dayNightTerminator=hR(0,1,_e(30*s,0,1))}dispose(){this._vao=tt(this._vao),this._techniqueCached=Di(this._techniqueCached)}get isVisible(){const{opacityElevation:t,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*t*r>=H3t}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const Fbe=$(),kbe=u1();class Y3t{constructor(){this._plane=u1()}get isEnabled(){return!l3e(this.plane,kbe)}get plane(){return this._plane}set plane(t){hC(t||kbe,this._plane)}}class Z3t extends Zi{}function vF(e){e.uniforms.add(new Tr("resolution",t=>Oi(J3t,1/t.colorTexture.descriptor.width,1/t.colorTexture.descriptor.height,t.colorTexture.descriptor.width,t.colorTexture.descriptor.height)))}const J3t=Lr(),bA={maxSearchSteps:8,maxDistanceAreaTex:16};function K3t(){const e=new Qr,{attributes:t,varyings:r,vertex:i,fragment:s}=e;return t.add(M.POSITION,"vec2"),r.add("fTexCoord","vec2"),r.add("fOffset[3]","vec4"),r.add("fPixCoord","vec2"),vF(i),i.code.add(S`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${S.int(bA.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),s.uniforms.add(new Rt("tEdges",n=>n.edges.colorTexture)),s.uniforms.add(new Rt("tArea",n=>n.areaTexture)),s.uniforms.add(new Rt("tSearch",n=>n.searchTexture)),s.uniforms.add(new Rt("tColor",n=>n.colorTexture)),vF(s),s.code.add(S`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${S.int(bA.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${S.int(bA.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${S.int(bA.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${S.int(bA.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${S.int(bA.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `),e}const Q3t=Object.freeze(Object.defineProperty({__proto__:null,build:K3t},Symbol.toStringTag,{value:"Module"}));class HG extends li{initializeProgram(t){return new ti(t.rctx,HG.shader.get().build(),Yr)}initializePipeline(){return Ht({colorWrite:cr})}}HG.shader=new ei(Q3t,()=>re(()=>import("./BlendWeights.glsl.20b8fa3c.js"),[]));function e$t(){const e=new Qr,{attributes:t,varyings:r,vertex:i,fragment:s}=e;return t.add(M.POSITION,"vec2"),r.add("fTexCoord","vec2"),r.add("fOffset[2]","vec4"),vF(i),i.code.add(S`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),s.uniforms.add(new Rt("tBlendWeights",n=>n.blend.colorTexture)),s.uniforms.add(new Rt("tColor",n=>n.colorTexture)),vF(s),s.code.add(S`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`),e}const t$t=Object.freeze(Object.defineProperty({__proto__:null,build:e$t},Symbol.toStringTag,{value:"Module"}));class qG extends li{initializeProgram(t){return new ti(t.rctx,qG.shader.get().build(),Yr)}initializePipeline(){return Ht({colorWrite:cr})}}qG.shader=new ei(t$t,()=>re(()=>import("./Blur.glsl.fb3c9290.js"),[]));const Ube={threshold:.05,localConstrastAdaption:2};function r$t(){const e=new Qr,{attributes:t,varyings:r,vertex:i,fragment:s}=e;return t.add(M.POSITION,"vec2"),vF(i),r.add("fTexCoord","vec2"),r.add("fOffset[3]","vec4"),i.code.add(S`void EdgeDetectEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0) * 0.5;
gl_Position = vec4(position, 0, 1);
EdgeDetectEdgeDetectionVS(fTexCoord);
}`),s.uniforms.add(new Rt("tColor",n=>n.colorTexture)),s.code.add(S`
    vec4 EdgeDetectColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
      vec2 threshold = vec2( ${S.float(Ube.threshold)} );

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D( colorTex, texcoord ).rgb;

      vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
      vec3 t = abs( C - Cleft );
      delta.x = max( max( t.r, t.g ), t.b );

      vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
      t = abs( C - Ctop );
      delta.y = max( max( t.r, t.g ), t.b );

      // We do the usual threshold:
      vec2 edges = step( threshold, delta.xy );

      // Then discard if there is no edge:
      if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
          discard;

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
      t = abs( C - Cright );
      delta.z = max( max( t.r, t.g ), t.b );

      vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
      t = abs( C - Cbottom );
      delta.w = max( max( t.r, t.g ), t.b );

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
      t = abs( C - Cleftleft );
      delta.z = max( max( t.r, t.g ), t.b );

      vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
      t = abs( C - Ctoptop );
      delta.w = max( max( t.r, t.g ), t.b );

      // Calculate the final maximum delta:
      maxDelta = max( max( maxDelta, delta.z ), delta.w );

      // Local contrast adaptation in action:
      edges.xy *= step( maxDelta, float(${S.float(Ube.localConstrastAdaption)}) * delta.xy );

      return vec4( edges, 0.0, 0.0 );
    }

    void main() {
      gl_FragColor = EdgeDetectColorEdgeDetectionPS(fTexCoord, fOffset, tColor);
    }
  `),e}const i$t=Object.freeze(Object.defineProperty({__proto__:null,build:r$t},Symbol.toStringTag,{value:"Module"}));class WG extends li{initializeProgram(t){return new ti(t.rctx,WG.shader.get().build(),Yr)}initializePipeline(){return Ht({colorWrite:cr})}}WG.shader=new ei(i$t,()=>re(()=>import("./EdgeDetect.glsl.726abdd8.js"),[]));let Z$=class extends be{constructor(e,t){super({}),this._rctx=e,this._techniqueRep=t,this._passParameters=new Z3t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=lg(this._abortController),this.disable()}_loadResources(e){if(v(this._abortController))return!1;if(v(this._passParameters.searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return re(()=>import("./SmaaRenderPassData.be2c948f.js"),[]).then(r=>this._loadTextures(r,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return Ir(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,at.LINEAR,qe.RGB),this._loadTextureFromBase64(e.searchTexure,at.NEAREST,qe.LUMINANCE)]).then(([r,i])=>{Bo(t)?(r.dispose(),i.dispose(),Ir(t)):(this._passParameters.areaTexture=r,this._passParameters.searchTexture=i)})}get updating(){return v(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new Yl;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(WG,t,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(HG,t,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(qG,t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=cpt(this._rctx),this._passParameters.edges=new ps(this._rctx,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE},{target:xt.TEXTURE_2D,pixelFormat:qe.RGB,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.LINEAR,wrapMode:It.CLAMP_TO_EDGE,width:4,height:4}),this._passParameters.blend=new ps(this._rctx,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE},{target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.LINEAR,wrapMode:It.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=tt(this._vao),this._passParameters.areaTexture=tt(this._passParameters.areaTexture),this._passParameters.searchTexture=tt(this._passParameters.searchTexture),this._passParameters.blend=tt(this._passParameters.blend),this._passParameters.edges=tt(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const t=this._validPassParameters;if(C(t))return;t.colorTexture=e;const r=this._rctx,i=r.getBoundFramebufferObject(),s=e.descriptor.width,n=e.descriptor.height;r.bindVAO(this._vao),r.setViewport(0,0,s,n),t.edges.resize(s,n),r.bindFramebuffer(t.edges),r.setClearColor(0,0,0,1),r.clear(ds.COLOR_BUFFER_BIT),r.bindTechnique(this._edgeDetectTechnique,t,null),r.drawArrays(Ut.TRIANGLES,0,3),t.blend.resize(s,n),r.bindFramebuffer(t.blend),r.setClearColor(0,0,1,1),r.clear(ds.COLOR_BUFFER_BIT),r.bindTechnique(this._blendWeightsTechnique,t,null),r.drawArrays(Ut.TRIANGLES,0,3),r.bindFramebuffer(i),r.setClearColor(0,1,0,1),r.clear(ds.COLOR_BUFFER_BIT),r.bindTechnique(this._blurTechnique,t,null),r.drawArrays(Ut.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,r){return A0(e).then(i=>new dt(this._rctx,{pixelFormat:r,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.CLAMP_TO_EDGE,width:i.width,height:i.height,samplingMode:t},i))}};u([h()],Z$.prototype,"_abortController",void 0),u([h({readOnly:!0})],Z$.prototype,"updating",null),Z$=u([I("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],Z$);function s$t(e,t){const r=-e[0],i=-e[1],s=-e[2],n=t[3],o=t[7],a=t[11],l=t[15];t[0]+=n*r,t[1]+=n*i,t[2]+=n*s,t[4]+=o*r,t[5]+=o*i,t[6]+=o*s,t[8]+=a*r,t[9]+=a*i,t[10]+=a*s,t[12]+=l*r,t[13]+=l*i,t[14]+=l*s}function n$t(e,t){const r=e[0],i=e[1],s=e[2];t[12]+=r*t[0]+i*t[4]+s*t[8],t[13]+=r*t[1]+i*t[5]+s*t[9],t[14]+=r*t[2]+i*t[6]+s*t[10],t[14]+=r*t[3]+i*t[7]+s*t[11]}class o$t{constructor(t){this._factory=t,this._originData=new Map}acquire(t){return this.register(this._factory.getOrigin(t))}register(t){const r=this._originData.get(t.id)||new a$t(t);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(t){t.refCount--,t.refCount===0&&this._originData.delete(t.origin.id)}updateViewMatrices(t){this._originData.forEach(r=>{jn(r.viewMatrix,t),n$t(r.origin.vec3,r.viewMatrix)})}}class a$t{constructor(t){this.origin=t,this.refCount=0,this.viewMatrix=$e()}}class l$t extends CDe{constructor(t,r){super(),this.distanceFalloffFactor=t,this.transparency=r,this.transformNormalViewFromGlobal=Ts()}}class c$t extends ADe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Ts(),this.slicePlaneLocalOrigin=$(),this.transformNormalGlobalFromModel=Ts()}}function u$t(e){const t=S`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const d$t=pi(.5,-4e-4);function h$t(e,t){const r=e.vertex;r.include(u$t),r.constants.add("depthBias","vec2",d$t),r.uniforms.add(new ai("inverseViewport",(i,s)=>s.inverseViewport)),t.legacy?(r.uniforms.add(new xs("proj",(i,s)=>s.camera.projectionMatrix)),r.code.add(S`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new U0("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),r.uniforms.add(new xs("transformProjFromView",i=>i.transformProjFromView)),r.code.add(S`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(S`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function p$t(e,t){const r=e.fragment;r.constants.add("coverageTestThreshold","float",.01),t.antialiasing?r.code.add(S`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(S`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function f$t(e,t){const r=e.vertex;t.silhouette?(r.code.add(S`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function m$t(e,t){const r=e.vertex;r.include(Vd),r.uniforms.add(new De("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(S`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(ux("componentDataTex",i=>i.componentDataTexture,t.hasWebGL2Context?vi.None:vi.InvSize)),e.attributes.add(M.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*aue),r.code.add(S`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${ff(t,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      vec2 textureCoordinates = vec2(colIndex, rowIndex) + 0.5;

      return textureCoordinates;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${vu(t,"componentDataTex","colorIndex")};
      vec4 otherValue = ${vu(t,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${vu(t,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),t.legacy?r.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new IN("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(M.NORMALA,"vec3"),e.attributes.add(M.NORMALB,"vec3"),r.code.add(S`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(M.NORMAL,"vec3"),r.code.add(S`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?r.code.add(S`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(mV,t),r.include(mV,t),r.uniforms.add([new U0("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new IN("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Hh("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new Hh("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new er("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new er("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)]),r.code.add(S`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?S`normalize(transformWorldFromModelTL + rotatedModelPosition);`:S`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new xs("transformProjFromView",(i,s)=>s.camera.projectionMatrix)),r.code.add(S`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(S`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function g$t(e){return e.mode===to.SKETCH||e.mode===to.MIXED}var to;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(to||(to={}));function y$t(e,t){const r=e.vertex;switch(t.mode){case to.SKETCH:r.code.add(S`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case to.MIXED:r.code.add(S`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case to.SOLID:r.code.add(S`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}function due(e,t){const r=e.vertex;switch(e.attributes.add(M.SIDENESS,"vec2"),t.mode===to.MIXED?r.code.add(S`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(S`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case to.MIXED:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case to.SKETCH:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case to.SOLID:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case to.COUNT:break;default:t.mode}}function _$t(e,t){const r=e.vertex;switch(e.include(due,t),t.mode){case to.SOLID:r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case to.SKETCH:r.uniforms.add(new H2("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case to.MIXED:r.uniforms.add(new H2("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function v$t(e,t){e.include(due,t);const{vertex:r,fragment:i}=e;switch(g$t(t)&&(r.uniforms.add(ux("strokesTexture",s=>s.strokesTexture.texture,t.hasWebGL2Context?vi.None:vi.InvSize)),r.uniforms.add([new H2("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new H2("strokeVariants",s=>s.strokesTexture.variants)]),e.varyings.add("vStrokeUV","vec2"),i.uniforms.add([new n4("strokesTexture",s=>s.strokesTexture.texture),new H2("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)]),r.code.add(S`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${ff(t,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),e.fragment.include(Vd),i.code.add(S`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case to.SOLID:r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(S`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case to.SKETCH:r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(S`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case to.MIXED:e.varyings.add("vType","float"),r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(S`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function b$t(e){const t=new Qr,{vertex:r,fragment:i}=t;return e.antialiasing&&(r.code.add(S`#define ANTIALIASING 1`),i.code.add(S`#define ANTIALIASING 1`)),e.legacy&&r.uniforms.add([new Bbe("model"),new Bbe("localView")]),t.include(h$t,e),t.include(m$t,e),t.include(_$t,e),t.include(due,e),t.include(v$t,e),t.include(Rn,e),t.include(f$t,e),t.include(p$t,e),t.include(y$t,e),t.include(rp,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add([new ai("pixelToNDC",(s,n)=>mr(w$t,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new Tr("viewport",(s,n)=>n.camera.fullViewport),new De("pixelRatio",(s,n)=>n.camera.pixelRatio)]),t.attributes.add(M.POSITION0,"vec3"),t.attributes.add(M.POSITION1,"vec3"),t.attributes.add(M.VARIANTOFFSET,"float"),t.attributes.add(M.VARIANTSTROKE,"float"),t.attributes.add(M.VARIANTEXTENSION,"float"),r.code.add(S`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),t.fragment.code.add(S`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const w$t=rt();class Bbe extends tn{constructor(t){super(t,"mat4")}}const x$t=Object.freeze(Object.defineProperty({__proto__:null,build:b$t},Symbol.toStringTag,{value:"Module"}));class XG extends li{initializeConfiguration(t,r){r.hasWebGL2Context=t.rctx.type===jt.WEBGL2}initializeProgram(t){return new ti(t.rctx,XG.shader.get().build(this.configuration),Qre)}initializePipeline(t){return t.blendMinMax?Ht({blending:ma(Ae.ONE,Ae.ONE,Ae.ZERO,Ae.ONE,E0.ADD,t.blendMinMax.MAX),depthTest:{func:rs.LEQUAL},colorWrite:cr}):Ht({depthTest:{func:rs.LEQUAL},depthWrite:$u,colorWrite:cr})}}XG.shader=new ei(x$t,()=>re(()=>import("./EdgeShader.glsl.deca055a.js"),[]));class xy extends aa{constructor(){super(...arguments),this.mode=to.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}u([j({count:to.COUNT})],xy.prototype,"mode",void 0),u([j()],xy.prototype,"hasSlicePlane",void 0),u([j()],xy.prototype,"silhouette",void 0),u([j()],xy.prototype,"legacy",void 0),u([j()],xy.prototype,"antialiasing",void 0),u([j()],xy.prototype,"doublePrecisionRequiresObfuscation",void 0),u([j()],xy.prototype,"hasMultipassTerrain",void 0),u([j()],xy.prototype,"cullAboveGround",void 0),u([j()],xy.prototype,"spherical",void 0);const T$t=8,SY=128,S$t={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},E$t={solid:to.SOLID,sketch:to.SKETCH,uber:to.MIXED};class bL{constructor(t,r,i){this._rctx=t,this._shaderTechniqueRepository=r,this._configuration=new xy,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[dr.TRANSPARENT]:{[dr.TRANSPARENT]:new Qt,[dr.OPAQUE]:new Qt},[dr.OPAQUE]:{[dr.TRANSPARENT]:new Qt,[dr.OPAQUE]:new Qt}},this._renderablesDirty=!1,this._drawParameters=new c$t,this._settings={...S$t,...i},this.key=bL.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:hi.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=E$t[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=a4(t),this._configuration.spherical=i.spherical}dispose(){this._technique=Di(this._technique)}addRenderable(t){this._renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this._renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,r){this._renderablesDirty&&this._sortRenderables(),this._sortedRenderables[r][dr.TRANSPARENT].forAll(t),this._sortedRenderables[r][dr.OPAQUE].forAll(t)}updateTechnique(t,r){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(XG,this._configuration,this._technique),this._technique}bindRegularEdges(t,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),t,r)}bindSilhouetteEdges(t,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),t,r)}renderRegularEdges(t,r,i,s,n){this._render(t,r,r.regular.vao,i,s,n)}renderSilhouetteEdges(t,r,i,s,n){this._render(t,r,r.silhouette.vao,i,s,n)}_render(t,r,i,s,n,o){o>0&&(this._bindDraw(t,r,s,n),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(Ut.TRIANGLE_FAN,0,4,o))}_bindDraw(t,r,i,s){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(t.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),t.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const n=new $G(r.transform.position),o=Sf(zbe,uC(zbe,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=s.camera.viewInverseTransposeMatrix;ue(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,s,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[dr.TRANSPARENT][dr.TRANSPARENT].clear(),this._sortedRenderables[dr.TRANSPARENT][dr.OPAQUE].clear(),this._sortedRenderables[dr.OPAQUE][dr.TRANSPARENT].clear(),this._sortedRenderables[dr.OPAQUE][dr.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==dr.INVISIBLE&&r.edgeTransparency!==dr.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const t=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[dr.TRANSPARENT][dr.TRANSPARENT].sort(t),this._sortedRenderables[dr.TRANSPARENT][dr.OPAQUE].sort(t),this._sortedRenderables[dr.OPAQUE][dr.TRANSPARENT].sort(t),this._sortedRenderables[dr.OPAQUE][dr.OPAQUE].sort(t)}static getKey(t,r,i){return`edges-t:${t}:${r}:${i}`}}const zbe=Au();function dzt(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:C$t(e.layout)}}function VU(e){return A$t(e.layout).createView(e.buffer)}function C$t(e){const t=new Array;return e.fields.forEach((r,i)=>{const s={...r,constructor:fke(r.constructor)};t.push([i,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function A$t(e){const t=Ds();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(r=>t.fields.set(r[0],{...r[1],constructor:M$t(r[1].constructor)})),t}const O$t=[l4,Af,Ii,ga,gg,YR,ZR,JR,qn,ME,Ix,Px,Qv,RE,$x,Go,IE,KR,PE,Dx,$E,QR,$N,DN,eI,DE,LN,NN,FN,LE,kN,UN,BN,zN,VN,jN];function fke(e){return`${e.ElementType}_${e.ElementCount}`}function M$t(e){return mke.get(e)}const mke=new Map;O$t.forEach(e=>mke.set(fke(e),e));class R$t extends f5e{constructor(t){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},t)}async process(t,r,i){if(i)return xPt(t);const s=await this.invoke(new EY(t),r);return this._unpackOutput(s)}async extractEdgeLocations(t,r){const i=await this.invokeMethod("extractEdgeLocations",new EY(t),r);return VU(i)}async extractComponentsEdgeLocations(t,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new EY(t),r);return VU(i)}_unpackOutput(t){return{regular:{instancesData:VU(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:VU(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}class EY{constructor(t){this.dataBuffer=t.data.buffer,this.writerSettings=t.writerSettings,this.skipDeduplicate=t.skipDeduplicate,this.indices=Array.isArray(t.indices)?t.indices:t.indices.buffer,this.indicesType=Array.isArray(t.indices)?"Array":Dse(t.indices)?"Uint32Array":"Uint16Array",this.indicesLength=t.indicesLength}}function I$t(e){const r=u3.resolution,i=r/2,s=new Uint8Array(4*r*r),n=4*r*i,o=u3.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,d=u3.strokes.length;let p=(c-1)*d*l;for(const{distance:m,pressure:g}of u3.strokes){let _=m,x=g,b=p;for(let w=0;w<c;w++){w!==0&&(_=Vbe(_,bF.DISTANCE),x=Vbe(x,bF.PRESSURE));for(let T=0;T<u3.resolution;T++){const E=.5+(_?_[T%_.length]/a:0),O=x?x[T%x.length]:1;KN(E,s,b),KN(O,s,b+n),b+=4}b-=l*(d+1)}p+=l}const f=new dt(e,{pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:at.LINEAR,width:r,height:r,wrapMode:It.REPEAT},s);return new $$t(r,a,o,d,f)}function Vbe(e,t){if(!e)return null;const r=e.length/2,i=P$t*r,s=new Array(r);let n=0;const o=t===bF.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(i,1-(1-l)*jbe):Math.min(i,l*jbe)}return s}var bF;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(bF||(bF={}));const P$t=.1,jbe=.5;class $$t{constructor(t,r,i,s,n){this.resolution=t,this.normalizationScale=r,this.amplitude=i,this.variants=s,this.texture=n}dispose(){this.texture=tt(this.texture)}}const u3={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Gbe(e){let t=null;for(const r of e){const i=r.type;if(D$t(r)){if(C(t))t=i;else if(t!==i)return"uber"}}return v(t)?t:"uber"}function Hbe(e){let t=dr.INVISIBLE;for(const{material:r}of e)if(gke(r)){if(r.color[3]*r.opacity<1)return dr.TRANSPARENT;t=dr.OPAQUE}return t}function qbe(e){let t=dr.INVISIBLE;for(const{material:r}of e)if(gke(r)){switch(r.objectTransparency){case dr.TRANSPARENT:case dr.INVISIBLE:return dr.TRANSPARENT;case dr.OPAQUE:if(r.opacity<1)return dr.TRANSPARENT}t=dr.OPAQUE}return t}function gke(e){return e.size*e.color[3]*e.opacity>0}function D$t(e){return e.size*e.color[3]>0}function Wbe(e,t,r,i){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,n)}else for(let l=o;l<a;l++)r.set(l,n)}}let gm=class extends be{constructor(e){super(e),this._updatingHandles=new a0,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=$(),this._localOrigins=new o$t(new Mce(e.renderSR))}initialize(){this._worker=new R$t(this.schedule),this._componentColorManager=new ske(this.rctx,3);const e=eke.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this._verticesBufferObject=Ur.createVertex(this.rctx,ni.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(e=>this._discardObjectEntry(e)),this._perObjectData.clear(),this._strokesTexture=tt(this._strokesTexture),this._componentColorManager=Qe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=tt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(e,t,r,i,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new Xbe(new Promise(p=>l=p),r.center,r.radius);this._perObjectData.set(e,c);const d=await this._updatingHandles.addPromise(this._addComponentGeometry(t,c,i,s,n,o,a));return this.setNeedsRender(),l(),d}async addOrUpdateObject3D(e,t,r,i){if(this.destroyed)return void te.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new Xbe(new Promise(c=>n=c),o,Cv(o));this._perObjectData.set(e,a);const l=new Array;if(r.mergeGeometries&&e.geometries.length>1&&N$t(e))l.push(this._addObjectMergedGeometries(e,a,t,r,i));else for(let c=0;c<e.geometries.length;c++){const d=e.geometryRecords[c];if(!d.material.supportsEdges)continue;const p=e.geometries[c];l.push(this._addGeometry(e,a,p,d,t[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this._perObjectData.has(e)}async updateAllComponentOpacities(e,t){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));if(C(r))return;const i=t instanceof Array?s=>t[s]:()=>t;r.renderables.forEach(s=>{const n=s.components.meta.length;for(let o=0;o<n;o++){const a=i(o),l=s.components.meta[o],c=l.index;l.material.opacity=a,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(e){const t=await this._getObjectEntry(e);return v(t)?t.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(e,t,r,i){const s=e instanceof w1,n=!!r.hasSlicePlane,o=Gbe(t),a=bL.getKey(o,n,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(e));C(l)||(l.renderables.forEach(c=>{if(a!==c.rendererKey){const d=this._renderers.get(c.rendererKey),p=this._acquireRenderer(o,n,s);d.removeRenderable(c),--d.refCount,c.rendererKey=a,p.addRenderable(c)}for(let d=0;d<t.length;d++)c.components.meta[d].material=t[d];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(e,t){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));C(r)||(r.renderables.forEach(i=>{var n;const s=i.components.meta;for(let o=0;o<s.length;o++)i.components.meta[o].verticalOffset=(n=t==null?void 0:t[o])!=null?n:0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(e,t){const r=await this._updatingHandles.addPromise(this._getObjectEntry(e));v(r)&&(r.renderables.forEach(i=>i.visible=t),this.setNeedsRender())}removeObject(e){const t=this._perObjectData.get(e);t&&(this._perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this._perObjectData.get(e);if(!t)throw"no object";return await t.loaded,t.loaded==null?null:t}render(e,t){if(C(this._componentColorManager))return;this._localOrigins.updateViewMatrices(e.camera.viewMatrix);const r=e.camera.viewInverseTransposeMatrix,i=$(),s=new $G;let n=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,d=!0;l.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,c&&p.regular&&(l.updateTechnique(e,!1),c=!1),d&&p.silhouette&&(l.updateTechnique(e,!0),d=!1))},t)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new l$t(40*n/o,t);ue(i,r[3],r[7],r[11]),s.set(i),le(a.transformWorldFromViewTH,s.high),le(a.transformWorldFromViewTL,s.low),Tf(a.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Sf(Qbe,a.transformViewFromCameraRelativeRS),uC(a.transformNormalViewFromGlobal,Qbe),a.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this._renderers.forEach(l=>{this._renderRegularEdges(l,e,a),this._renderSilhouetteEdges(l,e,a)})}_updateTransparency(e){const t=Hbe(e.components.meta),r=qbe(e.components.meta);t===e.edgeTransparency&&r===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=r,this._renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,r){e.getCombinedStaticTransformation(t,r);const i=v(t.origin)?this._localOrigins.register(t.origin):this._localOrigins.acquire(ue(this._tmpModelPosition,r[12],r[13],r[14]));return t.origin=i.origin,s$t(i.origin.vec3,r),i}_updateComponentBuffer(e){const{meta:t,buffer:r}=e,i=new Uint8Array(4);for(let s=0;s<t.length;s++){const n=t[s].material,o=t[s].index,a=_e(Math.round(n.size*T$t),0,255),l=_e(n.extensionLength,-SY,255-SY)+SY,c=n.type==="solid"?u9.SOLID:u9.SKETCH,d=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],g=255*p[2],_=255*p[3];r.textureBuffer.setData(o,0,f,m,g,_),r.textureBuffer.setData(o,1,a,l,c,d),K5e(t[s].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(e){if(C(this._componentColorManager))return null;const t=new Array,r=this._componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=r.acquireIndex();t.push({index:o,verticalOffset:0,material:n})}const i=new F$t(r,t);return this._updateComponentBuffer(i),i}_extractEdges(e,t,r,i,s,n=s.length){return this._worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(e,t,r,i,s){const n=v(this._verticesBufferObject)&&e.regular.lodInfo.lengths.length>0?new Ybe(new Cf(this.rctx,Qre,{vertices:wbe,instances:l9.glLayout},{vertices:this._verticesBufferObject,instances:Ur.createVertex(this.rctx,ni.STATIC_DRAW,e.regular.instancesData.buffer)}),e.regular.lodInfo):null,o=v(this._verticesBufferObject)&&e.silhouette.lodInfo.lengths.length>0?new Ybe(new Cf(this.rctx,Qre,{vertices:wbe,instances:c9.glLayout},{vertices:this._verticesBufferObject,instances:Ur.createVertex(this.rctx,ni.STATIC_DRAW,e.silhouette.instancesData.buffer)}),e.silhouette.lodInfo):null,a=(v(n)?n.vao.size:0)+(v(o)?o.vao.size:0);return new U$t(n,o,{gpuMemoryUsage:a,externalMemoryUsage:s,averageEdgeLength:e.averageEdgeLength},r,Hbe(t.meta),qbe(t.meta),t,i)}async _addGeometry(e,t,r,i,s,n,o){const a=r.vertexAttributes.get(M.POSITION),l=r.indices.get(M.POSITION),c=$e(),d=this._computeModelTransformWithLocalOrigin(e,i,c),p=new Kbe(a,l,c,d);return this._addPositionData(t,p,r.edgeIndicesLength,s,n,o)}async _addPositionData(e,t,r,i,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([i]);if(C(o)||r<=0)return;const a=this._acquireRenderer(i.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,d=t.indices,p=t.position,f=p.data.length/p.size,m=o9.createBuffer(f);for(let x=0;x<f;x++)m.position.set(x,0,p.data[x*p.size+0]),m.position.set(x,1,p.data[x*p.size+1]),m.position.set(x,2,p.data[x*p.size+2]);Wbe(o.meta,[0,m.componentIndex.count],m.componentIndex);const g=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,d,r));if(e.loaded==null)return;const _=this._createRenderable(g,o,new k$t(l,c),a.key,!1);e.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(e,t,r,i,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(C(a))return 0;const l=Gbe(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),d=o9.createBuffer(r.count);fG(d.position,r),Wbe(a.meta,s,d.componentIndex,i);const p=!0,f=c.writerSettings,m=await this._updatingHandles.addPromise(this._extractEdges(f,d,p,!1,i));if(t.loaded==null)return 0;const g=this._createRenderable(m,a,e,c.key,!0);return t.renderables.push(g),c.addRenderable(g),g.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(e,t,r,i,s){const n=new Map;let o=0,a=null,l=0;for(let b=0;b<e.geometries.length;b++){const w=e.geometries[b],T=e.geometryRecords[b];if(!T.material.supportsEdges)continue;!a&&T.origin&&(a=T);const E=w.vertexAttributes.get(M.POSITION);l+=E.data.length/E.size,o+=w.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,d=o?new c(o):null,p=[];let f=0;for(let b=0;b<e.geometries.length;b++){const w=e.geometries[b];if(!e.geometryRecords[b].material.supportsEdges)continue;const T=w.vertexAttributes.get(M.POSITION),E=w.indices.get(M.POSITION);let O=n.get(T.data);if(O==null){O=p.length/3;for(let A=0;A<T.data.length;A+=T.size)p.push(T.data[A+0]),p.push(T.data[A+1]),p.push(T.data[A+2]);n.set(T.data,O)}if(E)for(let A=0;A<w.edgeIndicesLength;A++)d[f++]=O+E[A]}const m=a||e.geometryRecords[0],g=$e(),_=this._computeModelTransformWithLocalOrigin(e,m,g);for(let b=0;b<e.geometryRecords.length;b++)e.geometryRecords[b].origin=_.origin;const x=new Kbe({data:p,size:3},d,g,_);await this._updatingHandles.addPromise(this._addPositionData(t,x,d.length,r[0],i,s))}_acquireRenderer(e,t,r){const i=bL.getKey(e,t,r);let s=this._renderers.get(i);return C(this._strokesTexture)&&(this._strokesTexture=I$t(this.rctx)),s||(s=new bL(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===Ye.Global}),this._renderers.set(i,s)),++s.refCount,s}_removeRenderable(e){L$t(e);const t=this._renderers.get(e.rendererKey);if(t){t.removeRenderable(e),--t.refCount,"origin"in e.transform&&this._localOrigins.release(e.transform.origin),this._gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const r of e.components.meta)e.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,r=e.camera.viewForward,i=$(),s=n=>{Pc(i,n.center,t);const o=Te(i,r),a=n.radius,l=o<-a?1/0:o<a?0:o-a;n.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,r){const i=e.bindRegularEdges(r,t),s=r.transparency,n=t.camera.perScreenPixelRatio;e.forEachRenderable(o=>{if(!Zbe(o)||!o.visible)return;const a=jU(o.regular.lod.lengths,o.distanceToCamera,n);e.renderRegularEdges(i,o,r,t,a)},s)}_renderSilhouetteEdges(e,t,r){const i=e.bindSilhouetteEdges(r,t),s=r.transparency,n=t.camera.perScreenPixelRatio;e.forEachRenderable(o=>{if(!Jbe(o)||!o.visible)return;const a=jU(o.silhouette.lod.lengths,o.distanceToCamera,n);e.renderSilhouetteEdges(i,o,r,t,a)},s)}get test(){return{hasRenderedPrimitives:e=>{let t=!1;const r=e.perScreenPixelRatio,i=(s,n)=>s.forEachRenderable(o=>{o.visible&&!t&&(Zbe(o)&&(t=jU(o.regular.lod.lengths,o.distanceToCamera,r)>0),!t&&Jbe(o)&&(t=jU(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},n);return this._renderers.forEach(s=>{t||(i(s,dr.OPAQUE),i(s,dr.TRANSPARENT))}),t}}}};function L$t(e){v(e.regular)&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),v(e.silhouette)&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function N$t(e){let t=null,r=null;for(let i=0;i<e.geometries.length;i++){const s=e.geometryRecords[i];if(s.material.supportsEdges){if(t){if(!Bv(t,s.transformation))return!1}else t=s.transformation;if(!r&&v(s.origin))r=s;else if(v(r==null?void 0:r.origin)&&v(s.origin)&&r.origin.id!==s.origin.id)return!1}}return!0}u([h({constructOnly:!0})],gm.prototype,"rctx",void 0),u([h({constructOnly:!0})],gm.prototype,"renderSR",void 0),u([h({constructOnly:!0})],gm.prototype,"viewingMode",void 0),u([h({constructOnly:!0})],gm.prototype,"techniqueRepository",void 0),u([h({constructOnly:!0})],gm.prototype,"setNeedsRender",void 0),u([h({constructOnly:!0})],gm.prototype,"schedule",void 0),u([h({readOnly:!0})],gm.prototype,"_updatingHandles",void 0),u([h({readOnly:!0})],gm.prototype,"updating",null),gm=u([I("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],gm);class Xbe{constructor(t,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class F$t{constructor(t,r){this.buffer=t,this.meta=r}}class Ybe{constructor(t,r){this.vao=t,this.lod=r}}class k$t{constructor(t,r){this.modelMatrix=t,this.origin=r}}class U$t{constructor(t,r,i,s,n,o,a,l){this.regular=t,this.silhouette=r,this.statistics=i,this.transform=s,this.edgeTransparency=n,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function Zbe(e){return v(e.regular)}function Jbe(e){return v(e.silhouette)}function jU(e,t,r){const i=t*r,s=qSe(e,i,!0);return s===-1?i<e[0]?e.length:0:e.length-s}class Kbe{constructor(t,r,i,s){this.position=t,this.indices=r,this.modelTransform=i,this.origin=s}}const Qbe=Ts();class ewe{constructor(t,r,i,s,n,o,a,l,c){this.createQuery=t,this.deleteQuery=r,this.resultAvailable=i,this.getResult=s,this.disjoint=n,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}}let k_=!1;function B$t(e,t){if(t.disjointTimerQuery)return null;let r=e.getExtension("EXT_disjoint_timer_query_webgl2");return r&&eo(e)?new ewe(()=>e.createQuery(),i=>{e.deleteQuery(i),k_=!1},i=>e.getQueryParameter(i,e.QUERY_RESULT_AVAILABLE),i=>e.getQueryParameter(i,e.QUERY_RESULT),()=>e.getParameter(r.GPU_DISJOINT_EXT),i=>{k_||(k_=!0,e.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{e.endQuery(r.TIME_ELAPSED_EXT),k_=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>e.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=e.getExtension("EXT_disjoint_timer_query"),r?new ewe(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),k_=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>e.getParameter(r.GPU_DISJOINT_EXT),i=>{k_||(k_=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),k_=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function z$t(e,t){const r=e.capabilities.disjointTimerQuery;return C(r)?null:new V$t(r,t)}class V$t{constructor(t,r){this._timer=t,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const s=this._timer.createQuery(),n=this._timer.createQuery();this._queryPool.push(s,n),this._queryResults.set(i,null)})}start(){k_||(this._currentQuery=this._queryPool.pop(),C(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(t){if(this._timer.disjoint()||C(this._currentQuery)||!this._queryResults.has(t))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(t);if(C(r))return this._queryResults.set(t,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(t,this._currentQuery),this._currentQuery=null,i}abort(){v(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){v(this._currentQuery)&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(t=>{this._timer.deleteQuery(t)}),this._queryResults.forEach(t=>{C(t)||this._timer.deleteQuery(t)})}}var Ji;(function(e){e.OVERLAY="overlay",e.PREPARE="prepare",e.SHADOW_MAP="shadow map",e.LINEAR_DEPTH="linear depth",e.ACCUMULATED_SHADOWS="accumulated shadows",e.NORMALS="normals",e.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",e.SSAO="SSAO",e.OPAQUE="opaque",e.OPAQUE_EDGES="opaque edges",e.VOXEL="voxel",e.TRANSPARENT="transparent",e.TRANSPARENT_EDGES="transparent edges",e.HUD_VISIBILITY="HUD visibility",e.TRANSPARENT_TERRAIN="transparent terrain",e.ENVIRONMENT="environment",e.LASER_LINE="laser line",e.OCCLUDED="occluded",e.ANTIALIASING="antialiasing",e.HIGHLIGHTS="highlights",e.HUD_OCCLUDED="HUD occluded",e.HUD_NOT_OCCLUDED="HUD not occluded",e.FINISH="finish"})(Ji||(Ji={}));const twe="Total";class j$t{constructor(t){this._rctx=t,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new fv(twe),this._cpuTimeSamplers=new Map(Object.values(Ji).map(r=>[r,new fv(r)])),this._enableGPUTimer=0,this._totalGPUTime=new fv("GPU"),this._gpuTimeSamplers=new Map(Object.values(Ji).map(r=>[r,new fv(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return v(this._gpuTimerPool)}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(C(this._gpuTimerPool)){const t=[...Object.values(Ji),twe];this._gpuTimerPool=z$t(this._rctx,t)}return C(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:Vse(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=tt(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),v(this._gpuTimerPool)&&this._gpuTimerPool.start()}advance(t){const r=performance.now();if(this._cpuTimeSamplers.get(t).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,v(this._gpuTimerPool)){const i=this._gpuTimerPool.stop(t);this._gpuTimeSamplers.get(t).record(i),this._gpuTimerPool.start()}}finishFrame(){if(v(this._gpuTimerPool)){const r=this._gpuTimerPool.stop(Ji.FINISH);this._gpuTimeSamplers.get(Ji.FINISH).record(r)}const t=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+t,this._totalCPUTime.record(t),v(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}}const rwe=.9;let U_=class extends be{constructor(e,t,r,i,s,n,o,a,l){super({}),this._materialRepository=e,this._shaderTechniqueRepository=r,this._rctx=i,this._compositingHelper=s,this._magnifierHelper=n,this._requestRender=o,this._stage=l,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=c=>{},this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new Y3t,this._antialiasing=!0,this._oitEnabled=!1,this._multipassTerrain=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=Ml.Opaque,this._waterReflectionEnabled=!1,this._hasAnimations=!1,this._animationTimestep=Rbe,this._handles=new hr,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new Z$(this._rctx,r),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new C3t(this._rctx,this._compositingHelper),this.performanceInfo=new j$t(this._rctx),this._shadowMap=new Rce(this._rctx,l.viewingMode),this._ssaoHelper=new t4e(r,this._rctx,()=>this._requestRender()),this._highlight=new x3t(r,this._rctx),this._shadowHighlight=new X3t(this._rctx,l.viewingMode),this._shadowAccumulator=new wl(this._rctx,r,l,c=>{const d=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=d},(c,d,p)=>{c.shadowMap.start(c.camera,d,p),this._renderShadowCascades(V.Shadow,c.shadowMap),c.camera.setGLViewport(this._rctx),this._prepare(c.camera,c.contentCamera)},()=>this._requestRender()),this._renderContext=new Dwt(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new M3t({renderContext:this._renderContext,shaderTechniqueRepository:r,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:a}),this.renderPassManager=new d3t(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ie(()=>this._stage.state.camera,()=>this._requestRender(),Qi),ie(()=>hi.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(dr.TRANSPARENT):()=>{},this._requestRender()},pt)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=Qe(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=tt(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),m7.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||v(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return C(this._edgeView)&&(this._edgeView=new gm({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(ie(()=>qi(this._edgeView,e=>e.updating),()=>this._requestRender(),bi)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return jRe(this._bindParameters.ssr.reprojectionMatrix,Hn)}set _reprojectionMatrix(e){Mse(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setRenderParameters(e){const{_shadowMap:t,_ssaoHelper:r,_bindParameters:i}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&i.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(i.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&t.enabled!==e.shadowMap&&(t.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),v(e.environment)){v(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&r.enabled!==e.environment.lighting.ambientOcclusionEnabled&&(r.enabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const s=e.environment.lighting.type!=="virtual";i.enableFillLights!==s&&(i.enableFillLights=s,this._requestRender())}e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender()),e.antialiasingEnabled!==void 0&&this._antialiasing!==e.antialiasingEnabled&&(this._antialiasing=e.antialiasingEnabled,this._requestRender()),e.highQualityTransparency!==void 0&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.renderOverlay!==void 0&&this._renderOverlay!==e.renderOverlay&&(this._renderOverlay=e.renderOverlay,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==e.terrainRenderingEnabled&&(this._terrainRenderingEnabled=e.terrainRenderingEnabled,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:r,updates:i}=e;if(t.length===0&&r.length===0&&i.length===0)return;r.forAll(({id:o})=>this._content.delete(o)),t.forAll(o=>this._content.set(o.id,o));const s=jFe(e);let n=!1;s.forEach((o,a)=>{let l=this._materialRenderers.get(a);if(!l){if(!(o.adds.length>0))return;l=new QFe(this._rctx,this._materialRepository,a),this._materialRenderers.set(a,l)}l.modify(o),l.isEmpty&&(n=!0)}),n&&this._materialRenderers.forEach((o,a)=>{o.isEmpty&&(this._materialRenderers.delete(a),o.dispose())}),this._hasHighlights=wo(this._materialRenderers,o=>o.hasHighlights),this._bindParameters.hasOccludees=wo(this._materialRenderers,o=>o.hasOccludees),this._hasWater=wo(this._materialRenderers,o=>o.hasWater),this._hasHUDElements=wo(this._materialRenderers,o=>o.requiresSlot(Ee.LINE_CALLOUTS_HUD_DEPTH,V.Color)||o.requiresSlot(Ee.HUD_MATERIAL,V.Color)||o.requiresSlot(Ee.LABEL_MATERIAL,V.Color)),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach(t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}render(e,t,r,i,s){this._isRendering=!0;const{camera:n,contentCamera:o}=r;this._renderContext.time=s,this.performanceInfo.startFrame(),this._renderOverlay(s),this.performanceInfo.advance(Ji.OVERLAY),this._bindParameters.transparencyPassType=Ct.NONE;const a=this._offscreenRendering;a.setupRenderTarget(this.hasWaterReflection);const l=u1(this._sliceHelper.plane);i===EE.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),n.setGLViewport(this._rctx),this._prepare(n,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Ji.PREPARE);const c=this._computeDepthRange(n);this._renderShadowMap(e,n,this._bindParameters.lighting.mainLight.direction,c),this.performanceInfo.advance(Ji.SHADOW_MAP),a.initializeFrame(n),this._ensureBindParameters(n,o),this._renderLinearDepth(),this.performanceInfo.advance(Ji.LINEAR_DEPTH),this._accumulateShadows(c,n,o),this.performanceInfo.advance(Ji.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(Ji.NORMALS),this._ensureBindParametersSSR(),this._renderSSAO(),this.performanceInfo.advance(Ji.SSAO),this._renderContext.output=V.Color,a.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Ji.OPAQUE);const d=this._terrainRenderingEnabled&&this._terrainTransparency!==Ml.Opaque,p=this._multipassTerrain&&d;this._renderTerrainLinearDepth(p),this._setMultipassEnabled(p),this._setTerrainCulling(p),this._renderEdges(dr.OPAQUE),this.performanceInfo.advance(Ji.OPAQUE_EDGES),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(Ee.VOXEL),this.performanceInfo.advance(Ji.VOXEL),this._renderHiddenTransparentEdges();const f=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;f&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Ji.TRANSPARENT),this._renderGeometryLinearDepth(p);const m=this._renderHUDVisibility(this._multipassTerrain&&d);p||this._renderInternalSlot(Ee.LINE_CALLOUTS),this.performanceInfo.advance(Ji.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(t),this.performanceInfo.advance(Ji.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(dr.TRANSPARENT,p),this.performanceInfo.advance(Ji.TRANSPARENT_EDGES),this._renderTransparentTerrain(),d&&m&&(p?this._renderLineCallouts(gh.Occluded):a.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(gh.Occluded,a.framebuffer),this.performanceInfo.advance(Ji.HUD_OCCLUDED)),this.performanceInfo.advance(Ji.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),d&&(a.compositeTransparentTerrainOntoMain(this._bindParameters),p&&(this._renderEdges(dr.OPAQUE),this.performanceInfo.advance(Ji.OPAQUE_EDGES),f&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Ji.TRANSPARENT),this._renderEdges(dr.TRANSPARENT),this.performanceInfo.advance(Ji.TRANSPARENT_EDGES))),p&&this._renderLineCallouts(gh.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),a.renderToTargets(()=>{this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Ee.LASERLINES)},a.currentColorTarget,a.mainDepth),this.performanceInfo.advance(Ji.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&a.renderTmpAndCompositeToMain(()=>this._renderSlot(Ee.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Dl.PremultipliedAlpha),this.performanceInfo.advance(Ji.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(Ji.OCCLUDED);const g=i===EE.ON&&this._magnifierHelper.enabled,_=g&&C(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(_);const x=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(x)&&v(x)&&this._compositingHelper.composite(this._bindParameters,x,Dl.None),this.performanceInfo.advance(Ji.ANTIALIASING),this._renderHUD(gh.NotOccluded,_),this.performanceInfo.advance(Ji.HUD_NOT_OCCLUDED),this._renderHighlights(_,this._bindParameters),this.performanceInfo.advance(Ji.HIGHLIGHTS),g&&this._magnifierHelper.render(this._rctx,this._bindParameters),_!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,Dl.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=l,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_renderObjectAndLayerIdColor(e){v(e)&&pe("enable-feature:objectAndLayerId-rendering")&&(this._rctx.bindFramebuffer(e),this._offscreenRendering.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(V.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(e),this._offscreenRendering.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=gh.NotOccluded,this._renderInternalSlot(Ee.HUD_MATERIAL)},null,!0,!0))}finish(e){if(this._hasAnimations||(this._animationTimestep=0),e===cn.BACKGROUND){let t=0;this.performanceInfo.gpuSamplingEnabled?t=this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError();const r=this.performanceInfo.elapsedTime,i=Math.max(r,t),s=_e(i/l3t,u3t,Rbe);this._animationTimestep=this._animationTimestep*rwe+s*(1-rwe)}}readDepthPixels(e,t,r){const i=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=ds.COLOR_BUFFER_BIT|ds.DEPTH_BUFFER_BIT|ds.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(V.Depth)}i.readPixels(t[0],t[1],t[2],t[3],qe.RGBA,Nt.UNSIGNED_BYTE,r)}readHUDVisibility(e,t,r,i,s){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,t,r,i,qe.RGBA,Nt.UNSIGNED_BYTE,s)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const r=this._edgeView;v(r)&&r.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,e),this._bindParameters,Dl.Alpha,t)}_renderShadowMap(e,t,r,i){const s=this._shadowMap;s.enabled&&(s.start(t,r,i),this._shadowHighlight.updateParameters(t,r),this._needsShadowHighlight?(this._renderShadowCascades(V.ShadowHighlight,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,dI.Highlight)),s.clear(),this._renderShadowCascades(V.ShadowExludeHighlight,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,dI.Default),this._renderGeometryAndTransparentTerrainPass(V.ShadowHighlight)})):this._renderShadowCascades(V.Shadow),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,r=i=>{}){for(const i of t.getCascades())i.camera.setGLViewport(this._rctx),this._prepare(i.camera,i.camera),this._renderGeometryAndTransparentTerrainPass(e),r(i)}get _needsLinearDepth(){return this._ssaoHelper.ready||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(V.Depth),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.output;this._renderContext.output=V.Depth,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.output;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(V.Depth),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.ready}_renderNormal(){this._needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(V.Normal)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return Zre;const t=HPt(e,this._content,this._stage.layers);return mI(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.output=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.output=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(){this._ssaoHelper.loading?this._requestRender():this._ssaoHelper.computeSSAO(this._bindParameters,this._offscreenRendering.linearDepthTexture,this._offscreenRendering.normalTexture)}_renderOpaqueGeometry(){this._renderSlot(Ee.INTEGRATED_MESH),this._renderSlot(Ee.OPAQUE_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL),this._renderSlot(Ee.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Ee.TRANSPARENT_TERRAIN)}_renderHUDVisibility(e){let t=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,t=this._renderInternalSlot(Ee.OCCLUSION_PIXELS)},e),t}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===gh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(Ee.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Ee.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,Dl.PremultipliedAlpha)):e===gh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(gh.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Ee.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Ee.HUD_MATERIAL),this._renderInternalSlot(Ee.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(e,t){if(!this._needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const r=this._highlight,i=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(V.Highlight),this._rctx.clearSafe(ds.DEPTH_BUFFER_BIT),this._renderHUDElements(gh.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(t,e),r.render(this._bindParameters,i,e)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,r){this._needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,t,r)}_renderOrderIndependentTransparency(e,t){const r=s=>{this._bindParameters.transparencyPassType=s,this._offscreenRendering.renderOITPass(()=>e(),s,t)},i=this._renderContext.output;this._renderContext.output=V.Alpha,r(Ct.Alpha),this._renderContext.output=V.Color,r(Ct.Color),r(Ct.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=Ct.NONE,this._renderContext.output=i,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&o.renderOccluded===Rs.OccludeAndTransparentStencil&&(e|=o.renderOccluded,h3.push(o))});const t=this._offscreenRendering,r=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};h3.length!==0&&(this._renderInternalSlot(Ee.OCCLUDER_MATERIAL,h3),r(.5,Rs.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Ee.TRANSPARENT_OCCLUDER_MATERIAL,h3),!1,!1),h3.length=0),this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&(o.renderOccluded===Rs.OccludeAndTransparent||o.renderOccluded===Rs.Transparent||o.renderOccluded===Rs.Opaque)&&(e|=o.renderOccluded,d3.push(o))});const i=this._renderPlugins.renderOccludedFlags;if(e|=i,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,i>Rs.Occlude&&this._renderSlot(Ee.OCCLUDED_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL,d3),this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL,d3),this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,d3),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=V.Color,r(.5,Rs.OccludeAndTransparent,()=>s(Rs.OccludeAndTransparent),!0,Cu.OutlineVisualElementMask),r(.5,Rs.Transparent,()=>s(Rs.Transparent),!0,Cu.OutlineVisualElementMask),r(1,Rs.Opaque,()=>s(Rs.Opaque),!0,Cu.OutlineVisualElementMask),d3.length=0}_renderAntiAliasing(e){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&v(e))return this._smaaPass.render(e),!0}else this._smaaPass.disable();return!1}_prepare(e,t){this._needsTransparentPass=wo(this._materialRenderers,r=>r.requiresSlot(Ee.TRANSPARENT_MATERIAL,V.Color)),this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){var i;this._bindParameters.camera=e,this._bindParameters.contentCamera=t;const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.mainColorTexture=r.mainColorTexture,this._bindParameters.highlightDepthTexture=(i=r.depthTexture)!=null?i:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Hn:(Pn(swe,this._bindParameters.camera.viewMatrix),Pn(iwe,this._bindParameters.camera.projectionMatrix),Hs(wA,swe,iwe),Hs(wA,this._renderContext.lastFrameCamera.viewMatrix,wA),Hs(wA,this._renderContext.lastFrameCamera.projectionMatrix,wA),this._reprojectionMatrix=wA),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(e,t){let r=!1;return this._bindParameters.slot=e,v(t)?t.forEach(i=>{if(!i.shouldRender(this._renderContext))return;const s=this._materialRenderers.get(i);v(s)&&(r=s.render(this._renderContext.output,this._bindParameters)||r)}):this._materialRenderers.forEach((i,s)=>{s.shouldRender(this._renderContext)&&i.render(this._renderContext.output,this._bindParameters)&&(r=!0)}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=hDe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,r,i,s,n,o,a,l,c;return{offscreen:(t=(e=this._offscreenRendering)==null?void 0:e.gpuMemoryUsage)!=null?t:0,highlights:((i=(r=this._highlight)==null?void 0:r.gpuMemoryUsage)!=null?i:0)+((n=(s=this._shadowHighlight)==null?void 0:s.gpuMemoryUsage)!=null?n:0),shadows:(a=(o=this._shadowMap)==null?void 0:o.gpuMemoryUsage)!=null?a:0,ssao:(c=(l=this._ssaoHelper)==null?void 0:l.gpuMemoryUsage)!=null?c:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,getFramebufferTexture:t=>{switch(t){case hw.Color:return e._offscreenRendering.colorTexture;case hw.LinearDepth:return e._offscreenRendering.linearDepthTexture;case hw.Normals:return e._offscreenRendering.normalTexture;case hw.ShadowMap:return e._shadowMap.depthTexture;case hw.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case hw.Highlight:return e._offscreenRendering.highlightTexture}}}}};var hw;u([h()],U_.prototype,"_shadowAccumulator",void 0),u([h()],U_.prototype,"_smaaPass",void 0),u([h()],U_.prototype,"_antialiasing",void 0),u([h()],U_.prototype,"_edgeView",void 0),u([h()],U_.prototype,"updating",null),u([h()],U_.prototype,"isCameraFinal",null),U_=u([I("esri.views.3d.webgl-engine.lib.Renderer")],U_),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(hw||(hw={}));const d3=[],h3=[],iwe=$e(),swe=$e(),wA=$e();class nwe{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Ae.ONE,dstRGB:Ae.ZERO,srcAlpha:Ae.ONE,dstAlpha:Ae.ZERO},this.blendEquation={mode:E0.ADD,modeAlpha:E0.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Wm.BACK,this.frontFace=HR.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=rs.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Wm.FRONT_AND_BACK,func:rs.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Wm.FRONT_AND_BACK,fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}}class G$t{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach(r=>{var i;t.set(r,((i=t.get(r))!=null?i:0)+1)}),t.forEach((r,i)=>{const s=i.split(`
`);s.shift(),s.shift(),console.log(`${r}: ${s.shift()}`),s.forEach(n=>console.log("   ",n))})}}}const H$t={RECORD_ALLOCATIONS:!1};class q$t{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new G$t(H$t.RECORD_ALLOCATIONS);this._current.length<Vo.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,r){const i=++this._current[t];this._max[t]=Math.max(i,this._max[t]),this._allocations.add(r)}decrement(t,r){--this._current[t],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,r)=>t+r,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<Vo.COUNT;++t){const r=this._current[t];r>0&&console.log(`${Vo[t]}: ${r}`)}}this._allocations.print()}}const W$t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var owe,yke={exports:{}};(owe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(yke.exports=owe);const X$t=yke.exports;var awe,_ke={exports:{}};awe=_ke,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(awe.exports=t)}();const lwe=_ke.exports;var vke={exports:{}};(function(e){(function(t){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(e.exports=r)})()})(vke);const Y$t=vke.exports;var Wf=999,cwe=9999,CY=0,AY=1,uwe=2,dwe=3,hwe=4,GU=5,Z$t=6,J$t=7,K$t=8,pwe=9,Q$t=10,fwe=11,eDt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function tDt(){var e,t,r,i=0,s=0,n=Wf,o=[],a=[],l=1,c=0,d=0,p=!1,f=!1,m="";return function(G){return a=[],G!==null?_(G.replace?G.replace(/\r\n/g,`
`):G):x()};function g(G){G.length&&a.push({type:eDt[n],data:G,position:d,line:l,column:c})}function _(G){var J;for(i=0,r=(m+=G).length;e=m[i],i<r;){switch(J=i,n){case CY:i=O();break;case AY:i=E();break;case uwe:i=T();break;case dwe:i=A();break;case hwe:i=k();break;case fwe:i=D();break;case GU:i=L();break;case cwe:i=q();break;case pwe:i=w();break;case Wf:i=b()}J!==i&&(m[J]===`
`?(c=0,++l):++c)}return s+=i,m=m.slice(i),a}function x(G){return o.length&&g(o.join("")),n=Q$t,g("(eof)"),a}function b(){return o=o.length?[]:o,t==="/"&&e==="*"?(d=s+i-1,n=CY,t=e,i+1):t==="/"&&e==="/"?(d=s+i-1,n=AY,t=e,i+1):e==="#"?(n=uwe,d=s+i,i):/\s/.test(e)?(n=pwe,d=s+i,i):(p=/\d/.test(e),f=/[^\w_]/.test(e),d=s+i,n=p?hwe:f?dwe:cwe,i)}function w(){return/[^\s]/g.test(e)?(g(o.join("")),n=Wf,i):(o.push(e),t=e,i+1)}function T(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,i+1):(g(o.join("")),n=Wf,i)}function E(){return T()}function O(){return e==="/"&&t==="*"?(o.push(e),g(o.join("")),n=Wf,i+1):(o.push(e),t=e,i+1)}function A(){if(t==="."&&/\d/.test(e))return n=GU,i;if(t==="/"&&e==="*")return n=CY,i;if(t==="/"&&e==="/")return n=AY,i;if(e==="."&&o.length){for(;R(o););return n=GU,i}if(e===";"||e===")"||e==="("){if(o.length)for(;R(o););return g(e),n=Wf,i+1}var G=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||G){for(;R(o););return n=Wf,i}return o.push(e),t=e,i+1}function R(G){for(var J,ee,se=0;;){if(J=lwe.indexOf(G.slice(0,G.length+se).join("")),ee=lwe[J],J===-1){if(se--+G.length>0)continue;ee=G.slice(0,1).join("")}return g(ee),d+=ee.length,(o=o.slice(ee.length)).length}}function D(){return/[^a-fA-F0-9]/.test(e)?(g(o.join("")),n=Wf,i):(o.push(e),t=e,i+1)}function k(){return e==="."||/[eE]/.test(e)?(o.push(e),n=GU,t=e,i+1):e==="x"&&o.length===1&&o[0]==="0"?(n=fwe,o.push(e),t=e,i+1):/[^\d]/.test(e)?(g(o.join("")),n=Wf,i):(o.push(e),t=e,i+1)}function L(){return e==="f"&&(o.push(e),t=e,i+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,i+1):/[^\d]/.test(e)?(g(o.join("")),n=Wf,i):(o.push(e),t=e,i+1)}function q(){if(/[^\d\w_]/.test(e)){var G=o.join("");return n=X$t.indexOf(G)>-1?K$t:Y$t.indexOf(G)>-1?J$t:Z$t,g(o.join("")),n=Wf,i}return o.push(e),t=e,i+1}}function rDt(e){var t=tDt(),r=[];return r=(r=r.concat(t(e))).concat(t(null))}function iDt(e){return rDt(e)}function sDt(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const OY=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function nDt(e,t="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=i.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===r)return o;if(o===t)return s.data="#version "+r,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function oDt(e,t){for(let r=t-1;r>=0;r--){const i=e[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function J$(e,t,r,i){i=i||r;for(const s of e)if(s.type==="ident"&&s.data===r)return i in t?t[i]++:t[i]=0,J$(e,t,i+"_"+t[i],i);return r}function bke(e,t,r="afterVersion"){function i(l,c){for(let d=c;d<l.length;d++){const p=l[d];if(p.type==="operator"&&p.data===";")return d}return null}function s(l){let c=-1,d=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++d:m.data.match(/\#endif\s*.*/)&&--d),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=i(l,f);if(g===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,g)}c<p&&d===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function aDt(e,t,r,i="lowp"){bke(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function lDt(e,t,r,i,s="lowp"){bke(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function cDt(e,t){let r,i,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(r=n),o.data==="]")){i=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return r&&i&&e.splice(r,i-r+1),s}function mwe(e,t){const r=uDt();if(v(r))return r;const i=iDt(e);if(nDt(i,"100","300 es")==="300 es")return e;let s=null,n=null;const o={},a={};for(let l=0;l<i.length;++l){const c=i[l];switch(c.type){case"keyword":t===Oh.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===Oh.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===Oh.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=J$(i,o,"fragColor"),aDt(i,s,"vec4")),c.data=s),t===Oh.FRAGMENT_SHADER&&c.data==="gl_FragData"){const d=cDt(i,l+1),p=J$(i,o,"fragData");lDt(i,p,"vec4",d,"mediump"),c.data=p}else t===Oh.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=J$(i,o,"gl_FragDepth")),c.data=n);break;case"ident":if(W$t.includes(c.data)){if(t===Oh.VERTEX_SHADER&&oDt(i,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=J$(i,o,c.data)),c.data=a[c.data]}}}for(let l=i.length-1;l>=0;--l){const c=i[l];if(c.type==="preprocessor"){const d=c.data.match(/\#extension\s+(.*)\:/);if(d&&d[1]&&OY.includes(d[1].trim())){const m=i[l+1];i.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&OY.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&OY.includes(f[1].trim())&&(c.data="#if 0")}}return dDt(e,sDt(i))}function uDt(e){return null}function dDt(e,t){return t}const hDt=4294967295;class pDt{constructor(t,r,i,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===jt.WEBGL2&&(r=mwe(r,Oh.VERTEX_SHADER),i=mwe(i,Oh.FRAGMENT_SHADER)),this._vShader=gwe(this._context,Oh.VERTEX_SHADER,r),this._fShader=gwe(this._context,Oh.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Vo.Shader,this),Vte()&&(this.vertexShader=r,this.fragmentShader=i)}get glName(){if(v(this._glName))return this._glName;if(C(this._vShader))return null;const t=this._context.gl,r=t.createProgram();if(t.attachShader(r,this._vShader),t.attachShader(r,this._fShader),this._locations.forEach((i,s)=>t.bindAttribLocation(r,i,s)),t.linkProgram(r),Vte()&&!t.getProgramParameter(r,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(r,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(r)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===jt.WEBGL2){const i=t;for(const[s,n]of this._uniformBlockBindings){const o=i.getUniformBlockIndex(r,s);o<hDt&&i.uniformBlockBinding(r,o,n)}}return this._glName=r,this._context.instanceCounter.increment(Vo.Program,this),r}get hasGLName(){return v(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Vo.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Vo.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,r){const i=this._nameToUniform1[t];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(t),r),this._nameToUniform1[t]=r)}setUniform1iv(t,r){Yg(this._nameToUniform1v,t,r)&&this._context.gl.uniform1iv(this._getUniformLocation(t),r)}setUniform2iv(t,r){Yg(this._nameToUniform2,t,r)&&this._context.gl.uniform2iv(this._getUniformLocation(t),r)}setUniform3iv(t,r){Yg(this._nameToUniform3,t,r)&&this._context.gl.uniform3iv(this._getUniformLocation(t),r)}setUniform4iv(t,r){Yg(this._nameToUniform4,t,r)&&this._context.gl.uniform4iv(this._getUniformLocation(t),r)}setUniform1f(t,r){const i=this._nameToUniform1[t];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(t),r),this._nameToUniform1[t]=r)}setUniform1fv(t,r){Yg(this._nameToUniform1v,t,r)&&this._context.gl.uniform1fv(this._getUniformLocation(t),r)}setUniform2f(t,r,i){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),r,i),this._nameToUniform2.set(t,[r,i])):r===s[0]&&i===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),r,i),s[0]=r,s[1]=i)}setUniform2fv(t,r){Yg(this._nameToUniform2,t,r)&&this._context.gl.uniform2fv(this._getUniformLocation(t),r)}setUniform3f(t,r,i,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),r,i,s),this._nameToUniform3[t]=[r,i,s]):r===n[0]&&i===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),r,i,s),n[0]=r,n[1]=i,n[2]=s)}setUniform3fv(t,r){Yg(this._nameToUniform3,t,r)&&this._context.gl.uniform3fv(this._getUniformLocation(t),r)}setUniform4f(t,r,i,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),r,i,s,n),this._nameToUniform4.set(t,[r,i,s,n])):o!==void 0&&r===o[0]&&i===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),r,i,s,n),o[0]=r,o[1]=i,o[2]=s,o[3]=n)}setUniform4fv(t,r){Yg(this._nameToUniform4,t,r)&&this._context.gl.uniform4fv(this._getUniformLocation(t),r)}setUniformMatrix3fv(t,r,i=!1){Yg(this._nameToUniformMatrix3,t,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),i,r)}setUniformMatrix4fv(t,r,i=!1){Yg(this._nameToUniformMatrix4,t,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),i,r)}stop(){}}function gwe(e,t,r){const i=e.gl,s=i.createShader(t);return i.shaderSource(s,r),i.compileShader(s),Vte()&&!i.getShaderParameter(s,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===Oh.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(s)),console.error(fDt(r))),s}function fDt(e){let t=2;return e.replace(/\n/g,()=>`
`+mDt(t++)+":")}function mDt(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function Yg(e,t,r){const i=e.get(t);return i?Mse(i,r):(e.set(t,Array.from(r)),!0)}class gDt{constructor(t){this._rctx=t,this._store=new Sce}dispose(){this._store.forEach(t=>t.forEach(r=>r.dispose())),this._store.clear()}acquire(t,r,i,s){const n=this._store.get(t,r);if(v(n))return n.ref(),n;const o=new pDt(this._rctx,t,r,i,s);return o.ref(),this._store.set(t,r,o),o}get test(){let t=0;return this._store.forEach(r=>r.forEach(i=>t+=i.hasGLName?2:1)),{cachedWebGLObjects:t}}}function ywe(e,t){e.resetState();const r=new ps(e,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE},{target:xt.TEXTURE_2D,wrapMode:It.CLAMP_TO_EDGE,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.NEAREST,width:1,height:1}),i=Ur.createVertex(e,ni.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Ef(e,new Map([["position",0]]),{geometry:[new Ha("position",2,mt.UNSIGNED_SHORT,0,4)]},{geometry:i}),n=Fe(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),o=Fe(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),a=yDt(e,n,o,t);e.bindFramebuffer(r),e.setViewport(0,0,1,1),e.bindVAO(s),e.drawArrays(Ut.TRIANGLE_STRIP,0,4);const l=new Uint8Array(4);r.readPixels(0,0,1,1,qe.RGBA,Nt.UNSIGNED_BYTE,l),a.dispose(),s.dispose(!1),i.dispose(),r.dispose();const c=(n[2]-o[2])/25,d=oce(l);return Math.abs(c-d)}function yDt(e,t,r,i){const s=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${i?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,n=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,o=e.programCache.acquire(s,n,new Map([["position",0]])),a=new Float32Array(6);ere(t,a,3);const l=new Float32Array(6);return ere(r,l,3),e.useProgram(o),o.setUniform3f("u_highA",a[0],a[2],a[4]),o.setUniform3f("u_lowA",a[1],a[3],a[5]),o.setUniform3f("u_highB",l[0],l[2],l[4]),o.setUniform3f("u_lowB",l[1],l[3],l[5]),o}var _we,vwe,bwe,wke={exports:{}};function _Dt(e){var g,_,x,b,w;if(!e.gl)return!1;if(e.type===jt.WEBGL1)return!(!((g=e.capabilities.textureFloat)!=null&&g.textureFloat)||!((_=e.capabilities.colorBufferFloat)!=null&&_.textureFloat));if(!(((x=e.capabilities.textureFloat)==null?void 0:x.textureFloat)&&((b=e.capabilities.colorBufferFloat)==null?void 0:b.textureFloat)&&((w=e.capabilities.colorBufferFloat)==null?void 0:w.floatBlend)))return!1;const t=new ps(e,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE},{target:xt.TEXTURE_2D,wrapMode:It.CLAMP_TO_EDGE,pixelFormat:qe.RGBA,dataType:Nt.FLOAT,internalFormat:Tt.RGBA32F,samplingMode:at.NEAREST,width:1,height:1}),r=Ur.createVertex(e,ni.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),i=new Ef(e,new Map([["a_pos",0]]),{geometry:[new Ha("a_pos",2,mt.UNSIGNED_SHORT,0,4)]},{geometry:r}),s=`
  precision highp float;
  attribute vec2 a_pos;

  void main() {
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,n=`
   precision highp float;

   void main() {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
   }
  `,o=e.programCache.acquire(s,n,new Map([["a_pos",0]]));e.useProgram(o);const a=e.getBoundFramebufferObject(),{x:l,y:c,width:d,height:p}=e.getViewport();e.bindFramebuffer(t),e.setViewport(0,0,1,1),e.bindVAO(i),e.drawArrays(Ut.TRIANGLE_STRIP,0,4);const f=Ht({blending:kNe});e.setPipelineState(f),e.drawArrays(Ut.TRIANGLE_STRIP,0,4),wke.exports.init(e);const m=e.gl.getError();return e.setViewport(l,c,d,p),e.bindFramebuffer(a),o.dispose(),i.dispose(!1),r.dispose(),t.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}_we=wke,vwe=function(){var e=function(_){window.console&&window.console.log&&window.console.log(_)},t=function(_){window.console&&window.console.error?window.console.error(_):e(_)},r={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},i=null,s=null;function n(_){if(i==null)for(var x in i={},s={},_)typeof _[x]=="number"&&(i[_[x]]=x,s[x]=_[x])}function o(){if(i==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(_){return o(),i[_]!==void 0}function l(_){o();var x=i[_];return x!==void 0?"gl."+x:"/*UNKNOWN WebGL ENUM*/ 0x"+_.toString(16)}function c(_,x,b,w){var T;if((T=r[_])!==void 0&&(T=T[x])!==void 0&&T[b]){if(typeof T[b]=="object"&&T[b].enumBitwiseOr!==void 0){for(var E=T[b].enumBitwiseOr,O=0,A=[],R=0;R<E.length;++R){var D=s[E[R]];(w&D)!=0&&(O|=D,A.push(l(D)))}return O===w?A.join(" | "):l(w)}return l(w)}return w===null?"null":w===void 0?"undefined":w.toString()}function d(_,x){for(var b="",w=x.length,T=0;T<w;++T)b+=(T==0?"":", ")+c(_,w,T,x[T]);return b}function p(_,x,b){_.__defineGetter__(b,function(){return x[b]}),_.__defineSetter__(b,function(w){x[b]=w})}function f(_,x,b,w){w=w||_,n(_),x=x||function(D,k,L){for(var q="",G=L.length,J=0;J<G;++J)q+=(J==0?"":", ")+c(k,G,J,L[J]);t("WebGL error "+l(D)+" in "+k+"("+q+")")};var T={};function E(D,k){return function(){b&&b(k,arguments);var L=D[k].apply(D,arguments),q=w.getError();return q!=0&&(T[q]=!0,x(q,k,arguments)),L}}var O={};for(var A in _)if(typeof _[A]=="function")if(A!="getExtension")O[A]=E(_,A);else{var R=E(_,A);O[A]=function(){return f(R.apply(_,arguments),x,b,w)}}else p(O,_,A);return O.getError=function(){for(var D in T)if(T.hasOwnProperty(D)&&T[D])return T[D]=!1,D;return _.NO_ERROR},O}function m(_){var x=_.getParameter(_.MAX_VERTEX_ATTRIBS),b=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,b);for(var w=0;w<x;++w)_.disableVertexAttribArray(w),_.vertexAttribPointer(w,4,_.FLOAT,!1,0,0),_.vertexAttrib1f(w,0);_.deleteBuffer(b);var T=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS);for(w=0;w<T;++w)_.activeTexture(_.TEXTURE0+w),_.bindTexture(_.TEXTURE_CUBE_MAP,null),_.bindTexture(_.TEXTURE_2D,null);for(_.activeTexture(_.TEXTURE0),_.useProgram(null),_.bindBuffer(_.ARRAY_BUFFER,null),_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,null),_.bindFramebuffer(_.FRAMEBUFFER,null),_.bindRenderbuffer(_.RENDERBUFFER,null),_.disable(_.BLEND),_.disable(_.CULL_FACE),_.disable(_.DEPTH_TEST),_.disable(_.DITHER),_.disable(_.SCISSOR_TEST),_.blendColor(0,0,0,0),_.blendEquation(_.FUNC_ADD),_.blendFunc(_.ONE,_.ZERO),_.clearColor(0,0,0,0),_.clearDepth(1),_.clearStencil(-1),_.colorMask(!0,!0,!0,!0),_.cullFace(_.BACK),_.depthFunc(_.LESS),_.depthMask(!0),_.depthRange(0,1),_.frontFace(_.CCW),_.hint(_.GENERATE_MIPMAP_HINT,_.DONT_CARE),_.lineWidth(1),_.pixelStorei(_.PACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_ALIGNMENT,4),_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,!1),_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_.UNPACK_COLORSPACE_CONVERSION_WEBGL&&_.pixelStorei(_.UNPACK_COLORSPACE_CONVERSION_WEBGL,_.BROWSER_DEFAULT_WEBGL),_.polygonOffset(0,0),_.sampleCoverage(1,!1),_.scissor(0,0,_.canvas.width,_.canvas.height),_.stencilFunc(_.ALWAYS,0,4294967295),_.stencilMask(4294967295),_.stencilOp(_.KEEP,_.KEEP,_.KEEP),_.viewport(0,0,_.canvas.width,_.canvas.height),_.clear(_.COLOR_BUFFER_BIT|_.DEPTH_BUFFER_BIT|_.STENCIL_BUFFER_BIT);_.getError(););}function g(_){var x,b,w=[],T=[],E={},O=1,A=!1,R=[],D=0,k=0,L=!1,q=0,G={};function J(Y){return typeof Y=="function"?Y:function(ce){Y.handleEvent(ce)}}_.getContext=(b=_.getContext,function(){var Y=b.apply(_,arguments);if(Y instanceof WebGLRenderingContext){if(Y!=x){if(x)throw"got different context";E=K(x=Y)}return E}return Y});var ee=function(Y){w.push(J(Y))},se=function(Y){T.push(J(Y))};function X(Y){var ce=Y.addEventListener;Y.addEventListener=function(we,Oe,Be){switch(we){case"webglcontextlost":ee(Oe);break;case"webglcontextrestored":se(Oe);break;default:ce.apply(Y,arguments)}}}function F(){for(var Y=Object.keys(G),ce=0;ce<Y.length;++ce)delete G[Y]}function N(){++k,A||D==k&&_.loseContext()}function B(Y,ce){var we=Y[ce];return function(){if(N(),!A)return we.apply(Y,arguments)}}function H(){for(var Y=0;Y<R.length;++Y){var ce=R[Y];ce instanceof WebGLBuffer?x.deleteBuffer(ce):ce instanceof WebGLFramebuffer?x.deleteFramebuffer(ce):ce instanceof WebGLProgram?x.deleteProgram(ce):ce instanceof WebGLRenderbuffer?x.deleteRenderbuffer(ce):ce instanceof WebGLShader?x.deleteShader(ce):ce instanceof WebGLTexture&&x.deleteTexture(ce)}}function W(Y){return{statusMessage:Y,preventDefault:function(){L=!0}}}return X(_),_.loseContext=function(){if(!A){for(A=!0,D=0,++O;x.getError(););F(),G[x.CONTEXT_LOST_WEBGL]=!0;var Y=W("context lost"),ce=w.slice();setTimeout(function(){for(var we=0;we<ce.length;++we)ce[we](Y);q>=0&&setTimeout(function(){_.restoreContext()},q)},0)}},_.restoreContext=function(){A&&T.length&&setTimeout(function(){if(!L)throw"can not restore. webglcontestlost listener did not call event.preventDefault";H(),m(x),A=!1,k=0,L=!1;for(var Y=T.slice(),ce=W("context restored"),we=0;we<Y.length;++we)Y[we](ce)},0)},_.loseContextInNCalls=function(Y){if(A)throw"You can not ask a lost contet to be lost";D=k+Y},_.getNumCalls=function(){return k},_.setRestoreTimeout=function(Y){q=Y},_;function K(Y){for(var ce in Y)typeof Y[ce]=="function"?E[ce]=B(Y,ce):p(E,Y,ce);E.getError=function(){if(N(),!A)for(;he=x.getError();)G[he]=!0;for(var he in G)if(G[he])return delete G[he],he;return E.NO_ERROR};for(var we=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],Oe=0;Oe<we.length;++Oe){var Be=we[Oe];E[Be]=function(he){return function(){if(N(),A)return null;var Me=he.apply(Y,arguments);return Me.__webglDebugContextLostId__=O,R.push(Me),Me}}(Y[Be])}var He=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(Oe=0;Oe<He.length;++Oe)Be=He[Oe],E[Be]=function(he){return function(){return N(),A?null:he.apply(Y,arguments)}}(E[Be]);var Se=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(Oe=0;Oe<Se.length;++Oe)Be=Se[Oe],E[Be]=function(he){return function(){return N(),!A&&he.apply(Y,arguments)}}(E[Be]);return E.checkFramebufferStatus=function(he){return function(){return N(),A?E.FRAMEBUFFER_UNSUPPORTED:he.apply(Y,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(he){return function(){return N(),A?-1:he.apply(Y,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(he){return function(){return N(),A?0:he.apply(Y,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return A},E}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:d,makeDebugContext:f,makeLostContextSimulatingCanvas:g,resetToInitialState:m}},(bwe=vwe())!==void 0&&(_we.exports=bwe);function vDt(e){const t=new ps(e,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE},{target:xt.TEXTURE_2D,wrapMode:It.CLAMP_TO_EDGE,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.NEAREST,width:1,height:1}),r=`
precision highp float;
attribute vec2 a_pos;
uniform highp sampler2D u_texture;
varying vec4 v_color;

float getBit(in float bitset, in int bitIndex) {
  float offset = pow(2.0, float(bitIndex));
  return mod(floor(bitset / offset), 2.0);
}

void main() {
  vec4 value = texture2D(u_texture, vec2(0.0));
  float bit = getBit(value.x * 255.0, 1);

  v_color = bit * vec4(1.0);
  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
}
`,i=`
precision highp float;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,s=new Uint8Array(4),n=Ur.createVertex(e,ni.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Ef(e,new Map([["a_position",0]]),{geometry:[new Ha("a_position",2,mt.SHORT,0,4)]},{geometry:n}),a=e.programCache.acquire(r,i,new Map([["a_pos",0]]));e.useProgram(a);const l=new dt(e,{target:xt.TEXTURE_2D,wrapMode:It.CLAMP_TO_EDGE,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));a.setUniform1i("u_texture",0),e.bindTexture(l,0);const c=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(a);const{x:d,y:p,width:f,height:m}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(o),e.drawArrays(Ut.TRIANGLE_STRIP,0,4),e.setViewport(d,p,f,m),t.readPixels(0,0,1,1,qe.RGBA,Nt.UNSIGNED_BYTE,s),a.dispose(),o.dispose(!1),n.dispose(),t.dispose();const g=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return g&&te.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),e.bindFramebuffer(c),g}new Ha("a_pos",2,mt.BYTE,0,2);new Ha("a_pos",2,mt.BYTE,0,4),new Ha("a_tex",2,mt.BYTE,2,4);const bDt={geometry:[new Ha("a_pos",2,mt.UNSIGNED_SHORT,0,4)]};async function wDt(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const r=new ps(e,{colorTarget:Qs.TEXTURE,depthStencilTarget:si.NONE},{target:xt.TEXTURE_2D,wrapMode:It.CLAMP_TO_EDGE,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,samplingMode:at.NEAREST,width:1,height:1}),i=Ur.createVertex(e,ni.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Ef(e,new Map([["a_pos",0]]),bDt,{geometry:i}),n=`
  precision highp float;

  attribute vec2 a_pos;
  varying vec2 v_uv;

  void main() {
    v_uv = a_pos;
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,o=`
  precision highp float;

  varying vec2 v_uv;
  uniform sampler2D u_texture;

  void main() {
    gl_FragColor = texture2D(u_texture, v_uv);
  }
  `,a=e.programCache.acquire(n,o,new Map([["a_pos",0]]));e.useProgram(a);const l=new dt(e,{dataType:Nt.UNSIGNED_BYTE,pixelFormat:qe.RGBA,preMultiplyAlpha:!1,wrapMode:It.CLAMP_TO_EDGE,samplingMode:at.LINEAR},t);e.bindTexture(l,0),a.setUniform1i("u_texture",0);const c=e.getBoundFramebufferObject(),{x:d,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(r),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(ds.COLOR_BUFFER_BIT),e.bindVAO(s),e.drawArrays(Ut.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return r.readPixels(0,0,1,1,qe.RGBA,Nt.UNSIGNED_BYTE,g),a.dispose(),s.dispose(!1),i.dispose(),r.dispose(),l.dispose(),e.setViewport(d,p,f,m),e.bindFramebuffer(c),t.src="",g[0]===255}class xDt{constructor(t){this.context=t,this._floatBufferBlendWorking=_Dt(t),wDt(t).then(r=>this._svgAlwaysPremultipliesAlpha=!r)}get floatBufferBlendWorking(){if(C(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(C(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(C(this._doublePrecisionRequiresObfuscation)){const t=ywe(this.context,!1),r=ywe(this.context,!0);this._doublePrecisionRequiresObfuscation=t!==0&&(r===0||t/r>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return C(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=vDt(this.context)),this._ignoresSamplerPrecision}}function TDt(e,t){if(t.disjointTimerQuery)return null;if(eo(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const r=e.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function SDt(e){if(eo(e))return e;const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function EDt(e,t){if(t.compressedTextureETC)return null;const r=e.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function CDt(e,t){if(t.compressedTextureS3TC)return null;const r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function ADt(e,t){if(eo(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const r=e.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function ODt(e,t){if(t.textureFilterAnisotropic)return null;const r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function MDt(e,t){if(eo(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const r=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function RDt(e,t){if(eo(e)){const r=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const r=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||s?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!s,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function p3(e,t,r,i,s){if(i&&eo(e))return!0;if(t[r])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function IDt(e,t){if(!eo(e)||t.textureNorm16)return null;const r=e.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function PDt(e,t){const r=t.loseContext&&e.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function $Dt(e,t){if(eo(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const r=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}class DDt{constructor(t,r){this._gl=t,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=TDt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=SDt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=$Dt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=EDt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=CDt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=ODt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=B$t(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=MDt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=RDt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=ADt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=p3(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=p3(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=p3(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=p3(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=PDt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=IDt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=p3(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}class LDt{constructor(t,r){this.gl=t,this.instanceCounter=new q$t,this.programCache=new gDt(this),this._state=new nwe,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=eo(t)?jt.WEBGL2:jt.WEBGL1,this._loadExtensions(),this.configure(r)}configure(t){this._capabilities=new DDt(this.gl,t),this._parameters=this._loadParameters(t);const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new nwe,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new Kht({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const s=i.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const s=i.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=i.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new xDt(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Dt.ARRAY_BUFFER),this.unbindBuffer(Dt.ELEMENT_ARRAY_BUFFER),eo(this.gl)&&(this.unbindBuffer(Dt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Dt.PIXEL_PACK_BUFFER),this.unbindBuffer(Dt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Dt.COPY_READ_BUFFER),this.unbindBuffer(Dt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,vh()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,r){for(let i=0;i<t.length;++i)this._state.textureUnitMap[t[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,r,i,s){t===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(t,r,i,s),this._state.blendColor.r=t,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(t,r){t===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,r),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,r,i,s){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(t,r,i,s),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,r){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(t,r),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(t,r,i,s){this._state.colorMask.r===t&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===s||(this.gl.colorMask(t,r,i,s),this._state.colorMask.r=t,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(t,r,i,s){this._state.clearColor.r===t&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===s||(this.gl.clearColor(t,r,i,s),this._state.clearColor.r=t,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=s)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,r){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=r,this.gl.polygonOffset(t,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,r,i,s){this._state.scissorRect.x===t&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===s||(this.gl.scissor(t,r,i,s),this._state.scissorRect.x=t,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=s)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,r){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===r||(this.gl.depthRange(t,r),this._state.depthRange.zNear=t,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,r,i){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(t,r,i),this._state.stencilFunction.face=Wm.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,r,i,s){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(t,r,i,s),this._state.stencilFunction.face=t,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,r,i){this._state.stencilOperation.face===Wm.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(t,r,i),this._state.stencilOperation.face=Wm.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,r,i,s){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(t,r,i,s),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,r=!1){const i=this._state.activeTexture;return t>=0&&(r||t!==this._state.activeTexture)&&(this.gl.activeTexture(yW+t),this._state.activeTexture=t),i}clear(t){t&&this.gl.clear(t)}clearSafe(t,r=255){t&&(t&ds.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&ds.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&ds.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(t))}drawArrays(t,r,i){if(vh()&&(this._numOfDrawCalls++,this._numOfTriangles+=wwe(t,i)),this.gl.drawArrays(t,r,i),vh()){const s=Sye(this);s&&console.error("drawArrays:",s)}}drawElements(t,r,i,s){var n;if(vh()&&(this._numOfDrawCalls++,this._numOfTriangles+=wwe(t,r)),this.gl.drawElements(t,r,i,s),vh()){const o=Sye(this);if(o){const a=this.getBoundVAO(),l=a==null?void 0:a.indexBuffer,c=a==null?void 0:a.vertexBuffers,d={indexBuffer:l,vertexBuffers:c},p={mode:t,count:r,type:i,offset:s},f=(n=qi(l,_=>_.size))!=null?n:0,m=s+r,g=f<m?`. Buffer is too small. Attempted to draw index ${m} of ${f}`:"";console.error(`drawElements: ${o}${g}`,{args:p,vao:d})}}}logInfo(){vh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){vh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,r,i,s){i=Math.max(Math.round(i),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===t&&n.y===r&&n.width===i&&n.height===s||(n.x=t,n.y=r,n.width=i,n.height=s,this.gl.viewport(t,r,i,s))}getViewport(){const t=this._state.viewport;return{x:t.x,y:t.y,width:t.width,height:t.height}}useProgram(t){var r,i;this._state.program!==t&&((r=this._state.program)==null||r.stop(),this._state.program=t,this.gl.useProgram((i=t==null?void 0:t.glName)!=null?i:null))}bindTexture(t,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[r];return C(t)||t.glName==null?(v(s)&&(this.setActiveTexture(r,i),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[r]=null,s):i||s!==t?(this.setActiveTexture(r,i),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[r]=t,s):(t.isDirty&&(this.setActiveTexture(r,i),t.applyChanges()),s)}unbindTexture(t){if(!C(t))for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===t&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(t,r=!1){if(r||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(C(t))return this.gl.bindFramebuffer(sa.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(sa.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,r,i=!1){const s=r===sa.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==t)&&(C(t)?this.gl.bindFramebuffer(r,null):t.initializeAndBind(r),s?this._state.readFramebuffer=yt(t,null):this._state.drawFramebuffer=yt(t,null))}blitFramebuffer(t,r,i=0,s=0,n=t.width,o=t.height,a=0,l=0,c=r.width,d=r.height,p=ds.COLOR_BUFFER_BIT,f=at.NEAREST){this.bindFramebufferSeparate(t,sa.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,sa.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,s,n,o,a,l,c,d,p,f)}bindBuffer(t,r){if(t)switch(r!=null||(r=t.bufferType),r){case Dt.ARRAY_BUFFER:this._state.vertexBuffer=Gu(this.gl,t,r,this._state.vertexBuffer);break;case Dt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Gu(this.gl,t,r,this._state.indexBuffer);break;case Dt.UNIFORM_BUFFER:this._state.uniformBuffer=Gu(this.gl,t,r,this._state.uniformBuffer);break;case Dt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Gu(this.gl,t,r,this._state.pixelPackBuffer);break;case Dt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Gu(this.gl,t,r,this._state.pixelUnpackBuffer);break;case Dt.COPY_READ_BUFFER:this._state.copyReadBuffer=Gu(this.gl,t,r,this._state.copyReadBuffer);break;case Dt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Gu(this.gl,t,r,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const r=this.gl;t||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(r.bindRenderbuffer(r.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let s=i[r];return C(s)&&(s={buffer:null,offset:0,size:0},i[r]=s),s}bindBufferBase(t,r,i){const s=this._getBufferBinding(t,r);C(s)||s.buffer===i&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(t,r,i?i.glName:null),s.buffer=i,s.offset=0,s.size=0)}bindBufferRange(t,r,i,s,n){const o=this._getBufferBinding(t,r);if(!C(o)&&!(o.buffer===i&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,r,i.glName,s,n),o.buffer=i,o.offset=s,o.size=n}}bindUBO(t,r,i,s){C(r)?this.bindBufferBase(Dt.UNIFORM_BUFFER,t,null):(vh()&&(s!=null?s:r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&s!==void 0?this.bindBufferRange(Dt.UNIFORM_BUFFER,t,r.buffer,i,s):this.bindBufferBase(Dt.UNIFORM_BUFFER,t,r.buffer))}unbindUBO(t){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const s=this._state.uniformBufferBindingPoints[r];v(s)&&s.buffer===t.buffer&&this.bindBufferBase(Dt.UNIFORM_BUFFER,r,null)}}unbindBuffer(t){switch(t){case Dt.ARRAY_BUFFER:this._state.vertexBuffer=Gu(this.gl,null,t,this._state.vertexBuffer);break;case Dt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Gu(this.gl,null,t,this._state.indexBuffer);break;case Dt.UNIFORM_BUFFER:this._state.uniformBuffer=Gu(this.gl,null,t,this._state.uniformBuffer);break;case Dt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Gu(this.gl,null,t,this._state.pixelPackBuffer);break;case Dt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Gu(this.gl,null,t,this._state.pixelUnpackBuffer);break;case Dt.COPY_READ_BUFFER:this._state.copyReadBuffer=Gu(this.gl,null,t,this._state.copyReadBuffer);break;case Dt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Gu(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){C(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=10){const r=this.gl,i=r.fenceSync(zte.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(Vo.Sync,i),r.flush();do await yx(t),s=r.clientWaitSync(i,0,0);while(s===dV.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Vo.Sync,i),r.deleteSync(i),s===dV.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=sa.FRAMEBUFFER){return t===sa.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Dt.ARRAY_BUFFER),this.unbindBuffer(Dt.ELEMENT_ARRAY_BUFFER),eo(this.gl)&&(this.unbindBuffer(Dt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Dt.PIXEL_PACK_BUFFER),this.unbindBuffer(Dt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Dt.COPY_READ_BUFFER),this.unbindBuffer(Dt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(Ae.ONE,Ae.ZERO),this.setBlendEquation(E0.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Wm.BACK),this.setFrontFace(HR.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(rs.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(rs.ALWAYS,0,0),this.setStencilOp(fn.KEEP,fn.KEEP,fn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var s,n,o,a,l,c;const t=this.gl,r=this.capabilities.vao;r&&r.bindVertexArray(null);for(let d=0;d<this.parameters.maxVertexAttributes;d++)t.disableVertexAttribArray(d);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(Dt.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,null),eo(t)){this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(Dt.UNIFORM_BUFFER,null);for(let d=0;d<this._parameters.maxUniformBufferBindings;d++){const p=this._state.uniformBufferBindingPoints[d];if(v(p)){const{buffer:f,offset:m,size:g}=p;f!==null?m===0&&g===0?t.bindBufferBase(Dt.UNIFORM_BUFFER,d,f.glName):t.bindBufferRange(Dt.UNIFORM_BUFFER,d,f.glName,m,g):t.bindBufferBase(Dt.UNIFORM_BUFFER,d,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(Dt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(Dt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(Dt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(Dt.COPY_WRITE_BUFFER,null),t.bindFramebuffer(sa.READ_FRAMEBUFFER,null),t.readBuffer(t.BACK),this._state.readFramebuffer&&(t.bindFramebuffer(sa.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(mh.COLOR_ATTACHMENT0)),t.bindFramebuffer(sa.DRAW_FRAMEBUFFER,(n=(s=this._state.drawFramebuffer)==null?void 0:s.glName)!=null?n:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(sa.FRAMEBUFFER,(a=(o=this._state.drawFramebuffer)==null?void 0:o.glName)!=null?a:null);if(r&&this._state.vertexArrayObject){const d=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(d)}t.useProgram((c=(l=this._state.program)==null?void 0:l.glName)!=null?c:null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let d=0;d<this.parameters.maxTextureImageUnits;d++){t.activeTexture(yW+d),t.bindTexture(xt.TEXTURE_2D,null),t.bindTexture(xt.TEXTURE_CUBE_MAP,null),eo(t)&&(t.bindTexture(xt.TEXTURE_3D,null),t.bindTexture(xt.TEXTURE_2D_ARRAY,null));const p=this._state.textureUnitMap[d];v(p)&&t.bindTexture(p.descriptor.target,p.glName)}t.activeTexture(yW+this._state.activeTexture);const i=this._state.viewport;t.viewport(i.x,i.y,i.width,i.height),this.resetInfo()}_loadExtensions(){this.type===jt.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var a;const r=this.capabilities.textureFilterAnisotropic,i=(a=t.maxAnisotropy)!=null?a:1/0,s=eo(this.gl),n=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:r?Math.min(this.gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY),i):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return dt.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}}function Gu(e,t,r,i){return t?i!==t&&e.bindBuffer(r,t.glName):e.bindBuffer(r,null),t}function wwe(e,t){switch(e){case Ut.POINTS:return 2*t;case Ut.TRIANGLES:return t/3;case Ut.TRIANGLE_STRIP:case Ut.TRIANGLE_FAN:return t-2;default:return 0}}class NDt extends LDt{constructor(t,r,i){super(t,r),this.newCache=i,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(t,r,i,s){return this.useProgram(t.program),t.bindPipelineState(this,i==null?void 0:i.slot,s),t.program.bindPass(r,i),t.program}get test(){return this.programCache.test}}let vO=class extends be{constructor(e,t,r){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new $s,this._frameTask=e.resourceController.scheduler.registerTask(Ot.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(yg.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return C(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(x4,new Ice)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),yt(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const r=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);r>=0&&r!==t.previousToken&&(t.previousToken=r,e=!0)}),e&&this.events.emit("changed",cn.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(C(t))return Et(t!==void 0),null;const r=t.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),i=new FDt(e,()=>{this._frameTask.schedule(()=>{i.isUnreferenced&&t.unload()})});return this._textures.set(e,i),i.ref(),v(t.glTexture)?(this._updateGLTexture(i,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i):(this._loadingCount++,i.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=a=>(this._loadingCount--,i.loadingPromise=null,this._updateGLTexture(i,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i),o=a=>(this._loadingCount--,i.loadingPromise=null,Ps(a)||te.getLogger(this.declaredClass).error(a),null);return np(s)?s.then(n,o):n(s)}),i.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",cn.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([h()],vO.prototype,"_loadingCount",void 0),u([h()],vO.prototype,"_frameTask",void 0),u([h()],vO.prototype,"updating",null),vO=u([I("esri.views.3d.webgl-engine.lib.TextureRepository")],vO);class FDt{constructor(t,r){this.id=t,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(te.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}const kDt="esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository";let K$=class extends be{constructor(){super(...arguments),this._passParameters=new UDt,this._loading=0}get passParameters(){return this._passParameters}dispose(){this._passParameters.waveNormal=tt(this._passParameters.waveNormal),this._passParameters.wavePertubation=tt(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return Ov.LOADING;if(v(this._passParameters.waveNormal)&&v(this._passParameters.wavePertubation))return Ov.LOADED;const t={target:xt.TEXTURE_2D,pixelFormat:qe.RGBA,dataType:Nt.UNSIGNED_BYTE,wrapMode:It.REPEAT,samplingMode:at.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};return++this._loading,A0(ui("esri/images/materials/water/normals.jpg")).then(r=>this._passParameters.waveNormal=new dt(e,{...t,width:r.width,height:r.height},r)).catch(r=>te.getLogger(this.declaredClass).error("Failed to load water material normal texture.",r)).finally(()=>--this._loading),++this._loading,A0(ui("esri/images/materials/water/perturbation.jpg")).then(r=>this._passParameters.wavePertubation=new dt(e,{...t,width:r.width,height:r.height},r)).catch(r=>te.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",r)).finally(()=>--this._loading),Ov.LOADING}};u([h()],K$.prototype,"_loading",void 0),u([h({type:Boolean,readOnly:!0})],K$.prototype,"updating",null),K$=u([I(kDt)],K$);class UDt extends Zi{}const xwe=2048,BDt=1.5,zDt=8;function VDt(e,t){const{format:r,quality:i,rotation:s,disableDecorations:n}=e||{},o=hue(e,t.padding),a=ZDt(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=YDt(e,a),d=QDt(r),p=sLt[d];return{format:d,quality:_e(i!=null?i:p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function jDt(e,t){const r=VDt(e,t),i=r.area,s=r.width/i.width,n=hue(r,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,d=Math.floor(l*s+o),p=Math.floor(c*s+a),f=e&&e.layers?e.layers:[],m=r.ignoreBackground,g=r.ignorePadding;return{framebufferWidth:d,framebufferHeight:p,region:{x:Math.floor(i.x*s)+n.left,y:Math.floor(i.y*s)+n.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:s,layers:f,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:g,objectAndLayerIdColor:!1}}function MY(e,t,r){const{ctx:i,canvas:s}=xke(e,r),n=i.getImageData(0,0,e.width,e.height),o=qDt(s,t);return Tke(s),{dataUrl:o,data:n}}function GDt(e,t){const{ctx:r,canvas:i}=xke(e,t),s=r.getImageData(0,0,e.width,e.height);return Tke(i),s}function xke(e,t){const r=HDt();t.premultipliedAlpha&&tLt(e),r.width=e.width,r.height=e.height;const i=r.getContext("2d");return i.putImageData(e,0,0),t.flipY&&eLt(i),{ctx:i,canvas:r}}function Tke(e){e.width=0,e.height=0}function HDt(){return C(RY)&&(RY=document.createElement("canvas")),RY}let RY=null;function qDt(e,t){const r=rLt[t.format],i=t.quality/100;return e.toDataURL(r,i)}function WDt(e,t,r,i=0,s=0,n=e.width-i,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:d,data:p}=t,f=n/c,m=o/d,g=Math.ceil(f/2),_=Math.ceil(m/2),x=e.width;for(let b=0;b<d;b++)for(let w=0;w<c;w++){const T=4*(w+(a?d-b-1:b)*c);let E=0,O=0,A=0,R=0,D=0,k=0;const L=(b+.5)*m;for(let q=Math.floor(b*m);q<(b+1)*m;q++){const G=Math.abs(L-(q+.5))/_,J=(w+.5)*f,ee=G*G;for(let se=Math.floor(w*f);se<(w+1)*f;se++){const X=Math.abs(J-(se+.5))/g,F=Math.sqrt(ee+X*X);if(F>=1)continue;let N=2*F*F*F-3*F*F+1;const B=4*(i+se+(s+q)*x);k+=N*l[B+3],O+=N,!r&&l[B+3]<255&&(N=N*l[B+3]/255),A+=N*l[B],R+=N*l[B+1],D+=N*l[B+2],E+=N}}p[T]=A/E,p[T+1]=R/E,p[T+2]=D/E,p[T+3]=k/O}return t}function XDt(e,t,r){if(!t)return e;const{framebufferWidth:i,framebufferHeight:s,pixelRatio:n,region:o}=e,a=hue(e,r),l=a.left+a.right,c=a.top+a.bottom,d=i-l,p=s-c,f=Math.min(zDt,Math.min((xwe-l)/d,(xwe-c)/p));return f<BDt?e:{...e,framebufferWidth:Math.round(d*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:i,height:s}}}function YDt(e,t){if(!e)return t;const r=e.width,i=e.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return t;const s=t.width/t.height;return i==null?{width:Math.floor(r),height:Math.floor(r/s)}:{width:Math.floor(i*s),height:Math.floor(i)}}function ZDt(e,t){const r={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(r.x=Math.floor(e.area.x)),e.area.y!=null&&(r.y=Math.floor(e.area.y));const i=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(r.width=t.width-r.x,r.height=t.height-r.y,i!=null&&s!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,s);else if(i==null&&s!=null){const n=Math.min(r.width,i);r.height=n/r.width*r.height,r.width=n}else if(i!=null&&s==null){const n=Math.min(r.height,s);r.width=n/r.height*r.width,r.height=n}}return JDt(KDt(r,e),t)}function JDt(e,t){const r=Math.floor(Math.max(e.x,0)),i=Math.floor(Math.max(e.y,0)),s={x:r,y:i,width:Math.floor(Math.min(e.width,t.width-r)),height:Math.floor(Math.min(e.height,t.height-i))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),d=s.height-c;return{x:s.x,y:Math.floor(s.y+d/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function KDt(e,t){if(!t||t.width==null||t.height==null)return e;const r=t.width/t.height,i=e.width/e.height;if(i===r)return e;if(i<r){const n=Math.floor(e.height*r);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/r);return e.y-=(s-e.height)/2,e.height=s,e}function hue(e,t){return!t||e&&e.ignorePadding?nLt:t}function QDt(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return iLt}}function eLt(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function tLt(e){const t=e.data,r=t.length;for(let i=0;i<r;i+=4){const s=t[i+3];if(s!==255&&s>0){const n=255/s;t[i+0]=t[i+0]*n,t[i+1]=t[i+1]*n,t[i+2]=t[i+2]*n}}}const rLt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Twe=98,iLt="png",sLt={png:100,jpg:Twe,jpeg:Twe},nLt={top:0,right:0,bottom:0,left:0};class oLt{constructor(t,r){this.viewCamera=t,this.frameHasDecorations=r}}class aLt extends Y7{constructor(t,r,i,s){super(),this._rctx=t,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=s,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}async takeScreenshot(t){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(cn.BACKGROUND);const r=_x();return this._screenshotQueue.push({settings:t,resolver:r}),r.promise}update(t,r){for(const i of this._screenshotQueue){if(this.isDisposed){i.resolver.reject();continue}const s={...i.settings,pixelRatio:i.settings.pixelRatio*t.viewCamera.pixelRatio},n=this._renderScreenshot(t,s,r);i.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,r,i){t.width=r.width,t.height=r.height;const s=t.getContext("2d"),n=i.pixelRatio;return s.save(),s.translate(0,r.height),s.scale(1,-1),i.region&&s.translate(-i.region.x,-i.region.y),s.scale(n,n),r=this._renderFunctions.renderOverlay(t,r),s.restore(),r}_readbackScreenshot(t,r){return t.resample?this._readbackScreenshotResampled(t,r):this._readbackScreenshotImmediate(t,r)}_readbackScreenshotResampled(t,r){const{framebufferWidth:i,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=LX(i,s,a);this._rctx.gl.readPixels(0,0,i,s,qe.RGBA,mt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...t,region:null});const c=LX(n.width,n.height,a);return WDt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,r){const{framebufferHeight:i,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=LX(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,i-(s.y+s.height),s.width,s.height,qe.RGBA,mt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,r,i){let s=null,n=null;const o=t.viewCamera,{framebufferWidth:a,framebufferHeight:l}=r;let c=!1;const d=r.disableDecorations&&t.frameHasDecorations,p=a!==o.fullWidth||l!==o.fullHeight,f=r.ignorePadding&&o.pixelRatio!==r.pixelRatio,m=p||d||f||r.objectAndLayerIdColor;if(r.objectAndLayerIdColor&&(n=new ps(this._rctx,{width:a,height:l,colorTarget:Qs.TEXTURE,depthStencilTarget:si.DEPTH_STENCIL_RENDER_BUFFER})),m){const b=o.clone();if(r.ignorePadding){const E=vj(b.padding);for(let O=0;O<4;O++)E[O]=Math.round(E[O]/b.pixelRatio*r.pixelRatio);b.padding=E}b.fullWidth=a,b.fullHeight=l,b.pixelRatio=r.pixelRatio;const w=o.fovX-b.fovX,T=o.fovY-b.fovY;w<0&&w<T?b.fovX=o.fovX:T<0&&T<w&&(b.fovY=o.fovY),this._forceCameraHook(b),c=!0,s=new ps(this._rctx,{width:b.fullWidth,height:b.fullHeight,colorTarget:Qs.TEXTURE,depthStencilTarget:si.DEPTH_STENCIL_RENDER_BUFFER}),this._renderFunctions.renderScene(s,n,b,r.disableDecorations?EE.OFF:EE.ON,i),this._disposeOffscreenBuffers()}const g=()=>{this._rctx.bindFramebuffer(null),tt(s)},_=this._readbackScreenshot(r,g);g();let x=null;if(r.objectAndLayerIdColor){const b=()=>{this._rctx.bindFramebuffer(null),tt(n)};this._rctx.bindFramebuffer(n),x=this._readbackScreenshot(r,b),this._rctx.bindFramebuffer(null),b()}if(m&&!this._rctx.contextAttributes.alpha)for(let b=3;b<_.data.length;b+=4)_.data[b]=255;if(x&&!this._rctx.contextAttributes.alpha)for(let b=3;b<x.data.length;b+=4)x.data[b]=255;return c&&this._forceCameraHook(o),[_,x]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}let Ra=class extends X7(be){constructor(e){super({}),this.events=new $s,this.waterTextureRepository=new K$,this._magnifierHelper=new _O,this._objectAndLayerIdRenderHelper=pe("enable-feature:objectAndLayerId-rendering")?new a3t:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),ie(()=>{var r;return(r=this.waterTextureRepository)==null?void 0:r.updating},()=>this.requestRender(),pt),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new MFe(this._rctx),this._shaderTechniqueRepository=new TFe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new vO(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",r=>this.requestRender(r)),this._materialRepository=new SFe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new UPt(this._rctx,this._shaderTechniqueRepository),this._renderer=new U_(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,r=>this.requestRender(r),(r,i)=>e.schedule(r,i),e);const t={renderScene:(r,i,s,n,o)=>this._renderer.render(r,i,{camera:s,contentCamera:s,mode:Kn.IDLE},n,o),requestRenderScene:r=>this.requestRender(r),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(r,i)=>e.options.screenshot.renderOverlay(r,i)};this._screenshotManager=new aLt(this._rctx,t,r=>this.events.emit("force-camera-for-screenshot",r),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Gs(this._frameTask),this._shaderTechniqueRepository=tt(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=cn.UPDATE){this._needsRender=!0,e===cn.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setRenderParameters(e){e.idleSuspend!==void 0&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(t=>t[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,r,i,s){this._renderer.readHUDVisibility(e,t,r,i,s)}getMinimalDepthForArea(e,t,r,i,s,n=s){const o=i.constrainWindowSize(t,r,s*i.pixelRatio,n*i.pixelRatio),a=this._ensureDepthBuffer(o);this._renderer.readDepthPixels(i,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const d=GPt(4*c,a,i.nearFar);l>d&&d!==i.nearFar[0]&&d!==i.nearFar[1]&&(l=d)}if(v(e)){const c=e.pickDepth(t*i.pixelRatio,r*i.pixelRatio,i);v(c)&&l>c&&c!==i.nearFar[0]&&c!==i.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(C(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){y5e(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state;let r=!1,i=cn.BACKGROUND,s=!1;const n={preRender:({time:o})=>{r=this.updating,i=this._needsUpdate?cn.UPDATE:cn.BACKGROUND,e.processSyncLayers(),(o-this._lastAnimationUpdate>this.animationTimestep||v(t.forcedAnimationTime)||r||this._needsRender)&&(o=yt(t.forcedAnimationTime,o),this._renderer.updateAnimation({camera:t.camera,time:o})&&this.requestRender(cn.BACKGROUND),this._lastAnimationUpdate=o)},render:({time:o})=>{if((this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,null,t,EE.ON,o),s=!0,a&&this._renderer.hasWaterReflection&&(this.requestRender(cn.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:o})=>{const a=new oLt(t.camera,this._renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(a,o)},finish:()=>{s&&(this._renderer.finish(t.mode===Kn.IDLE?i:cn.UPDATE),s=!1)}};this._frameTask=cR(n)}_initializeContext(e){var s;const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:(s=t.preserveDrawingBuffer)!=null?s:!1},i=tpt("3d",this._canvas,r);if(C(i)){const n=pe("esri-force-webgl");te.getLogger(this.declaredClass).error(n)}else this._rctx=this._newRenderingContext(i,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&te.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&pe("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const r={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},i=(s,n)=>t.resourceController.memoryController.newCache(s,n);return new NDt(e,r,i)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}_getObjectAndLayerIdColor(e){return this._objectAndLayerIdRenderHelper?this._objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return C(this._componentObjectCollection)&&(this._componentObjectCollection=new MPt(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([h({type:Boolean,readOnly:!0})],Ra.prototype,"updating",null),u([nl()],Ra.prototype,"_rctx",void 0),u([nl()],Ra.prototype,"_container",void 0),u([nl()],Ra.prototype,"_canvas",void 0),u([nl()],Ra.prototype,"_stippleTextureRepository",void 0),u([nl(),h()],Ra.prototype,"waterTextureRepository",void 0),u([nl(),h()],Ra.prototype,"_magnifierHelper",void 0),u([h()],Ra.prototype,"_objectAndLayerIdRenderHelper",void 0),u([nl(),h()],Ra.prototype,"_textureRepository",void 0),u([nl()],Ra.prototype,"_compositingHelper",void 0),u([nl()],Ra.prototype,"_renderer",void 0),u([nl()],Ra.prototype,"_screenshotManager",void 0),u([nl()],Ra.prototype,"componentObjectCollection",null),u([nl()],Ra.prototype,"_componentObjectCollection",void 0),u([h()],Ra.prototype,"_needsUpdate",void 0),u([h()],Ra.prototype,"_needsWaterReflectionUpdate",void 0),Ra=u([I("esri.views.3d.webgl-engine.parts.RenderView")],Ra);var c8;let su=c8=class extends X7(be){constructor(e){super(e),this._handles=new hr,this._model=new n8,this._layers=new Qt,this._changeSet=new VFe,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Ra(this)),this._frameTask=this.resourceController.scheduler.registerTask(Ot.STAGE,this),this._handles.add(this._frameTask)}destroy(){kE.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),VV(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){C(e)||(this.renderView.requestRender(),this._model.remove(e),VV(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){v(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){v(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){C(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(t=>C(t.glTexture)).map(t=>this.schedule(()=>this._model.has(t)?t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;c8.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),c8.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(t=>t.id)),console.log("RGs remove: "+this._changeSet.removes.map(t=>t.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===qR.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commit(),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,r){const i=this.renderView.renderPlugins.add(e,t,r),s=()=>{S1e(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(np(i))return i.then(s);s()}removeRenderPlugin(e){S1e(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(r=>r.type===t).length,model:e._model}}};su.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},u([h({constructOnly:!0})],su.prototype,"resourceController",void 0),u([h({constructOnly:!0})],su.prototype,"options",void 0),u([h({constructOnly:!0})],su.prototype,"state",void 0),u([h({constructOnly:!0})],su.prototype,"sceneIntersectionHelper",void 0),u([h({readOnly:!0})],su.prototype,"viewingMode",null),u([h({constructOnly:!0})],su.prototype,"container",void 0),u([h({constructOnly:!0})],su.prototype,"renderSR",void 0),u([h({constructOnly:!0})],su.prototype,"_handles",void 0),u([h({readOnly:!0})],su.prototype,"updating",null),u([h({constructOnly:!0})],su.prototype,"_model",void 0),u([nl(),h()],su.prototype,"renderView",void 0),su=c8=u([I("esri.views.3d.webgl-engine.Stage")],su);function Ske(e){return B0(e)&&e.intersector===zs.PCL&&!!e.target}function YG(e){return B0(e)&&e.intersector===zs.I3S&&!!e.target}function lLt(e){return B0(e)&&e.intersector===zs.TERRAIN&&!!e.target}function Eke(e){return B0(e)&&e.intersector===zs.OVERLAY&&!!e.target}function pue(e){return B0(e)&&e.intersector===zs.LOD&&!!e.target}function Swe(e,t){var r;return v7(e)||b7(e)?wF(e.target.object.metadata,t):lLt(e)?(r=t.map)==null?void 0:r.ground:Ske(e)||YG(e)||Eke(e)?wF(e.target,t):null}function hzt(e,t){const r=oie(e,t);return v(r)&&r.type==="graphic"?r.graphic:null}function oie(e,t){if(C(e))return null;if(v7(e)||b7(e))return Ewe(e.target.object.metadata,t);if(Ske(e)){const r=e.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return Eke(e)||pue(e)?Ewe(e.target,t):YG(e)?cLt(e.target,t):null}function Ewe(e,t){if(C(e)||C(e.graphicUid))return null;const r=wF(e,t);if(C(r))return null;if(r===t.graphics)return C(t.graphicsView)||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const i=t.allLayerViews.find(s=>s.layer===r);return!i||i.suspended||C(e.graphicUid)?null:"getHit"in i?i.getHit(e.graphicUid):null}function cLt(e,t){const r=wF(e,t);if(C(r))return null;const i=t.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?dLt(i.getGraphicFromIntersectorTarget(e)):null}function uLt(e,t){const r=wF(e,t);if(C(r))return null;const i=t.allLayerViews.find(s=>s.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(e):null}function dLt(e){return v(e)?{type:"graphic",graphic:e,layer:e.layer}:null}function wF(e,t){return C(e.layerUid)?null:v(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function pzt(e,t){if(v7(e)||b7(e))return Cv(e.target.object.boundingVolumeWorldSpace.bounds);if(pue(e)){kRe(HU,e.transformation);const r=Math.max(HU[0],HU[1],HU[2]);return e.target.baseBoundingSphere.radius*r}return YG(e)?qi(uLt(e.target,t),r=>.5*EOe(r)):null}function fzt(e){return!v7(e)&&!b7(e)&&(pue(e)?e.target.numLodLevels>1:!!YG(e))}const HU=$();async function hLt(e,t){if(e.type==="2d")return e.hitTest(t);const r=await e.hitTest(t);if(r.results.length===0)return r;const i=r.results[0],s=v(i.distance)?i.distance*(1+pLt):i.distance,n=r.results.findIndex(o=>o.distance>s);return n!==-1&&(r.results=r.results.slice(0,n)),r}const pLt=.05;let IY,PY;function fLt(e){const t=cDe(e);for(;t.length>1;){const r=Cwe(t.shift());if(r.available)return r}return Cwe(t.shift())}function Cwe(e){switch(e){case jt.WEBGL1:return mLt();case jt.WEBGL2:return gLt()}}function mLt(){return IY||(IY=vLt()),IY}function gLt(){return PY||(PY=bLt()),PY}class Cke{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class yLt extends Cke{constructor(){super(...arguments),this.type=jt.WEBGL1}}class _Lt extends Cke{constructor(){super(...arguments),this.type=jt.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function Ake(e,t){var n;if(e===jt.WEBGL1&&typeof WebGLRenderingContext>"u"||e===jt.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=hV(r,e,{failIfMajorPerformanceCaveat:!0});if(C(i)&&(i=hV(r,e),v(i)&&(t.majorPerformanceCaveat=!0)),C(i))return i;if(e===jt.WEBGL1){const o=(n=i.getParameter(i.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),i}function vLt(){const e=new yLt,t=Ake(jt.WEBGL1,e);return C(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function bLt(){const e=new _Lt,t=Ake(jt.WEBGL2,e);return C(t)||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function wLt(e){const t=fLt(e);if(!t.available)return new z("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new z("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new z("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new z("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===jt.WEBGL1){if(!t.supportsElementIndexUint)return new z("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new z("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new z("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function xLt(e){return e&&"nodeType"in e}function TLt(e){return e&&typeof e.render=="function"}const Awe={component:"esri-component"};let GS=class extends be{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(Awe.component),t&&t.classList.remove(Awe.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||xLt(e)?(this._set("widget",null),$F(e)):(TLt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([h({dependsOn:[]})],GS.prototype,"id",null),u([h()],GS.prototype,"node",null),u([Gt("node")],GS.prototype,"castNode",null),u([h({readOnly:!0})],GS.prototype,"widget",void 0),GS=u([I("esri.views.ui.Component")],GS);const u8=GS,SLt={left:0,top:0,bottom:0,right:0},Oke={bottom:30,top:15,right:15,left:15},$Y="manual",Zc={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};function ELt(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function DY(e){const t=e,r=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(r===null||r===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function LY(e,{top:t,bottom:r,left:i,right:s}){e.style.top=t,e.style.bottom=r,e.style.left=i,e.style.right=s}let B_=class extends $s.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new hr,this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&LY(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&LY(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([ie(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,pt),ie(()=>this.padding,this._applyUIPadding,pt)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(Zc.ui),SXe(e),this._attachContainers(e)),t&&(t.classList.remove(Zc.ui),LY(t,{top:"",bottom:"",left:"",right:""}),bEe(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),r=t.top+t.bottom;return Math.max(e-r,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...Oke,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),r=t.left+t.right;return Math.max(e-r,0)}add(e,t){let r,i;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=DY(e);s&&({index:r,position:t,component:e,key:i}=s),t&&typeof t=="object"&&({index:r,key:i,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,r,i)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(i=>this.remove(i,t));const r=this._find(e);if(r){const i=this._componentToKey;if(i.has(e)&&i.get(e)!==t)return;const s=this._components.indexOf(r);return r.node.parentNode&&r.node.parentNode.removeChild(r.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,r)=>t.concat(r)):(e=e||$Y)===$Y?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(Zc.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let r;const i=DY(e)||DY(t);if(i&&(r=i.index,t=i.position,e=i.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:r})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,r,i){e instanceof u8||(e=new u8({node:e})),this._place({component:e,position:t,index:r}),this._components.push(e),i&&this._componentToKey.set(e,i)}_find(e){return e?e instanceof u8?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||SLt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Zc.innerContainer),e.classList.add(Zc.cornerContainer);const t=document.createElement("div");t.classList.add(Zc.innerContainer),t.classList.add(Zc.manualContainer);const r=document.createElement("div");r.classList.add(Zc.topLeft),r.classList.add(Zc.corner),e.appendChild(r);const i=document.createElement("div");i.classList.add(Zc.topRight),i.classList.add(Zc.corner),e.appendChild(i);const s=document.createElement("div");s.classList.add(Zc.bottomLeft),s.classList.add(Zc.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Zc.bottomRight),n.classList.add(Zc.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=Fh();this._cornerNameToContainerLookup={"top-left":r,"top-right":i,"bottom-left":s,"bottom-right":n,"top-leading":o?i:r,"top-trailing":o?r:i,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,r=e.position||$Y,i=e.index,s=this._positionNameToContainerLookup[r],n=i>-1;if(ELt(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);if(i===0)return void(s.firstChild?Mhe(t.node,s.firstChild):s.appendChild(t.node));i>=o.length?s.appendChild(t.node):Mhe(t.node,o[i])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,r=null;return this._components.some(i=>(t=i===e,t&&(r=i),t)),r}_findById(e){let t,r=null;return this._components.some(i=>(t=i.id===e,t&&(r=i),t)),r}_findByNode(e){let t,r=null;return this._components.some(i=>(t=i.node===e,t&&(r=i),t)),r}};u([h()],B_.prototype,"container",null),u([h()],B_.prototype,"height",null),u([h({value:Oke})],B_.prototype,"padding",null),u([Gt("padding")],B_.prototype,"castPadding",null),u([h()],B_.prototype,"view",void 0),u([h()],B_.prototype,"width",null),B_=u([I("esri.views.ui.UI")],B_);const CLt=B_;function Owe(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function ALt(e,t){return e.length!==t.length||e.some((r,i)=>r.text!==t[i].text)}function qU(e,t,r){!r||!t||e.find(i=>i.layerView===t&&i.text===r)||e.push({text:r,layerView:t})}function OLt(e){return e.type==="bing-maps"}const ab=[];let bO=class extends gR{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Ge,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(i=>ie(()=>{var s;return[i.suspended,(s=i.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(i=>{this._pendingAttributions.delete(i),this._fetchedAttributionData.delete(i)}),this._updateAttributionItems()},this.handles.add([ms(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),no(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.get("view.allLayerViews");ab.length=0,e?(e.forEach(t=>{var s;if(t.suspended||!((s=t.layer)!=null&&s.attributionVisible))return;const r=t.layer;if(Owe(r,"user"))return void qU(ab,t,r.copyright);if(r.hasAttributionData){if(this._fetchedAttributionData.has(t)){const n=this._fetchedAttributionData.get(t);return void(n?qU(ab,t,this._getDynamicAttribution(n,this.view,r)):Owe(r)&&qU(ab,t,r.copyright))}return void this._fetchAttributionData(t)}const i=r.get("portalItem.accessInformation");qU(ab,t,i||r.copyright)}),ALt(this.items,ab)&&(this.items.removeAll(),this.items.addMany(ab)),ab.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Jh(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=t.ok?this._createContributionIndex(t.value,OLt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,t){const r=e.contributors,i={};if(!r)return i;for(let s=0;s<r.length;s++){const n=r[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),d=a.zoomMax-(t&&a.zoomMax?1:0),p={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:Ve.WGS84},f={extent:o0(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=d;m++)i[m]=i[m]||[],i[m].push(f)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(e,t,r){const{extent:i,scale:s}=t;let n=r.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!i||n==null||n<=-1)return"";const o=e[n],a=QE(i.center.clone().normalize(),t.spatialReference),l={};return o?o.filter(c=>{const d=!l[c.id]&&a&&Lne(c.extent,a);return d&&(l[c.id]=!0),d}).sort((c,d)=>d.score-c.score||c.objectId-d.objectId).map(c=>c.attribution).join(", "):""}};u([h({readOnly:!0,type:Ge})],bO.prototype,"items",void 0),u([h({readOnly:!0})],bO.prototype,"state",null),u([h()],bO.prototype,"view",void 0),bO=u([I("esri.widgets.Attribution.AttributionViewModel")],bO);const Mke=bO,lb={base:"esri-attribution esri-widget",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let nu=class extends Ss{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:i})=>this._checkSourceTextOverflow(i))),this.iconClass=lb.widgetIcon,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new Mke}initialize(){this.addHandles(ms(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[lb.open]:this._isOpen};return P("div",{bind:this,class:this.classes(lb.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return P("div",{class:lb.poweredBy},"Powered by"," ",P("a",{class:lb.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,r=t?"0":"",{attributionText:i}=this,s={[lb.sourcesOpen]:e,[lb.interactive]:t};return P("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(lb.sources,s),innerHTML:i,tabindex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:r,clientWidth:i,scrollWidth:s}=e,n=s>i,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([h()],nu.prototype,"_isOpen",void 0),u([h()],nu.prototype,"_isInteractive",null),u([h()],nu.prototype,"_attributionTextOverflowed",void 0),u([h()],nu.prototype,"_prevSourceNodeHeight",void 0),u([h({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],nu.prototype,"attributionText",null),u([h()],nu.prototype,"iconClass",void 0),u([h()],nu.prototype,"itemDelimiter",void 0),u([h()],nu.prototype,"label",null),u([h(),xi("esri/widgets/Attribution/t9n/Attribution")],nu.prototype,"messages",void 0),u([h()],nu.prototype,"view",null),u([h({type:Mke})],nu.prototype,"viewModel",void 0),u([An()],nu.prototype,"_toggleState",null),nu=u([I("esri.widgets.Attribution")],nu);const MLt=nu,RLt="esri.widgets.CompassViewModel";let HS=class extends FF(be){constructor(e){super(e),this._handles=new hr,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ie(()=>this.view,this._updateRotationWatcher,pt))}destroy(){this._handles=Gs(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ie(()=>e==null?void 0:e.rotation,this._updateForRotation,pt):ie(()=>e==null?void 0:e.camera,this._updateForCamera,pt))}};u([h({readOnly:!0})],HS.prototype,"canShowNorth",null),u([h()],HS.prototype,"orientation",void 0),u([h({readOnly:!0})],HS.prototype,"state",null),u([h()],HS.prototype,"view",void 0),HS=u([I(RLt)],HS);const Rke=HS,cb={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Ty=class extends Ss{constructor(e,t){super(e,t),this.iconClass=cb.widgetIcon,this.messages=null,this.viewModel=new Rke}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,r=t==="disabled",i=(t==="rotation"?"rotation":"compass")=="compass",s=r?-1:0,n={[cb.disabled]:r,[cb.interactive]:!r},o={[cb.northIcon]:i,[cb.rotationIcon]:!i},{messages:a}=this;return P("div",{bind:this,class:this.classes(cb.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},P("span",{"aria-hidden":"true",class:this.classes(cb.icon,o),styles:this._toRotationTransform(e)}),P("span",{class:cb.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([h()],Ty.prototype,"goToOverride",null),u([h()],Ty.prototype,"iconClass",void 0),u([h()],Ty.prototype,"label",null),u([h(),xi("esri/widgets/Compass/t9n/Compass")],Ty.prototype,"messages",void 0),u([h()],Ty.prototype,"view",null),u([h({type:Rke})],Ty.prototype,"viewModel",void 0),u([An()],Ty.prototype,"_reset",null),Ty=u([I("esri.widgets.Compass")],Ty);const ILt=Ty;let wO=class extends be{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(no(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.get("view.ready")&&this.view.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([h({readOnly:!0})],wO.prototype,"state",null),u([h()],wO.prototype,"navigationMode",void 0),u([h()],wO.prototype,"view",void 0),wO=u([I("esri.widgets.NavigationToggleViewModel")],wO);const Ike=wO,vp={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let Sy=class extends Ss{constructor(e,t){super(e,t),this.iconClass=vp.widgetIcon,this.messages=null,this.viewModel=new Ike}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",r={[vp.disabled]:e,[vp.isLayoutHorizontal]:this.layout==="horizontal"},i={[vp.activeButton]:t},s={[vp.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return P("div",{bind:this,class:this.classes(vp.base,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},P("div",{class:this.classes(vp.button,vp.panButton,i)},P("span",{class:vp.panIcon})),P("div",{class:this.classes(vp.button,vp.rotateButton,s)},P("span",{class:vp.rotationIcon})))}_toggle(){this.toggle()}};u([h()],Sy.prototype,"iconClass",void 0),u([h()],Sy.prototype,"label",null),u([h({value:"vertical"})],Sy.prototype,"layout",null),u([h(),xi("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Sy.prototype,"messages",void 0),u([h()],Sy.prototype,"view",null),u([h({type:Ike})],Sy.prototype,"viewModel",void 0),u([An()],Sy.prototype,"_toggle",null),Sy=u([I("esri.widgets.NavigationToggle")],Sy);const PLt=Sy,f3={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let qb=class extends Ss{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[f3.disabled]:!this.enabled,[f3.interactive]:this.enabled},r={[this.iconClass]:!!this.iconClass};return P("div",{bind:this,class:this.classes(f3.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},P("span",{"aria-hidden":"true",role:"presentation",class:this.classes(f3.icon,r)}),P("span",{class:f3.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([h()],qb.prototype,"action",void 0),u([h()],qb.prototype,"enabled",void 0),u([h()],qb.prototype,"iconClass",void 0),u([h()],qb.prototype,"title",void 0),u([An()],qb.prototype,"_triggerAction",null),qb=u([I("esri.widgets.IconButton")],qb);const Mwe=qb;let xO=class extends be{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};u([h({readOnly:!0})],xO.prototype,"canZoomIn",null),u([h({readOnly:!0})],xO.prototype,"canZoomOut",null),u([h()],xO.prototype,"view",void 0),xO=u([I("esri.widgets.Zoom.ZoomConditions2D")],xO);const $Lt=xO;let TO=class extends be{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};u([h({readOnly:!0})],TO.prototype,"canZoomIn",null),u([h({readOnly:!0})],TO.prototype,"canZoomOut",null),u([h()],TO.prototype,"view",void 0),TO=u([I("esri.widgets.Zoom.ZoomConditions3D")],TO);const DLt=TO;let Wb=class extends be{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return v(this._zoomConditions)&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return v(this._zoomConditions)&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new $Lt({view:e}):e.type==="3d"&&(this._zoomConditions=new DLt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():wM(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():wM(e.goTo({zoomFactor:.5}))}};u([h()],Wb.prototype,"_zoomConditions",void 0),u([h()],Wb.prototype,"canZoomIn",null),u([h()],Wb.prototype,"canZoomOut",null),u([h({readOnly:!0})],Wb.prototype,"state",null),u([h()],Wb.prototype,"view",null),Wb=u([I("esri.widgets.Zoom.ZoomViewModel")],Wb);const Pke=Wb,m3={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let z_=class extends Ss{constructor(e,t){super(e,t),this.iconClass=m3.widgetIcon,this.messages=null,this.viewModel=new Pke}initialize(){this._zoomInButton=new Mwe({action:this.zoomIn.bind(this),iconClass:m3.zoomInIcon}),this._zoomOutButton=new Mwe({action:this.zoomOut.bind(this),iconClass:m3.zoomOutIcon})}destroy(){this._zoomInButton=Qe(this._zoomInButton),this._zoomOutButton=Qe(this._zoomOutButton)}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,t={[m3.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:i}=e;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=i;const{zoomIn:s,zoomOut:n}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=n,P("div",{class:this.classes(m3.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([h()],z_.prototype,"iconClass",void 0),u([h()],z_.prototype,"label",null),u([h({value:"vertical"})],z_.prototype,"layout",null),u([h(),xi("esri/widgets/Zoom/t9n/Zoom")],z_.prototype,"messages",void 0),u([h()],z_.prototype,"view",null),u([h({type:Pke})],z_.prototype,"viewModel",void 0),z_=u([I("esri.widgets.Zoom")],z_);const LLt=z_;function NLt(e){return e&&e.view!==void 0}let d8=class extends CLt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([ie(()=>this.components,this._componentsWatcher.bind(this),pt),ie(()=>this.view,this._updateViewAwareWidgets.bind(this),pt)])}_add(e,t,r,i){if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,r,i)}_removeComponents(e){e.forEach(t=>{const r=this._find(t);r&&(this.remove(r),r.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const r=this._find(t),i=r&&r.widget;NLt(i)&&(i.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.constructed&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new u8({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new MLt({view:this.view})}_createCompass(){return new ILt({view:this.view})}_createNavigationToggle(){return new PLt({view:this.view})}_createZoom(){return new LLt({view:this.view})}};u([h()],d8.prototype,"components",void 0),d8=u([I("esri.views.ui.DefaultUI")],d8);const FLt=d8;let h8=class extends FLt{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([h()],h8.prototype,"components",void 0),h8=u([I("esri.views.ui.3d.DefaultUI3D")],h8);const $ke=h8;let ut=class extends lat(idt(_dt(Vdt))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new Jv({slicePlane:t3e},this),this._resourceController=ZAt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new bre({view:this}),this.labeler=new BS({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new VR,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new o2,this.environmentManager=new hm,this.floors=new Ge,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Gdt({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new yAt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new $ke,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new Fre,this.voxelWasm=null,this.voxelWasmPromise=null,jQe(),e&&e.environment||(this._defaults.environment=new uO,this.environment=this._defaults.environment);const t=(r=null)=>{v(r)&&r.type===Pi.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.handles.add([ms(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>t(r),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),ie(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new F_t({view:this}),this.stateManager=new Ro({view:this})}initialize(){this.groundView=new ydt({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(ms(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},pt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},pt),this.updatingHandles.add(()=>this.qualitySettings.frameRate,t=>Mze(t>0?1e3/Math.ceil(t):0),pt),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,Qi),this.updatingHandles.add(()=>{var t,r;return(r=(t=this.map)==null?void 0:t.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),Qi),this.handles.add(ie(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),bi))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Qe(this.sharedSymbolResources),this._set("labeler",Qe(this.labeler)),this._set("deconflictor",Qe(this.deconflictor)),this._resourceController=Qe(this._resourceController),this._set("stateManager",Qe(this.stateManager)),this._set("inputManager",Qe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",Qe(this.environmentManager)),this.groundView=Qe(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}get animation(){var e;return(e=this.state)==null?void 0:e.animation}get camera(){var e;return(e=this.stateManager)==null?void 0:e.camera}set camera(e){this.stateManager&&(this.stateManager.camera=e)}get contentCamera(){var e;return(e=this.stateManager)==null?void 0:e.contentCamera}set contentCamera(e){this.stateManager&&(this.stateManager.contentCamera=e)}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get center(){var e;return(e=this.stateManager)==null?void 0:e.center}set center(e){this.stateManager&&(this.stateManager.center=e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||this.get("map.clippingArea");return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||C(e)?(this._clippingArea=null,null):e instanceof Sr?this.spatialReference&&(e=WU(e,this.spatialReference),C(e))?(te.getLogger(this.declaredClass).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),C(e.intersection(this._groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(te.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&v(e)?te.getLogger(this.declaredClass).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Ye.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return C(t)||C(e)||t.spatialReference.equals(e)?t:WU(t,e)}get dataExtent(){let e=this._groundAndLayersExtent;const t=this.spatialReference||Ve.WGS84,r=WU(this.clippingArea,t);v(r)&&(e=v(e)?e.intersection(r):r);const i=this._get("dataExtent");return v(e)&&e.equals(i)?i:e}get _groundAndLayersExtent(){const e=this.spatialReference||Ve.WGS84;let t;const r=n=>{const o=WU(n,e);C(o)||(v(t)?t.union(o):t=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const n=i.groundExtent;r(new Sr({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const n=o=>{!v(o.fullExtent)||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(C(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("_groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof uO?e:e instanceof z$e?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):uO.fromWebsceneEnvironment(e):ts(uO,e):new uO}get extent(){var e;return(e=this.stateManager)==null?void 0:e.extent}set extent(e){this.stateManager&&(this.stateManager.extent=e)}get screenCenter(){var e;return(e=this.stateManager)==null?void 0:e.screenCenter}get frustum(){var e;return(e=this.stateManager)==null?void 0:e.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||v(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(C(this.state)||this.state.stationary)}get navigating(){var e,t;return(t=(e=this.state)==null?void 0:e.navigating)!=null?t:!1}get padding(){var e;return(e=this.stateManager)==null?void 0:e.padding}set padding(e){this.stateManager&&(this.stateManager.padding=e)}set qualityProfile(e){KB.isValidProfile(e)&&(KB.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||KB.getDefaultProfile()}set slicePlane(e){if(v(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),C(e))return void this._set("slicePlane",null);const t=this._propertiesPool.get("slicePlane");hC(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?g3e(this.scale,this.spatialReference):0}get scale(){var e;return(e=this.stateManager)==null?void 0:e.scale}set scale(e){this.stateManager&&(this.stateManager.scale=e)}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?lC.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var i,s,n;if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,r=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(o=>{if(o.isFulfilled()){if(o.updating){if(t=!0,o.suspended||pF(o))return;++r,e+=o.updatingProgress}}else++r});for(const o of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])v(o)&&o.updating&&(r+=.1,e+=.5*.1);for(const o of[this.deconflictor,this.labeler,this.basemapTerrain])v(o)&&o.updating&&(++r,e+=o.updatingProgress);if(t=!!(t||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||((i=this.inputManager)==null?void 0:i.hasPendingInputs)||((n=(s=this.map)==null?void 0:s.allLayers)==null?void 0:n.some(o=>!o.isFulfilled()))),t?(this._numUpdating=Math.max(r,this._numUpdating),e+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const o=performance.now();if(e<1){const a=Math.min((o-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-a)+e*a}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?o:0}return t}get viewingMode(){var r;const e=this._predeterminedViewingMode;if(v(e))return Bq(e);const t=this.spatialReference;return t?v((r=this.defaultsFromMap)==null?void 0:r.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?Bq(this.defaultsFromMap.viewingMode):MV(t,Ye.Global)?"global":"local":"global"}set viewingMode(e){this.ready?te.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",e)}get viewpoint(){var e;return(e=this.stateManager)==null?void 0:e.viewpoint}set viewpoint(e){this.stateManager&&(this.stateManager.viewpoint=e)}get zoom(){var e;return(e=this.stateManager)==null?void 0:e.zoom}set zoom(e){this.stateManager&&(this.stateManager.zoom=e)}get resourceController(){return this._resourceController}get performanceInfo(){return new TOt(this)}on(e,t,r,i){return this.viewEvents.on(e,t,r,i)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return te.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,i=v(r.graphics)&&(v(r.graphics.include)||v(r.graphics.exclude)),s=sye(e)?iye(this,e):e,n=Vy(s);r.enableDraped=r.include&&!r.include.has(Um)||r.exclude&&r.exclude.has(Um);const o=this.sceneIntersectionHelper,a=Of(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?qa.ALL:qa.MIN,o.intersectIntersectorScreen(n,a,r),i){for(const l of a.results.all){const c=oie(l,this);if(C(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return te.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=yt(e.z==null&&Zy(this.elevationProvider,e),0);return fa(e,xA,this.renderSpatialReference,t),this.state.camera.projectToScreen(xA,NY),hg(NY[0],NY[1])}pixelSizeAt(e){return this.ready?e?(fa(e,xA,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(xA)):0:(te.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return te.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=sye(e)?iye(this,e):e,i=Vs(r.x,r.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=Of(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=qa.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Swe(a,this),c=v(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,d={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:B0(a)?a.distanceInRenderSpace:0,layer:c}};return hi.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(d.intersector=n),Promise.resolve(d)}async popupHitTest(e){const{results:t,ground:r}=await hLt(this,e);let i=null;return!(t.length===0||Math.abs(yt(t[0].distance,0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:t,screenPoint:e,mapPoint:i}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(C(e.parent))throw new z("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});switch(e.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(e.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(e)}}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(t);return MY(r,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(t);return GDt(r,this._pixelFormat())}_completeSettings(e){const t=jDt(e,this);return t.pixelRatio/=this.state.pixelRatio,XDt(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}async takeScreenshotWithObjectAndLayerId(e){if(!pe("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(t),i=MY(r[0],t,this._pixelFormat()),s=this._completeSettings(e);return s.format="png",[i,MY(r[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(!pe("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView._objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return dye.importLayerView(e)}hasLayerViewModule(e){return dye.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,r,i;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=wLt(this.type);if(pe("safari")&&pe("safari")<9&&(e=new z("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:pe("safari")})),v(e))throw te.getLogger(this.declaredClass).warn("#validate()",e.message),e}get _predeterminedViewingMode(){var t,r;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(r=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?r:null;return v(e)?Ome(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const r=this._predeterminedViewingMode;if(v(r))return this._validateSpatialReferenceForViewingMode(e,t,r)?{constraints:this._makeSpatialReferenceConstraints(e,t,r)}:null;const i=this._validateSpatialReferenceForViewingMode(e,t,Ye.Local),s=this._validateSpatialReferenceForViewingMode(e,t,Ye.Global);return i||s?i&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:i?{constraints:this._makeSpatialReferenceConstraints(e,t,Ye.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,Ye.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,r){return!!MV(e,r)&&(!!C(t)||!!Vpe(t)||(!ID(t)||!C(TG(t,e,r)))&&(!zpe(t)||r!==Ye.Global))}_makeSpatialReferenceConstraints(e,t,r){if(C(t))return[{spatialReference:e,viewingMode:r}];const i=e.isWebMercator,s=e.isWGS84;return Vpe(t)&&(i||s)?!s||r===Ye.Local||Xce(t.tileInfo,t.fullExtent,e,Ye.Global)===null?[{spatialReference:e,viewingMode:r},{spatialReference:Ve.WebMercator,viewingMode:r}]:[{spatialReference:i?Ve.WGS84:Ve.WebMercator,viewingMode:r}]:ID(t)||zpe(t)||!i&&!s?ID(t)&&i&&r!==Ye.Global?[{spatialReference:e,viewingMode:r},{spatialReference:Ve.WGS84,viewingMode:Ye.Local}]:[{spatialReference:e,viewingMode:r}]:[{spatialReference:e,viewingMode:r},{spatialReference:i?Ve.WGS84:Ve.WebMercator,viewingMode:r}]}_validateSpatialReference(e){const t=v(this.getSpatialReferenceSupport({spatialReference:e})),r=this._predeterminedViewingMode;return t||(v(r)?te.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${Bq(r)} viewing mode.`):e.isGeographic&&te.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let r=this.spatialReference||Ve.WGS84;return So(e,this.renderSpatialReference,e,r)||(r=Ve.WGS84,So(e,this.renderSpatialReference,e,r)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=r):t=new lt(e,r),t}trackGraphicState(e){if(!e.graphic)return te.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let r=null,i=!1;const s=n=>{var o;!i&&v(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(r=n.processor.graphicsCore.trackGraphicState(e))};return v(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,v(r)&&(r.remove(),r=null)}}}highlight(e){if(Array.isArray(e))return aR(e.map(r=>this.highlight(r)));if(Ge.isCollection(e))return aR(e.toArray().map(r=>this.highlight(r)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):cg()}maskOccludee(e){if(!e)return te.getLogger(this.declaredClass).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let r=null,i=!1;const s=n=>{!i&&v(n)&&zut(n)&&(r=n.maskOccludee(e))};return v(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{i=!0,v(r)&&(r.remove(),r=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){v(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await vx(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new z("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((r,i)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(r,i))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,wL.INCLUDE),r=this._externalToInternalRenderItems(e.exclude,wL.EXCLUDE);return{include:t.layerUids,exclude:r.layerUids,graphics:{include:t.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(xA)?(t=this.computeMapPointFromVec3d(xA,t),e.intersector===zs.TERRAIN&&this.basemapTerrain&&(t.z=yt(Zy(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const r=new Array;let i=null;for(let s=0;s<e.length;s++){const n=e[s],o=Swe(n,this);if(v(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=oie(n,this);if(C(a))continue;if(a.type==="graphic"){if(C(i)&&s!==e.length-1&&(i=new Set),v(i)){const d=this._getGraphicFilterUid(a.graphic);if(i.has(d))continue;i.add(d)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(e){var s;const t=e.sourceLayer,r=e.layer,i=t&&"objectIdField"in t?t:r&&"objectIdField"in r?r:t;if(i){const n=(s=i.objectIdField)!=null?s:y3e,o=e.attributes[n];if(o)return`o-${i.id}-${o}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const r=this._getGraphicFilterUid(t);return C(e)||(C(e.include)||e.include.has(r))&&(C(e.exclude)||!e.exclude.has(r))}_externalToInternalRenderItems(e,t,r={layerUids:null,graphicUids:null}){if(!e)return r;if(e instanceof _i)kLt(r,this._getGraphicFilterUid(e)),t===wL.INCLUDE&&(v(this.graphicsView)&&e.layer===this?g3(r,this.graphicsView.processor.layer.id):e.layer&&g3(r,e.layer.uid));else if(qZ(e))for(const i of e)i===this.graphics&&v(this.graphicsView)?g3(r,this.graphicsView.processor.layer.id):i===this.map.ground?g3(r,Um):this._externalToInternalRenderItems(i,t,r);else"uid"in e&&g3(r,e.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new CIt({view:this})),this._set("elevationProvider",new H$({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new El({view:this})),this._set("featureTiles",new Pa({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var r;const t=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const i=v(this.basemapTerrain.extent)&&v(this.basemapTerrain.spatialReference)?cC(aj(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;v(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>hi.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(re(()=>import("./FeatureTileTree3DDebugger.5526413c.js"),["assets/FeatureTileTree3DDebugger.5526413c.js","assets/TileTreeDebugger.5cb7178a.js"])).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&hi.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):t||!this._featureTreeDebugger||hi.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Qi),this.updatingHandles.add(()=>this.clippingArea,e,Qi),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,Qi)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new $At(this.map,e));const t=this.state.isGlobal,r=m3e(t,e);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",KV.create(this.state.viewingMode,r)),t||this.handles.add(ie(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const s=this.renderCoordsHelper.spatialReference;i&&(i[0]!==0||i[1]!==0||i[2]!==0||i[3]!==0)&&Bj(i,this.basemapTerrain.spatialReference,Rwe,s)&&(this.renderCoordsHelper.extent=Rwe)},bi),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(rI/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){v(e)&&e.type===Pi.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add(ie(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),bi),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const r=e.getContext("2d");return r.putImageData(t,0,0),this.overlay.renderCanvas(e),r.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(a,l)=>this._renderScreenshotOverlay(a,l)}},t=new _At(this.state.viewingMode,a=>this._stage.layers.forAll(a),this);this._set("sceneIntersectionHelper",t);const r=$F(this.surface),{resourceController:i,state:s,renderSpatialReference:n}=this;this._stage=new su({options:e,container:r,resourceController:i,state:s,sceneIntersectionHelper:t,renderSR:n}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=mx(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new z("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),pt),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),pt),ie(()=>this.magnifier,a=>this._stage.renderView.magnifier=a,Qi)],"stage");const o=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:Fre.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],o),"stage"),o(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(rI/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new COt({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await re(()=>import("./GraphicsView3D.2833a73a.js"),["assets/GraphicsView3D.2833a73a.js","assets/GraphicsProcessor.035ada2b.js","assets/Graphics3DObjectStates.3d505bbe.js","assets/optimizedFeatureQueryEngineAdapter.d1f0d432.js","assets/centroid.28bc38cc.js","assets/PooledRBush.1f2f3da2.js","assets/quickselect.3948ea39.js"])).default;Ir(e),await vx(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),v(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Ome(this.viewingMode);if(e===Ye.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(ms(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Um);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Um);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return C(this.voxelWasm)?(C(this.voxelWasmPromise)&&(this.voxelWasmPromise=re(()=>import("./VoxelWasmPerSceneView.04a50ec3.js"),[]).then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){v(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function g3(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function kLt(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function WU(e,t){return v(e)&&Xv(e.spatialReference,t)?cC(e,t):null}var wL;ut.type="3d",u([h()],ut.prototype,"_userClippingArea",void 0),u([h()],ut.prototype,"_resourceController",void 0),u([h()],ut.prototype,"_stage",void 0),u([h({readOnly:!0})],ut.prototype,"deconflictor",void 0),u([h({readOnly:!0})],ut.prototype,"labeler",void 0),u([h(tV(VR,"analyses"))],ut.prototype,"analyses",void 0),u([h({type:jR,readOnly:!0})],ut.prototype,"animation",null),u([h({readOnly:!0})],ut.prototype,"basemapTerrain",void 0),u([h({readOnly:!0})],ut.prototype,"elevationProvider",void 0),u([h()],ut.prototype,"camera",null),u([h({type:Zh})],ut.prototype,"contentCamera",null),u([h({readOnly:!0})],ut.prototype,"canvas",void 0),u([h({type:lt})],ut.prototype,"center",null),u([h({type:Sr})],ut.prototype,"clippingArea",null),u([h({type:o2})],ut.prototype,"constraints",void 0),u([h({type:Sr,readOnly:!0})],ut.prototype,"renderDataExtent",null),u([h({type:Sr,readOnly:!0})],ut.prototype,"dataExtent",null),u([h({type:Sr,readOnly:!0})],ut.prototype,"_groundAndLayersExtent",null),u([h({value:null,type:uO})],ut.prototype,"environment",null),u([Gt("environment")],ut.prototype,"castEnvironment",null),u([h({readOnly:!0})],ut.prototype,"environmentManager",void 0),u([h({type:Sr})],ut.prototype,"extent",null),u([h()],ut.prototype,"floors",void 0),u([h()],ut.prototype,"screenCenter",null),u([h()],ut.prototype,"frustum",null),u([h({type:Number,readOnly:!0})],ut.prototype,"fullOpacity",void 0),u([h({readOnly:!0})],ut.prototype,"graphicsView",void 0),u([h({readOnly:!0})],ut.prototype,"analysisViewManager",void 0),u([h()],ut.prototype,"groundView",void 0),u([h({type:Boolean})],ut.prototype,"initialExtentRequired",null),u([h()],ut.prototype,"_defaultsFromMapSettings",null),u([h()],ut.prototype,"interacting",null),u([h()],ut.prototype,"stationary",null),u([h()],ut.prototype,"navigating",null),u([h()],ut.prototype,"map",void 0),u([h({readOnly:!0})],ut.prototype,"mapCoordsHelper",void 0),u([h()],ut.prototype,"padding",null),u([h({type:El,readOnly:!0})],ut.prototype,"pointsOfInterest",void 0),u([h({type:Pa,readOnly:!0})],ut.prototype,"featureTiles",void 0),u([h()],ut.prototype,"_featureTreeDebugger",void 0),u([h({type:Boolean})],ut.prototype,"screenSizePerspectiveEnabled",void 0),u([h({constructOnly:!0})],ut.prototype,"deactivatedWebGLExtensions",void 0),u([h({constructOnly:!0})],ut.prototype,"debugWebGLExtensions",void 0),u([h({constructOnly:!0})],ut.prototype,"renderCanvas",void 0),u([h({constructOnly:!0})],ut.prototype,"state",void 0),u([h({readOnly:!0})],ut.prototype,"inputManager",void 0),u([h({readOnly:!0})],ut.prototype,"stateManager",void 0),u([h({type:["low","medium","high"]})],ut.prototype,"qualityProfile",null),u([h({type:C1e,get(){let e=this._get("qualitySettings");return e||(e=new C1e,KB.apply(this.qualityProfile,e)),e}})],ut.prototype,"qualitySettings",void 0),u([h()],ut.prototype,"slicePlane",null),u([h({readOnly:!0})],ut.prototype,"typeSpecificPreconditionsReady",null),u([h({readOnly:!0})],ut.prototype,"renderCoordsHelper",void 0),u([h({readOnly:!0})],ut.prototype,"sceneIntersectionHelper",void 0),u([h({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],ut.prototype,"resolution",null),u([h({type:Number})],ut.prototype,"scale",null),u([h()],ut.prototype,"heightModelInfo",null),u([h()],ut.prototype,"spatialReference",void 0),u([h({type:Boolean,constructOnly:!0})],ut.prototype,"alphaCompositingEnabled",void 0),u([h({constructOnly:!0})],ut.prototype,"preserveDrawingBufferEnabled",void 0),u([h({type:Boolean})],ut.prototype,"supersampleScreenshotsEnabled",void 0),u([h({readOnly:!0})],ut.prototype,"type",void 0),u([h({type:$ke})],ut.prototype,"ui",void 0),u([h({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],ut.prototype,"updating",null),u([h({type:Number,readOnly:!0,dependsOn:["updating"]})],ut.prototype,"updatingProgress",void 0),u([h({type:["global","local"]})],ut.prototype,"viewingMode",null),u([h({type:Fd})],ut.prototype,"viewpoint",null),u([h({type:Number})],ut.prototype,"zoom",null),u([h({type:Fre})],ut.prototype,"highlightOptions",void 0),ut=u([I("esri.views.SceneView")],ut),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(wL||(wL={}));const xA=$(),NY=Vs(),Rwe=tr(),Dke=ut;function ULt(e){let t,r,i=[],s=!1;function n(...o){return s&&t===this&&BLt(o,i)||(r=e.apply(this,o),t=this,i=o,s=!0),r}return n}function BLt(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}const Xb="esri-weather",Zg={base:Xb,esriWidget:"esri-widget",esriWidgetDisabled:"esri-widget--disabled",widgetIcon:"esri-icon-partly-cloudy",content:`${Xb}__content`,hasError:`${Xb}__content--has-error`,selector:`${Xb}__selector`,options:`${Xb}__options`,error:`${Xb}__error`,warning:`${Xb}__warning`},zLt={base:`${`${Xb}__labeled-slider`}`};var e0,zm;(function(e){e.Disabled="disabled",e.Ready="ready",e.Error="error"})(e0||(e0={})),function(e){e.NotVisible="not-visible",e.LocalScene="local-scene",e.NoAtmosphere="no-atmosphere",e.UnsupportedView="unsupported-view"}(zm||(zm={}));let Gp=class extends Ss{constructor(e){super(e),this._onChange=t=>{const r=t.target.value;this.onChange(r)}}render(){const{label:e,disabled:t}=this;return P("div",{class:zLt.base},P("calcite-label",{scale:"s",disabled:t},e,P("calcite-slider",{"aria-label":e,disabled:this.disabled,max:1,min:0,step:.01,value:this.value,onCalciteSliderInput:this._onChange,onCalciteSliderChange:this._onChange})))}loadDependencies(){return Promise.all([re(()=>import("./calcite-label.95079e09.js"),["assets/calcite-label.95079e09.js","assets/label2.941e96ef.js"]),re(()=>import("./calcite-slider.e74dda12.js"),["assets/calcite-slider.e74dda12.js","assets/guid.ae96513b.js","assets/locale.77bc15e3.js","assets/key.eb5605f7.js","assets/observers.2da64440.js","assets/label2.941e96ef.js","assets/form.5aa109f5.js","assets/interactive.d71a7a54.js"])])}};u([h()],Gp.prototype,"value",void 0),u([h()],Gp.prototype,"onChange",void 0),u([h()],Gp.prototype,"disabled",void 0),Gp=u([I("esri.widgets.Weather.LabeledSlider")],Gp);let p8=class extends be{constructor(){super(...arguments),this.header=!0}};u([h({type:Boolean,nonNullable:!0})],p8.prototype,"header",void 0),p8=u([I("esri.widgets.Weather.VisibleElements")],p8);const Lke=p8,Nke="esri.widgets.Weather.WeatherViewModel",VLt=te.getLogger(Nke);let Yb=class extends be{constructor(e){super(e),this.view=null,this._handles=new hr,this._settingWeather=!1,this._weatherByType={sunny:new cV,cloudy:new I$e,rainy:new $$e,snowy:new D$e,foggy:new P$e}}initialize(){this._handles.add([ie(()=>this.current,e=>{this._settingWeather||C(e)||(this._weatherByType={...this._weatherByType,[e.type]:e})},Qi)])}destroy(){this._handles=Qe(this._handles)}get state(){const e=this.view;return C(e)||!e.ready?e0.Disabled:v(this.error)?this.error===zm.NotVisible?e0.Ready:e0.Error:e0.Ready}get error(){const e=this.view;return C(e)||!e.ready?null:e.type!=="3d"?zm.UnsupportedView:e.viewingMode==="local"?zm.LocalScene:e.environment.atmosphereEnabled?e.environmentManager.weatherVisible?null:zm.NotVisible:zm.NoAtmosphere}get current(){const e=qi(this._environment,t=>t.weather);return yt(e,this._weatherByType.sunny)}set current(e){qi(this._environment,t=>t.weather=e)}get test(){return{...this._weatherByType}}get _environment(){const e=this.view;return v(e)&&e.type==="3d"?e.environment:null}setWeatherByType(e){if(!F$e(e,VLt))return;const t=this._environment;v(t)&&(this._settingWeather=!0,t.weather=this._weatherByType[e],this._settingWeather=!1)}setSnowCoverEnabled(e){const t=this.current;"snowCover"in t&&(t.snowCover=e?"enabled":"disabled")}};u([h()],Yb.prototype,"view",void 0),u([h()],Yb.prototype,"state",null),u([h()],Yb.prototype,"error",null),u([h()],Yb.prototype,"current",null),u([h()],Yb.prototype,"_environment",null),Yb=u([I(Nke)],Yb);const jLt=Yb,GLt={sunny:"brightness",cloudy:"partly-cloudy",rainy:"rain",snowy:"snow",foggy:"fog"};let Lp=class extends Ss{constructor(e){super(e),this.viewModel=new jLt,this.headingLevel=4,this.visibleElements=new Lke,this.iconClass=Zg.widgetIcon,this._renderWeatherTypeButton=t=>{const r=this.viewModel,i=this.messages[t].label,s=r.state===e0.Disabled,n=!s&&r.current.type===t;return P("calcite-button",{appearance:n?"solid":"outline","aria-checked":n?"true":"false",color:n?"blue":"neutral",disabled:s,"icon-start":GLt[t],key:`${t}-type-button`,label:i,role:"radio",scale:"l",title:i,onclick:()=>{n||r.setWeatherByType(t)}})},this._memoizedCallbacks=ULt(t=>({onCloudCoverChange:r=>{"cloudCover"in t&&(t.cloudCover=r)},onPrecipitationChange:r=>{"precipitation"in t&&(t.precipitation=r)},onFogStrengthChange:r=>{"fogStrength"in t&&(t.fogStrength=r)},onSnowCoverChange:r=>{this.viewModel.setSnowCoverEnabled(r.target.checked)}}))}render(){const e=this.viewModel.state===e0.Disabled;return P("div",{class:this.classes(Zg.base,Zg.esriWidget,e&&Zg.esriWidgetDisabled),role:"region","aria-label":this.messages.widgetLabelAccessible},this._renderContent())}loadDependencies(){return Promise.all([re(()=>import("./calcite-button.40667b5c.js"),["assets/calcite-button.40667b5c.js","assets/label2.941e96ef.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js","assets/form.5aa109f5.js","assets/icon.1cb7558b.js","assets/loader.4ea8c9eb.js","assets/guid.ae96513b.js"]),re(()=>import("./calcite-checkbox.0d7e1346.js"),["assets/calcite-checkbox.0d7e1346.js","assets/guid.ae96513b.js","assets/form.5aa109f5.js","assets/label2.941e96ef.js","assets/interactive.d71a7a54.js","assets/key.eb5605f7.js"]),re(()=>import("./calcite-icon.85645cae.js"),["assets/calcite-icon.85645cae.js","assets/icon.1cb7558b.js","assets/observers.2da64440.js"]),re(()=>import("./calcite-label.95079e09.js"),["assets/calcite-label.95079e09.js","assets/label2.941e96ef.js"])])}get view(){var e;return(e=this.viewModel)==null?void 0:e.view}set view(e){this.viewModel&&(this.viewModel.view=e)}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get _errorMessage(){const e=this.messages.error;switch(this.viewModel.error){case zm.LocalScene:return e.localScene;case zm.NoAtmosphere:return e.noAtmosphere;case zm.UnsupportedView:return e.unsupported;default:return null}}get _warningMessage(){var e;return this.viewModel.error===zm.NotVisible&&v(this.view)&&((e=this.view)==null?void 0:e.type)==="3d"&&this.view.environment.atmosphereEnabled?this.messages.error.notVisible:null}_renderContent(){const e=this.messages,t=this._warningMessage,r=this.viewModel.state===e0.Error;return P(A6,null,this.visibleElements.header&&P(Sh,{level:this.headingLevel},e.widgetLabel),r&&P("div",{key:"error",class:Zg.error},this._errorMessage),P("div",{key:"content",class:mne({[Zg.content]:!0,[Zg.hasError]:r})},P("div",{class:Zg.selector,role:"radiogroup","aria-label":e.weatherType},N$e.map(this._renderWeatherTypeButton)),P("div",{class:Zg.options},this._renderOptions()),v(t)&&this._renderWarning(t)))}_renderOptions(){const{viewModel:e,messages:t}=this,r=e.state===e0.Disabled,i=e.current,s=this._memoizedCallbacks(i);switch(i.type){case"sunny":return P(Gp,{key:"sunny-cover",disabled:r,label:t.sunny.cloudCover,value:i.cloudCover,onChange:s.onCloudCoverChange});case"cloudy":return P(Gp,{key:"cloudy-cover",disabled:r,label:t.cloudy.cloudCover,value:i.cloudCover,onChange:s.onCloudCoverChange});case"rainy":return P(A6,null,P(Gp,{key:"rainy-cover",disabled:r,label:t.rainy.cloudCover,value:i.cloudCover,onChange:s.onCloudCoverChange}),P(Gp,{key:"rainy-precipitation",disabled:r,label:t.rainy.precipitation,value:i.precipitation,onChange:s.onPrecipitationChange}));case"snowy":return P(A6,null,P(Gp,{key:"snowy-cloud-cover",disabled:r,label:t.snowy.cloudCover,value:i.cloudCover,onChange:s.onCloudCoverChange}),P(Gp,{key:"snowy-precipitation",disabled:r,label:t.snowy.precipitation,value:i.precipitation,onChange:s.onPrecipitationChange}),P("calcite-label",{key:"snow-cover",scale:"s",disabled:r,layout:"inline",title:t.snowy.snowCoverTooltip},P("calcite-checkbox",{checked:i.snowCover==="enabled",onCalciteCheckboxChange:s.onSnowCoverChange}),t.snowy.snowCover));case"foggy":return P(Gp,{key:"foggy-cover",disabled:r,label:t.foggy.fogStrength,value:i.fogStrength,onChange:s.onFogStrengthChange})}}_renderWarning(e){return P("div",{key:"warning",class:Zg.warning},P("calcite-icon",{icon:"exclamation-mark-triangle",scale:"s"}),e)}};u([h()],Lp.prototype,"viewModel",void 0),u([h()],Lp.prototype,"view",null),u([h()],Lp.prototype,"headingLevel",void 0),u([h({type:Lke,nonNullable:!0})],Lp.prototype,"visibleElements",void 0),u([h()],Lp.prototype,"iconClass",void 0),u([h()],Lp.prototype,"label",null),u([h(),xi("esri/widgets/Weather/t9n/Weather")],Lp.prototype,"messages",void 0),u([h()],Lp.prototype,"_errorMessage",null),u([h()],Lp.prototype,"_warningMessage",null),Lp=u([I("esri.widgets.Weather")],Lp);const HLt=Lp,Ey="esri-daylight",FY=`${Ey}__container`,_n={base:Ey,widgetIcon:"esri-icon-environment-settings",widget:"esri-widget",select:"esri-select",pause:"esri-icon-pause",play:"esri-icon-play",shadowOff:"esri-slider--shadow-off",shadowOn:"esri-slider--shadow-on",sliderDateOn:"esri-slider--date-on",sliderDateOff:"esri-slider--date-off",sliderAmPmOn:"esri-slider--ampm-on",sliderAlignLeft:"esri-slider--align-left",sliderAlignRight:"esri-slider--align-right",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",secondaryTick:"secondary-tick",dayContainer:`${FY} ${Ey}__day-container`,dateContainer:`${FY} ${Ey}__date-container`,containerDisabled:`${FY}--disabled`,playPauseButton:`${Ey}__play-pause-button`,seasonPicker:`${Ey}__season-picker`,seasonPickerDisabled:`${Ey}__season-picker--disabled`,panelError:`${Ey}__panel--error`,sunLightingCheckbox:`${Ey}__sun-lighting-checkbox`,shadowsCheckbox:`${Ey}__shadows-checkbox`};var t0;(function(e){e[e.NORTHERN=0]="NORTHERN",e[e.SOUTHERN=1]="SOUTHERN"})(t0||(t0={}));const qLt={spring:{dayOfMonth:20,month:2},summer:{dayOfMonth:21,month:5},fall:{dayOfMonth:23,month:8},winter:{dayOfMonth:21,month:11}},aie=["spring","summer","fall","winter"];function Q$(e,t,r){const i=fue(t,r),{dayOfMonth:s,month:n}=qLt[i],o=new Date(e.getTime());return o.setMonth(n,s),o}function WLt(e,t){return fue(XLt(e),t)}function XLt(e){const t=e.getTime(),r=Q$(e,"spring",t0.NORTHERN).getTime(),i=Q$(e,"summer",t0.NORTHERN).getTime(),s=Q$(e,"fall",t0.NORTHERN).getTime(),n=Q$(e,"winter",t0.NORTHERN).getTime();return t>=r&&t<i?"spring":t>=i&&t<s?"summer":t>=s&&t<n?"fall":"winter"}function fue(e,t){return t===t0.NORTHERN?e:YLt(e)}function YLt(e){const t=aie.indexOf(e);return aie[(t+2)%4]}function ZLt(e,t){return Tqe(e,t,"minutes")}function JLt(e){return Sqe(e,"minutes")}function KLt(e,t,r){if(isNaN(e.getTime())&&isNaN(t.getTime()))return 3e5;const l=r.getTime(),c=e.getTime(),d=t.getTime(),p=c-72e5/2,f=c+72e5/2,m=d-72e5/3*2,g=d+72e5/3;let _=3e5;return l>=p&&l<=f?_=l-p<=12e5?18e5-(l-p)/12e5*(18e5-2e5):f-l<=12e5/2?3e5-(f-l)/12e5*2*(3e5-2e5):2e5:l>=m&&l<=g?_=l-m<=12e5/2?3e5-(l-m)/12e5*2*(3e5-2e5):g-l<=12e5?18e5-(g-l)/12e5*(18e5-2e5):2e5:(l<c||l>d)&&(_=18e5),_}let ou=class extends be{constructor(e){super(e),this.precision=4,this.thumbsConstrained=!0}set effectiveMax(e){this.setEffectiveMax(e)}set effectiveMin(e){this.setEffectiveMin(e)}set labelFormatFunction(e){this._set("labelFormatFunction",e)}set inputFormatFunction(e){this._set("inputFormatFunction",e)}set inputParseFunction(e){this._set("inputParseFunction",e)}get labels(){const{max:e,min:t,values:r}=this,i=r&&r.length?r.map((s,n)=>this.getLabelForValue(s,"value",n)):[];return{max:this.getLabelForValue(e,"max"),min:this.getLabelForValue(t,"min"),values:i}}set max(e){this.setMax(e)}set min(e){this.setMin(e)}get state(){const{max:e,min:t}=this;return e!=null&&t!=null&&e>t?"ready":"disabled"}set values(e){const{max:t,min:r}=this,i=this.values;i&&e&&i.length===e.length&&i.every((s,n)=>s===e[n])||(this._set("values",null),e&&e.length&&(r!=null&&e.some(s=>s<r)&&(this.min=Math.min(...e)),t!=null&&e.some(s=>s>t)&&(this.max=Math.max(...e))),this._set("values",e))}toPrecision(e){return parseFloat(e.toFixed(this.precision))}defaultLabelFormatFunction(e){const{max:t,min:r,precision:i}=this,s=t!=null&&r!=null&&t-r>10?2:i;return parseFloat(e.toFixed(s)).toString()}defaultInputFormatFunction(e){return e.toString()}defaultInputParseFunction(e){return parseFloat(e)}getBounds(){const{effectiveMax:e,effectiveMin:t,max:r,min:i}=this;return{min:t!=null&&i!=null?Math.max(i,t):i,max:e!=null&&r!=null?Math.min(r,e):r}}getBoundsForValueAtIndex(e){const{thumbsConstrained:t,values:r}=this,{min:i,max:s}=this.getBounds();if(t&&r){const n=e-1,o=e+1;return{min:r[n]!=null?r[n]:i,max:r[o]!=null?r[o]:s}}return{min:i,max:s}}getLabelForValue(e,t,r){return e==null?null:this.labelFormatFunction?this.labelFormatFunction(e,t,r):this.defaultLabelFormatFunction(e)}setMax(e){const{max:t,values:r}=this;if(e==null)return void this._set("max",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'max' is NaN.");const i=this.toPrecision(e);if(t!==i&&(this._set("max",i),r&&r.length))for(let s=0;s<r.length;s++)i<r[s]&&this.setValue(s,i)}setMin(e){const{min:t,values:r}=this;if(e==null)return void this._set("min",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'min' is NaN.");const i=this.toPrecision(e);if(t!==i&&(this._set("min",i),r&&r.length))for(let s=0;s<r.length;s++)i>r[s]&&this.setValue(s,i)}setEffectiveMax(e){if(e==null)return void this._set("effectiveMax",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMax' is NaN.");const t=this.toPrecision(e);this.effectiveMax!==t&&this._set("effectiveMax",this._applyBoundsToValue(t))}setEffectiveMin(e){if(e==null)return void this._set("effectiveMin",null);if(isNaN(e))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMin' is NaN.");const t=this.toPrecision(e);this.effectiveMin!==t&&this._set("effectiveMin",this._applyBoundsToValue(t))}setValue(e,t){if(isNaN(t))return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is NaN.");const{values:r}=this;if(r==null)return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is null.");const i=r[e],s=this.toPrecision(t);if(i===s)return;const n=[...r];n[e]=s,this._set("values",n),this.notifyChange("labels")}_applyBoundsToValue(e){const{max:t,min:r}=this;return r!=null&&e<r?r:t!=null&&e>t?t:e}_logError(e,t,r){te.getLogger(this.declaredClass).error(new z(e,t,r))}};u([h()],ou.prototype,"effectiveMax",null),u([h()],ou.prototype,"effectiveMin",null),u([h()],ou.prototype,"labelFormatFunction",null),u([h()],ou.prototype,"inputFormatFunction",null),u([h()],ou.prototype,"inputParseFunction",null),u([h({readOnly:!0})],ou.prototype,"labels",null),u([h()],ou.prototype,"max",null),u([h()],ou.prototype,"min",null),u([h()],ou.prototype,"precision",void 0),u([h({readOnly:!0})],ou.prototype,"state",null),u([h()],ou.prototype,"thumbsConstrained",void 0),u([h()],ou.prototype,"values",null),ou=u([I("esri.widgets.Slider.SliderViewModel")],ou);const Fke=ou;let av=class extends Fke{constructor(e){super(e),this.items=null,this.currentIndex=0,this.isDropdownOpen=!1}get currentItem(){return this.items!==null&&this.currentIndex!==null&&this.currentIndex<this.items.length?this.items[this.currentIndex]:null}selectItem(e){this.currentIndex=e,this.isDropdownOpen=!1}toggle(){this.isDropdownOpen=!this.isDropdownOpen}};u([h()],av.prototype,"items",void 0),u([h()],av.prototype,"currentIndex",void 0),u([h()],av.prototype,"currentItem",null),u([h()],av.prototype,"isDropdownOpen",void 0),av=u([I("esri.widgets.Daylight.SliderWithDropdown")],av);let eD=class extends be{constructor(){super(...arguments),this.state="ready",this.value=new Date}};u([h()],eD.prototype,"state",void 0),u([h()],eD.prototype,"value",void 0),eD=u([I("esri.widgets.support.DateTimeElementViewModel")],eD);const kke=eD;let lie=class extends kke{constructor(e){super(e)}};lie=u([I("esri.widgets.support.DatePickerViewModel")],lie);const ZG=lie,QLt={hour:"2-digit",minute:"2-digit",timeZone:"UTC"},eNt={hour:"numeric",timeZone:"UTC"};function Iwe(e,t){let r;if(t==="tick"){const s=Math.round(Pw(e,"minutes","hours"));r=new Date(Pw(s,"hours","milliseconds"))}else r=new Date(6e4*e);let i=_s(r,QLt);return e!==0&&i==="00:00"&&(i="24:00"),t==="tick"&&i.includes(" ")&&(i=_s(r,eNt),i=i.replace(":00","")),i}function tNt(e,t,r,i){const s=Lx.getTimes(e,t,r),n=s.sunrise,o=s.sunset,a=df(e,i,"hours"),l=df(n,i,"hours"),c=df(o,i,"hours");if(a.getUTCDate()!==l.getUTCDate()||a.getUTCDate()!==c.getUTCDate()){const d=a.getTime()-l.getTime()>0?1:-1;n.setUTCDate(n.getUTCDate()+d),o.setUTCDate(o.getUTCDate()+d)}return{sunrise:n,sunset:o}}function rNt(e){return[{utcOffset:-12,short:"UTC-12",long:e.timezoneDateline},{utcOffset:-11,short:"UTC-11",long:e.timezoneSamoa},{utcOffset:-10,short:e.timezoneHAST,long:e.timezoneHawaii},{utcOffset:-9,short:e.timezoneAKST,long:e.timezoneAlaska},{utcOffset:-8,short:e.timezonePST,long:e.timezoneBaja},{utcOffset:-7,short:e.timezoneMST,long:e.timezoneMountain},{utcOffset:-7,short:e.timezoneMST,long:e.timezoneLaPaz},{utcOffset:-7,short:e.timezoneMST,long:e.timezoneArizona},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneSaskatchewan},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneCentralAmerica},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneCentralTime},{utcOffset:-6,short:e.timezoneCST,long:e.timezoneMexico},{utcOffset:-5,short:e.timezoneEST,long:e.timezoneEasternUS},{utcOffset:-5,short:e.timezoneEST,long:e.timezoneLima},{utcOffset:-5,short:e.timezoneEST,long:e.timezoneIndiana},{utcOffset:-4,short:null,long:e.timezoneAtlantic},{utcOffset:-4,short:null,long:e.timezoneCuiaba},{utcOffset:-4,short:null,long:e.timezoneSantiago},{utcOffset:-4,short:null,long:e.timezoneManaus},{utcOffset:-4,short:null,long:e.timezoneAsuncion},{utcOffset:-3,short:null,long:e.timezoneBrasilia},{utcOffset:-3,short:null,long:e.timezoneGreenland},{utcOffset:-3,short:null,long:e.timezoneMontevideo},{utcOffset:-3,short:null,long:e.timezoneCayenne},{utcOffset:-3,short:null,long:e.timezoneBuenosAires},{utcOffset:-2,short:null,long:e.timezoneMidAtlantic},{utcOffset:-1,short:null,long:e.timezoneAzores},{utcOffset:-1,short:null,long:e.timezoneCaboVerde},{utcOffset:0,short:null,long:e.timezoneDublin},{utcOffset:0,short:null,long:e.timezoneReykjavik},{utcOffset:0,short:null,long:e.timezoneCasablanca},{utcOffset:1,short:e.timezoneCET,long:e.timezoneBelgrade},{utcOffset:1,short:e.timezoneCET,long:e.timezoneSarajevo},{utcOffset:1,short:e.timezoneCET,long:e.timezoneBrussels},{utcOffset:1,short:e.timezoneCET,long:e.timezoneWCAfrica},{utcOffset:1,short:e.timezoneCET,long:e.timezoneAmsterdam},{utcOffset:1,short:e.timezoneCET,long:e.timezoneWindhoek},{utcOffset:2,short:e.timezoneEET,long:e.timezoneMinsk},{utcOffset:2,short:e.timezoneEET,long:e.timezoneCairo},{utcOffset:2,short:e.timezoneEET,long:e.timezoneHelsinki},{utcOffset:2,short:e.timezoneEET,long:e.timezoneAthens},{utcOffset:2,short:e.timezoneEET,long:e.timezoneJerusalem},{utcOffset:2,short:e.timezoneEET,long:e.timezoneAmman},{utcOffset:2,short:e.timezoneEET,long:e.timezoneBeirut},{utcOffset:2,short:e.timezoneEET,long:e.timezoneHarare},{utcOffset:2,short:e.timezoneEET,long:e.timezoneDamascus},{utcOffset:2,short:e.timezoneEET,long:e.timezoneIstanbul},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneKuwait},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneBaghdad},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneNairobi},{utcOffset:3,short:e.timezoneMSK,long:e.timezoneKaliningrad},{utcOffset:4,short:e.timezoneGST,long:e.timezoneMoscow},{utcOffset:4,short:e.timezoneGST,long:e.timezoneMuscat},{utcOffset:4,short:e.timezoneGST,long:e.timezoneBaku},{utcOffset:4,short:e.timezoneGST,long:e.timezoneYerevan},{utcOffset:4,short:e.timezoneGST,long:e.timezoneTbilisi},{utcOffset:4,short:e.timezoneGST,long:e.timezonePortLouis},{utcOffset:5,short:null,long:e.timezoneTashkent},{utcOffset:5,short:null,long:e.timezoneIslamabad},{utcOffset:6,short:null,long:e.timezoneEkaterinburg},{utcOffset:6,short:null,long:e.timezoneAstana},{utcOffset:6,short:null,long:e.timezoneDhaka},{utcOffset:7,short:e.timezoneICT,long:e.timezoneNovosibirsk},{utcOffset:7,short:e.timezoneICT,long:e.timezoneBangkok},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneKrasnoyarsk},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneBeijing},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneSingapore},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneTaipei},{utcOffset:8,short:e.timezoneCCT,long:e.timezonePerth},{utcOffset:8,short:e.timezoneCCT,long:e.timezoneUlaanbaatar},{utcOffset:9,short:e.timezoneJST,long:e.timezoneIrkutsk},{utcOffset:9,short:e.timezoneJST,long:e.timezoneSeoul},{utcOffset:9,short:e.timezoneJST,long:e.timezoneOsaka},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneYakutsk},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneCanberra},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneBrisbane},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneHobart},{utcOffset:10,short:e.timezoneAEST,long:e.timezoneGuam},{utcOffset:11,short:null,long:e.timezoneVladivostok},{utcOffset:11,short:null,long:e.timezoneSolomon},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneMagadan},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneFiji},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneAuckland},{utcOffset:12,short:e.timezoneNZST,long:e.timezoneNukualofa}].map(({utcOffset:t,short:r,long:i})=>{const s=t>0?`UTC+${t}`:t<0?`UTC${t}`:"GMT";return r?{utcOffset:t,short:r,shortWithUTC:`${s} (${r})`,long:i}:{utcOffset:t,short:s,shortWithUTC:s,long:i}})}let Os=class extends gR{constructor(e){super(e),this.view=null,this.datePickerViewModel=new ZG,this.timeSliderViewModel=new av({min:0,max:1439,values:[0],labelFormatFunction:Iwe,inputFormatFunction:Iwe}),this.lightingUpdateInterval=200,this._oldLighting=null,this.playSpeedMultiplier=1,this._cachedLightingDateUTC=new Date(0),this._cachedDisplayUTCOffset=0,this._firstInteraction=!0,this._lastLightingUpdate=0,this._nextLightingUpdate=null}initialize(){this.handles.add([no(()=>this.view,e=>e.when(()=>this._updateLighting(null)),pt),ie(()=>qi(this._lighting,e=>e.type!=="virtual"?e.date:null),e=>this._scheduleUpdateLighting(e)),ms(()=>this._lighting,"timezone-will-change",e=>this._timezoneWillChange(e),{onListenerAdd:()=>this._timezoneWillChange(null)}),ie(()=>qi(this.view,e=>e.stationary)===!0,()=>{(this.dayPlaying||this.yearPlaying)&&this._updateSunriseAndSunset()},pt),ie(()=>{const e=this.timeSliderViewModel;return{vm:e,state:e.state,sliderPosition:this.timeSliderPosition}},({vm:e,state:t,sliderPosition:r})=>{t==="ready"&&e.setValue(0,r)}),ie(()=>{var e;return(e=this.timeSliderViewModel.currentItem)==null?void 0:e.utcOffset},e=>this.utcOffset=e),ie(()=>this.timeSliderViewModel.isDropdownOpen,()=>this.stopPlaying()),ie(()=>this.timeSliderViewModel.values,e=>this.timeSliderPosition=e[0]),ie(()=>this.datePickerViewModel.value,e=>{this.dayPlaying=!1,this.localDate=e}),ie(()=>this.localDate,e=>{this.datePickerViewModel.value.valueOf()!==e.getTime()&&this.datePickerViewModel.set("value",e)})])}destroy(){this._nextLightingUpdate&&(clearTimeout(this._nextLightingUpdate),this._nextLightingUpdate=null),this.view=null}get isSupported(){return C(this.view)||this.view.type==="3d"}get utcOffset(){return this._cachedDisplayUTCOffset}set utcOffset(e){e!==this.utcOffset&&v(this._lighting)&&this._lighting.type!=="virtual"&&(this._lighting.displayUTCOffset=e,this._updateLighting(null))}get localDate(){return Cqe(this._lightingDateDisplay)}set localDate(e){e.getTime()!==this.localDate.getTime()&&(this._lightingDateDisplay=Eqe(this._lightingDateDisplay,e))}get timeSliderPosition(){return JLt(this._lightingDateDisplay)}set timeSliderPosition(e){Math.abs(e-this.timeSliderPosition)>1/60&&(this._lightingDateDisplay=ZLt(this._lightingDateDisplay,e),this.stopPlaying(),this._enableDirectShadowsIfFirstInteraction())}_timezoneFromCamera(e,t){if(C(t)||!e.cameraTrackingEnabled)return 0;const r=Kte([t.longitude,t.latitude]);return C(r)?0:Math.round(r.hours+r.minutes/60+r.seconds/3600)}get directShadowsEnabled(){const e=qi(this._lighting,t=>t.directShadowsEnabled);return yt(e,!1)}set directShadowsEnabled(e){qi(this._lighting,t=>{t.directShadowsEnabled=e})}get sunLightingEnabled(){return this._lightingType==="sun"}set sunLightingEnabled(e){const t=this._environment;if(e===this._get("sunLightingEnabled")||C(t))return;const r=t.lighting,i=this._oldLighting;this._oldLighting=r;const s={directShadowsEnabled:r.directShadowsEnabled,ambientOcclusionEnabled:r.ambientOcclusionEnabled,waterReflectionEnabled:r.waterReflectionEnabled,cameraTrackingEnabled:r.cameraTrackingEnabled},n=e?"sun":"virtual";let o;o=v(i)&&i.type===n?i:e?new Ny:new eM,o.set(s),t.lighting=o,e||(this.timeSliderViewModel.isDropdownOpen=!1)}set playingState(e){this.playingState!==e&&this.sunLightingEnabled&&(this._set("playingState",e),e!=="none"&&(this._updateSunriseAndSunset(),this._lastTime=Date.now(),this._play(),this._enableDirectShadowsIfFirstInteraction()))}get dayPlaying(){return this.playingState==="day"}set dayPlaying(e){e?this.playingState="day":this.dayPlaying&&(this.playingState="none")}get yearPlaying(){return this.playingState==="year"}set yearPlaying(e){e?this.playingState="year":this.yearPlaying&&(this.playingState="none")}get currentSeason(){return WLt(this.localDate,this._currentHemisphere)}set currentSeason(e){this.stopPlaying();const t=fue(e,this._currentHemisphere);this.localDate=Q$(this.localDate,t,t0.NORTHERN)}get _currentHemisphere(){const e=qi(this.view,t=>{var r;return(r=t.camera)==null?void 0:r.position});return C(e)||e.latitude>=0?t0.NORTHERN:t0.SOUTHERN}get _environment(){return qi(this.view,e=>e.environment)}get _lighting(){return qi(this._environment,e=>e.lighting)}get _lightingType(){return qi(this._lighting,e=>e.type)}get _lightingDateDisplay(){return df(this._cachedLightingDateUTC,this._cachedDisplayUTCOffset,"hours")}set _lightingDateDisplay(e){const t=this._lighting;if(C(t)||!this.sunLightingEnabled||t.type==="virtual")return;const r=df(e,-this._cachedDisplayUTCOffset,"hours");r.getTime()!==t.date.getTime()&&(t.date=r,this._updateLighting(null))}stopPlaying(){this.playingState="none"}toggleDayPlaying(){this.dayPlaying=!this.dayPlaying}toggleYearPlaying(){this.yearPlaying=!this.yearPlaying}toggleSunLightingEnabled(){this.stopPlaying(),this.sunLightingEnabled=!this.sunLightingEnabled}toggleDirectShadowsEnabled(){this.stopPlaying(),this.directShadowsEnabled=!this.directShadowsEnabled}_enableDirectShadowsIfFirstInteraction(){this._firstInteraction&&(this._firstInteraction=!1,this.directShadowsEnabled=!0)}_updateLighting(e){var a;const t=Date.now();this._lastLightingUpdate=t;const{view:r}=this,i=this._lighting;if(C(r)||C(i)||i.type==="virtual")return;const s=e||i.date,n=i.displayUTCOffset,o=n!==null?n:this._timezoneFromCamera(i,(a=r.camera)==null?void 0:a.position);this._cachedLightingDateUTC.getTime()!==s.getTime()&&(this._cachedLightingDateUTC=new Date(s.getTime())),this._cachedDisplayUTCOffset!==o&&(this._cachedDisplayUTCOffset=o)}_timezoneWillChange(e){const t=this._lighting;if(C(t)||t.type==="virtual"||!t.cameraTrackingEnabled)return;let r;if(e)r=e.timezoneOffset;else{if(t.displayUTCOffset!=null)return;r=Ny.calculateTimezoneOffset(t.positionTimezoneInfo)}t.displayUTCOffset=r,this._scheduleUpdateLighting(null)}_scheduleUpdateLighting(e){if(this._nextLightingUpdate||C(e))return;const t=Date.now()-this._lastLightingUpdate,r=this.lightingUpdateInterval-t;r<=0?JE(()=>this._updateLighting(e)):this._nextLightingUpdate=setTimeout(()=>{this._updateLighting(null),this._nextLightingUpdate=null},r)}_play(){const e=this._lighting;if(!C(e)&&this.sunLightingEnabled&&e.type!=="virtual"&&(this.dayPlaying||this.yearPlaying)){const t=Date.now()-this._lastTime;if(this.dayPlaying){this._lastTime=Date.now();const r=KLt(this._sunrise,this._sunset,e.date)*this.playSpeedMultiplier/100*t;if(r>0){let i=new Date(e.date.getTime()+r);((i.getUTCHours()+e.displayUTCOffset)%24+24)%24<((e.date.getUTCHours()+e.displayUTCOffset)%24+24)%24&&(i=new Date(e.date.getTime()+r-864e5)),e.date=i}}else if(t>1e3){this._lastTime=Date.now();const r=(e.date.getUTCMonth()+1)%12,i=new Date(e.date.getTime());i.setUTCMonth(r),e.date=i}requestAnimationFrame(()=>this._play())}}_updateSunriseAndSunset(){const e=this._lighting;if(C(e)||e.type==="virtual"||!this.sunLightingEnabled)return;const t=qi(this.view,i=>{var s;return(s=i.camera)==null?void 0:s.position});if(C(t))return;const r=tNt(e.date,t.latitude,t.longitude,e.displayUTCOffset);this._sunrise=new Date(r.sunrise),this._sunset=new Date(r.sunset)}};u([h({type:Dke})],Os.prototype,"view",void 0),u([h({type:ZG,nonNullable:!0})],Os.prototype,"datePickerViewModel",void 0),u([h({type:av,nonNullable:!0})],Os.prototype,"timeSliderViewModel",void 0),u([h()],Os.prototype,"isSupported",null),u([h()],Os.prototype,"lightingUpdateInterval",void 0),u([h()],Os.prototype,"utcOffset",null),u([h()],Os.prototype,"localDate",null),u([h()],Os.prototype,"timeSliderPosition",null),u([h()],Os.prototype,"directShadowsEnabled",null),u([h()],Os.prototype,"sunLightingEnabled",null),u([h({type:["none","day","year"],value:"none"})],Os.prototype,"playingState",null),u([h()],Os.prototype,"dayPlaying",null),u([h()],Os.prototype,"yearPlaying",null),u([h()],Os.prototype,"playSpeedMultiplier",void 0),u([h()],Os.prototype,"currentSeason",null),u([h()],Os.prototype,"_lastTime",void 0),u([h()],Os.prototype,"_sunrise",void 0),u([h()],Os.prototype,"_sunset",void 0),u([h()],Os.prototype,"_cachedLightingDateUTC",void 0),u([h()],Os.prototype,"_cachedDisplayUTCOffset",void 0),u([h()],Os.prototype,"_firstInteraction",void 0),u([h()],Os.prototype,"_currentHemisphere",null),u([h()],Os.prototype,"_environment",null),u([h()],Os.prototype,"_lighting",null),u([h()],Os.prototype,"_lightingType",null),u([h()],Os.prototype,"_lightingDateDisplay",null),Os=u([I("esri.widgets.Daylight.DaylightViewModel")],Os);const Uke=Os;let V_=class extends be{constructor(){super(...arguments),this.header=!0,this.playButtons=!0,this.datePicker=!0,this.timezone=!0,this.sunLightingToggle=!0,this.shadowsToggle=!0}};u([h({type:Boolean,nonNullable:!0})],V_.prototype,"header",void 0),u([h({type:Boolean,nonNullable:!0})],V_.prototype,"playButtons",void 0),u([h({type:Boolean,nonNullable:!0})],V_.prototype,"datePicker",void 0),u([h({type:Boolean,nonNullable:!0})],V_.prototype,"timezone",void 0),u([h({type:Boolean,nonNullable:!0})],V_.prototype,"sunLightingToggle",void 0),u([h({type:Boolean,nonNullable:!0})],V_.prototype,"shadowsToggle",void 0),V_=u([I("esri.widgets.Daylight.VisibleElements")],V_);const Bke=V_,Dr={base:"esri-slider",reversed:"esri-slider--reversed",horizontalLayout:"esri-slider--horizontal",verticalLayout:"esri-slider--vertical",contentElement:"esri-slider__content",extraContentElement:"esri-slider__extra-content",trackElement:"esri-slider__track",ticksContainerElement:"esri-slider__ticks",tickElement:"esri-slider__tick",tickLabelElement:"esri-slider__tick-label",maxElement:"esri-slider__max",minElement:"esri-slider__min",maxElementInteractive:"esri-slider__max--interactive",minElementInteractive:"esri-slider__min--interactive",rangeElementActive:"esri-slider__range--active",rangeInput:"esri-slider__range-input",anchorElement:"esri-slider__anchor",movingAnchorElement:"esri-slider__anchor--moving",lastMovedAnchorElement:"esri-slider__anchor--moved",anchorElementActive:"esri-slider__anchor--active",anchorElementIndexPrefix:"esri-slider__anchor-",segmentElement:"esri-slider__segment",segmentElementIndexPrefix:"esri-slider__segment-",segmentElementInteractive:"esri-slider__segment--interactive",segmentElementActive:"esri-slider__segment--active",effectiveSegmentElement:"esri-slider__effective-segment",effectiveMaxSegmentElement:"esri-slider__effective-max-segment",effectiveMinSegmentElement:"esri-slider__effective-min-segment",thumbElement:"esri-slider__thumb",labelElement:"esri-slider__label",labelElementInteractive:"esri-slider__label--interactive",labelInput:"esri-slider__label-input",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled",hidden:"esri-hidden"},Hu={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},iNt="esri.widgets.Slider",Pwe={labels:!1,rangeLabels:!1};let ri=class extends Ss{constructor(e,t){super(e,t),this._activeLabelInputIndex=null,this._anchorElements=[],this._dragged=!1,this._dragStartInfo=null,this._focusedAnchorIndex=null,this._isMinInputActive=!1,this._isMaxInputActive=!1,this._lastMovedHandleIndex=null,this._positionPrecision=5,this._segmentDragStartInfo=null,this._trackHeight=null,this._trackWidth=null,this._zIndices=null,this._zIndexOffset=3,this.disabled=!1,this.draggableSegmentsEnabled=!0,this.effectiveSegmentElements=new Ge,this.extraNodes=[],this.inputCreatedFunction=null,this.labelElements=new Ge,this.labelInputsEnabled=!1,this.maxLabelElement=null,this.messages=null,this.minLabelElement=null,this.rangeLabelInputsEnabled=!1,this.segmentElements=new Ge,this.snapOnClickEnabled=!0,this.steps=null,this.syncedSegmentsEnabled=!1,this.thumbCreatedFunction=null,this.thumbElements=new Ge,this.tickElements=new Ge,this.trackElement=null,this.viewModel=new Fke,this.visibleElements={...Pwe},this._onAnchorPointerDown=this._onAnchorPointerDown.bind(this),this._onAnchorPointerMove=this._onAnchorPointerMove.bind(this),this._onAnchorPointerUp=this._onAnchorPointerUp.bind(this),this._onLabelPointerDown=this._onLabelPointerDown.bind(this),this._onLabelPointerUp=this._onLabelPointerUp.bind(this),this._onSegmentPointerDown=this._onSegmentPointerDown.bind(this),this._onSegmentPointerMove=this._onSegmentPointerMove.bind(this),this._onSegmentPointerUp=this._onSegmentPointerUp.bind(this),this._onTrackPointerDown=this._onTrackPointerDown.bind(this),this._onTrackPointerMove=this._onTrackPointerMove.bind(this),this._onTrackPointerUp=this._onTrackPointerUp.bind(this)}destroy(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this.labelElements.removeAll(),this.labelElements.destroy(),this.segmentElements.removeAll(),this.segmentElements.destroy(),this.effectiveSegmentElements.removeAll(),this.effectiveSegmentElements.destroy(),this.thumbElements.removeAll(),this.thumbElements.destroy(),this.tickElements.removeAll(),this.tickElements.destroy()}get effectiveMax(){return this.viewModel.effectiveMax}set effectiveMax(e){this.viewModel.effectiveMax=e}get effectiveMin(){return this.viewModel.effectiveMin}set effectiveMin(e){this.viewModel.effectiveMin=e}get inputFormatFunction(){return this.viewModel.inputFormatFunction}set inputFormatFunction(e){this.viewModel.inputFormatFunction=e}get inputParseFunction(){return this.viewModel.inputParseFunction}set inputParseFunction(e){this.viewModel.inputParseFunction=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get labelFormatFunction(){return this.viewModel.labelFormatFunction}set labelFormatFunction(e){this.viewModel.labelFormatFunction=e}get labels(){return this.viewModel.labels}set layout(e){["vertical","vertical-reversed","horizontal","horizontal-reversed"].includes(e)||(e="horizontal"),this._set("layout",e)}get max(){return this.viewModel.max}set max(e){this.viewModel.max=e}get min(){return this.viewModel.min}set min(e){this.viewModel.min=e}get precision(){return this.viewModel.precision}set precision(e){this.viewModel.precision=e}get state(){const{_activeLabelInputIndex:e,_isMaxInputActive:t,_isMinInputActive:r,_dragStartInfo:i,_segmentDragStartInfo:s,disabled:n,viewModel:o}=this,a=v(i)||v(s);return n?"disabled":e===null&&!t&&!r?a?"dragging":o.state:"editing"}get thumbsConstrained(){return this.viewModel.thumbsConstrained}set thumbsConstrained(e){this.viewModel.thumbsConstrained=e}set tickConfigs(e){this._set("tickConfigs",e),this.scheduleRender()}get values(){return this.viewModel.values}set values(e){this.viewModel.values=e}castVisibleElements(e){return{...Pwe,...e}}render(){const{label:e}=this,t=this.classes(Dr.base,Dr.esriWidget,this._isHorizontalLayout()?Dr.horizontalLayout:Dr.verticalLayout,this._isReversedLayout()?Dr.reversed:null,this._isDisabled()?Dr.disabled:null);return this._storeTrackDimensions(),P("div",{"aria-label":e,class:t,"touch-action":"none",bind:this,afterCreate:this._afterContainerCreate},this.renderContent())}toNextStep(e){this._toStep(e,1)}toPreviousStep(e){this._toStep(e,-1)}renderContent(){const{max:e,min:t}=this;if(!(C(t)||C(e)||t>=e))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]}renderSliderContainer(){return P("div",{key:"slider-container",bind:this,class:Dr.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())}renderTrackElement(){return P("div",{afterCreate:this._afterTrackCreate,afterRemoved:this._afterTrackRemoved,bind:this,class:Dr.trackElement,"touch-action":"none"},this.renderEffectiveSegmentElements(),this.renderSegmentElements(),this.renderAnchorElements())}renderEffectiveSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=v(this.effectiveMax),t=v(this.effectiveMin);if(!e&&!t)return;const{max:r,min:i,viewModel:s}=this,n=s.getBounds(),o=[];return t&&o.push(this.renderEffectiveSegmentElement(i,n.min,!0)),e&&o.push(this.renderEffectiveSegmentElement(n.max,r,!1)),o}renderSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=this.values.length,t=[];for(let r=0;r<=e;r++)t.push(this.renderSegmentElement(r));return t}renderSegmentElement(e){const{_trackHeight:t,_trackWidth:r,draggableSegmentsEnabled:i,id:s,state:n,values:o}=this,a=this._isHorizontalLayout(),l=a?r:t,c=this.viewModel.getBounds(),d=this._positionFromValue(c.max),p=this._positionFromValue(c.min),f=e===o.length?null:e,m=e===0?null:e-1,g=v(f),_=v(m);let x,b;const w=[...o].sort((R,D)=>R-D);this._isReversedLayout()?(x=_?this._positionFromValue(w[m]):p,b=g?this._positionFromValue(w[f]):d):(x=g?this._positionFromValue(w[f]):d,b=_?this._positionFromValue(w[m]):p);const T=this._applyPrecisionToPosition(100*b/l),E=(x-b)/l,O=a?`transform: translate(${T}%, 0px) scale(${E}, 1);`:`transform: translate(0px, ${T}%) scale(1, ${E});`,A=this.classes(Dr.segmentElement,Dr.segmentElementIndexPrefix+e,i&&g&&_&&n!=="disabled"?Dr.segmentElementInteractive:null);return P("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:A,"data-max-thumb-index":f,"data-min-thumb-index":m,"data-segment-index":e,key:`${s}-segment-${e}`,style:O,"touch-action":"none"})}renderEffectiveSegmentElement(e,t,r){const{_trackHeight:i,_trackWidth:s,layout:n}=this,o=this._positionFromValue(e),a=this._positionFromValue(t),l=this._isHorizontalLayout(),c=l?s:i,d=this._applyPrecisionToPosition(100*o/c);let p=null;if(n==="horizontal"){const g=r?c-a:a,_=o===c?0:d;p=`clip-path: inset(0% ${a===c?0:this._applyPrecisionToPosition(g/c*100)}% 0% ${_}%);`}else{const g=(a-o)/c;p=l?`transform: translate(${d}%, 0px) scale(${g}, 1);`:`transform: translate(0px, ${d}%) scale(1, ${g});`}const f=r?Dr.effectiveMinSegmentElement:Dr.effectiveMaxSegmentElement,m=this.classes(Dr.segmentElement,Dr.effectiveSegmentElement,f);return P("div",{afterCreate:this._afterEffectiveSegmentCreate,afterRemoved:this._afterEffectiveSegmentRemoved,bind:this,class:m,style:p,"touch-action":"none"})}renderAnchorElements(){const{trackElement:e,values:t}=this;if(t&&t.length)return this._zIndices=t.map((r,i)=>{const s=this._positionFromValue(r),n=this._positionToPercent(s),o=(this._isHorizontalLayout()?n>50:n<50)?-1:1;return this._zIndexOffset+(t.length+o*i)}),e&&t&&t.length?t.map((r,i)=>this.renderAnchorElement(r,i)):null}renderAnchorElement(e,t){const r=this._positionFromValue(e),i=this._valueFromPosition(r);if(C(i)||isNaN(i))return;const{_dragStartInfo:s,_lastMovedHandleIndex:n,id:o,layout:a,values:l,visibleElements:{labels:c}}=this,d=s&&s.index===t,p=n===t,f=this.classes(Dr.anchorElement,Dr.anchorElementIndexPrefix+t,d?Dr.movingAnchorElement:null,p?Dr.lastMovedAnchorElement:null),m=this.labels.values[t],g=this._getStyleForAnchor(e,t,d||p),{min:_,max:x}=this.viewModel.getBoundsForValueAtIndex(t),{disabled:b,messages:w}=this,T=l.length===2?hu(t===0?w.rangeMinimum:w.rangeMaximum,{value:e}):m,E=l.length===1?null:t===0?`${o}-handle-${t+1}`:t===l.length-1?`${o}-handle-${t-1}`:`${o}-handle-${t-1} ${o}-handle-${t+1}`;return P("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":E,"aria-label":w.sliderValue,"aria-labelledby":c?`${o}-label-${t}`:null,"aria-orientation":a,"aria-valuemax":x.toString(),"aria-valuemin":_.toString(),"aria-valuenow":e.toString(),"aria-valuetext":T,bind:this,class:f,"data-thumb-index":t,"data-value":e,id:`${o}-handle-${t}`,key:`${o}-handle-${t}`,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:g,tabIndex:b?-1:0},P("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:Dr.thumbElement,"data-thumb-index":t,"touch-action":"none"}),this.renderThumbLabel(t))}renderThumbLabel(e){const{id:t,labels:r,labelInputsEnabled:i,state:s}=this,n=this.visibleElements.labels,o=r.values[e],a=this.classes(Dr.labelElement,n?null:Dr.hidden,i&&s!=="disabled"?Dr.labelElementInteractive:null);return P("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":(!n).toString(),bind:this,class:a,"data-thumb-index":e,key:`${t}-label-${e}`,id:`${t}-label-${e}`,role:i?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):o)}renderValueInput(e){const{disabled:t,values:r}=this,i=r[e];return P("input",{key:`value-input-${e}`,afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:Dr.labelInput,"data-input-type":"thumb","data-input-index":e,required:!0,tabIndex:t?-1:0,type:"text",value:this._formatInputValue(i,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})}renderMax(){const{_isMaxInputActive:e,labels:t,rangeLabelInputsEnabled:r,state:i}=this,s=this.visibleElements.rangeLabels,n=this.classes(Dr.maxElement,{[Dr.hidden]:!s,[Dr.maxElementInteractive]:r&&i!=="disabled",[Dr.rangeElementActive]:e});return P("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMaxLabelCreate,bind:this,class:n,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:r?"button":null,tabIndex:!this.disabled&&r?0:-1},e?this.renderMaxInput():t.max)}renderMin(){const{_isMinInputActive:e,labels:t,rangeLabelInputsEnabled:r,state:i}=this,s=this.visibleElements.rangeLabels,n=this.classes(Dr.minElement,{[Dr.hidden]:!s,[Dr.minElementInteractive]:r&&i!=="disabled",[Dr.rangeElementActive]:e});return P("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMinLabelCreate,bind:this,class:n,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:r?"button":null,tabIndex:!this.disabled&&r?0:-1},e?this.renderMinInput():t.min)}renderMaxInput(){return P("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:Dr.rangeInput,"data-input-type":"max",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})}renderMinInput(){return P("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:Dr.rangeInput,"data-input-type":"min",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})}renderExtraContentElements(){return P("div",{bind:this,class:Dr.extraContentElement},this.extraNodes)}renderTicksContainer(){if(this.tickConfigs&&this.trackElement&&(this._trackHeight!==0||this._trackWidth!==0))return this.tickConfigs.map((e,t)=>P("div",{key:"ticks-container",class:this.classes(Dr.ticksContainerElement)},this.renderTicks(e,t)))}renderTicks(e,t){const{mode:r,values:i}=e;if(this.tickElements.getItemAt(t)||this.tickElements.add(new Ge,t),r==="position"){const o=Array.isArray(i)?i:[i];return this._calculateTickPositions(o).map((a,l)=>this.renderTickGroup(e,l,t,a))}if(r==="percent"&&Array.isArray(i)){const{max:o,min:a}=this,l=o-a,c=i.map(d=>this._applyPrecisionToPosition(d/100*l+a));return this._calculateTickPositions(c).map((d,p)=>this.renderTickGroup(e,p,t,d))}const s=Array.isArray(i)&&i.length?i[0]:isNaN(i)?null:i,n=this._getTickCounts(s,e);return this._calculateEquidistantTickPositions(n).map((o,a)=>this.renderTickGroup(e,a,t,o))}renderTickGroup(e,t,r,i){const s=e.mode==="position"?Array.isArray(e.values)?e.values[t]:e.values:this._valueFromPosition(i);if(!C(s)&&!isNaN(s))return P("div",{afterCreate:this._afterTickGroupCreate,afterRemoved:this._afterTickGroupRemoved,bind:this,"data-config":e,"data-position":i,"data-tick-config-index":r,"data-tick-group-index":t,"data-value":s,onclick:this._onTickGroupClick,key:`tick-group-${t}`},this.renderTickLine(e,t,r,s),e.labelsVisible?this.renderTickLabel(e,t,r,s):null)}renderTickLine(e,t,r,i){return P("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":i.toString(),bind:this,class:Dr.tickElement,"data-config":e,"data-tick-config-index":r,"data-tick-group-index":t,"data-value":i,key:`tick-label-${t}`,style:this._getPositionStyleForElement(i)})}renderTickLabel(e,t,r,i){const s=e.labelFormatFunction?e.labelFormatFunction(i,"tick",t):this.viewModel.getLabelForValue(i,"tick",t);return P("div",{afterCreate:this._afterTickLabelCreate,"aria-label":s,"aria-valuenow":i.toString(),"aria-valuetext":s,bind:this,class:Dr.tickLabelElement,"data-config":e,"data-tick-config-index":r,"data-tick-group-index":t,"data-value":i,key:`tick-label-${t}`,style:`transform: translate(-50%); ${this._getPositionStyleForElement(i)}`},s)}_afterContainerCreate(e){this.addHandles(l7e(e,()=>this.scheduleRender()))}_afterTrackCreate(e){this._set("trackElement",e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()}_afterTrackRemoved(e){e.removeEventListener("pointerdown",this._onTrackPointerDown),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp)}_afterSegmentCreate(e){this.segmentElements.add(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)}_afterSegmentRemoved(e){this.segmentElements.remove(e),e.removeEventListener("pointerdown",this._onSegmentPointerDown)}_afterEffectiveSegmentCreate(e){this.effectiveSegmentElements.add(e)}_afterEffectiveSegmentRemoved(e){this.effectiveSegmentElements.remove(e)}_afterAnchorCreate(e){if(this._anchorElements.push(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){const t=e["data-thumb-index"],r=e["data-value"],i=this.thumbElements.getItemAt(t)||null,s=this.labelElements.getItemAt(t)||null;this.thumbCreatedFunction(t,r,i,s)}}_afterAnchorUpdate(e){v(this._focusedAnchorIndex)&&e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}_afterAnchorRemoved(e){const t=this._anchorElements.indexOf(e,0);t>-1&&this._anchorElements.splice(t,1),e.removeEventListener("pointerdown",this._onAnchorPointerDown)}_afterThumbCreate(e){this.thumbElements.add(e)}_afterThumbRemoved(e){this.thumbElements.remove(e)}_afterLabelCreate(e){this.labelElements.add(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)}_afterLabelRemoved(e){this.labelElements.remove(e),e.removeEventListener("pointerdown",this._onLabelPointerDown),e.removeEventListener("pointerup",this._onLabelPointerUp)}_afterInputCreate(e){if(e.focus(),e.select(),this.inputCreatedFunction){const t=e.getAttribute("data-input-type"),r=t==="thumb"?e["data-input-index"]:null;this.inputCreatedFunction(e,t,r)}}_afterTickLineCreate(e){const t=e["data-tick-config-index"],r=e["data-tick-group-index"],i=this.tickElements.getItemAt(t);i.getItemAt(r)?i.getItemAt(r).tickElement=e:i.add({groupElement:null,tickElement:e,labelElement:null},r)}_afterTickLabelCreate(e){const t=e["data-tick-config-index"],r=e["data-tick-group-index"],i=this.tickElements.getItemAt(t);i.getItemAt(r)?i.getItemAt(r).labelElement=e:i.add({groupElement:null,labelElement:e,tickElement:null},r)}_afterTickGroupRemoved(e){const t=e["data-tick-config-index"],r=this.tickElements.items[t],i=r==null?void 0:r.find(s=>s.groupElement===e);i&&r.remove(i)}_afterTickGroupCreate(e){var r,i;const t=e["data-config"];if(t&&t.tickCreatedFunction){const s=e["data-tick-config-index"],n=e["data-tick-group-index"],o=e["data-value"],a=(i=(r=this.tickElements)==null?void 0:r.getItemAt(s))==null?void 0:i.getItemAt(n);if(a){a.groupElement=e;const l=a.tickElement||null,c=a.labelElement||null;t.tickCreatedFunction(o,l,c)}}}_afterMaxLabelCreate(e){this._set("maxLabelElement",e)}_afterMinLabelCreate(e){this._set("minLabelElement",e)}_onAnchorKeyDown(e){if(this._isDisabled()||this.state==="editing")return;const{target:t}=e,r=Uo(e),{_anchorElements:i,values:s}=this,n=t["data-thumb-index"],o=i[n],a=s[n],l=[Hu.moveAnchorUp,Hu.moveAnchorDown,Hu.moveAnchorLeft,Hu.moveAnchorRight];if(r===Hu.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=n,this.notifyChange("state");else if(l.includes(r)){e.preventDefault();const{steps:c}=this,d=r===Hu.moveAnchorUp||r===Hu.moveAnchorRight?1:-1;if(v(c))this._toStep(n,this._isReversedLayout()?-1*d:d);else{const{precision:f}=this,m=this._getPositionOfElement(o),g=this._valueFromPosition(m),_=this._isHorizontalLayout()?d:-1*d;let x;x=f===0?this._positionFromValue(g+_):f===1?this._positionFromValue(g+.1*_):m+_,this._toPosition(n,x)}const p=this.values[n];a!==p&&this._emitThumbChangeEvent({index:n,oldValue:a,value:p})}else if(r===Hu.moveAnchorToMax||r===Hu.moveAnchorToMin){e.preventDefault();const{min:c,max:d}=this._getAnchorBoundsInPixels(n),p=this._isPositionInverted()?r===Hu.moveAnchorToMax?c:d:r===Hu.moveAnchorToMin?c:d;this._toPosition(n,p);const f=this.values[n];a!==f&&this._emitThumbChangeEvent({index:n,oldValue:a,value:f})}}_onAnchorPointerDown(e){if(this._isDisabled())return;const{target:t,clientX:r,clientY:i}=e,s=t["data-thumb-index"];s!==void 0&&(e.preventDefault(),this._anchorElements[s]&&this._anchorElements[s].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:r,clientY:i,index:s,position:this._getPositionOfElement(this._anchorElements[s])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onAnchorPointerMove(e){if(this.state==="editing"||!this._dragStartInfo)return;e.preventDefault();const{values:t,_anchorElements:r,_dragged:i,_dragStartInfo:s,_dragStartInfo:{index:n,position:o}}=this,{clientX:a,clientY:l}=e,c=i?"drag":"start",d=r[n],p=this._getPositionOfElement(d),f=this._applyPrecisionToPosition(this._isHorizontalLayout()?o+a-s.clientX:o+l-s.clientY);if(p===f)return;const m=t[n];this._dragged=!0,this._toPosition(n,f);const g=this.values[n];i?m!==g&&this._emitThumbDragEvent({index:n,state:c,value:g}):this._emitThumbDragEvent({index:n,state:c,value:m})}_onAnchorPointerUp(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),!this._dragStartInfo)return;e.preventDefault();const{index:t}=this._dragStartInfo,r=this._dragged,i=this.values[t];this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=t,this.notifyChange("state"),r?this._emitThumbDragEvent({index:t,state:"stop",value:i}):(this.scheduleRender(),this.state!=="editing"&&this._emitThumbClickEvent({index:t,value:i}))}_onTrackPointerDown(e){const{_dragStartInfo:t,snapOnClickEnabled:r,state:i,values:s}=this;if(this._isDisabled()||i==="editing"||t||(document.addEventListener("pointermove",this._onTrackPointerMove),document.addEventListener("pointerup",this._onTrackPointerUp),!r||!s.length))return;const{steps:n}=this,{clientX:o,clientY:a}=e,l=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(l),d=this._getIndexOfNearestValue(c),p=s[d],f=s.some((x,b)=>x===p&&b!==d)&&c>p?this.values.lastIndexOf(p):d;if(C(f))return;const m=s[f],g=v(n)?this._calculateNearestStepPosition(l):l;this._toPosition(f,g),this._dragged=!0,this._dragStartInfo={clientX:o,clientY:a,index:f,position:g},this._focusedAnchorIndex=f,this.notifyChange("state"),this._emitThumbDragEvent({index:f,state:"start",value:m});const _=this.values[f];m!==_&&this._emitThumbDragEvent({index:f,state:"drag",value:_}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}_onTrackPointerMove(e){e.preventDefault(),this._dragged=!0}_onTrackPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp),this.snapOnClickEnabled||(this._dragged=!1),!this._dragged){const t=this._getCursorPositionFromEvent(e),r=this._valueFromPosition(t);this._emitTrackClickEvent({value:r})}}_onSegmentPointerDown(e){var a,l;e.preventDefault();const t=e.target,r=t["data-segment-index"],i=t["data-min-thumb-index"],s=t["data-max-thumb-index"];if(this._isDisabled()||C(i)||C(s))return;e.stopPropagation(),this._storeTrackDimensions(),document.addEventListener("pointerup",this._onSegmentPointerUp);const n=this._getAnchorDetails(i),o=this._getAnchorDetails(s);this.syncedSegmentsEnabled?(this.segmentElements.forEach(c=>c.classList.add(Dr.segmentElementActive)),this._anchorElements.forEach(c=>c.classList.add(Dr.anchorElementActive))):(this.segmentElements.getItemAt(r).classList.add(Dr.segmentElementActive),(a=this._anchorElements[n.index])==null||a.classList.add(Dr.anchorElementActive),(l=this._anchorElements[o.index])==null||l.classList.add(Dr.anchorElementActive)),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:r,details:this._normalizeSegmentDetails({min:n,max:o})},this.draggableSegmentsEnabled&&(document.addEventListener("pointermove",this._onSegmentPointerMove),this.notifyChange("state"),this._emitSegmentDragEvent({index:r,state:"start",thumbIndices:[i,s]}))}_onSegmentPointerMove(e){if(!this._segmentDragStartInfo)return;e.preventDefault();const{_trackHeight:t,_trackWidth:r,_segmentDragStartInfo:{index:i,cursorPosition:s,details:{min:n,max:o}}}=this,{index:a,position:l,value:c}=n,{index:d,position:p,value:f}=o;this._dragged=!0;const m=this._getCursorPositionFromEvent(e);if(m===s)return;const g=this._positionToPercent(s),_=this._positionToPercent(m)-g,x=this._positionToPercent(l)+_,b=this._positionToPercent(p)+_,{min:w}=this._getAnchorBoundsAsPercents(a),{max:T}=this._getAnchorBoundsAsPercents(d);let E=!1,O=!1;if(x<w?E=!0:b>T&&(O=!0),E){const{min:J,max:ee}=this.viewModel.getBoundsForValueAtIndex(a),se=this._isPositionInverted()?ee:J,X=se,F=f+(se-c),N=F-this.values[d];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(N):this._updateAnchorValues([a,d],[X,F]))}if(O){const{min:J,max:ee}=this.viewModel.getBoundsForValueAtIndex(d),se=this._isPositionInverted()?J:ee,X=se,F=c+(se-f),N=F-this.values[a];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(N):this._updateAnchorValues([a,d],[F,X]))}const A=this._isHorizontalLayout()?r:t,R=b/100*A,D=x/100*A,k=this.values,L=[k[a],k[d]],q=this._getValueForAnchorAtPosition(a,D),G=this._getValueForAnchorAtPosition(d,R);this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(q-L[0]):this._updateAnchorValues([a,d],[q,G]),[this.values[a],this.values[d]].every((J,ee)=>J===L[ee])||this._emitSegmentDragEvent({index:i,state:"drag",thumbIndices:[a,d]})}_onSegmentPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),!this._segmentDragStartInfo)return;const{_dragged:t,max:r,min:i,values:s}=this,{index:n,details:{min:{index:o},max:{index:a}}}=this._segmentDragStartInfo;if(this.segmentElements.forEach(l=>l.classList.remove(Dr.segmentElementActive)),this._anchorElements.forEach(l=>l.classList.remove(Dr.anchorElementActive)),this.draggableSegmentsEnabled){const l=r-i,c=s[o],d=s[a];this._lastMovedHandleIndex=c===d?c>l/2?o:a:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:n,state:"stop",thumbIndices:[o,a]})}if(!t){const l=this._getCursorPositionFromEvent(e),c=this._valueFromPosition(l);this._emitSegmentClickEvent({index:n,value:c,thumbIndices:[o,a]})}}_onTickGroupClick(e){const t=e.target;if(t["data-config"]){const r=t["data-tick-config-index"],i=t["data-tick-group-index"],s=t["data-value"];this._emitTickClickEvent({configIndex:r,groupIndex:i,value:s})}}_storeTrackDimensions(){if(this.trackElement){const e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}}_onLabelPointerDown(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onLabelPointerMove(){this._isDisabled()||(this._dragged=!0)}_onLabelPointerUp(e){if(this._isDisabled())return;const t=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&v(t)&&(this._activeLabelInputIndex=t),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}_onLabelInputBlur(e){const{_activeLabelInputIndex:t,values:r,viewModel:i}=this,s=e.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),!s)return;const n=this._parseInputValue(s,"value",t),o=r[t],{min:a,max:l}=this.viewModel.getBoundsForValueAtIndex(t);if(n<a||n>l)return;i.setValue(t,n);const c=this.values[t];o!==c&&this._emitThumbChangeEvent({index:t,oldValue:o,value:c})}_onInputKeyDown(e){if(this._isDisabled())return;const{target:t}=e,r=Uo(e),{hideInput1:i,hideInput2:s,hideInput3:n}=Hu,{_activeLabelInputIndex:o,_anchorElements:a}=this,l=t;if(r===i||r===s||r===n){e.stopPropagation();const c=o;l.blur(),v(c)?a[c].focus():l.parentElement.focus()}}_onMaxLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"max-click",value:this.max}),this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state")))}_onMaxLabelKeyDown(e){this._isDisabled()||Uo(e)!==Hu.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))}_onMaxInputBlur(e){const t=e.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),!t)return;const r=this.max,i=this._parseInputValue(t,"max");i<=this.min||(this.viewModel.set("max",i),this.max!==r&&this._emitMaxChangeEvent({oldValue:r,value:this.max}))}_onMinLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"min-click",value:this.min}),this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state")))}_onMinLabelKeyDown(e){this._isDisabled()||Uo(e)!==Hu.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))}_onMinInputBlur(e){const t=e.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),!t)return;const r=this.min,i=this._parseInputValue(t,"min");i>=this.max||(this.viewModel.set("min",i),this.min!==r&&this._emitMinChangeEvent({oldValue:r,value:this.min}))}_isDisabled(){return this.disabled||this.state==="disabled"}_positionFromValue(e){const{max:t,min:r}=this,i=t-r;if(i===0)return 0;const{_trackHeight:s,_trackWidth:n}=this,o=this._isHorizontalLayout();let a=parseFloat(o?(n*(e-r)/i).toFixed(2):(s*(t-e)/i).toFixed(2));return this._isReversedLayout()&&(a=o?n-a:s-a),a}_valueFromPosition(e){const{_trackHeight:t,_trackWidth:r,max:i,min:s,precision:n}=this,o=i-s;let a=this._isHorizontalLayout()?e*o/r+s:o*(1e3-e/t*1e3)/1e3+s;return this._isReversedLayout()&&(a=i+s-a),parseFloat(a.toFixed(n))}_positionToPercent(e){const{_trackHeight:t,_trackWidth:r}=this,i=100*e/(this._isHorizontalLayout()?r:t);return this._applyPrecisionToPosition(i)}_applyPrecisionToPosition(e){return parseFloat(e.toFixed(this._positionPrecision))}_isPositionInverted(){const{layout:e}=this;return e==="horizontal-reversed"||e==="vertical"}_isHorizontalLayout(){return this.layout.includes("horizontal")}_isReversedLayout(){return this.layout.includes("reversed")}_normalizeSegmentDetails(e){if(this._isPositionInverted()){const{min:t,max:r}=e;return{min:r,max:t}}return e}_parseInputValue(e,t,r){return this.inputParseFunction?this.inputParseFunction(e,t,r):this.viewModel.defaultInputParseFunction(e)}_formatInputValue(e,t,r){return this.inputFormatFunction?this.inputFormatFunction(e,t,r):this.viewModel.defaultInputFormatFunction(e)}_getAnchorDetails(e){const t=[...this.values].sort((i,s)=>i-s)[e],r=this.values.indexOf(t);return{index:r,position:this._getPositionOfElement(this._anchorElements[r]),value:t}}_updateAnchorStyle(e,t){const r=this._anchorElements[e];r&&(this._isHorizontalLayout()?r.style.left=`${t}`:r.style.top=`${t}`)}_getStyleForAnchor(e,t,r){const i=this._getPositionStyleForElement(e);if(this.values.length===1)return`${i}`;const s=this._zIndices[t];return`${i}; z-index: ${r?this._zIndexOffset+s:s}`}_getPositionStyleForElement(e){const t=this._positionFromValue(e),r=this._positionToPercent(t);return`${this._isHorizontalLayout()?"left":"top"}: ${r+"%"}`}_getPositionOfElement(e){const t=this._getDimensions(e.offsetParent),r=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(r.left-t.left):this._applyPrecisionToPosition(r.top-t.top)}_updateAnchorValues(e,t){e.forEach((r,i)=>this._toValue(r,t[i]))}_updateAnchorValuesByDifference(e){const{min:t,max:r,values:i}=this;i.forEach((s,n)=>this._toValue(n,Math.max(Math.min(s+e,r),t)))}_toValue(e,t){v(this.steps)&&(t=this._getStepValues()[this._getIndexOfNearestStepValue(t)]),this._updateAnchorStyle(e,this._getPositionStyleForElement(t)),this.viewModel.setValue(e,t)}_toPosition(e,t){const r=v(this.steps)?this._getStepValueForAnchorAtPosition(e,t):this._getValueForAnchorAtPosition(e,t);this._updateAnchorStyle(e,this._getPositionStyleForElement(r)),this.viewModel.setValue(e,r)}_getValueForAnchorAtPosition(e,t){const{min:r,max:i}=this._getAnchorBoundsInPixels(e),{min:s,max:n}=this.viewModel.getBoundsForValueAtIndex(e);let o,a,l=null;return this._isPositionInverted()?(o=s,a=n):(o=n,a=s),l=t>i?o:t<r?a:this._valueFromPosition(t),l>n?l=n:l<s&&(l=s),l}_getStepValueForAnchorAtPosition(e,t){const r=this._getStepValues(),i=this._calculateNearestStepPosition(t),s=this._getValueForAnchorAtPosition(e,i);return r[this._getIndexOfNearestStepValue(s)]}_getAnchorBoundsAsPercents(e){const{min:t,max:r}=this._getAnchorBoundsInPixels(e);return{min:this._positionToPercent(t),max:this._positionToPercent(r)}}_getAnchorBoundsInPixels(e){const{_anchorElements:t,_trackHeight:r,_trackWidth:i,effectiveMax:s,effectiveMin:n,thumbsConstrained:o}=this,a=t[e-1],l=t[e+1],c=this._isHorizontalLayout()?i:r;let d,p;return this._isPositionInverted()?(d=v(n)?this._positionFromValue(n):c,p=v(s)?this._positionFromValue(s):0):(d=v(s)?this._positionFromValue(s):c,p=v(n)?this._positionFromValue(n):0),o?this._isPositionInverted()?{max:a?this._getPositionOfElement(a):d,min:l?this._getPositionOfElement(l):p}:{max:l?this._getPositionOfElement(l):d,min:a?this._getPositionOfElement(a):p}:{max:d,min:p}}_getIndexOfNearestValue(e){return this.values.indexOf(this.values.reduce((t,r)=>Math.abs(r-e)<Math.abs(t-e)?r:t))}_getCursorPositionFromEvent(e){const t=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-t.left:e.clientY-t.top}_getStepValues(){const{steps:e}=this;if(Array.isArray(e))return e;const{max:t,min:r}=this,i=Math.ceil((t-r)/e),s=[];for(let n=0;n<=i;n++){const o=r+e*n;s.push(o>t?t:o)}return s}_toStep(e,t){const{values:r,viewModel:i}=this,s=r[e],n=this._getStepValues(),o=n.indexOf(s);let a=null;if(o>-1){let l=n[o+t];isNaN(l)&&(l=n[o]);const c=this._positionFromValue(l);a=this._getStepValueForAnchorAtPosition(e,c)}else a=n[this._getIndexOfNearestStepValue(s)+t];i.setValue(e,a)}_getIndexOfNearestStepValue(e){const{steps:t}=this;if(C(t))return null;const r=this._getStepValues(),i=r.reduce((s,n)=>Math.abs(n-e)<Math.abs(s-e)?n:s);return r.indexOf(i)}_calculateNearestStepPosition(e){const t=this._valueFromPosition(e),r=this._getIndexOfNearestStepValue(t),i=this._getStepValues();return this._positionFromValue(i[r])}_getTickCounts(e,t){const{mode:r}=t;return r==="count"||r==="position"?e||0:r==="percent"&&100/e||0}_calculateTickPositions(e){return e.map(t=>this._positionFromValue(t))}_calculateEquidistantTickPositions(e){const{_trackWidth:t,_trackHeight:r}=this,i=this._isHorizontalLayout()?t:r,s=i/(e-1),n=[];if(e===1)return[i/2];for(let o=0;o<e;o++){const a=o*s;a<=i&&n.push(a)}return n}_getDimensions(e){try{return e.getBoundingClientRect()}catch(t){if(typeof t=="object"&&t!==null)return new DOMRect(0,0,0,0);throw t}}_emitTrackClickEvent(e){this.emit("track-click",{...e,type:"track-click"})}_emitTickClickEvent(e){this.emit("tick-click",{...e,type:"tick-click"})}_emitMaxChangeEvent(e){this.emit("max-change",{...e,type:"max-change"})}_emitMinChangeEvent(e){this.emit("min-change",{...e,type:"min-change"})}_emitThumbChangeEvent(e){this.emit("thumb-change",{...e,type:"thumb-change"})}_emitThumbClickEvent(e){this.emit("thumb-click",{...e,type:"thumb-click"})}_emitThumbDragEvent(e){this.emit("thumb-drag",{...e,type:"thumb-drag"})}_emitSegmentClickEvent(e){this.emit("segment-click",{...e,type:"segment-click"})}_emitSegmentDragEvent(e){this.emit("segment-drag",{...e,type:"segment-drag"})}_emitRangeLabelClickEvent(e){this.emit(e.type,{...e})}};u([h()],ri.prototype,"disabled",void 0),u([h()],ri.prototype,"draggableSegmentsEnabled",void 0),u([h()],ri.prototype,"effectiveMax",null),u([h()],ri.prototype,"effectiveMin",null),u([h({readOnly:!0})],ri.prototype,"effectiveSegmentElements",void 0),u([h()],ri.prototype,"extraNodes",void 0),u([h()],ri.prototype,"inputCreatedFunction",void 0),u([h()],ri.prototype,"inputFormatFunction",null),u([h()],ri.prototype,"inputParseFunction",null),u([h()],ri.prototype,"label",null),u([h({readOnly:!0})],ri.prototype,"labelElements",void 0),u([h()],ri.prototype,"labelInputsEnabled",void 0),u([h()],ri.prototype,"labelFormatFunction",null),u([h({readOnly:!0})],ri.prototype,"labels",null),u([h({value:"horizontal"})],ri.prototype,"layout",null),u([h()],ri.prototype,"max",null),u([h({readOnly:!0})],ri.prototype,"maxLabelElement",void 0),u([h(),xi("esri/widgets/Slider/t9n/Slider")],ri.prototype,"messages",void 0),u([h()],ri.prototype,"min",null),u([h({readOnly:!0})],ri.prototype,"minLabelElement",void 0),u([h()],ri.prototype,"precision",null),u([h()],ri.prototype,"rangeLabelInputsEnabled",void 0),u([h({readOnly:!0})],ri.prototype,"segmentElements",void 0),u([h()],ri.prototype,"snapOnClickEnabled",void 0),u([h({readOnly:!0})],ri.prototype,"state",null),u([h()],ri.prototype,"steps",void 0),u([h()],ri.prototype,"syncedSegmentsEnabled",void 0),u([h()],ri.prototype,"thumbsConstrained",null),u([h()],ri.prototype,"thumbCreatedFunction",void 0),u([h({readOnly:!0})],ri.prototype,"thumbElements",void 0),u([h()],ri.prototype,"tickConfigs",null),u([h({readOnly:!0})],ri.prototype,"tickElements",void 0),u([h({readOnly:!0})],ri.prototype,"trackElement",void 0),u([h()],ri.prototype,"values",null),u([h()],ri.prototype,"viewModel",void 0),u([h()],ri.prototype,"visibleElements",void 0),u([Gt("visibleElements")],ri.prototype,"castVisibleElements",null),ri=u([I(iNt)],ri);const sNt=ri,cc={interactive:"esri-interactive",label:"esri-slider__label",box:"esri-slider-with-dropdown__box",dropdownRoot:"esri-slider-with-dropdown__dropdown-root",anchor:" esri-widget__anchor esri-slider-with-dropdown__anchor",anchorOpen:"esri-slider-with-dropdown__anchor--open",anchorClosed:"esri-slider-with-dropdown__anchor--closed",dropdownList:"esri-slider-with-dropdown__list",dropdownListItem:"esri-slider-with-dropdown__list-item",dropdownListItemSelected:"esri-slider-with-dropdown__list-item--selected",boxDropDownOn:"esri-slider-with-dropdown__box--drop-down-on",boxDropDownOff:"esri-slider-with-dropdown__box--drop-down-off"},XU={selectItem:"Enter",closeDropdown:"Escape",moveSelectionUp:"ArrowUp",moveSelectionDown:"ArrowDown"};let Cy=class extends sNt{constructor(e,t){super(e,t),this.viewModel=new av,this.buttonTooltip="",this.showDropDown=!0,this._dropdownAnchor=null,this._dropdownElement=null,this._popover=new Qne({owner:this,placement:"bottom-start",anchorElement:()=>this._dropdownAnchor,renderContentFunction:()=>this._renderPopover()})}initialize(){this.addHandles(ie(()=>this.viewModel.isDropdownOpen,e=>{this._popover.open=e},pt))}destroy(){this._popover.destroy()}get items(){return this.viewModel.items}set items(e){this.viewModel.items=e}get currentIndex(){return this.viewModel.currentIndex}set currentIndex(e){this.viewModel.currentIndex=e}get currentItem(){return this.viewModel.currentItem}get isDropdownOpen(){return this.viewModel.isDropdownOpen}renderThumbLabel(e){const t={[cc.boxDropDownOn]:this.showDropDown,[cc.boxDropDownOff]:!this.showDropDown};return P("div",{class:this.classes(cc.box,cc.label,t)},super.renderThumbLabel(e),this.showDropDown&&P("div",{bind:this,afterCreate:this._onDropdownAnchorAfterCreate,class:cc.dropdownRoot},P("button",{class:this.classes(cc.interactive,cc.anchor,this.isDropdownOpen?cc.anchorOpen:cc.anchorClosed),bind:this,disabled:this.disabled,onclick:this._onAnchorClick,onpointerdown:this._killEvent,"aria-label":this.buttonTooltip,title:this.buttonTooltip,"aria-expanded":this.isDropdownOpen.toString(),"aria-haspopup":"listbox",type:"button"},this.currentItem?this.currentItem.name+" ":"")))}_onDropdownAnchorAfterCreate(e){this._dropdownAnchor=e}_renderPopover(){return P("ol",{role:"listbox",afterCreate:this._onDropdownAfterCreate,"aria-label":this.buttonTooltip,bind:this,class:this.classes(cc.dropdownList),tabindex:"-1",onkeydown:this._onDropdownKeyDown,onfocusout:this._onDropdownFocusOut,onpointerdown:this._killEvent},this.items.map((e,t)=>P("li",{class:t===this.currentIndex?this.classes(cc.interactive,cc.dropdownListItem,cc.dropdownListItemSelected):this.classes(cc.interactive,cc.dropdownListItem),bind:this,onclick:this._onDropdownItemClick,"data-result":t,"aria-label":e.label.join(" "),role:"option","aria-selected":(t===this.currentIndex).toString(),onkeydown:this._onLiKeyDown,tabindex:"0"},e.label.map(r=>P("span",{bind:this},r)))))}_onDropdownAfterCreate(e){var r;this._dropdownElement=e;const t=(r=e.querySelector(`.${cc.dropdownListItemSelected}`))!=null?r:e.firstChild;v(t)&&t instanceof HTMLElement&&(t.scrollIntoView(),t.focus())}_onAnchorClick(){return!this.disabled&&(this.viewModel.toggle(),!0)}_onDropdownItemClick(e){const t=e.currentTarget;this.viewModel.selectItem(t["data-result"])}_onDropdownFocusOut(e){let t=e.relatedTarget;t===null&&(t=document.activeElement),v(this._dropdownElement)&&!this._dropdownElement.contains(t)&&v(this._dropdownAnchor)&&!this._dropdownAnchor.contains(t)&&(this.viewModel.isDropdownOpen=!1)}_killEvent(e){return e.stopPropagation(),!0}_onDropdownKeyDown(e){e.stopPropagation(),Uo(e)===XU.closeDropdown&&(this.viewModel.isDropdownOpen=!1)}_onLiKeyDown(e){const t=e.target;switch(Uo(e)){case XU.moveSelectionUp:t.previousElementSibling&&t.previousElementSibling.focus();break;case XU.moveSelectionDown:t.nextElementSibling&&t.nextElementSibling.focus();break;case XU.selectItem:t.click()}}};u([h()],Cy.prototype,"viewModel",void 0),u([h()],Cy.prototype,"buttonTooltip",void 0),u([h()],Cy.prototype,"showDropDown",void 0),u([h()],Cy.prototype,"items",null),u([h()],Cy.prototype,"currentIndex",null),u([h()],Cy.prototype,"currentItem",null),u([h()],Cy.prototype,"isDropdownOpen",null),Cy=u([I("esri.widgets.Daylight.SliderWithDropdown")],Cy);const nNt=Cy;function oNt(e,t){const r=V2e(t),i=Date.now(),s=r.formatToParts(i),n=new Set;s.filter(({type:c})=>c==="literal").forEach(({value:c})=>n.add(c));let o=0;const a={};for(;s.length>0;){const{type:c,value:d}=s.shift();for(let p=0;p<d.length;p++,o++){const f=e.charAt(o);if(n.has(f)){o++;break}if(c==="literal")break;a[c]||(a[c]=[]),a[c].push(f)}}const l={};try{l.day=kY(a.day.join("")),l.month=kY(a.month.join("")),l.year=kY((a.year||a.relatedYear).join(""))}catch{throw $we(t)}if(isNaN(l.day)||isNaN(l.month)||isNaN(l.year))throw $we(t);return l}function kY(e){const t=[/٠/g,/١/g,/٢/g,/٣/g,/٤/g,/٥/g,/٦/g,/٧/g,/٨/g,/٩/g];for(let r=0;r<10;r++)e=e.replace(t[r],r.toString());return Number(e)}function $we(e){return new z(`could not parse date input, expecting the following format: ${_s(Date.now(),e)}`)}const y3={ar:6,"ar-dz":6,"ar-kw":6,"ar-ly":6,"ar-ma":1,"ar-sa":7,"ar-tn":1,bg:1,bs:1,ca:1,cs:1,da:1,de:1,"de-at":1,"de-ch":1,el:1,"en-au":1,"en-ca":7,"en-gb":1,"en-ie":1,"en-il":7,"en-in":7,"en-nz":1,"en-sg":7,es:1,"es-do":7,"es-mx":7,"es-us":7,et:1,fi:1,fr:1,"fr-ca":7,"fr-ch":1,he:7,hr:1,hu:1,id:7,it:1,"it-ch":1,ja:7,ko:7,lt:1,lv:1,nb:1,nl:1,"nl-be":1,pl:1,pt:7,"pt-br":7,ro:1,ru:1,sk:1,sl:1,sr:1,"sr-cyrl":1,sv:1,th:7,tr:1,uk:1,vi:1,"zh-cn":7,"zh-hk":7,"zh-mo":7,"zh-tw":7},aNt="Locale"in Intl&&"weekInfo"in Intl.Locale.prototype;function zke(e){if(e=e.toLowerCase(),y3[e])return y3[e];if(aNt)try{const r=new Intl.Locale(e).weekInfo.firstDay;return y3[e]=r,r}catch{}const t=NVe(e);return y3[t]?y3[t]:7}function lNt(e,t){return(t+7-zke(e))%7}class mC extends Error{}class cNt extends mC{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class uNt extends mC{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class dNt extends mC{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class tD extends mC{}class Vke extends mC{constructor(t){super(`Invalid unit ${t}`)}}class ef extends mC{}class ub extends mC{constructor(){super("Zone is an abstract class")}}const st="numeric",vg="short",Wh="long",cie={year:st,month:st,day:st},jke={year:st,month:vg,day:st},hNt={year:st,month:vg,day:st,weekday:vg},Gke={year:st,month:Wh,day:st},Hke={year:st,month:Wh,day:st,weekday:Wh},qke={hour:st,minute:st},Wke={hour:st,minute:st,second:st},Xke={hour:st,minute:st,second:st,timeZoneName:vg},Yke={hour:st,minute:st,second:st,timeZoneName:Wh},Zke={hour:st,minute:st,hourCycle:"h23"},Jke={hour:st,minute:st,second:st,hourCycle:"h23"},Kke={hour:st,minute:st,second:st,hourCycle:"h23",timeZoneName:vg},Qke={hour:st,minute:st,second:st,hourCycle:"h23",timeZoneName:Wh},eUe={year:st,month:st,day:st,hour:st,minute:st},tUe={year:st,month:st,day:st,hour:st,minute:st,second:st},rUe={year:st,month:vg,day:st,hour:st,minute:st},iUe={year:st,month:vg,day:st,hour:st,minute:st,second:st},pNt={year:st,month:vg,day:st,weekday:vg,hour:st,minute:st},sUe={year:st,month:Wh,day:st,hour:st,minute:st,timeZoneName:vg},nUe={year:st,month:Wh,day:st,hour:st,minute:st,second:st,timeZoneName:vg},oUe={year:st,month:Wh,day:st,weekday:Wh,hour:st,minute:st,timeZoneName:Wh},aUe={year:st,month:Wh,day:st,weekday:Wh,hour:st,minute:st,second:st,timeZoneName:Wh};function $i(e){return typeof e>"u"}function X2(e){return typeof e=="number"}function JG(e){return typeof e=="number"&&e%1===0}function fNt(e){return typeof e=="string"}function mNt(e){return Object.prototype.toString.call(e)==="[object Date]"}function lUe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function gNt(e){return Array.isArray(e)?e:[e]}function Dwe(e,t,r){if(e.length!==0)return e.reduce((i,s)=>{const n=[t(s),s];return i&&r(i[0],n[0])===i[0]?i:n},null)[1]}function yNt(e,t){return t.reduce((r,i)=>(r[i]=e[i],r),{})}function gI(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function vv(e,t,r){return JG(e)&&e>=t&&e<=r}function _Nt(e,t){return e-t*Math.floor(e/t)}function oa(e,t=2){const r=e<0;let i;return r?i="-"+(""+-e).padStart(t,"0"):i=(""+e).padStart(t,"0"),i}function pw(e){if(!($i(e)||e===null||e===""))return parseInt(e,10)}function VT(e){if(!($i(e)||e===null||e===""))return parseFloat(e)}function mue(e){if(!($i(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function gue(e,t,r=!1){const i=10**t;return(r?Math.trunc:Math.round)(e*i)/i}function A4(e){return e%4===0&&(e%100!==0||e%400===0)}function xL(e){return A4(e)?366:365}function h9(e,t){const r=_Nt(t-1,12)+1,i=e+(t-r)/12;return r===2?A4(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function yue(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function p9(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,r=e-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return t===4||i===3?53:52}function uie(e){return e>99?e:e>60?1900+e:2e3+e}function cUe(e,t,r,i=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(n.timeZone=i);const o={timeZoneName:t,...n},a=new Intl.DateTimeFormat(r,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function KG(e,t){let r=parseInt(e,10);Number.isNaN(r)&&(r=0);const i=parseInt(t,10)||0,s=r<0||Object.is(r,-0)?-i:i;return r*60+s}function uUe(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new ef(`Invalid unit value ${e}`);return t}function f9(e,t){const r={};for(const i in e)if(gI(e,i)){const s=e[i];if(s==null)continue;r[t(i)]=uUe(s)}return r}function TL(e,t){const r=Math.trunc(Math.abs(e/60)),i=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${oa(r,2)}:${oa(i,2)}`;case"narrow":return`${s}${r}${i>0?`:${i}`:""}`;case"techie":return`${s}${oa(r,2)}${oa(i,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function QG(e){return yNt(e,["hour","minute","second","millisecond"])}const dUe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,vNt=["January","February","March","April","May","June","July","August","September","October","November","December"],hUe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],bNt=["J","F","M","A","M","J","J","A","S","O","N","D"];function pUe(e){switch(e){case"narrow":return[...bNt];case"short":return[...hUe];case"long":return[...vNt];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const fUe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],mUe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],wNt=["M","T","W","T","F","S","S"];function gUe(e){switch(e){case"narrow":return[...wNt];case"short":return[...mUe];case"long":return[...fUe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const yUe=["AM","PM"],xNt=["Before Christ","Anno Domini"],TNt=["BC","AD"],SNt=["B","A"];function _Ue(e){switch(e){case"narrow":return[...SNt];case"short":return[...TNt];case"long":return[...xNt];default:return null}}function ENt(e){return yUe[e.hour<12?0:1]}function CNt(e,t){return gUe(t)[e.weekday-1]}function ANt(e,t){return pUe(t)[e.month-1]}function ONt(e,t){return _Ue(t)[e.year<0?0:1]}function MNt(e,t,r="always",i=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(r==="auto"&&n){const p=e==="days";switch(t){case 1:return p?"tomorrow":`next ${s[e][0]}`;case-1:return p?"yesterday":`last ${s[e][0]}`;case 0:return p?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],d=i?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${d} ago`:`in ${a} ${d}`}function Lwe(e,t){let r="";for(const i of e)i.literal?r+=i.val:r+=t(i.val);return r}const RNt={D:cie,DD:jke,DDD:Gke,DDDD:Hke,t:qke,tt:Wke,ttt:Xke,tttt:Yke,T:Zke,TT:Jke,TTT:Kke,TTTT:Qke,f:eUe,ff:rUe,fff:sUe,ffff:oUe,F:tUe,FF:iUe,FFF:nUe,FFFF:aUe};class yu{static create(t,r={}){return new yu(t,r)}static parseFormat(t){let r=null,i="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(i.length>0&&n.push({literal:s,val:i}),r=null,i="",s=!s):s||a===r?i+=a:(i.length>0&&n.push({literal:!1,val:i}),i=a,r=a)}return i.length>0&&n.push({literal:s,val:i}),n}static macroTokenToFormatOpts(t){return RNt[t]}constructor(t,r){this.opts=r,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,{...this.opts,...r}).format()}formatDateTime(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).format()}formatDateTimeParts(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).formatToParts()}resolvedOptions(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).resolvedOptions()}num(t,r=0){if(this.opts.forceSimple)return oa(t,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(t)}formatDateTimeFromString(t,r){const i=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,g)=>this.loc.extract(t,m,g),o=m=>t.isOffsetFixed&&t.offset===0&&m.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,m.format):"",a=()=>i?ENt(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>i?ANt(t,m):n(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>i?CNt(t,m):n(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),d=m=>{const g=yu.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(t,g):m},p=m=>i?ONt(t,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return d(m)}};return Lwe(yu.parseFormat(r),f)}formatDurationFromString(t,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const d=i(c);return d?this.num(l.get(d),c.length):c},n=yu.parseFormat(r),o=n.reduce((l,{literal:c,val:d})=>c?l:l.concat(d),[]),a=t.shiftTo(...o.map(i).filter(l=>l));return Lwe(n,s(a))}}class Jm{constructor(t,r){this.reason=t,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class O4{get type(){throw new ub}get name(){throw new ub}get ianaName(){return this.name}get isUniversal(){throw new ub}offsetName(t,r){throw new ub}formatOffset(t,r){throw new ub}offset(t){throw new ub}equals(t){throw new ub}get isValid(){throw new ub}}let UY=null;class eH extends O4{static get instance(){return UY===null&&(UY=new eH),UY}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:r,locale:i}){return cUe(t,r,i)}formatOffset(t,r){return TL(this.offset(t),r)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let f8={};function INt(e){return f8[e]||(f8[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),f8[e]}const PNt={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function $Nt(e,t){const r=e.format(t).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,s,n,o,a,l,c,d]=i;return[o,s,n,a,l,c,d]}function DNt(e,t){const r=e.formatToParts(t),i=[];for(let s=0;s<r.length;s++){const{type:n,value:o}=r[s],a=PNt[n];n==="era"?i[a]=o:$i(a)||(i[a]=parseInt(o,10))}return i}let YU={};class i1 extends O4{static create(t){return YU[t]||(YU[t]=new i1(t)),YU[t]}static resetCache(){YU={},f8={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super(),this.zoneName=t,this.valid=i1.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:r,locale:i}){return cUe(t,r,i,this.name)}formatOffset(t,r){return TL(this.offset(t),r)}offset(t){const r=new Date(t);if(isNaN(r))return NaN;const i=INt(this.name);let[s,n,o,a,l,c,d]=i.formatToParts?DNt(i,r):$Nt(i,r);a==="BC"&&(s=-Math.abs(s)+1);const f=yue({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:d,millisecond:0});let m=+r;const g=m%1e3;return m-=g>=0?g:1e3+g,(f-m)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let BY=null;class xu extends O4{static get utcInstance(){return BY===null&&(BY=new xu(0)),BY}static instance(t){return t===0?xu.utcInstance:new xu(t)}static parseSpecifier(t){if(t){const r=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new xu(KG(r[1],r[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${TL(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${TL(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,r){return TL(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class LNt extends O4{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Sw(e,t){if($i(e)||e===null)return t;if(e instanceof O4)return e;if(fNt(e)){const r=e.toLowerCase();return r==="default"?t:r==="local"||r==="system"?eH.instance:r==="utc"||r==="gmt"?xu.utcInstance:xu.parseSpecifier(r)||i1.create(e)}else return X2(e)?xu.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new LNt(e)}let Nwe=()=>Date.now(),Fwe="system",kwe=null,Uwe=null,Bwe=null,zwe;class Da{static get now(){return Nwe}static set now(t){Nwe=t}static set defaultZone(t){Fwe=t}static get defaultZone(){return Sw(Fwe,eH.instance)}static get defaultLocale(){return kwe}static set defaultLocale(t){kwe=t}static get defaultNumberingSystem(){return Uwe}static set defaultNumberingSystem(t){Uwe=t}static get defaultOutputCalendar(){return Bwe}static set defaultOutputCalendar(t){Bwe=t}static get throwOnInvalid(){return zwe}static set throwOnInvalid(t){zwe=t}static resetCaches(){Cn.resetCache(),i1.resetCache()}}let Vwe={};function NNt(e,t={}){const r=JSON.stringify([e,t]);let i=Vwe[r];return i||(i=new Intl.ListFormat(e,t),Vwe[r]=i),i}let die={};function hie(e,t={}){const r=JSON.stringify([e,t]);let i=die[r];return i||(i=new Intl.DateTimeFormat(e,t),die[r]=i),i}let pie={};function FNt(e,t={}){const r=JSON.stringify([e,t]);let i=pie[r];return i||(i=new Intl.NumberFormat(e,t),pie[r]=i),i}let fie={};function kNt(e,t={}){const{base:r,...i}=t,s=JSON.stringify([e,i]);let n=fie[s];return n||(n=new Intl.RelativeTimeFormat(e,t),fie[s]=n),n}let rD=null;function UNt(){return rD||(rD=new Intl.DateTimeFormat().resolvedOptions().locale,rD)}function BNt(e){const t=e.indexOf("-u-");if(t===-1)return[e];{let r;const i=e.substring(0,t);try{r=hie(e).resolvedOptions()}catch{r=hie(i).resolvedOptions()}const{numberingSystem:s,calendar:n}=r;return[i,s,n]}}function zNt(e,t,r){return(r||t)&&(e+="-u",r&&(e+=`-ca-${r}`),t&&(e+=`-nu-${t}`)),e}function VNt(e){const t=[];for(let r=1;r<=12;r++){const i=Kt.utc(2016,r,1);t.push(e(i))}return t}function jNt(e){const t=[];for(let r=1;r<=7;r++){const i=Kt.utc(2016,11,13+r);t.push(e(i))}return t}function ZU(e,t,r,i,s){const n=e.listingMode(r);return n==="error"?null:n==="en"?i(t):s(t)}function GNt(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class HNt{constructor(t,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:s,floor:n,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=FNt(t,a)}}format(t){if(this.inf){const r=this.floor?Math.floor(t):t;return this.inf.format(r)}else{const r=this.floor?Math.floor(t):gue(t,3);return oa(r,this.padTo)}}}class qNt{constructor(t,r,i){this.opts=i;let s;if(t.zone.isUniversal){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&i1.create(a).valid?(s=a,this.dt=t):(s="UTC",i.timeZoneName?this.dt=t:this.dt=t.offset===0?t:Kt.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n={...this.opts};s&&(n.timeZone=s),this.dtf=hie(r,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class WNt{constructor(t,r,i){this.opts={style:"long",...i},!r&&lUe()&&(this.rtf=kNt(t,i))}format(t,r){return this.rtf?this.rtf.format(t,r):MNt(r,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,r){return this.rtf?this.rtf.formatToParts(t,r):[]}}class Cn{static fromOpts(t){return Cn.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,r,i,s=!1){const n=t||Da.defaultLocale,o=n||(s?"en-US":UNt()),a=r||Da.defaultNumberingSystem,l=i||Da.defaultOutputCalendar;return new Cn(o,a,l,n)}static resetCache(){rD=null,die={},pie={},fie={}}static fromObject({locale:t,numberingSystem:r,outputCalendar:i}={}){return Cn.create(t,r,i)}constructor(t,r,i,s){const[n,o,a]=BNt(t);this.locale=n,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=zNt(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=GNt(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&r?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:Cn.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,r=!1,i=!0){return ZU(this,t,i,pUe,()=>{const s=r?{month:t,day:"numeric"}:{month:t},n=r?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=VNt(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,r=!1,i=!0){return ZU(this,t,i,gUe,()=>{const s=r?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=r?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=jNt(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return ZU(this,void 0,t,()=>yUe,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Kt.utc(2016,11,13,9),Kt.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(t,r=!0){return ZU(this,t,r,_Ue,()=>{const i={era:t};return this.eraCache[t]||(this.eraCache[t]=[Kt.utc(-40,1,1),Kt.utc(2017,1,1)].map(s=>this.extract(s,i,"era"))),this.eraCache[t]})}extract(t,r,i){const s=this.dtFormatter(t,r),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(t={}){return new HNt(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,r={}){return new qNt(t,this.intl,r)}relFormatter(t={}){return new WNt(this.intl,this.isEnglish(),t)}listFormatter(t={}){return NNt(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function qI(...e){const t=e.reduce((r,i)=>r+i.source,"");return RegExp(`^${t}$`)}function WI(...e){return t=>e.reduce(([r,i,s],n)=>{const[o,a,l]=n(t,s);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function XI(e,...t){if(e==null)return[null,null];for(const[r,i]of t){const s=r.exec(e);if(s)return i(s)}return[null,null]}function vUe(...e){return(t,r)=>{const i={};let s;for(s=0;s<e.length;s++)i[e[s]]=pw(t[r+s]);return[i,null,r+s]}}const bUe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,XNt=`(?:${bUe.source}?(?:\\[(${dUe.source})\\])?)?`,_ue=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,wUe=RegExp(`${_ue.source}${XNt}`),vue=RegExp(`(?:T${wUe.source})?`),YNt=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,ZNt=/(\d{4})-?W(\d\d)(?:-?(\d))?/,JNt=/(\d{4})-?(\d{3})/,KNt=vUe("weekYear","weekNumber","weekDay"),QNt=vUe("year","ordinal"),eFt=/(\d{4})-(\d\d)-(\d\d)/,xUe=RegExp(`${_ue.source} ?(?:${bUe.source}|(${dUe.source}))?`),tFt=RegExp(`(?: ${xUe.source})?`);function KM(e,t,r){const i=e[t];return $i(i)?r:pw(i)}function rFt(e,t){return[{year:KM(e,t),month:KM(e,t+1,1),day:KM(e,t+2,1)},null,t+3]}function YI(e,t){return[{hours:KM(e,t,0),minutes:KM(e,t+1,0),seconds:KM(e,t+2,0),milliseconds:mue(e[t+3])},null,t+4]}function M4(e,t){const r=!e[t]&&!e[t+1],i=KG(e[t+1],e[t+2]),s=r?null:xu.instance(i);return[{},s,t+3]}function R4(e,t){const r=e[t]?i1.create(e[t]):null;return[{},r,t+1]}const iFt=RegExp(`^T?${_ue.source}$`),sFt=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function nFt(e){const[t,r,i,s,n,o,a,l,c]=e,d=t[0]==="-",p=l&&l[0]==="-",f=(m,g=!1)=>m!==void 0&&(g||m&&d)?-m:m;return[{years:f(VT(r)),months:f(VT(i)),weeks:f(VT(s)),days:f(VT(n)),hours:f(VT(o)),minutes:f(VT(a)),seconds:f(VT(l),l==="-0"),milliseconds:f(mue(c),p)}]}const oFt={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function bue(e,t,r,i,s,n,o){const a={year:t.length===2?uie(pw(t)):pw(t),month:hUe.indexOf(r)+1,day:pw(i),hour:pw(s),minute:pw(n)};return o&&(a.second=pw(o)),e&&(a.weekday=e.length>3?fUe.indexOf(e)+1:mUe.indexOf(e)+1),a}const aFt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function lFt(e){const[,t,r,i,s,n,o,a,l,c,d,p]=e,f=bue(t,s,i,r,n,o,a);let m;return l?m=oFt[l]:c?m=0:m=KG(d,p),[f,new xu(m)]}function cFt(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const uFt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,dFt=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,hFt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function jwe(e){const[,t,r,i,s,n,o,a]=e;return[bue(t,s,i,r,n,o,a),xu.utcInstance]}function pFt(e){const[,t,r,i,s,n,o,a]=e;return[bue(t,a,r,i,s,n,o),xu.utcInstance]}const fFt=qI(YNt,vue),mFt=qI(ZNt,vue),gFt=qI(JNt,vue),yFt=qI(wUe),TUe=WI(rFt,YI,M4,R4),_Ft=WI(KNt,YI,M4,R4),vFt=WI(QNt,YI,M4,R4),bFt=WI(YI,M4,R4);function wFt(e){return XI(e,[fFt,TUe],[mFt,_Ft],[gFt,vFt],[yFt,bFt])}function xFt(e){return XI(cFt(e),[aFt,lFt])}function TFt(e){return XI(e,[uFt,jwe],[dFt,jwe],[hFt,pFt])}function SFt(e){return XI(e,[sFt,nFt])}const EFt=WI(YI);function CFt(e){return XI(e,[iFt,EFt])}const AFt=qI(eFt,tFt),OFt=qI(xUe),MFt=WI(YI,M4,R4);function RFt(e){return XI(e,[AFt,TUe],[OFt,MFt])}const IFt="Invalid Duration",SUe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},PFt={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...SUe},bp=146097/400,TA=146097/4800,$Ft={years:{quarters:4,months:12,weeks:bp/7,days:bp,hours:bp*24,minutes:bp*24*60,seconds:bp*24*60*60,milliseconds:bp*24*60*60*1e3},quarters:{months:3,weeks:bp/28,days:bp/4,hours:bp*24/4,minutes:bp*24*60/4,seconds:bp*24*60*60/4,milliseconds:bp*24*60*60*1e3/4},months:{weeks:TA/7,days:TA,hours:TA*24,minutes:TA*24*60,seconds:TA*24*60*60,milliseconds:TA*24*60*60*1e3},...SUe},qS=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],DFt=qS.slice(0).reverse();function jT(e,t,r=!1){const i={values:r?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new ji(i)}function LFt(e){return e<0?Math.floor(e):Math.ceil(e)}function EUe(e,t,r,i,s){const n=e[s][r],o=t[r]/n,a=Math.sign(o)===Math.sign(i[s]),l=!a&&i[s]!==0&&Math.abs(o)<=1?LFt(o):Math.trunc(o);i[s]+=l,t[r]-=l*n}function NFt(e,t){DFt.reduce((r,i)=>$i(t[i])?r:(r&&EUe(e,t,r,t,i),i),null)}class ji{constructor(t){const r=t.conversionAccuracy==="longterm"||!1;let i=r?$Ft:PFt;t.matrix&&(i=t.matrix),this.values=t.values,this.loc=t.loc||Cn.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(t,r){return ji.fromObject({milliseconds:t},r)}static fromObject(t,r={}){if(t==null||typeof t!="object")throw new ef(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new ji({values:f9(t,ji.normalizeUnit),loc:Cn.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(t){if(X2(t))return ji.fromMillis(t);if(ji.isDuration(t))return t;if(typeof t=="object")return ji.fromObject(t);throw new ef(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,r){const[i]=SFt(t);return i?ji.fromObject(i,r):ji.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,r){const[i]=CFt(t);return i?ji.fromObject(i,r):ji.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,r=null){if(!t)throw new ef("need to specify a reason the Duration is invalid");const i=t instanceof Jm?t:new Jm(t,r);if(Da.throwOnInvalid)throw new dNt(i);return new ji({invalid:i})}static normalizeUnit(t){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!r)throw new Vke(t);return r}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?yu.create(this.loc,i).formatDurationFromString(this,t):IFt}toHuman(t={}){const r=qS.map(i=>{const s=this.values[i];return $i(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:i.slice(0,-1)}).format(s)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=gue(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||i.milliseconds!==0)&&(s+=".SSS"));let n=i.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const r=ji.fromDurationLike(t),i={};for(const s of qS)(gI(r.values,s)||gI(this.values,s))&&(i[s]=r.get(s)+this.get(s));return jT(this,{values:i},!0)}minus(t){if(!this.isValid)return this;const r=ji.fromDurationLike(t);return this.plus(r.negate())}mapUnits(t){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=uUe(t(this.values[i],i));return jT(this,{values:r},!0)}get(t){return this[ji.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const r={...this.values,...f9(t,ji.normalizeUnit)};return jT(this,{values:r})}reconfigure({locale:t,numberingSystem:r,conversionAccuracy:i,matrix:s}={}){const o={loc:this.loc.clone({locale:t,numberingSystem:r}),matrix:s,conversionAccuracy:i};return jT(this,o)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return NFt(this.matrix,t),jT(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>ji.normalizeUnit(o));const r={},i={},s=this.toObject();let n;for(const o of qS)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;X2(s[o])&&(a+=s[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in s)qS.indexOf(c)>qS.indexOf(o)&&EUe(this.matrix,s,c,r,o)}else X2(s[o])&&(i[o]=s[o]);for(const o in i)i[o]!==0&&(r[n]+=o===n?i[o]:i[o]/this.matrix[n][o]);return jT(this,{values:r},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const r of Object.keys(this.values))t[r]=this.values[r]===0?0:-this.values[r];return jT(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function r(i,s){return i===void 0||i===0?s===void 0||s===0:i===s}for(const i of qS)if(!r(this.values[i],t.values[i]))return!1;return!0}}const _3="Invalid Interval";function FFt(e,t){return!e||!e.isValid?Zn.invalid("missing or invalid start"):!t||!t.isValid?Zn.invalid("missing or invalid end"):t<e?Zn.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class Zn{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,r=null){if(!t)throw new ef("need to specify a reason the Interval is invalid");const i=t instanceof Jm?t:new Jm(t,r);if(Da.throwOnInvalid)throw new uNt(i);return new Zn({invalid:i})}static fromDateTimes(t,r){const i=w3(t),s=w3(r),n=FFt(i,s);return n==null?new Zn({start:i,end:s}):n}static after(t,r){const i=ji.fromDurationLike(r),s=w3(t);return Zn.fromDateTimes(s,s.plus(i))}static before(t,r){const i=ji.fromDurationLike(r),s=w3(t);return Zn.fromDateTimes(s.minus(i),s)}static fromISO(t,r){const[i,s]=(t||"").split("/",2);if(i&&s){let n,o;try{n=Kt.fromISO(i,r),o=n.isValid}catch{o=!1}let a,l;try{a=Kt.fromISO(s,r),l=a.isValid}catch{l=!1}if(o&&l)return Zn.fromDateTimes(n,a);if(o){const c=ji.fromISO(s,r);if(c.isValid)return Zn.after(n,c)}else if(l){const c=ji.fromISO(i,r);if(c.isValid)return Zn.before(a,c)}}return Zn.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(t),i=this.end.startOf(t);return Math.floor(i.diff(r,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:r}={}){return this.isValid?Zn.fromDateTimes(t||this.s,r||this.e):this}splitAt(...t){if(!this.isValid)return[];const r=t.map(w3).filter(o=>this.contains(o)).sort(),i=[];let{s}=this,n=0;for(;s<this.e;){const o=r[n]||this.e,a=+o>+this.e?this.e:o;i.push(Zn.fromDateTimes(s,a)),s=a,n+=1}return i}splitBy(t){const r=ji.fromDurationLike(t);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,s=1,n;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Zn.fromDateTimes(i,n)),i=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const r=this.s>t.s?this.s:t.s,i=this.e<t.e?this.e:t.e;return r>=i?null:Zn.fromDateTimes(r,i)}union(t){if(!this.isValid)return this;const r=this.s<t.s?this.s:t.s,i=this.e>t.e?this.e:t.e;return Zn.fromDateTimes(r,i)}static merge(t){const[r,i]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return i&&r.push(i),r}static xor(t){let r=null,i=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&s.push(Zn.fromDateTimes(r,l.time)),r=null);return Zn.merge(s)}difference(...t){return Zn.xor([this].concat(t)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:_3}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:_3}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:_3}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:_3}toFormat(t,{separator:r=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${r}${this.e.toFormat(t)}`:_3}toDuration(t,r){return this.isValid?this.e.diff(this.s,t,r):ji.invalid(this.invalidReason)}mapEndpoints(t){return Zn.fromDateTimes(t(this.s),t(this.e))}}class iD{static hasDST(t=Da.defaultZone){const r=Kt.now().setZone(t).set({month:12});return!t.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(t){return i1.isValidZone(t)}static normalizeZone(t){return Sw(t,Da.defaultZone)}static months(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Cn.create(r,i,n)).months(t)}static monthsFormat(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Cn.create(r,i,n)).months(t,!0)}static weekdays(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Cn.create(r,i,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:r=null,numberingSystem:i=null,locObj:s=null}={}){return(s||Cn.create(r,i,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return Cn.create(t).meridiems()}static eras(t="short",{locale:r=null}={}){return Cn.create(r,null,"gregory").eras(t)}static features(){return{relative:lUe()}}}function Gwe(e,t){const r=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(t)-r(e);return Math.floor(ji.fromMillis(i).as("days"))}function kFt(e,t,r){const i=[["years",(a,l)=>l.year-a.year],["quarters",(a,l)=>l.quarter-a.quarter+(l.year-a.year)*4],["months",(a,l)=>l.month-a.month+(l.year-a.year)*12],["weeks",(a,l)=>{const c=Gwe(a,l);return(c-c%7)/7}],["days",Gwe]],s={};let n,o;for(const[a,l]of i)if(r.indexOf(a)>=0){n=a;let c=l(e,t);o=e.plus({[a]:c}),o>t?(e=e.plus({[a]:c-1}),c-=1):e=o,s[a]=c}return[e,s,o,n]}function UFt(e,t,r,i){let[s,n,o,a]=kFt(e,t,r);const l=t-s,c=r.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const d=ji.fromObject(n,i);return c.length>0?ji.fromMillis(l,i).shiftTo(...c).plus(d):d}const wue={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},Hwe={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},BFt=wue.hanidec.replace(/[\[|\]]/g,"").split("");function zFt(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);if(e[r].search(wue.hanidec)!==-1)t+=BFt.indexOf(e[r]);else for(const s in Hwe){const[n,o]=Hwe[s];i>=n&&i<=o&&(t+=i-n)}}return parseInt(t,10)}else return t}function Xf({numberingSystem:e},t=""){return new RegExp(`${wue[e||"latn"]}${t}`)}const VFt="missing Intl.DateTimeFormat.formatToParts support";function os(e,t=r=>r){return{regex:e,deser:([r])=>t(zFt(r))}}const jFt=String.fromCharCode(160),CUe=`[ ${jFt}]`,AUe=new RegExp(CUe,"g");function GFt(e){return e.replace(/\./g,"\\.?").replace(AUe,CUe)}function qwe(e){return e.replace(/\./g,"").replace(AUe," ").toLowerCase()}function Yf(e,t){return e===null?null:{regex:RegExp(e.map(GFt).join("|")),deser:([r])=>e.findIndex(i=>qwe(r)===qwe(i))+t}}function Wwe(e,t){return{regex:e,deser:([,r,i])=>KG(r,i),groups:t}}function zY(e){return{regex:e,deser:([t])=>t}}function HFt(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function qFt(e,t){const r=Xf(t),i=Xf(t,"{2}"),s=Xf(t,"{3}"),n=Xf(t,"{4}"),o=Xf(t,"{6}"),a=Xf(t,"{1,2}"),l=Xf(t,"{1,3}"),c=Xf(t,"{1,6}"),d=Xf(t,"{1,9}"),p=Xf(t,"{2,4}"),f=Xf(t,"{4,6}"),m=x=>({regex:RegExp(HFt(x.val)),deser:([b])=>b,literal:!0}),_=(x=>{if(e.literal)return m(x);switch(x.val){case"G":return Yf(t.eras("short",!1),0);case"GG":return Yf(t.eras("long",!1),0);case"y":return os(c);case"yy":return os(p,uie);case"yyyy":return os(n);case"yyyyy":return os(f);case"yyyyyy":return os(o);case"M":return os(a);case"MM":return os(i);case"MMM":return Yf(t.months("short",!0,!1),1);case"MMMM":return Yf(t.months("long",!0,!1),1);case"L":return os(a);case"LL":return os(i);case"LLL":return Yf(t.months("short",!1,!1),1);case"LLLL":return Yf(t.months("long",!1,!1),1);case"d":return os(a);case"dd":return os(i);case"o":return os(l);case"ooo":return os(s);case"HH":return os(i);case"H":return os(a);case"hh":return os(i);case"h":return os(a);case"mm":return os(i);case"m":return os(a);case"q":return os(a);case"qq":return os(i);case"s":return os(a);case"ss":return os(i);case"S":return os(l);case"SSS":return os(s);case"u":return zY(d);case"uu":return zY(a);case"uuu":return os(r);case"a":return Yf(t.meridiems(),0);case"kkkk":return os(n);case"kk":return os(p,uie);case"W":return os(a);case"WW":return os(i);case"E":case"c":return os(r);case"EEE":return Yf(t.weekdays("short",!1,!1),1);case"EEEE":return Yf(t.weekdays("long",!1,!1),1);case"ccc":return Yf(t.weekdays("short",!0,!1),1);case"cccc":return Yf(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Wwe(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return Wwe(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return zY(/[a-z_+-/]{1,256}?/i);default:return m(x)}})(e)||{invalidReason:VFt};return _.token=e,_}const WFt={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function XFt(e,t,r){const{type:i,value:s}=e;if(i==="literal")return{literal:!0,val:s};const n=r[i];let o=WFt[i];if(typeof o=="object"&&(o=o[n]),o)return{literal:!1,val:o}}function YFt(e){return[`^${e.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,e]}function ZFt(e,t,r){const i=e.match(t);if(i){const s={};let n=1;for(const o in r)if(gI(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(i.slice(n,n+l))),n+=l}return[i,s]}else return[i,{}]}function JFt(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return $i(e.z)||(r=i1.create(e.z)),$i(e.Z)||(r||(r=new xu(e.Z)),i=e.Z),$i(e.q)||(e.M=(e.q-1)*3+1),$i(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),$i(e.u)||(e.S=mue(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),r,i]}let VY=null;function KFt(){return VY||(VY=Kt.fromMillis(1555555555555)),VY}function QFt(e,t){if(e.literal)return e;const r=yu.macroTokenToFormatOpts(e.val),i=RUe(r,t);return i==null||i.includes(void 0)?e:i}function OUe(e,t){return Array.prototype.concat(...e.map(r=>QFt(r,t)))}function MUe(e,t,r){const i=OUe(yu.parseFormat(r),e),s=i.map(o=>qFt(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:i,invalidReason:n.invalidReason};{const[o,a]=YFt(s),l=RegExp(o,"i"),[c,d]=ZFt(t,l,a),[p,f,m]=d?JFt(d):[null,null,void 0];if(gI(d,"a")&&gI(d,"H"))throw new tD("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:i,regex:l,rawMatches:c,matches:d,result:p,zone:f,specificOffset:m}}}function e4t(e,t,r){const{result:i,zone:s,specificOffset:n,invalidReason:o}=MUe(e,t,r);return[i,s,n,o]}function RUe(e,t){return e?yu.create(t,e).formatDateTimeParts(KFt()).map(s=>XFt(s,t,e)):null}const IUe=[0,31,59,90,120,151,181,212,243,273,304,334],PUe=[0,31,60,91,121,152,182,213,244,274,305,335];function cf(e,t){return new Jm("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function $Ue(e,t,r){const i=new Date(Date.UTC(e,t-1,r));e<100&&e>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const s=i.getUTCDay();return s===0?7:s}function DUe(e,t,r){return r+(A4(e)?PUe:IUe)[t-1]}function LUe(e,t){const r=A4(e)?PUe:IUe,i=r.findIndex(n=>n<t),s=t-r[i];return{month:i+1,day:s}}function mie(e){const{year:t,month:r,day:i}=e,s=DUe(t,r,i),n=$Ue(t,r,i);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=p9(a)):o>p9(t)?(a=t+1,o=1):a=t,{weekYear:a,weekNumber:o,weekday:n,...QG(e)}}function Xwe(e){const{weekYear:t,weekNumber:r,weekday:i}=e,s=$Ue(t,1,4),n=xL(t);let o=r*7+i-s-3,a;o<1?(a=t-1,o+=xL(a)):o>n?(a=t+1,o-=xL(t)):a=t;const{month:l,day:c}=LUe(a,o);return{year:a,month:l,day:c,...QG(e)}}function jY(e){const{year:t,month:r,day:i}=e,s=DUe(t,r,i);return{year:t,ordinal:s,...QG(e)}}function Ywe(e){const{year:t,ordinal:r}=e,{month:i,day:s}=LUe(t,r);return{year:t,month:i,day:s,...QG(e)}}function t4t(e){const t=JG(e.weekYear),r=vv(e.weekNumber,1,p9(e.weekYear)),i=vv(e.weekday,1,7);return t?r?i?!1:cf("weekday",e.weekday):cf("week",e.week):cf("weekYear",e.weekYear)}function r4t(e){const t=JG(e.year),r=vv(e.ordinal,1,xL(e.year));return t?r?!1:cf("ordinal",e.ordinal):cf("year",e.year)}function NUe(e){const t=JG(e.year),r=vv(e.month,1,12),i=vv(e.day,1,h9(e.year,e.month));return t?r?i?!1:cf("day",e.day):cf("month",e.month):cf("year",e.year)}function FUe(e){const{hour:t,minute:r,second:i,millisecond:s}=e,n=vv(t,0,23)||t===24&&r===0&&i===0&&s===0,o=vv(r,0,59),a=vv(i,0,59),l=vv(s,0,999);return n?o?a?l?!1:cf("millisecond",s):cf("second",i):cf("minute",r):cf("hour",t)}const GY="Invalid DateTime",Zwe=864e13;function JU(e){return new Jm("unsupported zone",`the zone "${e.name}" is not supported`)}function HY(e){return e.weekData===null&&(e.weekData=mie(e.c)),e.weekData}function v3(e,t){const r={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new Kt({...r,...t,old:r})}function kUe(e,t,r){let i=e-t*60*1e3;const s=r.offset(i);if(t===s)return[i,t];i-=(s-t)*60*1e3;const n=r.offset(i);return s===n?[i,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function Jwe(e,t){e+=t*60*1e3;const r=new Date(e);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function m8(e,t,r){return kUe(yue(e),t,r)}function Kwe(e,t){const r=e.o,i=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n={...e.c,year:i,month:s,day:Math.min(e.c.day,h9(i,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7},o=ji.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=yue(n);let[l,c]=kUe(a,r,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function b3(e,t,r,i,s,n){const{setZone:o,zone:a}=r;if(e&&Object.keys(e).length!==0){const l=t||a,c=Kt.fromObject(e,{...r,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return Kt.invalid(new Jm("unparsable",`the input "${s}" can't be parsed as ${i}`))}function KU(e,t,r=!0){return e.isValid?yu.create(Cn.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(e,t):null}function qY(e,t){const r=e.c.year>9999||e.c.year<0;let i="";return r&&e.c.year>=0&&(i+="+"),i+=oa(e.c.year,r?6:4),t?(i+="-",i+=oa(e.c.month),i+="-",i+=oa(e.c.day)):(i+=oa(e.c.month),i+=oa(e.c.day)),i}function Qwe(e,t,r,i,s,n){let o=oa(e.c.hour);return t?(o+=":",o+=oa(e.c.minute),(e.c.second!==0||!r)&&(o+=":")):o+=oa(e.c.minute),(e.c.second!==0||!r)&&(o+=oa(e.c.second),(e.c.millisecond!==0||!i)&&(o+=".",o+=oa(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!n?o+="Z":e.o<0?(o+="-",o+=oa(Math.trunc(-e.o/60)),o+=":",o+=oa(Math.trunc(-e.o%60))):(o+="+",o+=oa(Math.trunc(e.o/60)),o+=":",o+=oa(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}const UUe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},i4t={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},s4t={ordinal:1,hour:0,minute:0,second:0,millisecond:0},BUe=["year","month","day","hour","minute","second","millisecond"],n4t=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],o4t=["year","ordinal","hour","minute","second","millisecond"];function exe(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new Vke(e);return t}function txe(e,t){const r=Sw(t.zone,Da.defaultZone),i=Cn.fromObject(t),s=Da.now();let n,o;if($i(e.year))n=s;else{for(const c of BUe)$i(e[c])&&(e[c]=UUe[c]);const a=NUe(e)||FUe(e);if(a)return Kt.invalid(a);const l=r.offset(s);[n,o]=m8(e,l,r)}return new Kt({ts:n,zone:r,loc:i,o})}function rxe(e,t,r){const i=$i(r.round)?!0:r.round,s=(o,a)=>(o=gue(o,i||r.calendary?0:2,!0),t.loc.clone(r).relFormatter(r).format(o,a)),n=o=>r.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(r.unit)return s(n(r.unit),r.unit);for(const o of r.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,r.units[r.units.length-1])}function ixe(e){let t={},r;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],r=Array.from(e).slice(0,e.length-1)):r=Array.from(e),[t,r]}class Kt{constructor(t){const r=t.zone||Da.defaultZone;let i=t.invalid||(Number.isNaN(t.ts)?new Jm("invalid input"):null)||(r.isValid?null:JU(r));this.ts=$i(t.ts)?Da.now():t.ts;let s=null,n=null;if(!i)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(r))[s,n]=[t.old.c,t.old.o];else{const a=r.offset(this.ts);s=Jwe(this.ts,a),i=Number.isNaN(s.year)?new Jm("invalid input"):null,s=i?null:s,n=i?null:a}this._zone=r,this.loc=t.loc||Cn.create(),this.invalid=i,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Kt({})}static local(){const[t,r]=ixe(arguments),[i,s,n,o,a,l,c]=r;return txe({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,r]=ixe(arguments),[i,s,n,o,a,l,c]=r;return t.zone=xu.utcInstance,txe({year:i,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,r={}){const i=mNt(t)?t.valueOf():NaN;if(Number.isNaN(i))return Kt.invalid("invalid input");const s=Sw(r.zone,Da.defaultZone);return s.isValid?new Kt({ts:i,zone:s,loc:Cn.fromObject(r)}):Kt.invalid(JU(s))}static fromMillis(t,r={}){if(X2(t))return t<-Zwe||t>Zwe?Kt.invalid("Timestamp out of range"):new Kt({ts:t,zone:Sw(r.zone,Da.defaultZone),loc:Cn.fromObject(r)});throw new ef(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,r={}){if(X2(t))return new Kt({ts:t*1e3,zone:Sw(r.zone,Da.defaultZone),loc:Cn.fromObject(r)});throw new ef("fromSeconds requires a numerical input")}static fromObject(t,r={}){t=t||{};const i=Sw(r.zone,Da.defaultZone);if(!i.isValid)return Kt.invalid(JU(i));const s=Da.now(),n=$i(r.specificOffset)?i.offset(s):r.specificOffset,o=f9(t,exe),a=!$i(o.ordinal),l=!$i(o.year),c=!$i(o.month)||!$i(o.day),d=l||c,p=o.weekYear||o.weekNumber,f=Cn.fromObject(r);if((d||a)&&p)throw new tD("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new tD("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!d;let g,_,x=Jwe(s,n);m?(g=n4t,_=i4t,x=mie(x)):a?(g=o4t,_=s4t,x=jY(x)):(g=BUe,_=UUe);let b=!1;for(const D of g){const k=o[D];$i(k)?b?o[D]=_[D]:o[D]=x[D]:b=!0}const w=m?t4t(o):a?r4t(o):NUe(o),T=w||FUe(o);if(T)return Kt.invalid(T);const E=m?Xwe(o):a?Ywe(o):o,[O,A]=m8(E,n,i),R=new Kt({ts:O,zone:i,o:A,loc:f});return o.weekday&&d&&t.weekday!==R.weekday?Kt.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${R.toISO()}`):R}static fromISO(t,r={}){const[i,s]=wFt(t);return b3(i,s,r,"ISO 8601",t)}static fromRFC2822(t,r={}){const[i,s]=xFt(t);return b3(i,s,r,"RFC 2822",t)}static fromHTTP(t,r={}){const[i,s]=TFt(t);return b3(i,s,r,"HTTP",r)}static fromFormat(t,r,i={}){if($i(t)||$i(r))throw new ef("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=i,o=Cn.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,d]=e4t(o,t,r);return d?Kt.invalid(d):b3(a,l,i,`format ${r}`,t,c)}static fromString(t,r,i={}){return Kt.fromFormat(t,r,i)}static fromSQL(t,r={}){const[i,s]=RFt(t);return b3(i,s,r,"SQL",t)}static invalid(t,r=null){if(!t)throw new ef("need to specify a reason the DateTime is invalid");const i=t instanceof Jm?t:new Jm(t,r);if(Da.throwOnInvalid)throw new cNt(i);return new Kt({invalid:i})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}static parseFormatForOpts(t,r={}){const i=RUe(t,Cn.fromObject(r));return i?i.map(s=>s?s.val:null).join(""):null}static expandFormat(t,r={}){return OUe(yu.parseFormat(t),Cn.fromObject(r)).map(s=>s.val).join("")}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?HY(this).weekYear:NaN}get weekNumber(){return this.isValid?HY(this).weekNumber:NaN}get weekday(){return this.isValid?HY(this).weekday:NaN}get ordinal(){return this.isValid?jY(this.c).ordinal:NaN}get monthShort(){return this.isValid?iD.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?iD.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?iD.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?iD.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return A4(this.year)}get daysInMonth(){return h9(this.year,this.month)}get daysInYear(){return this.isValid?xL(this.year):NaN}get weeksInWeekYear(){return this.isValid?p9(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:r,numberingSystem:i,calendar:s}=yu.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:s}}toUTC(t=0,r={}){return this.setZone(xu.instance(t),r)}toLocal(){return this.setZone(Da.defaultZone)}setZone(t,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(t=Sw(t,Da.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(r||i){const n=t.offset(this.ts),o=this.toObject();[s]=m8(o,n,t)}return v3(this,{ts:s,zone:t})}else return Kt.invalid(JU(t))}reconfigure({locale:t,numberingSystem:r,outputCalendar:i}={}){const s=this.loc.clone({locale:t,numberingSystem:r,outputCalendar:i});return v3(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const r=f9(t,exe),i=!$i(r.weekYear)||!$i(r.weekNumber)||!$i(r.weekday),s=!$i(r.ordinal),n=!$i(r.year),o=!$i(r.month)||!$i(r.day),a=n||o,l=r.weekYear||r.weekNumber;if((a||s)&&l)throw new tD("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new tD("Can't mix ordinal dates with month/day");let c;i?c=Xwe({...mie(this.c),...r}):$i(r.ordinal)?(c={...this.toObject(),...r},$i(r.day)&&(c.day=Math.min(h9(c.year,c.month),c.day))):c=Ywe({...jY(this.c),...r});const[d,p]=m8(c,this.o,this.zone);return v3(this,{ts:d,o:p})}plus(t){if(!this.isValid)return this;const r=ji.fromDurationLike(t);return v3(this,Kwe(this,r))}minus(t){if(!this.isValid)return this;const r=ji.fromDurationLike(t).negate();return v3(this,Kwe(this,r))}startOf(t){if(!this.isValid)return this;const r={},i=ji.normalizeUnit(t);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const s=Math.ceil(this.month/3);r.month=(s-1)*3+1}return this.set(r)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,r={}){return this.isValid?yu.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,t):GY}toLocaleString(t=cie,r={}){return this.isValid?yu.create(this.loc.clone(r),t).formatDateTime(this):GY}toLocaleParts(t={}){return this.isValid?yu.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=t==="extended";let a=qY(this,o);return a+="T",a+=Qwe(this,o,r,i,s,n),a}toISODate({format:t="extended"}={}){return this.isValid?qY(this,t==="extended"):null}toISOWeekDate(){return KU(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Qwe(this,o==="extended",r,t,i,n):null}toRFC2822(){return KU(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return KU(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?qY(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let s="HH:mm:ss.SSS";return(r||t)&&(i&&(s+=" "),r?s+="z":t&&(s+="ZZ")),KU(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():GY}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const r={...this.c};return t.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,r="milliseconds",i={}){if(!this.isValid||!t.isValid)return ji.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...i},n=gNt(r).map(ji.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=UFt(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",r={}){return this.diff(Kt.now(),t,r)}until(t){return this.isValid?Zn.fromDateTimes(this,t):this}hasSame(t,r){if(!this.isValid)return!1;const i=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(r)<=i&&i<=s.endOf(r)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const r=t.base||Kt.fromObject({},{zone:this.zone}),i=t.padding?this<r?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),rxe(r,this.plus(i),{...t,numeric:"always",units:s,unit:n})}toRelativeCalendar(t={}){return this.isValid?rxe(t.base||Kt.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(Kt.isDateTime))throw new ef("min requires all arguments be DateTimes");return Dwe(t,r=>r.valueOf(),Math.min)}static max(...t){if(!t.every(Kt.isDateTime))throw new ef("max requires all arguments be DateTimes");return Dwe(t,r=>r.valueOf(),Math.max)}static fromFormatExplain(t,r,i={}){const{locale:s=null,numberingSystem:n=null}=i,o=Cn.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return MUe(o,t,r)}static fromStringExplain(t,r,i={}){return Kt.fromFormatExplain(t,r,i)}static get DATE_SHORT(){return cie}static get DATE_MED(){return jke}static get DATE_MED_WITH_WEEKDAY(){return hNt}static get DATE_FULL(){return Gke}static get DATE_HUGE(){return Hke}static get TIME_SIMPLE(){return qke}static get TIME_WITH_SECONDS(){return Wke}static get TIME_WITH_SHORT_OFFSET(){return Xke}static get TIME_WITH_LONG_OFFSET(){return Yke}static get TIME_24_SIMPLE(){return Zke}static get TIME_24_WITH_SECONDS(){return Jke}static get TIME_24_WITH_SHORT_OFFSET(){return Kke}static get TIME_24_WITH_LONG_OFFSET(){return Qke}static get DATETIME_SHORT(){return eUe}static get DATETIME_SHORT_WITH_SECONDS(){return tUe}static get DATETIME_MED(){return rUe}static get DATETIME_MED_WITH_SECONDS(){return iUe}static get DATETIME_MED_WITH_WEEKDAY(){return pNt}static get DATETIME_FULL(){return sUe}static get DATETIME_FULL_WITH_SECONDS(){return nUe}static get DATETIME_HUGE(){return oUe}static get DATETIME_HUGE_WITH_SECONDS(){return aUe}}function w3(e){if(Kt.isDateTime(e))return e;if(e&&e.valueOf&&X2(e.valueOf()))return Kt.fromJSDate(e);if(e&&typeof e=="object")return Kt.fromObject(e);throw new ef(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const yi={base:"esri-date-picker",datePicker:"esri-date-picker__calendar",monthPicker:"esri-date-picker__month-picker",dayPicker:"esri-date-picker__day-picker",week:"esri-date-picker__week-item",nearbyMonth:"esri-date-picker__day-item--nearby-month",activeDay:"esri-date-picker__day-item--active",today:"esri-date-picker__day-item--today",selectedDay:"esri-date-picker__day-item--selected",day:"esri-date-picker__day-item",dayHeader:"esri-date-picker__day-item--header",yearPicker:"esri-date-picker__year-picker",selectedYear:"esri-date-picker__year-picker-item--selected",year:"esri-date-picker__year-picker-item",monthDropdown:"esri-date-picker__month-dropdown",date:"esri-date-picker__date",datePickerToggle:"esri-date-picker__calendar-toggle",dateInput:"esri-date-picker__input",dateTextInput:"esri-date-picker__text-input",leadingIcon:"esri-date-picker__icon--leading",previousIcon:"esri-icon-left",nextIcon:"esri-icon-right",calendarIcon:"esri-icon-calendar",widget:"esri-widget",button:"esri-widget--button",input:"esri-input",select:"esri-select"},SA={year:"numeric",month:"2-digit",day:"2-digit"},a4t=[" ","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Enter","Home","PageDown","PageUp"];let ah=class extends Ss{constructor(e,t){super(e,t),this._activeDate=null,this._calendarNode=null,this._calendarPopover=new Qne({owner:this,placement:"bottom-start",anchorElement:()=>this._rootNode,renderContentFunction:this._renderCalendar}),this._inputOrButtonNode=null,this._isOpen=!1,this._requestDayPickerFocusOnCreate=!1,this._rootNode=null,this.dateInputEnabled=!1,this.messages=null,this.commitOnMonthChange=!1,this.viewModel=new ZG,this.disabled=!1,this._toggle=this._toggle.bind(this)}initialize(){this.addHandles(ie(()=>{var e;return{viewModel:this.viewModel,value:(e=this.viewModel)==null?void 0:e.value}},({viewModel:e,value:t})=>{this.destroyed||!e||C(this.onChange)||this.onChange(t)},bi))}destroy(){this._calendarPopover.destroy()}get value(){return this.viewModel.value}set value(e){this.viewModel.value=e}render(){return P("div",{afterCreate:af,bind:this,class:this.classes(yi.base,yi.widget),"data-node-ref":"_rootNode"},this.dateInputEnabled?this.renderInputAndButtonMode():this.renderButtonOnlyMode())}renderButtonOnlyMode(){const e=_s(this.viewModel.value,SA),{disabled:t,_isOpen:r,messages:i}=this;return P("div",{key:`date-button-${t}`,afterCreate:af,"aria-controls":r?this._getCalendarId():null,"aria-expanded":r.toString(),"aria-haspopup":"true","aria-label":i.setDate,"aria-pressed":r.toString(),bind:this,class:this.classes(yi.button,yi.select,yi.datePickerToggle),"data-node-ref":"_inputOrButtonNode",onclick:this._toggle,onkeydown:this._handleDateButtonKeyDown,role:"button",tabIndex:t?null:0},P("span",{class:yi.date},e))}renderInputAndButtonMode(){const e=_s(this.viewModel.value,SA),{_isOpen:t,messages:r}=this;return P("div",{class:this.classes(yi.dateInput)},P("input",{afterCreate:af,"data-node-ref":"_inputOrButtonNode","aria-controls":t?this._getCalendarId():null,"aria-haspopup":"true","aria-label":r.setDate,bind:this,class:this.classes(yi.dateTextInput,yi.input),key:"date-input",onblur:this._handleDateInputBlur,onclick:this._handleDateInputClick,onkeydown:this._handleDateInputKeyDown,type:"text",value:e}),P("span",{"aria-hidden":"true",class:this.classes(yi.leadingIcon,yi.calendarIcon)}))}_handleDateInputClick(){this._open(this.viewModel.value,!1)}_handleDateInputKeyDown(e){const{key:t}=e;this._isOpen?t==="Enter"?this._handleDateText(e):t==="Escape"&&this._close():t==="ArrowDown"&&(this._open(this.viewModel.value),e.preventDefault())}_handleDateButtonKeyDown(e){const{key:t,shiftKey:r}=e;this._isOpen&&t==="Tab"&&r?this._close():Ow(t)&&this._toggle()}_handleDateInputBlur(e){this._isOpen||this._handleDateText(e)}_handleDateText(e){const t=e.currentTarget;let r;try{r=oNt(t.value,SA)}catch(s){return te.getLogger(this.declaredClass).warn(s),void(t.value=_s(this.viewModel.value,SA))}const i=Kt.fromObject(r);i.isValid?(this.viewModel.value=i.toJSDate(),this._activeDate=i):t.value=_s(this.viewModel.value,SA)}_handleDatePickerKeydown(e){Uo(e)==="Escape"&&(this._close(),e.preventDefault(),e.stopPropagation())}_renderCalendar(){const e=this._activeDate,t=Kt.fromJSDate(this.viewModel.value);return P("div",{afterCreate:af,bind:this,class:this.classes(yi.datePicker,yi.widget),"data-node-ref":"_calendarNode",id:this._getCalendarId(),key:"esri-date-picker__calendar",onkeydown:this._handleDatePickerKeydown},this._renderMonthPicker(e),this._renderDayPicker(e,t),this._renderYearPicker(e))}_getCalendarId(){return`date-picker__calendar--${this.id}`}_renderMonthPicker(e){const t=Fh(this.container),r=t?yi.nextIcon:yi.previousIcon,i=t?yi.previousIcon:yi.nextIcon,s=iD.months("long",{locale:fl()}).map((a,l)=>{const c=e.month-1===l;return P("option",{selected:c,value:l.toString()},a)}),{disabled:n,messages:o}=this;return P("div",{class:yi.monthPicker},P("div",{key:`previous-month-${n}`,"aria-label":o.goToPreviousMonth,bind:this,class:yi.button,onclick:this._setPreviousMonth,onkeydown:this._handlePreviousMonthKeyDown,role:"button",tabIndex:n?null:0,title:o.goToPreviousMonth},P("span",{"aria-hidden":"true",class:r})),P("select",{"aria-live":"assertive","aria-label":o.selectMonth,bind:this,class:this.classes(yi.monthDropdown,yi.select),disabled:n,id:`${this.id}__month-picker`,onchange:this._setMonth,onkeydown:this._setMonth,title:o.selectMonth},s),P("div",{key:`next-month-${n}`,"aria-label":o.goToNextMonth,bind:this,class:yi.button,onclick:this._setNextMonth,onkeydown:this._setNextMonth,role:"button",tabIndex:n?null:0,title:o.goToNextMonth},P("span",{"aria-hidden":"true",class:i})))}_renderDayPicker(e,t){const r=this._getWeekLabels(),i=this._getDayId(e),s=this._renderMonth(e,t),{id:n,disabled:o}=this;return P("div",{key:`day-picker-${o}`,afterCreate:this._handleDayPickerCreate,"aria-activedescendant":i,"aria-labelledby":`${n}__month-picker ${n}__selected-year`,bind:this,class:yi.dayPicker,id:`${n}__day-picker`,onkeydown:this._handleDayPickerKeydown,role:"grid",tabIndex:o?null:0},P("div",{class:yi.week,role:"row"},r.map(a=>P("div",{"aria-label":a.name,class:this.classes(yi.day,yi.dayHeader),role:"columnheader",title:a.name},a.abbr))),s)}_getDayId(e){return`${this.id}__${_s(e.valueOf(),SA)}`}_handleDayPickerCreate(e){this._requestDayPickerFocusOnCreate&&(this._requestDayPickerFocusOnCreate=!1,e.focus())}_getWeekLabels(){const e=[],t={weekday:"long"},r={weekday:"narrow"};let i=Kt.now().set({weekday:zke(fl())});for(let s=0;s<7;s++)e.push({name:_s(i.valueOf(),t),abbr:_s(i.valueOf(),r)}),i=i.plus({day:1});return e}_handleDayPickerKeydown(e){const{ctrlKey:t,shiftKey:r}=e,i=Uo(e);if(!a4t.includes(i))return;let s=this._activeDate;if(i==="ArrowLeft")s=s.minus({day:1});else if(i==="ArrowRight")s=s.plus({day:1});else if(i==="ArrowUp")s=s.minus({week:1});else if(i==="ArrowDown")s=s.plus({week:1});else if(i==="PageUp"){const n=r?"year":"month";s=s.minus({[n]:1})}else if(i==="PageDown"){const n=r?"year":"month";s=s.plus({[n]:1})}else if(i==="Home"){const n=t?"year":"month";s=s.startOf(n)}else if(i==="End"){const n=t?"year":"month";s=s.endOf(n)}else Ow(i)&&(this.viewModel.value=s.toJSDate(),this._close());this._activeDate=s,e.preventDefault(),e.stopPropagation()}_renderMonth(e,t){const r=Kt.now(),i=e.startOf("month"),s=e.endOf("month"),n=6,o=7;let a=i.minus({day:lNt(fl(),i.weekday)});const l=[];for(let c=0;c<n;c++){const d=[];for(let p=0;p<o;p++){const f=a.day,m=a.hasSame(e,"day"),g=a.hasSame(t,"day"),_=this._getDayId(a),x=Zn.fromDateTimes(i,s),b={[yi.nearbyMonth]:!x.contains(a),[yi.today]:a.hasSame(r,"day"),[yi.activeDay]:m,[yi.selectedDay]:g};d.push(P("div",{"aria-label":f.toString(),"aria-selected":m.toString(),bind:this,class:this.classes(yi.day,b),"data-iso-date":a.toISO(),id:_,onclick:this._handleSelectedDate,onkeydown:this._handleSelectedDate,role:"gridcell"},f)),a=a.plus({day:1})}l.push(P("div",{class:yi.week,role:"row"},d))}return l}_renderYearPicker(e){const t={year:"numeric"},r=e,i=_s(r.valueOf(),t),s=_s(r.plus({year:1}).valueOf(),t),n=_s(r.minus({year:1}).valueOf(),t),{disabled:o,messages:a}=this;return P("div",{class:yi.yearPicker},P("div",{key:`previous-year-${o}`,"aria-label":a.goToPreviousYear,bind:this,class:yi.year,onclick:this._setPreviousYear,onkeydown:this._setPreviousYear,tabIndex:o?null:0,title:a.goToPreviousYear},n),P("div",{class:this.classes(yi.year,yi.selectedYear),id:`${this.id}__selected-year`},i),P("div",{key:`next-year-${o}`,"aria-label":a.goToNextYear,bind:this,class:yi.year,onclick:this._setNextYear,onkeydown:this._handleNextYearKeyDown,tabIndex:o?null:0,title:a.goToNextYear},s))}_toggle(){this._isOpen?this._close():this._open(this.viewModel.value)}_setMonth(e){const t=e.target,r=Number(t.value)+1;this._activeDate=this._activeDate.set({month:r}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_close(e=!0){this._activeDate=null,this._isOpen=!1,this._calendarPopover.open=!1,this._pageClickHandler.pause(),e&&this._inputOrButtonNode.focus()}_open(e,t=!0){this._activeDate=Kt.fromJSDate(e),this._isOpen=!0,this._calendarPopover.open=!0,this._requestDayPickerFocusOnCreate=t,this._pageClickHandler||(this._pageClickHandler=O3(document,"click",({target:r})=>{var i,s;((i=this._calendarNode)==null?void 0:i.contains(r))||((s=this._rootNode)==null?void 0:s.contains(r))||this._close()}),this.addHandles(this._pageClickHandler)),this._pageClickHandler.resume()}_setPreviousMonth(){this._activeDate=this._activeDate.minus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_handlePreviousMonthKeyDown(e){if(e.key==="Tab"&&e.shiftKey)return e.preventDefault(),void this._close();Ow(e.key)&&this._setPreviousMonth()}_setNextMonth(){this._activeDate=this._activeDate.plus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_setPreviousYear(){this._activeDate=this._activeDate.minus({year:1})}_setNextYear(){this._activeDate=this._activeDate.plus({year:1})}_handleNextYearKeyDown(e){if(e.key==="Tab"&&!e.shiftKey)return e.preventDefault(),void this._close();Ow(e.key)&&this._setNextYear()}_handleSelectedDate(e){const t=e.target;this.viewModel.value=Kt.fromISO(t.getAttribute("data-iso-date")).toJSDate(),this._close()}};u([h()],ah.prototype,"dateInputEnabled",void 0),u([h(),xi("esri/widgets/support/t9n/DatePicker")],ah.prototype,"messages",void 0),u([h()],ah.prototype,"value",null),u([h()],ah.prototype,"commitOnMonthChange",void 0),u([h({type:ZG})],ah.prototype,"viewModel",void 0),u([h()],ah.prototype,"onChange",void 0),u([h()],ah.prototype,"disabled",void 0),u([An()],ah.prototype,"_setNextMonth",null),u([An()],ah.prototype,"_setPreviousYear",null),u([An()],ah.prototype,"_handleSelectedDate",null),ah=u([I("esri.widgets.support.DatePicker")],ah);const zUe=ah,sxe=/(.*)\s(.*)/,gie="date",nxe="esri.widgets.Daylight";let Ia=class extends Ss{constructor(e,t){super(e,t),this.headingLevel=3,this.iconClass=_n.widgetIcon,this.viewModel=new Uke,this.visibleElements=new Bke,this.dateOrSeason=gie,this._timeSlider=new nNt({viewModel:this.viewModel.timeSliderViewModel,steps:this.timeSliderSteps,labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:this._onPrimaryTickCreated.bind(this)},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:this._onSecondaryTickCreated.bind(this)}],items:[]}),this._datePicker=new zUe({viewModel:this.viewModel.datePickerViewModel,commitOnMonthChange:!0}),this._onPlayDayClick=()=>{this.viewModel.toggleDayPlaying()},this._onYearPlayClick=()=>{this.viewModel.toggleYearPlaying()},this._onSeasonChange=r=>{const i=r.target;this.viewModel.currentSeason=i.value},this._onSunLightingCheckboxChange=()=>{this.viewModel.toggleSunLightingEnabled()},this._onShadowCheckboxChange=()=>{this.viewModel.toggleDirectShadowsEnabled()}}get gmtOffsets(){return qi(this.timezoneMessages,rNt)}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.title)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get playSpeedMultiplier(){return this.viewModel.playSpeedMultiplier}set playSpeedMultiplier(e){this.viewModel.playSpeedMultiplier=e}get timeSliderSteps(){var e,t;return(t=(e=this._timeSlider)==null?void 0:e.steps)!=null?t:5}set timeSliderSteps(e){this._timeSlider.steps=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get _useAmPm(){const e=this._timeSlider.viewModel.getLabelForValue(0,"tick");return sxe.test(e)}get _labelAlignmentClass(){var i,s;const e=(s=(i=this.viewModel.timeSliderViewModel.values)==null?void 0:i[0])!=null?s:0,t=60*(this._useAmPm?4:3),r=60*(this._useAmPm?21:21.5);return e<t?_n.sliderAlignLeft:e>r?_n.sliderAlignRight:null}postInitialize(){this.viewModel.isSupported&&this.addHandles([ie(()=>this.viewModel.datePickerViewModel,e=>this._datePicker.viewModel=e,Qi),ie(()=>this.viewModel.timeSliderViewModel,e=>this._timeSlider.viewModel=e,Qi),ie(()=>this.timezoneMessages.chooseTimezone,e=>this._timeSlider.buttonTooltip=e,Qi),ie(()=>{var e;return(e=this.visibleElements)==null?void 0:e.timezone},e=>this._timeSlider.showDropDown=e,Qi),ie(()=>!this.viewModel.sunLightingEnabled,e=>{this._datePicker.disabled=e,this._timeSlider.disabled=e},Qi),no(()=>this.gmtOffsets,e=>{this._timeSlider.items=e.map(t=>({utcOffset:t.utcOffset,name:t.short,label:[t.shortWithUTC,t.long]}))},Qi),ie(()=>[this.viewModel.utcOffset,this.gmtOffsets],()=>this._onUTCOffsetChange(),Qi)])}destroy(){this._datePicker.destroy(),this._timeSlider.destroy()}render(){const{messages:e,viewModel:t,visibleElements:r}=this,i=t.isSupported;return P("div",{class:this.classes(_n.base,_n.widget)},i?P(A6,null,r.header&&P(Sh,{level:this.headingLevel},e.title),this._renderTimeOptions(),r.datePicker&&this._renderDateOrSeason(),r.sunLightingToggle&&this._renderSunLightingToggle(),r.shadowsToggle&&this._renderShadowsToggle()):P("div",{key:"unsupported",class:_n.panelError},P("p",null,e.unsupported)))}loadDependencies(){return Promise.all([re(()=>import("./calcite-button.40667b5c.js"),["assets/calcite-button.40667b5c.js","assets/label2.941e96ef.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js","assets/form.5aa109f5.js","assets/icon.1cb7558b.js","assets/loader.4ea8c9eb.js","assets/guid.ae96513b.js"]),re(()=>import("./calcite-checkbox.0d7e1346.js"),["assets/calcite-checkbox.0d7e1346.js","assets/guid.ae96513b.js","assets/form.5aa109f5.js","assets/label2.941e96ef.js","assets/interactive.d71a7a54.js","assets/key.eb5605f7.js"]),re(()=>import("./calcite-label.95079e09.js"),["assets/calcite-label.95079e09.js","assets/label2.941e96ef.js"])])}_renderTimeOptions(){const{viewModel:e,visibleElements:t,messages:r}=this,{directShadowsEnabled:i,dayPlaying:s}=e,n=!e.sunLightingEnabled;return P("div",{class:this.classes(_n.dayContainer,this._labelAlignmentClass,{[_n.shadowOn]:i,[_n.shadowOff]:!i,[_n.sliderDateOn]:t.datePicker,[_n.sliderDateOff]:!t.datePicker,[_n.sliderAmPmOn]:this._useAmPm,[_n.containerDisabled]:n}),key:"daylight-time-options"},this._timeSlider.render(),t.playButtons&&this._renderPlayPauseButton({playing:s,disabled:n,label:r.playDay,onClick:this._onPlayDayClick}))}_renderDateOptions(){const{viewModel:e,visibleElements:t,messages:r}=this,{yearPlaying:i}=e,s=!e.sunLightingEnabled;return P("div",{key:"daylight-date-options",class:this.classes(_n.dateContainer,s&&_n.containerDisabled)},this._datePicker.render(),t.playButtons&&this._renderPlayPauseButton({playing:i,disabled:s,label:r.playYear,onClick:this._onYearPlayClick}))}_renderPlayPauseButton({playing:e,disabled:t,label:r,onClick:i}){return P("calcite-button",{appearance:"solid",class:_n.playPauseButton,disabled:t,"icon-start":e?"pause-f":"play-f",label:r,round:!0,title:r,type:"button",onclick:i})}_renderSeasonOptions(){const{messages:e,viewModel:t}=this,r=!t.sunLightingEnabled;return P("select",{class:this.classes(_n.select,_n.seasonPicker,r&&_n.seasonPickerDisabled),disabled:r,value:t.currentSeason,"aria-label":e.season,onchange:this._onSeasonChange},aie.map(i=>P("option",{value:i},e[i])))}_renderDateOrSeason(){return this.dateOrSeason==="date"?this._renderDateOptions():this._renderSeasonOptions()}_renderSunLightingToggle(){var t;const e=(t=this.messages)==null?void 0:t.sunLightingToggle;return P("calcite-label",{key:"date-time-toggle",layout:"inline",title:e==null?void 0:e.tooltip,scale:"s"},P("calcite-checkbox",{class:_n.sunLightingCheckbox,checked:this.viewModel.sunLightingEnabled,onCalciteCheckboxChange:this._onSunLightingCheckboxChange}),e==null?void 0:e.label)}_renderShadowsToggle(){const e=this.messages.shadowsToggle;return P("calcite-label",{key:"shadow-toggle",layout:"inline",title:e==null?void 0:e.tooltip,scale:"s"},P("calcite-checkbox",{class:_n.shadowsCheckbox,checked:this.viewModel.directShadowsEnabled,onCalciteCheckboxChange:this._onShadowCheckboxChange}),e.label)}_onUTCOffsetChange(){var s;const e=this.viewModel.utcOffset,t=(s=this._timeSlider.currentItem)==null?void 0:s.utcOffset,r=this.gmtOffsets;if(C(r)||t===e)return;const i=r.findIndex(({utcOffset:n})=>n===e);i>-1&&(this._timeSlider.currentIndex=i)}_onPrimaryTickCreated(e,t,r){t.classList.add(...WY,_n.primaryTick),r.classList.add(...WY,_n.primaryTickLabel),r.onclick=t.onclick=this._makeGoToTime(e);const i=sxe.exec(r.textContent);i&&(r.innerHTML=`${i[1]}<br><div class=${_n.primaryTickAmPm}>${i[2]}</div>`)}_onSecondaryTickCreated(e,t){t.classList.add(...WY,_n.secondaryTick),t.onclick=this._makeGoToTime(e)}_makeGoToTime(e){return()=>{this.viewModel.timeSliderPosition=e}}};u([h({readOnly:!0})],Ia.prototype,"gmtOffsets",null),u([h(),xi("esri/widgets/Daylight/t9n/Daylight")],Ia.prototype,"messages",void 0),u([h(),xi("esri/widgets/support/t9n/timezone")],Ia.prototype,"timezoneMessages",void 0),u([h()],Ia.prototype,"headingLevel",void 0),u([h()],Ia.prototype,"iconClass",void 0),u([h()],Ia.prototype,"label",null),u([h()],Ia.prototype,"playSpeedMultiplier",null),u([h()],Ia.prototype,"timeSliderSteps",null),u([h()],Ia.prototype,"view",null),u([h({type:Uke})],Ia.prototype,"viewModel",void 0),u([h({type:Bke,nonNullable:!0})],Ia.prototype,"visibleElements",void 0),u([h({cast:e=>e==="season"||e==="date"?e:(te.getLogger(nxe).warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "${gie}".`),gie)})],Ia.prototype,"dateOrSeason",void 0),u([h()],Ia.prototype,"_timeSlider",void 0),u([h()],Ia.prototype,"_useAmPm",null),u([h()],Ia.prototype,"_labelAlignmentClass",null),u([h()],Ia.prototype,"_datePicker",void 0),Ia=u([I(nxe)],Ia);const WY=["esri-interactive","esri-widget__anchor"],l4t=Ia,c4t={readOnly:!0,get(){return $Je(this.view)}},VUe=Br()({esriCentimeters:"centimeters",esriDecimalDegrees:"decimal-degrees",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriPoints:"points",esriUnknownUnits:"unknown",esriYards:"yards"}),xue=Br()({esriNAUCentimeters:"centimeters",esriNAUDecimalDegrees:"decimal-degrees",esriNAUDecimeters:"decimeters",esriNAUFeet:"feet",esriNAUInches:"inches",esriNAUKilometers:"kilometers",esriNAUMeters:"meters",esriNAUMiles:"miles",esriNAUMillimeters:"millimeters",esriNAUNauticalMiles:"nautical-miles",esriNAUPoints:"points",esriNAUYards:"yards"}),u4t=Br()({esriNAUDays:"days",esriNAUHours:"hours",esriNAUMinutes:"minutes",esriNAUSeconds:"seconds"}),d4t=Br()({esriDOTComplete:"complete",esriDOTCompleteNoEvents:"complete-no-events",esriDOTFeatureSets:"featuresets",esriDOTInstructionsOnly:"instructions-only",esriDOTStandard:"standard",esriDOTSummaryOnly:"summary-only"}),h4t=Br()({esriNAOutputLineNone:"none",esriNAOutputLineStraight:"straight",esriNAOutputLineTrueShape:"true-shape",esriNAOutputLineTrueShapeWithMeasure:"true-shape-with-measure"});Br()({esriNAOutputPolygonNone:"none",esriNAOutputPolygonSimplified:"simplified",esriNAOutputPolygonDetailed:"detailed"});const jUe=Br()({esriNFSBAllowBacktrack:"allow-backtrack",esriNFSBAtDeadEndsOnly:"at-dead-ends-only",esriNFSBNoBacktrack:"no-backtrack",esriNFSBAtDeadEndsAndIntersections:"at-dead-ends-and-intersections"});Br()({esriNATravelDirectionFromFacility:"from-facility",esriNATravelDirectionToFacility:"to-facility"});Br()({esriNATimeOfDayNotUsed:"not-used",esriNATimeOfDayUseAsStartTime:"start",esriNATimeOfDayUseAsEndTime:"end"});const p4t=Br()({AUTOMOBILE:"automobile",TRUCK:"truck",WALK:"walk",OTHER:"other"}),Rl=Br()({0:"either-side-of-vehicle",1:"right-side-of-vehicle",2:"left-side-of-vehicle",3:"no-u-turn"},{useNumericKeys:!0}),SL=Br()({0:"stop",1:"waypoint",2:"break"},{useNumericKeys:!0}),jx=Br()({0:"ok",1:"not-located",2:"network-element-not-located",3:"element-not-traversable",4:"invalid-field-values",5:"not-reached",6:"time-window-violation",7:"not-located-on-closest"},{useNumericKeys:!0}),m9=Br()({1:"right",2:"left"},{useNumericKeys:!0}),Nd=Br()({0:"restriction",1:"added-cost"},{useNumericKeys:!0}),EL=Br()({0:"permit",1:"restrict"},{useNumericKeys:!0}),g9=Br()({1:"header",50:"arrive",51:"depart",52:"straight",100:"on-ferry",101:"off-ferry",102:"central-fork",103:"roundabout",104:"u-turn",150:"door",151:"stairs",152:"elevator",153:"escalator",154:"pedestrian-ramp",200:"left-fork",201:"left-ramp",202:"clockwise-roundabout",203:"left-handed-u-turn",204:"bear-left",205:"left-turn",206:"sharp-left",207:"left-turn-and-immediate-left-turn",208:"left-turn-and-immediate-right-turn",300:"right-fork",301:"right-ramp",302:"counter-clockwise-roundabout",303:"right-handed-u-turn",304:"bear-right",305:"right-turn",306:"sharp-right",307:"right-turn-and-immediate-left-turn",308:"right-turn-and-immediate-right-turn",400:"up-elevator",401:"up-escalator",402:"up-stairs",500:"down-elevator",501:"down-escalator",502:"down-stairs",1e3:"general-event",1001:"landmark",1002:"time-zone-change",1003:"traffic-event",1004:"scaled-cost-barrier-event",1005:"boundary-crossing",1006:"restriction-violation"},{useNumericKeys:!0}),y9=Br()({0:"unknown",1:"segment",2:"maneuver-segment",3:"restriction-violation",4:"scaled-cost-barrier",5:"heavy-traffic",6:"slow-traffic",7:"moderate-traffic"},{useNumericKeys:!0}),f4t=Br()({"NA Campus":"campus","NA Desktop":"desktop","NA Navigation":"navigation"}),m4t=Br()({Kilometers:"kilometers",Miles:"miles",Meters:"meters"},{ignoreUnknown:!1}),tH=Br()({Minutes:"minutes",TimeAt1KPH:"time-at-1-kph",TravelTime:"travel-time",TruckMinutes:"truck-minutes",TruckTravelTime:"truck-travel-time",WalkTime:"walk-time"},{ignoreUnknown:!1}),Bd=Br()({Kilometers:"kilometers",Miles:"miles",Meters:"meters",Minutes:"minutes",TimeAt1KPH:"time-at-1-kph",TravelTime:"travel-time",TruckMinutes:"truck-minutes",TruckTravelTime:"truck-travel-time",WalkTime:"walk-time"},{ignoreUnknown:!1}),_9=Br()({"Any Hazmat Prohibited":"any-hazmat-prohibited","Avoid Carpool Roads":"avoid-carpool-roads","Avoid Express Lanes":"avoid-express-lanes","Avoid Ferries":"avoid-ferries","Avoid Gates":"avoid-gates","Avoid Limited Access Roads":"avoid-limited-access-roads","Avoid Private Roads":"avoid-private-roads","Avoid Roads Unsuitable for Pedestrians":"avoid-roads-unsuitable-for-pedestrians","Avoid Stairways":"avoid-stairways","Avoid Toll Roads":"avoid-toll-roads","Avoid Toll Roads for Trucks":"avoid-toll-roads-for-trucks","Avoid Truck Restricted Roads":"avoid-truck-restricted-roads","Avoid Unpaved Roads":"avoid-unpaved-roads","Axle Count Restriction":"axle-count-restriction","Driving a Bus":"driving-a-bus","Driving a Taxi":"driving-a-taxi","Driving a Truck":"driving-a-truck","Driving an Automobile":"driving-an-automobile","Driving an Emergency Vehicle":"driving-an-emergency-vehicle","Height Restriction":"height-restriction","Kingpin to Rear Axle Length Restriction":"kingpin-to-rear-axle-length-restriction","Length Restriction":"length-restriction","Preferred for Pedestrians":"preferred-for-pedestrians","Riding a Motorcycle":"riding-a-motorcycle","Roads Under Construction Prohibited":"roads-under-construction-prohibited","Semi or Tractor with One or More Trailers Prohibited":"semi-or-tractor-with-one-or-more-trailers-prohibited","Single Axle Vehicles Prohibited":"single-axle-vehicles-prohibited","Tandem Axle Vehicles Prohibited":"tandem-axle-vehicles-prohibited","Through Traffic Prohibited":"through-traffic-prohibited","Truck with Trailers Restriction":"truck-with-trailers-restriction","Use Preferred Hazmat Routes":"use-preferred-hazmat-routes","Use Preferred Truck Routes":"use-preferred-truck-routes",Walking:"walking","Weight Restriction":"weight-restriction"},{ignoreUnknown:!1}),g4t=Br()({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),y4t=Br()({esriGeometryPoint:"point",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"envelope",esriGeometryMultipoint:"multipoint"}),_4t=Br()({esriNAUTCost:"cost",esriNAUTDescriptor:"descriptor",esriNAUTRestriction:"restriction",esriNAUTHierarchy:"hierarchy"}),v4t=Br()({esriDSTAltName:"alt-name",esriDSTArrive:"arrive",esriDSTBranch:"branch",esriDSTCrossStreet:"cross-street",esriDSTCumulativeLength:"cumulative-length",esriDSTDepart:"depart",esriDSTEstimatedArrivalTime:"estimated-arrival-time",esriDSTExit:"exit",esriDSTGeneral:"general",esriDSTLength:"length",esriDSTServiceTime:"service-time",esriDSTStreetName:"street-name",esriDSTSummary:"summary",esriDSTTime:"time",esriDSTTimeWindow:"time-window",esriDSTToward:"toward",esriDSTViolationTime:"violation-time",esriDSTWaitTime:"wait-time"});function r0(e,t){if(C(e))return null;const r={},i=new RegExp(`^${t}`,"i");for(const s of Object.keys(e))if(i.test(s)){const n=s.substring(t.length);r[Bd.fromJSON(n)]=e[s]}return r}function Tue(e,t,r){if(!C(e)){t.attributes||(t.attributes={});for(const i in e){const s=Bd.toJSON(i);t.attributes[`${r}${s}`]=e[i]}}}function yI(e){const t={};for(const r of Object.keys(e)){const i=r;t[Bd.fromJSON(i)]=e[r]}return t}function _I(e){const t={};for(const r of Object.keys(e)){const i=r;t[Bd.toJSON(i)]=e[r]}return t}function xF(e,t){return C(e)||C(t)?null:Math.round((e-t)/6e4)}function b4t(e){const t=e.toJSON(),r=t;return r.accumulateAttributeNames&&(r.accumulateAttributeNames=t.accumulateAttributeNames.join()),r.attributeParameterValues&&(r.attributeParameterValues=JSON.stringify(t.attributeParameterValues)),r.barriers&&(r.barriers=JSON.stringify(t.barriers)),r.outSR&&(r.outSR=t.outSR.wkid),r.overrides&&(r.overrides=JSON.stringify(t.overrides)),r.polygonBarriers&&(r.polygonBarriers=JSON.stringify(t.polygonBarriers)),r.polylineBarriers&&(r.polylineBarriers=JSON.stringify(t.polylineBarriers)),r.restrictionAttributeNames&&(r.restrictionAttributeNames=t.restrictionAttributeNames.join()),r.stops&&(r.stops=JSON.stringify(t.stops)),r.travelMode&&(r.travelMode=JSON.stringify(t.travelMode)),r}var yie;let zt=yie=class extends ki(fe){constructor(e){super(e),this.arriveCurbApproach=null,this.arriveTime=null,this.arriveTimeOffset=null,this.bearing=null,this.bearingTol=null,this.cumulativeCosts=null,this.cumulativeDistance=null,this.cumulativeDuration=null,this.curbApproach=null,this.departCurbApproach=null,this.departTime=null,this.departTimeOffset=null,this.distanceToNetworkInMeters=null,this.geometry=null,this.lateDuration=null,this.locationType=null,this.name=null,this.navLatency=null,this.objectId=null,this.popupTemplate=null,this.posAlong=null,this.routeName=null,this.serviceCosts=null,this.serviceDistance=null,this.serviceDuration=null,this.sequence=null,this.sideOfEdge=null,this.snapX=null,this.snapY=null,this.snapZ=null,this.sourceId=null,this.sourceOid=null,this.status=null,this.symbol=null,this.timeWindowEnd=null,this.timeWindowEndOffset=null,this.timeWindowStart=null,this.timeWindowStartOffset=null,this.type="stop",this.violations=null,this.waitDuration=null,this.wait=null}readArriveTimeOffset(e,t){return xF(t.attributes.ArriveTime,t.attributes.ArriveTimeUTC)}readCumulativeCosts(e,t){return r0(t.attributes,"Cumul_")}readDepartTimeOffset(e,t){return xF(t.attributes.DepartTime,t.attributes.DepartTimeUTC)}readServiceCosts(e,t){return r0(t.attributes,"Attr_")}writeServiceCosts(e,t){Tue(e,t,"Attr_")}writeTimeWindowEnd(e,t){C(e)||(t.attributes||(t.attributes={}),t.attributes.TimeWindowEnd=e.getTime())}writeTimeWindowStart(e,t){C(e)||(t.attributes||(t.attributes={}),t.attributes.TimeWindowStart=e.getTime())}readViolations(e,t){return r0(t.attributes,"Violation_")}readWait(e,t){return r0(t.attributes,"Wait_")}static fromGraphic(e){var t,r,i,s,n,o,a,l,c,d,p;return new yie({arriveCurbApproach:v(e.attributes.ArrivalCurbApproach)?Rl.fromJSON(e.attributes.ArrivalCurbApproach):null,arriveTime:v(e.attributes.ArrivalTime)?new Date(e.attributes.ArrivalTime):null,arriveTimeOffset:e.attributes.ArrivalUTCOffset,cumulativeCosts:v(e.attributes.CumulativeCosts)?yI(JSON.parse(e.attributes.CumulativeCosts)):null,cumulativeDistance:(t=e.attributes.CumulativeMeters)!=null?t:null,cumulativeDuration:(r=e.attributes.CumulativeMinutes)!=null?r:null,curbApproach:v(e.attributes.CurbApproach)?Rl.fromJSON(e.attributes.CurbApproach):null,departCurbApproach:v(e.attributes.DepartureCurbApproach)?Rl.fromJSON(e.attributes.DepartureCurbApproach):null,departTime:v(e.attributes.DepartureTime)?new Date(e.attributes.DepartureTime):null,departTimeOffset:(i=e.attributes.DepartureUTCOffset)!=null?i:null,geometry:e.geometry,lateDuration:(s=e.attributes.LateMinutes)!=null?s:null,locationType:v(e.attributes.LocationType)?SL.fromJSON(e.attributes.LocationType):null,name:e.attributes.Name,objectId:(n=e.attributes.ObjectID)!=null?n:e.attributes.__OBJECTID,popupTemplate:e.popupTemplate,routeName:e.attributes.RouteName,sequence:(o=e.attributes.Sequence)!=null?o:null,serviceCosts:v(e.attributes.ServiceCosts)?yI(JSON.parse(e.attributes.ServiceCosts)):null,serviceDistance:(a=e.attributes.ServiceMeters)!=null?a:null,serviceDuration:(l=e.attributes.ServiceMinutes)!=null?l:null,status:v(e.attributes.Status)?jx.fromJSON(e.attributes.Status):null,symbol:e.symbol,timeWindowEnd:v(e.attributes.TimeWindowEnd)?new Date(e.attributes.TimeWindowEnd):null,timeWindowEndOffset:(c=e.attributes.TimeWindowEndUTCOffset)!=null?c:null,timeWindowStart:v(e.attributes.TimeWindowStart)?new Date(e.attributes.TimeWindowStart):null,timeWindowStartOffset:(d=e.attributes.TimeWindowStartUTCOffset)!=null?d:null,waitDuration:(p=e.attributes.WaitMinutes)!=null?p:null})}toGraphic(){var t,r;const e={ObjectID:this.objectId,ArrivalCurbApproach:v(this.arriveCurbApproach)?Rl.toJSON(this.arriveCurbApproach):null,ArrivalTime:v(this.arriveTime)?this.arriveTime.getTime():null,ArrivalUTCOffset:this.arriveTimeOffset,CumulativeCosts:v(this.cumulativeCosts)?JSON.stringify(_I(this.cumulativeCosts)):null,CumulativeMeters:this.cumulativeDistance,CumulativeMinutes:this.cumulativeDuration,CurbApproach:v(this.curbApproach)?Rl.toJSON(this.curbApproach):null,DepartureCurbApproach:v(this.departCurbApproach)?Rl.toJSON(this.departCurbApproach):null,DepartureTime:v(this.departTime)?this.departTime.getTime():null,DepartureUTCOffset:this.departTimeOffset,LateMinutes:this.lateDuration,LocationType:v(this.locationType)?SL.toJSON(this.locationType):null,Name:this.name,RouteName:this.routeName,Sequence:this.sequence,ServiceCosts:v(this.serviceCosts)?JSON.stringify(_I(this.serviceCosts)):null,ServiceMeters:this.serviceDistance,ServiceMinutes:this.serviceDuration,Status:v(this.status)?jx.toJSON(this.status):null,TimeWindowEnd:v(this.timeWindowEnd)?this.timeWindowEnd.getTime():null,TimeWindowEndUTCOffset:(t=this.timeWindowEndOffset)!=null?t:this.arriveTimeOffset,TimeWindowStart:v(this.timeWindowStart)?this.timeWindowStart.getTime():null,TimeWindowStartUTCOffset:(r=this.timeWindowStartOffset)!=null?r:this.arriveTimeOffset,WaitMinutes:this.waitDuration};return new _i({geometry:this.geometry,attributes:e,symbol:this.symbol,popupTemplate:this.popupTemplate})}};zt.fields=[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID",editable:!1,nullable:!1,domain:null},{name:"ArrivalCurbApproach",alias:"Arrival Curb Approach",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0,domain:{type:"codedValue",name:"esriNACurbApproachType",codedValues:[{name:"Either side",code:0},{name:"From the right",code:1},{name:"From the left",code:2},{name:"Depart in the same direction",code:3}]}},{name:"ArrivalTime",alias:"Arrival Time",type:"esriFieldTypeDate",length:36,editable:!0,nullable:!0,visible:!0},{name:"ArrivalUTCOffset",alias:"Arrival Time: Offset from UTC in Minutes",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0},{name:"CumulativeCosts",alias:"Cumulative Costs",type:"esriFieldTypeString",length:1048576,editable:!0,nullable:!0,visible:!1,domain:null},{name:"CumulativeMeters",alias:"Cumulative Meters",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!0},{name:"CumulativeMinutes",alias:"Cumulative Minutes",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!0},{name:"CurbApproach",alias:"Curb Approach",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!1,domain:{type:"codedValue",name:"esriNACurbApproachType",codedValues:[{name:"Either side",code:0},{name:"From the right",code:1},{name:"From the left",code:2},{name:"Depart in the same direction",code:3}]}},{name:"DepartureCurbApproach",alias:"Departure Curb Approach",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0,domain:{type:"codedValue",name:"esriNACurbApproachType",codedValues:[{name:"Either side",code:0},{name:"From the right",code:1},{name:"From the left",code:2},{name:"Depart in the same direction",code:3}]}},{name:"DepartureTime",alias:"Departure Time",type:"esriFieldTypeDate",length:36,editable:!0,nullable:!0,visible:!0},{name:"DepartureUTCOffset",alias:"Departure Time: Offset from UTC in Minutes",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0},{name:"LateMinutes",alias:"Minutes Late",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!1},{name:"LocationType",alias:"Location Type",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0,domain:{type:"codedValue",name:"esriNALocationType",codedValues:[{name:"Stop",code:0},{name:"Waypoint",code:1}]}},{name:"Name",alias:"Name",type:"esriFieldTypeString",length:255,editable:!0,nullable:!0,visible:!0},{name:"RouteName",alias:"Route Name",type:"esriFieldTypeString",length:255,editable:!0,nullable:!0,visible:!0},{name:"Sequence",alias:"Sequence",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0},{name:"ServiceCosts",alias:"Service Costs",type:"esriFieldTypeString",length:1048576,editable:!0,nullable:!0,visible:!1,domain:null},{name:"ServiceMeters",alias:"Service Meters",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!1},{name:"ServiceMinutes",alias:"Service Minutes",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!1},{name:"Status",alias:"Status",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0,domain:{type:"codedValue",name:"esriNAObjectStatus",codedValues:[{name:"OK",code:0},{name:"Not Located on Network",code:1},{name:"Network Unbuilt",code:2},{name:"Prohibited Street",code:3},{name:"Invalid Field Values",code:4},{name:"Cannot Reach",code:5},{name:"Time Window Violation",code:6}]}},{name:"TimeWindowEnd",alias:"Time Window End",type:"esriFieldTypeDate",length:36,editable:!0,nullable:!0,visible:!1},{name:"TimeWindowEndUTCOffset",alias:"Time Window End: Offset from UTC in Minutes",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0},{name:"TimeWindowStart",alias:"Time Window Start",type:"esriFieldTypeDate",length:36,editable:!0,nullable:!0,visible:!1},{name:"TimeWindowStartUTCOffset",alias:"Time Window Start: Offset from UTC in Minutes",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0},{name:"WaitMinutes",alias:"Minutes Early",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!1}],zt.popupInfo={title:"{Name}",fieldInfos:[{fieldName:"Name",label:"Name",isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"RouteName",label:"Route Name",isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"Sequence",label:"Sequence",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"ArrivalTime",label:"Arrival Time",isEditable:!0,tooltip:"",visible:!0,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox"},{fieldName:"ArrivalUTCOffset",label:"Arrival Time: Offset from UTC in Minutes",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"DepartureTime",label:"Departure Time",isEditable:!0,tooltip:"",visible:!0,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox"},{fieldName:"DepartureUTCOffset",label:"Departure Time: Offset from UTC in Minutes",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"CurbApproach",label:"Curb Approach",isEditable:!0,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"ArrivalCurbApproach",label:"Arrival Curb Approach",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"DepartureCurbApproach",label:"Departure Curb Approach",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"Status",label:"Status",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"LocationType",label:"Location Type",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"TimeWindowStart",label:"Time Window Start",isEditable:!0,tooltip:"",visible:!1,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox"},{fieldName:"TimeWindowStartUTCOffset",label:"Time Window Start: Offset from UTC in Minutes",isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"TimeWindowEnd",label:"Time Window End",isEditable:!0,tooltip:"",visible:!1,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox"},{fieldName:"TimeWindowEndUTCOffset",label:"Time Window End: Offset from UTC in Minutes",isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"ServiceMinutes",label:"Service Minutes",isEditable:!0,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"ServiceMeters",label:"Service Meters",isEditable:!0,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"ServiceCosts",label:"Service Costs",isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox"},{fieldName:"CumulativeMinutes",label:"Cumulative Minutes",isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"CumulativeMeters",label:"Cumulative Meters",isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"CumulativeCosts",label:"Cumulative Costs",isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox"},{fieldName:"LateMinutes",label:"Minutes Late",isEditable:!1,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"WaitMinutes",label:"Minutes Early",isEditable:!1,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"}],description:null,showAttachments:!1,mediaInfos:[]},u([h({type:Rl.apiValues,json:{read:{source:"attributes.ArrivalCurbApproach",reader:Rl.read}}})],zt.prototype,"arriveCurbApproach",void 0),u([h({type:Date,json:{read:{source:"attributes.ArriveTimeUTC"}}})],zt.prototype,"arriveTime",void 0),u([h()],zt.prototype,"arriveTimeOffset",void 0),u([me("arriveTimeOffset",["attributes.ArriveTime","attributes.ArriveTimeUTC"])],zt.prototype,"readArriveTimeOffset",null),u([h({json:{name:"attributes.Bearing",read:!1,write:!0}})],zt.prototype,"bearing",void 0),u([h({json:{name:"attributes.BearingTol",read:!1,write:!0}})],zt.prototype,"bearingTol",void 0),u([h()],zt.prototype,"cumulativeCosts",void 0),u([me("cumulativeCosts",["attributes"])],zt.prototype,"readCumulativeCosts",null),u([h()],zt.prototype,"cumulativeDistance",void 0),u([h()],zt.prototype,"cumulativeDuration",void 0),u([h({type:Rl.apiValues,json:{name:"attributes.CurbApproach",read:{reader:Rl.read},write:{writer:Rl.write}}})],zt.prototype,"curbApproach",void 0),u([h({type:Rl.apiValues,json:{read:{source:"attributes.DepartCurbApproach",reader:Rl.read}}})],zt.prototype,"departCurbApproach",void 0),u([h({type:Date,json:{read:{source:"attributes.DepartTimeUTC"}}})],zt.prototype,"departTime",void 0),u([h()],zt.prototype,"departTimeOffset",void 0),u([me("departTimeOffset",["attributes.DepartTime","attributes.DepartTimeUTC"])],zt.prototype,"readDepartTimeOffset",null),u([h({json:{read:{source:"attributes.DistanceToNetworkInMeters"}}})],zt.prototype,"distanceToNetworkInMeters",void 0),u([h({type:lt,json:{write:!0}})],zt.prototype,"geometry",void 0),u([h()],zt.prototype,"lateDuration",void 0),u([h({type:SL.apiValues,json:{name:"attributes.LocationType",read:{reader:SL.read},write:{writer:SL.write}}})],zt.prototype,"locationType",void 0),u([h({json:{name:"attributes.Name"}})],zt.prototype,"name",void 0),u([h({json:{name:"attributes.NavLatency",read:!1,write:!0}})],zt.prototype,"navLatency",void 0),u([h({json:{name:"attributes.ObjectID"}})],zt.prototype,"objectId",void 0),u([h({type:Nc})],zt.prototype,"popupTemplate",void 0),u([h({json:{read:{source:"attributes.PosAlong"}}})],zt.prototype,"posAlong",void 0),u([h({json:{name:"attributes.RouteName"}})],zt.prototype,"routeName",void 0),u([h()],zt.prototype,"serviceCosts",void 0),u([me("serviceCosts",["attributes"])],zt.prototype,"readServiceCosts",null),u([Le("serviceCosts")],zt.prototype,"writeServiceCosts",null),u([h()],zt.prototype,"serviceDistance",void 0),u([h()],zt.prototype,"serviceDuration",void 0),u([h({json:{name:"attributes.Sequence"}})],zt.prototype,"sequence",void 0),u([h({type:m9.apiValues,json:{read:{source:"attributes.SideOfEdge",reader:m9.read}}})],zt.prototype,"sideOfEdge",void 0),u([h({json:{read:{source:"attributes.SnapX"}}})],zt.prototype,"snapX",void 0),u([h({json:{read:{source:"attributes.SnapY"}}})],zt.prototype,"snapY",void 0),u([h({json:{read:{source:"attributes.SnapZ"}}})],zt.prototype,"snapZ",void 0),u([h({json:{read:{source:"attributes.SourceID"}}})],zt.prototype,"sourceId",void 0),u([h({json:{read:{source:"attributes.SourceOID"}}})],zt.prototype,"sourceOid",void 0),u([h({type:jx.apiValues,json:{read:{source:"attributes.Status",reader:jx.read}}})],zt.prototype,"status",void 0),u([h({types:un})],zt.prototype,"symbol",void 0),u([h({type:Date,json:{name:"attributes.TimeWindowEnd"}})],zt.prototype,"timeWindowEnd",void 0),u([Le("timeWindowEnd")],zt.prototype,"writeTimeWindowEnd",null),u([h()],zt.prototype,"timeWindowEndOffset",void 0),u([h({type:Date,json:{name:"attributes.TimeWindowStart"}})],zt.prototype,"timeWindowStart",void 0),u([Le("timeWindowStart")],zt.prototype,"writeTimeWindowStart",null),u([h()],zt.prototype,"timeWindowStartOffset",void 0),u([h({readOnly:!0,json:{read:!1}})],zt.prototype,"type",void 0),u([h()],zt.prototype,"violations",void 0),u([me("violations",["attributes"])],zt.prototype,"readViolations",null),u([h()],zt.prototype,"waitDuration",void 0),u([h()],zt.prototype,"wait",void 0),u([me("wait",["attributes"])],zt.prototype,"readWait",null),zt=yie=u([I("esri.rest.support.Stop")],zt);const Km=zt;let Io=class extends eC(fe){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};u([h()],Io.prototype,"autoNavigate",void 0),u([h()],Io.prototype,"filter",void 0),u([h()],Io.prototype,"getResults",void 0),u([h()],Io.prototype,"getSuggestions",void 0),u([h()],Io.prototype,"maxResults",void 0),u([h()],Io.prototype,"maxSuggestions",void 0),u([h()],Io.prototype,"minSuggestCharacters",void 0),u([h()],Io.prototype,"outFields",void 0),u([h()],Io.prototype,"placeholder",void 0),u([h()],Io.prototype,"popupEnabled",void 0),u([h()],Io.prototype,"popupTemplate",void 0),u([h()],Io.prototype,"prefix",void 0),u([h()],Io.prototype,"resultGraphicEnabled",void 0),u([h()],Io.prototype,"resultSymbol",void 0),u([h()],Io.prototype,"suggestionsEnabled",void 0),u([h()],Io.prototype,"suffix",void 0),u([h()],Io.prototype,"withinViewEnabled",void 0),u([h()],Io.prototype,"zoomScale",void 0),Io=u([I("esri.widgets.Search.SearchSource")],Io);const Sue=Io,oxe=te.getLogger("esri.widgets.Search.support.geometryUtils");function w4t(e,t){var i,s;if(!t)return oxe.error("missing-parameter: view is missing."),Promise.reject(new z("searchgeometryutils:missing-parameter","view is missing."));if(!e)return oxe.error("missing-parameter: point is missing."),Promise.reject(new z("searchgeometryutils:missing-parameter","point is missing."));if(e.hasZ||t.type==="2d")return Promise.resolve(e);const r=(i=t==null?void 0:t.map)==null?void 0:i.ground;return r&&r.layers.length?r.queryElevation(e,{cache:(s=t.basemapTerrain)==null?void 0:s.elevationQueryCache}).then(n=>n.geometry):Promise.resolve(e)}function axe(e){if(C(e))return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":return e.getPoint(0);case"polyline":return e.getPoint(0,0)}return null}function Eue(e,t,r){return C(e)?null:e.type==="extent"?e:e.type==="multipoint"||e.type==="polygon"||e.type==="polyline"?e.extent:e.type==="point"?GUe(e,t,r):void 0}function _ie(e,t,r){return C(e)||C(t)?null:GUe(e.center,t,r)}function GUe(e,t,r){const i=e.hasZ?e.z:void 0;return t&&t.map?(r?oat(t,r):t.extent).clone().centerAt(e).set({zmax:i,zmin:i}):new Sr({xmin:e.x-.25,ymin:e.y-.25,xmax:e.x+.25,ymax:e.y+.25,spatialReference:e.spatialReference,zmin:i,zmax:i})}const x4t=/https?:\/\/services.*\.arcgis\.com/i,T4t=/(?:\{([^}]+)\})/g,QM=te.getLogger("esri.widgets.Search.support.layerSearchUtils");function S4t(e,t){const{exactMatch:r=!1,location:i,maxResults:s,spatialReference:n,source:o,sourceIndex:a,suggestResult:l,view:c}=e,{layer:d,filter:p,zoomScale:f}=o,m=c&&c.scale,g=HUe(o,c),_=t&&t.signal;return WUe(d).then(()=>{const x=d.popupTemplate;return x?x.getRequiredFields(d.fieldsIndex):null}).then(x=>{var q,G,J;const{objectIdField:b,returnZ:w}=d,T=QUe(o);if(!Cue(d,T))throw QM.error("invalid-field: displayField is invalid."),new z("getResults():invalid-field","displayField is invalid.");const E=x&&x.length?x:[T],O=o.outFields||E,A=qUe(O);if(O.includes(b)||A||O.push(b),(q=d.floorInfo)!=null&&q.floorField&&O.push(d.floorInfo.floorField),!(A||v9(d,O)))throw QM.error("invalid-field: outField is invalid."),new z("getResults():invalid-field","outField is invalid.");const R=d.createQuery(),{orderByFields:D}=o;if(D&&(R.orderByFields=D),n){R.outSpatialReference=n;const ee=1/Fc(n);ee&&(R.maxAllowableOffset=ee)}const k=d.geometryType==="mesh"||d.geometryType==="multipatch",L=((J=(G=d.capabilities)==null?void 0:G.data)==null?void 0:J.supportsZ)&&!k;if(R.returnZ=L&&w!==!1,R.returnGeometry=!0,R.multipatchOption=k?"xyFootprint":null,O&&(R.outFields=O),i)R.geometry=i;else if(l.key)R.objectIds=[l.key];else{const ee=o.searchFields||[T];if(!v9(d,ee))throw QM.error("invalid-field: search field is invalid."),new z("getResults():invalid-field","search field is invalid.");if(KUe(d)&&(R.num=s),g&&(R.geometry=g),!l.text.trim())return[];const se=l.text,{prefix:X="",suffix:F=""}=o,N=e6e(`${X}${se}${F}`);JUe(d)&&YUe(d,ee)&&!r&&se&&(R.fullText=ZUe({text:se,searchFields:ee}));const B=t6e({searchTerm:N,layer:d,searchFields:ee,filter:p,exactMatch:r,query:R,type:"search"});if(R.where=B,!XUe(R))return[]}return d.queryFeatures(R,{signal:_}).then(ee=>N4t(ee,c,o,a,T,m,f))})}function E4t(e,t){const{source:r,spatialReference:i,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a,exactMatch:l}=e,{layer:c,filter:d}=r,p=t&&t.signal,f=HUe(r,s);return WUe(c).then(()=>{if(!KUe(c))return[];const m=QUe(r),g=r.searchFields||[m],_=[];r.suggestionTemplate?r.suggestionTemplate.replace(T4t,(L,q)=>(_.push(q),L)):_.push(m);const x=qUe(_);_.includes(c.objectIdField)||x||_.push(c.objectIdField);const b=Cue(c,m),w=x||v9(c,_),T=v9(c,g);if(!b)throw QM.error("invalid-field: displayField is invalid."),new z("getSuggestions():invalid-field","displayField is invalid.");if(!w)throw QM.error("invalid-field: outField is invalid."),new z("getSuggestions():invalid-field","outField is invalid.");if(!T)throw QM.error("invalid-field: search field is invalid."),new z("getSuggestions():invalid-field","search field is invalid.");const E=c.createQuery(),{orderByFields:O}=r;if(O&&(E.orderByFields=O),E.outSpatialReference=i,E.returnGeometry=!1,E.num=o,E.outFields=_,f&&(E.geometry=f),!n.trim())return[];const{prefix:A="",suffix:R=""}=r,D=e6e(`${A}${n}${R}`);JUe(c)&&YUe(c,g)&&!l&&n&&(E.fullText=ZUe({text:n,searchFields:g}));const k=t6e({searchTerm:D,layer:c,searchFields:g,filter:d,exactMatch:l,query:E,type:"suggest"});return E.where=k,XUe(E)?c.queryFeatures(E,{signal:p}).then(L=>D4t(L,r,a,m)):[]})}function HUe(e,t){const{filter:r,withinViewEnabled:i}=e,s=t&&t.extent;return r&&r.geometry||(i&&s?s:void 0)}function qUe(e){return e&&e.includes("*")}async function WUe(e){e&&await e.load()}function XUe(e){return!(!e.fullText&&!e.where)}function YUe(e,t){const r=e==null?void 0:e.indexes;return!r||!(t!=null&&t.length)?!1:r.filter(i=>i.indexType==="FullText").some(i=>{var n;const s=((n=i.fields)==null?void 0:n.split(",").map(o=>o.trim().toLowerCase()))||[];return t.every(o=>s.includes(o.toLowerCase()))})}function ZUe({text:e,searchFields:t}){return e.trim().split(" ").filter(r=>!!r.trim()).map(r=>new WRe({onFields:t,searchTerm:r,searchType:"prefix"}))}function JUe(e){var t,r,i;return(i=(r=(t=e==null?void 0:e.capabilities)==null?void 0:t.query)==null?void 0:r.supportsFullTextSearch)!=null?i:!1}function KUe(e){var t,r,i;return(i=(r=(t=e==null?void 0:e.capabilities)==null?void 0:t.query)==null?void 0:r.supportsPagination)!=null?i:!1}function C4t(e){var t,r,i,s;return(s=(i=(r=(t=e==null?void 0:e.fieldsIndex)==null?void 0:t.fields)==null?void 0:r.find(n=>n.type==="string"))==null?void 0:i.name)!=null?s:""}function QUe(e){return e.displayField||e.layer.displayField||C4t(e.layer)}function v9(e,t){return!(!e||!(t!=null&&t.length))&&t.every(r=>Cue(e,r))}function Cue(e,t){return!!e.getField(t)}function A4t(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}function O4t(e,t,r){let i=null;const{codedValues:s}=e;return s&&s.some(n=>{const o=n.name,a=r?o:o.toLowerCase();return(r?t:t.toLowerCase())===a&&(i=n.code.toString(),!0)}),i}function e6e(e){return e.replace(/\'/g,"''")}function x3(e,t){const r=t&&t.where;return r?`(${e}) AND (${r})`:e}function M4t({currentTerm:e,field:t,filter:r,exactMatch:i,url:s,type:n}){const o=t.type,a=t.name;if(o==="string"||o==="date"||o==="global-id"){const l=x4t.test(s),c=l&&A4t(e)?"N":"";return x3(i&&n==="search"?`${a} = ${c}'${e}'`:l?`${a} LIKE ${c}${`'${e}%'`}`:`${`LOWER(${a})`} LIKE ${c}${`'${e.toLowerCase()}%'`}`,r)}if(o==="oid"||o==="small-integer"||o==="integer"||o==="single"||o==="double"){const l=Number(e);return isNaN(l)?null:x3(`${a} = ${l}`,r)}return x3(`${a} = ${e}`,r)}function R4t(e,t){return e?` OR (${t})`:`(${t})`}function t6e({searchTerm:e,layer:t,searchFields:r,filter:i,exactMatch:s,query:n,type:o}){const{definitionExpression:a,url:l}=t;let c="";return!n.fullText&&e&&r&&r.forEach(d=>{const p=t.getField(d),f=typeof t.getFieldDomain=="function"&&t.getFieldDomain(d),m=(f&&f.type==="coded-value"?O4t(f,e,s):null)||e||null;if(m!==null){const g=M4t({currentTerm:m,field:p,filter:i,exactMatch:s,url:l,type:o});g&&(c+=R4t(c,g))}}),a&&c?`(${a}) AND (${c})`:a||c}function I4t(e,t){let r=null;const{codedValues:i}=e;return i&&i.length&&i.some(s=>s.code===t&&(r=s.name,!0)),r}function P4t(e,t){return e[Object.keys(e).find(r=>r.toLowerCase()===t.toLowerCase())]}function r6e(e,t,r){const i=e.sourceLayer,{attributes:s}=e,n=typeof i.getFieldDomain=="function"&&i.getFieldDomain(r);if(t)return hu(t,s);if(r&&s){const o=i.getField(r),a=P4t(s,r);return a==null?"":n&&n.type==="coded-value"?I4t(n,a):(o==null?void 0:o.type)==="date"?_s(new Date(a)):typeof a=="number"?a.toString():typeof a!="string"?"":a.trim()}return""}function $4t(e,t,r,i){const s=e.sourceLayer,{attributes:n}=e,{objectIdField:o}=s,a=n[o];return{text:r6e(e,t.suggestionTemplate,i),key:a,sourceIndex:r}}function D4t(e,t,r,i){return e.features.map(s=>$4t(s,t,r,i))}function L4t(e,t,r,i,s,n,o){const a=e.clone(),l=e.sourceLayer,c=l&&l.objectIdField,d=c&&e.attributes[c],p=r6e(e,r.searchTemplate,s),f=Eue(a.geometry,t,n),m=typeof o=="number"?_ie(ne(f),t,o):f,g=e.clone();return v(m)&&(g.geometry=kl.fromExtent(m)),{extent:m,target:g,feature:a,key:d,name:p,sourceIndex:i}}function N4t(e,t,r,i,s,n,o){return e.features.map(a=>L4t(a,t,r,i,s,n,o))}var vie;let ym=vie=class extends Sue{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(t,r)=>S4t({source:this,...t},r),this.getSuggestions=(t,r)=>E4t({source:this,...t},r)}set layer(e){this._set("layer",e),e&&e.load().catch(()=>{})}get name(){var e;return(e=this._getLayerTitle())!=null?e:""}set name(e){this._overrideIfSome("name",e)}clone(){return new vie({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?ne(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?ne(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){var e,t;return(t=(e=this.layer.fieldsIndex.fields.find(r=>r.type==="string"))==null?void 0:e.name)!=null?t:""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map(r=>{const i=e.getField(r);return i&&i.alias||r}).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};u([h({json:{read:{source:"field.name"},write:{target:"field.name"}}})],ym.prototype,"displayField",void 0),u([h({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],ym.prototype,"exactMatch",void 0),u([h({value:null})],ym.prototype,"layer",null),u([h()],ym.prototype,"name",null),u([h({type:[String],json:{write:!0}})],ym.prototype,"orderByFields",void 0),u([h()],ym.prototype,"searchFields",void 0),u([h()],ym.prototype,"searchTemplate",void 0),u([h()],ym.prototype,"suggestionTemplate",void 0),ym=vie=u([I("esri.widgets.Search.LayerSearchSource")],ym);const SO=ym;function F4t(e){return e&&typeof e.x=="number"&&typeof e.y=="number"}function k4t(e){return e&&typeof e.xmin=="number"&&typeof e.ymin=="number"&&typeof e.xmax=="number"&&typeof e.ymax=="number"}let Zb=class extends fe{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};u([h({type:String,json:{write:!0}})],Zb.prototype,"address",void 0),u([h({type:Object,json:{write:!0}})],Zb.prototype,"attributes",void 0),u([h({type:Sr,json:{write:!0}})],Zb.prototype,"extent",void 0),u([h({type:lt,json:{write:!0}})],Zb.prototype,"location",void 0),u([h({type:Number,json:{write:!0}})],Zb.prototype,"score",void 0),Zb=u([I("esri.rest.support.AddressCandidate")],Zb);const i6e=Zb,rH={type:String,json:{read:{source:"token"},write:{target:"token"}}};let xl=class extends fe{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};u([h({type:Object,json:{write:!0}})],xl.prototype,"address",void 0),u([h(rH)],xl.prototype,"apiKey",void 0),u([h({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],xl.prototype,"categories",void 0),u([h({type:String,json:{write:!0}})],xl.prototype,"countryCode",void 0),u([h({type:Boolean,json:{write:!0}})],xl.prototype,"forStorage",void 0),u([h({type:lt,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],xl.prototype,"location",void 0),u([h({type:String,json:{write:!0}})],xl.prototype,"locationType",void 0),u([h({type:String,json:{write:!0}})],xl.prototype,"magicKey",void 0),u([h({type:Number,json:{write:!0}})],xl.prototype,"maxLocations",void 0),u([h({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],xl.prototype,"outFields",void 0),u([h({type:Ve,json:{read:{source:"outSR"},write:{target:"outSR"}}})],xl.prototype,"outSpatialReference",void 0),u([h({type:Sr,json:{write:{writer:(e,t)=>{const r=e?e.shiftCentralMeridian():null;t.searchExtent=r}}}})],xl.prototype,"searchExtent",void 0),xl=u([I("esri.rest.support.AddressToLocationsParameters")],xl),xl.from=ts(xl);const s6e=xl;async function U4t(e,t,r){t=s6e.from(t);const i=eT(e),{address:s,...n}=t.toJSON(),o={...s,...n,f:"json"},a=e7({...i.query,...o}),l=Ox(a,r),c=`${i.path}/findAddressCandidates`;return lr(c,l).then(B4t)}function B4t({data:e}){if(!e)return[];const{candidates:t,spatialReference:r}=e;return t?t.map(i=>{if(!i)return;const{extent:s,location:n}=i,o=!s||k4t(s);return F4t(n)&&o?(s&&(s.spatialReference=r),n.spatialReference=r,i6e.fromJSON(i)):void 0}):[]}let j_=class extends fe{constructor(e){super(e),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};u([h(rH)],j_.prototype,"apiKey",void 0),u([h({type:lt,json:{write:{writer:(e,t)=>{const r=e?e.clone().normalize():null,i=r!==void 0;t.location=i?r:null}}}})],j_.prototype,"location",void 0),u([h({type:String,json:{write:!0}})],j_.prototype,"locationType",void 0),u([h({type:Ve,json:{read:{source:"outSR"},write:{target:"outSR"}}})],j_.prototype,"outSpatialReference",void 0),j_=u([I("esri.rest.support.LocationToAddressParameters")],j_),j_.from=ts(j_);const n6e=j_;async function z4t(e,t,r){t=n6e.from(t);const i=eT(e),s={...t.toJSON(),f:"json"},n=e7({...i.query,...s}),o=Ox(n,r),a=`${i.path}/reverseGeocode`;return lr(a,o).then(V4t)}function V4t({data:e}){if(!e)return;const{address:t,location:r}=e,i=t&&t.Match_addr||"";return i6e.fromJSON({address:i,attributes:t||{},location:r,score:100})}let EO=class extends fe{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};u([h({type:Boolean,json:{write:!0}})],EO.prototype,"isCollection",void 0),u([h({type:String,json:{write:!0}})],EO.prototype,"magicKey",void 0),u([h({type:String,json:{write:!0}})],EO.prototype,"text",void 0),EO=u([I("esri.rest.support.SuggestionCandidate")],EO);const j4t=EO;let lh=class extends fe{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};u([h(rH)],lh.prototype,"apiKey",void 0),u([h({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],lh.prototype,"categories",void 0),u([h({type:String,json:{write:!0}})],lh.prototype,"countryCode",void 0),u([h({type:lt,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],lh.prototype,"location",void 0),u([h({type:Number,json:{write:!0}})],lh.prototype,"maxSuggestions",void 0),u([h({type:Ve,json:{read:{source:"outSR"},write:{target:"outSR"}}})],lh.prototype,"outSpatialReference",void 0),u([h({type:Sr,json:{write:{writer:(e,t)=>{const r=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(r)}}}})],lh.prototype,"searchExtent",void 0),u([h({type:String,json:{write:!0}})],lh.prototype,"text",void 0),lh=u([I("esri.rest.support.SuggestLocationsParameters")],lh),lh.from=ts(lh);const o6e=lh;async function G4t(e,t,r){const i=eT(e),s={...(t=o6e.from(t)).toJSON(),f:"json"},n=e7({...i.query,...s}),o=Ox(n,r),a=`${i.path}/suggest`;return lr(a,o).then(H4t)}function H4t(e){const{data:t}=e;if(!t)return[];const{suggestions:r}=t;return r?r.map(i=>new j4t(i)):[]}const q4t="Single Line Input",W4t=3e5;function X4t(e,t){return e.location?K4t(e,t):Q4t(e,t)}function a6e(e,t){if(t.localSearchDisabled)return null;const r=e==null?void 0:e.scale;return typeof r=="number"&&r<=W4t?e.get("extent.center"):null}function Y4t(e,t){const{source:r,spatialReference:i,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a}=e,l=new o6e,{apiKey:c,url:d}=r,p=c6e(r,s),f=t&&t.signal;if(!d)return Promise.resolve(null);c&&(l.apiKey=c),r.categories&&(l.categories=r.categories),i&&(l.outSpatialReference=i);const m=a6e(s,r);if(m&&(l.location=m),!n.trim())return Promise.resolve(null);const{prefix:g="",suffix:_=""}=r,x=`${g}${n}${_}`;return l.text=x,p&&(l.searchExtent=p),l.maxSuggestions=o,r.countryCode&&(l.countryCode=r.countryCode),G4t(d,l,{signal:f}).then(b=>t5t(b,a))}function Z4t(e){return!!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}function J4t(e){return!!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)}function bie(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)}const l6e="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer";function K4t(e,t){const{source:r,spatialReference:i,location:s,sourceIndex:n,view:o}=e,{apiKey:a,url:l,zoomScale:c,defaultZoomScale:d}=r,p=o&&o.scale,f=t&&t.signal,m=new n6e;return m.location=s,a&&(m.apiKey=a),i&&(m.outSpatialReference=i),z4t(l,m,{signal:f}).then(g=>u6e([g],{sourceIndex:n,scale:p,view:o,zoomScale:c,defaultZoomScale:d})).catch(()=>[])}function c6e(e,t){const{filter:r,withinViewEnabled:i}=e,s=t&&t.scale,n=t&&t.extent,o=r&&r.geometry;return Eue(o,t,s)||(i&&n?n:void 0)}function Q4t(e,t){const{source:r,suggestResult:i,spatialReference:s,view:n,maxResults:o,sourceIndex:a}=e,l=r&&r.zoomScale,c=r&&r.defaultZoomScale;if(!i.text.trim())return Promise.resolve(null);const d=!i.key&&r.prefix?r.prefix:"",p=!i.key&&r.suffix?r.suffix:"",f=`${d}${i.text}${p}`,m=new s6e,{apiKey:g,url:_}=r,x=n&&n.scale,b=c6e(r,n),w=t&&t.signal;if(g&&(m.apiKey=g),!_)return Promise.resolve(null);r.categories&&(m.categories=r.categories),r.locationType&&(m.locationType=r.locationType),s&&(m.outSpatialReference=s);const T=a6e(n,r);T&&(m.location=T),m.maxLocations=o,b&&(m.searchExtent=b),r.countryCode&&(m.countryCode=r.countryCode);const{key:E}=i,O=`${E}`;return E&&(m.magicKey=O),m.address={},m.address[r.singleLineFieldName||q4t]=f,r.outFields&&(m.outFields=r.outFields),U4t(_,m,{signal:w}).then(A=>u6e(A,{key:O,scale:x,sourceIndex:a,view:n,zoomScale:l,defaultZoomScale:c}))}function e5t(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}function t5t(e,t){return e.map(r=>e5t(r,t))}function r5t(e,t){const{key:r,scale:i,sourceIndex:s,view:n,zoomScale:o,defaultZoomScale:a}=t,{attributes:l,extent:c,location:d,address:p}=e,f=new _i({geometry:d,attributes:l}),m=c||d,g=Eue(m,n,i),_=typeof o=="number"?_ie(g,n,o):typeof a=="number"&&m.type==="point"?_ie(g,n,a):g,x=d?`${d.x},${d.y}`:"",b=p||x,w=f.clone();return v(_)&&(w.geometry=kl.fromExtent(_)),{extent:_,feature:f,target:w,key:r,name:b,sourceIndex:s}}function u6e(e,t){return e.filter(Boolean).map(r=>r5t(r,t))}var wie;const i5t="esri.widgets.Search.LocatorSearchSource";let vc=wie=class extends Sue{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(t,r)=>X4t({source:this,...t},r),this.getSuggestions=(t,r)=>Y4t({source:this,...t},r)}clone(){return new wie({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?ne(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?ne(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};u([h()],vc.prototype,"apiKey",void 0),u([h()],vc.prototype,"categories",void 0),u([h()],vc.prototype,"countryCode",void 0),u([h({json:{write:!0}})],vc.prototype,"defaultZoomScale",void 0),u([h()],vc.prototype,"localSearchDisabled",void 0),u([h()],vc.prototype,"locationType",void 0),u([h({json:{write:!0}})],vc.prototype,"name",void 0),u([h({json:{write:!0}})],vc.prototype,"placeholder",void 0),u([h()],vc.prototype,"searchTemplate",void 0),u([h({json:{write:!0}})],vc.prototype,"singleLineFieldName",void 0),u([h({json:{read:{source:"suggest"},write:{target:"suggest"}}})],vc.prototype,"suggestionsEnabled",void 0),u([h({json:{write:!0}})],vc.prototype,"url",void 0),u([h({json:{write:!0}})],vc.prototype,"zoomScale",void 0),vc=wie=u([I(i5t)],vc);const d6e=vc;new gr({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"});new gr({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});let GT=class extends fe{constructor(e){super(e),this.deviationUnit=null,this.geometries=null,this.maxDeviation=null}};u([h({type:String,json:{write:!0}})],GT.prototype,"deviationUnit",void 0),u([h({json:{read:{reader:e=>e?e.map(t=>ql(t)).filter(v):null},write:{writer:(e,t)=>{var r;t.geometries=(r=e==null?void 0:e.map(i=>i.toJSON()))!=null?r:null}}}})],GT.prototype,"geometries",void 0),u([h({type:Number,json:{write:!0}})],GT.prototype,"maxDeviation",void 0),GT=u([I("esri.rest.support.GeneralizeParameters")],GT),GT.from=ts(GT);new gr({preserveShape:"preserve-shape"});let db=class extends fe{constructor(e){super(e),this.calculationType=null,this.geodesic=null,this.lengthUnit=null,this.polylines=null}};u([h({type:String,json:{write:!0}})],db.prototype,"calculationType",void 0),u([h({type:Boolean,json:{write:!0}})],db.prototype,"geodesic",void 0),u([h({json:{write:!0}})],db.prototype,"lengthUnit",void 0),u([h({type:[ja],json:{read:{reader:e=>e?e.map(t=>ql(t)):null},write:{writer:(e,t)=>{t.polylines=e.map(r=>r.toJSON())}}}})],db.prototype,"polylines",void 0),db=u([I("esri.rest.support.LengthsParameters")],db),db.from=ts(db);new gr({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"});new gr({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});let p_=class extends fe{constructor(e){super(e),this.bevelRatio=null,this.geometries=null,this.offsetDistance=null,this.offsetHow=null,this.offsetUnit=null}};u([h({type:Number,json:{write:!0}})],p_.prototype,"bevelRatio",void 0),u([h({json:{read:{reader:e=>e?e.map(t=>ql(t)).filter(v):null},write:{writer:(e,t)=>{var r;t.geometries=(r=e==null?void 0:e.map(i=>i.toJSON()))!=null?r:null}}}})],p_.prototype,"geometries",void 0),u([h({type:Number,json:{write:!0}})],p_.prototype,"offsetDistance",void 0),u([h({type:String,json:{write:!0}})],p_.prototype,"offsetHow",void 0),u([h({type:String,json:{write:!0}})],p_.prototype,"offsetUnit",void 0),p_=u([I("esri.rest.support.OffsetParameters")],p_),p_.from=ts(p_);new gr({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});let hb=class extends fe{constructor(e){super(e),this.geometries1=null,this.geometries2=null,this.relation=null,this.relationParameter=null}};u([h({json:{read:{reader:e=>e?e.map(t=>ql(t)).filter(v):null},write:{writer:(e,t)=>{var r;t.geometries1=(r=e==null?void 0:e.map(i=>i.toJSON()))!=null?r:null}}}})],hb.prototype,"geometries1",void 0),u([h({json:{read:{reader:e=>e?e.map(t=>ql(t)).filter(v):null},write:{writer:(e,t)=>{var r;t.geometries2=(r=e==null?void 0:e.map(i=>i.toJSON()))!=null?r:null}}}})],hb.prototype,"geometries2",void 0),u([h({type:String,json:{write:!0}})],hb.prototype,"relation",void 0),u([h({type:String,json:{write:!0}})],hb.prototype,"relationParameter",void 0),hb=u([I("esri.rest.support.RelationParameters")],hb),hb.from=ts(hb);new gr({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});let HT=class extends fe{constructor(e){super(e),this.extendHow="default-curve-extension",this.polylines=null,this.trimExtendTo=null}};u([h({type:String,json:{write:!0}})],HT.prototype,"extendHow",void 0),u([h({type:[ja],json:{read:{reader:e=>e?e.map(t=>ql(t)):null},write:{writer:(e,t)=>{t.polylines=e.map(r=>r.toJSON())}}}})],HT.prototype,"polylines",void 0),u([h({json:{read:{reader:e=>e?ql(e):null},write:{writer:(e,t)=>{t.trimExtendTo=e.toJSON()}}}})],HT.prototype,"trimExtendTo",void 0),HT=u([I("esri.rest.support.TrimExtendParameters")],HT),HT.from=ts(HT);const h6e=te.getLogger("esri.widgets.support.geolocationUtils"),s5t={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function n5t(){const e=pe("esri-geolocation");return e||h6e.warn("geolocation-unsupported","Geolocation unsupported."),e}function o5t(){const e=window.isSecureContext;return e||h6e.warn("insecure-context","Geolocation requires a secure origin."),e}function lxe(){return n5t()&&o5t()}function a5t(e){return e||(e=s5t),new Promise((r,i)=>{setTimeout(()=>i(new z("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(r,i,e)})}function l5t(e,t){const{position:r,view:i}=e;return d5t(u5t(c5t(r)),i,t)}function c5t(e){const t=e&&e.coords||{},r={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e&&{coords:r,timestamp:e.timestamp}}function u5t(e){const t=e&&e.coords;return t?new lt({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}}):null}function d5t(e,t,r){if(!t)return Promise.resolve(e);const i=t.spatialReference;return i.isWGS84?Promise.resolve(e):i.isWebMercator?Promise.resolve(o0(e)):h5t(r).then(s=>{if(!s)throw new z("geometry-service:missing-url","Geometry service URL is missing");const n=new bG({geometries:[e],outSpatialReference:i});return Hce(s,n,r).then(o=>o[0])})}function h5t(e){if(Gr.geometryServiceUrl)return Promise.resolve(Gr.geometryServiceUrl);const t=oo.getDefault();return t.load(e).catch(()=>{}).then(()=>t.get("helperServices.geometry.url"))}function uc(e,t){return e.hasOwnProperty(t)&&e[t]!=null&&e[t]!==""}const p5t=()=>rne("esri/widgets/Search/t9n/Search"),p6e="esri.widgets.Search.SearchViewModel",f_=te.getLogger(p6e),cxe="highlight",g8=Ge.ofType({key:e=>e.layer?"layer":"locator",base:Sue,typeMap:{layer:SO,locator:d6e}}),uxe=Ve.WGS84,f5t="esri/images/search/search-symbol-32.png",m5t=/<(?:.|\s)*?>/g,CO=-1;let jr=class extends FF($s.EventedMixin(be)){constructor(e){super(e),this._handles=new hr,this._gotoController=null,this._searching=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new g8,this.defaultSymbols={point:new gE({url:ui(f5t),size:24,width:24,height:24}),polyline:new Ul({color:[130,130,130,1],width:2}),polygon:new L0({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=oo.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new g8,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const t=await p5t();this.messages=t,this.defaultPopupTemplate=new Nc({title:t.searchResult,content:"{Match_addr}"})};e(),this._handles.add([ie(()=>[this.includeDefaultSources,this.view,this.portal],()=>this._update(),pt),B2e(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics(),this._handles.destroy(),this._handles=null}get activeSource(){var e;return(e=this.allSources.at(this.activeSourceIndex))!=null?e:null}get activeSourceIndex(){return this.allSources.length===1||!this.searchAllEnabled?0:CO}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){var e;return(e=this.messages)==null?void 0:e.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:r}=this,i=typeof r=="function"?r.call(null,{sources:e,defaultSources:t}):r?t.concat(e):e,s=this._get("allSources")||new g8;return s.removeAll(),s.addMany(i.filter(Boolean)),s}get locationEnabled(){return this._get("locationEnabled")||lxe()}set locationEnabled(e){if(e===void 0)return void this._clearOverride("locationEnabled");const t=lxe();if(e&&!t){const r=new z("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});f_.error(r)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:r}=this;if(t===CO)return r;const i=e.at(t);return i?i.placeholder:""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),e===""&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":this.allSources.length===0?"disabled":"ready"}get updating(){return this._updatingPromise!=null}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup(),this.view&&this.view.graphics.remove(this.resultGraphic),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const r=this._createSuggestionForSearch(e),i=this.when().then(()=>this._getResultsFromSources(r,t).then(s=>{var l;if((l=t==null?void 0:t.signal)!=null&&l.aborted)return null;const n={activeSourceIndex:this.activeSourceIndex,searchTerm:r.text,numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(n,s,r);const o=this._getFirstResult(n.results),a=(r.location&&o?o.name:r.text).replace(m5t,"");return this._set("searchTerm",a),(r.key&&typeof r.sourceIndex=="number"||r.location)&&this._set("selectedSuggestion",r),this._set("results",n.results),this._set("resultCount",n.results.reduce((c,d)=>c+d.results.length,0)),this.emit("search-complete",n),this._selectFirstResult(o).then(()=>n)})).then(s=>(this._clearSearching(),s),s=>{throw this._clearSearching(),s});return this._searching=i,i}searchNearby(e){if(!this.locationEnabled){const r=new z("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});return f_.error(r),Promise.reject(r)}const t=a5t().then(r=>l5t({position:r,view:this.view},e)).then(r=>this.search(r,e));return this._searching=t,t.catch(()=>{}).then(()=>this._clearSearching()),t}select(e){if(this.clearGraphics(),!e){const b=new z("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});return f_.error(b),Promise.reject(b)}const{view:t}=this,r=uc(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),i=this.allSources.at(r);if(!i){const b=new z("select:missing-source","Cannot select without a source.",{source:i});return f_.error(b),Promise.reject(b)}const s=i instanceof SO?this._getLayerSourcePopupTemplate(i):i.popupTemplate,n=i.resultSymbol||this._getDefaultSymbol(e),o=uc(i,"resultGraphicEnabled")?i.resultGraphicEnabled:this.resultGraphicEnabled,a=uc(i,"autoNavigate")?i.autoNavigate:this.autoNavigate,l=uc(i,"popupEnabled")?i.popupEnabled:this.popupEnabled,c=l?s||this.popupTemplate||this.defaultPopupTemplate:null,{feature:d}=e;if(!d){const b=new z("select:missing-feature","Cannot select without a feature.",{feature:d});return f_.error(b),Promise.reject(b)}const{attributes:p,geometry:f,layer:m,sourceLayer:g}=d,_=axe(f),x={layerViewQuery:this._getLayerView(d),elevationQuery:t&&v(_)?w4t(_,t).catch(()=>_):Promise.resolve(_)};return zo(x).then(b=>{const w=b.layerViewQuery.value,T=b.elevationQuery.value;n instanceof nC&&(n.text=e.name);const E=t&&a?e.target||e.extent:null;return(v(E)?this._goToSearchResult(E):Promise.resolve()).then(()=>{var D;const O=w?d:new _i({geometry:f,symbol:n,attributes:p,layer:m,sourceLayer:g,popupTemplate:c}),A=l&&((D=this.view)==null?void 0:D.popup),R=A&&O.getEffectivePopupTemplate(A.defaultPopupTemplateEnabled);return R&&t.popup.open({features:[O],location:T}),w&&Ste(w)&&!R&&this._highlightFeature({graphic:O,layerView:w}),!w&&o&&t&&t.graphics.push(O),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",O),this.emit("select-result",{result:e,source:i,sourceIndex:r}),e})})}suggest(e,t,r){const i=e||this.searchTerm;return this.emit("suggest-start",{searchTerm:i}),this._suggestTimer(t,r).then(()=>this._suggestImmediate(i,r).then(s=>(this._set("suggestions",s.results),this._set("suggestionCount",s.results.reduce((n,o)=>n+o.results.length,0)),this.emit("suggest-complete",s),s)))}async when(){await vx(()=>!this.updating)}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const r=this._updatingPromise=zo([e==null?void 0:e.load(),t==null?void 0:t.when()]);if(this.destroyed||(await r,r!==this._updatingPromise))return}await vx(()=>this.messages),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){var t,r;const e=(r=(t=this.portal)==null?void 0:t.helperServices)==null?void 0:r.geocode;return e?e.map(i=>{if(i.placefinding===!1)return;const s=Gr.apiKey&&bie(i.url)?{url:l6e}:null,n=d6e.fromJSON({...i,...s}),o=n.url;if(bie(o)||J4t(o)||Z4t(o)){const a=n.outFields||["Addr_type","Match_addr","StAddr","City"],l=n.placeholder||this.messages.placeholder,c=typeof n.defaultZoomScale=="number"?n.defaultZoomScale:2500;n.set({singleLineFieldName:"SingleLine",outFields:a,placeholder:l,defaultZoomScale:c})}return n.singleLineFieldName?n:void 0}).filter(Boolean):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach(e=>e==null?void 0:e.destroy()),this._createdFeatureLayers=[]}_getLayerSources(e,t){var i;const r=(i=this.view)==null?void 0:i.map;return e.map(s=>{const n=r.findLayerById(s.id);if(!n)return;const o=this._getLayerJSON(s),a=SO.fromJSON(o);return a.placeholder=t,this._getLayer(n,o).then(l=>{a.layer=l}),a}).filter(Boolean).toArray()}_getTableSources(e,t){var i;const r=(i=this.view)==null?void 0:i.map;return e.map(s=>{const n=r.findTableById(s.id);if(!n)return;const o=this._getLayerJSON(s),a=SO.fromJSON(o);return a.placeholder=t,this._getLayer(n,o).then(l=>{a.layer=l}),a}).filter(Boolean).toArray()}_convertApplicationProperties(){var o,a,l;const e=(o=this.view)==null?void 0:o.map,t=(l=(a=e==null?void 0:e.applicationProperties)==null?void 0:a.viewing)==null?void 0:l.search;if(!t)return[];const{enabled:r,hintText:i,layers:s,tables:n}=t;return r?[...this._getLayerSources(s,i),...this._getTableSources(n,i)]:[]}async _getSubLayer(e,t){if(await e.load(),!e.allSublayers)throw new Error;const r=e.allSublayers.find(s=>s.id===t.subLayer);if(!r)throw new Error;const i=await r.createFeatureLayer();return this._createdFeatureLayers.push(i),i}async _getBuildingSubLayer(e,t){await e.load();const r=e.allSublayers.find(i=>i.id===t.subLayer);if((r==null?void 0:r.type)!=="building-component")throw new Error;if(await r.load(),r.associatedLayer==null)throw new Error;return await r.associatedLayer.load(),r}_getLayer(e,t){return e.type==="feature"||e.type==="scene"||e.type==="csv"||e.type==="geojson"||e.type==="ogc-feature"?Promise.resolve(e):e.type==="map-image"?this._getSubLayer(e,t).catch(()=>{const r=new z("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return f_.error(r),null}):e.type==="building-scene"?this._getBuildingSubLayer(e,t):Promise.resolve(null)}_getLayerJSON(e){return typeof e.toJSON=="function"?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){var i;const e=(i=this.view)==null?void 0:i.popup,{resultGraphic:t}=this;if(!e||!t)return;const{selectedFeature:r}=e;r&&r===t&&e.close()}_suggestTimer(e,t){const r=e!=null?e:this.suggestionDelay;return yx(r,null,t&&t.signal)}_createLocationForSearch(e){return e instanceof _i?axe(e.geometry):e instanceof lt?e:Array.isArray(e)&&e.length===2?new lt({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&uc(e,"key")&&uc(e,"text")&&uc(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),r=typeof e=="string"?e:this.searchTerm,{selectedSuggestion:i,selectedResult:s}=this,n=!e&&i&&s,o=n&&i.key===s.key&&i.sourceIndex===s.sourceIndex,a=n&&i.location;return o||a?i:{location:t,text:t?"":r,sourceIndex:null,key:null}}_getFirstResult(e){let t=null;return e&&e.some(r=>{const{results:i}=r,s=i[0],n=!!s;return n&&(t=s),n}),t}_selectFirstResult(e){return this.autoSelect&&e?this.select(e):Promise.resolve(null)}_suggestImmediate(e,t){return this.when().then(()=>this._getSuggestionsFromSources(e,t)).then(r=>{var s;if((s=t==null?void 0:t.signal)!=null&&s.aborted)return null;const i={activeSourceIndex:this.activeSourceIndex,searchTerm:e,numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(i,r),i})}_formatSourceResponse(e,t,r){const i=t&&t.value||[],s=t&&t.error,n=this.allSources.at(r);if(s){const o={sourceIndex:r,source:n,error:s};e.errors.push(o),f_.error(s),e.numErrors++}else{const o={sourceIndex:r,source:n,results:i};e.results.push(o),e.numResults+=i.length}}_formatResponse(e,t,r){if(t)if(e.activeSourceIndex===CO){const i=r&&uc(r,"sourceIndex")&&r.sourceIndex!==-1?r.sourceIndex:void 0;t.forEach((s,n)=>{const o=i!==void 0?i:n;this._formatSourceResponse(e,s,o)})}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}_getResultsFromSources(e,t){const{allSources:r}=this,i=!e.location&&uc(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,s=[];if(!r.length){const n=new z("search:no-sources-defined","At least one source is required.",{allSources:r});return f_.error(n),Promise.reject(n)}return i===CO?r.forEach((n,o)=>{s.push(this._getResultsFromSource(e,o,t))}):s.push(this._getResultsFromSource(e,i,t)),zo(s)}_getSuggestionsFromSources(e,t){const{allSources:r,activeSourceIndex:i}=this,s=[];if(!r.length){const n=new z("suggest:no-sources-defined","At least one source is required.",{allSources:r});return f_.error(n),Promise.reject(n)}return i===CO?r.forEach((n,o)=>{s.push(this._getSuggestionsFromSource(e,o,t))}):s.push(this._getSuggestionsFromSource(e,i,t)),zo(s)}_getResultsFromSource(e,t,r){var c;const i=this.allSources.at(t),{location:s=null}=e,n=((c=this.view)==null?void 0:c.spatialReference)||uxe,o=uc(i,"maxResults")?i.maxResults:this.maxResults,a=!!(i instanceof SO&&uc(i,"exactMatch"))&&i.exactMatch,{view:l}=this;return i.getResults({view:l,sourceIndex:t,location:s,suggestResult:e,spatialReference:n,exactMatch:a,maxResults:o},r)}_getSuggestionsFromSource(e,t,r){var a;const i=this.allSources.at(t),s=uc(i,"suggestionsEnabled")?i.suggestionsEnabled:this.suggestionsEnabled,n=e.length,o=uc(i,"minSuggestCharacters")?i.minSuggestCharacters:this.minSuggestCharacters;if(s&&e.trim()&&n>=o){const l=((a=this.view)==null?void 0:a.spatialReference)||uxe,c=uc(i,"maxSuggestions")?i.maxSuggestions:this.maxSuggestions,{view:d}=this,p=!!(i instanceof SO&&uc(i,"exactMatch"))&&i.exactMatch;return i.getSuggestions({view:d,sourceIndex:t,suggestTerm:e,spatialReference:l,maxSuggestions:c,exactMatch:p},r)}return Promise.resolve(null)}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return uc(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){const t=this.results;let r=null;return t.some(i=>i.results.some(s=>s===e&&(r=i.sourceIndex,!0))),r}async _goToSearchResult(e){const t=!!e;this._abortGoTo();const r=new AbortController;this._gotoController=r;const i={target:{target:e},options:{animate:t,signal:r.signal}};await this.callGoTo(i),this._gotoController=null}_getDefaultSymbol(e){var i;const{defaultSymbols:t}=this,r=(i=e.feature)==null?void 0:i.geometry;if(C(r))return null;switch(r.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this._handles.remove(cxe)}async _getLayerView(e){const{view:t}=this;if(!e||!t||e.layer.type==="building-component"||e.layer.type==="subtype-sublayer")return null;const{layer:r}=e;return await t.when(),t.whenLayerView(r)}_highlightFeature(e){const{graphic:t,layerView:r}=e,{attributes:i,layer:s}=t,{objectIdField:n}=s,o=i&&i[n],a=r.highlight(o||t);this._handles.add(a,cxe)}_setResultFloor(e){var s,n,o;const{view:t}=this,r=(s=e.feature)==null?void 0:s.attributes,i=(n=e.feature)==null?void 0:n.sourceLayer;if(i&&"floorInfo"in i&&((o=i==null?void 0:i.floorInfo)==null?void 0:o.floorField)&&r){const a=r[i.floorInfo.floorField];t==null||t.emit("select-result-floor",a)}}};jr.ALL_INDEX=CO,u([h()],jr.prototype,"_searching",void 0),u([h()],jr.prototype,"_updatingPromise",void 0),u([h({readOnly:!0,value:null})],jr.prototype,"activeSource",null),u([h()],jr.prototype,"activeSourceIndex",null),u([h()],jr.prototype,"allPlaceholder",null),u([h({readOnly:!0})],jr.prototype,"allSources",null),u([h()],jr.prototype,"autoNavigate",void 0),u([h()],jr.prototype,"autoSelect",void 0),u([h()],jr.prototype,"defaultPopupTemplate",void 0),u([h({readOnly:!0})],jr.prototype,"defaultSources",void 0),u([h()],jr.prototype,"defaultSymbols",void 0),u([h()],jr.prototype,"includeDefaultSources",void 0),u([h()],jr.prototype,"locationEnabled",null),u([h()],jr.prototype,"maxInputLength",void 0),u([h()],jr.prototype,"maxResults",void 0),u([h()],jr.prototype,"maxSuggestions",void 0),u([h()],jr.prototype,"messages",void 0),u([h()],jr.prototype,"minSuggestCharacters",void 0),u([h({readOnly:!0})],jr.prototype,"placeholder",null),u([h()],jr.prototype,"popupEnabled",void 0),u([h({type:Nc})],jr.prototype,"popupTemplate",void 0),u([h({type:oo})],jr.prototype,"portal",void 0),u([h()],jr.prototype,"resultCount",void 0),u([h()],jr.prototype,"resultGraphicEnabled",void 0),u([h({readOnly:!0})],jr.prototype,"resultGraphic",void 0),u([h({readOnly:!0})],jr.prototype,"results",void 0),u([h({readOnly:!0})],jr.prototype,"selectedSuggestion",void 0),u([h()],jr.prototype,"searchAllEnabled",void 0),u([h({readOnly:!0})],jr.prototype,"selectedResult",void 0),u([h()],jr.prototype,"searchTerm",null),u([h({type:g8})],jr.prototype,"sources",void 0),u([h({readOnly:!0})],jr.prototype,"state",null),u([h()],jr.prototype,"suggestionDelay",void 0),u([h()],jr.prototype,"suggestionCount",void 0),u([h({readOnly:!0})],jr.prototype,"suggestions",void 0),u([h()],jr.prototype,"suggestionsEnabled",void 0),u([h({readOnly:!0})],jr.prototype,"updating",null),u([h()],jr.prototype,"view",void 0),u([h()],jr.prototype,"clear",null),jr=u([I(p6e)],jr);const dM=jr,m_={base:"esri-search-result-renderer esri-widget",anchor:"esri-widget__anchor",showMoreResults:"esri-search-result-renderer__more-results--show-more-results",moreResults:"esri-search-result-renderer__more-results",moreResultsList:"esri-search-result-renderer__more-results-list",moreResultsHeader:"esri-search-result-renderer__more-results-header",moreResultsItem:"esri-search-result-renderer__more-results-item",moreResultsListHeader:"esri-search-result-renderer__more-results-list-header"};let Jb=class extends Ss{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}render(){const e={[m_.showMoreResults]:this.showMoreResultsOpen};return P("div",{class:m_.base},P("div",{key:"esri-search-renderer__container",class:this.classes(m_.moreResults,e)},this.renderSearchResultName(),this.renderMoreResults()))}renderMoreResults(){return P("div",{key:"esri-search-renderer__more-results"},this.renderMoreResultsButton(),this.renderMoreResultsLists())}renderSearchResultName(){var r;const e=(r=this.viewModel)==null?void 0:r.selectedResult,t=e&&e.name||"";return P("div",{key:"esri-search-renderer__result-name",class:m_.moreResultsItem},t)}renderMoreResultsLists(){var i;const e=(i=this.viewModel)==null?void 0:i.results,{resultCount:t}=this.viewModel;if(t<2)return null;const r=e.map(s=>this.renderMoreResultsList(s));return P("div",{key:"esri-search-renderer__more-results-container",class:m_.moreResultsList},r)}renderMoreResultsButton(){const{messages:e}=this,{resultCount:t}=this.viewModel;return t<2?null:P("div",{key:"esri-search-renderer__more-results-button",class:m_.moreResultsItem},P("a",{class:m_.anchor,href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults))}renderMoreResultsHeader(e,t){return P("div",{key:`esri-search-result-renderer__header-${t}`,class:m_.moreResultsListHeader},e)}renderMoreResultsList(e){var d,p;const{results:t}=e,r=t.length,i=!!r,s=(d=this.viewModel)==null?void 0:d.selectedResult,n=r===1&&t[0]===s,o=this._getSourceName(e.source,e.sourceIndex),a=((p=this.viewModel)==null?void 0:p.results.length)>1&&!n?this.renderMoreResultsHeader(o,e.sourceIndex):null,l=i&&t.map((f,m)=>this.renderMoreResultsListItem(f,m)),c=i&&!n?P("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},l):null;return i?P("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},a,c):null}renderMoreResultsListItem(e,t){return e!==this.get("viewModel.selectedResult")?P("li",{key:`esri-search-result-renderer__list-item-${t}`},P("a",{class:m_.anchor,href:"#",tabindex:"0",bind:this,"data-result":e,onclick:this._selectResultClick,onkeydown:this._selectResultClick},e.name)):null}_showMoreResultsClick(e){e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const t=this.get("viewModel.view.popup");t&&t.reposition()}_selectResultClick(e){e.preventDefault();const t=e.currentTarget["data-result"];this.viewModel&&this.viewModel.select(t)}_getSourceName(e,t){return t===dM.ALL_INDEX?this.messages.all:e.name}};u([h(),xi("esri/widgets/Search/t9n/Search")],Jb.prototype,"messages",void 0),u([h()],Jb.prototype,"showMoreResultsOpen",void 0),u([h()],Jb.prototype,"viewModel",void 0),u([An()],Jb.prototype,"_showMoreResultsClick",null),u([An()],Jb.prototype,"_selectResultClick",null),Jb=u([I("esri.widgets.Search.SearchResultRenderer")],Jb);const g5t=Jb,Pt={base:"esri-search esri-widget",loader:"esri-widget__loader",loaderText:"esri-widget__loader-text",loaderAnimation:"esri-widget__loader-animation",esriInput:"esri-input",hasMultipleSources:"esri-search--multiple-sources",isLoading:"esri-search--loading",isSearching:"esri-search--searching",showSuggestions:"esri-search--show-suggestions",showSources:"esri-search--sources",showWarning:"esri-search--warning",container:"esri-search__container",input:"esri-search__input",inputContainer:"esri-search__input-container",form:"esri-search__form",submitButton:"esri-search__submit-button",sourcesButton:"esri-search__sources-button",clearButton:"esri-search__clear-button",sourceName:"esri-search__source-name",suggestionsMenu:"esri-search__suggestions-menu",suggestionList:"esri-search__suggestions-list",suggestionListCurrentLocation:"esri-search__suggestions-list--current-location",sourcesMenu:"esri-search__sources-menu",source:"esri-search__source",warningMenu:"esri-search__warning-menu",warningMenuBody:"esri-search__warning-body",warningMenuHeader:"esri-search__warning-header",warningMenuText:"esri-search__warning-text",noValueText:"esri-search__no-value-text",esriWidgetDisabled:"esri-widget--disabled",button:"esri-widget--button",fallbackText:"esri-icon-font-fallback-text",header:"esri-widget__heading",locate:"esri-icon-locate-circled",menu:"esri-menu",menuList:"esri-menu__list",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuHeader:"esri-menu__header",loadingIcon:"esri-icon-loading-indicator esri-rotating",searchIcon:"esri-icon-search",dropdownIcon:"esri-icon-down-arrow esri-search__sources-button--down",dropupIcon:"esri-icon-up-arrow esri-search__sources-button--up",clearIcon:"esri-icon-close",noticeIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-search",disabled:"esri-disabled"},y5t=/<[a-z/][\s\S]*>/i;let Wr=class extends Ss{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._handles=new hr,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new g5t,this._locateFailed=null,this._container=null,this.activeMenu="none",this.disabled=!1,this.iconClass=Pt.widgetIcon,this.messages=null,this.messagesCommon=null,this.viewModel=new dM,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=r=>{var s;const i=r.relatedTarget;i&&((s=this._container)==null?void 0:s.contains(i))||this._clearActiveMenu()},this.addHandles([ie(()=>this.searchTerm,r=>{(r&&this.activeMenu==="warning"||!r&&!this.get("viewModel.selectedSuggestion.location"))&&this._clearActiveMenu()}),ms(()=>{var r;return(r=this.viewModel)==null?void 0:r.allSources},"change",()=>this._watchSourceChanges()),ie(()=>this.activeMenu,()=>this._resetActiveMenuItemIndex(),pt),ie(()=>{var r;return(r=this.viewModel)==null?void 0:r.defaultPopupTemplate},r=>{r&&(r.content=this._renderSearchResultsContent.bind(this))},pt)])}destroy(){this._handles.destroy(),this._handles=null,this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}get activeSource(){return this.viewModel.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this.viewModel.clear()}focus(){var e;(e=this._inputNode)==null||e.focus(),this.emit("search-focus")}blur(){var e;(e=this._inputNode)==null||e.blur(),this.emit("search-blur")}search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=new AbortController,{signal:r}=t;return this._searchController=t,this.viewModel.search(e,{signal:r}).catch(i=>{if(this._searchController===t)return this._clearActiveMenu(),this._searchController=null,i}).then(i=>{if(this._searchController===t)return this.activeMenu=i.numResults?"none":"warning",this._searchController=null,i})}suggest(e){this._cancelSuggest();const t=new AbortController,{signal:r}=t;return this._suggestController=t,this.viewModel.suggest(e,null,{signal:r}).then(i=>{if(this._suggestController===t)return this._suggestController=null,i.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),i}).catch(()=>{if(this._suggestController===t)return this._suggestController=null,null})}render(){const{state:e}=this.viewModel,t={[Pt.disabled]:e==="disabled",[Pt.esriWidgetDisabled]:this.disabled};return P("div",{class:this.classes(Pt.base,t)},e==="loading"?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:e,disabled:t}=this;return P("button",{"aria-label":e.searchButtonTitle,bind:this,disabled:t,class:this.classes(Pt.submitButton,Pt.button),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle,type:"button"},P("span",{"aria-hidden":"true",class:Pt.searchIcon}))}renderWarningMenu(){return P("div",{key:"esri-search__error-menu",class:this.classes(Pt.menu,Pt.warningMenu)},P("div",{class:Pt.warningMenuBody},this.renderWarning()))}renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:r,sourceMenuButtonId:i,disabled:s}=this,{activeSourceIndex:n,allSources:o}=this.viewModel;return o.length>1?P("button",{id:i,key:"esri-search__source-menu-button",bind:this,disabled:s,"aria-label":e.searchIn,title:e.searchIn,"aria-haspopup":"true","aria-expanded":(t==="source").toString(),"aria-controls":r,class:this.classes(Pt.sourcesButton,Pt.button),onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,afterCreate:af,"data-node-ref":"_sourceMenuButtonNode",type:"button"},P("span",{"aria-hidden":"true",class:Pt.dropdownIcon}),P("span",{"aria-hidden":"true",class:Pt.dropupIcon}),P("span",{class:Pt.sourceName},this._getSourceName(n))):null}renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:r,activeMenu:i,sourceMenuId:s,sourceMenuButtonId:n}=this,o=i==="source"&&r>-1?this._buildId("source-item",r):null;return e.length>1?P("ul",{"aria-activedescendant":o,"aria-labelledby":n,id:s,role:"menu",bind:this,afterCreate:af,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:Pt.menuList,tabIndex:-1},t?this.renderSource(dM.ALL_INDEX):null,e.map((a,l)=>this.renderSource(l)).toArray()):null}renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?P("div",{key:"esri-search__source-menu",class:this.classes(Pt.menu,Pt.sourcesMenu)},this.renderSourcesList()):null}renderLoader(){const{messages:e,messagesCommon:t,disabled:r}=this;return P("div",{class:Pt.loader,key:"base-loader",tabIndex:r?-1:null},P("span",{"aria-hidden":"true",class:Pt.loaderAnimation}),P("span",{class:Pt.fallbackText},e.searchButtonTitle),P("span",{class:Pt.loaderText},t.loading))}renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:r}=this,i={[Pt.hasMultipleSources]:e.length>1,[Pt.isLoading]:t==="loading",[Pt.isSearching]:t==="searching",[Pt.showWarning]:r==="warning",[Pt.showSources]:r==="source",[Pt.showSuggestions]:r==="suggestion"};return P("div",{tabIndex:-1,afterCreate:s=>{this._container=s,s.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:s=>{s.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(i,Pt.container),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?P("button",{bind:this,disabled:this.disabled,class:this.classes(Pt.clearButton,Pt.button),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},P("span",{"aria-hidden":"true",class:Pt.clearIcon})):null}renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:r}=this,i=t&&!r,s=this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0;return i?P("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes(Pt.menuList,Pt.suggestionList,Pt.suggestionListCurrentLocation)},P("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===0).toString(),role:"option",class:this.classes(Pt.menuItem,s?Pt.menuItemFocus:null)},P("span",{"aria-hidden":"true",class:Pt.locate})," ",e.useCurrentLocation)):null}renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:r,messages:i,suggestionsMenuId:s,inputId:n,_activeMenuItemIndex:o,disabled:a}=this,{maxInputLength:l,placeholder:c,searchTerm:d,suggestionCount:p}=this.viewModel,f=!(!(t&&!r)&&!p),m=e==="suggestion"&&o>-1?this._buildId("suggestion-item",o):null;return P("input",{"aria-activedescendant":m,"aria-autocomplete":"list","aria-expanded":(f&&e==="suggestion").toString(),"aria-controls":f?s:null,"aria-haspopup":"listbox","aria-label":i.searchButtonTitle,bind:this,disabled:a,placeholder:c,maxlength:l,autocomplete:"off",type:"text",class:this.classes(Pt.esriInput,Pt.input),value:d,id:n,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._openSuggestionMenu,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:af,"data-node-ref":"_inputNode",onfocus:this.focus,onblur:this.blur,title:d?"":c})}renderForm(){return P("form",{key:"esri-search__form",bind:this,disabled:this.disabled,class:Pt.form,onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(e){const{sourceIndex:t}=e,r=e.results.length,i=e.results;return r?P("ul",{role:"group",key:`esri-search__suggestion-list-${t}`,class:this.classes(Pt.menuList,Pt.suggestionList)},i.map(s=>this.renderSuggestion(s,this._menuItemCount++))):null}renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map(t=>[this.renderSuggestionHeader(t),this.renderSuggestList(t)]):null}renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:r,inputId:i}=this,{suggestionCount:s}=this.viewModel,n=t&&!e||s;return this._menuItemCount=0,n?P("div",{id:r,key:"esri-search__suggestions-menu",class:this.classes(Pt.menu,Pt.suggestionsMenu),role:"listbox","aria-labelledby":i,bind:this,afterCreate:af,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return P("div",{key:"esri-search__input-container",class:Pt.inputContainer},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(e){const{allSources:t,activeSourceIndex:r}=this.viewModel,{sourceIndex:i}=e,s=e.results.length,n=t.length>1&&r===dM.ALL_INDEX;return s&&n?P("div",{key:`esri-search__suggestion-header-${i}`,class:Pt.menuHeader},this._getSourceName(i)):null}renderSuggestion(e,t){const{_activeMenuItemIndex:r,messages:i}=this,{searchTerm:s}=this.viewModel;if(s){const{text:n}=e,o=n||i.untitledResult,a=y5t.test(o),l=[];if(a)l.push(P("div",{innerHTML:o}));else{const d=this._splitResult(o,s),p=s.toLowerCase();d.forEach((f,m)=>{f&&f.length&&(f.toLowerCase()===p?l.push(P("strong",{key:m},f)):l.push(f))})}const c=this.activeMenu==="suggestion"&&r===t;return P("li",{bind:this,id:this._buildId("suggestion-item",t),"aria-selected":(this.activeMenu==="suggestion"&&this._activeMenuItemIndex===t).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${t}`,"data-suggestion":e,role:"option",class:this.classes(Pt.menuItem,c?Pt.menuItemFocus:null)},l)}}renderSource(e){const{activeSourceIndex:t,searchAllEnabled:r}=this.viewModel,i={[Pt.menuItemActive]:e===t,[Pt.menuItemFocus]:this.activeMenu==="source"&&e===(r?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},s=r?e+1:e;return P("li",{bind:this,key:`esri-search__source-${e}`,id:this._buildId("source-item",s),"aria-checked":(e===t).toString(),onclick:this._handleSourceClick,"data-source-index":e,role:"menuitemradio",class:this.classes(Pt.source,Pt.menuItem,i)},this._getSourceName(e))}renderNoResultsWarning(e){const{messages:t}=this,r=e?hu(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return P("div",{key:"esri-search__no_results"},P("div",{class:Pt.warningMenuHeader},t.noResults),P("div",{class:Pt.warningMenuText},r))}renderEmptySearchWarning(){const{messages:e}=this;return P("div",{key:"esri-search__empty-search"},P("span",{"aria-hidden":"true",class:Pt.noticeIcon}),P("span",{class:Pt.noValueText},e.emptyValue))}renderLocateWarning(){const{messages:e}=this;return P("div",{key:"esri-search__locate-error"},P("span",{"aria-hidden":"true",class:Pt.noticeIcon}),P("span",{class:Pt.noValueText},e.locateError))}renderWarning(){var i;const{displayedSearchTerm:e,_locateFailed:t}=this,{viewModel:r}=this;return t?this.renderLocateWarning():((i=r.selectedSuggestion)==null?void 0:i.location)||e?this.renderNoResultsWarning(e):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${t===void 0?"":`-${t}`}`}_watchSourceChanges(){const{_handles:e,viewModel:{allSources:t}}=this,r="sources";e.remove(r),t.forEach(i=>e.add(ie(()=>i.name,()=>this.scheduleRender()),r))}_handleSourcesMenuToggleFocus(){this.activeMenu!=="source"&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){var t;const e=this.activeMenu==="source";this.activeMenu=e?"none":"source",this.renderNow(),this.activeMenu==="source"&&((t=this._sourceListNode)==null||t.focus())}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const t=e.currentTarget["data-suggestion"];t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=new AbortController,{signal:t}=e;this._searchController=e,this.viewModel.searchNearby({signal:t}).then(r=>{this.activeMenu=r.numResults?"none":"warning"}).catch(()=>{this._locateFailed=!0,this.activeMenu="warning"}).then(()=>{this._searchController=null})}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){var r;if(!e)return;const t=e["data-source-index"];this.viewModel.activeSourceIndex=t,this._clearActiveMenu(),(r=this._sourceMenuButtonNode)==null||r.focus()}_cancelSuggest(){this._suggestController&&(this._suggestController.abort(),this._suggestController=null)}_cancelSearch(){this._searchController&&(this._searchController.abort(),this._searchController=null),this._locateFailed=!1}_handleInputKeyup(e){var s;const t=Uo(e);if(e.ctrlKey||e.metaKey||t==="Copy"||t==="ArrowLeft"||t==="ArrowRight"||t==="Shift")return;if(t==="Tab"||t==="Escape"||e.shiftKey&&t==="Tab")return this._cancelSuggest(),void(t==="Escape"&&this._clearActiveMenu());const r=t==="Home"||t==="End"||t==="ArrowUp"||t==="ArrowDown";if(t==="Enter"&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const i=(s=this._suggestionListNode)==null?void 0:s.getElementsByTagName("li");if(i!=null&&i.length){if(this.activeMenu!=="suggestion"&&this._openSuggestionMenu(),r)return e.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(t,i,this._suggestionListNode);const n=i[this._activeMenuItemIndex];if(t==="Enter"&&n){const o=n["data-suggestion"];return void(o?(this._focus(),this.search(o)):n["data-current-location-item"]&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(e,t,r){const i=this._activeMenuItemIndex;e==="Home"&&(this._activeMenuItemIndex=0),e==="End"&&(this._activeMenuItemIndex=t.length-1),e==="ArrowUp"&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),e==="ArrowDown"&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),i!==this._activeMenuItemIndex&&f7e(t[this._activeMenuItemIndex],r)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){const t=Uo(e);if(Ow(t)){e.preventDefault();const r=this._sourceListNode.getElementsByTagName("li")[this._activeMenuItemIndex];this._setSourceFromMenuItem(r)}else t!=="ArrowUp"&&t!=="ArrowDown"&&t!=="End"&&t!=="Home"||e.preventDefault()}_handleSourceMenuKeyup(e){var s,n;const t=Uo(e),r=t==="ArrowUp"||t==="ArrowDown"||t==="End"||t==="Home";if(r&&e.preventDefault(),t==="Escape")return this._clearActiveMenu(),void((s=this._sourceMenuButtonNode)==null?void 0:s.focus());const i=(n=this._sourceListNode)==null?void 0:n.getElementsByTagName("li");return i&&i.length!==0&&r?(this.activeMenu!=="source"&&(this.activeMenu="source"),void this._handleItemNavigation(t,i,this._sourceListNode.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),this._activeMenuItemIndex===-1&&this.search()}_getSourceName(e){const{messages:t}=this,r=this.viewModel,{allSources:i}=r,s=i.getItemAt(e);return e===dM.ALL_INDEX?t.all:s&&s.name||t.untitledSource}_splitResult(e,t){const r=yze(t);return e.replace(new RegExp(`(^|)(${r})(|$)`,"ig"),"$1|$2|$3").split("|")}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};u([h()],Wr.prototype,"_activeMenuItemIndex",void 0),u([h()],Wr.prototype,"displayedSearchTerm",null),u([h({readOnly:!0})],Wr.prototype,"inputId",null),u([h({readOnly:!0})],Wr.prototype,"suggestionsMenuId",null),u([h({readOnly:!0})],Wr.prototype,"sourceMenuId",null),u([h({readOnly:!0})],Wr.prototype,"sourceMenuButtonId",null),u([h()],Wr.prototype,"activeMenu",void 0),u([h({readOnly:!0})],Wr.prototype,"activeSource",null),u([h()],Wr.prototype,"activeSourceIndex",null),u([h()],Wr.prototype,"allPlaceholder",null),u([h({readOnly:!0})],Wr.prototype,"allSources",null),u([h()],Wr.prototype,"autoNavigate",null),u([h()],Wr.prototype,"autoSelect",null),u([h({readOnly:!0})],Wr.prototype,"defaultSources",null),u([h()],Wr.prototype,"disabled",void 0),u([h()],Wr.prototype,"goToOverride",null),u([h()],Wr.prototype,"iconClass",void 0),u([h()],Wr.prototype,"includeDefaultSources",null),u([h()],Wr.prototype,"label",null),u([h()],Wr.prototype,"locationEnabled",null),u([h()],Wr.prototype,"maxResults",null),u([h()],Wr.prototype,"maxSuggestions",null),u([h(),xi("esri/widgets/Search/t9n/Search")],Wr.prototype,"messages",void 0),u([h(),xi("esri/t9n/common")],Wr.prototype,"messagesCommon",void 0),u([h()],Wr.prototype,"minSuggestCharacters",null),u([h()],Wr.prototype,"popupEnabled",null),u([h()],Wr.prototype,"popupTemplate",null),u([h()],Wr.prototype,"portal",null),u([h()],Wr.prototype,"resultGraphic",null),u([h()],Wr.prototype,"resultGraphicEnabled",null),u([h({readOnly:!0})],Wr.prototype,"results",null),u([h()],Wr.prototype,"searchAllEnabled",null),u([h()],Wr.prototype,"searchTerm",null),u([h({readOnly:!0})],Wr.prototype,"selectedResult",null),u([h()],Wr.prototype,"sources",null),u([h({readOnly:!0})],Wr.prototype,"suggestions",null),u([h()],Wr.prototype,"suggestionsEnabled",null),u([h()],Wr.prototype,"view",null),u([eoe(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),h({type:dM})],Wr.prototype,"viewModel",void 0),Wr=u([I("esri.widgets.Search")],Wr);const _5t=Wr;function v5t(e){let{r:t,g:r,b:i,a:s}=e;return s<1&&(t=Math.round(s*t+255*(1-s)),r=Math.round(s*r+255*(1-s)),i=Math.round(s*i+255*(1-s))),new Ze({r:t,g:r,b:i})}function b5t(e){const{r:t,g:r,b:i}=v5t(e);return .2126*t+.7152*r+.0722*i}function f6e(e,t){const r=e.a*t;return b5t(e)>225?new Ze([0,0,0,r]):new Ze([255,255,255,r])}function m6e(e,t){const r=new Ze(e);return r.a*=t,r}function g6e(e=1){return m6e(Gr.analysisTheme.accentColor,e)}function mzt(e=1){return f6e(g6e(),e)}function w5t(e=1){return m6e(Gr.analysisTheme.textColor,e)}function gzt(e=1){return f6e(w5t(),e)}let G_=class extends Qoe(Ej(fE)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new V2,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};u([h({type:cRe})],G_.prototype,"elevationInfo",void 0),u([h(tV(V2,"graphics"))],G_.prototype,"graphics",void 0),u([h({type:["show","hide"]})],G_.prototype,"listMode",void 0),u([h()],G_.prototype,"screenSizePerspectiveEnabled",void 0),u([h({readOnly:!0})],G_.prototype,"type",void 0),u([h({constructOnly:!0})],G_.prototype,"internal",void 0),G_=u([I("esri.layers.GraphicsLayer")],G_);const x5t=G_;let H_=class extends fe{constructor(e){super(e),this.break=new ko({color:[255,255,255],size:12,outline:{color:[0,122,194],width:3}}),this.first=new ko({color:[0,255,0],size:20,outline:{color:[255,255,255],width:4}}),this.unlocated=new ko({color:[255,0,0],size:12,outline:{color:[255,255,255],width:3}}),this.last=new ko({color:[255,0,0],size:20,outline:{color:[255,255,255],width:4}}),this.middle=new ko({color:[51,51,51],size:12,outline:{color:[0,122,194],width:3}}),this.waypoint=new ko({color:[255,255,255],size:12,outline:{color:[0,122,194],width:3}})}};u([h({types:un})],H_.prototype,"break",void 0),u([h({types:un})],H_.prototype,"first",void 0),u([h({types:un})],H_.prototype,"unlocated",void 0),u([h({types:un})],H_.prototype,"last",void 0),u([h({types:un})],H_.prototype,"middle",void 0),u([h({types:un})],H_.prototype,"waypoint",void 0),H_=u([I("esri.layers.support.RouteStopSymbols")],H_);const Aue=H_;let Ay=class extends fe{constructor(e){super(e),this.directionLines=new Ul({color:[0,122,194],width:6}),this.directionPoints=new ko({color:[255,255,255],size:6,outline:{color:[0,122,194],width:2}}),this.pointBarriers=new ko({style:"x",size:10,outline:{color:[255,0,0],width:3}}),this.polygonBarriers=new L0({color:[255,170,0,.6],outline:{width:7.5,color:[255,0,0,.6]}}),this.polylineBarriers=new Ul({width:7.5,color:[255,85,0,.7]}),this.routeInfo=new Ul({width:8,color:[20,89,127]}),this.stops=new Aue}};u([h({types:un})],Ay.prototype,"directionLines",void 0),u([h({types:un})],Ay.prototype,"directionPoints",void 0),u([h({types:un})],Ay.prototype,"pointBarriers",void 0),u([h({types:un})],Ay.prototype,"polygonBarriers",void 0),u([h({types:un})],Ay.prototype,"polylineBarriers",void 0),u([h({types:un})],Ay.prototype,"routeInfo",void 0),u([h({type:Aue})],Ay.prototype,"stops",void 0),Ay=u([I("esri.layers.support.RouteSymbols")],Ay);const Oue=Ay;async function T5t(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return jO(e);const r=Ve.WGS84;return await OIe(t,r),cC(e,r)}function yzt(e,t){if(!S5t(e,t)){const r=e.typeKeywords;r?r.push(t):e.typeKeywords=[t]}}function S5t(e,t){var r;return!!((r=e.typeKeywords)!=null&&r.includes(t))}function _zt(e,t){const r=e.typeKeywords;if(r){const i=r.indexOf(t);i>-1&&r.splice(i,1)}}async function vzt(e){const t=e.clone().normalize();let r;if(t.length>1)for(const i of t)r?i.width>r.width&&(r=i):r=i;else r=t[0];return T5t(r)}const E5t={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"};let _m=class extends fe{constructor(e){super(e),this.dataType=null,this.name=null,this.parameterNames=null,this.restrictionUsageParameterName=null,this.timeNeutralAttributeName=null,this.trafficSupport=null,this.units=null,this.usageType=null}};u([h({type:String})],_m.prototype,"dataType",void 0),u([Ue(Bd,{ignoreUnknown:!1})],_m.prototype,"name",void 0),u([h({type:[String]})],_m.prototype,"parameterNames",void 0),u([h({type:String})],_m.prototype,"restrictionUsageParameterName",void 0),u([Ue(tH,{ignoreUnknown:!1})],_m.prototype,"timeNeutralAttributeName",void 0),u([h({type:String})],_m.prototype,"trafficSupport",void 0),u([h({type:String})],_m.prototype,"units",void 0),u([Ue(_4t)],_m.prototype,"usageType",void 0),_m=u([I("esri.rest.support.NetworkAttribute")],_m);const C5t=_m;let Kb=class extends fe{constructor(e){super(e),this.buildTime=null,this.name=null,this.networkAttributes=null,this.networkSources=null,this.state=null}};u([h({type:Number})],Kb.prototype,"buildTime",void 0),u([h({type:String})],Kb.prototype,"name",void 0),u([h({type:[C5t]})],Kb.prototype,"networkAttributes",void 0),u([h()],Kb.prototype,"networkSources",void 0),u([h({type:String})],Kb.prototype,"state",void 0),Kb=u([I("esri.rest.support.NetworkDataset")],Kb);const A5t=Kb;let rl=class extends ki(fe){constructor(e){super(e),this.attributeParameterValues=null,this.description=null,this.distanceAttributeName=null,this.id=null,this.impedanceAttributeName=null,this.name=null,this.restrictionAttributeNames=null,this.simplificationTolerance=null,this.simplificationToleranceUnits=null,this.timeAttributeName=null,this.type=null,this.useHierarchy=null,this.uturnAtJunctions=null}readRestrictionAttributes(e,t){const{restrictionAttributeNames:r}=t;return C(r)?null:r.map(i=>_9.fromJSON(i))}writeRestrictionAttributes(e,t,r){C(e)||(t[r]=e.map(i=>_9.toJSON(i)))}};u([h({type:[Object],json:{write:!0}})],rl.prototype,"attributeParameterValues",void 0),u([h({type:String,json:{write:!0}})],rl.prototype,"description",void 0),u([Ue(m4t,{ignoreUnknown:!1})],rl.prototype,"distanceAttributeName",void 0),u([h({type:String,json:{write:!0}})],rl.prototype,"id",void 0),u([Ue(Bd,{ignoreUnknown:!1})],rl.prototype,"impedanceAttributeName",void 0),u([h({type:String,json:{write:!0}})],rl.prototype,"name",void 0),u([h({type:[String],json:{write:!0}})],rl.prototype,"restrictionAttributeNames",void 0),u([me("restrictionAttributeNames")],rl.prototype,"readRestrictionAttributes",null),u([Le("restrictionAttributeNames")],rl.prototype,"writeRestrictionAttributes",null),u([h({type:Number,json:{write:{allowNull:!0}}})],rl.prototype,"simplificationTolerance",void 0),u([Ue(VUe)],rl.prototype,"simplificationToleranceUnits",void 0),u([Ue(tH,{ignoreUnknown:!1})],rl.prototype,"timeAttributeName",void 0),u([Ue(p4t)],rl.prototype,"type",void 0),u([h({type:Boolean,json:{write:!0}})],rl.prototype,"useHierarchy",void 0),u([Ue(jUe)],rl.prototype,"uturnAtJunctions",void 0),rl=u([I("esri.rest.support.TravelMode")],rl);const Mue=rl;let bc=class extends fe{constructor(e){super(e),this.accumulateAttributeNames=null,this.currentVersion=null,this.defaultTravelMode=null,this.directionsLanguage=null,this.directionsLengthUnits=null,this.directionsSupportedLanguages=null,this.directionsTimeAttribute=null,this.hasZ=null,this.impedance=null,this.networkDataset=null,this.supportedTravelModes=null}readAccumulateAttributes(e){return C(e)?null:e.map(t=>Bd.fromJSON(t))}writeAccumulateAttributes(e,t,r){!C(e)&&e.length&&(t[r]=e.map(i=>Bd.toJSON(i)))}};u([h()],bc.prototype,"accumulateAttributeNames",void 0),u([me("accumulateAttributeNames")],bc.prototype,"readAccumulateAttributes",null),u([Le("accumulateAttributeNames")],bc.prototype,"writeAccumulateAttributes",null),u([h()],bc.prototype,"currentVersion",void 0),u([h()],bc.prototype,"defaultTravelMode",void 0),u([h()],bc.prototype,"directionsLanguage",void 0),u([Ue(xue)],bc.prototype,"directionsLengthUnits",void 0),u([h()],bc.prototype,"directionsSupportedLanguages",void 0),u([Ue(tH,{ignoreUnknown:!1})],bc.prototype,"directionsTimeAttribute",void 0),u([h()],bc.prototype,"hasZ",void 0),u([Ue(Bd,{ignoreUnknown:!1})],bc.prototype,"impedance",void 0),u([h({type:A5t})],bc.prototype,"networkDataset",void 0),u([h({type:[Mue]})],bc.prototype,"supportedTravelModes",void 0),bc=u([I("esri.rest.support.NetworkServiceDescription")],bc);const O5t=bc,M5t=te.getLogger("esri.rest.networkService");function QU(e,t,r,i){i[r]=[t.length,t.length+e.length],e.forEach(s=>{t.push(s.geometry)})}function R5t(e,t){for(let r=0;r<t.length;r++){const i=e[t[r]];if(i&&i.length)for(const s of i)s.z=void 0}M5t.warnOnce(`The remote Network Analysis service is powered by a network dataset which is not Z-aware.
Z-coordinates of the input geometry are ignored.`)}function I5t(e,t){for(let r=0;r<t.length;r++){const i=e[t[r]];if(i&&i.length){for(const s of i)if(v(s)&&s.hasZ)return!0}}return!1}async function Rue(e,t,r){if(!e)throw new z("network-service:missing-url","Url to Network service is missing");const i=Ox({f:"json",token:t},r),{data:s}=await lr(e,i);s.supportedTravelModes||(s.supportedTravelModes=[]);for(let l=0;l<s.supportedTravelModes.length;l++)s.supportedTravelModes[l].id||(s.supportedTravelModes[l].id=s.supportedTravelModes[l].itemId);const n=s.currentVersion>=10.4?$5t(e,t,r):P5t(e,r),{defaultTravelMode:o,supportedTravelModes:a}=await n;return s.defaultTravelMode=o,s.supportedTravelModes=a,O5t.fromJSON(s)}async function P5t(e,t){var _,x,b;const r=Ox({f:"json"},t),{data:i}=await lr(e.replace(/\/rest\/.*$/i,"/info"),r);if(!i||!i.owningSystemUrl)return{supportedTravelModes:[],defaultTravelMode:null};const{owningSystemUrl:s}=i,n=YL(s)+"/sharing/rest/portals/self",{data:o}=await lr(n,r),a=ZE("helperServices.routingUtilities.url",o);if(!a)return{supportedTravelModes:[],defaultTravelMode:null};const l=eT(s),c=/\/solve$/i.test(l.path)?"Route":/\/solveclosestfacility$/i.test(l.path)?"ClosestFacility":"ServiceAreas",d=Ox({f:"json",serviceName:c},t),p=YL(a)+"/GetTravelModes/execute",f=await lr(p,d),m=[];let g=null;if((x=(_=f==null?void 0:f.data)==null?void 0:_.results)!=null&&x.length){const w=f.data.results;for(const T of w)if(T.paramName==="supportedTravelModes"){if((b=T.value)!=null&&b.features){for(const{attributes:E}of T.value.features)if(E){const O=JSON.parse(E.TravelMode);m.push(O)}}}else T.paramName==="defaultTravelMode"&&(g=T.value)}return{supportedTravelModes:m,defaultTravelMode:g}}async function $5t(e,t,r){try{const i=Ox({f:"json",token:t},r),s=YL(e)+"/retrieveTravelModes",{data:{supportedTravelModes:n,defaultTravelMode:o}}=await lr(s,i);return{supportedTravelModes:n,defaultTravelMode:o}}catch(i){throw new z("network-service:retrieveTravelModes","Could not get to the NAServer's retrieveTravelModes.",{error:i})}}const dxe=new gr({esriJobMessageTypeInformative:"informative",esriJobMessageTypeProcessDefinition:"process-definition",esriJobMessageTypeProcessStart:"process-start",esriJobMessageTypeProcessStop:"process-stop",esriJobMessageTypeWarning:"warning",esriJobMessageTypeError:"error",esriJobMessageTypeEmpty:"empty",esriJobMessageTypeAbort:"abort"});let sD=class extends fe{constructor(e){super(e),this.description=null,this.type=null}};u([h({type:String,json:{write:!0}})],sD.prototype,"description",void 0),u([h({type:String,json:{read:dxe.read,write:dxe.write}})],sD.prototype,"type",void 0),sD=u([I("esri.rest.support.GPMessage")],sD);const D5t=sD,hxe=new gr({0:"informative",1:"process-definition",2:"process-start",3:"process-stop",50:"warning",100:"error",101:"empty",200:"abort"});let y8=class extends D5t{constructor(e){super(e),this.type=null}};u([h({type:String,json:{read:hxe.read,write:hxe.write}})],y8.prototype,"type",void 0),y8=u([I("esri.rest.support.NAMessage")],y8);const L5t=y8;let nD=class extends fe{constructor(e){super(e)}};u([h({json:{read:{source:"string"}}})],nD.prototype,"text",void 0),u([Ue(v4t,{name:"stringType"})],nD.prototype,"type",void 0),nD=u([I("esri.rest.support.DirectionsString")],nD);const y6e=nD;let q_=class extends fe{constructor(e){super(e),this.arriveTime=null,this.arriveTimeOffset=null,this.geometry=null,this.strings=null}readArriveTimeOffset(e,t){return xF(t.ETA,t.arriveTimeUTC)}readGeometry(e,t){return lt.fromJSON(t.point)}};u([h({type:Date,json:{read:{source:"arriveTimeUTC"}}})],q_.prototype,"arriveTime",void 0),u([h()],q_.prototype,"arriveTimeOffset",void 0),u([me("arriveTimeOffset",["arriveTimeUTC","ETA"])],q_.prototype,"readArriveTimeOffset",null),u([h({type:lt})],q_.prototype,"geometry",void 0),u([me("geometry",["point"])],q_.prototype,"readGeometry",null),u([h({type:[y6e]})],q_.prototype,"strings",void 0),q_=u([I("esri.rest.support.DirectionsEvent")],q_);const N5t=q_;function F5t(e){if(C(e)||e==="")return null;let t=0,r=0,i=0,s=0;const n=[];let o,a,l,c,d,p,f,m,g=0,_=0,x=0;if(d=e.match(/((\+|\-)[^\+\-\|]+|\|)/g),d||(d=[]),parseInt(d[g],32)===0){g=2;const b=parseInt(d[g],32);g++,p=parseInt(d[g],32),g++,1&b&&(_=d.indexOf("|")+1,f=parseInt(d[_],32),_++),2&b&&(x=d.indexOf("|",_)+1,m=parseInt(d[x],32),x++)}else p=parseInt(d[g],32),g++;for(;g<d.length&&d[g]!=="|";){o=parseInt(d[g],32)+t,g++,t=o,a=parseInt(d[g],32)+r,g++,r=a;const b=[o/p,a/p];_&&(c=parseInt(d[_],32)+i,_++,i=c,b.push(c/f)),x&&(l=parseInt(d[x],32)+s,x++,s=l,b.push(l/m)),n.push(b)}return{paths:[n],hasZ:_>0,hasM:x>0}}let AO=class extends _i{constructor(e){super(e),this.events=null,this.strings=null}readGeometry(e,t){const r=F5t(t.compressedGeometry);return v(r)?ja.fromJSON(r):null}};u([h({type:[N5t]})],AO.prototype,"events",void 0),u([me("geometry",["compressedGeometry"])],AO.prototype,"readGeometry",null),u([h({type:[y6e]})],AO.prototype,"strings",void 0),AO=u([I("esri.rest.support.DirectionsFeature")],AO);const k5t=AO;function U5t(e,t){if(e.length===0)return new ja({spatialReference:t});const r=[];for(const o of e)for(const a of o.paths)r.push(...a);const i=[];r.forEach((o,a)=>{a!==0&&o[0]===r[a-1][0]&&o[1]===r[a-1][1]||i.push(o)});const{hasM:s,hasZ:n}=e[0];return new ja({hasM:s,hasZ:n,paths:[i],spatialReference:t})}let sd=class extends bd{constructor(e){super(e),this.extent=null,this.features=null,this.geometryType="polyline",this.routeId=null,this.routeName=null,this.totalDriveTime=null,this.totalLength=null,this.totalTime=null}readFeatures(e,t){var s;if(!e)return[];const r=(s=t.summary.envelope.spatialReference)!=null?s:t.spatialReference,i=r&&Ve.fromJSON(r);return e.map(n=>{const o=k5t.fromJSON(n);if(v(o.geometry)&&(o.geometry.spatialReference=i),v(o.events))for(const a of o.events)v(a.geometry)&&(a.geometry.spatialReference=i);return o})}get mergedGeometry(){return this.features?U5t(this.features.map(({geometry:e})=>e),this.extent.spatialReference):null}get strings(){return this.features.map(({strings:e})=>e).flat().filter(v)}};u([h({type:Sr,json:{read:{source:"summary.envelope"}}})],sd.prototype,"extent",void 0),u([h()],sd.prototype,"features",void 0),u([me("features")],sd.prototype,"readFeatures",null),u([h()],sd.prototype,"geometryType",void 0),u([h({readOnly:!0})],sd.prototype,"mergedGeometry",null),u([h()],sd.prototype,"routeId",void 0),u([h()],sd.prototype,"routeName",void 0),u([h({value:null,readOnly:!0})],sd.prototype,"strings",null),u([h({json:{read:{source:"summary.totalDriveTime"}}})],sd.prototype,"totalDriveTime",void 0),u([h({json:{read:{source:"summary.totalLength"}}})],sd.prototype,"totalLength",void 0),u([h({json:{read:{source:"summary.totalTime"}}})],sd.prototype,"totalTime",void 0),sd=u([I("esri.rest.support.DirectionsFeatureSet")],sd);const B5t=sd;let Np=class extends fe{constructor(e){super(e),this.directionLines=null,this.directionPoints=null,this.directions=null,this.route=null,this.routeName=null,this.stops=null,this.traversedEdges=null,this.traversedJunctions=null,this.traversedTurns=null}};u([h({type:bd,json:{write:!0}})],Np.prototype,"directionLines",void 0),u([h({type:bd,json:{write:!0}})],Np.prototype,"directionPoints",void 0),u([h({type:B5t,json:{write:!0}})],Np.prototype,"directions",void 0),u([h({type:_i,json:{write:!0}})],Np.prototype,"route",void 0),u([h({type:String,json:{write:!0}})],Np.prototype,"routeName",void 0),u([h({type:[_i],json:{write:!0}})],Np.prototype,"stops",void 0),u([h({type:bd,json:{write:!0}})],Np.prototype,"traversedEdges",void 0),u([h({type:bd,json:{write:!0}})],Np.prototype,"traversedJunctions",void 0),u([h({type:bd,json:{write:!0}})],Np.prototype,"traversedTurns",void 0),Np=u([I("esri.rest.support.RouteResult")],Np);const z5t=Np;function XY(e){return e&&bd.fromJSON(e).features.map(t=>t)}let vm=class extends fe{constructor(e){super(e),this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routeResults=null}readPointBarriers(e,t){return XY(t.barriers)}readPolylineBarriers(e){return XY(e)}readPolygonBarriers(e){return XY(e)}};u([h({type:[L5t]})],vm.prototype,"messages",void 0),u([h({type:[_i]})],vm.prototype,"pointBarriers",void 0),u([me("pointBarriers",["barriers"])],vm.prototype,"readPointBarriers",null),u([h({type:[_i]})],vm.prototype,"polylineBarriers",void 0),u([me("polylineBarriers")],vm.prototype,"readPolylineBarriers",null),u([h({type:[_i]})],vm.prototype,"polygonBarriers",void 0),u([me("polygonBarriers")],vm.prototype,"readPolygonBarriers",null),u([h({type:[z5t]})],vm.prototype,"routeResults",void 0),vm=u([I("esri.rest.support.RouteSolveResult")],vm);const V5t=vm;function e6(e){return e instanceof bd}async function j5t(e,t,r){const i=[],s=[],n={},o={},a=eT(e),{path:l}=a;e6(t.stops)&&QU(t.stops.features,s,"stops.features",n),e6(t.pointBarriers)&&QU(t.pointBarriers.features,s,"pointBarriers.features",n),e6(t.polylineBarriers)&&QU(t.polylineBarriers.features,s,"polylineBarriers.features",n),e6(t.polygonBarriers)&&QU(t.polygonBarriers.features,s,"polygonBarriers.features",n);const c=await Gae(s);for(const m in n){const g=n[m];i.push(m),o[m]=c.slice(g[0],g[1])}if(I5t(o,i)){let m=null;try{m=await Rue(l,t.apiKey,r)}catch{}m&&!m.hasZ&&R5t(o,i)}for(const m in o)o[m].forEach((g,_)=>{t.get(m)[_].geometry=g});const d={...r,query:{...a.query,...b4t(t),f:"json"}},p=l.endsWith("/solve")?l:`${l}/solve`,{data:f}=await lr(p,d);return G5t(f)}function G5t(e){var b;const{barriers:t,directionLines:r,directionPoints:i,directions:s,messages:n,polygonBarriers:o,polylineBarriers:a,routes:l,stops:c,traversedEdges:d,traversedJunctions:p,traversedTurns:f}=e,m=w=>{const T=_.find(O=>O.routeName===w);if(v(T))return T;const E={routeId:_.length+1,routeName:w};return _.push(E),E},g=w=>{const T=_.find(O=>O.routeId===w);if(v(T))return T;const E={routeId:w,routeName:null};return _.push(E),E},_=[];l==null||l.features.forEach((w,T)=>{w.geometry.spatialReference=l.spatialReference;const E=w.attributes.Name,O=T+1;_.push({routeId:O,routeName:E,route:w})}),s==null||s.forEach(w=>{const{routeName:T}=w;m(T).directions=w});const x=((b=c==null?void 0:c.features.every(w=>C(w.attributes.RouteName)))!=null?b:!1)&&_.length>0?_[0].routeName:null;return c==null||c.features.forEach(w=>{var A,R;var T;w.geometry&&((A=(T=w.geometry).spatialReference)!=null||(T.spatialReference=c.spatialReference));const E=x!=null?x:w.attributes.RouteName,O=m(E);(R=O.stops)!=null||(O.stops=[]),O.stops.push(w)}),r==null||r.features.forEach(w=>{var R;const T=w.attributes.RouteID,E=g(T),{geometryType:O,spatialReference:A}=r;(R=E.directionLines)!=null||(E.directionLines={features:[],geometryType:O,spatialReference:A}),E.directionLines.features.push(w)}),i==null||i.features.forEach(w=>{var R;const T=w.attributes.RouteID,E=g(T),{geometryType:O,spatialReference:A}=i;(R=E.directionPoints)!=null||(E.directionPoints={features:[],geometryType:O,spatialReference:A}),E.directionPoints.features.push(w)}),d==null||d.features.forEach(w=>{var R;const T=w.attributes.RouteID,E=g(T),{geometryType:O,spatialReference:A}=d;(R=E.traversedEdges)!=null||(E.traversedEdges={features:[],geometryType:O,spatialReference:A}),E.traversedEdges.features.push(w)}),p==null||p.features.forEach(w=>{var R;const T=w.attributes.RouteID,E=g(T),{geometryType:O,spatialReference:A}=p;(R=E.traversedJunctions)!=null||(E.traversedJunctions={features:[],geometryType:O,spatialReference:A}),E.traversedJunctions.features.push(w)}),f==null||f.features.forEach(w=>{var O;const T=w.attributes.RouteID,E=g(T);(O=E.traversedTurns)!=null||(E.traversedTurns={features:[]}),E.traversedTurns.features.push(w)}),V5t.fromJSON({routeResults:_,barriers:t,polygonBarriers:o,polylineBarriers:a,messages:n})}var xie;let wc=xie=class extends ki(fe){constructor(e){super(e),this.directionLineType=null,this.directionPointId=null,this.distance=null,this.duration=null,this.fromLevel=null,this.geometry=null,this.objectId=null,this.popupTemplate=null,this.symbol=null,this.toLevel=null,this.type="direction-line"}static fromGraphic(e){var t,r,i;return new xie({directionLineType:y9.fromJSON(e.attributes.DirectionLineType),directionPointId:e.attributes.DirectionPointID,distance:e.attributes.Meters,duration:e.attributes.Minutes,fromLevel:(t=e.attributes.FromLevel)!=null?t:null,geometry:e.geometry,objectId:(r=e.attributes.ObjectID)!=null?r:e.attributes.__OBJECTID,popupTemplate:e.popupTemplate,symbol:e.symbol,toLevel:(i=e.attributes.ToLevel)!=null?i:null})}toGraphic(){const e={ObjectID:this.objectId,DirectionLineType:v(this.directionLineType)?y9.toJSON(this.directionLineType):null,DirectionPointID:this.directionPointId,Meters:this.distance,Minutes:this.duration};return v(this.fromLevel)&&(e.FromLevel=this.fromLevel),v(this.toLevel)&&(e.ToLevel=this.toLevel),new _i({geometry:this.geometry,attributes:e,symbol:this.symbol,popupTemplate:this.popupTemplate})}};wc.fields=[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID",editable:!1,nullable:!1,domain:null},{name:"DirectionLineType",alias:"Line Type",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0,domain:{type:"codedValue",name:"esriDirectionsLineType",codedValues:[{name:"Unknown",code:0},{name:"Segment",code:1},{name:"Maneuver Segment",code:2},{name:"Restriction violation",code:3},{name:"Scale cost barrier crossing",code:4},{name:"Heavy Traffic",code:5},{name:"Slow Traffic",code:6},{name:"Moderate Traffic",code:7}]}},{name:"DirectionPointID",alias:"Direction Point ID",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!1},{name:"FromLevel",alias:"Start from 3D Level",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!1},{name:"Meters",alias:"Length in Meters",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!0},{name:"Minutes",alias:"Duration in Minutes",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!0},{name:"ToLevel",alias:"End at 3D Level",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!1}],wc.popupInfo={title:"Direction Lines",fieldInfos:[{fieldName:"DirectionLineType",label:"Line Type",isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"Meters",label:"Length in Meters",isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"Minutes",label:"Duration in Minutes",isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"DirectionPointID",label:"Direction Point ID",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"FromLevel",label:"Start from 3D Level",isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"ToLevel",label:"End at 3D Level",isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"}],description:null,showAttachments:!1,mediaInfos:[]},u([h({type:y9.apiValues,json:{read:{source:"attributes.DirectionLineType",reader:y9.read}}})],wc.prototype,"directionLineType",void 0),u([h({json:{read:{source:"attributes.DirectionPointID"}}})],wc.prototype,"directionPointId",void 0),u([h({json:{read:{source:"attributes.Meters"}}})],wc.prototype,"distance",void 0),u([h({json:{read:{source:"attributes.Minutes"}}})],wc.prototype,"duration",void 0),u([h({json:{read:{source:"attributes.FromLevel"}}})],wc.prototype,"fromLevel",void 0),u([h({type:ja})],wc.prototype,"geometry",void 0),u([h({json:{read:{source:"attributes.ObjectID"}}})],wc.prototype,"objectId",void 0),u([h({type:Nc})],wc.prototype,"popupTemplate",void 0),u([h({types:un})],wc.prototype,"symbol",void 0),u([h({json:{read:{source:"attributes.ToLevel"}}})],wc.prototype,"toLevel",void 0),u([h({readOnly:!0,json:{read:!1}})],wc.prototype,"type",void 0),wc=xie=u([I("esri.rest.support.DirectionLine")],wc);const oD=wc;var Tie;let Ys=Tie=class extends ki(fe){constructor(e){super(e),this.alternateName=null,this.arrivalTime=null,this.arrivalTimeOffset=null,this.azimuth=null,this.branchName=null,this.directionPointType=null,this.displayText=null,this.exitName=null,this.geometry=null,this.intersectingName=null,this.level=null,this.name=null,this.objectId=null,this.popupTemplate=null,this.sequence=null,this.shortVoiceInstruction=null,this.stopId=null,this.symbol=null,this.towardName=null,this.type="direction-point",this.voiceInstruction=null}readArrivalTime(e,t){return v(t.attributes.ArrivalTime)?new Date(t.attributes.ArrivalTime):null}static fromGraphic(e){var t,r,i,s,n,o,a,l,c,d,p,f,m,g;return new Tie({alternateName:(t=e.attributes.AlternateName)!=null?t:null,arrivalTime:v(e.attributes.ArrivalTime)?new Date(e.attributes.ArrivalTime):null,arrivalTimeOffset:(r=e.attributes.ArrivalUTCOffset)!=null?r:null,azimuth:(i=e.attributes.Azimuth)!=null?i:null,branchName:(s=e.attributes.BranchName)!=null?s:null,directionPointType:g9.fromJSON(e.attributes.DirectionPointType),displayText:(n=e.attributes.DisplayText)!=null?n:null,exitName:(o=e.attributes.ExitName)!=null?o:null,geometry:e.geometry,intersectingName:(a=e.attributes.IntersectingName)!=null?a:null,level:(l=e.attributes.Level)!=null?l:null,name:(c=e.attributes.Name)!=null?c:null,objectId:(d=e.attributes.ObjectID)!=null?d:e.attributes.__OBJECTID,popupTemplate:e.popupTemplate,sequence:e.attributes.Sequence,shortVoiceInstruction:(p=e.attributes.ShortVoiceInstruction)!=null?p:null,stopId:(f=e.attributes.StopID)!=null?f:null,symbol:e.symbol,towardName:(m=e.attributes.TowardName)!=null?m:null,voiceInstruction:(g=e.attributes.VoiceInstruction)!=null?g:null})}toGraphic(){const e={ObjectID:this.objectId,DirectionPointType:v(this.directionPointType)?g9.toJSON(this.directionPointType):null,Sequence:this.sequence,StopID:this.stopId};return v(this.alternateName)&&(e.AlternateName=this.alternateName),v(this.arrivalTime)&&(e.ArrivalTime=this.arrivalTime.getTime()),v(this.arrivalTimeOffset)&&(e.ArrivalUTCOffset=this.arrivalTimeOffset),v(this.azimuth)&&(e.Azimuth=this.azimuth),v(this.branchName)&&(e.BranchName=this.branchName),v(this.displayText)&&(e.DisplayText=this.displayText),v(this.exitName)&&(e.ExitName=this.exitName),v(this.intersectingName)&&(e.IntersectingName=this.intersectingName),v(this.level)&&(e.Level=this.level),v(this.name)&&(e.Name=this.name),v(this.shortVoiceInstruction)&&(e.ShortVoiceInstruction=this.shortVoiceInstruction),v(this.towardName)&&(e.TowardName=this.towardName),v(this.voiceInstruction)&&(e.VoiceInstruction=this.voiceInstruction),new _i({geometry:this.geometry,attributes:e,symbol:this.symbol,popupTemplate:this.popupTemplate})}};Ys.fields=[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID",editable:!1,nullable:!1,domain:null},{name:"AlternateName",alias:"Alternative Feature Name",type:"esriFieldTypeString",length:2048,editable:!0,nullable:!0,visible:!0,domain:null},{name:"ArrivalTime",alias:"Maneuver Starts at",type:"esriFieldTypeDate",length:36,editable:!0,nullable:!0,visible:!0},{name:"ArrivalUTCOffset",alias:"Offset from UTC in Minutes",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0},{name:"Azimuth",alias:"Azimuth",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!0},{name:"BranchName",alias:"Signpost Branch Name",type:"esriFieldTypeString",length:2048,editable:!0,nullable:!0,visible:!0,domain:null},{name:"DirectionPointType",alias:"Directions Item Type",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0,domain:{type:"codedValue",name:"esriDirectionPointType",codedValues:[{name:"Unknown",code:0},{name:"",code:1},{name:"Arrive at stop",code:50},{name:"Depart at stop",code:51},{name:"Go straight",code:52},{name:"Take ferry",code:100},{name:"Take off ferry",code:101},{name:"Keep center at fork",code:102},{name:"Take roundabout",code:103},{name:"Make U-Turn",code:104},{name:"Pass the door",code:150},{name:"Take stairs",code:151},{name:"",code:152},{name:"Take escalator",code:153},{name:"Take pedestrian ramp",code:154},{name:"Keep left at fork",code:200},{name:"Ramp left",code:201},{name:"Take left-handed roundabout",code:202},{name:"Make left-handed U-Turn",code:203},{name:"Bear left",code:204},{name:"Turn left",code:205},{name:"Make sharp left",code:206},{name:"Turn left, followed by turn left",code:207},{name:"Turn left, followed by turn right",code:208},{name:"Keep right at fork",code:300},{name:"Ramp right",code:301},{name:"Take right-handed roundabout",code:302},{name:"Make right-handed U-Turn",code:303},{name:"Bear right",code:304},{name:"Turn right",code:305},{name:"Make sharp right",code:306},{name:"Turn right, followed by turn left",code:307},{name:"Turn right, followed by turn right",code:308},{name:"Indicates up direction of elevator",code:400},{name:"Indicates up direction of escalator",code:401},{name:"Take up-stairs",code:402},{name:"Indicates down direction of elevator",code:500},{name:"Indicates down direction of escalator",code:501},{name:"Take down-stairs",code:502},{name:"General event",code:1e3},{name:"Landmark",code:1001},{name:"Time zone change",code:1002},{name:"Heavy traffic segment",code:1003},{name:"Scale cost barrier crossing",code:1004},{name:"Administrative Border crossing",code:1005},{name:"Restriction violation",code:1006}]}},{name:"DisplayText",alias:"Text to Display",type:"esriFieldTypeString",length:2048,editable:!0,nullable:!0,visible:!0,domain:null},{name:"ExitName",alias:"Highway Exit Name",type:"esriFieldTypeString",length:2048,editable:!0,nullable:!0,visible:!0,domain:null},{name:"IntersectingName",alias:"Intersecting Feature Name",type:"esriFieldTypeString",length:2048,editable:!0,nullable:!0,visible:!0,domain:null},{name:"Level",alias:"3D Logical Level",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0},{name:"Name",alias:"Primary Feature Name",type:"esriFieldTypeString",length:2048,editable:!0,nullable:!0,visible:!0,domain:null},{name:"Sequence",alias:"Sequence",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0},{name:"ShortVoiceInstruction",alias:"Voice Instruction",type:"esriFieldTypeString",length:2048,editable:!0,nullable:!0,visible:!0,domain:null},{name:"StopID",alias:"Stop ID",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0},{name:"TowardName",alias:"Signpost Toward Name",type:"esriFieldTypeString",length:2048,editable:!0,nullable:!0,visible:!0,domain:null},{name:"VoiceInstruction",alias:"Voice Full Instruction",type:"esriFieldTypeString",length:2048,editable:!0,nullable:!0,visible:!0,domain:null}],Ys.popupInfo={title:"{DisplayText}",fieldInfos:[{fieldName:"DirectionPointType",label:"Directions Item Type",isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"DisplayText",label:"Text to Display",isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"Sequence",label:"Sequence",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"StopID",label:"Stop ID",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"ArrivalTime",label:"Maneuver Starts at",isEditable:!0,tooltip:"",visible:!0,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox"},{fieldName:"ArrivalUTCOffset",label:"Offset from UTC in Minutes",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"Azimuth",label:"Azimuth",isEditable:!1,tooltip:"",visible:!1,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"Name",label:"Primary Feature Name",isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"AlternateName",label:"Alternative Feature Name",isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"ExitName",label:"Highway Exit Name",isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"IntersectingName",label:"Intersecting Feature Name",isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"BranchName",label:"Signpost Branch Name",isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"TowardName",label:"Signpost Toward Name",isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"ShortVoiceInstruction",label:"Voice Instruction",isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox"},{fieldName:"VoiceInstruction",label:"Voice Full Instruction",isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox"}],description:null,showAttachments:!1,mediaInfos:[]},u([h()],Ys.prototype,"alternateName",void 0),u([h()],Ys.prototype,"arrivalTime",void 0),u([me("arrivalTime",["attributes.ArrivalTime"])],Ys.prototype,"readArrivalTime",null),u([h({json:{read:{source:"attributes.ArrivalUTCOffset"}}})],Ys.prototype,"arrivalTimeOffset",void 0),u([h({json:{read:{source:"attributes.Azimuth"}}})],Ys.prototype,"azimuth",void 0),u([h({json:{read:{source:"attributes.BranchName"}}})],Ys.prototype,"branchName",void 0),u([h({type:g9.apiValues,json:{read:{source:"attributes.DirectionPointType",reader:g9.read}}})],Ys.prototype,"directionPointType",void 0),u([h({json:{read:{source:"attributes.DisplayText"}}})],Ys.prototype,"displayText",void 0),u([h({json:{read:{source:"attributes.ExitName"}}})],Ys.prototype,"exitName",void 0),u([h({type:lt})],Ys.prototype,"geometry",void 0),u([h()],Ys.prototype,"intersectingName",void 0),u([h()],Ys.prototype,"level",void 0),u([h({json:{read:{source:"attributes.Name"}}})],Ys.prototype,"name",void 0),u([h({json:{read:{source:"attributes.ObjectID"}}})],Ys.prototype,"objectId",void 0),u([h({type:Nc})],Ys.prototype,"popupTemplate",void 0),u([h({json:{read:{source:"attributes.Sequence"}}})],Ys.prototype,"sequence",void 0),u([h()],Ys.prototype,"shortVoiceInstruction",void 0),u([h({json:{read:{source:"attributes.StopID"}}})],Ys.prototype,"stopId",void 0),u([h({types:un})],Ys.prototype,"symbol",void 0),u([h({json:{read:{source:"attributes.TowardName"}}})],Ys.prototype,"towardName",void 0),u([h({readOnly:!0,json:{read:!1}})],Ys.prototype,"type",void 0),u([h()],Ys.prototype,"voiceInstruction",void 0),Ys=Tie=u([I("esri.rest.support.DirectionPoint")],Ys);const aD=Ys;var Sie;let mo=Sie=class extends ki(fe){constructor(e){super(e),this.addedCost=null,this.barrierType=null,this.costs=null,this.curbApproach=null,this.fullEdge=null,this.geometry=null,this.name=null,this.objectId=null,this.popupTemplate=null,this.sideOfEdge=null,this.sourceId=null,this.sourceOid=null,this.status=null,this.symbol=null,this.type="point-barrier"}readCosts(e,t){return r0(t.attributes,"Attr_")}writeCosts(e,t){Tue(e,t,"Attr_")}static fromGraphic(e){var t,r,i;return new Sie({addedCost:(t=e.attributes.AddedCost)!=null?t:null,barrierType:v(e.attributes.BarrierType)?Nd.fromJSON(e.attributes.BarrierType):null,costs:v(e.attributes.Costs)?yI(JSON.parse(e.attributes.Costs)):null,curbApproach:v(e.attributes.CurbApproach)?Rl.fromJSON(e.attributes.CurbApproach):null,fullEdge:v(e.attributes.FullEdge)?EL.fromJSON(e.attributes.FullEdge):null,geometry:e.geometry,name:(r=e.attributes.Name)!=null?r:null,objectId:(i=e.attributes.ObjectID)!=null?i:e.attributes.__OBJECTID,popupTemplate:e.popupTemplate,status:v(e.attributes.Status)?jx.fromJSON(e.attributes.Status):null,symbol:e.symbol})}toGraphic(){const e={ObjectID:this.objectId,AddedCost:this.addedCost,BarrierType:v(this.barrierType)?Nd.toJSON(this.barrierType):null,Costs:v(this.costs)?JSON.stringify(_I(this.costs)):null,CurbApproach:v(this.curbApproach)?Rl.toJSON(this.curbApproach):null,FullEdge:v(this.fullEdge)?EL.toJSON(this.fullEdge):null,Name:this.name,Status:v(this.status)?jx.toJSON(this.status):null};return new _i({geometry:this.geometry,attributes:e,symbol:this.symbol,popupTemplate:this.popupTemplate})}};mo.fields=[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID",editable:!1,nullable:!1,domain:null},{name:"AddedCost",alias:"Added Cost",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!0,domain:null},{name:"BarrierType",alias:"Barrier Type",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0,domain:{type:"codedValue",name:"esriNABarrierType",codedValues:[{name:"Restriction",code:0},{name:"Scaled Cost",code:1},{name:"Added Cost",code:2}]}},{name:"Costs",alias:"Costs",type:"esriFieldTypeString",length:1048576,editable:!0,nullable:!0,visible:!1,domain:null},{name:"CurbApproach",alias:"Curb Approach",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!1,domain:{type:"codedValue",name:"esriNACurbApproachType",codedValues:[{name:"Either side",code:0},{name:"From the right",code:1},{name:"From the left",code:2},{name:"Depart in the same direction",code:3}]}},{name:"FullEdge",alias:"Full Edge",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0,domain:{type:"codedValue",name:"esriNAIntYesNo",codedValues:[{name:"No",code:0},{name:"Yes",code:1}]}},{name:"Name",alias:"Name",type:"esriFieldTypeString",length:255,editable:!0,nullable:!0,visible:!0},{name:"Status",alias:"Status",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0,domain:{type:"codedValue",name:"esriNAObjectStatus",codedValues:[{name:"OK",code:0},{name:"Not Located on Network",code:1},{name:"Network Unbuilt",code:2},{name:"Prohibited Street",code:3},{name:"Invalid Field Values",code:4},{name:"Cannot Reach",code:5},{name:"Time Window Violation",code:6}]}}],mo.popupInfo={title:"Point Barriers",fieldInfos:[{fieldName:"Name",label:"Name",isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"BarrierType",label:"Barrier Type",isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"AddedCost",label:"Added Cost",isEditable:!0,tooltip:"",visible:!0,format:{places:3,digitSeparator:!0},stringFieldOption:"textbox"}],description:null,showAttachments:!1,mediaInfos:[]},u([h()],mo.prototype,"addedCost",void 0),u([h({type:Nd.apiValues,json:{name:"attributes.BarrierType",read:{reader:Nd.read},write:{writer:Nd.write}}})],mo.prototype,"barrierType",void 0),u([h()],mo.prototype,"costs",void 0),u([me("costs",["attributes"])],mo.prototype,"readCosts",null),u([Le("costs")],mo.prototype,"writeCosts",null),u([h({type:Rl.apiValues,json:{read:{source:"attributes.CurbApproach",reader:Rl.read}}})],mo.prototype,"curbApproach",void 0),u([h({type:EL.apiValues,json:{name:"attributes.FullEdge",read:{reader:EL.read},write:{writer:EL.write}}})],mo.prototype,"fullEdge",void 0),u([h({type:lt,json:{write:!0}})],mo.prototype,"geometry",void 0),u([h({json:{name:"attributes.Name"}})],mo.prototype,"name",void 0),u([h({json:{name:"attributes.ObjectID"}})],mo.prototype,"objectId",void 0),u([h({type:Nc})],mo.prototype,"popupTemplate",void 0),u([h({type:m9.apiValues,json:{read:{source:"attributes.SideOfEdge",reader:m9.read}}})],mo.prototype,"sideOfEdge",void 0),u([h({json:{read:{source:"attributes.SourceID"}}})],mo.prototype,"sourceId",void 0),u([h({json:{read:{source:"attributes.SourceOID"}}})],mo.prototype,"sourceOid",void 0),u([h({type:jx.apiValues,json:{read:{source:"attributes.Status",reader:jx.read}}})],mo.prototype,"status",void 0),u([h({types:un})],mo.prototype,"symbol",void 0),u([h({readOnly:!0,json:{read:!1}})],mo.prototype,"type",void 0),mo=Sie=u([I("esri.rest.support.PointBarrier")],mo);const hM=mo;var Eie;let xc=Eie=class extends ki(fe){constructor(e){super(e),this.barrierType=null,this.costs=null,this.geometry=null,this.name=null,this.objectId=null,this.popupTemplate=null,this.scaleFactor=null,this.symbol=null,this.type="polygon-barrier"}readCosts(e,t){return r0(t.attributes,"Attr_")}writeCosts(e,t){Tue(e,t,"Attr_")}static fromGraphic(e){var t,r,i;return new Eie({barrierType:v(e.attributes.BarrierType)?Nd.fromJSON(e.attributes.BarrierType):null,costs:v(e.attributes.Costs)?yI(JSON.parse(e.attributes.Costs)):null,geometry:e.geometry,name:(t=e.attributes.Name)!=null?t:null,objectId:(r=e.attributes.ObjectID)!=null?r:e.attributes.__OBJECTID,popupTemplate:e.popupTemplate,scaleFactor:(i=e.attributes.ScaleFactor)!=null?i:null,symbol:e.symbol})}toGraphic(){var t,r;const e={ObjectID:this.objectId,BarrierType:v(this.barrierType)?Nd.toJSON(this.barrierType):null,Costs:v(this.costs)?JSON.stringify(_I(this.costs)):null,Name:(t=this.name)!=null?t:null,ScaleFactor:(r=this.scaleFactor)!=null?r:null};return new _i({geometry:this.geometry,attributes:e,symbol:this.symbol,popupTemplate:this.popupTemplate})}};xc.fields=[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID",editable:!1,nullable:!1,domain:null},{name:"BarrierType",alias:"Barrier Type",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0,domain:{type:"codedValue",name:"esriNABarrierType",codedValues:[{name:"Restriction",code:0},{name:"Scaled Cost",code:1},{name:"Added Cost",code:2}]}},{name:"Costs",alias:"Costs",type:"esriFieldTypeString",length:1048576,editable:!0,nullable:!0,visible:!1,domain:null},{name:"Name",alias:"Name",type:"esriFieldTypeString",length:255,editable:!0,nullable:!0,visible:!0},{name:"ScaleFactor",alias:"Scale Factor",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!0}],xc.popupInfo={title:"Polygon Barriers",fieldInfos:[{fieldName:"Name",label:"Name",isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"BarrierType",label:"Barrier Type",isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"ScaleFactor",isEditable:!0,tooltip:"",visible:!0,format:{places:3,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"Costs",label:"Costs",isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox"}],description:null,showAttachments:!1,mediaInfos:[]},u([h({type:Nd.apiValues,json:{name:"attributes.BarrierType",read:{reader:Nd.read},write:{writer:Nd.write}}})],xc.prototype,"barrierType",void 0),u([h()],xc.prototype,"costs",void 0),u([me("costs",["attributes"])],xc.prototype,"readCosts",null),u([Le("costs")],xc.prototype,"writeCosts",null),u([h({type:kl,json:{write:!0}})],xc.prototype,"geometry",void 0),u([h({json:{name:"attributes.Name"}})],xc.prototype,"name",void 0),u([h({json:{name:"attributes.ObjectID"}})],xc.prototype,"objectId",void 0),u([h({type:Nc})],xc.prototype,"popupTemplate",void 0),u([h()],xc.prototype,"scaleFactor",void 0),u([h({types:un})],xc.prototype,"symbol",void 0),u([h({readOnly:!0,json:{read:!1}})],xc.prototype,"type",void 0),xc=Eie=u([I("esri.rest.support.PolygonBarrier")],xc);const pM=xc;var Cie;let au=Cie=class extends ki(fe){constructor(e){super(e),this.barrierType=null,this.costs=null,this.geometry=null,this.name=null,this.objectId=null,this.popupTemplate=null,this.scaleFactor=null,this.symbol=null,this.type="polyline-barrier"}readCosts(e,t){return r0(t.attributes,"Attr_")}static fromGraphic(e){var t,r,i;return new Cie({barrierType:v(e.attributes.BarrierType)?Nd.fromJSON(e.attributes.BarrierType):null,costs:v(e.attributes.Costs)?yI(JSON.parse(e.attributes.Costs)):null,geometry:e.geometry,name:(t=e.attributes.Name)!=null?t:null,objectId:(r=e.attributes.ObjectID)!=null?r:e.attributes.__OBJECTID,popupTemplate:e.popupTemplate,scaleFactor:(i=e.attributes.ScaleFactor)!=null?i:null,symbol:e.symbol})}toGraphic(){const e={ObjectID:this.objectId,BarrierType:v(this.barrierType)?Nd.toJSON(this.barrierType):null,Costs:v(this.costs)?JSON.stringify(_I(this.costs)):null,Name:this.name,ScaleFactor:this.scaleFactor};return new _i({geometry:this.geometry,attributes:e,symbol:this.symbol,popupTemplate:this.popupTemplate})}};au.fields=[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID",editable:!1,nullable:!1,domain:null},{name:"BarrierType",alias:"Barrier Type",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0,domain:{type:"codedValue",name:"esriNABarrierType",codedValues:[{name:"Restriction",code:0},{name:"Scaled Cost",code:1},{name:"Added Cost",code:2}]}},{name:"Costs",alias:"Costs",type:"esriFieldTypeString",length:1048576,editable:!0,nullable:!0,visible:!1,domain:null},{name:"Name",alias:"Name",type:"esriFieldTypeString",length:255,editable:!0,nullable:!0,visible:!0},{name:"ScaleFactor",alias:"Scale Factor",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!0}],au.popupInfo={title:"Line Barriers",fieldInfos:[{fieldName:"Name",label:"Name",isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"BarrierType",label:"Barrier Type",isEditable:!0,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"ScaleFactor",isEditable:!0,tooltip:"",visible:!0,format:{places:3,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"Costs",label:"Costs",isEditable:!0,tooltip:"",visible:!1,stringFieldOption:"textbox"}],description:null,showAttachments:!1,mediaInfos:[]},u([h({type:Nd.apiValues,json:{read:{source:"attributes.BarrierType",reader:Nd.read}}})],au.prototype,"barrierType",void 0),u([h()],au.prototype,"costs",void 0),u([me("costs",["attributes"])],au.prototype,"readCosts",null),u([h({type:ja,json:{write:!0}})],au.prototype,"geometry",void 0),u([h({json:{name:"attributes.Name"}})],au.prototype,"name",void 0),u([h({json:{name:"attributes.ObjectID"}})],au.prototype,"objectId",void 0),u([h({type:Nc})],au.prototype,"popupTemplate",void 0),u([h()],au.prototype,"scaleFactor",void 0),u([h({types:un})],au.prototype,"symbol",void 0),u([h({readOnly:!0,json:{read:!1}})],au.prototype,"type",void 0),au=Cie=u([I("esri.rest.support.PolylineBarrier")],au);const fM=au;let ch=class extends fe{constructor(e){super(e),this.accumulateAttributes=null,this.directionsLanguage=null,this.findBestSequence=null,this.preserveFirstStop=null,this.preserveLastStop=null,this.startTimeIsUTC=null,this.timeWindowsAreUTC=null,this.travelMode=null}readAccumulateAttributes(e){return C(e)?null:e.map(t=>Bd.fromJSON(t))}writeAccumulateAttributes(e,t,r){!C(e)&&e.length&&(t[r]=e.map(i=>Bd.toJSON(i)))}};u([h({type:[String],json:{name:"accumulateAttributeNames",write:!0}})],ch.prototype,"accumulateAttributes",void 0),u([me("accumulateAttributes")],ch.prototype,"readAccumulateAttributes",null),u([Le("accumulateAttributes")],ch.prototype,"writeAccumulateAttributes",null),u([h({type:String,json:{write:!0}})],ch.prototype,"directionsLanguage",void 0),u([h({type:Boolean,json:{write:!0}})],ch.prototype,"findBestSequence",void 0),u([h({type:Boolean,json:{write:!0}})],ch.prototype,"preserveFirstStop",void 0),u([h({type:Boolean,json:{write:!0}})],ch.prototype,"preserveLastStop",void 0),u([h({type:Boolean,json:{write:!0}})],ch.prototype,"startTimeIsUTC",void 0),u([h({type:Boolean,json:{write:!0}})],ch.prototype,"timeWindowsAreUTC",void 0),u([h({type:Mue,json:{write:!0}})],ch.prototype,"travelMode",void 0),ch=u([I("esri.layers.support.RouteSettings")],ch);const _6e=ch;var Aie;let Ei=Aie=class extends ki(fe){constructor(e){super(e),this.analysisSettings=null,this.endTime=null,this.endTimeOffset=null,this.firstStopId=null,this.geometry=null,this.lastStopId=null,this.messages=null,this.name=null,this.objectId=null,this.popupTemplate=null,this.startTime=null,this.startTimeOffset=null,this.stopCount=null,this.symbol=null,this.totalCosts=null,this.totalDistance=null,this.totalDuration=null,this.totalLateDuration=null,this.totalViolations=null,this.totalWait=null,this.totalWaitDuration=null,this.type="route-info",this.version="1.0.0"}readEndTime(e,t){return v(t.attributes.EndTimeUTC)?new Date(t.attributes.EndTimeUTC):null}readEndTimeOffset(e,t){return xF(t.attributes.EndTime,t.attributes.EndTimeUTC)}readStartTime(e,t){return v(t.attributes.StartTimeUTC)?new Date(t.attributes.StartTimeUTC):null}readStartTimeOffset(e,t){return xF(t.attributes.StartTime,t.attributes.StartTimeUTC)}readTotalCosts(e,t){return r0(t.attributes,"Total_")}readTotalViolations(e,t){return r0(t.attributes,"TotalViolation_")}readTotalWait(e,t){return r0(t.attributes,"TotalWait_")}static fromGraphic(e){var t,r,i,s,n,o,a;return new Aie({analysisSettings:v(e.attributes.AnalysisSettings)?_6e.fromJSON(JSON.parse(e.attributes.AnalysisSettings)):null,endTime:v(e.attributes.EndTime)?new Date(e.attributes.EndTime):null,endTimeOffset:(t=e.attributes.EndUTCOffset)!=null?t:null,geometry:e.geometry,messages:v(e.attributes.Messages)?JSON.parse(e.attributes.Messages):null,name:e.attributes.RouteName,objectId:(r=e.attributes.ObjectID)!=null?r:e.attributes.__OBJECTID,popupTemplate:e.popupTemplate,startTime:v(e.attributes.StartTime)?new Date(e.attributes.StartTime):null,startTimeOffset:(i=e.attributes.StartUTCOffset)!=null?i:null,symbol:e.symbol,totalCosts:v(e.attributes.TotalCosts)?yI(JSON.parse(e.attributes.TotalCosts)):null,totalDistance:(s=e.attributes.TotalMeters)!=null?s:null,totalDuration:(n=e.attributes.TotalMinutes)!=null?n:null,totalLateDuration:(o=e.attributes.TotalLateMinutes)!=null?o:null,totalWaitDuration:(a=e.attributes.TotalWaitMinutes)!=null?a:null,version:e.attributes.Version})}toGraphic(){const e={ObjectID:this.objectId,AnalysisSettings:v(this.analysisSettings)?JSON.stringify(this.analysisSettings.toJSON()):null,EndTime:v(this.endTime)?this.endTime.getTime():null,EndUTCOffset:this.endTimeOffset,Messages:v(this.messages)?JSON.stringify(this.messages):null,RouteName:this.name,StartTime:v(this.startTime)?this.startTime.getTime():null,StartUTCOffset:this.startTimeOffset,TotalCosts:v(this.totalCosts)?JSON.stringify(_I(this.totalCosts)):null,TotalLateMinutes:this.totalLateDuration,TotalMeters:this.totalDistance,TotalMinutes:this.totalDuration,TotalWaitMinutes:this.totalWaitDuration,Version:this.version};return new _i({geometry:this.geometry,attributes:e,symbol:this.symbol,popupTemplate:this.popupTemplate})}};Ei.fields=[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID",editable:!1,nullable:!1,domain:null},{name:"AnalysisSettings",alias:"Analysis Settings",type:"esriFieldTypeString",length:1048576,editable:!0,nullable:!0,visible:!1,domain:null},{name:"EndTime",alias:"End Time",type:"esriFieldTypeDate",length:36,editable:!0,nullable:!0,visible:!0},{name:"EndUTCOffset",alias:"End Time: Offset from UTC in Minutes",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0},{name:"Messages",alias:"Analysis Messages",type:"esriFieldTypeString",length:1048576,editable:!0,nullable:!0,visible:!1,domain:null},{name:"RouteName",alias:"Route Name",type:"esriFieldTypeString",length:1024,editable:!0,nullable:!0,visible:!0,domain:null},{name:"StartTime",alias:"Start Time",type:"esriFieldTypeDate",length:36,editable:!0,nullable:!0,visible:!0},{name:"StartUTCOffset",alias:"Start Time: Offset from UTC in Minutes",type:"esriFieldTypeInteger",editable:!0,nullable:!0,visible:!0},{name:"TotalCosts",alias:"Total Costs",type:"esriFieldTypeString",length:1048576,editable:!0,nullable:!0,visible:!1,domain:null},{name:"TotalLateMinutes",alias:"Total Late Minutes",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!1},{name:"TotalMeters",alias:"Total Meters",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!0},{name:"TotalMinutes",alias:"Total Minutes",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!0},{name:"TotalWaitMinutes",alias:"Total Wait Minutes",type:"esriFieldTypeDouble",editable:!0,nullable:!0,visible:!1},{name:"Version",alias:"Version",type:"esriFieldTypeString",length:16,editable:!0,nullable:!0,visible:!0,domain:null}],Ei.popupInfo={title:"Route Details",fieldInfos:[{fieldName:"RouteName",label:"Route Name",isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox"},{fieldName:"TotalMinutes",label:"Total Minutes",isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"TotalMeters",label:"Total Meters",isEditable:!1,tooltip:"",visible:!0,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"TotalLateMinutes",label:"Total Late Minutes",isEditable:!1,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"TotalWaitMinutes",label:"Total Wait Minutes",isEditable:!1,tooltip:"",visible:!1,format:{places:2,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"TotalCosts",label:"Total Costs",isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox"},{fieldName:"StartTime",label:"Start Time",isEditable:!1,tooltip:"",visible:!0,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox"},{fieldName:"StartUTCOffset",label:"Start Time: Offset from UTC in Minutes",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"EndTime",label:"End Time",isEditable:!1,tooltip:"",visible:!0,format:{dateFormat:"shortDateShortTime24"},stringFieldOption:"textbox"},{fieldName:"EndUTCOffset",label:"End Time: Offset from UTC in Minutes",isEditable:!1,tooltip:"",visible:!0,format:{places:0,digitSeparator:!0},stringFieldOption:"textbox"},{fieldName:"Messages",label:"Analysis Messages",isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox"},{fieldName:"AnalysisSettings",isEditable:!1,tooltip:"",visible:!1,stringFieldOption:"textbox"},{fieldName:"Version",label:"Version",isEditable:!1,tooltip:"",visible:!0,stringFieldOption:"textbox"}],description:null,showAttachments:!1,mediaInfos:[]},u([h()],Ei.prototype,"analysisSettings",void 0),u([h()],Ei.prototype,"endTime",void 0),u([me("endTime",["attributes.EndTimeUTC"])],Ei.prototype,"readEndTime",null),u([h()],Ei.prototype,"endTimeOffset",void 0),u([me("endTimeOffset",["attributes.EndTime","attributes.EndTimeUTC"])],Ei.prototype,"readEndTimeOffset",null),u([h({json:{read:{source:"attributes.FirstStopID"}}})],Ei.prototype,"firstStopId",void 0),u([h({type:ja})],Ei.prototype,"geometry",void 0),u([h({json:{read:{source:"attributes.LastStopID"}}})],Ei.prototype,"lastStopId",void 0),u([h()],Ei.prototype,"messages",void 0),u([h({json:{read:{source:"attributes.Name"}}})],Ei.prototype,"name",void 0),u([h({json:{read:{source:"attributes.ObjectID"}}})],Ei.prototype,"objectId",void 0),u([h({type:Nc})],Ei.prototype,"popupTemplate",void 0),u([h()],Ei.prototype,"startTime",void 0),u([me("startTime",["attributes.StartTimeUTC"])],Ei.prototype,"readStartTime",null),u([h()],Ei.prototype,"startTimeOffset",void 0),u([me("startTimeOffset",["attributes.StartTime","attributes.StartTimeUTC"])],Ei.prototype,"readStartTimeOffset",null),u([h({json:{read:{source:"attributes.StopCount"}}})],Ei.prototype,"stopCount",void 0),u([h({types:un})],Ei.prototype,"symbol",void 0),u([h()],Ei.prototype,"totalCosts",void 0),u([me("totalCosts",["attributes"])],Ei.prototype,"readTotalCosts",null),u([h()],Ei.prototype,"totalDistance",void 0),u([h()],Ei.prototype,"totalDuration",void 0),u([h()],Ei.prototype,"totalLateDuration",void 0),u([h()],Ei.prototype,"totalViolations",void 0),u([me("totalViolations",["attributes"])],Ei.prototype,"readTotalViolations",null),u([h()],Ei.prototype,"totalWait",void 0),u([me("totalWait",["attributes"])],Ei.prototype,"readTotalWait",null),u([h()],Ei.prototype,"totalWaitDuration",void 0),u([h({readOnly:!0,json:{read:!1}})],Ei.prototype,"type",void 0),u([h()],Ei.prototype,"version",void 0),Ei=Aie=u([I("esri.rest.support.RouteInfo")],Ei);const t6=Ei;let Oy=class extends ki(fe){constructor(e){super(e),this.doNotLocateOnRestrictedElements=null,this.geometry=null,this.geometryType=null,this.name=null,this.spatialRelationship=null,this.type="layer",this.where=null}};u([h({type:Boolean,json:{write:!0}})],Oy.prototype,"doNotLocateOnRestrictedElements",void 0),u([h({types:Yx,json:{read:ql,write:!0}})],Oy.prototype,"geometry",void 0),u([Ue(y4t)],Oy.prototype,"geometryType",void 0),u([h({type:String,json:{name:"layerName",write:!0}})],Oy.prototype,"name",void 0),u([Ue(g4t,{name:"spatialRel"})],Oy.prototype,"spatialRelationship",void 0),u([h({type:String,json:{write:!0}})],Oy.prototype,"type",void 0),u([h({type:String,json:{write:!0}})],Oy.prototype,"where",void 0),Oy=u([I("esri.rest.support.DataLayer")],Oy);const H5t=Oy;var Oie;let _8=Oie=class extends bd{constructor(e){super(e),this.doNotLocateOnRestrictedElements=null}clone(){return new Oie({doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements,...this.cloneProperties()})}};u([h({type:Boolean,json:{write:!0}})],_8.prototype,"doNotLocateOnRestrictedElements",void 0),_8=Oie=u([I("esri.rest.support.NetworkFeatureSet")],_8);const q5t=_8;let lD=class extends ki(fe){constructor(e){super(e),this.doNotLocateOnRestrictedElements=null,this.url=null}};u([h({type:Boolean,json:{write:!0}})],lD.prototype,"doNotLocateOnRestrictedElements",void 0),u([h({type:String,json:{write:!0}})],lD.prototype,"url",void 0),lD=u([I("esri.rest.support.NetworkUrl")],lD);const W5t=lD;var Mie;function X5t(e){return e&&"type"in e}function Y5t(e){return e&&"features"in e&&"doNotLocateOnRestrictedElements"in e}function Z5t(e){return e&&"url"in e}function J5t(e){return e&&"features"in e}function K5t(e){return X5t(e)?H5t.fromJSON(e):Z5t(e)?W5t.fromJSON(e):Y5t(e)?q5t.fromJSON(e):J5t(e)?bd.fromJSON(e):null}function r6(e,t,r){v(e)&&(t[r]=Ge.isCollection(e)?{features:e.toArray().map(i=>i.toJSON())}:e.toJSON())}let Lt=Mie=class extends ki(fe){constructor(e){super(e),this.accumulateAttributes=null,this.apiKey=null,this.attributeParameterValues=null,this.directionsLanguage=null,this.directionsLengthUnits=null,this.directionsOutputType=null,this.directionsStyleName=null,this.directionsTimeAttribute=null,this.findBestSequence=null,this.geometryPrecision=null,this.geometryPrecisionM=null,this.geometryPrecisionZ=null,this.ignoreInvalidLocations=null,this.impedanceAttribute=null,this.outputGeometryPrecision=null,this.outputGeometryPrecisionUnits=null,this.outputLines="true-shape",this.outSpatialReference=null,this.overrides=null,this.pointBarriers=null,this.polygonBarriers=null,this.polylineBarriers=null,this.preserveFirstStop=null,this.preserveLastStop=null,this.preserveObjectID=null,this.restrictionAttributes=null,this.restrictUTurns=null,this.returnBarriers=!1,this.returnDirections=!1,this.returnPolygonBarriers=!1,this.returnPolylineBarriers=!1,this.returnRoutes=!0,this.returnStops=!1,this.returnTraversedEdges=null,this.returnTraversedJunctions=null,this.returnTraversedTurns=null,this.returnZ=!0,this.startTime=null,this.startTimeIsUTC=!0,this.stops=null,this.timeWindowsAreUTC=null,this.travelMode=null,this.useHierarchy=null,this.useTimeWindows=null}static from(e){return rE(Mie,e)}readAccumulateAttributes(e){return C(e)?null:e.map(t=>Bd.fromJSON(t))}writeAccumulateAttributes(e,t,r){!C(e)&&e.length&&(t[r]=e.map(i=>Bd.toJSON(i)))}writePointBarriers(e,t,r){r6(e,t,r)}writePolygonBarrier(e,t,r){r6(e,t,r)}writePolylineBarrier(e,t,r){r6(e,t,r)}readRestrictionAttributes(e){return C(e)?null:e.map(t=>_9.fromJSON(t))}writeRestrictionAttributes(e,t,r){!C(e)&&e.length&&(t[r]=e.map(i=>_9.toJSON(i)))}readStartTime(e,t){const{startTime:r}=t;return C(r)?null:r==="now"?"now":new Date(r)}writeStartTime(e,t){C(e)||(t.startTime=e==="now"?"now":e.getTime())}readStops(e,t){return K5t(t.stops)}writeStops(e,t,r){r6(e,t,r)}};u([h({type:[String],json:{name:"accumulateAttributeNames",write:!0}})],Lt.prototype,"accumulateAttributes",void 0),u([me("accumulateAttributes")],Lt.prototype,"readAccumulateAttributes",null),u([Le("accumulateAttributes")],Lt.prototype,"writeAccumulateAttributes",null),u([h(rH)],Lt.prototype,"apiKey",void 0),u([h({json:{write:!0}})],Lt.prototype,"attributeParameterValues",void 0),u([h({type:String,json:{write:!0}})],Lt.prototype,"directionsLanguage",void 0),u([Ue(xue)],Lt.prototype,"directionsLengthUnits",void 0),u([Ue(d4t)],Lt.prototype,"directionsOutputType",void 0),u([Ue(f4t)],Lt.prototype,"directionsStyleName",void 0),u([Ue(tH,{name:"directionsTimeAttributeName",ignoreUnknown:!1})],Lt.prototype,"directionsTimeAttribute",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"findBestSequence",void 0),u([h({type:Number,json:{write:!0}})],Lt.prototype,"geometryPrecision",void 0),u([h({type:Number,json:{write:!0}})],Lt.prototype,"geometryPrecisionM",void 0),u([h({type:Number,json:{write:!0}})],Lt.prototype,"geometryPrecisionZ",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"ignoreInvalidLocations",void 0),u([Ue(Bd,{name:"impedanceAttributeName",ignoreUnknown:!1})],Lt.prototype,"impedanceAttribute",void 0),u([h({type:Number,json:{write:!0}})],Lt.prototype,"outputGeometryPrecision",void 0),u([Ue(VUe)],Lt.prototype,"outputGeometryPrecisionUnits",void 0),u([Ue(h4t)],Lt.prototype,"outputLines",void 0),u([h({type:Ve,json:{name:"outSR",write:!0}})],Lt.prototype,"outSpatialReference",void 0),u([h({json:{write:!0}})],Lt.prototype,"overrides",void 0),u([h({json:{name:"barriers",write:!0}})],Lt.prototype,"pointBarriers",void 0),u([Le("pointBarriers")],Lt.prototype,"writePointBarriers",null),u([h({json:{write:!0}})],Lt.prototype,"polygonBarriers",void 0),u([Le("polygonBarriers")],Lt.prototype,"writePolygonBarrier",null),u([h({json:{write:!0}})],Lt.prototype,"polylineBarriers",void 0),u([Le("polylineBarriers")],Lt.prototype,"writePolylineBarrier",null),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"preserveFirstStop",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"preserveLastStop",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"preserveObjectID",void 0),u([h({type:[String],json:{name:"restrictionAttributeNames",write:!0}})],Lt.prototype,"restrictionAttributes",void 0),u([me("restrictionAttributes")],Lt.prototype,"readRestrictionAttributes",null),u([Le("restrictionAttributes")],Lt.prototype,"writeRestrictionAttributes",null),u([Ue(jUe)],Lt.prototype,"restrictUTurns",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"returnBarriers",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"returnDirections",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"returnPolygonBarriers",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"returnPolylineBarriers",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"returnRoutes",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"returnStops",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"returnTraversedEdges",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"returnTraversedJunctions",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"returnTraversedTurns",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"returnZ",void 0),u([h({type:Date,json:{type:Number,write:!0}})],Lt.prototype,"startTime",void 0),u([me("startTime")],Lt.prototype,"readStartTime",null),u([Le("startTime")],Lt.prototype,"writeStartTime",null),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"startTimeIsUTC",void 0),u([h({json:{write:!0}})],Lt.prototype,"stops",void 0),u([me("stops")],Lt.prototype,"readStops",null),u([Le("stops")],Lt.prototype,"writeStops",null),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"timeWindowsAreUTC",void 0),u([h({type:Mue,json:{write:!0}})],Lt.prototype,"travelMode",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"useHierarchy",void 0),u([h({type:Boolean,json:{write:!0}})],Lt.prototype,"useTimeWindows",void 0),Lt=Mie=u([I("esri.rest.support.RouteParameters")],Lt);const b9=Lt;function YY(e){return e.length?e:null}function v6e(e){const{defaultTravelMode:t,supportedTravelModes:r}=e;return r==null?void 0:r.find(({id:i})=>i===t)}function Rie(e){switch(e){case"esriGeometryPoint":return{type:"esriSMS",style:"esriSMSCircle",size:12,color:[0,0,0,0],outline:Rie("esriGeometryPolyline")};case"esriGeometryPolyline":return{type:"esriSLS",style:"esriSLSSolid",width:1,color:[0,0,0,0]};case"esriGeometryPolygon":return{type:"esriSFS",style:"esriSFSNull",outline:Rie("esriGeometryPolyline")}}}function i6(e){return"layers"in e}function Q5t(e){return e.declaredClass==="esri.rest.support.FeatureSet"}function ekt(e){return e.declaredClass==="esri.rest.support.NetworkFeatureSet"}function tkt(e,t,r){var D,k,L,q,G,J,ee,se,X,F,N,B,H,W,K,Y,ce,we,Oe,Be,He,Se;const i=(D=t.networkDataset)==null?void 0:D.networkAttributes,s=(k=i==null?void 0:i.filter(he=>he.usageType==="cost"))!=null?k:[],n=v6e(t),o=(L=r.travelMode)!=null?L:n;if(C(o))return void w6e.warn("route-layer:missing-travel-mode","The routing service must have a default travel mode or one must be specified in the route parameter.");const{timeAttributeName:a,distanceAttributeName:l}=o,c=s.find(he=>he.name===a),d=s.find(he=>he.name===l),p=(J=(G=(q=r.travelMode)==null?void 0:q.impedanceAttributeName)!=null?G:r.impedanceAttribute)!=null?J:t.impedance,f=u4t.fromJSON(c==null?void 0:c.units),m=xue.fromJSON(d==null?void 0:d.units);if(!f||!m)throw new z("routelayer:unknown-impedance-units","the units of either the distance or time impedance are unknown");const g=(ee=r.directionsLanguage)!=null?ee:t.directionsLanguage,_=(X=(se=r.accumulateAttributes)!=null?se:t.accumulateAttributeNames)!=null?X:[],x=new Set(s.filter(({name:he})=>he===a||he===l||he===p||he!=null&&_.includes(he)).map(({name:he})=>he)),b=he=>{for(const Me in he)x.has(Me)||delete he[Me]};for(const he of e.pointBarriers)v(he.costs)&&(he.addedCost=(F=he.costs[p])!=null?F:0,b(he.costs));for(const he of e.polygonBarriers)v(he.costs)&&(he.scaleFactor=(N=he.costs[p])!=null?N:1,b(he.costs));for(const he of e.polylineBarriers)v(he.costs)&&(he.scaleFactor=(B=he.costs[p])!=null?B:1,b(he.costs));const{routeInfo:w}=e,{findBestSequence:T,preserveFirstStop:E,preserveLastStop:O,startTimeIsUTC:A,timeWindowsAreUTC:R}=r;w.analysisSettings=new _6e({accumulateAttributes:_,directionsLanguage:g,findBestSequence:T,preserveFirstStop:E,preserveLastStop:O,startTimeIsUTC:A,timeWindowsAreUTC:R,travelMode:o}),w.totalDuration=qT((H=w.totalCosts[a])!=null?H:0,f),w.totalDistance=ZY((W=w.totalCosts[l])!=null?W:0,m),w.totalLateDuration=qT((K=w.totalViolations[a])!=null?K:0,f),w.totalWaitDuration=qT((Y=w.totalWait[a])!=null?Y:0,f),v(w.totalCosts)&&b(w.totalCosts),v(w.totalViolations)&&b(w.totalViolations),v(w.totalWait)&&b(w.totalWait);for(const he of e.stops)v(he.serviceCosts)&&(he.serviceDuration=qT((ce=he.serviceCosts[a])!=null?ce:0,f),he.serviceDistance=ZY((we=he.serviceCosts[l])!=null?we:0,m),b(he.serviceCosts)),v(he.cumulativeCosts)&&(he.cumulativeDuration=qT((Oe=he.cumulativeCosts[a])!=null?Oe:0,f),he.cumulativeDistance=ZY((Be=he.cumulativeCosts[l])!=null?Be:0,m),b(he.cumulativeCosts)),v(he.violations)&&(he.lateDuration=qT((He=he.violations[a])!=null?He:0,f),b(he.violations)),v(he.wait)&&(he.waitDuration=qT((Se=he.wait[a])!=null?Se:0,f),b(he.wait))}async function pxe(e){const t=Ve.WGS84;return await OIe(e.spatialReference,t),cC(e,t)}function qT(e,t){switch(t){case"seconds":return e/60;case"hours":return 60*e;case"days":return 60*e*24;default:return e}}function ZY(e,t){return t==="decimal-degrees"||t==="points"||t==="unknown"?e:zn(e,t,"meters")}function rkt(e){const{attributes:t,geometry:r,popupTemplate:i,symbol:s}=e.toGraphic().toJSON();return{attributes:t,geometry:r,popupInfo:i,symbol:s}}const ikt=Ge.ofType(oD),skt=Ge.ofType(aD),fxe=Ge.ofType(hM),mxe=Ge.ofType(pM),gxe=Ge.ofType(fM),yxe=Ge.ofType(Km),b6e="esri.layers.RouteLayer",w6e=te.getLogger(b6e);let Ci=class extends Qoe(Ej(Uoe(Boe(wj($0(fE)))))){constructor(e){super(e),this._cachedServiceDescription=null,this._featureCollection=null,this._type="Feature Collection",this.defaultSymbols=new Oue,this.directionLines=null,this.directionPoints=null,this.featureCollectionType="route",this.legendEnabled=!1,this.maxScale=0,this.minScale=0,this.pointBarriers=new fxe,this.polygonBarriers=new mxe,this.polylineBarriers=new gxe,this.routeInfo=null,this.spatialReference=Ve.WGS84,this.stops=new yxe,this.type="route";const t=()=>{this._setStopSymbol(this.stops)};this.addHandles(ms(()=>this.stops,"change",t,{sync:!0,onListenerAdd:t}))}writeFeatureCollectionWebmap(e,t,r,i){const s=[this._writePolygonBarriers(),this._writePolylineBarriers(),this._writePointBarriers(),this._writeRouteInfo(),this._writeDirectionLines(),this._writeDirectionPoints(),this._writeStops()].filter(a=>!!a),n=s.map((a,l)=>l),o=i.origin==="web-map"?"featureCollection.layers":"layers";Vl(o,s,t),t.opacity=this.opacity,t.visibility=this.visible,t.visibleLayers=n}readDirectionLines(e,t){return this._getNetworkFeatures(t,"DirectionLines",r=>oD.fromGraphic(r))}readDirectionPoints(e,t){return this._getNetworkFeatures(t,"DirectionPoints",r=>aD.fromGraphic(r))}get fullExtent(){var s;const e=new Sr({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:Ve.WGS84});if(v(this.routeInfo)&&v(this.routeInfo.geometry))return(s=this.routeInfo.geometry.extent)!=null?s:e;if(C(this.stops))return e;const t=this.stops.filter(n=>v(n.geometry));if(t.length<2)return e;const{spatialReference:r}=t.getItemAt(0).geometry;if(C(r))return e;const i=t.toArray().map(n=>{const o=n.geometry;return[o.x,o.y]});return new CI({points:i,spatialReference:r}).extent}readMaxScale(e,t){var r,i;return(i=(r=(i6(t)?t.layers:t.featureCollection.layers).find(s=>v(s.layerDefinition.maxScale)))==null?void 0:r.layerDefinition.maxScale)!=null?i:0}readMinScale(e,t){var r,i;return(i=(r=(i6(t)?t.layers:t.featureCollection.layers).find(s=>v(s.layerDefinition.minScale)))==null?void 0:r.layerDefinition.minScale)!=null?i:0}readPointBarriers(e,t){return this._getNetworkFeatures(t,"Barriers",r=>hM.fromGraphic(r))}readPolygonBarriers(e,t){return this._getNetworkFeatures(t,"PolygonBarriers",r=>pM.fromGraphic(r))}readPolylineBarriers(e,t){return this._getNetworkFeatures(t,"PolylineBarriers",r=>fM.fromGraphic(r))}readRouteInfo(e,t){const r=this._getNetworkFeatures(t,"RouteInfo",i=>t6.fromGraphic(i));return r.length>0?r.getItemAt(0):null}readSpatialReference(e,t){var a,l,c,d,p;const r=i6(t)?t.layers:t.featureCollection.layers;if(!r.length)return Ve.WGS84;const{layerDefinition:i,featureSet:s}=r[0],n=s.features[0],o=(p=(d=(c=(l=(a=n==null?void 0:n.geometry)==null?void 0:a.spatialReference)!=null?l:s.spatialReference)!=null?c:i.spatialReference)!=null?d:i.extent.spatialReference)!=null?p:IJ;return Ve.fromJSON(o)}readStops(e,t){return this._getNetworkFeatures(t,"Stops",r=>Km.fromGraphic(r),r=>this._setStopSymbol(r))}get title(){return v(this.routeInfo)&&v(this.routeInfo.name)?this.routeInfo.name:"Route"}set title(e){this._overrideIfSome("title",e)}get url(){return Gr.routeServiceUrl}set url(e){e!=null?this._set("url",rRe(e,w6e)):this._set("url",Gr.routeServiceUrl)}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Collection"]},e)),Promise.resolve(this)}removeAll(){this.removeResult(),this.pointBarriers.removeAll(),this.polygonBarriers.removeAll(),this.polylineBarriers.removeAll(),this.stops.removeAll()}removeResult(){v(this.directionLines)&&(this.directionLines.removeAll(),this._set("directionLines",null)),v(this.directionPoints)&&(this.directionPoints.removeAll(),this._set("directionPoints",null)),v(this.routeInfo)&&this._set("routeInfo",null)}async save(){await this.load();const{fullExtent:e,portalItem:t}=this;if(!t)throw new z("routelayer:portal-item-not-set","save() requires to the layer to have a portal item");if(!t.id)throw new z("routelayer:portal-item-not-saved","Please use saveAs() first to save the routelayer");if(t.type!=="Feature Collection")throw new z("routelayer:portal-item-wrong-type",'Portal item needs to have type "Feature Collection"');if(C(this.routeInfo))throw new z("routelayer:route-unsolved","save() requires a solved route");const{portal:r}=t;await r._signIn(),r.user||await t.reload();const{itemUrl:i,itemControl:s}=t;if(s!=="admin"&&s!=="update")throw new z("routelayer:insufficient-permissions","To save this layer, you need to be the owner or an administrator of your organization");const n={messages:[],origin:"portal-item",portal:r,url:i&&Wa(i),writtenProperties:[]},o=this.write(null,n);return t.extent=await pxe(e),t.title=this.title,await t.update({data:o}),t}async saveAs(e,t={}){var a,l,c;if(await this.load(),C(this.routeInfo))throw new z("routelayer:route-unsolved","saveAs() requires a solved route");const r=pE.from(e).clone();(a=r.extent)!=null||(r.extent=await pxe(this.fullExtent)),r.id=null,(l=r.portal)!=null||(r.portal=oo.getDefault()),(c=r.title)!=null||(r.title=this.title),r.type="Feature Collection",r.typeKeywords=["Data","Feature Collection",E5t.MULTI_LAYER,"Route Layer"];const{portal:i}=r,s={messages:[],origin:"portal-item",portal:i,url:null,writtenProperties:[]};await i._signIn();const n=t==null?void 0:t.folder,o=this.write(null,s);return await i.user.addItem({item:r,folder:n,data:o}),this.portalItem=r,BQ(s),s.portalItem=r,r}async solve(e,t){var b,w,T,E,O;const r=(b=e==null?void 0:e.stops)!=null?b:this.stops,i=(w=e==null?void 0:e.pointBarriers)!=null?w:YY(this.pointBarriers),s=(T=e==null?void 0:e.polylineBarriers)!=null?T:YY(this.polylineBarriers),n=(E=e==null?void 0:e.polygonBarriers)!=null?E:YY(this.polygonBarriers);if(C(r))throw new z("routelayer:undefined-stops","the route layer must have stops defined in the route parameters.");if((Q5t(r)||ekt(r))&&r.features.length<2||Ge.isCollection(r)&&r.length<2)throw new z("routelayer:insufficent-stops","the route layer must have two or more stops to solve a route.");if(Ge.isCollection(r))for(const A of r)A.routeName=null;const o=e==null?void 0:e.apiKey,a=this.url,l=await this._getServiceDescription(a,o,t),c=v6e(l),d=(O=e==null?void 0:e.travelMode)!=null?O:c,p=WS(e==null?void 0:e.accumulateAttributes,[]);v(d)&&(p.push(d.distanceAttributeName),d.timeAttributeName&&p.push(d.timeAttributeName));const f={startTime:new Date},m={accumulateAttributes:p,directionsOutputType:"featuresets",ignoreInvalidLocations:!0,pointBarriers:i,polylineBarriers:s,polygonBarriers:n,preserveFirstStop:!0,preserveLastStop:!0,returnBarriers:!!i,returnDirections:!0,returnPolygonBarriers:!!n,returnPolylineBarriers:!!s,returnRoutes:!0,returnStops:!0,stops:r},g=e?b9.from(e):new b9;for(const A in f)g[A]==null&&(g[A]=f[A]);let _;g.set(m);try{_=await j5t(a,g,t)}catch(A){throw Ps(A)?A:new z("routelayer:failed-route-request","the routing request failed",{error:A})}const x=this._toRouteLayerSolution(_);return this._isOverridden("title")||(this.title=WS(x.routeInfo.name,"Route")),tkt(x,l,g),x}update(e){const{stops:t,directionLines:r,directionPoints:i,pointBarriers:s,polylineBarriers:n,polygonBarriers:o,routeInfo:a}=e;this.set({stops:t,pointBarriers:s,polylineBarriers:n,polygonBarriers:o}),this._set("directionLines",r),this._set("directionPoints",i),this._set("routeInfo",a),v(a.geometry)&&(this.spatialReference=a.geometry.spatialReference)}_getNetworkFeatures(e,t,r,i){var g,_,x;const s=(i6(e)?e.layers:e.featureCollection.layers).find(b=>b.layerDefinition.name===t);if(C(s))return new Ge;const{layerDefinition:n,popupInfo:o,featureSet:a}=s,l=n.drawingInfo.renderer,{features:c}=a,d=(x=(_=(g=a.spatialReference)!=null?g:n.spatialReference)!=null?_:n.extent.spatialReference)!=null?x:IJ,p=l&&hN(l),f=Ve.fromJSON(d),m=c.map(b=>{var E,O,A;const w=_i.fromJSON(b);v(w.geometry)&&v(b.geometry)&&C(b.geometry.spatialReference)&&(w.geometry.spatialReference=f);const T=r(w);return(O=T.symbol)!=null||(T.symbol=(E=p==null?void 0:p.getSymbol(w))!=null?E:this._getNetworkSymbol(t)),(A=T.popupTemplate)!=null||(T.popupTemplate=o&&Nc.fromJSON(o)),T});return i&&m.some(b=>!b.symbol)&&i(m),new Ge(m)}_getNetworkSymbol(e){switch(e){case"Barriers":return this.defaultSymbols.pointBarriers;case"DirectionPoints":return this.defaultSymbols.directionPoints;case"DirectionLines":return this.defaultSymbols.directionLines;case"PolylineBarriers":return this.defaultSymbols.polylineBarriers;case"PolygonBarriers":return this.defaultSymbols.polygonBarriers;case"RouteInfo":return this.defaultSymbols.routeInfo;case"Stops":return null}}async _getServiceDescription(e,t,r){if(v(this._cachedServiceDescription)&&this._cachedServiceDescription.url===e)return this._cachedServiceDescription.serviceDescription;const i=await Rue(e,t,r);return this._cachedServiceDescription={serviceDescription:i,url:e},i}_setStopSymbol(e){if(!e||e.length===0||C(this.defaultSymbols.stops)||e.every(d=>v(d.symbol)))return;const{first:t,last:r,middle:i,unlocated:s,waypoint:n,break:o}=this.defaultSymbols.stops;if(C(this.routeInfo)||e.length===1)return void e.forEach((d,p)=>{switch(p){case 0:d.symbol=t;break;case e.length-1:d.symbol=r;break;default:d.symbol=i}});const a=e.map(d=>d.sequence).filter(d=>v(d)),l=Math.min(...a),c=Math.max(...a);for(const d of e)d.sequence!==l?d.sequence!==c?d.status==="ok"||d.status==="not-located-on-closest"?d.locationType!=="waypoint"?d.locationType!=="break"?d.symbol=i:d.symbol=o:d.symbol=n:d.symbol=s:d.symbol=r:d.symbol=t}_toRouteLayerSolution(e){var l,c,d,p,f;const t=e.routeResults[0].stops.map(m=>Km.fromJSON(m.toJSON()));this._setStopSymbol(t);const r=new yxe(t),i=new mxe((l=e.polygonBarriers)==null?void 0:l.map(m=>{const g=pM.fromJSON(m.toJSON());return g.symbol=this.defaultSymbols.polygonBarriers,g})),s=new gxe((c=e.polylineBarriers)==null?void 0:c.map(m=>{const g=fM.fromJSON(m.toJSON());return g.symbol=this.defaultSymbols.polylineBarriers,g})),n=new fxe((d=e.pointBarriers)==null?void 0:d.map(m=>{const g=hM.fromJSON(m.toJSON());return g.symbol=this.defaultSymbols.pointBarriers,g})),o=t6.fromJSON(e.routeResults[0].route.toJSON());o.symbol=this.defaultSymbols.routeInfo;const a=new skt((p=e.routeResults[0].directionPoints)==null?void 0:p.features.map(m=>{const g=aD.fromJSON(m.toJSON());return g.symbol=this.defaultSymbols.directionPoints,g}));return{directionLines:new ikt((f=e.routeResults[0].directionLines)==null?void 0:f.features.map(m=>{const g=oD.fromJSON(m.toJSON());return g.symbol=this.defaultSymbols.directionLines,g})),directionPoints:a,pointBarriers:n,polygonBarriers:i,polylineBarriers:s,routeInfo:o,stops:r}}_writeDirectionLines(){return this._writeNetworkFeatures(this.directionLines,this.defaultSymbols.directionLines,"esriGeometryPolyline",oD.fields,oD.popupInfo,"DirectionLines","Direction Lines")}_writeDirectionPoints(){return this._writeNetworkFeatures(this.directionPoints,this.defaultSymbols.directionPoints,"esriGeometryPoint",aD.fields,aD.popupInfo,"DirectionPoints","Direction Points")}_writeNetworkFeatures(e,t,r,i,s,n,o){if(C(e)||!e.length)return null;const a=this.spatialReference.toJSON(),{fullExtent:l,maxScale:c,minScale:d}=this;return{featureSet:{features:e.toArray().map(p=>rkt(p)),geometryType:r,spatialReference:a},layerDefinition:{capabilities:"Query,Update,Editing",drawingInfo:{renderer:{type:"simple",symbol:v(t)?t.toJSON():Rie(r)}},extent:l.toJSON(),fields:i,geometryType:r,hasM:!1,hasZ:!1,maxScale:c,minScale:d,name:n,objectIdField:"ObjectID",spatialReference:a,title:o,type:"Feature Layer",typeIdField:""},popupInfo:s}}_writePointBarriers(){return this._writeNetworkFeatures(this.pointBarriers,this.defaultSymbols.pointBarriers,"esriGeometryPoint",hM.fields,hM.popupInfo,"Barriers","Point Barriers")}_writePolygonBarriers(){return this._writeNetworkFeatures(this.polygonBarriers,this.defaultSymbols.polygonBarriers,"esriGeometryPolygon",pM.fields,pM.popupInfo,"PolygonBarriers","Polygon Barriers")}_writePolylineBarriers(){return this._writeNetworkFeatures(this.polylineBarriers,this.defaultSymbols.polylineBarriers,"esriGeometryPolyline",fM.fields,fM.popupInfo,"PolylineBarriers","Line Barriers")}_writeRouteInfo(){return this._writeNetworkFeatures(v(this.routeInfo)?new Ge([this.routeInfo]):null,this.defaultSymbols.routeInfo,"esriGeometryPolyline",t6.fields,t6.popupInfo,"RouteInfo","Route Details")}_writeStops(){const e=this._writeNetworkFeatures(this.stops,null,"esriGeometryPoint",Km.fields,Km.popupInfo,"Stops","Stops");if(C(e))return null;const{stops:t}=this.defaultSymbols,r=v(t)&&v(t.first)&&t.first.toJSON(),i=v(t)&&v(t.middle)&&t.middle.toJSON(),s=v(t)&&v(t.last)&&t.last.toJSON();return e.layerDefinition.drawingInfo.renderer={type:"uniqueValue",field1:"Sequence",defaultSymbol:i,uniqueValueInfos:[{value:"1",symbol:r,label:"First Stop"},{value:`${this.stops.length}`,symbol:s,label:"Last Stop"}]},e}};u([h({readOnly:!0,json:{read:!1,origins:{"portal-item":{write:{allowNull:!0,ignoreOrigin:!0}},"web-map":{write:{overridePolicy(){return{allowNull:!0,ignoreOrigin:this.portalItem==null}}}}}}})],Ci.prototype,"_featureCollection",void 0),u([Le(["web-map","portal-item"],"_featureCollection")],Ci.prototype,"writeFeatureCollectionWebmap",null),u([h({readOnly:!0,json:{read:!1,origins:{"web-map":{write:{target:"type",overridePolicy(){return{ignoreOrigin:this.portalItem!=null}}}}}}})],Ci.prototype,"_type",void 0),u([h({nonNullable:!0,type:Oue})],Ci.prototype,"defaultSymbols",void 0),u([h({readOnly:!0})],Ci.prototype,"directionLines",void 0),u([me(["web-map","portal-item"],"directionLines",["layers","featureCollection.layers"])],Ci.prototype,"readDirectionLines",null),u([h({readOnly:!0})],Ci.prototype,"directionPoints",void 0),u([me(["web-map","portal-item"],"directionPoints",["layers","featureCollection.layers"])],Ci.prototype,"readDirectionPoints",null),u([h({readOnly:!0,json:{read:!1,origins:{"web-map":{write:{ignoreOrigin:!0}}}}})],Ci.prototype,"featureCollectionType",void 0),u([h({readOnly:!0})],Ci.prototype,"fullExtent",null),u([h({json:{origins:{"web-map":{name:"featureCollection.showLegend"}},write:!0}})],Ci.prototype,"legendEnabled",void 0),u([h({type:["show","hide"]})],Ci.prototype,"listMode",void 0),u([h({type:Number,nonNullable:!0,json:{write:!1}})],Ci.prototype,"maxScale",void 0),u([me(["web-map","portal-item"],"maxScale",["layers","featureCollection.layers"])],Ci.prototype,"readMaxScale",null),u([h({type:Number,nonNullable:!0,json:{write:!1}})],Ci.prototype,"minScale",void 0),u([me(["web-map","portal-item"],"minScale",["layers","featureCollection.layers"])],Ci.prototype,"readMinScale",null),u([h({type:["ArcGISFeatureLayer"],value:"ArcGISFeatureLayer"})],Ci.prototype,"operationalLayerType",void 0),u([h({nonNullable:!0,type:Ge.ofType(hM)})],Ci.prototype,"pointBarriers",void 0),u([me(["web-map","portal-item"],"pointBarriers",["layers","featureCollection.layers"])],Ci.prototype,"readPointBarriers",null),u([h({nonNullable:!0,type:Ge.ofType(pM)})],Ci.prototype,"polygonBarriers",void 0),u([me(["web-map","portal-item"],"polygonBarriers",["layers","featureCollection.layers"])],Ci.prototype,"readPolygonBarriers",null),u([h({nonNullable:!0,type:Ge.ofType(fM)})],Ci.prototype,"polylineBarriers",void 0),u([me(["web-map","portal-item"],"polylineBarriers",["layers","featureCollection.layers"])],Ci.prototype,"readPolylineBarriers",null),u([h({readOnly:!0})],Ci.prototype,"routeInfo",void 0),u([me(["web-map","portal-item"],"routeInfo",["layers","featureCollection.layers"])],Ci.prototype,"readRouteInfo",null),u([h({type:Ve})],Ci.prototype,"spatialReference",void 0),u([me(["web-map","portal-item"],"spatialReference",["layers","featureCollection.layers"])],Ci.prototype,"readSpatialReference",null),u([h({nonNullable:!0,type:Ge.ofType(Km)})],Ci.prototype,"stops",void 0),u([me(["web-map","portal-item"],"stops",["layers","featureCollection.layers"])],Ci.prototype,"readStops",null),u([h()],Ci.prototype,"title",null),u([h({readOnly:!0,json:{read:!1}})],Ci.prototype,"type",void 0),u([h()],Ci.prototype,"url",null),Ci=u([I(b6e)],Ci);const Iue=Ci,bzt=Object.freeze(Object.defineProperty({__proto__:null,default:Iue},Symbol.toStringTag,{value:"Module"}));function Pue(e){return(e==null?void 0:e.declaredClass)==="esri.Graphic"}function nkt(e){return Array.isArray(e)&&e.length&&Pue(e[0])}function okt(e){return Ge.isCollection(e)&&e.length&&Pue(e.getItemAt(0))}function akt(e){return(e==null?void 0:e.declaredClass)==="esri.rest.support.Stop"}var ph;(function(e){e[e.Active=0]="Active",e[e.Complete=1]="Complete",e[e.Failed=2]="Failed",e[e.Idle=3]="Idle",e[e.Suspended=4]="Suspended"})(ph||(ph={}));const x6e="esri.widgets.Directions.DirectionsViewModel",Jg=te.getLogger(x6e);let Fs=class extends $0(FF($s.EventedAccessor)){constructor(e){super(e),this._highlightLayer=new x5t({listMode:"hide",internal:!0}),this._highlight=null,this._legacyLayer=null,this._loadPromise=null,this._loadController=null,this._routeController=null,this._serviceDescriptionStatus=ph.Idle,this.apiKey=void 0,this.departureTime="now",this.lastError=null,this.lastRoute=null,this.layer=null,this.maxStops=50,this.routeParameters=new b9({directionsLengthUnits:"kilometers",findBestSequence:!1,restrictUTurns:"at-dead-ends-and-intersections",returnZ:!0,startTime:null,startTimeIsUTC:!0,useHierarchy:!0,useTimeWindows:!1}),this.serviceDescription=null,this.view=null}initialize(){this.addHandles([ms(()=>qi(this.layer,e=>e.stops),"change",()=>{this.clearResults()}),ie(()=>this.layer,(e,t)=>{var r,i;if(v(e))for(;e.stops.length<2;)e.stops.add(new Km);C(e)&&(this.layer=this.legacyLayer),v(t)&&t===this.legacyLayer&&((i=(r=this.view)==null?void 0:r.map)==null||i.remove(t))},Qi),ie(()=>{var e;return(e=this.view)==null?void 0:e.map},(e,t)=>{this.layer===this.legacyLayer&&(t==null||t.remove(this.layer),e==null||e.add(this.layer)),t==null||t.remove(this._highlightLayer),e==null||e.add(this._highlightLayer)},pt)])}destroy(){var e,t,r,i;(t=(e=this.view)==null?void 0:e.map)==null||t.remove(this._highlightLayer),this.layer===this.legacyLayer&&((i=(r=this.view)==null?void 0:r.map)==null||i.remove(this.layer))}get _directionsLanguage(){if(C(this.serviceDescription))return;const e=this.serviceDescription.directionsSupportedLanguages;if(!e)return;const t=yt(this.routeParameters.directionsLanguage,fl()).slice(0,2);return e.find(r=>r.toLowerCase().slice(0,2)===t)}get impedanceAttribute(){var r,i,s;const e=v(this.serviceDescription)?this.serviceDescription.impedance:null,t=(s=(i=(r=this.routeParameters.travelMode)==null?void 0:r.impedanceAttributeName)!=null?i:this.routeParameters.impedanceAttribute)!=null?s:e;return this.getCostAttribute(t)}get legacyLayer(){return C(this._legacyLayer)&&(this._legacyLayer=this._getLegacyLayer()),this._legacyLayer}set routeServiceUrl(e){du(Jg,"routeServiceUrl",{replacement:"layer.url",version:"4.24",warnOnce:!0}),this.legacyLayer.url=e}get routeServiceUrl(){return du(Jg,"routeServiceUrl",{replacement:"layer.url",version:"4.24",warnOnce:!0}),this.legacyLayer.url}set routeSymbol(e){du(Jg,"routeSymbol",{replacement:"layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0}),this.legacyLayer.defaultSymbols.directionLines=e}get routeSymbol(){return du(Jg,"routeSymbol",{replacement:"layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0}),this.legacyLayer.defaultSymbols.directionLines}get selectedTravelMode(){const{serviceDescription:e}=this;if(C(e))return null;const{defaultTravelMode:t,supportedTravelModes:r=[]}=e;return r.find(i=>i.id===t)||r[0]||null}set selectedTravelMode(e){this._override("selectedTravelMode",e)}get state(){if(v(this._routeController))return"routing";if(v(this.lastError))return"error";switch(this._serviceDescriptionStatus){case ph.Suspended:return"unauthenticated";case ph.Idle:return"disabled";case ph.Active:return"initializing";case ph.Failed:return"error";default:return"ready"}}set stops(e){du(Jg,"stops",{replacement:"layer.stops",version:"4.24",warnOnce:!0}),this.legacyLayer.stops=e}get stops(){return du(Jg,"stops",{replacement:"layer.stops",version:"4.24",warnOnce:!0}),this.legacyLayer.stops}castStops(e){return nkt(e)||okt(e)?e.map(t=>Km.fromGraphic(t)):e}set stopSymbols(e){du(Jg,"stopSymbols",{replacement:"layer.defaultSymbols.stops",version:"4.24",warnOnce:!0}),this.legacyLayer.defaultSymbols.stops=e}get stopSymbols(){return du(Jg,"stopSymbols",{replacement:"layer.defaultSymbols.stops",version:"4.24",warnOnce:!0}),this.legacyLayer.defaultSymbols.stops}get timeAttribute(){var t,r,i;const e=(i=(r=(t=this.routeParameters.travelMode)==null?void 0:t.timeAttributeName)!=null?r:this.routeParameters.directionsTimeAttribute)!=null?i:v(this.serviceDescription)?this.serviceDescription.directionsTimeAttribute:null;return this.getCostAttribute(e)}get travelModes(){return v(this.serviceDescription)?this.serviceDescription.supportedTravelModes:[]}async load(){if(v(this._loadPromise))return this._loadPromise;this._loadPromise=this._load(),await this._loadPromise,this._loadPromise=null}async highlight(e){this.clearHighlights();const t=await this.view.whenLayerView(this.layer);this._highlight=t.highlight(e)}highlightSegment(e){j8(Jg,"highlightSegment",{replacement:"highlight",version:"4.24",warnOnce:!0});const{geometry:t,symbol:r}=e;if(C(this.view)||C(t)||C(r))return;this.clearHighlights();const i=r.clone();i.color=new Ze([0,0,0,.8]),i.width=Math.ceil(i.width/2);const s=new _i({geometry:t,symbol:i});this._highlightLayer.add(s)}clearHighlights(){this._highlightLayer.removeAll(),v(this._highlight)&&(this._highlight.remove(),this._highlight=null)}centerAt(e){if(C(this.view))return;const t=akt(e)||Pue(e)?e.geometry:e;C(t)||this.callGoTo({target:t})}clearResults(){this._set("lastRoute",null),this.layer.removeResult()}async getDirections(){const{apiKey:e,departureTime:t,layer:r,state:i}=this;if(C(r))throw new z("directions-view-model:missing-route-layer","A route layer must be associated with the view model.");if(r===this.legacyLayer&&j8(Jg,"Using the Directions widget or view model without setting `layer` is deprecated.",{see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Directions-DirectionsViewModel.html#layer",version:"4.24",warnOnce:!0}),i==="unauthenticated"||i==="initializing"||i==="disabled"||this._serviceDescriptionStatus===ph.Failed)throw new z("directions-view-model:not-loaded","Cannot get directions until view model loads.");this._set("lastError",null),v(this._routeController)&&(this._routeController.abort(),this._routeController=null);const s=t==="now",n=t==="now"?new Date:t;if(n&&!s){const d=60*n.getTimezoneOffset()*1e3;n.setTime(n.getTime()-d)}const o=v(this.view)?this.view.spatialReference:null,a=this.routeParameters.clone();if(a.set({startTime:n,startTimeIsUTC:s,directionsLanguage:this._directionsLanguage,apiKey:e,outSpatialReference:o}),v(this.selectedTravelMode)&&(a.travelMode=this.selectedTravelMode),r.stops.filter(d=>v(d.geometry)).length<2){const d=new z("directions-view-model:not-enough-stops","Not enough stops for routing");throw this._set("lastError",d),d}this._routeController=new AbortController;const{signal:l}=this._routeController;let c=null;try{c=await r.solve(a,{signal:l})}catch(d){if(!Ps(d)){const p=new z("directions-view-model:unable-to-route","Unable to route to these addresses",{error:d});throw this._set("lastError",p),this._set("lastRoute",null),p}}finally{this._routeController=null}for(const d of c.stops)C(d.geometry)&&(d.name=null);return r.update(c),this._set("lastRoute",c),this.zoomToRoute(),c}getCostAttribute(e){var t;return(t=(v(this.serviceDescription)?this.serviceDescription.networkDataset.networkAttributes:[]).find(r=>r.name===e&&r.usageType==="cost"))!=null?t:null}reset(){this.clearHighlights(),this.clearResults(),v(this.layer)&&(this.layer.removeAll(),this.layer.stops=new Ge([new Km,new Km]))}save(){return this.layer.save()}saveAs(e,t={}){return this.layer.saveAs(e,t)}zoomToRoute(){const{view:e,layer:{routeInfo:t}}=this;if(C(e)||C(t))return;const{geometry:r}=t;if(C(r))return;const{extent:i}=r,s=i.width>i.height,n=i.clone().expand(s?2:1);this.callGoTo({target:n})}_getLegacyLayer(){const e=g6e();return new Iue({listMode:"hide",defaultSymbols:new Oue({directionLines:new Ul({color:e,width:7,cap:"round",join:"round"}),directionPoints:null,routeInfo:null,stops:new Aue({break:new ko({color:[255,255,255],size:10,outline:{color:[20,89,127],width:2.5}}),first:new ko({color:e,size:19,outline:{color:[51,51,51],width:3}}),last:new gE({width:23,height:23,url:`data:image/svg+xml;base64,${btoa(`<svg width="30" height="30" viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M15.15.3C6.9.3.3 6.9.3 15.15S6.9 29.7 15.15 29.7 29.7 23.1 29.7 15.15C29.7 6.9 23.25.3 15.15.3z" fill="#333"/><path d="M15 4.8C9.3 4.8 4.8 9.45 4.8 15c0 5.55 4.65 10.2 10.2 10.2 5.55 0 10.2-4.5 10.2-10.2 0-5.55-4.5-10.2-10.2-10.2z" fill="${e.toHex()}"/><path fill="#333" d="M10.5 10.5h9v9h-9z"/></g></svg>`)}`}),middle:new ko({color:[51,51,51],size:12,outline:{color:e,width:3}}),unlocated:new gE({height:18,width:18,url:`data:image/svg+xml;base64,${btoa(`<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M10.1.2C4.6.2.2 4.6.2 10.1s4.4 9.7 9.9 9.7 9.7-4.4 9.7-9.7c0-5.5-4.3-9.9-9.7-9.9z" fill="#333" fill-rule="nonzero"/><path d="M10 2.7c-4.08 0-7.3 3.328-7.3 7.3s3.328 7.3 7.3 7.3 7.3-3.22 7.3-7.3c0-3.972-3.22-7.3-7.3-7.3z" fill="${e.toHex()}" fill-rule="nonzero"/><path d="M11.414 10l5.304-5.303-1.415-1.415L10 8.586 4.697 3.282 3.282 4.697 8.586 10l-5.304 5.303 1.415 1.415L10 11.414l5.303 5.304 1.415-1.415L11.414 10z" fill="#333"/></g></svg>`)}`}),waypoint:new ko({color:[255,255,255],size:10,outline:{color:[20,89,127],width:2.5}})})}),stops:[{},{}]})}async _load(){if(v(this.serviceDescription)||C(this.layer))return;v(this._loadController)&&(this._loadController.abort(),this._loadController=null),this._loadController=new AbortController;const{signal:e}=this._loadController;try{this._serviceDescriptionStatus=ph.Active;const t=await Rue(this.layer.url,this.apiKey,{signal:e});this._set("serviceDescription",t),this._serviceDescriptionStatus=ph.Complete}catch(t){if(Ps(t))return void(this._serviceDescriptionStatus=ph.Idle);if(t.name==="identity-manager:user-aborted")return void(this._serviceDescriptionStatus=ph.Suspended);const r=new z("directions-view-model:service-metadata-unavailable","Cannot load route service metadata",{error:t});throw this._serviceDescriptionStatus=ph.Failed,this._set("lastError",r),r}finally{this._loadController=null}}};u([h()],Fs.prototype,"_directionsLanguage",null),u([h()],Fs.prototype,"_routeController",void 0),u([h()],Fs.prototype,"_serviceDescriptionStatus",void 0),u([h()],Fs.prototype,"apiKey",void 0),u([h()],Fs.prototype,"departureTime",void 0),u([h({readOnly:!0})],Fs.prototype,"impedanceAttribute",null),u([h()],Fs.prototype,"lastError",void 0),u([h({readOnly:!0})],Fs.prototype,"lastRoute",void 0),u([h()],Fs.prototype,"layer",void 0),u([h({readOnly:!0})],Fs.prototype,"legacyLayer",null),u([h({type:Number,range:{min:2,max:50},nonNullable:!0})],Fs.prototype,"maxStops",void 0),u([h({type:b9,nonNullable:!0})],Fs.prototype,"routeParameters",void 0),u([h()],Fs.prototype,"routeServiceUrl",null),u([h()],Fs.prototype,"routeSymbol",null),u([h()],Fs.prototype,"selectedTravelMode",null),u([h({readOnly:!0})],Fs.prototype,"serviceDescription",void 0),u([h({readOnly:!0})],Fs.prototype,"state",null),u([h()],Fs.prototype,"stops",null),u([Gt("stops")],Fs.prototype,"castStops",null),u([h()],Fs.prototype,"stopSymbols",null),u([h({readOnly:!0})],Fs.prototype,"timeAttribute",null),u([h()],Fs.prototype,"travelModes",null),u([h()],Fs.prototype,"view",void 0),u([h()],Fs.prototype,"getDirections",null),u([h()],Fs.prototype,"zoomToRoute",null),Fs=u([I(x6e)],Fs);const T6e=Fs,dd="esri-save-layer",Zf={panel:`${dd}`,error:`${dd}__error`,errorIcon:`${dd}__error-icon`,errorLabel:`${dd}__error-label`,layerNameLabel:`${dd}__layer-name-label`,portalFolderLabel:`${dd}__portal-folder-label`,processLabel:`${dd}__process-label`,processLoader:`${dd}__process-loader`};let W_=class extends Ss{constructor(e,t){super(e,t),this._folders=null,this._layer=null,this._userName=null,this.messages=null,this.messagesCommon=null,this.messagesIdentity=null,this.opened=!1,this.state="initialized"}loadDependencies(){return Promise.all([re(()=>import("./calcite-button.40667b5c.js"),["assets/calcite-button.40667b5c.js","assets/label2.941e96ef.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js","assets/form.5aa109f5.js","assets/icon.1cb7558b.js","assets/loader.4ea8c9eb.js","assets/guid.ae96513b.js"]),re(()=>import("./calcite-combobox.e98617dd.js"),["assets/calcite-combobox.e98617dd.js","assets/floating-ui.52045298.js","assets/guid.ae96513b.js","assets/utils2.0f341a19.js","assets/label2.941e96ef.js","assets/form.5aa109f5.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js","assets/openCloseComponent.4cb32f59.js","assets/conditionalSlot.57b8b866.js","assets/icon.1cb7558b.js"]),re(()=>import("./calcite-combobox-item.bb33c5dc.js"),["assets/calcite-combobox-item.bb33c5dc.js","assets/guid.ae96513b.js","assets/utils2.0f341a19.js","assets/conditionalSlot.57b8b866.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js","assets/icon.1cb7558b.js"]),re(()=>import("./calcite-icon.85645cae.js"),["assets/calcite-icon.85645cae.js","assets/icon.1cb7558b.js","assets/observers.2da64440.js"]),re(()=>import("./calcite-input.f28950e8.js"),["assets/calcite-input.f28950e8.js","assets/label2.941e96ef.js","assets/form.5aa109f5.js","assets/locale.77bc15e3.js","assets/key.eb5605f7.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js","assets/icon.1cb7558b.js"]),re(()=>import("./calcite-label.95079e09.js"),["assets/calcite-label.95079e09.js","assets/label2.941e96ef.js"]),re(()=>import("./calcite-loader.82bf2bf1.js"),["assets/calcite-loader.82bf2bf1.js","assets/loader.4ea8c9eb.js","assets/guid.ae96513b.js"]),re(()=>import("./calcite-panel.7896151a.js"),["assets/calcite-panel.7896151a.js","assets/panel.28437f15.js","assets/popover.941796be.js","assets/floating-ui.52045298.js","assets/guid.ae96513b.js","assets/openCloseComponent.4cb32f59.js","assets/key.eb5605f7.js","assets/action.e2cbe816.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js","assets/icon.1cb7558b.js","assets/loader.4ea8c9eb.js"])])}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}close(){this.opened=!1,this.state="initialized"}async open(e){this.state="initialized",this.opened=!0,this._layer=e,this.state="connect-to-portal";const t=oo.getDefault();try{await t._signIn()}catch(i){return void(Ps(i)||i.name==="identity-manager:user-aborted"?this.close():this.state="connect-to-portal-error")}this.state="fetch-portal-information";const{user:r}=t;this._userName=r.username;try{this._folders=await r.fetchFolders()}catch{return void(this.state="fetch-portal-information-error")}this.state="save-layer"}render(){switch(this.state){case"initialized":return this._renderInitialized();case"connect-to-portal":return this._renderProcess(this.messagesIdentity.lblSigning);case"connect-to-portal-error":return this._renderError(this.messages.errors.authenticating);case"fetch-portal-information":return this._renderProcess(this.messages.processing.fetching);case"fetch-portal-information-error":return this._renderError(this.messages.errors.fetching);case"save-layer":return this._renderSaveLayer();case"saving":return this._renderProcess(this.messages.processing.saving);case"saving-error":return this._renderError(this.messages.errors.saving)}}_renderError(e){return P("calcite-panel",{class:Zf.panel,heading:this.messages.widgetLabel,key:`${dd}-error-panel`},P("div",{class:Zf.error},P("calcite-icon",{class:Zf.errorIcon,icon:"exclamation-mark-triangle",scale:"l",textLabel:this.messagesCommon.errorMessage}),P("calcite-label",{class:Zf.errorLabel},e)),P("calcite-button",{appearance:"outline",onclick:()=>{this.close()},slot:"footer-actions",width:"half"},this.messagesCommon.close))}_renderInitialized(){return P("calcite-panel",{class:Zf.panel,heading:this.messages.widgetLabel,key:`${dd}-initialize-panel`})}_renderProcess(e){return P("calcite-panel",{class:Zf.panel,heading:this.messages.widgetLabel,key:`${dd}-process-panel`},P("calcite-loader",{class:Zf.processLoader,label:e,active:!0}),P("calcite-label",{class:Zf.processLabel,alignment:"center"},e))}_renderSaveLayer(){if(C(this._layer)||C(this._folders)||C(this._userName))return this._renderInitialized();const{stops:e}=this._layer,t=`${e.getItemAt(0).name} - ${e.getItemAt(e.length-1).name}`,r=this._folders.map(i=>P("calcite-combobox-item",{key:`${dd}-folder-${i.id}`,"text-label":i.title,value:i.id}));return r.unshift(P("calcite-combobox-item",{key:`${dd}-folder-home`,selected:!0,"text-label":`${this._userName} (${this.messagesCommon.home})`,value:null})),P("calcite-panel",{class:Zf.panel,heading:this.messages.widgetLabel,key:`${dd}-save-panel`},P("calcite-label",{class:Zf.layerNameLabel},this.messages.laverName,P("calcite-input",{afterCreate:i=>{this._layerNameInput=i},label:this.messages.laverName,value:t})),P("calcite-label",{class:Zf.portalFolderLabel},this.messages.saveInFolder,P("calcite-combobox",{afterCreate:i=>{this._portalFolderCombobox=i},label:this.messages.saveInFolder,"overlay-positioning":"fixed","selection-mode":"single"},r)),P("calcite-button",{onclick:()=>this._saveButtonClick(),slot:"footer-actions",width:"half"},this.messagesCommon.save),P("calcite-button",{appearance:"outline",onclick:()=>{this.close()},slot:"footer-actions",width:"half"},this.messagesCommon.cancel))}_saveButtonClick(){this.state="saving",this._saveLayer().then(()=>{this.close()}).catch(()=>{this.state="saving-error"})}async _saveLayer(){if(C(this._layer)||C(this._folders))return;const e=this._layerNameInput.value,t=this._portalFolderCombobox.value,r=this._folders.find(i=>i.id===t);await this._layer.saveAs({title:e},{folder:r})}};u([h()],W_.prototype,"label",null),u([h(),xi("esri/widgets/support/t9n/SaveLayer")],W_.prototype,"messages",void 0),u([h(),xi("esri/t9n/common")],W_.prototype,"messagesCommon",void 0),u([h(),xi("esri/identity/t9n/identity")],W_.prototype,"messagesIdentity",void 0),u([h()],W_.prototype,"opened",void 0),u([h()],W_.prototype,"state",void 0),W_=u([I("esri.widgets.Directions.SaveLayer")],W_);function lkt(e,t){return{type:yE(t),value:e,unit:t}}function S6e(e,t){return{type:yE(t),value:e,unit:t}}function ckt(e,t){return{type:yE(t),value:e,unit:t}}function ukt(e,t,r="arithmetic"){return{type:yE(t),value:e,unit:t,rotationType:r}}function Yw(e,t){return lkt(zn(e.value,e.unit,t),t)}S6e(0,"meters");ckt(0,"square-meters");ukt(0,"radians");function T3(e,t){return Yh(e,{style:"unit",unit:t,unitDisplay:"short"})}function dkt(e){return e.value<.254?Yw(e,"inches"):e.value<1609.344?Yw(e,"feet"):Yw(e,"miles")}function hkt(e){return e.value<.01?Yw(e,"millimeters"):e.value<1?Yw(e,"centimeters"):e.value<1e3?Yw(e,"meters"):Yw(e,"kilometers")}function _xe(e,t,r){let i,s;const n=S6e(t,"meters");switch(r){case"metric":({value:i,unit:s}=hkt(n));break;case"imperial":({value:i,unit:s}=dkt(n));break;default:({value:i,unit:s}=Yw(n,r))}return i===0?"":r4(e,i,s,r==="metric"||r==="imperial"?0:2)}function vxe(e){if(e===0)return"";if(e<1)return T3(Math.floor(60*e),"second");if(e<60)return T3(Math.floor(e),"minute");const t=Math.floor(e/60),r=Math.floor(e%60);return r===0?`${T3(t,"hour")}`:`${T3(t,"hour")} ${T3(r,"minute")}`}const ct="esri-directions",Ce={base:`${ct} esri-widget esri-widget--panel`,directionsButton:`${ct}__button`,clearRouteButton:`${ct}__clear-route-button`,scroller:`${ct}__scroller`,panelContent:`${ct}__panel-content`,panelContentLoading:`${ct}__panel-content--loading`,panelContentError:`${ct}__panel-content--error`,panelContentSignIn:`${ct}__panel-content--sign-in`,loader:`${ct}__loader`,message:`${ct}__message`,travelMode:`${ct}__travel-modes`,travelModeSelect:`${ct}__travel-modes-select`,departureTime:`${ct}__departure-time`,departureTimeSelect:`${ct}__departure-time-select`,directionsSection:`${ct}__directions-section`,departureTimeControls:`${ct}__departure-time-controls`,section:`${ct}__section`,summary:`${ct}__summary`,stopIcon:`${ct}__stop-icon`,interactiveStopIcon:`${ct}__stop-icon--interactive`,removeStopButton:`${ct}__remove-stop`,removeStop:`${ct}__remove-stop-icon`,reverseStops:`${ct}__reverse-stops`,stopIconContainer:`${ct}__stop-icon-container`,lastStopIconContainer:`${ct}__stop-icon-container--last`,stopHandle:`${ct}__stop-handle`,stopInput:`${ct}__stop-input`,stopOptions:`${ct}__stop-options`,stopHandleIcon:`${ct}__stop-handle-icon`,verticalSplitter:`${ct}__vertical-splitter`,stopRow:`${ct}__stop-row`,stopRowGhost:`${ct}__stop-row-ghost`,validStopRow:`${ct}__stop-row--valid`,stops:`${ct}__stops`,directionCosts:`${ct}__costs`,costsDetails:`${ct}__costs-details`,primaryCosts:`${ct}__costs-value`,secondaryCosts:`${ct}__other-costs-total`,routeActions:`${ct}__route-actions`,maneuvers:`${ct}__maneuvers`,maneuverList:`${ct}__maneuver-list`,maneuverSection:`${ct}__maneuver-section`,maneuverSectionHeader:`${ct}__maneuver-section-header`,maneuverSectionHeaderButton:`${ct}__maneuver-section-header-toggle-button`,maneuverSectionTitle:`${ct}__maneuver-section-title`,collapsibleSection:`${ct}__maneuver-section--collapsible`,maneuverSectionToggle:`${ct}__maneuver-section-toggle`,maneuver:`${ct}__maneuver`,maneuverActive:`${ct}__maneuver--active`,maneuverCosts:`${ct}__maneuver-costs`,maneuverCostsContainer:`${ct}__maneuver-costs-container`,maneuverIcon:`${ct}__maneuver-icon`,intermediateCost:`${ct}__cost--intermediate`,horizontalSplitter:`${ct}__horizontal-splitter`,sectionSplitter:`${ct}__section-splitter`,disclaimer:`${ct}__disclaimer`,signInContent:`${ct}__sign-in-content`,signInButton:`${ct}__sign-in-button`,contentTitle:`${ct}__content-title`,warningCard:`${ct}__warning-card`,warningHeader:`${ct}__warning-header`,warningHeading:`${ct}__warning-heading`,warningMessage:`${ct}__warning-message`,saveSection:`${ct}__save-section`,saveButtons:`${ct}__save-buttons`,saveButton:`${ct}__save-button`,saveAsButton:`${ct}__save-as-button`,saveAsButtonPopover:`${ct}__save-as-button-with-popover`,printButton:`${ct}__print-button`,layerDetailsLink:`${ct}__layer-details-link`,toolbarSection:`${ct}__toolbar-section`,toolbarButtons:`${ct}__toolbar-buttons`,addStopButton:`${ct}__add-stop-button`,closeIcon:"esri-icon-up",handleIcon:"esri-icon-handle-vertical",lastStopIcon:"esri-icon-radio-checked",openIcon:"esri-icon-down",removeStopIcon:"esri-icon-trash",reverseStopIcon:"esri-icon-up-down-arrows",stopsIcon:"esri-icon-radio-unchecked",warningIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-directions",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonSecondary:"esri-button--secondary",buttonTertiary:"esri-button--tertiary",emptyContent:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",screenReaderText:"esri-icon-font-fallback-text",select:"esri-select"},bxe=new Map([["bear-left","bear-left"],["bear-right","bear-right"],["central-fork","fork-middle"],["door","walk-through-door"],["elevator","elevator"],["escalator","escalator"],["left-fork","fork-left"],["left-ramp","ramp-left"],["left-turn","left"],["left-turn-and-immediate-left-turn","left-left"],["left-turn-and-immediate-right-turn","left-right"],["off-ferry","disembark"],["on-ferry","embark"],["pedestrian-ramp","take-pedestrian-ramp"],["right-fork","fork-right"],["right-ramp","exit-highway-right"],["right-ramp","ramp-right"],["right-turn","right"],["right-turn-and-immediate-left-turn","right-left"],["right-turn-and-immediate-right-turn","right-right"],["roundabout","roundabout-left"],["sharp-left","sharp-left"],["sharp-right","sharp-right"],["stairs","stairs"],["straight","straight"],["u-turn","u-turn-left"]]);var Sc;(function(e){e.NOW="now",e.DEPART_BY="depart-by",e.UNSPECIFIED="unspecified"})(Sc||(Sc={}));const pkt=()=>ui("esri/themes/base/images/maneuvers/");function fkt(e){if(C(e)||!bxe.has(e))return null;const t=bxe.get(e),r=window.devicePixelRatio===2?"@2x":"";return`${pkt()}${t}${r}.png`}let Iie=class extends kke{constructor(e){super(e)}};Iie=u([I("esri.widgets.support.TimePickerViewModel")],Iie);const E6e=Iie,JY={base:"esri-time-picker esri-widget",timePicker:"esri-time-picker__date-picker",timePickerInput:"esri-time-picker__input",input:"esri-input",button:"esri-widget--button"},Pie={hour:"numeric",minute:"numeric"},wxe="t",mkt=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Tab"];function xxe(e){return _s(e.valueOf(),Pie).includes(" ")}let OO=class extends Ss{constructor(e,t){super(e,t),this._activeTime=null,this.messages=null,this.viewModel=new E6e}get value(){return this.viewModel.value}set value(e){this.viewModel.value=e}render(){const e=this._activeTime||this.viewModel.value;return P("div",{class:JY.base},P("input",{afterUpdate:this._handleInputUpdate,"aria-label":this.messages.inputTitle,bind:this,class:this.classes(JY.timePickerInput,JY.input),onblur:this._handleInputBlur,onfocus:this._handleInputFocus,onkeydown:this._handleInputKeydown,oninput:this._handleInputKeydown,onclick:this._handleInputClick,onpaste:this._handleInputPaste,onwheel:this._handleInputWheel,value:_s(e.valueOf(),Pie)}))}_handleInputBlur(){this._activeTime.isValid&&(this.viewModel.value=this._activeTime.toJSDate()),this._activeTime=null,this._activePart=null}_handleInputUpdate(e){this._selectPart(e,this._activePart)}_selectPart(e,t){const r=this._activeTime;if(!r)return;const i=_s(r.valueOf(),Pie),s=0,n=i.indexOf(":");if(t==="hours")return void e.setSelectionRange(s,n);const o=n+1,a=o+2;if(t==="minutes")return void e.setSelectionRange(o,a);const l=a+1,c=i.length;t!=="meridiem"||e.setSelectionRange(l,c)}_handleInputFocus(e){this._activePart="hours",this._activeTime=Kt.fromJSDate(this.viewModel.value).startOf("minute"),this._selectPart(e.target,"hours")}_caretIndexToPartName(e){const t=this._activeTime.toFormat(wxe,{locale:fl(),numberingSystem:"latn"}),r=t.indexOf(":"),i=t.indexOf(" ");return e<=r?"hours":e>r&&e<=i?"minutes":"meridiem"}_handleInputKeydown(e){const{ctrlKey:t,metaKey:r,shiftKey:i}=e,s=Uo(e),n=this._activeTime,o=this._activePart,a=/\d/.test(s),l=/^a|p$/i.test(s),c=r||t;if(mkt.includes(s)||a||o==="meridiem"&&l&&!c){if(s==="ArrowLeft")this._activePart=this._prevPart();else if(s==="ArrowRight")this._activePart=this._nextPart();else if(s==="Tab"){const d=i?this._prevPart():this._nextPart();if(d===this._activePart)return;this._activePart=d}else if(s==="ArrowUp")this._shift("up",o);else if(s==="ArrowDown")this._shift("down",o);else if(a)this._setTime(n,o,Number(s));else if(l){const d=s.toLowerCase(),p=n.hour;(d==="a"&&p>=12||d==="p"&&p<12)&&this._shift("up",o)}e.preventDefault(),e.stopImmediatePropagation()}else c||(e.preventDefault(),e.stopImmediatePropagation())}_handleInputClick(e){const t=e.target;this._activePart=null,this.renderNow(),this._activePart=this._caretIndexToPartName(t.selectionStart)}_getOrderedParts(){return xxe(this._activeTime)?["hours","minutes","meridiem"]:["hours","minutes"]}_prevPart(){const e=this._getOrderedParts(),t=e.indexOf(this._activePart)-1;return e[Math.max(t,0)]}_nextPart(){const e=this._getOrderedParts(),t=e.indexOf(this._activePart)+1;return e[Math.min(t,e.length-1)]}_setTime(e,t,r){if(t==="hours"){const i=xxe(e)?12:24,s=""+e.hour%i,n=r,o=Number(`${s}${r}`);s.length===2||o>i?this._activeTime=e.set({hour:n}):o<=i&&(this._activeTime=e.set({hour:o}))}else if(t==="minutes"){const s=`${e.minute}`,n=r,o=Number(`${s}${r}`);s.length===2||o>59?this._activeTime=e.set({minute:n}):o<59&&(this._activeTime=e.set({minute:o}))}}_parseTime(e){const t={locale:fl(),numberingSystem:"latn"};let r=Kt.fromFormat(e,wxe,t);return r.isValid?r:(r=Kt.fromISO(e,t),r.isValid?r:(r=Kt.fromRFC2822(e,t),r.isValid?r:(r=Kt.fromJSDate(new Date(e)),r.isValid?r:null)))}_handleInputPaste(e){const t=e.clipboardData.getData("text/plain"),r=this._parseTime(t);r&&(this._activeTime=r),e.preventDefault(),e.stopImmediatePropagation()}_handleInputWheel(e){const t=e.deltaY<0?"up":"down";this._shift(t,this._activePart)}_shift(e,t){if(!e||!t)return;const r=e==="up"?"plus":"minus",i=t==="meridiem"?12:1,s=t==="hours"?"hour":t==="minutes"?"minute":"hours";this._activeTime=this._activeTime[r]({[s]:i})}};u([h(),xi("esri/widgets/support/t9n/TimePicker")],OO.prototype,"messages",void 0),u([h()],OO.prototype,"value",null),u([h({type:E6e})],OO.prototype,"viewModel",void 0),OO=u([I("esri.widgets.support.TimePicker")],OO);const gkt=OO,Txe={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0};function ykt(e){const t=e.getTimezoneOffset(),r=t>0?"-":"+",i=60,s=Math.abs(Math.floor(t/i)),n=Math.abs(Math.floor(t)%i),o={minimumIntegerDigits:2};return`GMT${r}${Yh(s,o)}${Yh(n,o)}`}function Sxe(e){var t;return!!((t=e.composedPath)!=null&&t.call(e).find(r=>{var i;return(i=r.classList)==null?void 0:i.contains("esri-search__suggestions-list")}))}const KY="search-term",Exe="date-time-picker",Cxe=100,_kt=500,C6e="esri.widgets.Directions",EA=te.getLogger(C6e);let as=class extends Ss{constructor(e,t){super(e,t),this._autoStopRemovalDelay=Cxe,this._departureTime=Sc.NOW,this._datePicker=new zUe,this._newPlaceholderStop=null,this._pointerPressedSearchSuggestionStop=null,this._renderSavePopoverFunction=null,this._saveAsButtonNode=null,this._saveLayer=new W_,this._sections=null,this._stopsToSearches=new Map,this._timePicker=new gkt,this.headingLevel=2,this.iconClass=Ce.widgetIcon,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.searchProperties=null,this.viewModel=new T6e,this.visibleElements={...Txe},this._setUpDragAndDropStops=r=>{this._sortable=pr.create(r,{draggable:`.${Ce.validStopRow}`,ghostClass:Ce.stopRowGhost,handle:`.${Ce.stopHandle}`,onEnd:this._handleStopInputDragEnd})},this._handleDragHandlePointerDown=()=>this.viewModel.layer.stops.forEach(r=>this._acquireSearch(r).activeMenu="none"),this._handleStopInputDragEnd=({oldIndex:r,newIndex:i,target:s})=>{if(r===i)return;const{children:n}=s,o=n[i],a=n[r],l=i-r<0;s.insertBefore(o,l?a.nextElementSibling:a);const c=this.viewModel.layer.stops;c.reorder(c.getItemAt(r),i);for(const d of c)d.sequence=null;this._getDirections()}}initialize(){this.addHandles([ie(()=>this.viewModel.layer.routeInfo,()=>{this._activeManeuver=null,this._focusedManeuver=null,this._sections=this._getSections(),this.scheduleRender()},pt),no(()=>this.view,(e,t)=>{if(t&&(this._viewClickHandle=null,this.removeHandles(t)),e){const r=this._prepPointerDownUpClick(),i=this._prepViewClick();r.pause(),i.pause(),this.addHandles([mx(e.surface,"mousedown",()=>this._autoStopRemovalDelay=_kt),mx(e.surface,"mouseup",()=>this._autoStopRemovalDelay=Cxe),r,i],e),this._pointerDownUpHandle=r,this._viewClickHandle=i}},pt),no(()=>C(this.viewModel.serviceDescription),()=>{try{this.viewModel.load()}catch{}},pt),ie(()=>this._saveLayer.state,()=>{this.scheduleRender()})]),this.when(()=>{this.destroyed||(this._renderSavePopoverFunction=this._renderSavePopover.bind(this),this._projector.append(document.body,this._renderSavePopoverFunction))})}loadDependencies(){return Promise.all([re(()=>import("./calcite-button.40667b5c.js"),["assets/calcite-button.40667b5c.js","assets/label2.941e96ef.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js","assets/form.5aa109f5.js","assets/icon.1cb7558b.js","assets/loader.4ea8c9eb.js","assets/guid.ae96513b.js"]),re(()=>import("./calcite-link.63e2a2f4.js"),["assets/calcite-link.63e2a2f4.js","assets/interactive.d71a7a54.js","assets/icon.1cb7558b.js","assets/observers.2da64440.js"]),re(()=>import("./calcite-popover.080622e1.js"),["assets/calcite-popover.080622e1.js","assets/popover.941796be.js","assets/floating-ui.52045298.js","assets/guid.ae96513b.js","assets/openCloseComponent.4cb32f59.js","assets/key.eb5605f7.js","assets/action.e2cbe816.js","assets/observers.2da64440.js","assets/interactive.d71a7a54.js","assets/icon.1cb7558b.js","assets/loader.4ea8c9eb.js"])])}destroy(){this._datePicker.destroy(),this._timePicker.destroy();for(const e of this._stopsToSearches.values())e.destroy();this._sortable&&this._sortable.destroy(),v(this._renderSavePopoverFunction)&&this._projector.detach(this._renderSavePopoverFunction)}get apiKey(){return this.viewModel.apiKey}set apiKey(e){this.viewModel.apiKey=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e,t;return(t=(e=this.messages)==null?void 0:e.widgetLabel)!=null?t:""}set label(e){this._overrideIfSome("label",e)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxStops(){return this.viewModel.maxStops}set maxStops(e){this.viewModel.maxStops=e}set routeServiceUrl(e){du(EA,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.url=e}get routeServiceUrl(){return du(EA,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.url}set routeSymbol(e){du(EA,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.directionLines=e}get routeSymbol(){return du(EA,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.directionLines}set stopSymbols(e){du(EA,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.stops=e}get stopSymbols(){return du(EA,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.stops}get unit(){return this.defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...Txe,...e}}getDirections(){return this.viewModel.getDirections()}render(){return P("div",{class:this.classes(Ce.base,Ce.scroller)},this._renderPanelContent())}save(){return this.viewModel.layer.save()}saveAs(e,t={}){return this.viewModel.layer.saveAs(e,t)}zoomToRoute(){return this.viewModel.zoomToRoute()}_renderPanelContent(){const{viewModel:{serviceDescription:e,state:t}}=this,r=t==="initializing",i=t==="error"&&!e,s=t==="unauthenticated",n={[Ce.panelContentLoading]:r,[Ce.panelContentError]:i,[Ce.panelContentSignIn]:s},o=r?"presentation":"group",a=s?this._renderSignIn():i?this._renderMessage(this._getErrorMessage()):r?this._renderLoader():this._renderReadyContent();return P("div",{class:this.classes(Ce.panelContent,n),role:o},a)}_renderReadyContent(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]}_renderSignIn(){return P("div",{key:"sign-in",class:Ce.signInContent},P(Sh,{class:Ce.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),P(Sh,{level:jWe(this.headingLevel)},this.messages.signInRequired),P("button",{class:this.classes(Ce.button,Ce.buttonSecondary,Ce.signInButton),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))}_handleSignInClick(){this.viewModel.load().catch(()=>{})}_renderTravelModeOptions(){if(!this.visibleElements.traveMode)return null;const{selectedTravelMode:e,travelModes:t}=this.viewModel;if(t.length===0)return null;const r=v(e)?e.name:this.messages.travelMode;return P("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(Ce.travelMode,this._saveLayer.opened&&Ce.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},P("select",{"aria-label":r,bind:this,class:this.classes(Ce.travelModeSelect,Ce.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:r},t.map(i=>{const s=v(e)&&i.id===e.id;return P("option",{key:`esri-directions__travel-mode-${i.id}`,"data-mode":i,selected:s,value:i.id},i.name)})))}_handleTravelModeChange(e){const t=e.currentTarget,r=t.item(t.selectedIndex);this.viewModel.selectedTravelMode=r["data-mode"],this._getDirections()}_renderStopsContainer(){return this.visibleElements.stops?P("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(Ce.section,this._saveLayer.opened&&Ce.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null}_renderDepartureTimeControls(){if(!this.visibleElements.departureTime)return null;const e=this._departureTime,{messages:t}=this,r=t.departureTime;return P("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(Ce.departureTime,this._saveLayer.opened&&Ce.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},P("select",{"aria-label":r,bind:this,class:this.classes(Ce.departureTimeSelect,Ce.select),onchange:this._handleDepartureOptionChange,title:r},P("option",{value:Sc.NOW,selected:e===Sc.NOW},t.leaveNow),P("option",{value:Sc.DEPART_BY,selected:e===Sc.DEPART_BY},t.departBy),P("option",{value:Sc.UNSPECIFIED,selected:e===Sc.UNSPECIFIED},t.timeUnspecified)),e===Sc.DEPART_BY?this._renderTimeControls():null)}_renderStops(){const e=this.viewModel.layer.stops;let t=0;for(const s of this._stopsToSearches.keys())e.includes(s)||this._disposeSearch(s);for(const s of e){const n=this._acquireSearch(s);n.activeMenu!=="none"&&(t+=1),v(s.name)&&(n.searchTerm=s.name)}const r=e.toArray().map((s,n)=>{const o=e.length,a=n>1&&C(s.geometry),l={[Ce.stopsIcon]:n>=0&&n<o-1,[Ce.lastStopIcon]:n===o-1},c={[Ce.lastStopIconContainer]:n===o-1},d={[Ce.validStopRow]:!a},p=e.getItemAt(n+1),f=p&&v(p.geometry),m=n===o-1,g=n===o-2,_=o===2&&n===0||o>2&&!m&&!g||o>2&&g&&f||o>2&&m&&C(s.geometry),x=o<3,b=this._acquireSearch(s),{messages:w}=this,{removeStop:T,reverseStops:E,unlocated:O}=w,A=hu(w.stopLabelTemplate,{number:n+1,label:v(s.geometry)?s.name:O}),R=`${this.id}__stop--${n}`,D=!!b.searchTerm&&!!b.selectedResult&&v(s.geometry)&&b.selectedResult.name===s.name,k={zIndex:b.activeMenu!=="none"?""+t--:""};return P("li",{"aria-label":A,afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(Ce.stopRow,d),id:R,key:n,"data-stop-index":n,styles:k},P("div",{class:Ce.stopHandle},P("span",{"aria-hidden":"true",class:this.classes(Ce.stopIcon,Ce.handleIcon,Ce.stopHandleIcon,Ce.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),P("div",{bind:this,"aria-labelledby":R,class:this.classes(Ce.stopIconContainer,c),"data-stop-index":n,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},P("span",{class:this.classes(Ce.stopIcon,l),tabindex:D?"0":null}))),P("div",{class:Ce.stopInput},b.render()),P("div",{class:Ce.stopOptions,role:"group"},P("div",{"aria-label":T,class:Ce.removeStopButton,bind:this,"data-stop-index":n,hidden:x,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,role:"button",tabIndex:0,title:T},P("span",{"aria-hidden":"true",class:this.classes(Ce.stopIcon,Ce.removeStop,Ce.removeStopIcon,Ce.interactiveStopIcon)}),P("span",{class:Ce.screenReaderText},"removeStopTitle")),P("div",{"aria-label":E,class:Ce.reverseStops,bind:this,hidden:_,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:E},P("span",{"aria-hidden":"true",class:this.classes(Ce.stopIcon,Ce.reverseStopIcon,Ce.interactiveStopIcon)}),P("span",{class:Ce.screenReaderText},"removeStopTitle"))))}),i=this._renderAddStop();return P("div",null,P("ol",{class:Ce.stops,role:"group",afterCreate:this._setUpDragAndDropStops},r),i)}_renderAddStop(){const{stops:e}=this.viewModel.layer,t=e.filter(({geometry:i})=>v(i)),r=e.at(-1);return t.length>1&&t.length<this.maxStops&&v(r)&&v(r.geometry)?P("div",{class:Ce.toolbarSection},P("div",{class:Ce.toolbarButtons},P("calcite-button",{appearance:"outline",class:Ce.addStopButton,color:"neutral",scale:"s",round:!0,"icon-start":"plus",key:Ce.addStopButton,onclick:()=>{this._addNewPlaceholder()},text:this.messages.addStop,width:"full"},this.messages.addStop))):null}_handleStopIconClick(e){const t=e.currentTarget["data-stop-index"],r=this.viewModel.layer.stops.getItemAt(t);r&&v(r.geometry)&&this._centerAtStop(r)}_handleClearRouteClick(){this.viewModel.reset()}_centerAtStop(e){this.viewModel.centerAt(e)}_handleStopFieldCreation(e){const t=this._newPlaceholderStop;if(!t)return;const r=e["data-stop-index"],i=this.viewModel.layer.stops.getItemAt(r);if(t===i){const s=this._acquireSearch(i);s.when(()=>{this.renderNow(),s.focus()})}this._newPlaceholderStop=null}_handleStopInputBlur(e,t){var s,n,o,a;if(this._saveLayer.opened)return;if(this.removeHandles(KY),!!e.selectedResult&&v(t.geometry)&&v((s=e.selectedResult)==null?void 0:s.feature.geometry)&&t.geometry===((n=e.selectedResult)==null?void 0:n.feature.geometry))return void this._pointerDownUpHandle.pause();const r=C(t.geometry)&&C((o=e.selectedResult)==null?void 0:o.feature.geometry),i=v(t.geometry)&&v((a=e.selectedResult)==null?void 0:a.feature.geometry)&&t.geometry!==e.selectedResult.feature.geometry;if((r||i)&&e.activeMenu==="none"&&e.searchTerm)return e.search(),void this._pointerDownUpHandle.pause();e.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout(()=>{this.destroyed||(this._viewClickHandle.pause(),e.viewModel.state!=="searching"?this._pointerPressedSearchSuggestionStop||(v(t.geometry)&&(t.geometry=null,this._getDirections()),this.scheduleRender()):this._pointerDownUpHandle.pause())},this._autoStopRemovalDelay))}_handleStopInputFocus(e,t){if(this._pointerDownUpHandle.resume(),this.hasHandles(KY))return;const{view:r}=this,i=r.cursor;this.addHandles([{remove(){r.cursor=i}},ie(()=>e.searchTerm,s=>{e.destroyed||(r.cursor=s.length?i:"copy")},pt)],KY),this._activeStop=t}_prepViewClick(){const{view:e}=this.viewModel,t=O3(e,"click",this._handleViewClick.bind(this)),r=O3(e.surface,"click",()=>{clearTimeout(this._autoStopRemovalTimeoutId),r.pause()});return{remove(){r.remove(),t.remove()},pause(){r.pause(),t.pause()},resume(){r.resume(),t.resume()}}}_prepPointerDownUpClick(){const e=O3(document,"pointerdown",r=>{this._pointerPressedSearchSuggestionStop=Sxe(r)?this._activeStop:null}),t=O3(document,"pointerup",r=>{this._pointerDownUpHandle.pause();const i=Sxe(r),s=this._activeStop;i||s!==this._pointerPressedSearchSuggestionStop||this._removeStop(s),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=i?s:null});return{remove(){t.remove(),e.remove()},pause(){t.pause(),e.pause()},resume(){e.resume()}}}_handleViewClick(e){e.stopPropagation();const t=this._stopsToSearches.get(this._activeStop);t&&!t.searchTerm&&(t.search(e.mapPoint).then(r=>{const i=r.results[0].results[0],{feature:s,name:n}=i;this._activeStop.geometry=s.geometry,this._activeStop.name=n,t.searchTerm=n}),this.scheduleRender()),this._viewClickHandle.pause(),clearTimeout(this._autoStopRemovalTimeoutId)}_addNewPlaceholder(){if(this._pointerDownUpHandle.pause(),this._newPlaceholderStop)return;const e=new Km({symbol:new ko});this.viewModel.layer.stops.add(e),this._newPlaceholderStop=e}_handleReverseStops(){this._reverseStops()}_reverseStops(){this.viewModel.layer.stops.reverse();for(const e of this.viewModel.layer.stops)e.sequence=null;this._getDirections()}_handleRemoveStop(e){const t=e.currentTarget["data-stop-index"],r=this.viewModel.layer.stops.getItemAt(t);this._removeStop(r),(v(r.geometry)||C(this.viewModel.layer.routeInfo))&&this._getDirections()}_removeStop(e){this.viewModel.layer.stops.length<=2||(this._disposeSearch(e),this.viewModel.layer.stops.remove(e))}_handleDepartureOptionChange(e){const t=e.currentTarget,r=t.item(t.selectedIndex);r.value===Sc.NOW?(this._departureTime=Sc.NOW,this.viewModel.departureTime=Sc.NOW,this.removeHandles(Exe),this._getDirections()):r.value===Sc.DEPART_BY?(this._departureTime=Sc.DEPART_BY,this.addHandles(ie(()=>[this._datePicker.value,this._timePicker.value],()=>{this._updateDepartureTime(),this._getDirections()},pt),Exe)):(this._departureTime=Sc.UNSPECIFIED,this.viewModel.departureTime=null,this._getDirections())}_updateDepartureTime(){const e=this._datePicker.value,t=this._timePicker.value;e&&t&&(this.viewModel.departureTime=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes()))}_renderTimeControls(){return P("div",{class:Ce.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())}_renderSectionSplitter(){return P("div",{class:Ce.sectionSplitter})}_renderSaveContainer(){const{saveButton:e,saveAsButton:t,printButton:r,layerDetails:i}=this.visibleElements;return e||t||r||i?P("div",{class:Ce.saveSection,key:Ce.saveSection},this._renderSaveButtons(),this._renderRouteLayerDetailsLink()):null}_renderSaveButtons(){const{saveButton:e,saveAsButton:t,printButton:r}=this.visibleElements;return e||t||r?P("div",{class:Ce.saveButtons,key:Ce.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null}_renderSaveButton(){var r;if(!this.visibleElements.saveButton)return null;const e=(r=this.viewModel.layer.portalItem)==null?void 0:r.itemControl,t=v(this.viewModel.layer.routeInfo)&&(e==="admin"||e==="update");return P("calcite-button",{appearance:"outline",class:Ce.saveButton,color:"blue",disabled:!t,"icon-start":"save",key:Ce.saveButton,onclick:()=>{this._handleSaveButtonClick()},text:this.messagesCommon.save,width:"full"},this.messagesCommon.save)}_renderSaveAsButton(){if(!this.visibleElements.saveAsButton)return null;const e=C(this.viewModel.layer.routeInfo);return P("div",{class:Ce.saveAsButtonPopover,key:Ce.saveAsButtonPopover},P("calcite-button",{afterCreate:t=>{this._saveAsButtonNode=t},appearance:"outline",class:Ce.saveAsButton,color:"blue",disabled:e,"icon-start":"duplicate",key:Ce.saveAsButton,onclick:()=>this._handleSaveAsButtonClick(),text:this.messagesCommon.saveAs,width:"full"},this.messagesCommon.saveAs))}_renderSavePopover(){return P("calcite-popover",{label:this._saveLayer.label,open:this._saveLayer.opened,"overlay-positioning":"fixed",referenceElement:this._saveAsButtonNode},this._saveLayer.render())}_handleSaveAsButtonClick(){this._saveLayer.opened?this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)}_renderPrintButton(){return this.visibleElements.printButton?P("calcite-button",{appearance:"outline",class:Ce.printButton,color:"blue","icon-start":"print",key:Ce.printButton,text:this.messagesCommon.print}):null}_renderRouteLayerDetailsLink(){if(!this.visibleElements.layerDetails)return null;const{portalItem:e}=this.viewModel.layer;if(!e)return null;const{id:t,portal:{url:r}}=e,i=`${r}/home/item.html?id=${t}`;return P("calcite-link",{class:Ce.layerDetailsLink,href:i,key:Ce.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)}_handleSaveButtonClick(){this.viewModel.layer.save()}_renderDirectionsContainer(){return P("div",{class:this.classes(Ce.directionsSection,Ce.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())}_renderLoader(){return P("div",{class:Ce.loader,key:"loader"})}_renderWarningCard(){return P("div",{class:Ce.warningCard,role:"alert"},P("div",{class:Ce.warningHeader},P("span",{class:Ce.warningIcon,"aria-hidden":"true"}),P(Sh,{class:Ce.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),P("div",{class:Ce.warningMessage},this._getErrorMessage()))}_renderDirectionsContainerContent(){const{viewModel:{layer:e,state:t}}=this;return t==="error"?this._renderWarningCard():t==="routing"?this._renderLoader():v(e.directionLines)?P("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(Ce.summary,this._saveLayer.opened&&Ce.buttonDisabled),key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):P("div",{key:"esri-directions__placeholder",class:Ce.emptyContent},this._renderPlaceholder(),P(Sh,{class:Ce.message,level:this.headingLevel},this.messages.directionsPlaceholder))}_renderPlaceholder(){return P("svg",{class:Ce.emptyIllustration,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},P("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))}_renderMessage(e){return P(Sh,{level:this.headingLevel},e)}_renderRouteActions(){return P("div",{class:Ce.routeActions},P("button",{"aria-label":this.messages.clearRoute,class:this.classes(Ce.clearRouteButton,Ce.button,Ce.buttonTertiary),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))}_getSections(){const{directionPoints:e,directionLines:t,stops:r}=this.viewModel.layer;if(C(e)||C(t))return null;const i=[];let s=null;for(const n of e){const{objectId:o,stopId:a}=n;if(v(a)){const c=r.find(p=>p.objectId===a),d=i.length===0;(C(s)||s.stop!==c)&&(s={stop:c,directions:[],open:d},i.push(s));continue}if(C(s))continue;const l=t.find(c=>c.directionPointId===o);C(l)||s.directions.push({directionPoint:n,directionLine:l})}return i}_renderManeuverSections(){return C(this._sections)?null:P("div",{class:Ce.maneuvers,role:"group"},this._sections.map((e,t)=>{const{open:r}=e;let i;e.directions.length>0&&r&&(i=P("ol",{class:Ce.maneuverList},e.directions.map(c=>this._renderManeuver(c))));const s=this._sections.length>2,n=t===this._sections.length-1,o={[Ce.collapsibleSection]:s},a={[Ce.openIcon]:!r,[Ce.closeIcon]:r};let l;if(s&&!n){const c=r?this.messagesCommon.close:this.messagesCommon.open;l=P("header",{class:this.classes(Ce.maneuverSectionHeader,Ce.maneuverSectionToggle),key:Ce.maneuverSectionHeader},P("div",{"aria-expanded":r.toString(),"aria-label":c,bind:this,class:Ce.maneuverSectionHeaderButton,"data-maneuver-section":e,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:c},P(Sh,{class:Ce.maneuverSectionTitle,level:this.headingLevel},e.stop.name),P("span",{"aria-hidden":"true",class:this.classes(a)})))}else l=P("header",{class:Ce.maneuverSectionHeader,key:Ce.maneuverSectionHeader},P(Sh,{class:Ce.maneuverSectionTitle,level:this.headingLevel},e.stop.name));return P("section",{class:this.classes(Ce.maneuverSection,o),key:t},l,i)}))}_handleSectionToggle(e){const t=e.currentTarget["data-maneuver-section"];t.open=!t.open}_renderCosts(){const e=this._getCostSummary(),{directionPoints:t}=this.viewModel.layer;if(C(t)||C(e))return null;const r=t.getItemAt(t.length-1).arrivalTime,{distance:i,duration:s}=e,{eta:n,etaTemplate:o,primaryCosts:a,secondaryCosts:l,zoomToRoute:c}=this.messages,d=iE("short-time"),p=v(r)?`<strong>${_s(r,d)}</strong>`:null,f=v(r)?`${ykt(r)}`:null,m=hu(o,{time:p,gmt:f});return P("div",{"aria-label":c,bind:this,class:Ce.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:c},P("div",{class:Ce.costsDetails,role:"group"},P("div",{class:Ce.primaryCosts,title:a},s),P("div",{class:Ce.verticalSplitter}),P("div",{class:Ce.secondaryCosts,title:l},i)),P("div",{innerHTML:m,title:n}))}_handleSummaryInteraction(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()}_getErrorMessage(){const{messages:e,viewModel:{lastError:t}}=this;if(v(t))switch(t.name){case"directions-view-model:unable-to-route":return e.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return e.errors.unableToLoadServiceMetadata}return e.errors.unknownError}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){e.viewModel.defaultSources.forEach(t=>{t.autoNavigate=!1})}_applyLocatorSourceOverrides({allSources:e}){var t;for(const r of e)"url"in r&&r.url&&((t=r.locationType)!=null||(r.locationType="street"),bie(r.url)&&this.apiKey&&r.apiKey==null&&(r.apiKey=this.apiKey,r.url=l6e))}_acquireSearch(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const i=this._stopsToSearches.get(e);return i.view=t,this._overrideDefaultSources(i),i}const r=new _5t({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(r),this.addHandles([ms(()=>r.allSources,"change",()=>this._normalizeSearchSources(r)),r.on("select-result",()=>{e.geometry=r.selectedResult.feature.geometry,e.name=r.selectedResult.name,this._getDirections()}),r.on("search-focus",()=>this._handleStopInputFocus(r,e)),r.on("search-blur",()=>this._handleStopInputBlur(r,e)),r.on("search-clear",()=>{e.geometry=null,e.name=null,this._activeStop=e,this.viewModel.layer.removeResult()}),ie(()=>r.searchTerm,i=>{e.name=i})],r),this._stopsToSearches.set(e,r),r}_disposeSearch(e){if(this._stopsToSearches.has(e)){const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)}}_renderManeuver(e){const{directionPoint:t,directionLine:r}=e,{distance:i,duration:s}=r,{messages:n,messagesUnits:o,unit:a}=this,l=_xe(o,WS(i,0),a),c=vxe(WS(s,0)),d=l&&c?`${l}&nbsp;&middot;&nbsp;${c}`:`${l}${c}`,p=this._getFormattedManeuverText(t),{objectId:f,directionPointType:m}=t,g=fkt(m),_=`esri-directions__maneuver-${f}`,x=`esri-directions__intermediate-costs-${f}`,b={[Ce.maneuverActive]:this._activeManeuver===r};return P("li",{"aria-labelledby":`${_} ${x}`,bind:this,class:this.classes(Ce.maneuver,b),"data-maneuver":r,key:r,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},v(g)&&P("img",{alt:"",class:Ce.maneuverIcon,src:g}),P("div",{class:Ce.maneuverCostsContainer},P("span",{id:_,innerHTML:WS(p,"")}),P("div",{class:Ce.maneuverCosts},P("div",{class:Ce.horizontalSplitter}),P("div",{"aria-hidden":"true",id:x,class:Ce.intermediateCost,innerHTML:d,title:n.intermediateCosts}))))}_handleManeuverClick(e){const t=e.currentTarget["data-maneuver"];if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t;const{geometry:r}=t;this.viewModel.centerAt(r),this.viewModel.highlight(t)}_handleManeuverMouseOver(e){if(this._activeManeuver||this._focusedManeuver)return;const t=e.currentTarget["data-maneuver"];this.viewModel.highlight(t)}_handleManeuverMouseOut(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()}_handleManeuverBlur(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())}_handleManeuverFocus(e){if(this._activeManeuver)return;const t=e.currentTarget["data-maneuver"];this._focusedManeuver=t,this.viewModel.highlight(t)}_getFormattedManeuverText(e){const{displayText:t,name:r,intersectingName:i}=e;if(C(t))return"";let s=t;return v(r)&&s.includes(r)&&(s=s.replace(r,`<strong>${r}</strong>`)),v(i)&&s.includes(i)&&(s=s.replace(i,`<strong>${i}</strong>`)),s}_getCostSummary(){const{messagesUnits:e,unit:t,viewModel:r}=this,{routeInfo:i}=r.layer;if(C(i))return null;const s=WS(i.totalDistance,0),n=WS(i.totalDuration,0);return{distance:_xe(e,s,t),duration:vxe(n)}}async _getDirections(){if(!(this.viewModel.layer.stops.filter(e=>v(e.geometry)).length<2))try{await this.viewModel.getDirections()}catch{}}};u([h()],as.prototype,"apiKey",null),u([h(c4t)],as.prototype,"defaultUnit",void 0),u([h()],as.prototype,"goToOverride",null),u([h()],as.prototype,"headingLevel",void 0),u([h()],as.prototype,"iconClass",void 0),u([h()],as.prototype,"label",null),u([h({readOnly:!0})],as.prototype,"lastRoute",null),u([h()],as.prototype,"layer",null),u([h()],as.prototype,"maxStops",null),u([h(),xi("esri/widgets/Directions/t9n/Directions")],as.prototype,"messages",void 0),u([h(),xi("esri/t9n/common")],as.prototype,"messagesCommon",void 0),u([h(),xi("esri/core/t9n/Units")],as.prototype,"messagesUnits",void 0),u([h()],as.prototype,"routeServiceUrl",null),u([h()],as.prototype,"routeSymbol",null),u([h()],as.prototype,"searchProperties",void 0),u([h()],as.prototype,"stopSymbols",null),u([h()],as.prototype,"unit",null),u([h()],as.prototype,"view",null),u([h({type:T6e})],as.prototype,"viewModel",void 0),u([h()],as.prototype,"visibleElements",void 0),u([Gt("visibleElements")],as.prototype,"castVisibleElements",null),u([An()],as.prototype,"_handleStopIconClick",null),u([An()],as.prototype,"_handleClearRouteClick",null),u([An()],as.prototype,"_handleReverseStops",null),u([An()],as.prototype,"_handleRemoveStop",null),u([An()],as.prototype,"_handleSectionToggle",null),u([An()],as.prototype,"_handleSummaryInteraction",null),u([An()],as.prototype,"_handleManeuverClick",null),as=u([I(C6e)],as);const vkt=as;async function bkt(){const e="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/findAddressCandidates",t={f:"json",category:"Bar or Pub,Restaurant, Winery",location:[10.70083053,59.922662976],outFields:["Place_addr","PlaceName"],maxLocations:350},r=[];for(const o in t){const a=encodeURIComponent(o)+"="+encodeURIComponent(t[o]);r.push(a)}const i=`${e}?${r.join("&")}`,s=await fetch(i),{candidates:n}=await s.json();return n}var A6e={exports:{}},iH={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wkt=I2.exports,xkt=Symbol.for("react.element"),Tkt=Symbol.for("react.fragment"),Skt=Object.prototype.hasOwnProperty,Ekt=wkt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ckt={key:!0,ref:!0,__self:!0,__source:!0};function O6e(e,t,r){var i,s={},n=null,o=null;r!==void 0&&(n=""+r),t.key!==void 0&&(n=""+t.key),t.ref!==void 0&&(o=t.ref);for(i in t)Skt.call(t,i)&&!Ckt.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)s[i]===void 0&&(s[i]=t[i]);return{$$typeof:xkt,type:e,key:n,ref:o,props:s,_owner:Ekt.current}}iH.Fragment=Tkt;iH.jsx=O6e;iH.jsxs=O6e;(function(e){e.exports=iH})(A6e);const $ie=A6e.exports.jsx;Gr.apiKey="AAPKfc0209af11d3434bbf0799554f377d1dACO76XRtjlavzo6uvi6tHkQ6lGLr_cixp79m4dHK00DGYykDGt2L19cTUeSICw4K";function Akt(){const e=I2.exports.useRef(null),t=new Iue;return I2.exports.useEffect(()=>{if(e.current){const r=new WAe({basemap:"topo-vector",ground:"world-elevation",layers:[t]}),i=new Dke({container:e.current,map:r,zoom:3,camera:{position:[10.750764,59.915925,70],tilt:81}}),s=new KPe({portalItem:{id:"ca0470dbbddb4db28bad74ed39949e25"},popupEnabled:!1});r.add(s);const n=new rq({view:i,content:new HLt({view:i}),group:"top-right",expanded:!1}),o=new rq({view:i,content:new l4t({view:i}),group:"bottom-right",expanded:!0});i.ui.add([n,o],"bottom-right");const a=new rq({view:i,content:new vkt({view:i,layer:t}),group:"top-right",expanded:!1});i.ui.add(a,{position:"top-right"});const l={type:"picture-marker",url:"https://static.arcgis.com/images/Symbols/Shapes/BluePin1LargeB.png",width:46,height:46,yoffset:23};bkt().then(c=>{c.forEach(d=>{const{attributes:p,location:f,extent:m}=d,g=new _i({attributes:p,geometry:{type:"point",...f},symbol:l,popupTemplate:{title:"{PlaceName}",content:"{Place_addr}"}});i.graphics.add(g),i.extent=m})})}},[]),I2.exports.useEffect(()=>{},[]),$ie("div",{className:"mapDiv",ref:e})}QY.createRoot(document.getElementById("root")).render($ie(H6e.StrictMode,{children:$ie(Akt,{})}));export{Hv as $,rct as A,Kkt as B,fat as C,D3e as D,Eee as E,nct as F,Sr as G,oUt as H,gN as I,bd as J,cee as K,Wa as L,Mu as M,AI as N,U5 as O,u as P,h as Q,I as R,Wkt as S,be as T,lr as U,Rm as V,pe as W,oct as X,vze as Y,gr as Z,re as _,L7e as a,fj as a$,Bse as a0,GQe as a1,Mkt as a2,bg as a3,tRe as a4,Vl as a5,Ve as a6,ql as a7,Qtt as a8,ert as a9,Ft as aA,eC as aB,Qe as aC,ype as aD,gR as aE,aL as aF,qR as aG,xKe as aH,Ps as aI,ie as aJ,bi as aK,z8t as aL,V8t as aM,fE as aN,B1t as aO,Kv as aP,Qi as aQ,cg as aR,D8t as aS,G8t as aT,KJe as aU,gP as aV,M6t as aW,pj as aX,R6t as aY,XF as aZ,I6t as a_,trt as aa,sct as ab,ict as ac,te as ad,BQ as ae,aoe as af,yzt as ag,tze as ah,Gz as ai,zo as aj,pE as ak,oo as al,aC as am,vzt as an,_zt as ao,E5t as ap,LUt as aq,a0 as ar,hr as as,pt as at,kl as au,L0 as av,Ze as aw,Lw as ax,sC as ay,nC as az,wGe as b,Xv as b$,qF as b0,tIe as b1,dZe as b2,O6t as b3,$s as b4,I8t as b5,Sit as b6,Eu as b7,S0 as b8,UCt as b9,k8t as bA,F8t as bB,no as bC,ms as bD,FI as bE,Ot as bF,Gs as bG,AFe as bH,wo as bI,Gkt as bJ,gx as bK,Ks as bL,Gm as bM,vx as bN,ue as bO,So as bP,ye as bQ,de as bR,lt as bS,Eh as bT,O5 as bU,R8t as bV,ml as bW,xme as bX,E8t as bY,$bt as bZ,hj as b_,Ibt as ba,Jh as bb,Ir as bc,Ise as bd,r6t as be,Of as bf,qa as bg,_E as bh,GKe as bi,yt as bj,es as bk,_oe as bl,le as bm,x0 as bn,kd as bo,$ as bp,ao as bq,Jv as br,SN as bs,Qt as bt,B8t as bu,U8t as bv,Dh as bw,Ua as bx,ezt as by,Mce as bz,rUt as c,JSe as c$,oC as c0,BCt as c1,pce as c2,b0 as c3,ZF as c4,To as c5,JE as c6,tr as c7,n5e as c8,i6t as c9,eUt as cA,uUt as cB,tUt as cC,aUt as cD,iUt as cE,vUt as cF,mIe as cG,S5t as cH,w6t as cI,rMt as cJ,OIe as cK,cC as cL,s8t as cM,xOe as cN,Fc as cO,zh as cP,cdt as cQ,CI as cR,ja as cS,xi as cT,Ss as cU,P as cV,hu as cW,af as cX,Oz as cY,fe as cZ,pn as c_,Yi as ca,Bj as cb,t8t as cc,qv as cd,TOe as ce,ox as cf,Jpe as cg,SOe as ch,iAt as ci,Kr as cj,Dkt as ck,WZ as cl,WSe as cm,ui as cn,V as co,Ee as cp,jt as cq,rs as cr,Wm as cs,fn as ct,ot as cu,Gi as cv,KV as cw,Ye as cx,m3e as cy,ww as cz,UKe as d,j as d$,_x as d0,jl as d1,Bo as d2,XL as d3,EM as d4,iEe as d5,Xkt as d6,mx as d7,WL as d8,B9e as d9,hi as dA,oi as dB,ks as dC,ka as dD,It as dE,Us as dF,hI as dG,r8t as dH,DK as dI,QE as dJ,IAt as dK,Qr as dL,Dd as dM,wu as dN,ai as dO,OPe as dP,S as dQ,Rn as dR,rp as dS,Rt as dT,De as dU,kV as dV,k0 as dW,Ct as dX,ei as dY,Pf as dZ,Ae as d_,Gr as da,tg as db,V9 as dc,ZE as dd,Rh as de,LH as df,Jkt as dg,kKe as dh,Zkt as di,yze as dj,Udt as dk,o8t as dl,tMt as dm,azt as dn,Xce as dp,$0 as dq,G9 as dr,Ph as ds,pg as dt,u8t as du,HF as dv,mn as dw,M as dx,N2 as dy,tj as dz,C as e,MOe as e$,Xi as e0,li as e1,ti as e2,Yr as e3,Ht as e4,v1 as e5,l7 as e6,rT as e7,$u as e8,F7 as e9,kkt as eA,ZZ as eB,aR as eC,Ou as eD,$Xe as eE,me as eF,bs as eG,S6t as eH,Sfe as eI,pIe as eJ,KKe as eK,gIe as eL,lQe as eM,ZPe as eN,QS as eO,Mp as eP,_$ as eQ,b$ as eR,cRe as eS,XMe as eT,Tj as eU,Nc as eV,Ue as eW,fIe as eX,cj as eY,Qpe as eZ,Uh as e_,cr as ea,M0 as eb,Vx as ec,iT as ed,B7 as ee,aa as ef,z0 as eg,k7 as eh,P7 as ei,tG as ej,Kwt as ek,mle as el,GI as em,oPe as en,Gn as eo,vj as ep,iot as eq,coe as er,CYe as es,Aot as et,Oot as eu,WYe as ev,uot as ew,utt as ex,pte as ey,lg as ez,fUt as f,tN as f$,Td as f0,b1 as f1,f5e as f2,Rse as f3,cR as f4,met as f5,je as f6,$e as f7,zs as f8,Jmt as f9,Tf as fA,Au as fB,z6t as fC,ar as fD,Mn as fE,uBt as fF,cot as fG,B6t as fH,rot as fI,w2 as fJ,xBt as fK,Oi as fL,RI as fM,wBt as fN,dr as fO,EMe as fP,CMe as fQ,L8t as fR,bBt as fS,hBt as fT,nP as fU,ge as fV,dBt as fW,Roe as fX,Yz as fY,wOe as fZ,dq as f_,SBt as fa,aBt as fb,EBt as fc,Ile as fd,kR as fe,Mae as ff,vBt as fg,mBt as fh,gBt as fi,fBt as fj,XJ as fk,qi as fl,wNe as fm,jd as fn,QIt as fo,y3e as fp,pBt as fq,Zst as fr,TBt as fs,Jst as ft,k6t as fu,zme as fv,JM as fw,U2 as fx,Hs as fy,det as fz,_i as g,XRe as g$,oE as g0,_e as g1,Pr as g2,Lr as g3,Noe as g4,Ie as g5,ABt as g6,CBt as g7,a8t as g8,dg as g9,dot as gA,Ome as gB,cBt as gC,Zpe as gD,i8t as gE,kAt as gF,SKe as gG,ize as gH,$Ut as gI,Yh as gJ,mPe as gK,gPe as gL,uit as gM,Le as gN,Ait as gO,Pse as gP,$Pe as gQ,F1t as gR,O8t as gS,KUt as gT,Fkt as gU,lzt as gV,YUt as gW,aj as gX,att as gY,M8t as gZ,Ms as g_,Mi as ga,czt as gb,Xst as gc,DUt as gd,G6t as ge,Use as gf,zkt as gg,WN as gh,rN as gi,op as gj,N8t as gk,rLe as gl,jm as gm,Y1t as gn,vot as go,bot as gp,oBt as gq,Gw as gr,vnt as gs,jo as gt,Ni as gu,Te as gv,Rc as gw,T0 as gx,wdt as gy,Wy as gz,qEe as h,VO as h$,oAe as h0,VF as h1,Bkt as h2,pJe as h3,NUt as h4,nx as h5,$f as h6,Dxt as h7,qh as h8,Ut as h9,H6t as hA,Ga as hB,g3e as hC,p6t as hD,ij as hE,jBt as hF,Rkt as hG,fa as hH,Pce as hI,Bl as hJ,bo as hK,kBt as hL,VHe as hM,YHe as hN,D2 as hO,W3e as hP,aAe as hQ,Lne as hR,SUt as hS,Ll as hT,Doe as hU,tKe as hV,CR as hW,xct as hX,RUt as hY,np as hZ,y6t as h_,Zi as ha,Py as hb,Qs as hc,si as hd,xt as he,ps as hf,Zl as hg,qe as hh,Nt as hi,at as hj,dt as hk,Di as hl,tt as hm,ds as hn,da as ho,E0 as hp,Ds as hq,uY as hr,mr as hs,uV as ht,tT as hu,$7 as hv,b8t as hw,rt as hx,Tt as hy,yPe as hz,pne as i,sx as i$,xD as i0,wme as i1,rlt as i2,ZBt as i3,vge as i4,KBt as i5,PUt as i6,jne as i7,FCe as i8,IJ as i9,qYe as iA,JNe as iB,Pi as iC,g6 as iD,zd as iE,lJe as iF,cJe as iG,t1 as iH,y4 as iI,JBt as iJ,UAe as iK,hE as iL,xre as iM,$Bt as iN,uQe as iO,Yx as iP,rE as iQ,ppe as iR,e7 as iS,Ox as iT,V2 as iU,ko as iV,Hse as iW,Jr as iX,F6t as iY,Lkt as iZ,cx as i_,VBt as ia,G3e as ib,q3e as ic,V3e as id,$_e as ie,kbt as ig,VUt as ih,x8t as ii,sAe as ij,tqe as ik,OUt as il,Aj as im,NI as io,k3e as ip,A8t as iq,dtt as ir,E6t as is,zUt as it,FUt as iu,UUt as iv,kUt as iw,BUt as ix,oN as iy,jh as iz,Ge as j,lBt as j$,rk as j0,Vne as j1,zne as j2,I3e as j3,AUt as j4,T2 as j5,rBt as j6,iBt as j7,e6t as j8,AZe as j9,ni as jA,Q8t as jB,yBt as jC,_Bt as jD,xRe as jE,d$ as jF,UPe as jG,Qz as jH,Q4 as jI,j6t as jJ,Mme as jK,V6t as jL,Br as jM,IM as jN,mJe as jO,nN as jP,oD as jQ,aD as jR,hM as jS,pM as jT,fM as jU,t6 as jV,Km as jW,B9 as jX,zv as jY,aae as jZ,pot as j_,MS as ja,tBt as jb,zV as jc,s6t as jd,w8t as je,aNe as jf,Rj as jg,xs as jh,RN as ji,Hh as jj,RJ as jk,OE as jl,f7 as jm,Vd as jn,_1 as jo,Ha as jp,mt as jq,di as jr,Fl as js,COe as jt,sBt as ju,nBt as jv,yoe as jw,mnt as jx,Cf as jy,Ur as jz,$Re as k,ma as k$,FHe as k0,qPe as k1,Fe as k2,qSe as k3,yx as k4,GMt as k5,fLt as k6,Hee as k7,Tn as k8,Gee as k9,ro as kA,KN as kB,GXe as kC,K6t as kD,Mit as kE,Rit as kF,xe as kG,At as kH,cI as kI,wE as kJ,S6e as kK,Ed as kL,U6t as kM,Y6t as kN,ckt as kO,Z6t as kP,TE as kQ,$J as kR,uft as kS,zye as kT,Zt as kU,Zy as kV,dMe as kW,vJe as kX,RM as kY,Tit as kZ,Tr as k_,Wee as ka,Xz as kb,xit as kc,z2 as kd,IRe as ke,YZ as kf,By as kg,izt as kh,ozt as ki,f4e as kj,V1e as kk,rzt as kl,szt as km,tzt as kn,IB as ko,gL as kp,oB as kq,qB as kr,Rf as ks,bUt as kt,Ef as ku,xce as kv,Jp as kw,B1e as kx,gOt as ky,yOt as kz,Ose as l,hg as l$,pi as l0,Rs as l1,Ho as l2,QL as l3,g6e as l4,mzt as l5,q8t as l6,gzt as l7,w5t as l8,B2e as l9,pu as lA,wx as lB,K9 as lC,$Ce as lD,Bv as lE,Pm as lF,ole as lG,iht as lH,go as lI,G$e as lJ,wd as lK,n1 as lL,Aae as lM,BR as lN,Hi as lO,GD as lP,Wj as lQ,zPe as lR,eBt as lS,Q6t as lT,cht as lU,hht as lV,r4 as lW,DBt as lX,LBt as lY,NBt as lZ,FBt as l_,wUt as la,zn as lb,Yw as lc,c6t as ld,l6t as le,gMe as lf,fMe as lg,rne as lh,c4t as li,jn as lj,w1 as lk,Ic as ll,xAt as lm,oM as ln,H8t as lo,Rre as lp,D6t as lq,N6t as lr,L6t as ls,Gy as lt,AN as lu,ul as lv,dO as lw,xPe as lx,q$e as ly,$n as lz,bge as m,Ts as m$,Vs as m0,ale as m1,hOe as m2,Xe as m3,ws as m4,J6t as m5,Rnt as m6,u6t as m7,a6t as m8,o6t as m9,fht as mA,w$ as mB,Em as mC,OM as mD,OJ as mE,lR as mF,wM as mG,Fse as mH,n8t as mI,F9 as mJ,tSt as mK,bwt as mL,UE as mM,u0 as mN,Li as mO,Vse as mP,P8t as mQ,Vy as mR,aLe as mS,dC as mT,Rae as mU,qUt as mV,PBt as mW,JUt as mX,N0 as mY,dae as mZ,DIe as m_,Kh as ma,Pc as mb,p2 as mc,j1t as md,Cne as me,$Je as mf,rye as mg,h8t as mh,tye as mi,Ine as mj,_u as mk,fg as ml,Oj as mm,_wt as mn,Lc as mo,T7 as mp,xg as mq,ca as mr,B2 as ms,Hgt as mt,v8t as mu,y8t as mv,_8t as mw,IBt as mx,iFe as my,c8t as mz,j9 as n,u1 as n$,_g as n0,nI as n1,er as n2,hl as n3,U7 as n4,D7 as n5,Et as n6,Ii as n7,t6t as n8,Cae as n9,Yte as nA,cce as nB,lkt as nC,xUt as nD,K8e as nE,X6t as nF,YG as nG,eV as nH,lLt as nI,hzt as nJ,fzt as nK,pzt as nL,J9 as nM,ZUt as nN,YT as nO,eye as nP,my as nQ,ki as nR,bN as nS,Iae as nT,DR as nU,WUt as nV,Syt as nW,Pae as nX,NRe as nY,$R as nZ,RPe as n_,Pn as na,Pve as nb,i1e as nc,EN as nd,xI as ne,Gt as nf,Xp as ng,tpe as nh,XUt as ni,q6t as nj,Um as nk,tp as nl,iG as nm,Pu as nn,Yl as no,kh as np,qo as nq,gNe as nr,MBt as ns,tvt as nt,ep as nu,Pot as nv,yg as nw,CNe as nx,aI as ny,dR as nz,T6t as o,pet as o$,Vot as o0,Zv as o1,Zj as o2,Mst as o3,W6t as o4,p8t as o5,jye as o6,d8t as o7,hC as o8,oet as o9,v6t as oA,J8t as oB,zSt as oC,I9e as oD,MKe as oE,_6t as oF,d6t as oG,OR as oH,LD as oI,KK as oJ,b6t as oK,RHe as oL,T8t as oM,m6t as oN,mKe as oO,DYe as oP,xPt as oQ,TPt as oR,mPt as oS,dzt as oT,o9 as oU,uzt as oV,EPt as oW,u4 as oX,Jz as oY,s0e as oZ,g8t as o_,yUt as oa,pUt as ob,mUt as oc,cUt as od,dUt as oe,lUt as of,gUt as og,nUt as oh,nRe as oi,Uoe as oj,Boe as ok,wj as ol,jOt as om,lC as on,dRe as oo,Nkt as op,rKe as oq,jkt as or,Kt as os,fl as ot,Xx as ou,HCe as ov,fEe as ow,Nw as ox,OKe as oy,iC as oz,sUt as p,Ki as p$,qn as p0,Qh as p1,_4 as p2,jRe as p3,Hn as p4,fG as p5,VRe as p6,wg as p7,FR as p8,Y8t as p9,tct as pA,wKe as pB,gYe as pC,klt as pD,QBt as pE,Ylt as pF,fge as pG,U3e as pH,YBt as pI,IQe as pJ,g6t as pK,aee as pL,tW as pM,rW as pN,Wp as pO,Ikt as pP,Pkt as pQ,Ch as pR,UBt as pS,$kt as pT,yd as pU,qBt as pV,t7 as pW,KIe as pX,fi as pY,Yv as pZ,Vh as p_,zx as pa,W8t as pb,Z8t as pc,X8t as pd,_St as pe,xSt as pf,vSt as pg,bSt as ph,wSt as pi,BBt as pj,XBt as pk,WBt as pl,dIe as pm,kse as pn,JQe as po,X3e as pp,HBt as pq,GBt as pr,TYe as ps,GUt as pt,HUt as pu,jUt as pv,CHe as pw,C8t as px,S8t as py,Su as pz,hUt as q,Wxt as q$,kw as q0,bnt as q1,Xm as q2,RBt as q3,Ant as q4,Okt as q5,C9e as q6,cne as q7,J8e as q8,nzt as q9,IPt as qA,oke as qB,$Pt as qC,ake as qD,LPt as qE,lke as qF,FPt as qG,w5 as qH,pq as qI,$Ze as qJ,_De as qK,Spt as qL,xbt as qM,Vkt as qN,qO,qCe as qP,kne as qQ,rqe as qR,EUt as qS,Fne as qT,CUt as qU,MUt as qV,xf as qW,dTt as qX,jF as qY,R0 as qZ,Vxt as q_,fd as qa,z1e as qb,A5e as qc,uRt as qd,KD as qe,Mht as qf,fpt as qg,yDe as qh,gDe as qi,wpt as qj,ble as qk,Gpt as ql,ODe as qm,xle as qn,Ypt as qo,wft as qp,Uft as qq,Yvt as qr,UV as qs,ace as qt,dvt as qu,qE as qv,FRt as qw,oPt as qx,lue as qy,nke as qz,v as r,Pz as r$,vxt as r0,Txt as r1,PMt as r2,IMt as r3,EG as r4,$Mt as r5,jV as r6,wwt as r7,f3t as r8,uke as r9,Frt as rA,pOe as rB,oQe as rC,ZMe as rD,zAe as rE,IR as rF,oit as rG,C6t as rH,pRe as rI,dj as rJ,Sx as rK,Fi as rL,wit as rM,hYe as rN,dYe as rO,aYe as rP,jpe as rQ,Gl as rR,fRe as rS,hRe as rT,Ul as rU,gE as rV,Mrt as rW,stt as rX,Crt as rY,htt as rZ,Urt as r_,y3t as ra,dke as rb,v3t as rc,hke as rd,$3t as re,zG as rf,z3t as rg,K3t as rh,e$t as ri,r$t as rj,Xwt as rk,L3t as rl,b$t as rm,QTt as rn,SSt as ro,BEt as rp,cCt as rq,iCt as rr,ane as rs,ySt as rt,gp as ru,m8t as rv,f8t as rw,j8t as rx,Qoe as ry,Ej as rz,z as s,Rtt as s$,XAe as s0,Sj as s1,e4 as s2,jz as s3,cB as s4,bj as s5,uRe as s6,nae as s7,hIe as s8,_j as s9,QRe as sA,iz as sB,NK as sC,x5t as sD,m$e as sE,y0 as sF,g0 as sG,cOe as sH,hN as sI,RR as sJ,YKe as sK,XKe as sL,Wx as sM,gj as sN,joe as sO,TQe as sP,l1 as sQ,Utt as sR,lRe as sS,eRe as sT,Stt as sU,Ett as sV,Ctt as sW,Ntt as sX,Att as sY,Ott as sZ,Mtt as s_,eW as sa,fVe as sb,Hrt as sc,II as sd,Aoe as se,cMe as sf,glt as sg,HJe as sh,ylt as si,AMe as sj,$Me as sk,Bz as sl,Hkt as sm,nMe as sn,kD as so,rRe as sp,IUt as sq,ts as sr,Ukt as ss,mE as st,QUt as su,mv as sv,jE as sw,qse as sx,XA as sy,P6t as sz,_Ut as t,ga as t$,Itt as t0,Ptt as t1,$tt as t2,Dtt as t3,Ltt as t4,uze as t5,Rd as t6,rg as t7,YL as t8,qkt as t9,LS as tA,tle as tB,ele as tC,e8t as tD,rle as tE,irt as tF,srt as tG,nrt as tH,Ast as tI,cst as tJ,ast as tK,Xy as tL,E4e as tM,yst as tN,Ykt as tO,k4e as tP,B4e as tQ,c2 as tR,hL as tS,TUt as tT,Tce as tU,ZSt as tV,$4e as tW,GSt as tX,F4e as tY,L4e as tZ,YSt as t_,Qkt as ta,FOe as tb,jGe as tc,Y9 as td,jj as te,gz as tf,Z9 as tg,WKe as th,x6t as ti,KVe as tj,Qde as tk,U as tl,n6t as tm,i3e as tn,kot as to,Al as tp,oV as tq,xdt as tr,R$t as ts,aIe as tt,bC as tu,f6t as tv,i$e as tw,vut as tx,o$e as ty,fut as tz,Tct as u,$re as u0,Go as u1,N4e as u2,Dx as u3,HSt as u4,$x as u5,wre as u6,PE as u7,Fbt as u8,x2t as u9,w2t as ua,b2t as ub,Af as uc,l8t as ud,oA as ue,vEe as uf,$oe as ug,h6t as uh,A6t as ui,$6t as uj,OBt as uk,zBt as ul,$8t as um,K8t as un,bzt as uo,Gae as v,gd as w,eT as x,ne as y,pf as z};
