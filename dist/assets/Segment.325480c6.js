import{lW as pt,lc as ut,lX as xt,lY as _t,lZ as mt,l_ as ft,bS as yt,l$ as gt,bp as _,m0 as F,bm as st,lt as ot,lu as H,lv as R,P as a,Q as l,R as rt,T as nt,aw as I,as as vt,r as bt,lF as w,hs as U,lK as M,m1 as j,lG as St,aJ as wt,bQ as V,m2 as Z,lz as at,fV as $,kG as Y,m3 as Ct,bR as $t,m4 as J,gx as Rt,b$ as Pt,bP as P,m5 as Tt,m6 as kt}from"./index.347f2ee6.js";import{t as It}from"./LineVisualElement.cecc7fde.js";import{h as z}from"./elevationInfoUtils.85d694b1.js";function Gt(i,t,e,s=2,r="abbr"){return pt(i,ut(t,e).value,e,s,r)}function Ut(i,t,e=2,s="abbr"){return xt(i,t.value,t.unit,e,s)}function Jt(i,t,e=2,s="abbr"){return _t(i,t.value,t.unit,e,s)}function Nt(i,t,e=2,s="abbr"){return mt(i,t.value,t.unit,e,s)}function Qt(i,t,e=2,s="abbr"){return ft(i,t.value,t.unit,e,s)}function zt(i,t,e,s){e.projectToRenderScreen(i,Q),e.projectToRenderScreen(t,W),ot(s,W,Q),H(s,s)}function N(i,t,e,s,r=_()){const o=t.toXYZ(i);return o[2]=z(s,o,t.spatialReference,e)||0,s.renderCoordsHelper.toRenderCoords(o,t.spatialReference,r),r}function Mt(i,t,e,s,r=_()){const o=st(L,i);return o[2]=z(s,o,t,e)||0,s.renderCoordsHelper.toRenderCoords(o,t,r),r}function Wt(i,t,e,s){return jt(t.toXYZ(i),t.spatialReference,e,s)}function jt(i,t,e,s){return s.type==="2d"?(T.x=i[0],T.y=i[1],T.spatialReference=t,s.toScreen(T)):(Mt(i,t,e,s,L),s.state.camera.projectToScreen(L,A),gt(A[0],A[1]))}function qt(i,t,e,s,r,o,d){if(s.mode==="absolute-height")return N(i,e,s,r,o),void N(t,e,s,r,d);const c=e.toXYZ(i),h=e.toXYZ(t),p=z(r,c,e.spatialReference,s),y=z(r,h,e.spatialReference,s),S=(p==null?y:y==null?p:Math.min(p,y))||0;c[2]=S,h[2]=S,r.renderCoordsHelper.toRenderCoords(c,e.spatialReference,o),r.renderCoordsHelper.toRenderCoords(h,e.spatialReference,d)}const T=new yt,L=_(),Q=R(),W=R(),A=F();let At=i=>({vnodeSelector:"",properties:void 0,children:void 0,text:i.toString(),domNode:null}),ht=(i,t,e)=>{for(let s=0,r=t.length;s<r;s++){let o=t[s];Array.isArray(o)?ht(i,o,e):o!=null&&o!==!1&&(typeof o=="string"&&(o=At(o)),e.push(o))}};function k(i,t,e){if(Array.isArray(t))e=t,t=void 0;else if(t&&(typeof t=="string"||t.hasOwnProperty("vnodeSelector"))||e&&(typeof e=="string"||e.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let s,r;return e&&e.length===1&&typeof e[0]=="string"?s=e[0]:e&&(r=[],ht(i,e,r),r.length===0&&(r=void 0)),{vnodeSelector:i,properties:t,children:r,text:s===""?void 0:s,domNode:null}}let m=class extends nt{constructor(i){super(i),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=1,this.color=[0,0,0,.5],this.visible=!0}get startPosition(){return[this.startX,this.startY]}set startPosition(i){this._set("startX",i[0]),this._set("startY",i[1])}get endPosition(){return[this.endX,this.endY]}set endPosition(i){this._set("endX",i[0]),this._set("endY",i[1])}get _strokeStyle(){const i=this.color;return`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${i[3]})`}get _lineCap(){return"round"}render(){const{height:i,left:t,top:e,width:s,x1:r,x2:o,y1:d,y2:c}=this._calculateCoordinates(q),h=`stroke: ${this._strokeStyle}; stroke-width: ${this.width}; stroke-linecap: ${this._lineCap};`;return k("div",{classes:{"esri-line-overlay-item":!0},styles:{left:t+"px",top:e+"px",width:s+"px",height:i+"px",visibility:this.visible?"visible":"hidden"}},[k("svg",{width:s,height:i},[k("line",{x1:r,y1:d,x2:o,y2:c,style:h})])])}renderCanvas(i){if(!this.visible)return;i.strokeStyle=this._strokeStyle,i.lineWidth=this.width,i.lineCap=this._lineCap;const t=this._calculateCoordinates(q);i.beginPath(),i.moveTo(t.left+t.x1,t.top+t.y1),i.lineTo(t.left+t.x2,t.top+t.y2),i.stroke()}_calculateCoordinates(i){const t=Math.min(this.startX,this.endX),e=Math.max(this.startX,this.endX),s=Math.min(this.startY,this.endY),r=Math.max(this.startY,this.endY),o=this.width;return i.left=t-o,i.top=s-o,i.width=e-t+2*o,i.height=Math.max(20,r-s+2*o),i.x1=this.startX-t+o,i.y1=this.startY-s+o,i.x2=this.endX-t+o,i.y2=this.endY-s+o,i}};a([l()],m.prototype,"startX",void 0),a([l()],m.prototype,"startY",void 0),a([l()],m.prototype,"endX",void 0),a([l()],m.prototype,"endY",void 0),a([l()],m.prototype,"startPosition",null),a([l()],m.prototype,"endPosition",null),a([l()],m.prototype,"width",void 0),a([l()],m.prototype,"color",void 0),a([l()],m.prototype,"visible",void 0),a([l({readOnly:!0})],m.prototype,"_strokeStyle",null),m=a([rt("esri.views.overlay.LineOverlayItem")],m);const q={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0},Xt=m,D={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let x=class extends nt{constructor(i){super(i),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor=new I([0,0,0,.6]),this.textColor=new I([255,255,255]),this._textShadowSize=1}get position(){return[this.x,this.y]}set position(i){this._set("x",i[0]),this._set("y",i[1])}get _textShadowColor(){return this.backgroundColor}get _textShadow(){const i=this._textShadowColor.toCss(!1);return`0 0 ${this._textShadowSize}px ${i}`}get _padding(){return .5*this.fontSize}get _borderRadius(){return this._padding}render(){return k("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(i){if(!this.visible)return;const t=i.font.replace(/^(.*?)px/,"");i.font=`${this.fontSize}px ${t}`;const e=this._padding,s=this._borderRadius,r=i.measureText(this.text).width,o=this.fontSize,d=Yt[this.anchor];i.textAlign="center",i.textBaseline="middle";const c=r+2*e,h=o+2*e,p=this.x+d.x*c,y=this.y+d.y*h;this._roundedRect(i,p,y,c,h,s),i.fillStyle=this.backgroundColor.toCss(!0),i.fill();const S=this.x+(d.x+.5)*c,G=this.y+(d.y+.5)*h;this._renderTextShadow(i,this.text,S,G),i.fillStyle=this.textColor.toCss(!0),i.fillText(this.text,S,G)}_renderTextShadow(i,t,e,s){i.lineJoin="miter",i.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/B.length})`;const r=this._textShadowSize;for(const[o,d]of B)i.fillText(t,e+r*o,s+r*d)}_roundedRect(i,t,e,s,r,o){i.beginPath(),i.moveTo(t,e+o),i.arcTo(t,e,t+o,e,o),i.lineTo(t+s-o,e),i.arcTo(t+s,e,t+s,e+o,o),i.lineTo(t+s,e+r-o),i.arcTo(t+s,e+r,t+s-o,e+r,o),i.lineTo(t+o,e+r),i.arcTo(t,e+r,t,e+r-o,o),i.closePath()}_cssClasses(){const i={"esri-text-overlay-item":!0};for(const t in D)i[D[t]]=this.anchor===t;return i}};a([l()],x.prototype,"x",void 0),a([l()],x.prototype,"y",void 0),a([l()],x.prototype,"position",null),a([l()],x.prototype,"text",void 0),a([l()],x.prototype,"fontSize",void 0),a([l()],x.prototype,"anchor",void 0),a([l()],x.prototype,"visible",void 0),a([l()],x.prototype,"backgroundColor",void 0),a([l()],x.prototype,"textColor",void 0),a([l()],x.prototype,"_textShadowSize",void 0),a([l()],x.prototype,"_textShadowColor",null),a([l()],x.prototype,"_textShadow",null),a([l()],x.prototype,"_padding",null),a([l()],x.prototype,"_borderRadius",null),x=a([rt("esri.views.overlay.TextOverlayItem")],x);const Yt={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},B=[];for(let t=0;t<360;t+=360/16)B.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);const Lt=x;class Dt extends It{constructor(t){super(t.view),this._handles=new vt,this._textItem=null,this._calloutItem=null,this._showCallout=!0,this._showText=!0,this._geometry=null,this._text="-",this._fontSize=14,this._backgroundColor=new I([0,0,0,.6]),this._textColor=new I([255,255,255]),this._distance=25,this._anchor="right",this.updatePositionOnCameraMove=!0,this.applyProps(t)}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.updateLabelPosition()}get textItem(){return this._textItem}get text(){return this._text}set text(t){this._text=t,this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t,this.attached&&(this._textItem.fontSize=this._fontSize)}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t,this.attached&&(this._textItem.backgroundColor=this._backgroundColor)}get textColor(){return this._textColor}set textColor(t){this._textColor=t,this.attached&&(this._textItem.textColor=this._textColor)}get distance(){return this._distance}set distance(t){this._distance!==t&&(this._distance=t,this.updateLabelPosition())}get anchor(){return this._anchor}set anchor(t){this._anchor!==t&&(this._anchor=t,this.updateLabelPosition())}overlaps(t){return!!this.attached&&this.textItem.visible&&t.textItem.visible&&this.view.overlay.overlaps(this._textItem,t.textItem)}updateLabelPosition(){if(!this.attached)return;this._showText=!1,this._showCallout=!1;const{geometry:t,view:e,visible:s}=this;if(bt(t)&&e._stage)switch(t.type){case"point":if(!this._computeLabelPositionFromPoint(t.point,f))break;if(t.callout){const r=e.state.camera,o=t.callout.distance;w(u,u,[0,t.callout.offset]),r.renderToScreen(u,f),U(n,0,1),M(n,n,o*r.pixelRatio),w(n,n,u),r.renderToScreen(n,v),this._showCallout=this._updatePosition(f,v)}else this._textItem.position=[f[0],f[1]],this._textItem.anchor="center";this._showText=!0;break;case"corner":if(!this._computeLabelPositionFromCorner(t,this._distance,f,v))break;this._showCallout=this._updatePosition(f,v),this._showText=!0;break;case"segment":{if(!this._computeLabelPositionFromSegment(t,this._distance,this._anchor,f,v))break;this._showText=!0;const r=this._updatePosition(f,v);this._showCallout=t.callout!==!1&&r,this._showCallout||(this._textItem.anchor="center")}}this.updateVisibility(s)}_computeLabelPositionFromPoint(t,e){const s=this.view.state.camera;return s.projectToRenderScreen(t,u),!(u[2]<0||u[2]>1)&&(s.renderToScreen(u,e),!0)}_computeLabelPositionFromCorner(t,e,s,r){if(!t)return!1;const o=this.view.state.camera;return E(t.left,1,o,g),j(g,g),E(t.right,0,o,et),w(n,g,et),j(n,n),H(n,n),o.projectToRenderScreen(t.left.endRenderSpace,u),!(u[2]<0||u[2]>1)&&(o.renderToScreen(u,s),M(n,n,e*o.pixelRatio),w(n,n,u),o.renderToScreen(n,r),!0)}_computeLabelPositionFromSegment(t,e,s,r,o){if(!t)return!1;const d=t.segment,c=this.view.state.camera;zt(d.startRenderSpace,d.endRenderSpace,c,g),U(n,-g[1],g[0]);let h=!1;switch(s){case"top":h=n[1]<0;break;case"bottom":h=n[1]>0;break;case"left":h=n[0]>0;break;case"right":h=n[0]<0}if(h&&j(n,n),St(n)===0)switch(s){case"top":n[1]=1;break;case"bottom":n[1]=-1;break;case"left":n[0]=-1;break;case"right":n[0]=1}return d.eval(Ft[t.sampleLocation],it),c.projectToRenderScreen(it,u),!(u[2]<0||u[2]>1)&&(c.renderToScreen(u,r),M(n,n,e*c.pixelRatio),w(n,n,u),c.renderToScreen(n,o),!0)}_updatePosition(t,e){if(e){const s=e[0]-t[0],r=e[1]-t[1];return this._textItem.position=[e[0],e[1]],this._textItem.anchor=Math.abs(s)>Math.abs(r)?s>0?"left":"right":r>0?"top":"bottom",this._calloutItem.startPosition=[t[0],t[1]],this._calloutItem.endPosition=[e[0],e[1]],!0}return this._textItem.position=[t[0],t[1]],this._textItem.anchor="center",!1}createResources(){this._textItem=new Lt({visible:!0,text:this._text,fontSize:this._fontSize,backgroundColor:this._backgroundColor,textColor:this._textColor}),this._calloutItem=new Xt({visible:!0,width:2}),this.updateLabelPosition(),this.view.overlay.items.addMany([this._textItem,this._calloutItem]),this.updatePositionOnCameraMove&&this._handles.add(wt(()=>this.view.state.camera,()=>this.updateLabelPosition()))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}updateVisibility(t){this._textItem.visible=this._showText&&t,this._calloutItem.visible=this._showCallout&&t}}function E(i,t,e,s){i.eval(t,X,tt),V(K,X,tt),e.projectToRenderScreen(X,lt),e.projectToRenderScreen(K,ct),ot(s,Ot,Bt),H(s,s)}function Et(i){switch(i){case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"left":return"right"}}const X=_(),K=_(),tt=_(),g=Z(),et=Z(),n=Z(),it=_(),u=R(),f=F(),v=F(),lt=R(),Bt=lt,ct=R(),Ot=ct,Ft={start:0,center:.5,end:1};class dt{constructor(t=_(),e=_()){this.startRenderSpace=t,this.endRenderSpace=e,this.type="euclidean"}eval(t,e,s){return at(e,this.startRenderSpace,this.endRenderSpace,t),s&&($(s,this.endRenderSpace,this.startRenderSpace),Y(s,s)),e}createRenderGeometry(t,e){const s=[],r=[],o=(c,h)=>{const p=O;$(p,c,t),s.push([p[0],p[1],p[2]]),r.push([h[0],h[1],h[2]])},d=e.worldUpAtPosition(this.eval(.5,b),Ct.get());return o(this.startRenderSpace,d),o(this.endRenderSpace,d),{points:s,normals:r}}static fromPositionAndVector(t,e,s=1){return $t(b,e,s),V(b,t,b),new dt(J(t),J(b))}}class Kt{constructor(t,e,s){this.startRenderSpace=t,this.endRenderSpace=e,this.renderSpatialReference=s,this.type="geodesic",this._start=_(),this._end=_(),this._pcpf=Rt(s),this._project=Pt(s,this._pcpf),this._projectIn(t,this._start),this._projectIn(e,this._end)}_projectIn(t,e){this._project?P(t,this.renderSpatialReference,e,this._pcpf):st(e,t)}eval(t,e,s){if(this._project)if(s){const r=O;Tt(this._start,this._end,t,e,r),V(C,e,r),P(e,this._pcpf,e,this.renderSpatialReference),P(C,this._pcpf,C,this.renderSpatialReference),$(s,C,e),Y(s,s)}else kt(this._start,this._end,t,e),P(e,this._pcpf,e,this.renderSpatialReference);else at(e,this._start,this._end,t),s&&($(s,this._end,this._start),Y(s,s));return e}createRenderGeometry(t,e){const s=[],r=[],o=(c,h)=>{const p=C;$(p,c,t),s.push([p[0],p[1],p[2]]),r.push([h[0],h[1],h[2]])};for(let c=0;c<128;++c){const h=c/127,p=b,y=O;this.eval(h,p),e.worldUpAtPosition(p,y),o(p,y)}return{points:s,normals:r}}}const b=_(),O=_(),C=_();export{Et as I,Ut as M,Gt as a,qt as b,Wt as c,N as f,Dt as g,Qt as j,dt as l,Kt as m,jt as u,Jt as w,Nt as y};
