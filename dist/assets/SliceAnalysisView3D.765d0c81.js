import{nR as Wt,cZ as Bt,nE as jt,P as d,Q as u,bS as Kt,gM as ne,nf as Ke,mj as qe,ng as Ze,R as le,W as qt,g4 as oe,k2 as z,kU as we,fD as Y,dL as Zt,dM as Xt,dx as Xe,dQ as Ye,k_ as Qe,dU as Yt,dY as Qt,_ as Jt,e1 as ei,e2 as ti,e3 as ii,e4 as ai,k$ as si,d_ as de,cr as ni,ea as ri,ha as li,eg as oi,no as hi,ei as di,ej as ci,ek as ui,co as pi,cp as gi,hu as _i,a2 as bt,l1 as S,gm as Je,r as h,du as yi,mg as Ve,mr as Vt,m3 as o,bR as w,bm as x,nS as Mt,gv as A,kH as B,kG as I,bQ as P,g5 as C,fV as N,nT as Ie,lN as Tt,n9 as H,nU as vi,nV as ke,nW as wi,nX as mi,m4 as $t,bO as ie,nY as ze,mm as Et,fy as Q,nZ as Dt,gw as fi,nc as ce,e0 as ue,mh as Re,nb as Ct,mi as j,bp as J,e as p,kZ as Pi,cw as Ot,mo as bi,n_ as Vi,n$ as D,o0 as Le,kL as et,o1 as me,o2 as Mi,ad as St,ln as Ti,ml as tt,nn as it,f7 as Te,f5 as at,o3 as st,o4 as nt,o5 as $i,o6 as rt,o7 as Ei,h4 as Di,T as Ue,as as fe,aN as lt,aJ as L,mJ as Ci,l$ as Oi,bf as Si,bg as Ii,aK as ki,aQ as xe,hl as ot,aC as K,nQ as re,o8 as E,lO as ht,jr as Ae,mT as ye,lS as Ri,ma as Li,f6 as dt,f4 as xi,bG as ct,mR as ut,mS as Ai,nj as Hi,o9 as It,m0 as Ni,l6 as Gi,mN as zi}from"./index.347f2ee6.js";import{n as Ui,c as Fi,d as Wi,a as Bi,b as ji}from"./LineVisualElement.cecc7fde.js";import{M as Ki}from"./BuildingComponentSublayer.7ba7d0e6.js";import{D as qi,i as kt,R as Zi,x as Xi,a as Yi,d as pe,z as Qi,s as Ji,m as ea}from"./analysisViewUtils.9f937a13.js";import{o as ta,i as ia,C as ge}from"./Factory.03b5acfe.js";let G=class extends Wt(Bt){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&jt(this.position,e.position)&&this.width===e.width&&this.height===e.height}};d([u({readOnly:!0,json:{read:!1,write:!0}})],G.prototype,"type",void 0),d([u({type:Kt}),ne()],G.prototype,"position",void 0),d([u({type:Number,nonNullable:!0,range:{min:0,max:360}}),ne(),Ke(e=>qe.normalize(Ze(e),0,!0))],G.prototype,"heading",void 0),d([u({type:Number,nonNullable:!0,range:{min:0,max:360}}),ne(),Ke(e=>qe.normalize(Ze(e),0,!0))],G.prototype,"tilt",void 0),d([u({type:Number,nonNullable:!0}),ne()],G.prototype,"width",void 0),d([u({type:Number,nonNullable:!0}),ne()],G.prototype,"height",void 0),G=d([le("esri.analysis.SlicePlane")],G);const Fe=G,$e=qt("mac")?"Meta":"Control",Ee="Shift",aa=2,sa=1.15,na=1.15,ra=2500,la=.02,oa=Math.cos(we(45)),pt=Math.cos(we(5)),ha=.95,da=.3,ca=.7,he=z(1,.5,0),Rt=2,Lt=1,ee=oe([...he,ca]),te=[0,0,0,.04],xt=oe([...he,.5]),ua=Y(1,1,1,1),pa=Y(1,.8,.6,1),ga=Y(1,.93,.86,1),_a=oe([...he,1]),ya=oe([...he,1]),va=3,gt=11,He=22.5,ve=40,_t=48,wa=2.25,ma=oe([...he,1]),fa=4,yt=1,Pa=.3,ba=6,Va=4,vt=1600,Ma=.4;function Ta(e){const t=new Zt;t.extensions.add("GL_OES_standard_derivatives");const{vertex:i,fragment:a,attributes:s,varyings:n}=t;return Xt(i,e),s.add(Xe.POSITION,"vec3"),s.add(Xe.UV0,"vec2"),n.add("vUV","vec2"),i.code.add(Ye`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),a.uniforms.add([new Qe("backgroundColor",r=>r.backgroundColor),new Qe("gridColor",r=>r.gridColor),new Yt("gridWidth",r=>r.gridWidth)]),a.code.add(Ye`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const $a=Object.freeze(Object.defineProperty({__proto__:null,build:Ta},Symbol.toStringTag,{value:"Module"}));class Ea extends li{constructor(){super(...arguments),this.backgroundColor=Y(1,0,0,.5),this.gridColor=Y(0,1,0,.5),this.gridWidth=4}}class Me extends ei{initializeProgram(t){return new ti(t.rctx,Me.shader.get().build(this.configuration),ii)}initializePipeline(){return ai({blending:si(de.ONE,de.ONE,de.ONE_MINUS_SRC_ALPHA,de.ONE_MINUS_SRC_ALPHA),depthTest:{func:ni.LESS},colorWrite:ri})}}Me.shader=new Qt($a,()=>Jt(()=>import("./SlicePlaneMaterial.glsl.9424f0df.js"),["assets/SlicePlaneMaterial.glsl.9424f0df.js","assets/index.347f2ee6.js","assets/index.a651de9c.css","assets/LineVisualElement.cecc7fde.js","assets/BuildingComponentSublayer.7ba7d0e6.js","assets/analysisViewUtils.9f937a13.js","assets/ImageMaterial.d515ca27.js","assets/Factory.03b5acfe.js"]));class Da extends oi{constructor(t){super(t,new Oa),this._configuration=new hi}intersect(t,i,a,s,n,r,l){return di(t,i,s,n,r,void 0,l)}createBufferWriter(){return new ci(ui)}requiresSlot(t,i){return i===pi.Color&&t===gi.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(t){return new Ca(t)}getConfiguration(){return this._configuration}}class Ca extends _i{constructor(t){super(t),this.ensureTechnique(Me,null)}beginSlot(){return bt(this.technique)}}class Oa extends Ea{constructor(){super(...arguments),this.renderOccluded=S.Occlude}}class Sa extends Ui{constructor(t){super(t),this._material=null,this._renderOccluded=S.OccludeAndTransparent,this._gridWidth=1,this._gridColor=Y(1,0,0,1),this._backgroundColor=Y(1,0,0,1),this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){Je(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){Je(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new Da(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){h(this._material)&&t(this._material)}createGeometries(t){if(h(this._material)){const i=yi();t.addGeometry(i,this._material)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){h(this._material)&&this._material.setParameters(this._materialParameters)}}function Ia(e,t,i,a,s,n,r,l){return ka(t,r.worldUpAtPosition(e,o.get()),s,n,l.basis1,l.basis2),w(l.basis1,l.basis1,i),w(l.basis2,l.basis2,a),x(l.origin,e),Mt(l.basis2,l.basis1,l.origin,l.plane),l}function ka(e,t,i,a,s,n){const r=A(e,t),l=o.get(),c=o.get();switch(a===O.HORIZONTAL_OR_VERTICAL?Math.abs(r)>oa?O.HORIZONTAL:O.VERTICAL:a){case O.VERTICAL:{const g=Math.abs(r)<=pt?e:i.viewUp;B(l,g,t),x(c,t);break}case O.HORIZONTAL:B(l,i.viewUp,t),B(c,t,l);break;case O.TILTED:{const g=Math.abs(r)<=pt?t:i.viewUp;B(l,g,e),B(c,e,l);break}}const y=B(o.get(),l,c);A(y,i.viewForward)>0&&w(c,c,-1),I(s,l),I(n,c)}function Ra(e,t,i){const a=t.worldUpAtPosition(e.origin,o.get()),s=e.basis1,n=je(e,a),r=Math.round(n/se)*se;return Le(e,r-n,s,i)}function La(e,t,i,a,s,n){const r=x(o.get(),s.origin);P(r,r,w(o.get(),s.basis1,e.direction[0]<0?1:-1)),P(r,r,w(o.get(),s.basis2,e.direction[1]<0?1:-1));const l=C(s.basis1),c=C(s.basis2),y=N(o.get(),i,r),g=N(o.get(),t,r);let _=0,$=0;if(Be(e)){const V=Ne(s),F=Ne(n);_=l-.5*e.direction[0]*A(s.basis1,g)/l,$=c-.5*e.direction[1]*A(s.basis2,g)/c;const q=F/V;_*=q,$*=q}const k=_+.5*e.direction[0]*A(s.basis1,y)/l,f=$+.5*e.direction[1]*A(s.basis2,y)/c,v=w(o.get(),s.basis1,k/l),m=w(o.get(),s.basis2,f/c);(k<=0||mt(n.origin,v,a)<=vt)&&x(v,n.basis1),(f<=0||mt(n.origin,m,a)<=vt)&&x(m,n.basis2);const b=x(o.get(),r);return P(b,b,w(o.get(),v,e.direction[0]<0?-1:1)),P(b,b,w(o.get(),m,e.direction[1]<0?-1:1)),Ie(b,v,m,n)}function xa(e,t){return Ma*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function Aa(e,t,i,a){const s=B(o.get(),t,i);return B(s,s,t),Tt(e,s,a)}function At(e,t){return qi(e.basis1,e.basis2,e.origin,t)}function wt(e,t,i,a){const s=t.worldUpAtPosition(e.origin,o.get()),n=o.get();switch(i){case ae.HEADING:x(n,s);break;case ae.TILT:x(n,e.basis1)}return Tt(e.origin,n,a)}function Ha(e,t,i,a){const s=We(i,U.NEGATIVE_X),n=H.get();vi(n,t,s.edge*Math.PI/2);const r=I(o.get(),s.basis);let l=w(o.get(),r,s.direction*a.computeScreenPixelSizeAt(s.position)*ve);P(l,l,s.position);const c=a.projectToRenderScreen(l,ke(o.get())),y=Na(a,c);wi(a,c,_e),I(_e.direction,_e.direction);const g=o.get();!y&&mi(i,_e,g)&&(l=g),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=$t(l),y?e.state|=Pe:e.state&=~Pe}function Na(e,t){const[i,a,s,n]=e.viewport,r=Math.min(s,n)/16;let l=!0;return t[0]<i+r?(t[0]=i+r,l=!1):t[0]>i+s-r&&(t[0]=i+s-r,l=!1),t[1]<a+r?(t[1]=a+r,l=!1):t[1]>a+n-r&&(t[1]=a+n-r,l=!1),l}function Ga(e,t,i,a){const s=C(a.basis1),n=C(a.basis2),r=Ht(a),l=Ne(a),c=ie(o.get(),0,0,0);P(c,w(o.get(),a.basis1,t.direction[0]),w(o.get(),a.basis2,t.direction[1])),P(c,a.origin,c);let y=0,g=1;if(Be(t))t.direction[0]===1&&t.direction[1]===-1?y=se:t.direction[0]===1&&t.direction[1]===1?y=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(y=3*Math.PI/2),g=l;else{const $=t.direction[0]!==0?1:2;y=$===1?se:0,g=($===1?n:s)-r}const _=ze(H.get(),y);Et(_,_,ie(o.get(),g,g,g)),Q(_,i,_),_[12]=0,_[13]=0,_[14]=0,e.modelTransform=_,e.renderLocation=c}function za(e,t,i,a){const s=a.worldUpAtPosition(i.origin,o.get()),n=We(i,U.POSITIVE_X),r=ze(H.get(),n.edge*Math.PI/2);Dt(r,r,-je(i,s)),Q(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=n.position}function Ua(e,t,i){const a=We(i,U.POSITIVE_Y),s=ze(H.get(),a.edge*Math.PI/2);Dt(s,s,se),Q(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=a.position}var U;function We(e,t){switch(t){case U.POSITIVE_X:return{basis:e.basis1,direction:1,position:P(o.get(),e.origin,e.basis1),edge:t};case U.POSITIVE_Y:return{basis:e.basis2,direction:1,position:P(o.get(),e.origin,e.basis2),edge:t};case U.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:N(o.get(),e.origin,e.basis1),edge:t};case U.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:N(o.get(),e.origin,e.basis2),edge:t}}}function mt(e,t,i){const a=i.projectToRenderScreen(P(o.get(),e,t),ke(o.get())),s=i.projectToRenderScreen(N(o.get(),e,t),ke(o.get()));return fi(N(a,a,s))}function Ht(e){const t=C(e.basis1),i=C(e.basis2);return Pa*Math.min(t,i)}function Ne(e){return Ht(e)}function Be(e){return e.direction[0]!==0&&e.direction[1]!==0}function Fa(e,t=be.CENTER_ON_ARROW){const i=t===be.CENTER_ON_CALLOUT?ve:0,a=[z(i,0,-_t/2),z(i,0,_t/2)],s=Ka(a,!0),n=(v,m)=>Ba(a,a,{tubeRadius:va,tipRadius:gt,tipLength:He,tubeFocusMultiplier:sa,tipFocusMultiplier:na,padding:v,bothEnds:!0,flat:null,focusTipLength:!0,addCap:m}),r=n(0,!1),l=n(wa,!0),c=new ce({color:ua,cullFace:ue.Back,renderOccluded:S.Opaque}),y=new ce({color:pa,cullFace:ue.Back,renderOccluded:S.Opaque}),g=new ce({color:ga,cullFace:ue.Back,renderOccluded:S.Opaque}),_=new ce({color:ya,transparent:!0,writeDepth:!1,cullFace:ue.Front,renderOccluded:S.Transparent}),$=Re([[i,0,0],[i-ve,0,0]]),k=Re([[i,0,0],[i-ve,0,0]]),f=new Ct({color:_a,renderOccluded:S.OccludeAndTransparent});return new kt({view:e,renderObjects:[...r.normal.map(({part:v,geometry:m,transform:b})=>({geometry:m,material:v==="tip"?c:v==="cap"?y:g,transform:b,stateMask:j.Unfocused|T})),...l.normal.map(({geometry:v,transform:m})=>({geometry:v,material:_,transform:m,stateMask:j.Unfocused|T})),{geometry:$,material:f,stateMask:j.Unfocused|T|Pe},...r.focused.map(({part:v,geometry:m,transform:b})=>({geometry:m,material:v==="tip"?c:v==="cap"?y:g,transform:b,stateMask:j.Focused|T})),...l.focused.map(({geometry:v,transform:m})=>({geometry:v,material:_,transform:m,stateMask:j.Focused|T})),{geometry:k,material:f,stateMask:j.Focused|T|Pe}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[s]},collisionPriority:1,radius:gt,state:T})}function ft(e,t){const i=Zi(e,{customStateMask:T,texture:t});return i.state=T,i}function Nt(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new Fi({view:e,attached:!1,color:ee,width:Lt,writeDepthEnabled:!1,renderOccluded:S.OccludeAndTransparent,geometry:[t]})}function Gt(e){return new Sa({view:e,attached:!1,backgroundColor:[...te],gridColor:xt,gridWidth:4,renderOccluded:S.OccludeAndTransparent})}function Wa(e,t){const i=Be(t),a=i?[z(1,0,0),z(0,0,0),z(0,1,0)]:[z(1,0,0),z(-1,0,0)],s=Re(a),n=ma,r=f=>new Ti({color:n,width:f,renderOccluded:S.OccludeAndTransparent}),l=()=>new Ct({color:n,renderOccluded:S.OccludeAndTransparent}),c=i?fa:yt,y=c*aa,g=yt,_=f=>f>1?r(f):l(),$=[{geometry:s,material:_(c),stateMask:j.Unfocused|De},{geometry:s,material:_(y),stateMask:j.Focused|De},{geometry:s,material:_(g),stateMask:Ya}],k=new kt({view:e,renderObjects:$,collisionType:{type:"line",paths:[a]},radius:i?ba:Va,...Xi});return k.state=De,k}function Ba(e,t,i){const a=s=>{const n=(s?t:e).slice(0),r=N(o.get(),n[0],n[1]);I(r,r);const l=N(o.get(),n[n.length-1],n[n.length-2]);if(I(l,l),i.padding>0){const V=w(J(),l,-i.padding);if(n[n.length-1]=P(V,V,n[n.length-1]),i.bothEnds){const F=w(J(),r,-i.padding);n[0]=P(F,F,n[0])}}const c=s?i.tipFocusMultiplier:1,y=i.tipLength*(i.focusTipLength?c:1),g=i.tipRadius*c,_=tt(H.get());if(i.padding>0){const V=y/4,F=ie(o.get(),0,V,0),q=1+i.padding/V;it(_,_,F),Et(_,_,ie(o.get(),q,q,q)),it(_,_,w(F,F,-1/q))}const $=tt(Te()),k=z(0,1,0),f=at(Te(),st(nt.get(),k,l));f[12]=n[n.length-1][0],f[13]=n[n.length-1][1],f[14]=n[n.length-1][2],Q(f,f,_);const v=[{part:"tube",geometry:ja(i.tubeRadius*(s?i.tubeFocusMultiplier:1)+i.padding,i.flat,n),transform:$}];let m,b;if(h(i.flat)?m=$i(y,g,g,i.flat.thickness):(m=rt(y,g,24,!1,!1,!0),b=rt(y,g,24,!1,!0,!1)),v.push({part:"tip",geometry:m,transform:f}),b&&v.push({part:"cap",geometry:b,transform:f}),i.bothEnds){const V=at(Te(),st(nt.get(),k,r));V[12]=n[0][0],V[13]=n[0][1],V[14]=n[0][2],Q(V,V,_),v.push({part:"tip",geometry:m,transform:V}),b&&v.push({part:"cap",geometry:b,transform:V})}return v};return{normal:a(!1),focused:a(!0)}}function ja(e,t,i){const a=[];if(h(t))a.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else for(let n=0;n<12;n++){const r=n/12*2*Math.PI;a.push([Math.cos(r)*e,Math.sin(r)*e])}return Ei(a,i,[],[],!1)}function Ka(e,t){const i=N(J(),e[e.length-1],e[e.length-2]);if(I(i,i),w(i,i,He),P(i,i,e[e.length-1]),t){const a=N(J(),e[0],e[1]);return I(a,a),w(a,a,He),P(a,a,e[0]),[a,...e,i]}return[...e,i]}function zt(e,t,i,a=new Fe){if(p(e))return null;const{renderCoordsHelper:s}=t,n=s.fromRenderCoords(e.origin,t.spatialReference);if(p(n))return null;const r=Pi(n,i);if(p(r))return null;a.position=r;const l=2*C(e.basis1),c=2*C(e.basis2),y=Ot.renderUnitScaleFactor(t.spatialReference,i);a.width=l*y,a.height=c*y;const g=s.worldUpAtPosition(e.origin,o.get());return a.tilt=bi(je(e,g)),a.heading=s.headingAtPosition(e.origin,e.basis1)-90,a}function je(e,t){return Vi(t,e.basis2,e.basis1)+se}function qa(e,t,i,a,s,n,r=D()){return n.toRenderCoords(e,r.origin)?(n.worldBasisAtPosition(r.origin,et.X,r.basis1),n.worldBasisAtPosition(r.origin,et.Y,r.basis2),Mt(r.basis2,r.basis1,r.origin,r.plane),Le(r,-we(t),me(r),r),Le(r,we(i),r.basis1,r),w(r.basis1,r.basis1,a/2),w(r.basis2,r.basis2,s/2),Mi(r),r):(St.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Za(e,t){if(p(e)||p(e.position))return null;const i=Wi(e.position,t.spatialReference,t.elevationProvider);if(p(i))return null;const a=Ot.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),s=e.width*a,n=e.height*a;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:n}}function Xa(e,t,i,a=D()){if(p(e))return null;const s=qa(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return!i.tiltEnabled&&h(s)&&Ra(s,t.renderCoordsHelper,s),s}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(U||(U={}));const T=Ve.Custom1;var ae,O;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(ae||(ae={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(O||(O={}));const Pe=Ve.Custom2,_e=Vt(),se=Math.PI/2,De=Ve.Custom1,Ya=Ve.Custom2;var be;function Qa(e){const t=e.type==="building-scene-3d"?e:null;return h(t)}(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(be||(be={}));function Ja(e){switch(e.type){case"building-scene":case"csv":case"dimension":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"oriented-imagery":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return Di(e.type),!1}}const Ut="esri.views.3d.analysis.Slice.SliceController",Ce=St.getLogger(Ut);let Z=class extends Ue{constructor(e){super(e),this._handles=new fe,this._internalChange=!1,this._currentSlicePlane=null}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",e=>{const t=e.item;t!=null&&(t instanceof lt||t instanceof Ki)?t instanceof lt&&Ja(t)?(Ce.error("excludedLayers",`Layer '${t.title}, id:${t.id}' of type '${t.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(t)&&e.preventDefault():(Ce.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())})),ts(this.view,this),this._handles.add([L(()=>this.analysisViewData.plane,()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()},{sync:!0}),L(()=>this.analysis.excludeGroundSurface,()=>this._updateLayerViews(),{sync:!0}),this.analysis.excludedLayers.on("change",()=>this._updateLayerViews()),L(()=>[this.analysisViewData.active,this.analysisViewData.visible],()=>{this._updateActiveController(),this._updateViewSlicePlane()},{sync:!0}),L(()=>this._allLayerAndSubLayerViews,()=>this._updateLayerViews())]),this._handles.add([L(()=>this.analysis.shape,()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())},{sync:!0})],"analysis"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),is(this.view,this),this._handles.destroy(),this.set("view",null)}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(Qa).flatMap(({sublayerViews:t})=>t.items))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,t=this._currentSlicePlane;if(p(t)&&p(e)||h(t)&&h(e)&&e.equals(t))return;let i=null,a=null;if(h(e)&&h(e.position)){const s=e.position.spatialReference,n=Za(e,this.view);p(n)&&Bi(this.analysis,s,Ce),i=Xa(n,this.view,{tiltEnabled:this.analysis.tiltEnabled},D()),h(i)&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=a,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=this.analysisViewData.plane,t=zt(e,this.view,this.view.spatialReference,new Fe);let i=null;h(t)&&(i={heading:t.heading,tilt:t.tilt,position:t.position,width:t.width,height:t.height}),this._currentSlicePlane=i,this._internalChange=!0,this.analysis.shape=t,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(Oe)return;const e=Ft(this.view);if(this.analysisViewData.active)h(e.activeController)&&e.activeController!==this?(Oe=!0,e.activeController.analysisViewData.active=!1,Oe=!1):h(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if(h(e.activeController)&&e.activeController!==this)return;h(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){es(this.view)}_updateLayerViews(){const e=h(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,t=[],i=a=>{"layers"in a?a.layers.forEach(i):t.push(a)};this.analysis.excludedLayers.forEach(i),this.view.allLayerViews.forEach(a=>{a.destroyed||("slicePlaneEnabled"in a&&(a.slicePlaneEnabled=e&&!t.includes(a.layer)),"sublayerViews"in a&&a.sublayerViews.forEach(s=>{s.slicePlaneEnabled=e&&!t.includes(s.sublayer)}))}),this.view.basemapTerrain!=null&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};d([u()],Z.prototype,"view",void 0),d([u()],Z.prototype,"analysis",void 0),d([u()],Z.prototype,"analysisViewData",void 0),d([u()],Z.prototype,"_allLayerAndSubLayerViews",null),Z=d([le(Ut)],Z);const X=new Map;let Oe=!1;function es(e){const t=Ft(e).activeController;h(t)&&h(t.analysisViewData.plane)&&t.analysisViewData.visible?e.slicePlane=t.analysisViewData.plane:e.slicePlane=null}function ts(e,t){X.has(e)||X.set(e,{all:[],activeController:null}),X.get(e).all.push(t)}function Ft(e){return X.get(e)}function is(e,t){if(!X.has(e))throw new Error("view expected in global slice register");const i=X.get(e),a=i.all.lastIndexOf(t);if(a===-1)throw new Error("controller expected in global slice register");i.all.splice(a,1),i.all.length===0&&X.delete(e)}var Ge;let M=Ge=class extends Yi{constructor(e){super(e),this._clock=Ci,this._previewPlaneOpacity=1,this.removeIncompleteOnCancel=!1,this.layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this._handles=new fe,this._viewHandles=new fe,this._frameTask=null,this._pointerMoveTimerMs=ra,this._prevPointerMoveTimeout=null,this._previewPlaneGridVisualElement=null,this._previewPlaneOutlineVisualElement=null,this._startPlane=D(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=Oi(),this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=Si(e.view.state.viewingMode),this._intersector.options.store=Ii.MIN}initialize(){if(this.analysis==null)throw new Error("SliceTool requires valid analysis, but null was provided.");this._rotateHeadingImage=ta(this.view.toolViewManager.textures),this._rotateTiltImage=ia(this.view.toolViewManager.textures);const e=i=>{this._updateManipulatorsInteractive(i),i.grabbing||(h(this.analysisViewData.plane)&&E(this.analysisViewData.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=Fa(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",i=>{this._onShiftGrab(i),e(this.shiftManipulator)}),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=ft(this.view,this._rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",i=>{this._onRotateHeadingGrab(i),e(this.rotateHeadingManipulator)}),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=ft(this.view,this._rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",i=>{this._onRotateTiltGrab(i),e(this.rotateTiltManipulator)}),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map((i,a)=>{const s=Wa(this.view,i);return s.events.on("grab-changed",n=>{this._onResizeGrab(n,a),e(s)}),this._handles.add(this._createResizeDragPipeline(s)),s}),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=Gt(this.view),this._previewPlaneOutlineVisualElement=Nt(this.view),this._previewPlaneOutlineVisualElement.width=Rt,this._handles.add(L(()=>this.analysisViewData.plane,()=>this._updateManipulators(),ki));const t=L(()=>this.state,i=>{i==="sliced"&&this.finishToolCreation()},xe);this._handles.add([t,L(()=>this.view.state.camera,()=>this._onCameraChange())])}destroy(){this._rotateHeadingImage=ot(this._rotateHeadingImage),this._rotateTiltImage=ot(this._rotateTiltImage),this._handles=K(this._handles),this._viewHandles=K(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=K(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=K(this._previewPlaneGridVisualElement)}get state(){const e=!!this.analysisViewData.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}get cursor(){return this._isPlacingSlicePlane||this.layersMode==="exclude"?"crosshair":h(this._creatingPointerId)?"grabbing":null}set analysis(e){if(e==null)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",e)}get inputState(){return this._get("inputState")}set inputState(e){this._set("inputState",e),this.analysisViewData.showGrid=h(e)&&e.type==="resize",this._updateMaterials()}get _isPlacingSlicePlane(){return!this.inputState&&!this.analysisViewData.plane&&this.active}get _creatingPointerId(){return h(this.inputState)&&this.inputState.type==="shift"?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){p(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this))}exitExcludeLayerMode(){p(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null))}onDeactivate(){this._set("layersMode","none"),this._updatePreviewPlane(null)}onShow(){this._updateVisibility(!0)}onHide(){this._updateVisibility(!1)}_updateVisibility(e){this._updateManipulators(),e||this._clearPointerMoveTimeout()}onInputEvent(e){switch(e.type){case"pointer-drag":if(!Se(e))return;this._isPlacingSlicePlane?this._onClickPlacePlane(e)&&e.stopPropagation():this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e);break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!Se(e))return;this._onClickPlacePlane(e)&&e.stopPropagation();break;case"click":if(!Se(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}}onEditableChange(){this.analysisViewData.editable=this.internallyEditable}_onPointerDrag(e){const t=this.inputState;if(e.pointerId===this._creatingPointerId&&h(t)&&t.type==="shift"){const i=re(e);return this.shiftManipulator.events.emit("drag",{action:t.hasBeenDragged?"update":"start",pointerType:e.pointerType,start:i,screenPoint:i}),t.hasBeenDragged=!0,!0}return!1}_onPointerMove(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),e.pointerType!=="touch"&&this._updatePreviewPlane(re(e),this._activeKeyModifiers)}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}_onPointerUp(e){if(e.pointerId===this._creatingPointerId&&h(this.analysisViewData.plane)){const t=re(e);return this.shiftManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),E(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1}_onClickPlacePlane(e){if(this.layersMode==="exclude")return!1;if(this._isPlacingSlicePlane){const t=re(e),i=D();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){if(E(i,this._startPlane),this.analysis.shape=zt(i,this.view,this.view.spatialReference,new Fe),e.type==="pointer-drag"){const a=this._calculatePickRay(t);this.inputState=Pt(a,e.pointerId,i.origin,i)}return!0}}return!1}_onClickExcludeLayer(e){return!(this.layersMode!=="exclude"||!this.created)&&(this.view.hitTest(re(e)).then(t=>{if(t.results.length){const i=t.results[0],a=(i==null?void 0:i.type)==="graphic"&&i.graphic;if(a){const s=a.sourceLayer||a.layer;s&&this.analysis.excludedLayers.push(s)}}else t.ground.layer?this.analysis.excludedLayers.push(t.ground.layer):this.analysis.excludeGroundSurface=!0}),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),!0)}_onKeyDown(e){return(e.key===Ee||e.key===$e)&&(this._activeKeyModifiers[e.key]=!0,h(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(e){return!(e.key!==Ee&&e.key!==$e||!this._activeKeyModifiers[e.key])&&(delete this._activeKeyModifiers[e.key],h(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onShiftGrab(e){if(e.action!=="start"||p(this.analysisViewData.plane))return;const t=this._calculatePickRay(e.screenPoint);E(this.analysisViewData.plane,this._startPlane),this.inputState=Pt(t,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)}_createShiftDragPipeline(e){return pe(e,(t,i,a)=>{const s=this.inputState;if(p(s)||s.type!=="shift")return;const n=h(this.analysisViewData.plane)?E(this.analysisViewData.plane,D()):null;i.next(ge(this.view,s.shiftPlane)).next(this._shiftDragAdjustSensitivity(s)).next(this._shiftDragUpdatePlane(s)),a.next(()=>{h(n)&&this._updateBoundedPlane(n)})})}_shiftDragAdjustSensitivity(e){return t=>{if(p(this.analysisViewData.plane))return null;const i=.001,a=Math.min((1-Math.abs(A(me(this.analysisViewData.plane),t.ray.direction)/C(t.ray.direction)))/i,1),s=-ht(this._startPlane.plane,t.renderEnd),n=-ht(this._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-a)+s*a-n,t}}_shiftDragUpdatePlane(e){return()=>{if(p(this.analysisViewData.plane))return;const t=x(o.get(),this._startPlane.origin),i=x(o.get(),me(this._startPlane));w(i,i,-e.depth),P(i,i,t);const a=Ie(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,D());this._updateBoundedPlane(a)}}_onRotateHeadingGrab(e){if(e.action!=="start"||p(this.analysisViewData.plane))return;const t=wt(this.analysisViewData.plane,this.view.renderCoordsHelper,ae.HEADING,Ae()),i=this._calculatePickRay(e.screenPoint),a=J();ye(t,i,a)&&(E(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateHeadingDragPipeline(e){return pe(e,(t,i,a)=>{const s=this.inputState;if(p(s)||s.type!=="rotate")return;const n=h(this.analysisViewData.plane)?E(this.analysisViewData.plane,D()):null;i.next(ge(this.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdatePlaneFromRotate()),a.next(()=>{h(n)&&this._updateBoundedPlane(n)})})}_onRotateTiltGrab(e){if(e.action!=="start"||p(this.analysisViewData.plane))return;const t=wt(this.analysisViewData.plane,this.view.renderCoordsHelper,ae.TILT,Ae()),i=this._calculatePickRay(e.screenPoint),a=J();ye(t,i,a)&&(E(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateTiltDragPipeline(e){return pe(e,(t,i,a)=>{const s=this.inputState;if(p(s)||s.type!=="rotate")return;const n=h(this.analysisViewData.plane)?E(this.analysisViewData.plane,D()):null;i.next(ge(this.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdatePlaneFromRotate()),a.next(()=>{h(n)&&this._updateBoundedPlane(n)})})}_rotateDragRenderPlaneToRotate(e){return t=>{if(p(this.analysisViewData.plane))return null;const i=Ri(e.rotatePlane),a=Qi(e.startPoint,t.renderEnd,this.analysisViewData.plane.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdatePlaneFromRotate(){return e=>{if(p(this.analysisViewData.plane))return;const t=Li(H.get(),e.rotateAngle,e.rotateAxis);if(p(t))return;const i=dt(o.get(),this._startPlane.basis1,t),a=dt(o.get(),this._startPlane.basis2,t),s=Ie(this.analysisViewData.plane.origin,i,a,D());this._updateBoundedPlane(s)}}_onResizeGrab(e,t){if(e.action!=="start"||p(this.analysisViewData.plane))return;const i=this._calculatePickRay(e.screenPoint),a=o.get();ye(this.analysisViewData.plane.plane,i,a)&&(E(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:$t(a)})}_createResizeDragPipeline(e){return pe(e,(t,i,a)=>{const s=this.inputState;if(p(s)||s.type!=="resize"||p(this.analysisViewData.plane))return;const n=E(this.analysisViewData.plane,D());i.next(ge(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(s)),a.next(()=>{this._updateBoundedPlane(n)})})}_resizeDragUpdatePlane(e){return t=>{if(p(this.analysisViewData.plane))return;const i=this._resizeHandles[e.activeHandleIdx],a=La(i,e.startPoint,t.renderEnd,this.view.state.camera,this._startPlane,E(this.analysisViewData.plane));this._updateBoundedPlane(a)}}_updateBoundedPlane(e){const t=this.analysisViewData;if(!h(t))throw new Error("valid internal object expected");t.plane=e}_updatePreviewPlane(e,t={}){let i=this._previewPlane;if(this._previewPlane=null,p(e))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const a=h(i)?i:D();if(i=h(i)?E(i,as):null,this._pickPlane(e,!0,t,a)){const s=ha;let n=!1;h(i)&&(n=A(i.plane,a.plane)<s||A(I(o.get(),i.basis1),I(o.get(),a.basis1))<s),n&&(this._previewPlaneOpacity=0),this._previewPlane=a}}h(this._previewPlane)&&p(this._frameTask)&&this._previewPlaneOpacity===0?this._frameTask=xi({update:({deltaTime:a})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+a/(1e3*da),1),this._updateManipulators(),this._previewPlaneOpacity===1&&this._removeFrameTask()}}):p(this._previewPlane)&&h(this._frameTask)?this._removeFrameTask():h(this._previewPlane)&&this._updateManipulators()}_removeFrameTask(){this._frameTask=ct(this._frameTask)}_calculatePickRay(e){const t=Vt(),i=ut(e,ss);return Ai(this.view.state.camera,i,t),I(t.direction,t.direction),t}_pickMinResult(e){const t=ut(e,Hi.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min}_pickPlane(e,t,i,a){const s=this._pickMinResult(e),n=o.get();if(!s.getIntersectionPoint(n))return!1;const r=s.getTransformedNormal(o.get()),l=this.view.state.camera;A(r,l.viewForward)>0&&w(r,r,-1);const c=xa(n,l),y=(t?1:-1)*c*la,g=w(o.get(),r,y);P(g,g,n);const _=this.analysis.tiltEnabled?O.TILTED:O.HORIZONTAL_OR_VERTICAL,$=i[Ee]?O.VERTICAL:i[$e]?O.HORIZONTAL:_;return Ia(g,r,c,c,l,$,this.view.renderCoordsHelper,a),!0}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=ct(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=T,this.rotateHeadingManipulator.state|=T,this.rotateTiltManipulator.state|=T,this._prevPointerMoveTimeout=this._clock.setTimeout(()=>{this.shiftManipulator.state&=~T,this.rotateHeadingManipulator.state&=~T,this.rotateTiltManipulator.state&=~T},this._pointerMoveTimerMs)}_updateManipulators(){if(Ge.disableEngineLayers)return;let e=null,t=!1;if(h(this.analysisViewData.plane))e=this.analysisViewData.plane,t=!1;else{if(!h(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(r=>r.available=!1),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);e=this._previewPlane,t=!0}const i=At(e,H.get());t?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach(r=>r.available=!1),this._previewPlaneOutlineVisualElement.attached=!0,this._previewPlaneGridVisualElement.attached=!0,this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach(r=>r.available=!0),Ha(this.shiftManipulator,i,e,this.view.state.camera),za(this.rotateHeadingManipulator,i,e,this.view.renderCoordsHelper),Ua(this.rotateTiltManipulator,i,e),this.resizeManipulators.forEach((r,l)=>Ga(r,this._resizeHandles[l],i,e)),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const a=ie(o.get(),C(e.basis1),C(e.basis2),1),s=It(H.get(),a),n=Q(s,i,s);this._previewPlaneOutlineVisualElement.transform=n,this._previewPlaneGridVisualElement.transform=n,this._updateMaterials()}_updateMaterials(){const e=[ee[0],ee[1],ee[2],ee[3]*this._previewPlaneOpacity];this._previewPlaneOutlineVisualElement.color=e;const t=[te[0],te[1],te[2],te[3]*this._previewPlaneOpacity],i=[0,0,0,0];this._previewPlaneGridVisualElement.backgroundColor=t,this._previewPlaneGridVisualElement.gridColor=i}_updateManipulatorsInteractive(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach(t=>{t.interactive=!0});this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach(t=>{t.interactive=t===e})}testData(){return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:e=>{this._pointerMoveTimerMs=e}}}};function Pt(e,t,i,a){const s=Aa(i,me(a),e.direction,Ae()),n=J();return ye(s,e,n)?{type:"shift",creatingPointerId:t,hasBeenDragged:!1,shiftPlane:s,depth:0,startPoint:n}:null}function Se(e){return e.pointerType!=="mouse"||e.button===0}M.disableEngineLayers=!1,d([u()],M.prototype,"_clock",void 0),d([u({constructOnly:!0})],M.prototype,"view",void 0),d([u()],M.prototype,"analysisViewData",void 0),d([u({readOnly:!0})],M.prototype,"state",null),d([u({readOnly:!0})],M.prototype,"cursor",null),d([u()],M.prototype,"analysis",null),d([u()],M.prototype,"removeIncompleteOnCancel",void 0),d([u({readOnly:!0})],M.prototype,"layersMode",void 0),d([u({value:null})],M.prototype,"inputState",null),d([u()],M.prototype,"_isPlacingSlicePlane",null),d([u()],M.prototype,"_creatingPointerId",null),M=Ge=d([le("esri.views.3d.analysis.Slice.SliceTool")],M);const as=D(),ss=Ni(),ns=M;let W=class extends Ue{constructor(e){super(e),this._handles=new fe,this._gridVisualElement=null,this._outlineVisualElement=null,this.showGrid=!1,this.preview=!0}initialize(){const e=this.analysisViewData;if(p(e))throw new Error("expected internal object to be valid");this._gridVisualElement=Gt(this.view),this._outlineVisualElement=Nt(this.view),this._handles.add([L(()=>({visible:h(e.plane)&&this.analysisViewData.visible,active:this.analysisViewData.active,preview:this.preview,showGrid:this.showGrid}),t=>this._updateMaterials(t),xe),L(()=>e.plane,t=>this._updatePlane(t),xe)],"internal")}destroy(){this._handles.destroy(),this._gridVisualElement=K(this._gridVisualElement),this._outlineVisualElement=K(this._outlineVisualElement),this.set("view",null)}_updatePlane(e){if(p(e))return;this._gridVisualElement.attached=!0,this._outlineVisualElement.attached=!0;const t=ie(o.get(),C(e.basis1),C(e.basis2),1),i=It(H.get(),t),a=At(e,H.get()),s=Q(i,a,i);this._outlineVisualElement.transform=s,this._gridVisualElement.transform=s}_updateMaterials({visible:e,active:t,preview:i,showGrid:a}){this._outlineVisualElement.color=ee,this._outlineVisualElement.width=i?Rt:Lt,this._outlineVisualElement.stipplePattern=t?null:Gi(5),this._gridVisualElement.backgroundColor=te,this._gridVisualElement.gridColor=a?xt:zi,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};d([u()],W.prototype,"view",void 0),d([u()],W.prototype,"analysis",void 0),d([u()],W.prototype,"analysisViewData",void 0),d([u()],W.prototype,"showGrid",void 0),d([u()],W.prototype,"preview",void 0),W=d([le("esri.views.3d.analysis.Slice.SliceVisualization")],W);let R=class extends ji(Ue){constructor(e){super(e),this.type="slice-view-3d",this.analysis=null,this.tool=null,this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0}initialize(){this.analysisVisualization=new W({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new Z({view:this.view,analysis:this.analysis,analysisViewData:this}),this.addHandles(Ji(this,ns))}destroy(){ea(this),this.analysisVisualization=K(this.analysisVisualization),this.analysisController=K(this.analysisController)}get showGrid(){var e,t;return(t=(e=this.analysisVisualization)==null?void 0:e.showGrid)!=null?t:!1}set showGrid(e){this.analysisVisualization&&(this.analysisVisualization.showGrid=e)}get editable(){return!this.analysisVisualization.preview}set editable(e){this.analysisVisualization.preview=!e}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController,tool:bt(this.tool)}}};d([u({readOnly:!0})],R.prototype,"type",void 0),d([u({constructOnly:!0,nonNullable:!0})],R.prototype,"analysis",void 0),d([u()],R.prototype,"tool",void 0),d([u()],R.prototype,"plane",void 0),d([u()],R.prototype,"active",void 0),d([u()],R.prototype,"showGrid",null),d([u()],R.prototype,"editable",null),R=d([le("esri.views.3d.analysis.SliceAnalysisView3D")],R);const rs=R,us=Object.freeze(Object.defineProperty({__proto__:null,default:rs},Symbol.toStringTag,{value:"Module"}));export{us as S,Ta as t};
