import{P as $,Q as j,nf as fr,R as He,cZ as Ye,s as ye,r as z,e as we,y as re,ad as ge,d2 as pr,dB as dr,_ as mr,cn as gr,l as fe,a2 as pe,aw as yt,Z as Wt,bS as yr,G as wt,a6 as wr,W as Cr,bc as xr,pO as Kt}from"./index.347f2ee6.js";import{z as Ct,y as We,v as xt,p as br}from"./colorUtils.bb6424b7.js";class bt{constructor(t=null,r=null,c=null){this.minValue=t,this.maxValue=r,this.noDataValue=c}}var Se;let ce=Se=class extends Ye{constructor(e){super(e),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.statistics=null}static createEmptyBand(e,t){return new(Se.getPixelArrayConstructor(e))(t)}static getPixelArrayConstructor(e){let t;switch(e){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":t=Float32Array;break;case"f64":t=Float64Array}return t}castPixelType(e){if(!e)return"f32";let t=e.toLowerCase();return["u1","u2","u4"].includes(t)?t="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(t)||(t="f32"),t}getPlaneCount(){var e;return(e=this.pixels)==null?void 0:e.length}addData(e){var t;if(!e.pixels||e.pixels.length!==this.width*this.height)throw new ye("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(e.pixels),this.statistics.push((t=e.statistics)!=null?t:new bt)}getAsRGBA(){const e=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(e);break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)}getAsRGBAFloat(){const e=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(e),e}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map(r=>this._calculateBandStatistics(r,this.mask));const e=this.mask;let t=0;if(z(e))for(let r=0;r<e.length;r++)e[r]&&t++;else t=this.width*this.height;this.validPixelCount=t}clamp(e){if(!e||e==="f64"||e==="f32"||!this.pixels)return;let t;switch(e){case"u8":t=[0,255];break;case"u16":t=[0,65535];break;case"u32":t=[0,4294967295];break;case"s8":t=[-128,127];break;case"s16":t=[-32768,32767];break;case"s32":t=[-2147483648,2147483647];break;default:t=[-34e38,34e38]}const[r,c]=t,a=this.pixels,i=this.width*this.height,h=a.length;let o,n,l;const s=[];for(let f=0;f<h;f++){l=Se.createEmptyBand(e,i),o=a[f];for(let p=0;p<i;p++)n=o[p],l[p]=n>c?c:n<r?r:n;s.push(l)}this.pixels=s,this.pixelType=e}extractBands(e){const{pixels:t,statistics:r}=this;if(we(e)||e.length===0||!t||t.length===0)return this;const c=t.length,a=e.some(h=>h>=t.length),i=c===e.length&&!e.some((h,o)=>h!==o);return a||i?this:new Se({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:e.map(h=>t[h]),statistics:r&&e.map(h=>r[h])})}clone(){const e=new Se({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});let t;z(this.mask)&&(this.mask instanceof Uint8Array?e.mask=new Uint8Array(this.mask):e.mask=this.mask.slice(0));const r=Se.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){e.pixels=[];const c=!!this.pixels[0].slice;for(t=0;t<this.pixels.length;t++)e.pixels[t]=c?this.pixels[t].slice(0,this.pixels[t].length):new r(this.pixels[t])}if(this.statistics)for(e.statistics=[],t=0;t<this.statistics.length;t++)e.statistics[t]=re(this.statistics[t]);return e}_fillFrom8Bit(e){const{mask:t,maskIsAlpha:r,pixels:c}=this;if(!e||!c||!c.length)return void ge.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let a,i,h,o;a=i=h=c[0],c.length>=3?(i=c[1],h=c[2]):c.length===2&&(i=c[1]);const n=new Uint32Array(e),l=this.width*this.height;if(a.length===l)if(z(t)&&t.length===l)if(r)for(o=0;o<l;o++)t[o]&&(n[o]=t[o]<<24|h[o]<<16|i[o]<<8|a[o]);else for(o=0;o<l;o++)t[o]&&(n[o]=255<<24|h[o]<<16|i[o]<<8|a[o]);else for(o=0;o<l;o++)n[o]=255<<24|h[o]<<16|i[o]<<8|a[o];else ge.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(e){const{pixels:t,mask:r,statistics:c}=this;if(!e||!t||!t.length)return void ge.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");const a=this.pixelType;let i=1,h=0,o=1;if(c&&c.length>0){for(const d of c)if(d.minValue!=null&&(h=Math.min(h,d.minValue)),d.maxValue!=null&&d.minValue!=null){const g=d.maxValue-d.minValue;o=Math.max(o,g)}i=255/o}else{let d=255;a==="s8"?(h=-128,d=127):a==="u16"?d=65535:a==="s16"?(h=-32768,d=32767):a==="u32"?d=4294967295:a==="s32"?(h=-2147483648,d=2147483647):a==="f32"?(h=-34e38,d=34e38):a==="f64"&&(h=-Number.MAX_VALUE,d=Number.MAX_VALUE),i=255/(d-h)}const n=new Uint32Array(e),l=this.width*this.height;let s,f,p,u,w;if(s=f=p=t[0],s.length!==l)return ge.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(t.length>=2)if(f=t[1],t.length>=3&&(p=t[2]),z(r)&&r.length===l)for(u=0;u<l;u++)r[u]&&(n[u]=255<<24|(p[u]-h)*i<<16|(f[u]-h)*i<<8|(s[u]-h)*i);else for(u=0;u<l;u++)n[u]=255<<24|(p[u]-h)*i<<16|(f[u]-h)*i<<8|(s[u]-h)*i;else if(z(r)&&r.length===l)for(u=0;u<l;u++)w=(s[u]-h)*i,r[u]&&(n[u]=255<<24|w<<16|w<<8|w);else for(u=0;u<l;u++)w=(s[u]-h)*i,n[u]=255<<24|w<<16|w<<8|w}_fillFrom32Bit(e){const{pixels:t,mask:r}=this;if(!e||!t||!t.length)return ge.getLogger(this.declaredClass).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let c,a,i,h;c=a=i=t[0],t.length>=3?(a=t[1],i=t[2]):t.length===2&&(a=t[1]);const o=this.width*this.height;if(c.length!==o)return ge.getLogger(this.declaredClass).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let n=0;if(z(r)&&r.length===o)for(h=0;h<o;h++)e[n++]=c[h],e[n++]=a[h],e[n++]=i[h],e[n++]=1&r[h];else for(h=0;h<o;h++)e[n++]=c[h],e[n++]=a[h],e[n++]=i[h],e[n++]=1}_calculateBandStatistics(e,t){let r=1/0,c=-1/0;const a=e.length;let i,h=0;if(z(t))for(i=0;i<a;i++)t[i]&&(h=e[i],r=h<r?h:r,c=h>c?h:c);else for(i=0;i<a;i++)h=e[i],r=h<r?h:r,c=h>c?h:c;return new bt(r,c)}};$([j({json:{write:!0}})],ce.prototype,"width",void 0),$([j({json:{write:!0}})],ce.prototype,"height",void 0),$([j({json:{write:!0}})],ce.prototype,"pixelType",void 0),$([fr("pixelType")],ce.prototype,"castPixelType",null),$([j({json:{write:!0}})],ce.prototype,"validPixelCount",void 0),$([j({json:{write:!0}})],ce.prototype,"mask",void 0),$([j({json:{write:!0}})],ce.prototype,"maskIsAlpha",void 0),$([j({json:{write:!0}})],ce.prototype,"pixels",void 0),$([j({json:{write:!0}})],ce.prototype,"statistics",void 0),ce=Se=$([He("esri.layers.support.PixelBlock")],ce);const K=ce;var Xe,Tt,kt,Jt={exports:{}};Tt=Jt,Xe=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(t){var r=this.buffer,c=r?r.byteLength:0;if(t<c)return r;for(var a=512;a<t;)a<<=1;for(var i=new Uint8Array(a),h=0;h<c;++h)i[h]=r[h];return this.buffer=i},getByte:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(t){var r=this.pos;if(t){this.ensureBuffer(r+t);for(var c=r+t;!this.eof&&this.bufferLength<c;)this.readBlock();var a=this.bufferLength;c>a&&(c=a)}else{for(;!this.eof;)this.readBlock();c=this.bufferLength}return this.pos=c,this.buffer.subarray(r,c)},lookChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(t,r,c){for(var a=t+r;this.bufferLength<=a&&!this.eof;)this.readBlock();return new Stream(this.buffer,t,r,c)},skip:function(t){t||(t=1),this.pos+=t},reset:function(){this.pos=0}},e}(),(kt=function(){if(!self||!self.Uint32Array)return null;var e=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),t=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),c=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];function i(o){throw new Error(o)}function h(o){var n=0,l=o[n++],s=o[n++];l!=-1&&s!=-1||i("Invalid header in flate stream"),(15&l)!=8&&i("Unknown compression method in flate stream"),((l<<8)+s)%31!=0&&i("Bad FCHECK in flate stream"),32&s&&i("FDICT bit set in flate stream"),this.bytes=o,this.bytesPos=n,this.codeSize=0,this.codeBuf=0,Xe.call(this)}return h.prototype=Object.create(Xe.prototype),h.prototype.getBits=function(o){for(var n,l=this.codeSize,s=this.codeBuf,f=this.bytes,p=this.bytesPos;l<o;)(n=f[p++])===void 0&&i("Bad encoding in flate stream"),s|=n<<l,l+=8;return n=s&(1<<o)-1,this.codeBuf=s>>o,this.codeSize=l-=o,this.bytesPos=p,n},h.prototype.getCode=function(o){for(var n=o[0],l=o[1],s=this.codeSize,f=this.codeBuf,p=this.bytes,u=this.bytesPos;s<l;){var w;(w=p[u++])===void 0&&i("Bad encoding in flate stream"),f|=w<<s,s+=8}var d=n[f&(1<<l)-1],g=d>>16,y=65535&d;return(s==0||s<g||g==0)&&i("Bad encoding in flate stream"),this.codeBuf=f>>g,this.codeSize=s-g,this.bytesPos=u,y},h.prototype.generateHuffmanTable=function(o){for(var n=o.length,l=0,s=0;s<n;++s)o[s]>l&&(l=o[s]);for(var f=1<<l,p=new Uint32Array(f),u=1,w=0,d=2;u<=l;++u,w<<=1,d<<=1)for(var g=0;g<n;++g)if(o[g]==u){var y=0,m=w;for(s=0;s<u;++s)y=y<<1|1&m,m>>=1;for(s=y;s<f;s+=d)p[s]=u<<16|g;++w}return[p,l]},h.prototype.readBlock=function(){function o(U,O,_,F,V){for(var Q=U.getBits(_)+F;Q-- >0;)O[d++]=V}var n=this.getBits(3);if(1&n&&(this.eof=!0),(n>>=1)!=0){var l,s;if(n==1)l=c,s=a;else if(n==2){for(var f=this.getBits(5)+257,p=this.getBits(5)+1,u=this.getBits(4)+4,w=Array(e.length),d=0;d<u;)w[e[d++]]=this.getBits(3);for(var g=this.generateHuffmanTable(w),y=0,m=(d=0,f+p),C=new Array(m);d<m;){var b=this.getCode(g);b==16?o(this,C,2,3,y):b==17?o(this,C,3,3,y=0):b==18?o(this,C,7,11,y=0):C[d++]=y=b}l=this.generateHuffmanTable(C.slice(0,f)),s=this.generateHuffmanTable(C.slice(f,m))}else i("Unknown block type in flate stream");for(var x=(L=this.buffer)?L.length:0,k=this.bufferLength;;){var T=this.getCode(l);if(T<256)k+1>=x&&(x=(L=this.ensureBuffer(k+1)).length),L[k++]=T;else{if(T==256)return void(this.bufferLength=k);var A=(T=t[T-=257])>>16;A>0&&(A=this.getBits(A)),y=(65535&T)+A,T=this.getCode(s),(A=(T=r[T])>>16)>0&&(A=this.getBits(A));var v=(65535&T)+A;k+y>=x&&(x=(L=this.ensureBuffer(k+y)).length);for(var M=0;M<y;++M,++k)L[k]=L[k-v]}}}else{var D,R=this.bytes,E=this.bytesPos;(D=R[E++])===void 0&&i("Bad block header in flate stream");var P=D;(D=R[E++])===void 0&&i("Bad block header in flate stream"),P|=D<<8,(D=R[E++])===void 0&&i("Bad block header in flate stream");var S=D;(D=R[E++])===void 0&&i("Bad block header in flate stream"),(S|=D<<8)!=(65535&~P)&&i("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var I=this.bufferLength,L=this.ensureBuffer(I+P),B=I+P;this.bufferLength=B;for(var N=I;N<B;++N){if((D=R[E++])===void 0){this.eof=!0;break}L[N]=D}this.bytesPos=E}},h}())!==void 0&&(Tt.exports=kt);const Pe=Jt.exports;class ht{constructor(t){this._canvas=null,this._ctx=null,t&&(this._canvas=t.canvas,this._ctx=t.ctx||t.canvas&&t.canvas.getContext("2d"))}decode(t,r,c){if(!t||t.byteLength<10)throw new ye("imagecanvasdecoder: decode","required a valid encoded data as input.");let{width:a=0,height:i=0,format:h}=r;const{applyJpegMask:o}=r;if(o&&(!a||!i))throw new ye("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return new Promise((n,l)=>{let s=null;h==="jpg"&&o&&(s=ht._getMask(t,{width:a,height:i}));const f=new Blob([new Uint8Array(t)],{type:"image/"+h=="jpg"?"jpeg":h}),p=URL.createObjectURL(f),u=new Image;let w;u.src=p,u.onload=()=>{if(URL.revokeObjectURL(p),pr(c))return void l(dr());a=u.width,i=u.height,this._canvas&&this._ctx?(this._canvas.width===a&&this._canvas.height===i||(this._canvas.width=a,this._canvas.height=i),this._ctx.clearRect(0,0,a,i)):(this._canvas=document.createElement("canvas"),this._canvas.width=a,this._canvas.height=i,this._ctx=this._canvas.getContext("2d")),this._ctx.drawImage(u,0,0);const d=this._ctx.getImageData(0,0,a,i);let g;if(w=d.data,r.renderOnCanvas){if(s)for(g=0;g<s.length;g++)s[g]?w[4*g+3]=255:w[4*g+3]=0;return this._ctx.putImageData(d,0,0),void n(null)}const y=a*i,m=new Uint8Array(y),C=new Uint8Array(y),b=new Uint8Array(y);if(s)for(g=0;g<y;g++)m[g]=w[4*g],C[g]=w[4*g+1],b[g]=w[4*g+2];else for(s=new Uint8Array(y),g=0;g<y;g++)m[g]=w[4*g],C[g]=w[4*g+1],b[g]=w[4*g+2],s[g]=w[4*g+3];n({width:a,height:i,pixels:[m,C,b],mask:s,pixelType:"u8"})},u.onerror=()=>{URL.revokeObjectURL(p),l("cannot load image")}})}static _getMask(t,r){let c=null;try{const a=new Uint8Array(t),i=Math.ceil(a.length/2);let h=0;const o=a.length-2;for(h=i;h<o&&(a[h]!==255||a[h+1]!==217);h++);if(h+=2,h<a.length-1){const n=new Pe(a.subarray(h)).getBytes();c=new Uint8Array(r.width*r.height);let l=0;for(let s=0;s<n.length;s++)for(let f=7;f>=0;f--)c[l++]=n[s]>>f&1}}catch{}return c}}var vt,St,At,Ht={exports:{}};vt=Ht,St=function(){var e=function(){function t(r){this.message="JPEG error: "+r}return t.prototype=new Error,t.prototype.name="JpegError",t.constructor=t,t}();return function(){if(!self||!self.Uint8ClampedArray)return null;var t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,c=799,a=3406,i=2276,h=1567,o=3784,n=5793,l=2896;function s(){this.decodeTransform=null,this.colorTransform=-1}function f(y,m){for(var C,b,x=0,k=[],T=16;T>0&&!y[T-1];)T--;k.push({children:[],index:0});var A,v=k[0];for(C=0;C<T;C++){for(b=0;b<y[C];b++){for((v=k.pop()).children[v.index]=m[x];v.index>0;)v=k.pop();for(v.index++,k.push(v);k.length<=C;)k.push(A={children:[],index:0}),v.children[v.index]=A.children,v=A;x++}C+1<T&&(k.push(A={children:[],index:0}),v.children[v.index]=A.children,v=A)}return k[0].children}function p(y,m,C){return 64*((y.blocksPerLine+1)*m+C)}function u(y,m,C,b,x,k,T,A,v){var M=C.mcusPerLine,D=C.progressive,R=m,E=0,P=0;function S(){if(P>0)return P--,E>>P&1;if((E=y[m++])===255){var G=y[m++];if(G)throw new e("unexpected marker "+(E<<8|G).toString(16))}return P=7,E>>>7}function I(G){for(var W=G;;){if(typeof(W=W[S()])=="number")return W;if(typeof W!="object")throw new e("invalid huffman sequence")}}function L(G){for(var W=0;G>0;)W=W<<1|S(),G--;return W}function B(G){if(G===1)return S()===1?1:-1;var W=L(G);return W>=1<<G-1?W:W+(-1<<G)+1}function N(G,W){var Y=I(G.huffmanTableDC),oe=Y===0?0:B(Y);G.blockData[W]=G.pred+=oe;for(var se=1;se<64;){var ue=I(G.huffmanTableAC),ie=15&ue,ae=ue>>4;if(ie!==0){var ur=t[se+=ae];G.blockData[W+ur]=B(ie),se++}else{if(ae<15)break;se+=16}}}function U(G,W){var Y=I(G.huffmanTableDC),oe=Y===0?0:B(Y)<<v;G.blockData[W]=G.pred+=oe}function O(G,W){G.blockData[W]|=S()<<v}var _=0;function F(G,W){if(_>0)_--;else for(var Y=k,oe=T;Y<=oe;){var se=I(G.huffmanTableAC),ue=15&se,ie=se>>4;if(ue!==0){var ae=t[Y+=ie];G.blockData[W+ae]=B(ue)*(1<<v),Y++}else{if(ie<15){_=L(ie)+(1<<ie)-1;break}Y+=16}}}var V,Q=0;function te(G,W){for(var Y,oe,se=k,ue=T,ie=0;se<=ue;){var ae=t[se];switch(Q){case 0:if(ie=(oe=I(G.huffmanTableAC))>>4,(Y=15&oe)==0)ie<15?(_=L(ie)+(1<<ie),Q=4):(ie=16,Q=1);else{if(Y!==1)throw new e("invalid ACn encoding");V=B(Y),Q=ie?2:3}continue;case 1:case 2:G.blockData[W+ae]?G.blockData[W+ae]+=S()<<v:--ie==0&&(Q=Q===2?3:0);break;case 3:G.blockData[W+ae]?G.blockData[W+ae]+=S()<<v:(G.blockData[W+ae]=V<<v,Q=0);break;case 4:G.blockData[W+ae]&&(G.blockData[W+ae]+=S()<<v)}se++}Q===4&&--_==0&&(Q=0)}function Ce(G,W,Y,oe,se){var ue=Y%M;W(G,p(G,(Y/M|0)*G.v+oe,ue*G.h+se))}function xe(G,W,Y){W(G,p(G,Y/G.blocksPerLine|0,Y%G.blocksPerLine))}var q,H,he,de,X,Ue,Te=b.length;Ue=D?k===0?A===0?U:O:A===0?F:te:N;var le,ke,Fe,Ne,me=0;for(ke=Te===1?b[0].blocksPerLine*b[0].blocksPerColumn:M*C.mcusPerColumn;me<ke;){var $e=x?Math.min(ke-me,x):ke;for(H=0;H<Te;H++)b[H].pred=0;if(_=0,Te===1)for(q=b[0],X=0;X<$e;X++)xe(q,Ue,me),me++;else for(X=0;X<$e;X++){for(H=0;H<Te;H++)for(Fe=(q=b[H]).h,Ne=q.v,he=0;he<Ne;he++)for(de=0;de<Fe;de++)Ce(q,Ue,me,he,de);me++}P=0,(le=g(y,m))&&le.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+le.invalid),m=le.offset);var ve=le&&le.marker;if(!ve||ve<=65280)throw new e("marker was not found");if(!(ve>=65488&&ve<=65495))break;m+=2}return(le=g(y,m))&&le.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+le.invalid),m=le.offset),m-R}function w(y,m,C){var b,x,k,T,A,v,M,D,R,E,P,S,I,L,B,N,U,O=y.quantizationTable,_=y.blockData;if(!O)throw new e("missing required Quantization Table.");for(var F=0;F<64;F+=8)R=_[m+F],E=_[m+F+1],P=_[m+F+2],S=_[m+F+3],I=_[m+F+4],L=_[m+F+5],B=_[m+F+6],N=_[m+F+7],R*=O[F],(E|P|S|I|L|B|N)!=0?(E*=O[F+1],P*=O[F+2],S*=O[F+3],I*=O[F+4],L*=O[F+5],B*=O[F+6],N*=O[F+7],x=(b=(b=n*R+128>>8)+(x=n*I+128>>8)+1>>1)-x,U=(k=P)*o+(T=B)*h+128>>8,k=k*h-T*o+128>>8,M=(A=(A=l*(E-N)+128>>8)+(M=L<<4)+1>>1)-M,v=(D=(D=l*(E+N)+128>>8)+(v=S<<4)+1>>1)-v,T=(b=b+(T=U)+1>>1)-T,k=(x=x+k+1>>1)-k,U=A*i+D*a+2048>>12,A=A*a-D*i+2048>>12,D=U,U=v*c+M*r+2048>>12,v=v*r-M*c+2048>>12,M=U,C[F]=b+D,C[F+7]=b-D,C[F+1]=x+M,C[F+6]=x-M,C[F+2]=k+v,C[F+5]=k-v,C[F+3]=T+A,C[F+4]=T-A):(U=n*R+512>>10,C[F]=U,C[F+1]=U,C[F+2]=U,C[F+3]=U,C[F+4]=U,C[F+5]=U,C[F+6]=U,C[F+7]=U);for(var V=0;V<8;++V)R=C[V],((E=C[V+8])|(P=C[V+16])|(S=C[V+24])|(I=C[V+32])|(L=C[V+40])|(B=C[V+48])|(N=C[V+56]))!=0?(x=(b=4112+((b=n*R+2048>>12)+(x=n*I+2048>>12)+1>>1))-x,U=(k=P)*o+(T=B)*h+2048>>12,k=k*h-T*o+2048>>12,T=U,M=(A=(A=l*(E-N)+2048>>12)+(M=L)+1>>1)-M,v=(D=(D=l*(E+N)+2048>>12)+(v=S)+1>>1)-v,U=A*i+D*a+2048>>12,A=A*a-D*i+2048>>12,D=U,U=v*c+M*r+2048>>12,v=v*r-M*c+2048>>12,R=(R=(b=b+T+1>>1)+D)<16?0:R>=4080?255:R>>4,E=(E=(x=x+k+1>>1)+(M=U))<16?0:E>=4080?255:E>>4,P=(P=(k=x-k)+v)<16?0:P>=4080?255:P>>4,S=(S=(T=b-T)+A)<16?0:S>=4080?255:S>>4,I=(I=T-A)<16?0:I>=4080?255:I>>4,L=(L=k-v)<16?0:L>=4080?255:L>>4,B=(B=x-M)<16?0:B>=4080?255:B>>4,N=(N=b-D)<16?0:N>=4080?255:N>>4,_[m+V]=R,_[m+V+8]=E,_[m+V+16]=P,_[m+V+24]=S,_[m+V+32]=I,_[m+V+40]=L,_[m+V+48]=B,_[m+V+56]=N):(U=(U=n*R+8192>>14)<-2040?0:U>=2024?255:U+2056>>4,_[m+V]=U,_[m+V+8]=U,_[m+V+16]=U,_[m+V+24]=U,_[m+V+32]=U,_[m+V+40]=U,_[m+V+48]=U,_[m+V+56]=U)}function d(y,m){for(var C=m.blocksPerLine,b=m.blocksPerColumn,x=new Int16Array(64),k=0;k<b;k++)for(var T=0;T<C;T++)w(m,p(m,k,T),x);return m.blockData}function g(y,m,C){function b(v){return y[v]<<8|y[v+1]}var x=y.length-1,k=C<m?C:m;if(m>=x)return null;var T=b(m);if(T>=65472&&T<=65534)return{invalid:null,marker:T,offset:m};for(var A=b(k);!(A>=65472&&A<=65534);){if(++k>=x)return null;A=b(k)}return{invalid:T.toString(16),marker:A,offset:k}}return s.prototype={parse:function(y){function m(){var G=y[T]<<8|y[T+1];return T+=2,G}function C(){var G=m(),W=T+G-2,Y=g(y,W,T);Y&&Y.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+Y.invalid),W=Y.offset);var oe=y.subarray(T,W);return T+=oe.length,oe}function b(G){for(var W=Math.ceil(G.samplesPerLine/8/G.maxH),Y=Math.ceil(G.scanLines/8/G.maxV),oe=0;oe<G.components.length;oe++){X=G.components[oe];var se=Math.ceil(Math.ceil(G.samplesPerLine/8)*X.h/G.maxH),ue=Math.ceil(Math.ceil(G.scanLines/8)*X.v/G.maxV),ie=W*X.h,ae=Y*X.v*64*(ie+1);X.blockData=new Int16Array(ae),X.blocksPerLine=se,X.blocksPerColumn=ue}G.mcusPerLine=W,G.mcusPerColumn=Y}var x,k,T=0,A=null,v=null,M=[],D=[],R=[],E=m();if(E!==65496)throw new e("SOI not found");for(E=m();E!==65497;){var P,S,I;switch(E){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var L=C();E===65504&&L[0]===74&&L[1]===70&&L[2]===73&&L[3]===70&&L[4]===0&&(A={version:{major:L[5],minor:L[6]},densityUnits:L[7],xDensity:L[8]<<8|L[9],yDensity:L[10]<<8|L[11],thumbWidth:L[12],thumbHeight:L[13],thumbData:L.subarray(14,14+3*L[12]*L[13])}),E===65518&&L[0]===65&&L[1]===100&&L[2]===111&&L[3]===98&&L[4]===101&&(v={version:L[5]<<8|L[6],flags0:L[7]<<8|L[8],flags1:L[9]<<8|L[10],transformCode:L[11]});break;case 65499:for(var B=m()+T-2;T<B;){var N=y[T++],U=new Uint16Array(64);if(N>>4==0)for(S=0;S<64;S++)U[t[S]]=y[T++];else{if(N>>4!=1)throw new e("DQT - invalid table spec");for(S=0;S<64;S++)U[t[S]]=m()}M[15&N]=U}break;case 65472:case 65473:case 65474:if(x)throw new e("Only single frame JPEGs supported");m(),(x={}).extended=E===65473,x.progressive=E===65474,x.precision=y[T++],x.scanLines=m(),x.samplesPerLine=m(),x.components=[],x.componentIds={};var O,_=y[T++],F=0,V=0;for(P=0;P<_;P++){O=y[T];var Q=y[T+1]>>4,te=15&y[T+1];F<Q&&(F=Q),V<te&&(V=te);var Ce=y[T+2];I=x.components.push({h:Q,v:te,quantizationId:Ce,quantizationTable:null}),x.componentIds[O]=I-1,T+=3}x.maxH=F,x.maxV=V,b(x);break;case 65476:var xe=m();for(P=2;P<xe;){var q=y[T++],H=new Uint8Array(16),he=0;for(S=0;S<16;S++,T++)he+=H[S]=y[T];var de=new Uint8Array(he);for(S=0;S<he;S++,T++)de[S]=y[T];P+=17+he,(q>>4==0?R:D)[15&q]=f(H,de)}break;case 65501:m(),k=m();break;case 65498:m();var X,Ue=y[T++],Te=[];for(P=0;P<Ue;P++){var le=x.componentIds[y[T++]];X=x.components[le];var ke=y[T++];X.huffmanTableDC=R[ke>>4],X.huffmanTableAC=D[15&ke],Te.push(X)}var Fe=y[T++],Ne=y[T++],me=y[T++],$e=u(y,T,x,Te,k,Fe,Ne,me>>4,15&me);T+=$e;break;case 65535:y[T]!==255&&T--;break;default:if(y[T-3]===255&&y[T-2]>=192&&y[T-2]<=254){T-=3;break}throw new e("unknown marker "+E.toString(16))}E=m()}for(this.width=x.samplesPerLine,this.height=x.scanLines,this.jfif=A,this.eof=T,this.adobe=v,this.components=[],P=0;P<x.components.length;P++){var ve=M[(X=x.components[P]).quantizationId];ve&&(X.quantizationTable=ve),this.components.push({output:d(x,X),scaleX:X.h/x.maxH,scaleY:X.v/x.maxV,blocksPerLine:X.blocksPerLine,blocksPerColumn:X.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(y,m){var C,b,x,k,T,A,v,M,D,R,E,P=this.width/y,S=this.height/m,I=0,L=this.components.length,B=y*m*L,N=new Uint8ClampedArray(B),U=new Uint32Array(y),O=4294967288;for(v=0;v<L;v++){for(b=(C=this.components[v]).scaleX*P,x=C.scaleY*S,I=v,E=C.output,k=C.blocksPerLine+1<<3,T=0;T<y;T++)M=0|T*b,U[T]=(M&O)<<3|7&M;for(A=0;A<m;A++)for(R=k*((M=0|A*x)&O)|(7&M)<<3,T=0;T<y;T++)N[I]=E[R+U[T]],I+=L}var _=this.decodeTransform;if(_)for(v=0;v<B;)for(M=0,D=0;M<L;M++,v++,D+=2)N[v]=(N[v]*_[D]>>8)+_[D+1];return N},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:this.numComponents===3?this.colorTransform!==0:this.colorTransform===1},_convertYccToRgb:function(y){for(var m,C,b,x=0,k=y.length;x<k;x+=3)m=y[x],C=y[x+1],b=y[x+2],y[x]=m-179.456+1.402*b,y[x+1]=m+135.459-.344*C-.714*b,y[x+2]=m-226.816+1.772*C;return y},_convertYcckToRgb:function(y){for(var m,C,b,x,k=0,T=0,A=y.length;T<A;T+=4)m=y[T],C=y[T+1],b=y[T+2],x=y[T+3],y[k++]=C*(-660635669420364e-19*C+.000437130475926232*b-54080610064599e-18*m+.00048449797120281*x-.154362151871126)-122.67195406894+b*(-.000957964378445773*b+.000817076911346625*m-.00477271405408747*x+1.53380253221734)+m*(.000961250184130688*m-.00266257332283933*x+.48357088451265)+x*(-.000336197177618394*x+.484791561490776),y[k++]=107.268039397724+C*(219927104525741e-19*C-.000640992018297945*b+.000659397001245577*m+.000426105652938837*x-.176491792462875)+b*(-.000778269941513683*b+.00130872261408275*m+.000770482631801132*x-.151051492775562)+m*(.00126935368114843*m-.00265090189010898*x+.25802910206845)+x*(-.000318913117588328*x-.213742400323665),y[k++]=C*(-.000570115196973677*C-263409051004589e-19*b+.0020741088115012*m-.00288260236853442*x+.814272968359295)-20.810012546947+b*(-153496057440975e-19*b-.000132689043961446*m+.000560833691242812*x-.195152027534049)+m*(.00174418132927582*m-.00255243321439347*x+.116935020465145)+x*(-.000343531996510555*x+.24165260232407);return y},_convertYcckToCmyk:function(y){for(var m,C,b,x=0,k=y.length;x<k;x+=4)m=y[x],C=y[x+1],b=y[x+2],y[x]=434.456-m-1.402*b,y[x+1]=119.541-m+.344*C+.714*b,y[x+2]=481.816-m-1.772*C;return y},_convertCmykToRgb:function(y){for(var m,C,b,x,k=0,T=1/255,A=0,v=y.length;A<v;A+=4)m=y[A]*T,C=y[A+1]*T,b=y[A+2]*T,x=y[A+3]*T,y[k++]=255+m*(-4.387332384609988*m+54.48615194189176*C+18.82290502165302*b+212.25662451639585*x-285.2331026137004)+C*(1.7149763477362134*C-5.6096736904047315*b-17.873870861415444*x-5.497006427196366)+b*(-2.5217340131683033*b-21.248923337353073*x+17.5119270841813)-x*(21.86122147463605*x+189.48180835922747),y[k++]=255+m*(8.841041422036149*m+60.118027045597366*C+6.871425592049007*b+31.159100130055922*x-79.2970844816548)+C*(-15.310361306967817*C+17.575251261109482*b+131.35250912493976*x-190.9453302588951)+b*(4.444339102852739*b+9.8632861493405*x-24.86741582555878)-x*(20.737325471181034*x+187.80453709719578),y[k++]=255+m*(.8842522430003296*m+8.078677503112928*C+30.89978309703729*b-.23883238689178934*x-14.183576799673286)+C*(10.49593273432072*C+63.02378494754052*b+50.606957656360734*x-112.23884253719248)+b*(.03296041114873217*b+115.60384449646641*x-193.58209356861505)-x*(22.33816807309886*x+180.12613974708367);return y},getData:function(y,m,C){if(this.numComponents>4)throw new e("Unsupported color mode");var b=this._getLinearizedBlockData(y,m);if(this.numComponents===1&&C){for(var x=b.length,k=new Uint8ClampedArray(3*x),T=0,A=0;A<x;A++){var v=b[A];k[T++]=v,k[T++]=v,k[T++]=v}return k}if(this.numComponents===3&&this._isColorConversionNeeded())return this._convertYccToRgb(b);if(this.numComponents===4){if(this._isColorConversionNeeded())return C?this._convertYcckToRgb(b):this._convertYcckToCmyk(b);if(C)return this._convertCmykToRgb(b)}return b}},s}()},(At=St())!==void 0&&(vt.exports=At);const Ke=Ht.exports;class Tr{static decode(t,r=!1){const c=new Uint8Array(t),a=new Ke;a.parse(c);const{width:i,height:h,numComponents:o,eof:n}=a,l=a.getData(i,h,!0),s=i*h;let f,p=null,u=0,w=0,d=0;if(!r&&n<c.length-1)try{const g=new Pe(c.subarray(n)).getBytes();p=new Uint8Array(s);let y=0;for(u=0;u<g.length;u++)for(d=7;d>=0;d--)p[y++]=g[u]>>d&1}catch{}if(o===1&&l.length===i*h)f=[l,l,l];else{for(f=[],u=0;u<3;u++)f.push(new Uint8Array(s));for(d=0,w=0;w<s;w++)for(u=0;u<3;u++)f[u][w]=l[d++]}return{width:i,height:h,pixels:f,mask:p}}}const Yt=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,128]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let Ze=null;function qt(){return Ze||(Ze=mr(()=>import("./lerc-wasm.8ece762d.js"),[]).then(e=>e.l).then(({default:e})=>e({locateFile:t=>gr(`esri/layers/support/rasterFormats/${t}`)})).then(e=>{vr(e)}),Ze)}const Je={getBlobInfo:null,decode:null};function kr(e){return 16+(e>>3<<3)}function be(e,t,r){r.set(e.slice(t,t+r.length))}function vr(e){const{_malloc:t,_free:r,_lerc_getBlobInfo:c,_lerc_getDataRanges:a,_lerc_decode_4D:i,asm:h}=e;let o;const n=Object.values(h).find(s=>s&&"buffer"in s&&s.buffer===e.HEAPU8.buffer),l=s=>{const f=s.map(d=>kr(d)),p=f.reduce((d,g)=>d+g),u=t(p);o=new Uint8Array(n.buffer);let w=f[0];f[0]=u;for(let d=1;d<f.length;d++){const g=f[d];f[d]=f[d-1]+w,w=g}return f};Je.getBlobInfo=s=>{const u=new Uint8Array(48),w=new Uint8Array(8*3),[d,g,y]=l([s.length,u.length,w.length]);o.set(s,d),o.set(u,g),o.set(w,y);let m=c(d,s.length,g,y,12,3);if(m)throw r(d),`lerc-getBlobInfo: error code is ${m}`;o=new Uint8Array(n.buffer),be(o,g,u),be(o,y,w);const C=new Uint32Array(u.buffer),b=new Float64Array(w.buffer),[x,k,,T,A,v,M,D,R,E,P]=C,S={version:x,depthCount:E,width:T,height:A,validPixelCount:M,bandCount:v,blobSize:D,maskCount:R,dataType:k,minValue:b[0],maxValue:b[1],maxZerror:b[2],statistics:[],bandCountWithNoData:P};if(P)return S;if(E===1&&v===1)return r(d),S.statistics.push({minValue:b[0],maxValue:b[1]}),S;const I=E*v*8,L=new Uint8Array(I),B=new Uint8Array(I);let N=d,U=0,O=0,_=!1;if(o.byteLength<d+2*I?(r(d),_=!0,[N,U,O]=l([s.length,I,I]),o.set(s,N)):[U,O]=l([I,I]),o.set(L,U),o.set(B,O),m=a(N,s.length,E,v,U,O),m)throw r(N),_||r(U),`lerc-getDataRanges: error code is ${m}`;o=new Uint8Array(n.buffer),be(o,U,L),be(o,O,B);const F=new Float64Array(L.buffer),V=new Float64Array(B.buffer),Q=S.statistics;for(let te=0;te<v;te++)if(E>1){const Ce=F.slice(te*E,(te+1)*E),xe=V.slice(te*E,(te+1)*E),q=Math.min.apply(null,Ce),H=Math.max.apply(null,xe);Q.push({minValue:q,maxValue:H,depthStats:{minValues:Ce,maxValues:xe}})}else Q.push({minValue:F[te],maxValue:V[te]});return r(N),_||r(U),S},Je.decode=(s,f)=>{const{maskCount:p,depthCount:u,bandCount:w,width:d,height:g,dataType:y,bandCountWithNoData:m}=f,C=Yt[y],b=d*g,x=new Uint8Array(b*w),k=b*u*w*C.size,T=new Uint8Array(k),A=new Uint8Array(w),v=new Uint8Array(8*w),[M,D,R,E,P]=l([s.length,x.length,T.length,A.length,v.length]);o.set(s,M),o.set(x,D),o.set(T,R),o.set(A,E),o.set(v,P);const S=i(M,s.length,p,D,u,d,g,w,y,R,E,P);if(S)throw r(M),`lerc-decode: error code is ${S}`;o=new Uint8Array(n.buffer),be(o,R,T),be(o,D,x);let I=null;if(m){be(o,E,A),be(o,P,v),I=[];const L=new Float64Array(v.buffer);for(let B=0;B<A.length;B++)I.push(A[B]?L[B]:null)}return r(M),{data:T,maskData:x,noDataValues:I}}}function Sr(e,t,r,c,a){if(r<2)return e;const i=new c(t*r);if(a)for(let h=0,o=0;h<t;h++)for(let n=0,l=h;n<r;n++,l+=t)i[l]=e[o++];else for(let h=0,o=0;h<t;h++)for(let n=0,l=h;n<r;n++,l+=t)i[o++]=e[l];return i}function Xt(e,t={}){var v;const r=(v=t.inputOffset)!=null?v:0,c=e instanceof Uint8Array?e.subarray(r):new Uint8Array(e,r),a=Je.getBlobInfo(c),{data:i,maskData:h}=Je.decode(c,a),{width:o,height:n,bandCount:l,depthCount:s,dataType:f,maskCount:p,statistics:u}=a,w=Yt[f],d=new w.ctor(i.buffer),g=[],y=[],m=o*n,C=m*s;for(let M=0;M<l;M++){const D=d.subarray(M*C,(M+1)*C);if(t.returnInterleaved)g.push(D);else{const R=Sr(D,m,s,w.ctor,!0);g.push(R)}y.push(h.subarray(M*C,(M+1)*C))}const b=p===0?null:p===1?y[0]:new Uint8Array(m);if(p>1){b.set(y[0]);for(let M=1;M<y.length;M++){const D=y[M];for(let R=0;R<m;R++)b[R]=b[R]&D[R]}}const{noDataValue:x}=t,k=x!=null&&w.range[0]<=x&&w.range[1]>=x;if(p>0&&k)for(let M=0;M<l;M++){const D=g[M],R=y[M]||b;for(let E=0;E<m;E++)R[E]===0&&(D[E]=x)}const T=p===l&&l>1?y:null,{pixelType:A}=w;return{width:o,height:n,bandCount:l,pixelType:A,depthCount:s,statistics:u,pixels:g,mask:b,bandMasks:T}}function Ar(e,t,r,c=!0){if(t%4!=0||r%4!=0){const a=new ArrayBuffer(4*Math.ceil(r/4)),i=new Uint8Array(a),h=new Uint8Array(e,t,r);if(c)for(let o=0;o<i.length;o+=4)i[o]=h[o+3],i[o+1]=h[o+2],i[o+2]=h[o+1],i[o+3]=h[o];else i.set(h);return new Uint32Array(i.buffer)}if(c){const a=new Uint8Array(e,t,r),i=new Uint8Array(a.length);for(let h=0;h<i.length;h+=4)i[h]=a[h+3],i[h+1]=a[h+2],i[h+2]=a[h+1],i[h+3]=a[h];return new Uint32Array(i.buffer)}return new Uint32Array(e,t,r/4)}function It(){const e=[];for(let t=0;t<=257;t++)e[t]=[t];return e}function Mt(e,t){for(let r=0;r<t.length;r++)e.push(t[r])}const Re=new Set;function ut(e,t,r,c=!0){const a=Ar(e,t,r,c);let i=9,h=It(),o=32,n=h.length,l=[],s=1,f=a[0],p=0;const u=a.length,w=8*(4*u-r),d=[];for(;f!=null;){if(o>=i)o-=i,p=f>>>32-i,f<<=i;else{p=f>>>32-o,f=a[s++];const y=i-o;o=32-y,p=(p<<y)+(f>>>o),f<<=y}if(p===257)break;if(p===256){i=9,h=It(),n=h.length,l=[];continue}const g=h[p];if(g==null){if(p>h.length)throw"data integrity issue: code does not exist on code page";l.push(l[0]),h[n++]=l.slice(),Mt(d,l)}else Mt(d,g),l.push(g[0]),l.length>1&&(h[n++]=l.slice()),l=g.slice();if(Re.has(n)&&i++,o===0&&(f=a[s++],o=32),s>u||s===u&&o<=w)break}return new Uint8Array(d)}Re.add(511),Re.add(1023),Re.add(2047),Re.add(4095),Re.add(8191);const Pt=(e,t)=>{const r=t.width*t.height,c=t.pixelType;return Math.floor(e.byteLength/(r*Zt(c)))},Zt=e=>{let t=1;switch(e){case Uint8Array:case Int8Array:t=1;break;case Uint16Array:case Int16Array:t=2;break;case Uint32Array:case Int32Array:case Float32Array:t=4;break;case Float64Array:t=8}return t},Ir=(e,t)=>{if(8*e.byteLength<t)return null;const r=new Uint8Array(e,0,Math.ceil(t/8)),c=new Uint8Array(t);let a=0,i=0,h=0,o=0;for(h=0;h<r.length-1;h++)for(i=r[h],o=7;o>=0;o--)c[a++]=i>>o&1;for(o=7;a<t-1;)i=r[r.length-1],c[a++]=i>>o&1,o--;return c};class Mr{static decode(t,r){const c=r.pixelType,a=[],i=r.width*r.height,h=Pt(t,r),{bandIds:o,format:n}=r,l=o&&o.length||Pt(t,r),s=t.byteLength-t.byteLength%(i*Zt(c)),f=new c(t,0,i*h);let p,u,w,d,g=null;if(n==="bip")for(p=0;p<l;p++){for(w=new c(i),d=o?o[p]:p,u=0;u<i;u++)w[u]=f[u*h+d];a.push(w)}else if(n==="bsq")for(p=0;p<l;p++)d=o?o[p]:p,a.push(f.subarray(d*i,(d+1)*i));return s<t.byteLength-1&&(g=Ir(t.slice(s),i)),{pixels:a,mask:g}}}function Pr(e,t){let r=0,c="",a=0,i=0;const h=e.length;for(;r<h;)i=e[r++],a=i>>4,a<8?a=1:a===15?(a=4,i=(7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++]):a===14?(a=3,i=(15&i)<<12|(63&e[r++])<<6|63&e[r++]):(a=2,i=(31&i)<<6|63&e[r++]),(i!==0||t)&&(c+=String.fromCharCode(i));return c}const ft=(()=>{const e=[];return e[254]="NEWSUBFILETYPE",e[255]="SUBFILETYPE",e[256]="IMAGEWIDTH",e[257]="IMAGELENGTH",e[258]="BITSPERSAMPLE",e[259]="COMPRESSION",e[262]="PHOTOMETRICINTERPRETATION",e[263]="THRESHHOLDING",e[264]="CELLWIDTH",e[265]="CELLLENGTH",e[266]="FILLORDER",e[269]="DOCUMENTNAME",e[270]="IMAGEDESCRIPTION",e[271]="MAKE",e[272]="MODEL",e[273]="STRIPOFFSETS",e[274]="ORIENTATION",e[277]="SAMPLESPERPIXEL",e[278]="ROWSPERSTRIP",e[279]="STRIPBYTECOUNTS",e[280]="MINSAMPLEVALUE",e[281]="MAXSAMPLEVALUE",e[282]="XRESOLUTION",e[283]="YRESOLUTION",e[284]="PLANARCONFIGURATION",e[285]="PAGENAME",e[286]="XPOSITION",e[287]="YPOSITION",e[288]="FREEOFFSETS",e[289]="FREEBYTECOUNTS",e[290]="GRAYRESPONSEUNIT",e[291]="GRAYRESPONSECURVE",e[292]="T4OPTIONS",e[293]="T6OPTIONS",e[296]="RESOLUTIONUNIT",e[297]="PAGENUMBER",e[300]="COLORRESPONSEUNIT",e[301]="TRANSFERFUNCTION",e[305]="SOFTWARE",e[306]="DATETIME",e[315]="ARTIST",e[316]="HOSTCOMPUTER",e[317]="PREDICTOR",e[318]="WHITEPOINT",e[319]="PRIMARYCHROMATICITIES",e[320]="COLORMAP",e[321]="HALFTONEHINTS",e[322]="TILEWIDTH",e[323]="TILELENGTH",e[324]="TILEOFFSETS",e[325]="TILEBYTECOUNTS",e[326]="BADFAXLINES",e[327]="CLEANFAXDATA",e[328]="CONSECUTIVEBADFAXLINES",e[330]="SUBIFD",e[332]="INKSET",e[333]="INKNAMES",e[334]="NUMBEROFINKS",e[336]="DOTRANGE",e[337]="TARGETPRINTER",e[338]="EXTRASAMPLES",e[339]="SAMPLEFORMAT",e[340]="SMINSAMPLEVALUE",e[341]="SMAXSAMPLEVALUE",e[342]="TRANSFERRANGE",e[347]="JPEGTABLES",e[512]="JPEGPROC",e[513]="JPEGIFOFFSET",e[514]="JPEGIFBYTECOUNT",e[515]="JPEGRESTARTINTERVAL",e[517]="JPEGLOSSLESSPREDICTORS",e[518]="JPEGPOINTTRANSFORM",e[519]="JPEGQTABLES",e[520]="JPEGDCTABLES",e[521]="JPEGACTABLES",e[529]="YCBCRCOEFFICIENTS",e[530]="YCBCRSUBSAMPLING",e[531]="YCBCRPOSITIONING",e[532]="REFERENCEBLACKWHITE",e[700]="XMP",e[33550]="GEOPIXELSCALE",e[33922]="GEOTIEPOINTS",e[33432]="COPYRIGHT",e[42112]="GDAL_METADATA",e[42113]="GDAL_NODATA",e[50844]="RPCCOEFFICIENT",e[34264]="GEOTRANSMATRIX",e[34735]="GEOKEYDIRECTORY",e[34736]="GEODOUBLEPARAMS",e[34737]="GEOASCIIPARAMS",e[34665]="EXIFIFD",e[34853]="GPSIFD",e[40965]="INTEROPERABILITYIFD",e})(),Dr=(()=>{const e=ft.slice();return e[36864]="ExifVersion",e[40960]="FlashpixVersion",e[40961]="ColorSpace",e[42240]="Gamma",e[37121]="ComponentsConfiguration",e[37122]="CompressedBitsPerPixel",e[40962]="PixelXDimension",e[40963]="PixelYDimension",e[37500]="MakerNote",e[37510]="UserComment",e[40964]="RelatedSoundFile",e[36867]="DateTimeOriginal",e[36868]="DateTimeDigitized",e[36880]="OffsetTime",e[36881]="OffsetTimeOriginal",e[36882]="OffsetTimeDigitized",e[37520]="SubSecTime",e[37521]="SubSecTimeOriginal",e[37522]="SubSecTimeDigitized",e[37888]="Temperature",e[37889]="Humidity",e[37890]="Pressure",e[37891]="WaterDepth",e[37892]="Acceleration",e[37893]="CameraElevationAngle",e[42016]="ImageUniqueID",e[42032]="CameraOwnerName",e[42033]="BodySerialNumber",e[42034]="LensSpecification",e[42035]="LensMake",e[42036]="LensModel",e[42037]="LensSerialNumber",e[33434]="ExposureTime",e[33437]="FNumber",e[34850]="ExposureProgram",e[34852]="SpectralSensitivity",e[34855]="PhotographicSensitivity",e[34856]="OECF",e[34864]="SensitivityType",e[34865]="StandardOutputSensitivity",e[34866]="RecommendedExposureIndex",e[34867]="ISOSpeed",e[34868]="ISOSpeedLatitudeyyy",e[34869]="ISOSpeedLatitudezzz",e[37377]="ShutterSpeedValue",e[37378]="ApertureValue",e[37379]="BrightnessValue",e[37380]="ExposureBiasValue",e[37381]="MaxApertureValue",e[37382]="SubjectDistance",e[37383]="MeteringMode",e[37384]="LightSource",e[37385]="Flash",e[37386]="FocalLength",e[37396]="SubjectArea",e[41483]="FlashEnergy",e[41484]="SpatialFrequencyResponse",e[41486]="FocalPlaneXResolution",e[41487]="FocalPlaneYResolution",e[41488]="FocalPlaneResolutionUnit",e[41492]="SubjectLocation",e[41493]="ExposureIndex",e[41495]="SensingMethod",e[41728]="FileSource",e[41729]="SceneType",e[41730]="CFAPattern",e[41985]="CustomRendered",e[41986]="ExposureMode",e[41987]="WhiteBalance",e[41988]="DigitalZoomRatio",e[41989]="FocalLengthIn35mmFilm",e[41990]="SceneCaptureType",e[41991]="GainControl",e[41992]="Contrast",e[41993]="Saturation",e[41994]="Sharpness",e[41995]="DeviceSettingDescription",e[41996]="SubjectDistanceRange",e})(),Rr=["GPSVersionID","GPSLatitudeRef","GPSLatitude","GPSLongitudeRef","GPSLongitude","GPSAltitudeRef","GPSAltitude","GPSTimeStamp","GPSSatellites","GPSStatus","GPSMeasureMode","GPSDOP","GPSSpeedRef","GPSSpeed","GPSTrackRef","GPSTrack","GPSImgDirectionRef","GPSImgDirection","GPSMapDatum","GPSDestLatitudeRef","GPSDestLatitude","GPSDestLongitudeRef","GPSDestLongitude","GPSDestBearingRef","GPSDestBearing","GPSDestDistanceRef","GPSDestDistance","GPSProcessingMethod","GPSAreaInformation","GPSDateStamp","GPSDifferential","GPSHPositioningError"],Er=(()=>{const e=[];return e[1024]="GTModelTypeGeoKey",e[1025]="GTRasterTypeGeoKey",e[1026]="GTCitationGeoKey",e[2048]="GeographicTypeGeoKey",e[2049]="GeogCitationGeoKey",e[2050]="GeogGeodeticDatumGeoKey",e[2051]="GeogPrimeMeridianGeoKey",e[2052]="GeogLinearUnitsGeoKey",e[2053]="GeogLinearUnitSizeGeoKey",e[2054]="GeogAngularUnitsGeoKey",e[2055]="GeogAngularUnitSizeGeoKey",e[2056]="GeogEllipsoidGeoKey",e[2057]="GeogSemiMajorAxisGeoKey",e[2058]="GeogSemiMinorAxisGeoKey",e[2059]="GeogInvFlatteningGeoKey",e[2061]="GeogPrimeMeridianLongGeoKey",e[2060]="GeogAzimuthUnitsGeoKey",e[3072]="ProjectedCSTypeGeoKey",e[3073]="PCSCitationGeoKey",e[3074]="ProjectionGeoKey",e[3075]="ProjCoordTransGeoKey",e[3076]="ProjLinearUnitsGeoKey",e[3077]="ProjLinearUnitSizeGeoKey",e[3078]="ProjStdParallel1GeoKey",e[3079]="ProjStdParallel2GeoKey",e[3080]="ProjNatOriginLongGeoKey",e[3081]="ProjNatOriginLatGeoKey",e[3082]="ProjFalseEastingGeoKey",e[3083]="ProjFalseNorthingGeoKey",e[3084]="ProjFalseOriginLongGeoKey",e[3085]="ProjFalseOriginLatGeoKey",e[3086]="ProjFalseOriginEastingGeoKey",e[3087]="ProjFalseOriginNorthingGeoKey",e[3088]="ProjCenterLongGeoKey",e[3090]="ProjCenterEastingGeoKey",e[3091]="ProjCenterNorthingGeoKey",e[3092]="ProjScaleAtNatOriginGeoKey",e[3093]="ProjScaleAtCenterGeoKey",e[3094]="ProjAzimuthAngleGeoKey",e[3095]="ProjStraightVertPoleLongGeoKey",e[4096]="VerticalCSTypeGeoKey",e[4097]="VerticalCitationGeoKey",e[4098]="VerticalDatumGeoKey",e[4099]="VerticalUnitsGeoKey",e})(),Lr=(e,t)=>{let r=(t||ft)[e];return r===void 0&&(r="unknown"+String(e)),r},nt=new Map;nt.set("EXIFIFD",Dr),nt.set("GPSIFD",Rr);const Ee={TIFF_TAGS:ft,ifdTags:nt,GEO_KEYS:Er,getTagName:Lr},pt=(()=>{const e=new ArrayBuffer(4),t=new Uint8Array(e);return new Uint32Array(e)[0]=1,t[0]===1})(),Dt=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],Le=4294967296,Ur=new Set([1,5,6,7,8,34712,34887]);function Qt(e,t){let r="unknown";return e===3?r=t===64?"f64":"f32":e===1?t===1?r="u1":t===2?r="u2":t===4?r="u4":t<=8?r="u8":t<=16?r="u16":t<=32&&(r="u32"):e===2&&(t<=8?r="s8":t<=16?r="s16":t<=32&&(r="s32")),r}function qe(e){let t=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f64":t=Float64Array;break;default:t=Float32Array}return t}function Br(e,t){return{x:t[0]*e.x+t[1]*e.y+t[2],y:t[3]*e.x+t[4]*e.y+t[5]}}function er(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function Me(e,t){var r;return(r=e.get(t))==null?void 0:r.values}function Qe(e,t){var r,c;return(c=(r=e.get(t))==null?void 0:r.values)==null?void 0:c[0]}function J(e,t){var r,c;return(c=(r=e.get(t))==null?void 0:r.values)==null?void 0:c[0]}function et(e,t,r,c=0,a=Ee.TIFF_TAGS,i=4){const h=i===8,o=h?gt(new DataView(e,r,8),0,t):new DataView(e,r,2).getUint16(0,t),n=4+2*i,l=h?8:2,s=l+o*n;if(r+s>e.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:s};const f=r+s+4<=e.byteLength?ze(new DataView(e,r+s,i===8?8:4),0,t,i===8):null,p=r+l,u=new Map;let w,d,g,y,m,C=0,b=0;for(let x=0;x<o;x++){d=new DataView(e,p+n*x,n),g=d.getUint16(0,t),m=d.getUint16(2,t),y=Ee.getTagName(g,a);const k=[];i===2?(C=d.getUint16(4,t),b=d.getUint16(6,t)):i===4?(C=d.getUint32(4,t),b=d.getUint32(8,t)):i===8&&(C=ze(d,4,t,!0),b=ze(d,12,t,!0),k.push(d.getUint32(12,t)),k.push(d.getUint32(16,t))),w={id:g,type:m,valueCount:C,valueOffset:b,valueOffsets:k,values:null},$r(e,t,w,c,!1,i),u.set(y,w)}return{success:!0,ifd:u,nextIFD:f,requiredBufferSize:s}}const _r=(e,t)=>Xt(e,{inputOffset:t}).pixels[0];async function st(e,t,r,c,a){var y,m;const i=pt===t,h=J(r,"BITSPERSAMPLE"),o=Qt((y=J(r,"SAMPLEFORMAT"))!=null?y:1,h),n=(m=J(r,"COMPRESSION"))!=null?m:1,l=qe(o);let s,f,p,u,w,d,g;if(n===34887)return await qt(),_r(e,c);if(n===1)g=e.slice(c,c+a),p=new Uint8Array(g);else if(n===8||n===32946)p=new Uint8Array(e,c,a),w=new Pe(p),d=w.getBytes(),g=new ArrayBuffer(d.length),p=new Uint8Array(g),p.set(d);else if(n===6){p=new Uint8Array(e,c,a);const C=new Ke;C.parse(p);const b=C.getData(C.width,C.height,!0);g=new ArrayBuffer(b.length),p=new Uint8Array(g),p.set(b)}else if(n===7){const C=r.get("JPEGTABLES").values,b=C.length-2;p=new Uint8Array(b+a-2);for(let A=0;A<b;A++)p[A]=C[A];const x=new Uint8Array(e,c+2,a-2);for(let A=0;A<x.length;A++)p[b+A]=x[A];const k=new Ke;k.parse(p);const T=k.getData(k.width,k.height,!0);g=new ArrayBuffer(T.length),p=new Uint8Array(g),p.set(T)}else n===5&&(p=ut(e,c,a,t),g=p.buffer);if(o==="u8"||o==="s8"||i)f=new l(g);else{switch(fe(p),g=new ArrayBuffer(p.length),u=new Uint8Array(g),o){case"u16":case"s16":for(s=0;s<p.length;s+=2)u[s]=p[s+1],u[s+1]=p[s];break;case"u32":case"s32":case"f32":for(s=0;s<p.length;s+=4)u[s]=p[s+3],u[s+1]=p[s+2],u[s+2]=p[s+1],u[s+3]=p[s]}f=new l(g)}return f}async function Or(e,t,r){var S;const c=Me(r,"TILEOFFSETS");if(c===void 0)return null;const a=Me(r,"TILEBYTECOUNTS"),{width:i,height:h,pixelType:o,tileWidth:n,tileHeight:l}=dt([r]),s=mt(r,t),f=t.planes,p=i*h,u=J(r,"BITSPERSAMPLE"),w=((S=J(r,"COMPRESSION"))!=null?S:1)===34887,d=qe(o),g=[];for(let I=0;I<f;I++)g.push(new d(p));let y,m,C,b,x,k,T,A,v,M,D,R,E;const P=Math.ceil(i/n);if(u%8==0){if(w&&s&&f>1){const I=Math.round(c.length/f);for(y=0;y<I;y++){k=Math.floor(y/P)*l,T=y%P*n,A=k*i+T;for(let L=0;L<f;L++){const B=y*f+L;if(a[B]!==0)for(C=await st(e,t.littleEndian,r,c[B],a[B]),M=0,v=A,R=Math.min(n,i-T),D=Math.min(l,h-k),E=g[L],b=0;b<D;b++)for(v=A+b*i,M=b*n,x=0;x<R;x++,v++,M++)E[v]=C[M]}}}else for(y=0;y<c.length;y++)if(a[y]!==0)for(k=Math.floor(y/P)*l,T=y%P*n,A=k*i+T,C=await st(e,t.littleEndian,r,c[y],a[y]),M=0,v=A,R=Math.min(n,i-T),D=Math.min(l,h-k),m=0;m<f;m++)if(E=g[m],s||w)for(b=0;b<D;b++)for(v=A+b*i,M=n*l*m+b*n,x=0;x<R;x++,v++,M++)E[v]=C[M];else for(b=0;b<D;b++)for(v=A+b*i,M=b*n*f+m,x=0;x<R;x++,v++,M+=f)E[v]=C[M]}return{width:i,height:h,pixelType:o,pixels:g}}const Gr=(e,t,r)=>{var E;const c=pt===t.littleEndian,a=Me(r,"STRIPOFFSETS");if(a===void 0)return null;const{width:i,height:h,pixelType:o}=dt([r]),n=t.planes,l=i*h,s=J(r,"BITSPERSAMPLE"),f=qe(o),p=new f(l*n),u=Me(r,"STRIPBYTECOUNTS"),w=J(r,"ROWSPERSTRIP"),d=(E=J(r,"COMPRESSION"))!=null?E:1;let g,y,m,C,b,x,k,T,A,v,M,D=w;if(s%8==0)for(g=0;g<a.length;g++){if(b=g*(w*i)*n,D=(g+1)*w>h?h-g*w:w,o==="u8"||o==="s8"||c){if(d===8||d===32946)k=new Uint8Array(e,a[g],u[g]),v=new Pe(k),M=v.getBytes(),x=new ArrayBuffer(M.length),k=new Uint8Array(x),k.set(M),k.length!==D*i*n*s/8&&console.log("strip byte counts is different than expected");else if(d===6){k=new Uint8Array(e,a[g],u[g]);const P=new Ke;P.parse(k);const S=P.getData(P.width,P.height,!0);x=new ArrayBuffer(S.length),k=new Uint8Array(x),k.set(S)}else d===5?(k=ut(e,a[g],u[g],t.littleEndian),x=k.buffer):(u[g]!==D*i*n*s/8&&console.log("strip byte counts is different than expected"),x=e.slice(a[g],a[g]+u[g]));C=new f(x)}else{switch(d===6||d===8||d===32946?(k=new Uint8Array(e,a[g],u[g]),v=new Pe(k),k=v.getBytes(),x=new ArrayBuffer(k.length),T=new Uint8Array(x),k.length!==D*i*n*s/8&&console.log("strip byte counts is different than expected")):(u[g]!==D*i*n*s/8&&console.log("strip byte counts is different than expected"),x=new ArrayBuffer(u[g]),k=new Uint8Array(e,a[g],u[g]),T=new Uint8Array(x)),o){case"u16":case"s16":for(m=0;m<k.length;m+=2)T[m]=k[m+1],T[m+1]=k[m];break;case"u32":case"s32":case"f32":for(m=0;m<k.length;m+=4)T[m]=k[m+3],T[m+1]=k[m+2],T[m+2]=k[m+1],T[m+3]=k[m]}fe(x),C=new f(x)}p.set(C,b)}const R=[];if(n===1)R.push(p);else for(g=0;g<n;g++){for(A=new f(l),y=0;y<l;y++)A[y]=p[y*n+g];R.push(A)}return{width:i,height:h,pixelType:o,pixels:R}},Fr=(e,t,r)=>{if(!(e&&e.length>0&&t&&r))return null;let c,a,i;const h=e[0].length,o=e.length,n=new Uint8Array(h);for(let l=0;l<o;l++)if(c=e[l],a=t[l],i=r[l],l===0)for(let s=0;s<h;s++)n[s]=c[s]<a||c[s]>i?0:1;else for(let s=0;s<h;s++)n[s]&&(n[s]=c[s]<a||c[s]>i?0:1);return n},Nr=e=>{if(!e)return null;const t=e.match(/<Item(.*?)Item>/gi);if(!t||t.length===0)return null;const r=new Map;let c,a,i,h,o;for(let y=0;y<t.length;y++)c=t[y],a=c.slice(6,c.indexOf(">")),h=c.indexOf("sample="),h>-1&&(o=c.slice(h+8,c.indexOf('"',h+8))),h=c.indexOf("name="),h>-1&&(a=c.slice(h+6,c.indexOf('"',h+6))),a&&(i=c.slice(c.indexOf(">")+1,c.indexOf("</Item>")).trim(),o!=null?r.has(a)?r.get(a)[o]=i:r.set(a,[i]):r.set(a,i)),o=null;const n=r.get("STATISTICS_MINIMUM"),l=r.get("STATISTICS_MAXIMUM"),s=r.get("STATISTICS_MEAN"),f=r.get("STATISTICS_STDDEV");let p=null;if(n&&l){p=[];for(let y=0;y<n.length;y++)p.push({min:parseFloat(n[y]),max:parseFloat(l[y]),avg:s&&parseFloat(s[y]),stddev:f&&parseFloat(f[y])})}const u=r.get("BandName"),w=r.get("WavelengthMin"),d=r.get("WavelengthMax");let g=null;if(u){g=[];for(let y=0;y<u.length;y++)g.push({BandName:u[y],WavelengthMin:w&&parseFloat(w[y]),WavelengthMax:d&&parseFloat(d[y])})}return{statistics:p,bandProperties:g,dataType:r.get("DataType"),rawMetadata:r}};function $r(e,t,r,c=0,a=!1,i=4){if(r.values)return!0;const h=r.type,o=r.valueCount;let n=r.valueOffset,l=[];const s=Dt[h],f=8*s,p=o*s,u=o*Dt[h]*8;let w,d;const g=i===8?64:32,y=r.valueOffsets;if(u>g&&p>(a?e.byteLength:e?e.byteLength-n+c:0))return r.offlineOffsetSize=[n,p],r.values=null,!1;if(u<=g){if(!t)if(g<=32)n>>>=32-u;else{const m=y!=null&&y.length?y[0]:n>>>0,C=y!=null&&y.length?y[1]:Math.round((n-m)/Le);u<=32?(n=m>>>32-u,y[0]=n):(n=m*2**(32-u)+(C>>>32-u),y[0]=m,y[1]=C>>>32-u)}if(o===1&&f===g)l=[n];else if(g===64){const m=y!=null&&y.length?y[0]:n>>>0,C=y!=null&&y.length?y[1]:Math.round((n-m)/Le);let b=m,x=32;for(d=1;d<=o;d++){const k=32-f*d%32;if(x<f){const T=b<<k>>>32-x,A=C<<32-x>>>32-x;b=C,l.push(T+A*2**(f-x)),x-=32-(f-x)}else l.push(b<<k>>>32-f),x-=f;x===0&&(x=32,b=C)}}else for(d=1;d<=o;d++){const m=32-f*d;l.push(n<<m>>>32-f)}}else{n-=c,a&&(n=0);for(let m=n;m<n+p;m+=s){switch(h){case 1:case 2:case 7:w=new DataView(e,m,1).getUint8(0);break;case 3:w=new DataView(e,m,2).getUint16(0,t);break;case 4:case 13:w=new DataView(e,m,4).getUint32(0,t);break;case 5:w=new DataView(e,m,4).getUint32(0,t)/new DataView(e,m+4,4).getUint32(0,t);break;case 6:w=new DataView(e,m,1).getInt8(0);break;case 8:w=new DataView(e,m,2).getInt16(0,t);break;case 9:w=new DataView(e,m,4).getInt32(0,t);break;case 10:w=new DataView(e,m,4).getInt32(0,t)/new DataView(e,m+4,4).getInt32(0,t);break;case 11:w=new DataView(e,m,4).getFloat32(0,t);break;case 12:w=new DataView(e,m,8).getFloat64(0,t);break;case 16:case 18:w=gt(new DataView(e,m,8),0,t);break;case 17:w=jr(new DataView(e,m,8),0,t);break;default:w=null}l.push(w)}}if(h===2){let m="";const C=l;for(l=[],d=0;d<C.length;d++)C[d]===0&&m!==""?(l.push(m),m=""):m+=String.fromCharCode(C[d]);m===""&&l.length!==0||l.push(m)}return r.values=l,!0}function dt(e){var B,N;const t=e[0],r=J(t,"TILEWIDTH"),c=J(t,"TILELENGTH"),a=J(t,"IMAGEWIDTH"),i=J(t,"IMAGELENGTH"),h=J(t,"BITSPERSAMPLE"),o=J(t,"SAMPLESPERPIXEL"),n=(B=J(t,"SAMPLEFORMAT"))!=null?B:1,l=Qt(n,h),s=mt(t),f=er(t,"GDAL_NODATA");let p=null;f!=null&&f.length&&(p=f.map(U=>parseFloat(U)),p.some(U=>isNaN(U))&&(p=null));const u=(N=J(t,"COMPRESSION"))!=null?N:1;let w;switch(u){case 1:w="NONE";break;case 2:case 3:case 4:case 32771:w="CCITT";break;case 5:w="LZW";break;case 6:case 7:w="JPEG";break;case 32773:w="PACKBITS";break;case 8:case 32946:w="DEFLATE";break;case 34712:w="JPEG2000";break;case 34887:w="LERC";break;default:w=String(u)}let d=!0,g="";Ur.has(u)||(d=!1,g+="unsupported tag compression "+u),n>3&&(d=!1,g+="unsupported tag sampleFormat "+n),h%8!=0&&(d=!1,g+="unsupported tag bitsPerSample "+h);const y=Qe(t,"GEOASCIIPARAMS");let m;if(y){const U=y.split("|").find(_=>_.includes("ESRI PE String = ")),O=U?U.replace("ESRI PE String = ",""):"";m=O.startsWith("COMPD_CS")||O.startsWith("PROJCS")||O.startsWith("GEOGCS")?{wkid:null,wkt:O}:null}const C=Me(t,"GEOTIEPOINTS"),b=Me(t,"GEOPIXELSCALE"),x=Me(t,"GEOTRANSMATRIX"),k=t.has("GEOKEYDIRECTORY")?t.get("GEOKEYDIRECTORY").data:null;let T,A,v=!1;if(k){v=J(k,"GTRasterTypeGeoKey")===2;const U=J(k,"GTModelTypeGeoKey");if(U===2){const O=J(k,"GeographicTypeGeoKey");O>=1024&&O<=32766&&(m={wkid:O})}else if(U===1){const O=J(k,"ProjectedCSTypeGeoKey");O>=1024&&O<=32766&&(m={wkid:O})}}if(b&&C&&C.length>=6?(T=[b[0],0,C[3]-C[0]*b[0],0,-Math.abs(b[1]),C[4]-C[1]*b[1]],v&&(T[2]-=.5*T[0]+.5*T[1],T[5]-=.5*T[3]+.5*T[4])):x&&x.length===16&&(T=v?[x[0],x[1],x[3]-.5*x[0],x[4],x[5],x[7]-.5*x[5]]:[x[0],x[1],x[3],x[4],x[5],x[7]]),T){const U=[{x:0,y:i},{x:0,y:0},{x:a,y:i},{x:a,y:0}];let O,_=Number.POSITIVE_INFINITY,F=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,Q=Number.NEGATIVE_INFINITY;for(let te=0;te<U.length;te++)O=Br(U[te],T),_=O.x>_?_:O.x,V=O.x<V?V:O.x,F=O.y>F?F:O.y,Q=O.y<Q?Q:O.y;A={xmin:_,xmax:V,ymin:F,ymax:Q,spatialReference:m}}else A={xmin:-.5,ymin:.5-i,xmax:a-.5,ymax:.5,spatialReference:m};const M=e.filter(U=>Qe(U,"NEWSUBFILETYPE")===1);let D,R,E,P,S;if(M.length>0){E=Math.round(Math.log(a/J(M[0],"IMAGEWIDTH"))/Math.LN2);const U=M[M.length-1];P=Math.round(Math.log(a/J(U,"IMAGEWIDTH"))/Math.LN2),D=J(U,"TILEWIDTH"),R=J(U,"TILELENGTH")}D=P!=null&&P>0?D||r:null,R=P!=null&&P>0?R||c:null,r&&(S=[{maxCol:Math.ceil(a/r)-1,maxRow:Math.ceil(i/c)-1,minRow:0,minCol:0}],M.forEach(U=>{S.push({maxCol:Math.ceil(J(U,"IMAGEWIDTH")/J(U,"TILEWIDTH"))-1,maxRow:Math.ceil(J(U,"IMAGELENGTH")/J(U,"TILELENGTH"))-1,minRow:0,minCol:0})}));const I=Qe(e[0],"GDAL_METADATA"),L=Nr(I);return g+=" "+tr({width:a,height:i,tileWidth:r,tileHeight:c,planes:o,ifds:e}),{width:a,height:i,tileWidth:r,tileHeight:c,planes:o,isBSQ:s,pixelType:l,compression:w,noData:p,isSupported:d,message:g,extent:A,affine:b?null:T,firstPyramidLevel:E,maximumPyramidLevel:P,pyramidBlockWidth:D,pyramidBlockHeight:R,tileBoundary:S,metadata:L}}function mt(e,t){const r=er(e,"PLANARCONFIGURATION");return r?r[0]===2:!!t&&t.isBSQ}function Vr(e){const{littleEndian:t,isBigTiff:r,firstIFDPos:c}=zr(e);let a=c;const i=[];do{const h=Wr(e,t,a,0,Ee.TIFF_TAGS,r?8:4);if(!h.success)break;i.push(h.ifd),a=h.nextIFD}while(a>0);return{...dt(i),littleEndian:t,isBigTiff:r,ifds:i}}function gt(e,t,r){const c=e.getUint32(t,r),a=e.getUint32(t+4,r);return r?a*Le+c:c*Le+a}function jr(e,t,r){let c=r?e.getInt32(t,r):e.getUint32(t,r),a=r?e.getUint32(t+4,r):e.getInt32(t+4,r);const i=(r?c:a)>=0?1:-1;return r?c*=i:a*=i,i*(r?a*Le+c:c*Le+a)}function ze(e,t,r,c){return c?gt(e,t,r):e.getUint32(t,r)}function zr(e){const t=new DataView(e,0,16),r=t.getUint16(0,!1);let c=null;if(r===18761)c=!0;else{if(r!==19789)throw"unexpected endianess byte";c=!1}const a=t.getUint16(2,c);if(a!==42&&a!==43)throw"unexpected tiff identifier";let i=4;const h=a===43;if(h){const o=t.getUint16(i,c);if(i+=2,o!==8||t.getUint16(i,c)!==0)throw"unsupported bigtiff version";i+=2}return{littleEndian:c,isBigTiff:h,firstIFDPos:ze(t,i,c,h)}}function Wr(e,t,r,c=0,a=Ee.TIFF_TAGS,i=4){const h=et(e,t,r,c,a,i);let o;const n=h.ifd;if(n){if(Ee.ifdTags.forEach((l,s)=>{n.has(s)&&(o=n.get(s),o.data=et(e,t,o.valueOffset-c,c,l).ifd)}),n.has("GEOKEYDIRECTORY")){o=n.get("GEOKEYDIRECTORY");const l=o.values;if(l&&l.length>4){const s=l[0]+"."+l[1]+"."+l[2];o.data=et(e,t,o.valueOffset+6-c,c,Ee.GEO_KEYS,2).ifd,o.data&&o.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[s]})}}if(n.has("XMP")){o=n.get("XMP");const l=o.values;typeof l[0]=="number"&&o.type===7&&(o.values=[Pr(new Uint8Array(l))])}}return h}function tr(e){const{width:t,height:r,tileHeight:c,tileWidth:a}=e,i=e.planes,h=a?a*c:t*r,o=J(e.ifds[0],"BITSPERSAMPLE");let n="";return h*i>2**30/(o>8?o/8:1)&&(n=a?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),n}async function Kr(e,t){var v;const{headerInfo:r,ifd:c,offsets:a,sizes:i}=t,h=[];for(let M=0;M<a.length;M++){const D=await st(e,r.littleEndian,c,a[M],i[M]||e.byteLength);h.push(D)}const o=mt(c,r),{pixelType:n,planes:l}=r,s=qe(n),f=J(c,"TILEWIDTH"),p=J(c,"TILELENGTH"),u=(v=J(c,"COMPRESSION"))!=null?v:1,w=f*p;let d;const g=[];let y=h[0];const m=u===34887;for(let M=0;M<l;M++){if(d=new s(w),o&&m){if(y=h[M],y.length)for(let D=0;D<w;D++)d[D]=y[M][D+M]}else if(y.length)if(o||m&&!o)d=y.slice(w*M,w*(M+1));else for(let D=0;D<w;D++)d[D]=y[D*l+M];g.push(d)}const C=r.noData?r.noData[0]:t.noDataValue,b=r.metadata?r.metadata.statistics:null,x=b?b.map(M=>M.min):null,k=b?b.map(M=>M.max):null;let T,A=null;if(C!=null)if(A=new Uint8Array(w),Math.abs(C)>1e24)for(T=0;T<w;T++)Math.abs((g[0][T]-C)/C)<1e-6?A[T]=0:A[T]=1;else for(T=0;T<w;T++)g[0][T]===C?A[T]=0:A[T]=1;else x&&k&&t.applyMinMaxConstraint&&(A=Fr(g,x,k));return{pixelType:n,width:f,height:p,pixels:g,mask:A,noDataValue:C}}async function Jr(e,t={}){const r=t.pyramidLevel||0,c=t.headerInfo||Vr(e),{ifds:a,noData:i}=c;if(a.length===0)throw"no valid image file directory";const h=tr(c);if(h)throw h;let o,n=null;const l=r===-1?a[a.length-1]:a[r],s=i?i[0]:t.noDataValue;if(n=c.tileWidth?await Or(e,c,l):await Gr(e,c,l),s!=null){if(fe(n),n.mask=new Uint8Array(n.width*n.height),Math.abs(s)>1e24)for(o=0;o<n.width*n.height;o++)Math.abs((n.pixels[0][o]-s)/s)<1e-6?n.mask[o]=0:n.mask[o]=1;else for(o=0;o<n.width*n.height;o++)n.pixels[0][o]===s?n.mask[o]=0:n.mask[o]=1;n.noDataValue=s}return n}var Hr=function(e){var t,r,c,a,i,h;function o(n){var l,s,f,p,u,w,d,g,y,m,C,b,x;for(this.data=n,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},u=null;;){switch(l=this.readUInt32(),g=function(){var k,T;for(T=[],k=0;k<4;++k)T.push(String.fromCharCode(this.data[this.pos++]));return T}.call(this).join(""),g){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(l);break;case"fcTL":u&&this.animation.frames.push(u),this.pos+=4,u={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},p=this.readUInt16(),f=this.readUInt16()||100,u.delay=1e3*p/f,u.disposeOp=this.data[this.pos++],u.blendOp=this.data[this.pos++],u.data=[];break;case"IDAT":case"fdAT":for(g==="fdAT"&&(this.pos+=4,l-=4),n=(u!=null?u.data:void 0)||this.imgData,C=0;0<=l?C<l:C>l;0<=l?++C:--C)n.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(l),(y=255-this.transparency.indexed.length)>0)for(b=0;0<=y?b<y:b>y;0<=y?++b:--b)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(l)[0];break;case 2:this.transparency.rgb=this.read(l)}break;case"tEXt":w=(m=this.read(l)).indexOf(0),d=String.fromCharCode.apply(String,m.slice(0,w)),this.text[d]=String.fromCharCode.apply(String,m.slice(w+1));break;case"IEND":return u&&this.animation.frames.push(u),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(x=this.colorType)===4||x===6,s=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*s,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=l}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}return o.load=function(n,l,s){var f;return typeof l=="function"&&(s=l),(f=new XMLHttpRequest).open("GET",n,!0),f.responseType="arraybuffer",f.onload=function(){var p;return p=new o(new Uint8Array(f.response||f.mozResponseArrayBuffer)),typeof(l!=null?l.getContext:void 0)=="function"&&p.render(l),typeof s=="function"?s(p):void 0},f.send(null)},r=1,c=2,t=0,o.prototype.read=function(n){var l,s;for(s=[],l=0;0<=n?l<n:l>n;0<=n?++l:--l)s.push(this.data[this.pos++]);return s},o.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},o.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},o.prototype.decodePixels=function(n){var l,s,f,p,u,w,d,g,y,m,C,b,x,k,T,A,v,M,D,R,E,P,S;if(n==null&&(n=this.imgData),n.length===0)return new Uint8Array(0);for(n=(n=new Pe(n)).getBytes(),A=(b=this.pixelBitlength/8)*this.width,x=new Uint8Array(A*this.height),w=n.length,T=0,k=0,s=0;k<w;){switch(n[k++]){case 0:for(p=D=0;D<A;p=D+=1)x[s++]=n[k++];break;case 1:for(p=R=0;R<A;p=R+=1)l=n[k++],u=p<b?0:x[s-b],x[s++]=(l+u)%256;break;case 2:for(p=E=0;E<A;p=E+=1)l=n[k++],f=(p-p%b)/b,v=T&&x[(T-1)*A+f*b+p%b],x[s++]=(v+l)%256;break;case 3:for(p=P=0;P<A;p=P+=1)l=n[k++],f=(p-p%b)/b,u=p<b?0:x[s-b],v=T&&x[(T-1)*A+f*b+p%b],x[s++]=(l+Math.floor((u+v)/2))%256;break;case 4:for(p=S=0;S<A;p=S+=1)l=n[k++],f=(p-p%b)/b,u=p<b?0:x[s-b],T===0?v=M=0:(v=x[(T-1)*A+f*b+p%b],M=f&&x[(T-1)*A+(f-1)*b+p%b]),d=u+v-M,g=Math.abs(d-u),m=Math.abs(d-v),C=Math.abs(d-M),y=g<=m&&g<=C?u:m<=C?v:M,x[s++]=(l+y)%256;break;default:throw new Error("Invalid filter algorithm: "+n[k-1])}T++}return x},o.prototype.decodePalette=function(){var n,l,s,f,p,u,w,d,g;for(s=this.palette,u=this.transparency.indexed||[],p=new Uint8Array((u.length||0)+s.length),f=0,s.length,n=0,l=w=0,d=s.length;w<d;l=w+=3)p[f++]=s[l],p[f++]=s[l+1],p[f++]=s[l+2],p[f++]=(g=u[n++])!=null?g:255;return p},o.prototype.copyToImageData=function(n,l){var s,f,p,u,w,d,g,y,m,C,b;if(f=this.colors,m=null,s=this.hasAlphaChannel,this.palette.length&&(m=(b=this._decodedPalette)!=null?b:this._decodedPalette=this.decodePalette(),f=4,s=!0),y=(p=n.data||n).length,w=m||l,u=d=0,f===1)for(;u<y;)g=m?4*l[u/4]:d,C=w[g++],p[u++]=C,p[u++]=C,p[u++]=C,p[u++]=s?w[g++]:this.transparency.grayscale&&this.transparency.grayscale===C?0:255,d=g;else for(;u<y;)g=m?4*l[u/4]:d,p[u++]=w[g++],p[u++]=w[g++],p[u++]=w[g++],p[u++]=s?w[g++]:this.transparency.rgb&&this.transparency.rgb[1]===w[g-3]&&this.transparency.rgb[3]===w[g-2]&&this.transparency.rgb[5]===w[g-1]?0:255,d=g},o.prototype.decode=function(){var n;return n=new Uint8Array(this.width*this.height*4),this.copyToImageData(n,this.decodePixels()),n},i=e.document&&e.document.createElement("canvas"),h=i&&i.getContext("2d"),a=function(n){var l;return h.width=n.width,h.height=n.height,h.clearRect(0,0,n.width,n.height),h.putImageData(n,0,0),(l=new Image).src=i.toDataURL(),l},o.prototype.decodeFrames=function(n){var l,s,f,p,u,w,d,g;if(this.animation){for(g=[],s=u=0,w=(d=this.animation.frames).length;u<w;s=++u)l=d[s],f=n.createImageData(l.width,l.height),p=this.decodePixels(new Uint8Array(l.data)),this.copyToImageData(f,p),l.imageData=f,g.push(l.image=a(f));return g}},o.prototype.renderFrame=function(n,l){var s,f,p;return s=(f=this.animation.frames)[l],p=f[l-1],l===0&&n.clearRect(0,0,this.width,this.height),(p!=null?p.disposeOp:void 0)===r?n.clearRect(p.xOffset,p.yOffset,p.width,p.height):(p!=null?p.disposeOp:void 0)===c&&n.putImageData(p.imageData,p.xOffset,p.yOffset),s.blendOp===t&&n.clearRect(s.xOffset,s.yOffset,s.width,s.height),n.drawImage(s.image,s.xOffset,s.yOffset)},o.prototype.animate=function(n){var l,s,f,p,u,w,d=this;return s=0,w=this.animation,p=w.numFrames,f=w.frames,u=w.numPlays,(l=function(){var g,y;if(g=s++%p,y=f[g],d.renderFrame(n,g),p>1&&s/p<u)return d.animation._timeout=setTimeout(l,y.delay)})()},o.prototype.stopAnimation=function(){var n;return clearTimeout((n=this.animation)!=null?n._timeout:void 0)},o.prototype.render=function(n){var l,s;return n._png&&n._png.stopAnimation(),n._png=this,n.width=this.width,n.height=this.height,l=n.getContext("2d"),this.animation?(this.decodeFrames(l),this.animate(l)):(s=l.createImageData(this.width,this.height),this.copyToImageData(s,this.decodePixels()),l.putImageData(s,0,0))},o}(self);const Yr=new Set(["jpg","png","bmp","gif"]);async function qr(e,t){if(!pt)throw new ye("rasterCoded:decode","lerc decoder is not supported on big endian platform");await qt();const{offset:r,noDataValue:c}=t,{width:a,height:i,pixelType:h,statistics:o,pixels:n,mask:l}=Xt(e,{inputOffset:r,noDataValue:c,returnInterleaved:t.returnInterleaved});return new K({width:a,height:i,pixelType:h.toLowerCase(),pixels:n,mask:l,statistics:o})}async function Xr(e,t){const r=await Jr(e,t);fe(r);const c=new K({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return c.updateStatistics(),c}async function Zr(e,t){const r=await Kr(e,t.customOptions),c=new K({width:r.width,height:r.height,pixels:r.pixels,pixelType:r.pixelType.toLowerCase(),mask:r.mask,statistics:null});return c.updateStatistics(),c}function rr(e,t){const r=t.pixelType||"u8",c=K.getPixelArrayConstructor(r),a=r==="u8"?e:new c(e.buffer),i=[],h=t.planes||1;if(h===1)i.push(a);else for(let n=0;n<h;n++){const l=(t.width||1)*(t.height||e.length),s=new c(l);for(let f=0;f<l;f++)s[f]=a[f*h+n];i.push(s)}const o=new K({width:t.width||1,height:t.height||e.length,pixels:i,pixelType:r,statistics:null});return o.updateStatistics(),o}function Qr(e,t){return rr(new Pe(new Uint8Array(e)).getBytes(),t)}function eo(e,t){return rr(ut(e,t.offset,t.eof,!t.isInputBigEndian),t)}function to(e,t,r){const{pixelTypeCtor:c}=so(t.pixelType),a=(0,Mr.decode)(e,{width:t.width,height:t.height,pixelType:c,format:r}),i=new K({width:t.width,height:t.height,pixels:a.pixels,pixelType:t.pixelType,mask:a.mask,statistics:null});return i.updateStatistics(),i}function ro(e,t){var a;const r=Tr.decode(e,(a=t.hasNoZlibMask)!=null?a:void 0),c=new K({width:r.width,height:r.height,pixels:r.pixels,pixelType:"U8",mask:r.mask,statistics:null});return c.updateStatistics(),c}function oo(e,t){const r=new Uint8Array(e),c=new Hr(r),{width:a,height:i}=t,h=a*i,o=c.decode();let n,l=0,s=0;const f=new Uint8Array(h);for(l=0;l<h;l++)f[l]=o[4*l+3];const p=new K({width:a,height:i,pixels:[],pixelType:"U8",mask:f,statistics:[]});for(l=0;l<3;l++){for(n=new Uint8Array(h),s=0;s<h;s++)n[s]=o[4*s+l];p.addData({pixels:n})}return p.updateStatistics(),p}async function io(e,t,r,c){const a=new ht,i={applyJpegMask:!1,format:t,...r},h=await a.decode(e,i,c),o=new K(h);return o.updateStatistics(),o}function or(e){if(e==null)throw new ye("rasterCodec:decode","parameter encodeddata is required.");const t=new Uint8Array(e,0,10);let r="";return t[0]===255&&t[1]===216?r="jpg":t[0]===137&&t[1]===80&&t[2]===78&&t[3]===71?r="png":t[0]===67&&t[1]===110&&t[2]===116&&t[3]===90&&t[4]===73&&t[5]===109&&t[6]===97&&t[7]===103&&t[8]===101&&t[9]===32?r="lerc":t[0]===76&&t[1]===101&&t[2]===114&&t[3]===99&&t[4]===50&&t[5]===32?r="lerc2":t[0]===73&&t[1]===73&&t[2]===42&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===42||t[0]===73&&t[1]===73&&t[2]===43&&t[3]===0||t[0]===77&&t[1]===77&&t[2]===0&&t[3]===43?r="tiff":t[0]===71&&t[1]===73&&t[2]===70?r="gif":t[0]===66&&t[1]===77?r="bmp":String.fromCharCode.apply(null,t).toLowerCase().includes("error")&&(r="error"),r}function no(e){let t=null;switch(e){case"lerc":case"lerc2":t=qr;break;case"jpg":t=ro;break;case"png":t=oo;break;case"bsq":case"bip":t=(r,c)=>to(r,c,e);break;case"tiff":t=Xr;break;case"deflate":t=Qr;break;case"lzw":t=eo;break;case"error":t=()=>{throw new ye("rasterCodec:decode","input data contains error")};break;default:t=()=>{throw new ye("rasterCodec:decode","unsupported raster format")}}return t}function so(e){let t=null,r=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":r=255,t=Uint8Array;break;case"u16":r=r||65535,t=Uint16Array;break;case"u32":r=r||2**32-1,t=Uint32Array;break;case"s8":r=r||-128,t=Int8Array;break;case"s16":r=r||-32768,t=Int16Array;break;case"s32":r=r||0-2**31,t=Int32Array;break;default:t=Float32Array}return{pixelTypeCtor:t,noDataValue:r}}function ao(e,t=1){if(!e)return;const{pixels:r,width:c,height:a,mask:i}=e;if(!r||r.length===0)return;const h=r.length,o=c-1,n=a-1,l=[];let s,f,p,u,w,d,g=null;const y=K.getPixelArrayConstructor(e.pixelType);if(t===0){for(s=0;s<h;s++){for(w=r[s],d=new y(o*n),f=0;f<n;f++)for(u=f*c,p=0;p<o;p++)d[f*o+p]=w[u+p];l.push(d)}if(z(i))for(g=new Uint8Array(o*n),f=0;f<n;f++)for(u=f*c,p=0;p<o;p++)g[f*o+p]=i[u+p]}else{for(s=0;s<h;s++){for(w=r[s],d=new y(o*n),f=0;f<n;f++)for(u=f*c,p=0;p<o;p++)d[f*o+p]=(w[u+p]+w[u+p+1]+w[u+c+p]+w[u+c+p+1])/4;l.push(d)}if(i)for(g=new Uint8Array(o*n),f=0;f<n;f++)for(u=f*c,p=0;p<o;p++)g[f*o+p]=Math.min.apply(null,[i[u+p],i[u+p+1],i[u+c+p],i[u+c+p+1]])}e.width=o,e.height=n,e.mask=g,e.pixels=l}function qo(e){let t=or(e);return t==="lerc2"?t="lerc":t==="error"&&(t=""),t}async function Xo(e,t={},r){if(e==null)throw new ye("rasterCodec:decode","missing encodeddata parameter.");let c,a,i=t.format&&t.format.toLowerCase();if(!(i!=="bsq"&&i!=="bip"||t.width!=null&&t.height!=null))throw new ye("rasterCodec:decode","requires width and height in options parameter.");return i==="tiff"&&t.customOptions?Zr(e,t):((!i||i!=="bsq"&&i!=="bip"&&i!=="deflate"&&i!=="lzw")&&(i=or(e)),t.useCanvas&&Yr.has(i)?a=await io(e,i,t,r):(c=no(i),t.isPoint&&((t={...t}).width!=null&&t.width++,t.height!=null&&t.height++),a=await c(e,t),t.isPoint&&ao(a)),a)}var Rt,Et;function Z(e){return z(e)&&e.declaredClass==="esri.layers.support.PixelBlock"&&e.pixels&&e.pixels.length>0}function Lt(e,t){if(!(t!=null&&t.length)||!Z(e))return e;const r=e.pixels.length;return t&&t.some(c=>c>=r)||r===1&&t.length===1&&t[0]===0?e:r!==t.length||t.some((c,a)=>c!==a)?new K({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:t.map(c=>e.pixels[c]),statistics:e.statistics&&t.map(c=>e.statistics[c])}):e}function Zo(e){if(!(e!=null&&e.length)||e.some(s=>!Z(s)))return null;if(e.length===1)return z(e[0])?e[0].clone():null;const t=e,{width:r,height:c,pixelType:a}=t[0];if(t.some(s=>s.width!==r||s.height!==c))return null;const i=t.map(({mask:s})=>s).filter(s=>s!=null);let h=null;i.length&&(h=new Uint8Array(r*c),h.set(i[0]),i.length>1&&nr(i.slice(1),h));const o=[];t.forEach(({pixels:s})=>o.push(...s));const n=t.map(({statistics:s})=>s).filter(s=>s==null?void 0:s.length),l=[];return n.forEach(s=>l.push(...s)),new K({pixelType:a,width:r,height:c,mask:h,pixels:o,statistics:l.length?l:null})}function Be(e){if(!e)return;const t=e.colormap;if(!t||t.length===0)return;const r=t.sort((f,p)=>f[0]-p[0]);let c=0;r[0][0]<0&&(c=r[0][0]);const a=Math.max(256,r[r.length-1][0]-c+1),i=new Uint8Array(4*a),h=[];let o,n=0,l=0;const s=r[0].length===5;if(a>65536)return r.forEach(f=>{h[f[0]-c]=s?f.slice(1):f.slice(1).concat([255])}),{indexed2DColormap:h,offset:c,alphaSpecified:s};if(e.fillUnspecified)for(o=r[l],n=o[0]-c;n<a;n++)i[4*n]=o[1],i[4*n+1]=o[2],i[4*n+2]=o[3],i[4*n+3]=s?o[4]:255,n===o[0]-c&&(o=l===r.length-1?o:r[++l]);else for(n=0;n<r.length;n++)o=r[n],l=4*(o[0]-c),i[l]=o[1],i[l+1]=o[2],i[l+2]=o[3],i[l+3]=s?o[4]:255;return{indexedColormap:i,offset:c,alphaSpecified:s}}function tt(e,t){if(!Z(e)||!t||!t.indexedColormap&&!t.indexed2DColormap)return e;const r=e.clone(),c=r.pixels;let a=r.mask;const i=r.width*r.height;if(c.length!==1)return e;const{indexedColormap:h,indexed2DColormap:o,offset:n,alphaSpecified:l}=t;let s=0;const f=c[0],p=new Uint8Array(f.length),u=new Uint8Array(f.length),w=new Uint8Array(f.length);let d,g=0;if(h){const y=h.length-1;if(z(a))for(s=0;s<i;s++)a[s]&&(g=4*(f[s]-n),g<n||g>y?a[s]=0:(p[s]=h[g],u[s]=h[g+1],w[s]=h[g+2],a[s]=h[g+3]));else{for(a=new Uint8Array(i),s=0;s<i;s++)g=4*(f[s]-n),g<n||g>y?a[s]=0:(p[s]=h[g],u[s]=h[g+1],w[s]=h[g+2],a[s]=h[g+3]);r.mask=a}}else if(o)if(z(a))for(s=0;s<i;s++)a[s]&&(d=o[f[s]],p[s]=d[0],u[s]=d[1],w[s]=d[2],a[s]=d[3]);else{for(a=new Uint8Array(i),s=0;s<i;s++)d=o[f[s]],p[s]=d[0],u[s]=d[1],w[s]=d[2],a[s]=d[3];r.mask=a}return r.pixels=[p,u,w],r.statistics=null,r.pixelType="u8",r.maskIsAlpha=l,r}function Ut(e,t){if(!Z(e))return null;const{pixels:r,mask:c}=e,a=r.length;let i=t.lut;const{offset:h}=t;i&&i[0].length===1&&(i=r.map(()=>i));const o=[],n=t.outputPixelType||"u8";for(let s=0;s<a;s++){const f=ir(r[s],c,i[s],h||0,n);o.push(f)}const l=new K({width:e.width,height:e.height,pixels:o,mask:c,pixelType:n});return l.updateStatistics(),l}function ir(e,t,r,c,a){const i=e.length,h=K.createEmptyBand(a,i);if(t)for(let o=0;o<i;o++)t[o]&&(h[o]=r[e[o]-c]);else for(let o=0;o<i;o++)h[o]=r[e[o]-c];return h}function lo(e,t){if(!Z(e))return null;const r=e.clone(),{pixels:c}=r,a=r.width*r.height,i=t.length,h=Math.floor(i/2),o=t[Math.floor(h)],n=c[0];let l,s,f,p,u,w,d=!1;const g=new Uint8Array(a),y=new Uint8Array(a),m=new Uint8Array(a);let C=r.mask;const b=t[0].mappedColor.length===4;for(C||(C=new Uint8Array(a),C.fill(b?255:1),r.mask=C),u=0;u<a;u++)if(C[u]){for(l=n[u],d=!1,w=h,s=o,f=0,p=i-1;p-f>1;){if(l===s.value){d=!0;break}l>s.value?f=w:p=w,w=Math.floor((f+p)/2),s=t[Math.floor(w)]}d||(l===t[f].value?(s=t[f],d=!0):l===t[p].value?(s=t[p],d=!0):l<t[f].value?(d=!1,s=null):l>t[f].value&&(l<t[p].value?(s=t[f],d=!0):p===i-1?(d=!1,s=null):(s=t[p],d=!0))),d?(g[u]=s.mappedColor[0],y[u]=s.mappedColor[1],m[u]=s.mappedColor[2],C[u]=s.mappedColor[3]):g[u]=y[u]=m[u]=C[u]=0}return r.pixels=[g,y,m],r.mask=C,r.pixelType="u8",r.maskIsAlpha=b,r}function Qo(e,t){if(!Z(e))return null;const{width:r,height:c}=e,{inputRanges:a,outputValues:i,outputPixelType:h,noDataRanges:o,allowUnmatched:n}=t,l=e.pixels[0],s=K.createEmptyBand(h,l.length);n&&s.set(l);const f=e.mask,p=a.length/2;for(let w=0;w<c;w++)for(let d=0;d<r;d++){const g=w*r+d;if(!f||f[g]){const y=l[g];for(let m=p-1;m>=0;m--)if(y>=a[2*m]&&y<=a[2*m+1]){s[g]=i[m];break}}}let u=f;if(o!=null&&o.length){u=new Uint8Array(r*c),f&&u.set(f);for(let w=0;w<c;w++)for(let d=0;d<r;d++){const g=w*r+d;if(!f||f[g]){const y=l[g];for(let m=0;m<p;m+=2)if(y>=o[m]&&y<=o[m+1]){s[g]=0,u[g]=0;break}}}}return new K({width:r,height:c,pixelType:h,pixels:[s],mask:u})}function Bt(e,t,r,c){const a=r!=null&&r.length>=2?new Set(r):null,i=(r==null?void 0:r.length)===1?r[0]:null,h=!!(t!=null&&t.length);for(let o=0;o<e.length;o++)if(c[o]){const n=e[o];if(h){let l=!1;for(let s=0;s<t.length;s+=2)if(n>=t[s]&&n<=t[s+1]){l=!0;break}l||(c[o]=0)}c[o]&&(n===i||(a==null?void 0:a.has(n)))&&(c[o]=0)}}function _t(e,t){const r=e[0].length;for(let c=0;c<r;c++)if(t[c]){let a=!1;for(let i=0;i<e.length;i++)if(e[i][c]){a=!0;break}a||(t[c]=0)}}function nr(e,t){const r=e[0].length;for(let c=0;c<r;c++)if(t[c]){let a=!1;for(let i=0;i<e.length;i++)if(e[i][c]===0){a=!0;break}a&&(t[c]=0)}}function ei(e,t){if(!Z(e))return null;const{width:r,height:c,pixels:a}=e,i=r*c,h=new Uint8Array(i);e.mask?h.set(e.mask):h.fill(255);const o=a.length,{includedRanges:n,noDataValues:l,outputPixelType:s,matchAll:f,lookup:p}=t;if(p){const u=[];for(let w=0;w<o;w++){const d=ir(a[w],h,p.lut,p.offset||0,"u8");u.push(d)}u.length===1?h.set(u[0]):f?_t(u,h):nr(u,h)}else if(f){const u=[];for(let w=0;w<o;w++){const d=new Uint8Array(i);d.set(h),Bt(a[w],n,l,d),u.push(d)}u.length===1?h.set(u[0]):_t(u,h)}else for(let u=0;u<o;u++)Bt(a[u],n,l,h);return new K({width:r,height:c,pixelType:s,pixels:a,mask:h})}function ti(e,t,r){if(e!=="u8"&&e!=="s8"&&e!=="u16"&&e!=="s16")return null;const c=e.includes("16")?65536:256,a=e.includes("s")?-c/2:0,i=K.createEmptyBand(e,c);for(let h=0;h<t.length;h++){const o=r[h],n=Math.ceil(t[2*h]-a),l=Math.floor(t[2*h+1]-a);for(let s=n;s<=l;s++)i[s]=o}return{lut:i,offset:a}}function ri(e,t,r){if(e!=="u8"&&e!=="s8"&&e!=="u16"&&e!=="s16")return null;const c=e.includes("16")?65536:256,a=e.includes("s")?-c/2:0,i=new Uint8Array(c);if(t)for(let h=0;h<t.length;h++){const o=Math.ceil(t[2*h]-a),n=Math.floor(t[2*h+1]-a);for(let l=o;l<=n;l++)i[l]=255}if(r)for(let h=0;h<r.length;h++)i[r[h]-a]=0;return{lut:i,offset:a}}function co(e,t,r,c,a,i,h,o){return{xmin:a<=r*e?0:a<r*e+e?a-r*e:e,ymin:i<=c*t?0:i<c*t+t?i-c*t:t,xmax:a+h<=r*e?0:a+h<r*e+e?a+h-r*e:e,ymax:i+o<=c*t?0:i+o<c*t+t?i+o-c*t:t}}function rt(e,t,r,c,a,i){var d;const{width:h,height:o}=r.block,{x:n,y:l}=r.offset,{width:s,height:f}=r.mosaic,p=co(h,o,c,a,n,l,s,f);let u=0,w=0;if(i){const g=i.hasGCSSShiftTransform?360:(d=i.halfWorldWidth)!=null?d:0,y=h*i.resolutionX,m=i.startX+c*y,C=m+y;m<g&&C>g?w=i.rightPadding:m>=g&&(u=i.leftMargin-i.rightPadding,w=0)}if(p.xmax-=w,typeof t!="number")for(let g=p.ymin;g<p.ymax;g++){const y=(a*o+g-l)*s+(c*h-n)+u,m=g*h;for(let C=p.xmin;C<p.xmax;C++)e[y+C]=t[m+C]}else for(let g=p.ymin;g<p.ymax;g++){const y=(a*o+g-l)*s+(c*h-n)+u;for(let m=p.xmin;m<p.xmax;m++)e[y+m]=t}}function oi(e,t,r={}){const{clipOffset:c,clipSize:a,alignmentInfo:i,blockWidths:h}=r;if(h)return ho(e,t,{blockWidths:h});const o=e.find(T=>Z(T));if(we(o))return null;const n=a?a.width:t.width,l=a?a.height:t.height,s=o.width,f=o.height,p=t.width/s,u=t.height/f,w={offset:c||{x:0,y:0},mosaic:a||t,block:{width:s,height:f}},d=o.pixelType,g=K.getPixelArrayConstructor(d),y=o.pixels.length,m=[];let C,b;for(let T=0;T<y;T++){b=new g(n*l);for(let A=0;A<u;A++)for(let v=0;v<p;v++){const M=e[A*p+v];Z(M)&&(C=M.pixels[T],rt(b,C,w,v,A,i))}m.push(b)}let x;if(e.some(T=>we(T)||z(T.mask)&&T.mask.length>0)){x=new Uint8Array(n*l);for(let T=0;T<u;T++)for(let A=0;A<p;A++){const v=e[T*p+A],M=z(v)?v.mask:null;z(M)?rt(x,M,w,A,T,i):rt(x,v?1:0,w,A,T,i)}}const k=new K({width:n,height:l,pixels:m,pixelType:d,mask:x});return k.updateStatistics(),k}function ho(e,t,r){const c=e.find(u=>z(u));if(we(c))return null;const a=e.some(u=>!z(u)||!!u.mask),{width:i,height:h}=t,o=a?new Uint8Array(i*h):null,{blockWidths:n}=r,l=[],s=c.getPlaneCount(),f=K.getPixelArrayConstructor(c.pixelType);if(a)for(let u=0,w=0;u<e.length;w+=n[u],u++){const d=e[u];if(!Z(d))continue;const g=pe(d.mask);for(let y=0;y<h;y++)for(let m=0;m<n[u];m++)o[y*i+m+w]=g==null?255:g[y*d.width+m]}for(let u=0;u<s;u++){const w=new f(i*h);for(let d=0,g=0;d<e.length;g+=n[d],d++){const y=e[d];if(!Z(y))continue;const m=y.pixels[u];if(m!=null)for(let C=0;C<h;C++)for(let b=0;b<n[d];b++)w[C*i+b+g]=m[C*y.width+b]}l.push(w)}const p=new K({width:i,height:h,mask:o,pixels:l,pixelType:c.pixelType});return p.updateStatistics(),p}function ii(e,t,r){if(!Z(e))return null;const{width:c,height:a}=e,i=t.x,h=t.y,o=r.width+i,n=r.height+h;if(i<0||h<0||o>c||n>a||i===0&&h===0&&o===c&&n===a)return e;e.mask||(e.mask=new Uint8Array(c*a));const l=e.mask;for(let s=0;s<a;s++){const f=s*c;for(let p=0;p<c;p++)l[f+p]=s<h||s>=n||p<i||p>=o?0:1}return e.updateStatistics(),e}function uo(e){if(!Z(e))return null;const t=e.clone(),{width:r,height:c,pixels:a}=e,i=a[0],h=t.pixels[0],o=pe(e.mask);for(let n=2;n<c-1;n++){const l=new Map;for(let f=n-2;f<n+2;f++)for(let p=0;p<4;p++){const u=f*r+p;_e(l,i[u],o?o[u]:1)}h[n*r]=Ot(l),h[n*r+1]=h[n*r+2]=h[n*r];let s=3;for(;s<r-1;s++){let f=(n-2)*r+s+1;_e(l,i[f],o?o[f]:1),f=(n-1)*r+s+1,_e(l,i[f],o?o[f]:1),f=n*r+s+1,_e(l,i[f],o?o[f]:1),f=(n+1)*r+s+1,_e(l,i[f],o?o[f]:1),f=(n-2)*r+s-3,Ve(l,i[f],o?o[f]:1),f=(n-1)*r+s-3,Ve(l,i[f],o?o[f]:1),f=n*r+s-3,Ve(l,i[f],o?o[f]:1),f=(n+1)*r+s-3,Ve(l,i[f],o?o[f]:1),h[n*r+s]=Ot(l)}h[n*r+s+1]=h[n*r+s]}for(let n=0;n<r;n++)h[n]=h[r+n]=h[2*r+n],h[(c-1)*r+n]=h[(c-2)*r+n];return t.updateStatistics(),t}function Ot(e){if(e.size===0)return 0;let t=0,r=-1,c=0;const a=e.keys();let i=a.next();for(;!i.done;)c=e.get(i.value),c>t&&(r=i.value,t=c),i=a.next();return r}function Ve(e,t,r){if(r===0)return;const c=e.get(t);c===1?e.delete(t):e.set(t,c-1)}function _e(e,t,r){r!==0&&e.set(t,e.has(t)?e.get(t)+1:1)}function fo(e,t,r){let{x:c,y:a}=t;const{width:i,height:h}=r;if(c===0&&a===0&&h===e.height&&i===e.width)return e;const{width:o,height:n}=e,l=Math.max(0,a),s=Math.max(0,c),f=Math.min(c+i,o),p=Math.min(a+h,n);if(f<0||p<0||!Z(e))return null;c=Math.max(0,-c),a=Math.max(0,-a);const{pixels:u}=e,w=i*h,d=u.length,g=[];for(let b=0;b<d;b++){const x=u[b],k=K.createEmptyBand(e.pixelType,w);for(let T=l;T<p;T++){const A=T*o;let v=(T+a-l)*i+c;for(let M=s;M<f;M++)k[v++]=x[A+M]}g.push(k)}const y=new Uint8Array(w),m=pe(e.mask);for(let b=l;b<p;b++){const x=b*o;let k=(b+a-l)*i+c;for(let T=s;T<f;T++)y[k++]=m?m[x+T]:1}const C=new K({width:r.width,height:r.height,pixelType:e.pixelType,pixels:g,mask:y});return C.updateStatistics(),C}function po(e,t=!0){if(!Z(e))return null;const{pixels:r,width:c,height:a,mask:i,pixelType:h}=e,o=[],n=Math.round(c/2),l=Math.round(a/2),s=a-1,f=c-1;for(let u=0;u<r.length;u++){const w=r[u],d=K.createEmptyBand(h,n*l);let g=0;for(let y=0;y<a;y+=2)for(let m=0;m<c;m+=2){const C=w[y*c+m];if(t){const b=m===f?C:w[y*c+m+1],x=y===s?C:w[y*c+m+c],k=m===f?x:y===s?b:w[y*c+m+c+1];d[g++]=(C+b+x+k)/4}else d[g++]=C}o.push(d)}let p=null;if(z(i)){p=new Uint8Array(n*l);let u=0;for(let w=0;w<a;w+=2)for(let d=0;d<c;d+=2){const g=i[w*c+d];if(t){const y=d===f?g:i[w*c+d+1],m=w===s?g:i[w*c+d+c],C=d===f?m:w===s?y:i[w*c+d+c+1];p[u++]=g*y*m*C?1:0}else p[u++]=g}}return new K({width:n,height:l,pixelType:h,pixels:o,mask:p})}function ni(e,t,r){if(!Z(e))return null;const{width:c,height:a}=t;let{width:i,height:h}=e;const o=new Map,n={x:0,y:0},l=r==null?1:1+r;let s=e;for(let f=0;f<l;f++){const p=Math.ceil(i/c),u=Math.ceil(h/a);for(let w=0;w<u;w++){n.y=w*a;for(let d=0;d<p;d++){n.x=d*c;const g=fo(s,n,t);o.set(`${f}/${w}/${d}`,g)}}f<l-1&&(s=po(s)),i=Math.round(i/2),h=Math.round(h/2)}return o}function sr(e,t,r,c,a=.5){const{width:i,height:h}=e,{width:o,height:n}=t,l=c.cols,s=c.rows,f=Math.ceil(o/l-.1/l),p=Math.ceil(n/s-.1/s);let u,w,d,g,y,m,C;const b=f*l,x=b*p*s,k=new Float32Array(x),T=new Float32Array(x),A=new Uint32Array(x),v=new Uint32Array(x);let M,D,R=0;for(let E=0;E<p;E++)for(let P=0;P<f;P++){u=12*(E*f+P),w=r[u],d=r[u+1],g=r[u+2],y=r[u+3],m=r[u+4],C=r[u+5];for(let S=0;S<s;S++){R=(E*s+S)*b+P*l,D=(S+.5)/s;for(let I=0;I<S;I++)M=(I+.5)/l,k[R+I]=(w*M+d*D+g)*i-a,T[R+I]=(y*M+m*D+C)*h-a,A[R+I]=Math.round(k[R+I]),v[R+I]=Math.round(T[R+I])}u+=6,w=r[u],d=r[u+1],g=r[u+2],y=r[u+3],m=r[u+4],C=r[u+5];for(let S=0;S<s;S++){R=(E*s+S)*b+P*l,D=(S+.5)/s;for(let I=S;I<l;I++)M=(I+.5)/l,k[R+I]=(w*M+d*D+g)*i-a,T[R+I]=(y*M+m*D+C)*h-a,A[R+I]=Math.round(k[R+I]),v[R+I]=Math.round(T[R+I])}}return{offsets_x:k,offsets_y:T,offsets_xi:A,offsets_yi:v,gridWidth:b}}function si(e,t){const{coefficients:r,spacing:c}=t,{offsets_x:a,offsets_y:i,gridWidth:h}=sr(e,e,r,{rows:c[0],cols:c[1]},.5),{width:o,height:n}=e,l=new Float32Array(o*n),s=180/Math.PI;for(let f=0;f<n;f++)for(let p=0;p<o;p++){const u=f*h+p,w=f===0?u:u-h,d=f===n-1?u:u+h,g=a[w]-a[d],y=i[d]-i[w];if(isNaN(g)||isNaN(y))l[f*o+p]=90;else{let m=Math.atan2(y,g)*s;m=(360+m)%360,l[f*o+p]=m}}return l}function ai(e,t,r,c,a="nearest"){if(!Z(e))return null;a==="majority"&&(e=uo(e));const{pixels:i,mask:h,pixelType:o}=e,n=e.width,l=e.height,s=K.getPixelArrayConstructor(o),f=i.length,{width:p,height:u}=t;let w=!1;for(let v=0;v<r.length;v+=3)r[v]===-1&&r[v+1]===-1&&r[v+2]===-1&&(w=!0);const{offsets_x:d,offsets_y:g,offsets_xi:y,offsets_yi:m,gridWidth:C}=sr({width:n,height:l},t,r,c,a==="majority"?0:.5);let b;const x=(v,M,D)=>{const R=v instanceof Float32Array||v instanceof Float64Array?0:.5;for(let E=0;E<u;E++){b=E*C;for(let P=0;P<p;P++){if(d[b]<0||g[b]<0)v[E*p+P]=0;else if(D)v[E*p+P]=M[y[b]+m[b]*n];else{const S=Math.floor(d[b]),I=Math.floor(g[b]),L=Math.ceil(d[b]),B=Math.ceil(g[b]),N=d[b]-S,U=g[b]-I;if(!h||h[S+I*n]&&h[S+I*n]&&h[S+B*n]&&h[L+B*n]){const O=(1-N)*M[S+I*n]+N*M[L+I*n],_=(1-N)*M[S+B*n]+N*M[L+B*n];v[E*p+P]=(1-U)*O+U*_+R}else v[E*p+P]=M[y[b]+m[b]*n]}b++}}},k=[];let T;for(let v=0;v<f;v++)T=new s(p*u),x(T,i[v],a==="nearest"||a==="majority"),k.push(T);const A=new K({width:p,height:u,pixelType:o,pixels:k});if(z(h))A.mask=new Uint8Array(p*u),x(A.mask,h,!0);else if(w){A.mask=new Uint8Array(p*u);for(let v=0;v<p*u;v++)A.mask[v]=d[v]<0||g[v]<0?0:1}return A.updateStatistics(),A}(function(e){e[e.matchAny=0]="matchAny",e[e.matchAll=1]="matchAll"})(Rt||(Rt={})),function(e){e[e.bestMatch=0]="bestMatch",e[e.fail=1]="fail"}(Et||(Et={}));function ar(e){let{altitude:t,azimuth:r}=e;const{hillshadeType:c,pixelSizePower:a=1,pixelSizeFactor:i=1,scalingType:h,isGCS:o,resolution:n}=e,l=c==="multi-directional"?2*e.zFactor:e.zFactor,{x:s,y:f}=n;let p=l/(8*s),u=l/(8*f);if(o&&l>.001&&(p/=111e3,u/=111e3),h==="adjusted")if(o){const R=111e3*s,E=111e3*f;p=(l+R**a*i)/(8*R),u=(l+E**a*i)/(8*E)}else p=(l+s**a*i)/(8*s),u=(l+f**a*i)/(8*f);let w=(90-t)*Math.PI/180,d=Math.cos(w),g=(360-r+90)*Math.PI/180,y=Math.sin(w)*Math.cos(g),m=Math.sin(w)*Math.sin(g);const C=[315,270,225,360,180,0],b=[60,60,60,60,60,90],x=new Float32Array([3,5,3,2,1,4]),k=x.reduce((R,E)=>R+E),T=x.map(R=>R/k),A=c==="multi-directional"?C.length:1,v=new Float32Array(6),M=new Float32Array(6),D=new Float32Array(6);if(c==="multi-directional")for(let R=0;R<A;R++)t=b[R],r=C[R],w=(90-t)*Math.PI/180,d=Math.cos(w),g=(360-r+90)*Math.PI/180,y=Math.sin(w)*Math.cos(g),m=Math.sin(w)*Math.sin(g),v[R]=d,M[R]=y,D[R]=m;else v.fill(d),M.fill(y),D.fill(m);return{resolution:n,factor:[p,u],sinZcosA:y,sinZsinA:m,cosZ:d,sinZcosAs:M,sinZsinAs:D,cosZs:v,weights:T,hillshadeType:["traditional","multi-directional"].indexOf(c)}}function mo(e,t){if(!Z(e))return e;const{width:r,height:c,mask:a}=e,i=new Uint8Array(r*c);let h=1;if(z(a)){for(let P=0;P<a.length;P++)if(a[P]){h=a[P];break}i.set(a)}const{factor:o,sinZcosA:n,sinZsinA:l,cosZ:s,sinZcosAs:f,sinZsinAs:p,cosZs:u,weights:w}=ar(t),[d,g]=o,{hillshadeType:y}=t,m=e.pixels[0],C=new Uint8Array(r*c);let b,x,k,T,A,v,M,D;const R=1,E=z(a);for(let P=R;P<c-R;P++){const S=P*r;for(let I=R;I<r-R;I++){if(a&&!a[S+I]){C[S+I]=0;continue}let L=8;if(E&&(L=(a[S-r+I-1]+a[S-r+I]+a[S-r+I+1]+a[S+I-1]+a[S+I+1]+a[S+r+I-1]+a[S+r+I]+a[S+r+I+1])/h,L<7)){C[S+I]=0,i[S+I]=0;continue}a&&L===7?(b=a[S-r+I-1]?m[S-r+I-1]:m[S+I],x=a[S-r+I]?m[S-r+I]:m[S+I],k=a[S-r+I+1]?m[S-r+I+1]:m[S+I],T=a[S+I-1]?m[S+I-1]:m[S+I],A=a[S+I+1]?m[S+I+1]:m[S+I],v=a[S+r+I-1]?m[S+r+I-1]:m[S+I],M=a[S+r+I]?m[S+r+I]:m[S+I],D=a[S+r+I+1]?m[S+r+I+1]:m[S+I]):(b=m[S-r+I-1],x=m[S-r+I],k=m[S-r+I+1],T=m[S+I-1],A=m[S+I+1],v=m[S+r+I-1],M=m[S+r+I],D=m[S+r+I+1]);const B=(k+A+A+D-(b+T+T+v))*d,N=(v+M+M+D-(b+x+x+k))*g,U=Math.sqrt(1+B*B+N*N);let O=0;if(y==="traditional"){let _=255*(s+l*N-n*B)/U;_<0&&(_=0),O=_}else{const _=p.length;for(let F=0;F<_;F++){let V=255*(u[F]+p[F]*N-f[F]*B)/U;V<0&&(V=0),O+=V*w[F]}}C[S+I]=255&O}}for(let P=0;P<c;P++)C[P*r]=C[P*r+1],C[(P+1)*r-1]=C[(P+1)*r-2];for(let P=1;P<r-1;P++)C[P]=C[P+r],C[P+(c-1)*r]=C[P+(c-2)*r];return new K({width:r,height:c,pixels:[C],mask:a?i:null,pixelType:"u8",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function go(e,t,r,c){if(!Z(e)||!Z(t))return;const{min:a,max:i}=c,h=e.pixels[0],{pixels:o,mask:n}=t,l=o[0],s=255.00001/(i-a),f=new Uint8ClampedArray(l.length),p=new Uint8ClampedArray(l.length),u=new Uint8ClampedArray(l.length),w=r.length-1;for(let d=0;d<l.length;d++){if(n&&n[d]===0)continue;const g=Math.floor((l[d]-a)*s),[y,m]=r[g<0?0:g>w?w:g],C=h[d],b=C*m,x=b*(1-Math.abs(y%2-1)),k=C-b;switch(Math.floor(y)){case 0:f[d]=b+k,p[d]=x+k,u[d]=k;break;case 1:f[d]=x+k,p[d]=b+k,u[d]=k;break;case 2:f[d]=k,p[d]=b+k,u[d]=x+k;break;case 3:f[d]=k,p[d]=x+k,u[d]=b+k;break;case 4:f[d]=x+k,p[d]=k,u[d]=b+k;break;case 5:case 6:f[d]=b+k,p[d]=k,u[d]=x+k}}e.pixels=[f,p,u],e.updateStatistics()}function li(e,t){var R,E;if(!Z(e))return e;const r=t.zFactor,c=(R=t.pixelSizePower)!=null?R:1,a=(E=t.pixelSizeFactor)!=null?E:1,i=t.slopeType,h=t.isGCS,{width:o,height:n,mask:l}=e,s=e.pixels[0],f=new Uint8Array(o*n);let p=1;if(z(l)){for(let P=0;P<l.length;P++)if(l[P]){p=l[P];break}f.set(l)}const u=new Float32Array(o*n),{x:w,y:d}=t.resolution;let g=r/(8*w),y=r/(8*d);if(h&&Math.abs(r-1)<1e-4&&(g/=111e3,y/=111e3),i==="adjusted")if(h){const P=111e3*w,S=111e3*d;g=(r+P**c*a)/(8*P),y=(r+S**c*a)/(8*S)}else g=(r+w**c*a)/(8*w),y=(r+d**c*a)/(8*d);const m=1;let C,b,x,k,T,A,v,M;const D=z(l);for(let P=m;P<n-m;P++){const S=P*o;for(let I=m;I<o-m;I++){if(l&&!l[S+I]){u[S+I]=0;continue}let L=0;if(D&&(L=(l[S-o+I-1]+l[S-o+I]+l[S-o+I+1]+l[S+I-1]+l[S+I+1]+l[S+o+I-1]+l[S+o+I]+l[S+o+I+1])/p,L<7)){u[S+I]=0,f[S+I]=0;continue}l&&L===7?(C=l[S-o+I-1]?s[S-o+I-1]:s[S+I],b=l[S-o+I]?s[S-o+I]:s[S+I],x=l[S-o+I+1]?s[S-o+I+1]:s[S+I],k=l[S+I-1]?s[S+I-1]:s[S+I],T=l[S+I+1]?s[S+I+1]:s[S+I],A=l[S+o+I-1]?s[S+o+I-1]:s[S+I],v=l[S+o+I]?s[S+o+I]:s[S+I],M=l[S+o+I+1]?s[S+o+I+1]:s[S+I]):(C=s[S-o+I-1],b=s[S-o+I],x=s[S-o+I+1],k=s[S+I-1],T=s[S+I+1],A=s[S+o+I-1],v=s[S+o+I],M=s[S+o+I+1]);const B=(x+T+T+M-(C+k+k+A))*g,N=(A+v+v+M-(C+b+b+x))*y,U=Math.sqrt(B*B+N*N);u[S+I]=i==="percent-rise"?100*U:57.2957795*Math.atan(U)}}for(let P=0;P<n;P++)u[P*o]=u[P*o+1],u[(P+1)*o-1]=u[(P+1)*o-2];for(let P=1;P<o-1;P++)u[P]=u[P+o],u[P+(n-1)*o]=u[P+(n-2)*o];return new K({width:o,height:n,pixels:[u],mask:l?f:null,pixelType:"f32",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:i==="percent-rise"?100:360}]})}function ci(e,t={}){if(!Z(e))return e;const{width:r,height:c,mask:a}=e,i=e.pixels[0],h=new Uint8Array(r*c);z(a)&&h.set(a);const o=new Float32Array(r*c),{resolution:n}=t,l=n?1/n.x:1,s=n?1/n.y:1,f=1;let p,u,w,d,g,y,m,C;const b=z(a);for(let x=f;x<c-f;x++){const k=x*r;for(let T=f;T<r-f;T++){if(a&&!a[k+T]){o[k+T]=0;continue}let A=0;if(b&&(A=a[k-r+T-1]+a[k-r+T]+a[k-r+T+1]+a[k+T-1]+a[k+T+1]+a[k+r+T-1]+a[k+r+T]+a[k+r+T+1],A<7)){o[k+T]=0,h[k+T]=0;continue}a&&A===7?(p=a[k-r+T-1]?i[k-r+T-1]:i[k+T],u=a[k-r+T]?i[k-r+T]:i[k+T],w=a[k-r+T+1]?i[k-r+T+1]:i[k+T],d=a[k+T-1]?i[k+T-1]:i[k+T],g=a[k+T+1]?i[k+T+1]:i[k+T],y=a[k+r+T-1]?i[k+r+T-1]:i[k+T],m=a[k+r+T]?i[k+r+T]:i[k+T],C=a[k+r+T+1]?i[k+r+T+1]:i[k+T]):(p=i[k-r+T-1],u=i[k-r+T],w=i[k-r+T+1],d=i[k+T-1],g=i[k+T+1],y=i[k+r+T-1],m=i[k+r+T],C=i[k+r+T+1]);const v=(w+g+g+C-(p+d+d+y))*l,M=(y+m+m+C-(p+u+u+w))*s;let D=-1;v===0&&M===0||(D=90-57.29578*Math.atan2(M,-v),D<0&&(D+=360),D===360?D=0:D>360&&(D%=360)),o[k+T]=D}}for(let x=0;x<c;x++)o[x*r]=o[x*r+1],o[(x+1)*r-1]=o[(x+1)*r-2];for(let x=1;x<r-1;x++)o[x]=o[x+r],o[x+(c-1)*r]=o[x+(c-2)*r];return new K({width:r,height:c,pixels:[o],mask:a?h:null,pixelType:"f32",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:360}]})}const yo=[{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyanToPurple_predefined",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,0,0]},{id:"redLightToDark_predefined",fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrumFullBright_predefined",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}],wo={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",blueGreenBright_predefined:"Blue-Green Bright",blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",partialSpectrum_predefined:"Partial Spectrum",partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",purpleBlueBright_predefined:"Purple-Blue Bright",purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",yellowToRed_predefined:"Yellow to Red",yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"};function je(e,t){if(!e||!t||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]>t[r]+2||e[r]<t[r]-2)return!1;return!0}function Co(e,t){if(!e)return;const r=t||yo;let c=null;return e.type==="algorithmic"?r.some(a=>{if(je(e.fromColor.toRgb(),a.fromColor)&&je(e.toColor.toRgb(),a.toColor))return c=a.id,!0}):e.type==="multipart"&&r.some(a=>{const i=e.colorRamps,h=a.colorRamps;if(i&&h&&i.length===h.length&&!h.some((o,n)=>{if(!je(i[n].fromColor.toRgb(),new yt(o.fromColor).toRgb())||!je(i[n].toColor.toRgb(),new yt(o.toColor).toRgb()))return!0})){if(c)return!0;c=a.id}}),c}function xo(e){const t=Co(e);return t?wo[t]:null}function Ge(e){const t=(e=e||{}).numColors||256,r=e.distanceOffset||0,c=e.isCustomInterval!=null?e.isCustomInterval:e.distanceInterval!==null&&e.distanceInterval!==1/(t-1),a=e.distanceInterval||1/(t-1);return{...e,numColors:t,distanceOffset:r,interpolateAlpha:!!e.interpolateAlpha,distanceInterval:a,isCustomInterval:c,weights:e.weights}}function bo(e,t,r){const{numColors:c,distanceOffset:a,distanceInterval:i,isCustomInterval:h}=Ge(r),o=e.s===0,n=t.s===0;let l=e.h,s=t.h;o&&!n?l=s:n&&!o&&(t={...t,h:l},s=l);let f,p=Math.abs(s-l);const u=360;p<u/2?f=(s-l)*i:(p=u-p,f=l>s?p*i:-p*i);const w=(t.s-e.s)*i,d=(t.v-e.v)*i;let{s:g,v:y}=e,m=l;if(a){const b=a/i;m=(m+b*f+u)%u,g+=b*w,y+=b*d}const C=[];for(let b=0;b<c-1;b++)C.push({h:m,s:g,v:y}),m=(m+f+u)%u,g+=w,y+=d;return C.push(h?{h:m,s:g,v:y}:t),C}function To(e,t,r){const{numColors:c,distanceOffset:a,distanceInterval:i,isCustomInterval:h}=Ge(r);let{l:o,a:n,b:l}=e;const s=(t.l-o)*i,f=(t.a-n)*i,p=(t.b-l)*i,u=[];if(a){const w=a/i;o+=w*s,n+=w*f,l+=w*p}for(let w=0;w<c-1;w++)u.push({l:o,a:n,b:l}),o+=s,n+=f,l+=p;return u.push(h?{l:o,a:n,b:l}:t),u}function ko(e,t,r){const{numColors:c,distanceOffset:a,distanceInterval:i,isCustomInterval:h}=Ge(r),o=e.h,n=t.h,l=2*Math.PI;let s;if(o<=n){const m=n-o,C=n-o-l;s=Math.abs(C)<Math.abs(m)?C:m}else{const m=n+l-o,C=n-o;s=Math.abs(C)<Math.abs(m)?C:m}const f=s*i,p=(t.l-e.l)*i,u=(t.c-e.c)*i;let{l:w,c:d,h:g}=e;if(a){const m=a/i;w+=m*p,d+=m*u,g=(g+m*f+l)%l}const y=[];for(let m=0;m<c-1;m++)y.push({l:w,c:d,h:g}),w+=p,d+=u,g=(g+f+l)%l;return y.push(h?{l:w,c:d,h:g}:t),y}function lr(e,t){var d,g;let{fromColor:r,toColor:c}=e;r.length===3&&(r=r.concat([255])),c.length===3&&(c=c.concat([255]));const a=e.algorithm||"esriCIELabAlgorithm",{numColors:i,distanceOffset:h,isCustomInterval:o,interpolateAlpha:n}=Ge(t);if(i===1&&h===0)return[r];if(i===2&&h===0&&!o)return[r,c];const l={r:r[0],g:r[1],b:r[2]},s={r:c[0],g:c[1],b:c[2]},f=a==="esriCIELabAlgorithm"?To(Ct(l),Ct(s),t):a==="esriHSVAlgorithm"?bo(We(l),We(s),t):ko(xt(l),xt(s),t),p=[],u=(d=r[3])!=null?d:255,w=(((g=c[3])!=null?g:255)-u)/(i-1);for(let y=0;y<i;y++){const{r:m,g:C,b}=br(f[y]),x=n?Math.round(u+w*y):255;p.push([m,C,b,x])}return p}function vo(e,t){const{numColors:r,interpolateAlpha:c}=Ge(t);let a=t==null?void 0:t.weights;const{colorRamps:i}=e;if(a){const p=a.reduce((u,w)=>u+w);a=a.map(u=>u/p)}else{a=[];for(let p=0;p<i.length;p++)a[p]=1/i.length}const h=[];let o=0,n=0;const l=1/(r-1);let s=!1;for(let p=0;p<i.length;p++){let u=s?0:o*l-n,w=p===i.length-1?r-1-o:(a[p]-u)/l;if(s=Math.ceil(w)===w,w=Math.ceil(w),w===0)continue;u/=a[p];const d=lr(i[p],{numColors:w,interpolateAlpha:c,distanceOffset:u,distanceInterval:l/a[p]});o+=d.length,h.push(...d),n+=a[p]}const f=[...i[i.length-1].toColor];return f.length===3&&f.push(255),h.push(f),h}function So(e,t=256,r=!1){const c="toJSON"in e?e.toJSON():e,a={numColors:t,interpolateAlpha:r};return c.type==="multipart"?vo(c,a):lr(c,a)}function Gt(e,t=256,r=!1){const c=So(e,t,r);return c.forEach((a,i)=>{a.unshift(i),r||a.pop()}),c}function hi(e){const t=xo(e);if(e){if(e.type==="algorithmic")return{...Ft(e),Name:t};if(e.colorRamps){const r=e.colorRamps.map(Ft);return{type:"MultiPartColorRamp",NumColorRamps:r.length,ArrayOfColorRamp:r,Name:t}}}}function Ft(e){var t;if(!!e)return{Algorithm:((t=e.toJSON())==null?void 0:t.Algorithm)||"esriHSVAlgorithm",type:"AlgorithmicColorRamp",FromColor:Nt(e.fromColor),ToColor:Nt(e.toColor)}}function Nt(e){const t=We(e);return{type:"HsvColor",Hue:t.h,Saturation:t.s,Value:t.v,AlphaValue:255}}function ui(e){const t=e.reverse().map(r=>{const c=r.toString(16);return c.length<2?"0"+c:c});return 4294967295&Number.parseInt(t.join(""),16)}const fi=new Wt({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"}),Ao={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"},$t={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},ot=1,Io=[.299,.587,.114];function cr(e,t=256){t=Math.min(t,256);const{size:r,counts:c}=e,a=new Uint8Array(r),i=c.reduce((s,f)=>s+f/t,0);let h=0,o=0,n=0,l=i;for(let s=0;s<r;s++)if(n+=c[s],!(s<r-1&&n+c[s+1]<l)){for(;h<t-1&&l<n;)h++,l+=i;for(let f=o;f<=s;f++)a[f]=h;o=s+1}for(let s=o;s<r;s++)a[s]=t-1;return a}function Vt(e){const{minCutOff:t,maxCutOff:r,gamma:c,pixelType:a}=e,i=e.outMin||0,h=e.outMax||255;if(!["u8","u16","s8","s16"].includes(a))return null;const o=t.length;let n,l,s=0;a==="s8"?s=-127:a==="s16"&&(s=-32767);let f=256;["u16","s16"].includes(a)&&(f=65536);const p=[],u=h-i;for(n=0;n<o;n++)p[n]=r[n]-t[n],r[n],t[n];const w=c&&c.length>=o,d=[];if(w)for(n=0;n<o;n++)c[n]>1?c[n]>2?d[n]=6.5+(c[n]-2)**2.5:d[n]=6.5+100*(2-c[n])**4:d[n]=1;let g;const y=[];let m,C,b;if(w)for(n=0;n<o;n++){for(b=[],l=0;l<f;l++)m=l+s,g=(m-t[n])/p[n],C=1,c[n]>1&&(C-=(1/u)**(g*d[n])),m<r[n]&&m>t[n]?b[l]=Math.floor(C*u*g**(1/c[n]))+i:m>=r[n]?b[l]=h:b[l]=i;y[n]=b}else for(n=0;n<o;n++){for(b=[],l=0;l<f;l++)m=l+s,m<=t[n]?b[l]=i:m>=r[n]?b[l]=h:b[l]=Math.floor((m-t[n])/p[n]*u)+i;y[n]=b}if(e.contrastOffset!=null){const x=Mo(e.contrastOffset,e.brightnessOffset);for(n=0;n<o;n++)for(b=y[n],l=0;l<f;l++)b[l]=x[b[l]]}return{lut:y,offset:s}}function Mo(e,t){const r=Math.min(Math.max(e,-100),100),c=Math.min(Math.max(t!=null?t:0,-100),100),a=255,i=128;let h=0,o=0;const n=new Uint8Array(256);for(h=0;h<256;h++)r>0&&r<100?o=(200*h-100*a+2*a*c)/(2*(100-r))+i:r<=0&&r>-100?o=(200*h-100*a+2*a*c)*(100+r)/2e4+i:r===100?(o=200*h-100*a+(a+1)*(100-r)+2*a*c,o=o>0?a:0):r===-100&&(o=i),n[h]=o>a?a:o<0?0:o;return n}function Po(e,t,r){const c=[];for(let a=0;a<t.length;a++){let i=0,h=0,o=0;"min"in t[a]?{min:i,max:h,avg:o}=t[a]:[i,h,o]=t[a];let n=o!=null?o:0;e!=="u8"&&(n=255*(n-i)/(h-i)),r&&(n*=Io[a]),c.push(Do(n))}return c}function Do(e){if(e<=0||e>=255)return ot;let t=0;e!==150&&(t=e<=150?45*Math.cos(.01047*e):17*Math.sin(.021*e));const r=255,c=e+t,a=Math.log(e/r),i=Math.log(c/r);if(i===0)return ot;const h=a/i;return isNaN(h)?ot:Math.min(9.9,Math.max(.01,h))}function Ro(e){var v;if(we(e)||!((v=e.pixels)!=null&&v.length))return null;e.statistics||e.updateStatistics();const{pixels:t,mask:r,pixelType:c,statistics:a}=e,i=e.width*e.height,h=t.length;let o,n,l,s,f;const p=[],u=[];let w,d,g,y,m,C,b,x,k,T;const A=256;for(s=0;s<h;s++){if(w=new Uint32Array(A),g=t[s],c==="u8")if(o=-.5,n=255.5,r)for(f=0;f<i;f++)r[f]&&w[g[f]]++;else for(f=0;f<i;f++)w[g[f]]++;else{if(fe(a),o=a[s].minValue,n=a[s].maxValue,l=(n-o)/A,d=new Uint32Array(A+1),r)for(f=0;f<i;f++)r[f]&&d[Math.floor((g[f]-o)/l)]++;else for(f=0;f<i;f++)d[Math.floor((g[f]-o)/l)]++;for(f=0;f<255;f++)w[f]=d[f];w[255]=d[255]+d[256]}for(p.push({min:o,max:n,size:A,counts:w}),y=0,m=0,x=0,f=0;f<A;f++)y+=w[f],m+=f*w[f];for(k=m/y,f=0;f<A;f++)x+=w[f]*(f-k)**2;T=Math.sqrt(x/(y-1)),l=(n-o)/A,C=(k+.5)*l+o,b=T*l,u.push({min:o,max:n,avg:C,stddev:b})}return{statistics:u,histograms:p}}function pi(e){const t=[];for(let r=0;r<e.length;r++){const{min:c,max:a,size:i,counts:h}=e[r];let o=0,n=0;for(let w=0;w<i;w++)o+=h[w],n+=w*h[w];const l=n/o;let s=0;for(let w=0;w<i;w++)s+=h[w]*(w-l)**2;const f=(a-c)/i,p=(l+.5)*f+c,u=Math.sqrt(s/(o-1))*f;t.push({min:c,max:a,avg:p,stddev:u})}return t}function Oe(e,t){var A;const{pixelBlock:r,bandIds:c,returnHistogramLut:a,rasterInfo:i}=t;let h=null,o=null,n=e.stretchType;if(typeof n=="number"&&(n=Ao[n]),e.dra)if(n==="minMax"&&z(r)&&r.statistics)h=r.statistics.map(v=>[v.minValue,v.maxValue,0,0]);else{const v=Ro(r);h=z(v)?v.statistics:null,o=z(v)?v.histograms:null}else h=((A=e.statistics)==null?void 0:A.length)>0?e.statistics:pe(i.statistics),o=e.histograms||pe(i.histograms);n!=="percentClip"&&n!=="histogramEqualization"||(o==null?void 0:o.length)||(n="minMax");const l=(h==null?void 0:h.length)||(o==null?void 0:o.length)||i.bandCount,s=[],f=[];let p,u,w,d,g,y,m,C,b,x,k,T;switch(h&&!Array.isArray(h[0])&&(h=h.map(v=>[v.min,v.max,v.avg,v.stddev])),n){case"none":{const v=$t[i.pixelType]||$t.f32;for(C=0;C<l;C++)s[C]=v[0],f[C]=v[1]}break;case"minMax":for(fe(h),C=0;C<l;C++)s[C]=h[C][0],f[C]=h[C][1];break;case"standardDeviation":for(fe(h),C=0;C<l;C++)s[C]=h[C][2]-e.numberOfStandardDeviations*h[C][3],f[C]=h[C][2]+e.numberOfStandardDeviations*h[C][3],s[C]<h[C][0]&&(s[C]=h[C][0]),f[C]>h[C][1]&&(f[C]=h[C][1]);break;case"histogramEqualization":for(fe(o),C=0;C<l;C++)s[C]=o[C].min,f[C]=o[C].max;break;case"percentClip":for(fe(o),C=0;C<o.length;C++){for(p=o[C],g=new Uint32Array(p.size),d=[...p.counts],d.length>=20&&(d[0]=d[1]=d[2]=d[d.length-1]=d[d.length-2]=0),w=0,u=(p.max-p.min)/p.size,m=p.min===-.5&&u===1?.5:0,b=0;b<p.size;b++)w+=d[b],g[b]=w;for(y=(e.minPercent||0)*w/100,b=0;b<p.size;b++)if(g[b]>y){s[C]=p.min+u*(b+m);break}for(y=(1-(e.maxPercent||0)/100)*w,b=p.size-2;b>=0;b--)if(g[b]<y){f[C]=p.min+u*(b+2-m);break}}break;default:for(fe(h),C=0;C<l;C++)s[C]=h[C][0],f[C]=h[C][1]}return n==="histogramEqualization"?(fe(o),k=o[0].size||256,x=0,a&&(T=o.map(v=>cr(v)))):(k=e.max||255,x=e.min||0),Eo({minCutOff:s,maxCutOff:f,outMax:k,outMin:x,histogramLut:T},c)}function Eo(e,t){if(t==null||t.length===0)return e;const r=Math.max.apply(null,t),{minCutOff:c,maxCutOff:a,outMin:i,outMax:h,histogramLut:o}=e;return c.length===t.length||c.length<=r?e:{minCutOff:t.map(n=>c[n]),maxCutOff:t.map(n=>a[n]),histogramLut:o?t.map(n=>o[n]):null,outMin:i,outMax:h}}function it(e,t){var v;if(we(e)||!((v=e.pixels)!=null&&v.length))return e;const{mask:r,width:c,height:a,pixels:i}=e,{minCutOff:h,maxCutOff:o,gamma:n}=t,l=t.outMin||0,s=t.outMax||255,f=c*a,p=t.outputPixelType||"u8",u=e.pixels.map(()=>K.createEmptyBand(p,f)),w=u.length;let d,g,y,m,C;const b=s-l,x=[];for(d=0;d<w;d++)x[d]=o[d]-h[d],o[d],h[d];const k=n&&n.length>=w,T=[];if(k)for(d=0;d<w;d++)n[d]>1?n[d]>2?T[d]=6.5+(n[d]-2)**2.5:T[d]=6.5+100*(2-n[d])**4:T[d]=1;if(k)if(r!=null){for(g=0;g<f;g++)if(r[g])for(d=0;d<w;d++)y=i[d][g],C=(y-h[d])/x[d],m=1,n[d]>1&&(m-=(1/b)**(C*T[d])),y<o[d]&&y>h[d]?u[d][g]=Math.floor(m*b*C**(1/n[d]))+l:y>=o[d]?u[d][g]=s:u[d][g]=l}else for(g=0;g<f;g++)for(d=0;d<w;d++)y=i[d][g],C=(y-h[d])/x[d],m=1,n[d]>1&&(m-=(1/b)**(C*T[d])),y<o[d]&&y>h[d]?u[d][g]=Math.floor(m*b*C**(1/n[d]))+l:y>=o[d]?u[d][g]=s:u[d][g]=l;else if(r!=null){for(g=0;g<f;g++)if(r[g])for(d=0;d<w;d++)y=i[d][g],y<o[d]&&y>h[d]?u[d][g]=Math.floor((y-h[d])/x[d]*b)+l:y>=o[d]?u[d][g]=s:u[d][g]=l}else for(g=0;g<f;g++)for(d=0;d<w;d++)y=i[d][g],y<o[d]&&y>h[d]?u[d][g]=Math.floor((y-h[d])/x[d]*b)+l:y>=o[d]?u[d][g]=s:u[d][g]=l;const A=new K({width:c,height:a,mask:r,pixels:u,pixelType:p});return A.updateStatistics(),A}const Ie=new Map;Ie.set("meter-per-second",1),Ie.set("kilometer-per-hour",.277778),Ie.set("knots",.514444),Ie.set("feet-per-second",.3048),Ie.set("mile-per-hour",.44704);const at=180/Math.PI,di=new Wt({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function mi(e,t){return Ie.get(e)/Ie.get(t)||1}function hr(e){return(450-e)%360}function Lo(e,t="geographic"){const[r,c]=e,a=Math.sqrt(r*r+c*c);let i=Math.atan2(c,r)*at;return i=(360+i)%360,t==="geographic"&&(i=hr(i)),[a,i]}function Uo(e,t="geographic"){let r=e[1];t==="geographic"&&(r=hr(r)),r%=360;const c=e[0];return[c*Math.cos(r/at),c*Math.sin(r/at)]}function gi(e,t,r,c="geographic"){if(!Z(e)||we(r))return e;const a=t==="vector-magdir"?e.clone():pe(jt(e,t)),i=a.pixels[1];for(let h=0;h<i.length;h++)i[h]=c==="geographic"?(i[h]+r[h]+270)%360:(i[h]+360-r[h])%360;return t==="vector-magdir"?a:jt(a,"vector-magdir")}function jt(e,t,r="geographic",c=1){if(!Z(e))return e;const{pixels:a,width:i,height:h}=e,o=i*h,n=a[0],l=a[1],s=e.pixelType.startsWith("f")?e.pixelType:"f32",f=K.createEmptyBand(s,o),p=K.createEmptyBand(s,o);let u=0;for(let d=0;d<h;d++)for(let g=0;g<i;g++)t==="vector-uv"?([f[u],p[u]]=Lo([n[u],l[u]],r),f[u]*=c):([f[u],p[u]]=Uo([n[u],l[u]],r),f[u]*=c,p[u]*=c),u++;const w=new K({pixelType:s,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[f,p]});return w.updateStatistics(),w}function yi(e,t,r=1){if(r===1||!Z(e))return e;const c=e.clone(),{pixels:a,width:i,height:h}=c,o=a[0],n=a[1];let l=0;for(let s=0;s<h;s++)for(let f=0;f<i;f++)t==="vector-uv"?(o[l]*=r,n[l]*=r):o[l]*=r,l++;return c.updateStatistics(),c}var lt;let ne=lt=class extends Ye{constructor(){super(...arguments),this.blockWidth=void 0,this.blockHeight=void 0,this.compression=null,this.origin=null,this.firstPyramidLevel=null,this.maximumPyramidLevel=null,this.pyramidScalingFactor=2,this.pyramidBlockWidth=null,this.pyramidBlockHeight=null,this.isVirtualTileInfo=!1,this.tileInfo=null,this.transposeInfo=null,this.blockBoundary=null}clone(){return new lt({blockWidth:this.blockWidth,blockHeight:this.blockHeight,compression:this.compression,origin:re(this.origin),firstPyramidLevel:this.firstPyramidLevel,maximumPyramidLevel:this.maximumPyramidLevel,pyramidResolutions:re(this.pyramidResolutions),pyramidScalingFactor:this.pyramidScalingFactor,pyramidBlockWidth:this.pyramidBlockWidth,pyramidBlockHeight:this.pyramidBlockHeight,isVirtualTileInfo:this.isVirtualTileInfo,tileInfo:re(this.tileInfo),transposeInfo:re(this.transposeInfo),blockBoundary:re(this.blockBoundary)})}};$([j({type:Number,json:{write:!0}})],ne.prototype,"blockWidth",void 0),$([j({type:Number,json:{write:!0}})],ne.prototype,"blockHeight",void 0),$([j({type:String,json:{write:!0}})],ne.prototype,"compression",void 0),$([j({type:yr,json:{write:!0}})],ne.prototype,"origin",void 0),$([j({type:Number,json:{write:!0}})],ne.prototype,"firstPyramidLevel",void 0),$([j({type:Number,json:{write:!0}})],ne.prototype,"maximumPyramidLevel",void 0),$([j({json:{write:!0}})],ne.prototype,"pyramidResolutions",void 0),$([j({type:Number,json:{write:!0}})],ne.prototype,"pyramidScalingFactor",void 0),$([j({type:Number,json:{write:!0}})],ne.prototype,"pyramidBlockWidth",void 0),$([j({type:Number,json:{write:!0}})],ne.prototype,"pyramidBlockHeight",void 0),$([j({type:Boolean,json:{write:!0}})],ne.prototype,"isVirtualTileInfo",void 0),$([j({json:{write:!0}})],ne.prototype,"tileInfo",void 0),$([j()],ne.prototype,"transposeInfo",void 0),$([j()],ne.prototype,"blockBoundary",void 0),ne=lt=$([He("esri.layers.support.RasterStorageInfo")],ne);const Bo=ne;var ct;let ee=ct=class extends Ye{constructor(e){super(e),this.attributeTable=null,this.bandCount=null,this.colormap=null,this.extent=null,this.format=void 0,this.height=null,this.width=null,this.histograms=null,this.keyProperties={},this.multidimensionalInfo=null,this.noDataValue=null,this.pixelSize=null,this.pixelType=null,this.isPseudoSpatialReference=!1,this.spatialReference=null,this.statistics=null,this.storageInfo=null,this.transform=null}get dataType(){var t,r,c;const e=(c=(r=(t=this.keyProperties)==null?void 0:t.DataType)==null?void 0:r.toLowerCase())!=null?c:"generic";return e==="stdtime"?"standard-time":e}get nativeExtent(){return this._get("nativeExtent")||this.extent}set nativeExtent(e){e&&this._set("nativeExtent",e)}get nativePixelSize(){if(we(this.transform)||!this.transform.affectsPixelSize)return this.pixelSize;const e=this.nativeExtent;return{x:e.width/this.width,y:e.height/this.height}}get hasMultidimensionalTranspose(){var e;return!!((e=this.storageInfo)!=null&&e.transposeInfo)}clone(){return new ct({attributeTable:re(this.attributeTable),bandCount:this.bandCount,colormap:re(this.colormap),extent:re(this.extent),nativePixelSize:re(this.nativePixelSize),format:this.format,height:this.height,width:this.width,histograms:re(this.histograms),keyProperties:re(this.keyProperties),multidimensionalInfo:re(this.multidimensionalInfo),noDataValue:this.noDataValue,pixelSize:re(this.pixelSize),pixelType:this.pixelType,isPseudoSpatialReference:this.isPseudoSpatialReference,spatialReference:re(this.spatialReference),statistics:re(this.statistics),storageInfo:re(this.storageInfo),transform:re(this.transform)})}};$([j({json:{write:!0}})],ee.prototype,"attributeTable",void 0),$([j({json:{write:!0}})],ee.prototype,"bandCount",void 0),$([j({json:{write:!0}})],ee.prototype,"colormap",void 0),$([j({type:String,readOnly:!0})],ee.prototype,"dataType",null),$([j({type:wt,json:{write:!0}})],ee.prototype,"extent",void 0),$([j({type:wt,json:{write:!0}})],ee.prototype,"nativeExtent",null),$([j({json:{write:!0}})],ee.prototype,"nativePixelSize",null),$([j({json:{write:!0}})],ee.prototype,"format",void 0),$([j({json:{write:!0}})],ee.prototype,"height",void 0),$([j({json:{write:!0}})],ee.prototype,"width",void 0),$([j({json:{write:!0}})],ee.prototype,"hasMultidimensionalTranspose",null),$([j({json:{write:!0}})],ee.prototype,"histograms",void 0),$([j({json:{write:!0}})],ee.prototype,"keyProperties",void 0),$([j({json:{write:!0}})],ee.prototype,"multidimensionalInfo",void 0),$([j({json:{write:!0}})],ee.prototype,"noDataValue",void 0),$([j({json:{write:!0}})],ee.prototype,"pixelSize",void 0),$([j({json:{write:!0}})],ee.prototype,"pixelType",void 0),$([j()],ee.prototype,"isPseudoSpatialReference",void 0),$([j({type:wr,json:{write:!0}})],ee.prototype,"spatialReference",void 0),$([j({json:{write:!0}})],ee.prototype,"statistics",void 0),$([j({type:Bo,json:{write:!0}})],ee.prototype,"storageInfo",void 0),$([j({json:{write:!0}})],ee.prototype,"transform",void 0),ee=ct=$([He("esri.layers.support.RasterInfo")],ee);const _o=ee;function Oo(e,t){const{attributeTable:r,bandCount:c}=e;return!(we(r)||c>1||t&&r.fields.find(a=>a.name.toLowerCase()===t.toLowerCase())==null)}function Go(e){const{bandCount:t,dataType:r,pixelType:c}=e;return r==="elevation"||r==="generic"&&t===1&&(c==="s16"||c==="f32"||c==="f64")}function Fo(e){const{bandCount:t,colormap:r}=e;return z(r)&&r.length>0&&t===1}let Ae=class extends Ye{constructor(e){super(e)}bind(){const{rendererJSON:e}=this;if(!e)return{success:!1};let t;switch(this.lookup={rendererJSON:{}},e.type){case"uniqueValue":t=this._updateUVRenderer(e);break;case"rasterColormap":t=this._updateColormapRenderer(e);break;case"rasterStretch":t=this._updateStretchRenderer(e);break;case"classBreaks":t=this._updateClassBreaksRenderer(e);break;case"rasterShadedRelief":t=this._updateShadedReliefRenderer(e);break;case"vectorField":t=this._updateVectorFieldRenderer();break;case"flowRenderer":t=this._updateFlowRenderer()}return t}symbolize(e){let t=e&&e.pixelBlock;if(!zt(t))return t;if(e.simpleStretchParams&&this.rendererJSON.type==="rasterStretch")return this.simpleStretch(t,e.simpleStretchParams);try{let r;switch(t.pixels.length>3&&(t=Lt(t,[0,1,2])),this.rendererJSON.type){case"uniqueValue":case"rasterColormap":r=this._symbolizeColormap(t);break;case"classBreaks":r=this._symbolizeClassBreaks(t);break;case"rasterStretch":r=this._symbolizeStretch(t,e.bandIds);break;case"rasterShadedRelief":{const c=e.extent,a=c.spatialReference.isGeographic,i={x:(c.xmax-c.xmin)/t.width,y:(c.ymax-c.ymin)/t.height};r=this._symbolizeShadedRelief(t,{isGCS:a,resolution:i});break}}return r}catch(r){return ge.getLogger(this.declaredClass).error("symbolize",r.message),t}}simpleStretch(e,t){if(!zt(e))return e;try{return e.pixels.length>3&&(e=Lt(e,[0,1,2])),it(e,t)}catch(r){return ge.getLogger(this.declaredClass).error("symbolize",r.message),e}}generateWebGLParameters(e){if(["uniqueValue","rasterColormap","classBreaks"].includes(this.rendererJSON.type)){const{indexedColormap:h,offset:o}=this.lookup.colormapLut||{};return{colormap:h,colormapOffset:o,type:"lut"}}const{pixelBlock:t,isGCS:r,resolution:c,bandIds:a}=e,{rendererJSON:i}=this;return i.type==="rasterStretch"?this._generateStretchWebGLParams(t,i,a):i.type==="rasterShadedRelief"?this._generateShadedReliefWebGLParams(i,r,c):i.type==="vectorField"?this._generateVectorFieldWebGLParams(i):null}_isLUTChanged(e){if(!this.lookup||!this.lookup.rendererJSON)return!0;if("colorRamp"in this.rendererJSON){const t=this.rendererJSON.colorRamp;return e?JSON.stringify(t)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(e){return this._isLUTChanged()&&!this.bind().success?e:tt(e,this.lookup.colormapLut)}_symbolizeClassBreaks(e){var r;const{canUseIndexedLUT:t}=this._analyzeClassBreaks(this.rendererJSON);return this._isLUTChanged()&&!this.bind().success?e:t?tt(e,this.lookup.colormapLut):lo(e,(r=this.lookup.remapLut)!=null?r:[])}_symbolizeStretch(e,t){var f,p,u;const{rasterInfo:r}=this,{pixelType:c,bandCount:a}=r,i=this.rendererJSON,h=["u8","u16","s8","s16"].includes(c);let o,n;const{dra:l}=i,{gamma:s}=this.lookup;if(i.stretchType==="histogramEqualization"){const w=l?null:(f=this.lookup)==null?void 0:f.histogramLut,d=Oe(i,{rasterInfo:r,pixelBlock:e,bandIds:t,returnHistogramLut:!w}),g=it(e,{...d,gamma:s});n=Ut(g,{lut:l?d.histogramLut:w,offset:0})}else if(h){if(l){const w=Oe(i,{rasterInfo:r,pixelBlock:e,bandIds:t});o=Vt({pixelType:c,...w,gamma:s})}else if(this._isLUTChanged()){if(!this.bind().success)return e;o=this.lookup?this.lookup.stretchLut:null}else o=this.lookup?this.lookup.stretchLut:null;if(!o)return e;a>1&&(t==null?void 0:t.length)===((p=pe(e))==null?void 0:p.pixels.length)&&(o==null?void 0:o.lut.length)===a&&(o={lut:t.map(w=>o.lut[w]),offset:o.offset}),n=Ut(e,o)}else{const w=Oe(i,{rasterInfo:r,pixelBlock:e,bandIds:t});n=it(e,{...w,gamma:s})}if(i.colorRamp){if(this._isLUTChanged(!0)&&!this.bind().success)return e;n=tt(n,(u=this.lookup)==null?void 0:u.colormapLut)}return n}_symbolizeShadedRelief(e,t){var o,n;const r=this.rendererJSON,c={...r,...t},a=mo(e,c);if(!r.colorRamp)return a;let i;if(this._isLUTChanged(!0)){if(!this.bind().success)return a;i=this.lookup?this.lookup.hsvMap:null}else i=this.lookup?this.lookup.hsvMap:null;if(!i)return a;const h=(n=(o=pe(this.rasterInfo.statistics))==null?void 0:o[0])!=null?n:{min:0,max:8e3};return go(a,e,i,h),a}_isVectorFieldData(){const{bandCount:e,dataType:t}=this.rasterInfo;return e===2&&(t==="vector-magdir"||t==="vector-uv")}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; VectorFieldRenderer only supports "vector-magdir" and "vector-uv".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; FlowRenderer only supports "vector-magdir" and "vector-uv".`}}_updateUVRenderer(e){var l;const{bandCount:t,attributeTable:r,pixelType:c}=this.rasterInfo,a=e.field1;if(!a)return{success:!1,error:"Unsupported renderer; missing UniqueValueRenderer.field."};const i=e.defaultSymbol,h=t===1&&["u8","s8"].includes(c);if(!Oo(this.rasterInfo,a)&&!h)return{success:!1,error:"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table."};const o=[];if(z(r)){const s=r.fields.find(f=>f.name.toLowerCase()==="value");if(!s)return{success:!1,error:"Unsupported data; the data's raster attribute table does not have a value field."};r.features.forEach(f=>{var w,d;const p=(w=e.uniqueValueInfos)==null?void 0:w.find(g=>String(g.value)===String(f.attributes[a])),u=(d=p==null?void 0:p.symbol)==null?void 0:d.color;u?o.push([f.attributes[s.name]].concat(u)):i&&o.push([f.attributes[s.name]].concat(i.color))})}else{if(a.toLowerCase()!=="value")return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be "Value" when raster attribute table is not availalbe.'};(l=e.uniqueValueInfos)==null||l.forEach(s=>{var p;const f=(p=s==null?void 0:s.symbol)==null?void 0:p.color;f?o.push([parseInt(""+s.value,10)].concat(f)):i&&o.push([parseInt(""+s.value,10)].concat(i==null?void 0:i.color))})}if(o.length===0)return{success:!1,error:"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table."};const n=Be({colormap:o});return this.lookup={rendererJSON:e,colormapLut:n},this.canRenderInWebGL=!0,{success:!0}}_updateColormapRenderer(e){if(!Fo(this.rasterInfo))return{success:!1,error:"Unsupported data; the data source does not have a colormap."};const t=e.colormapInfos.map(c=>[c.value].concat(c.color)).sort((c,a)=>c[0]-a[0]);if(!t||t.length===0)return{success:!1,error:"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos."};const r=Be({colormap:t});return this.lookup={rendererJSON:e,colormapLut:r},this.canRenderInWebGL=!0,{success:!0}}_updateShadedReliefRenderer(e){if(!Go(this.rasterInfo))return{success:!1,error:`Unsupported data type "${this.rasterInfo.dataType}"; ShadedReliefRenderer only supports "elevation", or single band float/s16 data.`};if(e.colorRamp){const t=Gt(e.colorRamp,256,!0),r=Be({colormap:t}),c=[],a=r.indexedColormap;for(let i=0;i<a.length;i+=4){const h=We({r:a[i],g:a[i+1],b:a[i+2]});c.push([h.h/60,h.s/100,255*h.v/100])}this.lookup={rendererJSON:e,colormapLut:r,hsvMap:c}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_analyzeClassBreaks(e){const{attributeTable:t,pixelType:r}=this.rasterInfo,c=z(t)?t.fields.find(h=>h.name.toLowerCase()==="value"):null,a=z(t)?t.fields.find(h=>h.name.toLowerCase()===e.field.toLowerCase()):null,i=c!=null&&a!==null;return{canUseIndexedLUT:["u8","u16","s8","s16"].includes(r)||i,tableValueField:c,tableBreakField:a}}_updateClassBreaksRenderer(e){var f;const{attributeTable:t}=this.rasterInfo,{canUseIndexedLUT:r,tableValueField:c,tableBreakField:a}=this._analyzeClassBreaks(e),i=e.classBreakInfos;if(!(i!=null&&i.length))return{success:!1,error:"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos."};const h=i.sort((p,u)=>p.classMaxValue-u.classMaxValue),o=h[h.length-1];let n=e.minValue;if(!r){const p=[];for(let u=0;u<h.length;u++)p.push({value:(f=h[u].classMinValue)!=null?f:n,mappedColor:h[u].symbol.color}),n=h[u].classMaxValue;return p.push({value:o.classMaxValue,mappedColor:o.symbol.color}),this.lookup={rendererJSON:e,remapLut:p},this.canRenderInWebGL=!1,{success:!0}}const l=[];if(z(t)&&c!=null&&a!==null&&c!==a){const p=c.name,u=a.name,w=h[h.length-1],{classMaxValue:d}=w;n=e.minValue;for(const g of t.features){const y=g.attributes[p],m=g.attributes[u],C=m===d?w:m<n?null:h.find(({classMaxValue:b})=>b>m);C&&l.push([y].concat(C.symbol.color))}}else{n=Math.floor(e.minValue);for(let p=0;p<h.length;p++){const u=h[p];for(let w=n;w<u.classMaxValue;w++)l.push([w].concat(u.symbol.color));n=Math.ceil(u.classMaxValue)}o.classMaxValue===n&&l.push([o.classMaxValue].concat(o.symbol.color))}const s=Be({colormap:l,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:s},this.canRenderInWebGL=!0,{success:!0}}_isHistogramRequired(e){return e==="percentClip"||e==="histogramEqualization"}_isValidRasterStatistics(e){return z(e)&&e.length>0&&e[0].min!=null&&e[0].max!=null}_updateStretchRenderer(e){var s,f;let{stretchType:t,dra:r}=e;if(!(t==="none"||((s=e.statistics)==null?void 0:s.length)||this._isValidRasterStatistics(this.rasterInfo.statistics)||r))return{success:!1,error:"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used."};const c=pe(e.histograms||this.rasterInfo.histograms);!this._isHistogramRequired(e.stretchType)||(c==null?void 0:c.length)||r||(t="minMax");const{computeGamma:a,useGamma:i,colorRamp:h}=e;let{gamma:o}=e;if(i&&a&&!(o!=null&&o.length)){const p=(f=e.statistics)!=null&&f.length?e.statistics:pe(this.rasterInfo.statistics);o=Po(this.rasterInfo.pixelType,p)}const n=this.rasterInfo.pixelType,l=!r&&["u8","u16","s8","s16"].includes(n);if(t==="histogramEqualization"){const p=c.map(u=>cr(u));this.lookup={rendererJSON:e,histogramLut:p}}else if(l){const p=Oe(e,{rasterInfo:this.rasterInfo}),u=Vt({pixelType:n,...p,gamma:i?o:null});this.lookup={rendererJSON:e,stretchLut:u}}if(h){const p=Gt(h,256,!0);this.lookup||(this.lookup={rendererJSON:e}),this.lookup.colormapLut=Be({colormap:p}),this.lookup.rendererJSON=e}return this.lookup.gamma=i&&(o==null?void 0:o.length)?o:null,this.canRenderInWebGL=!0,{success:!0}}_generateStretchWebGLParams(e,t,r){let c=null,a=null;const i=this.lookup&&this.lookup.colormapLut;t.colorRamp&&i&&(c=i.indexedColormap,a=i.offset),t.stretchType==="histogramEqualization"&&(t={...t,stretchType:"minMax"});const{gamma:h}=this.lookup,o=!!(t.useGamma&&h&&h.some(m=>m!==1)),{minCutOff:n,maxCutOff:l,outMin:s,outMax:f}=Oe(t,{rasterInfo:this.rasterInfo,pixelBlock:e,bandIds:r});let p=0;z(e)&&(p=e.getPlaneCount(),p===2&&((e=e.clone()).statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]));const u=Math.min(3,(r==null?void 0:r.length)||p||this.rasterInfo.bandCount),w=new Float32Array(u),d=c||o?1:255;let g;for(g=0;g<u;g++)w[g]=(f-s)/(l[g]-n[g])/d;const y=new Float32Array(u);if(o)for(g=0;g<u;g++)h[g]>1?h[g]>2?y[g]=6.5+(h[g]-2)**2.5:y[g]=6.5+100*(2-h[g])**4:y[g]=1;return{bandCount:u,outMin:s/d,outMax:f/d,minCutOff:n,maxCutOff:l,factor:w,useGamma:o,gamma:o?h:[1,1,1],gammaCorrection:o?y:[1,1,1],colormap:c,colormapOffset:a,stretchType:t.stretchType,type:"stretch"}}_generateShadedReliefWebGLParams(e,t=!1,r={x:0,y:0}){var l,s,f;let c=null,a=null;const i=this.lookup&&this.lookup.colormapLut;e.colorRamp&&i&&(c=i.indexedColormap,a=i.offset);const h={...e,isGCS:t,resolution:r},o=ar(h),n=(l=pe(this.rasterInfo.statistics))==null?void 0:l[0];return{...o,minValue:(s=n==null?void 0:n.min)!=null?s:0,maxValue:(f=n==null?void 0:n.max)!=null?f:8e3,hillshadeType:e.hillshadeType==="traditional"?0:1,type:"hillshade",colormap:c,colormapOffset:a}}_generateVectorFieldWebGLParams(e){var y,m,C,b,x,k,T,A;const{style:t,inputUnit:r,outputUnit:c,visualVariables:a,symbolTileSize:i,flowRepresentation:h}=e;let o;const n=(m=(y=this.rasterInfo.statistics)==null?void 0:y[0].min)!=null?m:0,l=(b=(C=this.rasterInfo.statistics)==null?void 0:C[0].max)!=null?b:50,s=(x=a==null?void 0:a.find(v=>v.type==="sizeInfo"))!=null?x:{type:"sizeInfo",field:"Magnitude",maxDataValue:l,maxSize:.8*i,minDataValue:n,minSize:.2*i},f=(k=s.minDataValue)!=null?k:n,p=(T=s.maxDataValue)!=null?T:l,u=z(s.maxSize)&&z(s.minSize)?[s.minSize/i,s.maxSize/i]:[.2,.8];if(t==="wind_speed"){const v=(u[0]+u[1])/2;u[0]=u[1]=v}const w=z(f)&&z(p)?[f,p]:null;if(t==="classified_arrow")if(z(f)&&z(p)&&z(s)){o=[];const v=(s.maxDataValue-s.minDataValue)/5;for(let M=0;M<6;M++)o.push(s.minDataValue+v*M)}else o=[0,1e-6,3.5,7,10.5,14];const d=h==="flow_to"==(t==="ocean_current_kn"||t==="ocean_current_m")?0:Math.PI,g=a==null?void 0:a.find(v=>v.type==="rotationInfo");return{breakValues:o,dataRange:w,inputUnit:r,outputUnit:c,symbolTileSize:i,symbolPercentRange:u,style:t||"single_arrow",rotation:d,rotationType:((A=this.rasterInfo.storageInfo)==null?void 0:A.tileInfo)&&this.rasterInfo.dataType==="vector-uv"?"geographic":(g==null?void 0:g.rotationType)||e.rotationType,type:"vectorField"}}};function zt(e){return Z(e)&&e.validPixelCount!==0}$([j({json:{write:!0}})],Ae.prototype,"rendererJSON",void 0),$([j({type:_o,json:{write:!0}})],Ae.prototype,"rasterInfo",void 0),$([j({json:{write:!0}})],Ae.prototype,"lookup",void 0),$([j()],Ae.prototype,"canRenderInWebGL",void 0),Ae=$([He("esri.renderers.support.RasterSymbolizer")],Ae);const wi=Ae,De=ge.getLogger("esri.views.2d.engine.flow.dataUtils"),No=10;async function Ci(e,t,r,c){const a=performance.now(),i=$o(t,r),h=performance.now(),o=jo(t,i,r.width,r.height),n=performance.now(),l=Wo(o,!0),s=performance.now(),f=e==="Streamlines"?Ko(l,No):Jo(l),p=performance.now();return Cr("esri-2d-profiler")&&(De.info("I.1","_createFlowFieldFromData (ms)",Math.round(h-a)),De.info("I.2","_getStreamlines (ms)",Math.round(n-h)),De.info("I.3","createAnimatedLinesData (ms)",Math.round(s-n)),De.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(p-s)),De.info("I.5","createFlowMesh (ms)",Math.round(p-a)),De.info("I.6","Mesh size (bytes)",f.vertexData.buffer.byteLength+f.indexData.buffer.byteLength)),await Promise.resolve(),xr(c),f}function $o(e,t){const r=zo(t.data,t.width,t.height,e.smoothing);return e.interpolate?(c,a)=>{const i=Math.floor(c),h=Math.floor(a);if(i<0||i>=t.width)return[0,0];if(h<0||h>=t.height)return[0,0];const o=c-i,n=a-h,l=i,s=h,f=i<t.width-1?i+1:i,p=h<t.height-1?h+1:h,u=r[2*(s*t.width+l)],w=r[2*(s*t.width+f)],d=r[2*(p*t.width+l)],g=r[2*(p*t.width+f)],y=r[2*(s*t.width+l)+1],m=r[2*(s*t.width+f)+1];return[(u*(1-n)+d*n)*(1-o)+(w*(1-n)+g*n)*o,(y*(1-n)+r[2*(p*t.width+l)+1]*n)*(1-o)+(m*(1-n)+r[2*(p*t.width+f)+1]*n)*o]}:(c,a)=>{const i=Math.round(c),h=Math.round(a);return i<0||i>=t.width||h<0||h>=t.height?[0,0]:[r[2*(h*t.width+i)+0],r[2*(h*t.width+i)+1]]}}function Vo(e,t,r,c,a,i,h,o,n){const l=[];let s=r,f=c,p=0,[u,w]=t(s,f);u*=e.velocityScale,w*=e.velocityScale;const d=Math.sqrt(u*u+w*w);let g,y;l.push({x:s,y:f,t:p,speed:d});for(let m=0;m<e.verticesPerLine;m++){let[C,b]=t(s,f);C*=e.velocityScale,b*=e.velocityScale;const x=Math.sqrt(C*C+b*b);if(x<e.minSpeedThreshold)return l;const k=C/x,T=b/x;if(s+=k*e.segmentLength,f+=T*e.segmentLength,p+=e.segmentLength/x,Math.acos(k*g+T*y)>e.maxTurnAngle)return l;if(e.collisions){const A=Math.round(s*n),v=Math.round(f*n);if(A<0||A>h-1||v<0||v>o-1)return l;const M=i[v*h+A];if(M!==-1&&M!==a)return l;i[v*h+A]=a}l.push({x:s,y:f,t:p,speed:x}),g=k,y=T}return l}function jo(e,t,r,c){const a=[],i=new Kt,h=1/Math.max(e.lineCollisionWidth,1),o=Math.round(r*h),n=Math.round(c*h),l=new Int32Array(o*n);for(let f=0;f<l.length;f++)l[f]=-1;const s=[];for(let f=0;f<c;f+=e.lineSpacing)for(let p=0;p<r;p+=e.lineSpacing)s.push({x:p,y:f,sort:i.getFloat()});s.sort((f,p)=>f.sort-p.sort);for(const{x:f,y:p}of s)if(i.getFloat()<e.density){const u=Vo(e,t,f,p,a.length,l,o,n,h);if(u.length<2)continue;a.push(u)}return a}function zo(e,t,r,c){if(c===0)return e;const a=Math.round(3*c),i=new Array(2*a+1);let h=0;for(let l=-a;l<=a;l++){const s=Math.exp(-l*l/(c*c));i[l+a]=s,h+=s}for(let l=-a;l<=a;l++)i[l+a]/=h;const o=new Float32Array(e.length);for(let l=0;l<r;l++)for(let s=0;s<t;s++){let f=0,p=0;for(let u=-a;u<=a;u++){if(s+u<0||s+u>=t)continue;const w=i[u+a];f+=w*e[2*(l*t+(s+u))+0],p+=w*e[2*(l*t+(s+u))+1]}o[2*(l*t+s)+0]=f,o[2*(l*t+s)+1]=p}const n=new Float32Array(e.length);for(let l=0;l<t;l++)for(let s=0;s<r;s++){let f=0,p=0;for(let u=-a;u<=a;u++){if(s+u<0||s+u>=r)continue;const w=i[u+a];f+=w*o[2*((s+u)*t+l)+0],p+=w*o[2*((s+u)*t+l)+1]}n[2*(s*t+l)+0]=f,n[2*(s*t+l)+1]=p}return n}function Wo(e,t){const r=new Kt,c=e.reduce((n,l)=>n+l.length,0),a=new Float32Array(4*c),i=new Array(e.length);let h=0,o=0;for(const n of e){const l=h;for(const s of n)a[4*h+0]=s.x,a[4*h+1]=s.y,a[4*h+2]=s.t,a[4*h+3]=s.speed,h++;i[o++]={startVertex:l,numberOfVertices:n.length,totalTime:n[n.length-1].t,timeSeed:t?r.getFloat():0}}return{lineVertices:a,lineDescriptors:i}}function Ko(e,t){const{lineVertices:c,lineDescriptors:a}=e;let i=0,h=0;for(const u of a)i+=2*u.numberOfVertices,h+=6*(u.numberOfVertices-1);const o=new Float32Array(i*9),n=new Uint32Array(h);let l=0,s=0;function f(){n[s++]=l-2,n[s++]=l,n[s++]=l-1,n[s++]=l,n[s++]=l+1,n[s++]=l-1}function p(u,w,d,g,y,m,C,b){const x=l*9;let k=0;o[x+k++]=u,o[x+k++]=w,o[x+k++]=1,o[x+k++]=d,o[x+k++]=m,o[x+k++]=C,o[x+k++]=g/2,o[x+k++]=y/2,o[x+k++]=b,l++,o[x+k++]=u,o[x+k++]=w,o[x+k++]=-1,o[x+k++]=d,o[x+k++]=m,o[x+k++]=C,o[x+k++]=-g/2,o[x+k++]=-y/2,o[x+k++]=b,l++}for(const u of a){const{totalTime:w,timeSeed:d}=u;let g=null,y=null,m=null,C=null,b=null,x=null;for(let k=0;k<u.numberOfVertices;k++){const T=c[4*(u.startVertex+k)+0],A=c[4*(u.startVertex+k)+1],v=c[4*(u.startVertex+k)+2],M=c[4*(u.startVertex+k)+3];let D=null,R=null,E=null,P=null;if(k>0){D=T-g,R=A-y;const S=Math.sqrt(D*D+R*R);if(D/=S,R/=S,k>1){let I=D+b,L=R+x;const B=Math.sqrt(I*I+L*L);I/=B,L/=B;const N=Math.min(1/(I*D+L*R),t);I*=N,L*=N,E=-L,P=I}else E=-R,P=D;E!==null&&P!==null&&(p(g,y,m,E,P,w,d,M),f())}g=T,y=A,m=v,b=D,x=R,C=M}p(g,y,m,-x,b,w,d,C)}return{vertexData:o,indexData:n}}function Jo(e){const{lineVertices:a,lineDescriptors:i}=e;let h=0,o=0;for(const S of i){const I=S.numberOfVertices-1;h+=4*I*2,o+=6*I*2}const n=new Float32Array(h*16),l=new Uint32Array(o);let s,f,p,u,w,d,g,y,m,C,b,x,k,T,A=0,v=0;function M(){l[v++]=A-8,l[v++]=A-7,l[v++]=A-6,l[v++]=A-7,l[v++]=A-5,l[v++]=A-6,l[v++]=A-4,l[v++]=A-3,l[v++]=A-2,l[v++]=A-3,l[v++]=A-1,l[v++]=A-2}function D(S,I,L,B,N,U,O,_,F,V,Q,te,Ce,xe){const q=A*16;let H=0;for(const he of[1,2])for(const de of[1,2,3,4])n[q+H++]=S,n[q+H++]=I,n[q+H++]=L,n[q+H++]=B,n[q+H++]=O,n[q+H++]=_,n[q+H++]=F,n[q+H++]=V,n[q+H++]=he,n[q+H++]=de,n[q+H++]=Ce,n[q+H++]=xe,n[q+H++]=N/2,n[q+H++]=U/2,n[q+H++]=Q/2,n[q+H++]=te/2,A++}function R(S,I){let L=m+b,B=C+x;const N=Math.sqrt(L*L+B*B);L/=N,B/=N;const U=m*L+C*B;L/=U,B/=U;let O=b+k,_=x+T;const F=Math.sqrt(O*O+_*_);O/=F,_/=F;const V=b*O+x*_;O/=V,_/=V,D(s,f,p,u,-B,L,w,d,g,y,-_,O,S,I),M()}function E(S,I,L,B,N,U){if(m=b,C=x,b=k,x=T,m==null&&C==null&&(m=b,C=x),w!=null&&d!=null){k=S-w,T=I-d;const O=Math.sqrt(k*k+T*T);k/=O,T/=O}m!=null&&C!=null&&R(N,U),s=w,f=d,p=g,u=y,w=S,d=I,g=L,y=B}function P(S,I){m=b,C=x,b=k,x=T,m==null&&C==null&&(m=b,C=x),m!=null&&C!=null&&R(S,I)}for(const S of i){s=null,f=null,p=null,u=null,w=null,d=null,g=null,y=null,m=null,C=null,b=null,x=null,k=null,T=null;const{totalTime:I,timeSeed:L}=S;for(let B=0;B<S.numberOfVertices;B++)E(a[4*(S.startVertex+B)+0],a[4*(S.startVertex+B)+1],a[4*(S.startVertex+B)+2],a[4*(S.startVertex+B)+3],I,L);P(I,L)}return{vertexData:n,indexData:l}}export{Bo as A,_o as B,Lo as C,ai as D,Ao as E,di as F,mi as G,yi as H,yo as I,Pr as J,pi as K,ii as L,pt as M,zr as N,dt as O,qo as P,Ee as Q,Wr as R,Xo as S,wi as T,$r as U,mt as V,ni as W,hi as _,oi as a,Et as b,So as c,jt as d,Ut as e,Ci as f,K as g,Zo as h,Rt as i,si as j,ri as k,li as l,gi as m,Oe as n,ci as o,Ro as p,it as q,Z as r,Gt as s,fi as t,Vt as u,xo as v,ti as w,Qo as x,ei as y,ui as z};
